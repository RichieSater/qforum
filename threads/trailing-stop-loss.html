<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
Trailing Stop-Loss
</title>
<meta content='I did some searches, but no dice. Does anyone have a UDF / stand-alone Trailing Stop-Loss function they created?I want to compare it against mine for logic purposes.Thanks' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="PilETH6oh0R54AQS0GK4g8flhY7aYBw0GF7y2YUQIlFCTzIB3F5Vp8D9XSOfjRD3/2um56CsCS+aUSmzL1VA6g==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/trailing-stop-loss' property='og:url'>
<meta content='Trailing Stop-Loss' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/trailing-stop-loss' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='Trailing Stop-Loss' property='og:title'>
<meta content='I did some searches, but no dice. Does anyone have a UDF / stand-alone Trailing Stop-Loss function they created?I want to compare it against mine for logic purposes.Thanks' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/trailing-stop-loss">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='54a189379f92fe94f6000367'>
<div class='post-container' data-post-id='54a189379f92fe94f6000367' id='54a189379f92fe94f6000367'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>Trailing Stop-Loss</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5445095923fba7c7730002ec'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/bff7bb2005dfba5cba38b364b1033bd5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5445095923fba7c7730002ec'>Gregory Milne</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1419872567000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=Trailing Stop-Loss&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Ftrailing-stop-loss%3Futm_source%3Dwebsite_share%26utm_campaign%3Dtrailing-stop-loss%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Ftrailing-stop-loss%3Futm_source%3Dwebsite_share%26utm_campaign%3Dtrailing-stop-loss%26utm_medium%3Dlinkedin&amp;title=Trailing+Stop-Loss+%28Gregory+Milne%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class='tags tag-row'>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Tools and Tips' data-tag-id='55c50e7d8d4710ec6e000011' href='/posts/tag/Tools-and-Tips/newest'>Tools and Tips</a>
</div>
<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/trailing-stop-loss?utm_source=website_share&amp;utm_campaign=trailing-stop-loss&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Gregory Milne" />
<div class='body-text'>
<div class='body-text-container post-body'><p>I did some searches, but no dice. Does anyone have a UDF / stand-alone Trailing Stop-Loss function they created?</p>

<p>I want to compare it against mine for logic purposes.</p>

<p>Thanks  </p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>30 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='54a1c2899ba932e7b300008f' id='54a1c2899ba932e7b300008f'>
<a href='#54a1c2899ba932e7b300008f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5258725aa09fa7ebaa000024'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7734b86e32e834268bee6749eb322fb4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5258725aa09fa7ebaa000024'>David Edwards</a>
</div>
<a UTCms='1419887243000' class='quanto-date posted-at response-posted-at' href='#54a1c2899ba932e7b300008f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I tossed together this simple version. The algo buys once at the beginning of each month and waits for a trailing stop signal set at 95% of the highest price seen since the position was taken.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54a2f5f01fdec861af00007f' id='54a2f5f01fdec861af00007f'>
<a href='#54a2f5f01fdec861af00007f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/53d46cdb75f57a2832005a6b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/62b39881ee19f936224017339779d9d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/53d46cdb75f57a2832005a6b'>Market Tech</a>
</div>
<a UTCms='1419965939000' class='quanto-date posted-at response-posted-at' href='#54a2f5f01fdec861af00007f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Another take on a trailing stop exit. This one with a simple breakout entry logic.</p>

<p>This one uses the STD of recent close prices to buffer the trailing stop. This is a variation on the ATR trailing stop.</p>

<p>[Edit...
If you swap in the following settings and the below security list you can get much better results.</p>

<pre><code>STDMultiplier = 5.0  
Periods = 100  
def initialize(context):  
    context.Stocks = symbols(&quot;XLB&quot;,&quot;XLE&quot;,&quot;XLF&quot;,&quot;XLI&quot;,&quot;XLK&quot;,&quot;XLP&quot;,&quot;XLU&quot;,&quot;XLV&quot;,&quot;XLY&quot;,&quot;AGG&quot;)  
</code></pre>

<p>and below:</p>

<pre><code>    record(Stop1=context.StopPrices[context.Stocks[0]], Price1=historic[&quot;close&quot;][context.Stocks[0]][-1],  
           Stop2=context.StopPrices[context.Stocks[1]],  
           Stop3=context.StopPrices[context.Stocks[2]],  
           Stop4=context.StopPrices[context.Stocks[3]]  
          )  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54a56f91c57776cb120003c2' id='54a56f91c57776cb120003c2'>
<a href='#54a56f91c57776cb120003c2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549f0051c0da0ac8740004a4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/45b751674a97d0f9f1ed29a205bde5f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549f0051c0da0ac8740004a4'>Klaus Mogensen</a>
</div>
<a UTCms='1420128147000' class='quanto-date posted-at response-posted-at' href='#54a56f91c57776cb120003c2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks a lot for this example. I often use trailing stop loss. I am new to Quantopian and this is my first attempt on modifying a code:) I changed to buying when the price &gt; 30 days mavg and changed stop loss to 10%, because this resembles quite closely my &#39;manual&#39; strategy, when investing in indices. Here, I hope for downside protection, while not missing too much of the rebound.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54a59122193ea0e86b0001ee' id='54a59122193ea0e86b0001ee'>
<a href='#54a59122193ea0e86b0001ee'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549f0051c0da0ac8740004a4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/45b751674a97d0f9f1ed29a205bde5f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549f0051c0da0ac8740004a4'>Klaus Mogensen</a>
</div>
<a UTCms='1420136740000' class='quanto-date posted-at response-posted-at' href='#54a59122193ea0e86b0001ee'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>This is the same algorithm run on a minute basis. Here, the performance is worse than the benchmark. On the daily basis it was selling 11 times, while selling 17 times on the minute basis, meaning that it was loosing a lot on selling on smaller corrections, due to wild intraday swings? Or is there something weird on the algo on the daily basis? Is the lesson here that intraday variation should be ignored??  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54a6d8ce0219583613000098' id='54a6d8ce0219583613000098'>
<a href='#54a6d8ce0219583613000098'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b9b56c02cabe5dae000143'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e9388ae5102f3b152fa6225f955a29d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b9b56c02cabe5dae000143'>Alisa Deychman</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1420220624000' class='quanto-date posted-at response-posted-at' href='#54a6d8ce0219583613000098'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Klaus, in backtesting, orders are submitted in one bar and then filled in the next bar (subject to your fill logic and <a href="https://www.quantopian.com/help#ide-slippage">slippage</a>).  The difference between minute and daily mode is how often the data is queried. </p>

<p>In minute mode, the data is sampled every minute and closely simulates live trading. If you submit an order in one minute bar it will be filled in the next minute. </p>

<p>In daily mode, orders are submitted at the end of the day and are filled at the next day&#39;s close price. This was a conservative measure to avoid leaking bias into the algorithm. Though more conservative, it exposes more fluctuations in the fill price. </p>

<p>I&#39;d suggest to code your algo in minute mode and use <a href="https://www.quantopian.com/help#ide-schedulefunction">schedule_function</a> to run things once per day or at another specified frequency.  Try it out!</p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='54a6ff3ce4c85375e700001c' id='54a6ff3ce4c85375e700001c'>
<a href='#54a6ff3ce4c85375e700001c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549f0051c0da0ac8740004a4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/45b751674a97d0f9f1ed29a205bde5f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549f0051c0da0ac8740004a4'>Klaus Mogensen</a>
</div>
<a UTCms='1420230465000' class='quanto-date posted-at response-posted-at' href='#54a6ff3ce4c85375e700001c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks for the reply. The coding is new to me, so I will look into this and I saw that there are quite some posts on this subject. I still find it quite weird/intriguing if there is such a big difference in performance, by only considering the closing price and waiting until next day with selling. Maybe the price often bounds back the following day after a sharp decline, so the price is better??  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54a7f396021958239c000301' id='54a7f396021958239c000301'>
<a href='#54a7f396021958239c000301'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549f0051c0da0ac8740004a4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/45b751674a97d0f9f1ed29a205bde5f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549f0051c0da0ac8740004a4'>Klaus Mogensen</a>
</div>
<a UTCms='1420293016000' class='quanto-date posted-at response-posted-at' href='#54a7f396021958239c000301'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is the same run using the schedule function in order to only consider the closing_price. It is probably best to avoid the intraday &#39;noise&#39; for long term investors.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54aaed67e72989064b0003fc' id='54aaed67e72989064b0003fc'>
<a href='#54aaed67e72989064b0003fc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549f0051c0da0ac8740004a4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/45b751674a97d0f9f1ed29a205bde5f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549f0051c0da0ac8740004a4'>Klaus Mogensen</a>
</div>
<a UTCms='1420488043000' class='quanto-date posted-at response-posted-at' href='#54aaed67e72989064b0003fc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is the final attempt (hopefully not too over-optimized). It is of course difficult to make a strategy that works well both during the bear and the bull markets, as also mentioned by others. Therefore, the following example is a combination of two stop losses. When the market trend up (200 days mavg &gt; 400 days mavg) then the entry point is for the closing price to go above the 50-day mavg. When the trend is down (200 days mavg &lt; 400 days mavg) then the entry point is for the price to pass through the 100 days mavg. Hence the criteria for entering the market is more relaxed during a bull market than a bear market, which should make sense for a long-only strategy. The stop loss is 10% in both cases bases on the closing price. It seems to perform quite well for other of the large indices, as well. Max draw down was 16%.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54aaf82f828e6841d70001d2' id='54aaf82f828e6841d70001d2'>
<a href='#54aaf82f828e6841d70001d2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/53d46cdb75f57a2832005a6b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/62b39881ee19f936224017339779d9d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/53d46cdb75f57a2832005a6b'>Market Tech</a>
</div>
<a UTCms='1420490802000' class='quanto-date posted-at response-posted-at' href='#54aaf82f828e6841d70001d2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Simple yet effective. Funny though that trading started before a full 400 trading days had transpired no? One would think that a full 400 days would be required to build a 400 day MA right?</p>

<p>Here&#39;s another test that&#39;s fun to do. Run a rolling year test and compare the results. Run 2004 only, then 2005, etc. And collect the individual years results. The issue with using order_target_percent, I&#39;ve found, is that it might be unrealistic; compounding a good year on top of a a so-so year makes even the so-so year exceptional . But starting over fresh every year gives you a sense of what you could expect if you start trading right now -- and what you might see in a years time. </p>

<p>You can also look at the rolling 12 month returns in your full back test, try averaging those out to see a more realistic future return.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54ab0353b3666cc9a80001d4' id='54ab0353b3666cc9a80001d4'>
<a href='#54ab0353b3666cc9a80001d4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549f0051c0da0ac8740004a4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/45b751674a97d0f9f1ed29a205bde5f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549f0051c0da0ac8740004a4'>Klaus Mogensen</a>
</div>
<a UTCms='1420493654000' class='quanto-date posted-at response-posted-at' href='#54ab0353b3666cc9a80001d4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks for the comments. Yes, it is a little strange at the beginning? It is a good idea to test a year at a time to get a more realistic picture for future returns, when starting from scratch.</p>

<p>I tested it on several indices. Something a little weird is that it works good on Russell 1000, but not so good on Russell 2000. Maybe Russell 2000 is too volatile?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54ab0457b3666cc9a80001dc' id='54ab0457b3666cc9a80001dc'>
<a href='#54ab0457b3666cc9a80001dc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b9b56c02cabe5dae000143'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e9388ae5102f3b152fa6225f955a29d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b9b56c02cabe5dae000143'>Alisa Deychman</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1420493913000' class='quanto-date posted-at response-posted-at' href='#54ab0457b3666cc9a80001dc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The moving average is built dynamically (and a recent feature upgrade!). On day 1 of the backtest you&#39;ll have a full mavg available because it queries for historical data before the backtest&#39;s start date. This way you won&#39;t have to wait for the 200 or 400 day window to be filled during the backtest.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='54ab0b99e72989fe30000476' id='54ab0b99e72989fe30000476'>
<a href='#54ab0b99e72989fe30000476'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/53d46cdb75f57a2832005a6b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/62b39881ee19f936224017339779d9d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/53d46cdb75f57a2832005a6b'>Market Tech</a>
</div>
<a UTCms='1420495772000' class='quanto-date posted-at response-posted-at' href='#54ab0b99e72989fe30000476'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>That must mean that the Q has data prior to 1/3/2002 then? From Klaus&#39;s test where trading started 11/4/2002 minus 400 trading days... let&#39;s see 251 backwards would be 11/4/2001, and another 149 would be ~4/4/2001 yes? So there is data back to 4/4/2001 (or there abouts if we believe Klaus&#39;s strat traded at the soonest opportunity)?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54ac42111c547ca2b60004e3' id='54ac42111c547ca2b60004e3'>
<a href='#54ac42111c547ca2b60004e3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b9b56c02cabe5dae000143'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e9388ae5102f3b152fa6225f955a29d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b9b56c02cabe5dae000143'>Alisa Deychman</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1420575252000' class='quanto-date posted-at response-posted-at' href='#54ac42111c547ca2b60004e3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I had missed the backtest start date! You&#39;re right that we don&#39;t have data before Jan 3 2002, this will be the first date that data is available in the algorithm. Looks like something else might be lurking in the beginning of the algorithm&#39;s backtest.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='54b2f88f3e903ceda10004e8' id='54b2f88f3e903ceda10004e8'>
<a href='#54b2f88f3e903ceda10004e8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5445095923fba7c7730002ec'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/bff7bb2005dfba5cba38b364b1033bd5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5445095923fba7c7730002ec'>Gregory Milne</a>
</div>
<a UTCms='1421015186000' class='quanto-date posted-at response-posted-at' href='#54b2f88f3e903ceda10004e8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Sorry for being MIA work has been quite busy.  I was thinking something more intraday for momentum strategies.  I codded the following on my desktop not inside your API:</p>

<pre><code>import sys as s  
############################  
#  Trailing Stop-loss Test #  
############################

l_price = c_price = 35.4  
s_loss_pct = 0.05  
t_s_l = c_price * ( 1 - s_loss_pct )

print &quot;[+] Current stock price: %0.2f&quot; % c_price  
print &quot;[+] Trailing stop-loss percent set for: %0.2f%%&quot; % (s_loss_pct * 100)

def trailing_stop_loss( price ):  
    global t_s_l, l_price, s_loss_pct  
    #check to see if price has already passed our stop-loss if so, sell.  
    if price &lt;= t_s_l:  
        print &quot;[!]Selling because: %0.2f &lt;= %0.2f&quot; % (price, t_s_l)  
        s.exit()  
    elif price &lt;= l_price:  
        l_price = price  
        return  
    elif price &gt;= l_price and price * (1 - s_loss_pct ) &gt; t_s_l:  
        #update trailing  
        t_s_l = price * (1 - s_loss_pct )  
        l_price = price  
        return  

while 1:  
    print &quot;[+] Current trailing stop-loss set to: %0.2f&quot; % t_s_l  
    #manually simulate stock market price movements  
    price = raw_input( &quot;Enter a new price &gt;&quot; )

    # have to type-cast input so not treated as string  
    trailing_stop_loss( float( price ) )  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54b311a6d7555895aa000231' id='54b311a6d7555895aa000231'>
<a href='#54b311a6d7555895aa000231'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5445095923fba7c7730002ec'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/bff7bb2005dfba5cba38b364b1033bd5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5445095923fba7c7730002ec'>Gregory Milne</a>
</div>
<a UTCms='1421021608000' class='quanto-date posted-at response-posted-at' href='#54b311a6d7555895aa000231'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Maybe something like the attached?  Just threw it together very fast -- let me know if there is a more efficient way to code this and integrate it into different algos.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56907f361f924e1f0700005f' id='56907f361f924e1f0700005f'>
<a href='#56907f361f924e1f0700005f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1452310330000' class='quanto-date posted-at response-posted-at' href='#56907f361f924e1f0700005f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Trailing trades code for multiple securities. (Figured this might be the better place to post this)<br>
These are geared to be able to easily replace order_target_percent() in existing code to try them out.</p>

<pre><code>def handle_data(context, data):  
    for stock in data:  
        [ some conditions ]  
            #order_target_percent(stock, .5)  
            TrailingBuy(stock, .5, context, data)  
        else:  
            #order_target_percent(stock, 0)  
            TrailingSell(stock, 0, context, data)

def TrailingBuy(sec, percent, c, data):  # Trailing Stop for Buy on dn-then-up movement  
    b_stop_ratio = 1.06   # Ratio above low trigger to buy.  
    if sec not in data: return  
    if &#39;books&#39; not in c: c.books = {}  
    log_it = 0  
    sym    = sec.symbol  
    if sym not in c.books:  
        c.books[sym] = {}  
    bsym   = c.books[sym]  
    price  = data[sec].price  
    keyy   = price   # Could act on moving average for example, or other  
    b_stop = b_stop_ratio * keyy  
    if &#39;trailingBuy&#39; not in bsym:  
        bsym[&#39;trailingBuy&#39;] = b_stop        # The marker line  
        return

    if keyy &gt; bsym[&#39;trailingBuy&#39;]:  
        order_target_percent(sec, percent)  # Buy

    elif b_stop &lt; bsym[&#39;trailingBuy&#39;]: # If lower  
        if log_it:  
            log.info(&#39;{} Lower trailingBuy from {} to {}&#39;.format(  
                sym, bsym[&#39;trailingBuy&#39;], b_stop))  
        bsym[&#39;trailingBuy&#39;] = b_stop   # Adjust trailingBuy lower with dn movement.

def TrailingSell(sec, percent, c, data):  # Trailing Stop for Sell on up-then-dn movement  
    s_stop_ratio = .94    # Ratio below high trigger to sell.  
    if sec not in data: return  
    if &#39;books&#39; not in c: c.books = {}  
    log_it = 0  
    sym    = sec.symbol  
    if sym not in c.books:  
        c.books[sym] = {}  
    bsym   = c.books[sym]  
    price  = data[sec].price  
    keyy   = price   # Could act on moving average for example, or other  
    s_stop = s_stop_ratio * keyy  
    if &#39;trailingSell&#39; not in bsym:  
        bsym[&#39;trailingSell&#39;] = s_stop        # The marker line  
        return

    if keyy &lt; bsym[&#39;trailingSell&#39;]:  
        order_target_percent(sec, percent)   # Sell

    elif s_stop &gt; bsym[&#39;trailingSell&#39;]: # If lower  
        if log_it:  
            log.info(&#39;{} Increase trailingSell from {} to {}&#39;.format(  
                sym, bsym[&#39;trailingSell&#39;], s_stop))  
        bsym[&#39;trailingSell&#39;] = s_stop   # Adjust trailingSell higher with up movement.

</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='569084c71f924e1f070000ae' id='569084c71f924e1f070000ae'>
<a href='#569084c71f924e1f070000ae'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1452311755000' class='quanto-date posted-at response-posted-at' href='#569084c71f924e1f070000ae'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>This would fail if the stock split, right?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5690e3897fe3e3077a000172' id='5690e3897fe3e3077a000172'>
<a href='#5690e3897fe3e3077a000172'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1452336014000' class='quanto-date posted-at response-posted-at' href='#5690e3897fe3e3077a000172'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>As anything relying on price would, more generally, no?</p>

<p>I posted a function that should help with drastic price changes including splits.<br>
<a href="https://www.quantopian.com/posts/dealing-with-stock-splits">https://www.quantopian.com/posts/dealing-with-stock-splits</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5691440695c7421ade0003f0' id='5691440695c7421ade0003f0'>
<a href='#5691440695c7421ade0003f0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1452360714000' class='quanto-date posted-at response-posted-at' href='#5691440695c7421ade0003f0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Only if one stores prices in context. More stateless algos so not have this problem...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='569166411f924e1f070006f7' id='569166411f924e1f070006f7'>
<a href='#569166411f924e1f070006f7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1452369477000' class='quanto-date posted-at response-posted-at' href='#569166411f924e1f070006f7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>If one has a way that everyone can be safe in splits always, perhaps they can share the knowledge, rather than just saying it is so.<br>
Remember to address the instances reported here where adjustments fell thru the cracks.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56916867561635ef9b000b1d' id='56916867561635ef9b000b1d'>
<a href='#56916867561635ef9b000b1d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1452370032000' class='quanto-date posted-at response-posted-at' href='#56916867561635ef9b000b1d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Trailing stops are not possible to implement safely given the information our algos have access to; I don&#39;t have a secret way to do them better, I just avoid them now. Note that stops based on breaking below &#39;donchian&#39; or bollinger bands can be implemented correctly, given correctly split adjusted data from Quantopian in history.</p>

<p>If there are data errors from Quantopian, then I don&#39;t believe anything can be implemented both safely and correctly, and we must just hope that the errors cancel out in the end.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56917bbc3443dbc3a90000b8' id='56917bbc3443dbc3a90000b8'>
<a href='#56917bbc3443dbc3a90000b8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/53d46cdb75f57a2832005a6b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/62b39881ee19f936224017339779d9d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/53d46cdb75f57a2832005a6b'>Market Tech</a>
</div>
<a UTCms='1452374980000' class='quanto-date posted-at response-posted-at' href='#56917bbc3443dbc3a90000b8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Despite any strategy which I may have posted here in the past, I believe the only safe way to perform threshold trading is to forego retaining state of any sort and do &quot;groundhog&quot; style analysis and execution. The groundhog knows nothing about the environment outside of its burrow. It must pop its head up out of its hole and take a look around gathering all the data it may need to decide whether to forage or go back to bed. It remembers nothing. Its decision is completely based upon what it finds at the time of its query.</p>

<p>With this in mind one would have to recalculate all metrics required to trade -- on every periodic (or event based) opportunity. This means for a trailing stop, one would have to redetermine one&#39;s entry price (maybe it changed since the last period due to splits or other actions), re-perform the trailing % or ticks or time or threshold (Boll, Kelt, MA, etc.) calculations and then make ones execution decision. This seems counter intuitive at times since you&#39;re essentially redoing all this work that you just did a minute ago, over and over and over. But external circumstances force you to assume the world has changed while your algo was asleep and that you must reestablish your baseline metrics anew. I ran into this many times in my prior career and eventually learned that I must assume I knew nothing at the roll of the minute or day or at the tick or execution event; wake up, look around, gather info and make a decision.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5691a6ee1f924e4a380008d4' id='5691a6ee1f924e4a380008d4'>
<a href='#5691a6ee1f924e4a380008d4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1452386036000' class='quanto-date posted-at response-posted-at' href='#5691a6ee1f924e4a380008d4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Market Tech - I agree completely. Stateless is best.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5691ef94032c37acb30002f1' id='5691ef94032c37acb30002f1'>
<a href='#5691ef94032c37acb30002f1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1452404633000' class='quanto-date posted-at response-posted-at' href='#5691ef94032c37acb30002f1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>It just occurred to me that you could do this sort of thing by calculating the split/dividend adjustment ratios by doing a Last and PrevLast pipeline every day, and dividing today&#39;s PrevLast by yesterday&#39;s Last (stored in context). Then you could adjust all your stops every mornings...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5692c69e44ff700a640002d7' id='5692c69e44ff700a640002d7'>
<a href='#5692c69e44ff700a640002d7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/53dfa27b197bbb2516000159'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/51e4ba51c431ce2b4373006a33ade2aa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/53dfa27b197bbb2516000159'>Karen Rubin</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1452459684000' class='quanto-date posted-at response-posted-at' href='#5692c69e44ff700a640002d7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Simon - I think what you outline above, is similar to <a href="https://www.quantopian.com/posts/dividend-bug-fixed-in-pipeline-algorithms">what I did here to identify when splits or dividends</a> have happened. I was using it for debugging, but I expect it has other uses as well. </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5692d5d8d09d6756ba0000b5' id='5692d5d8d09d6756ba0000b5'>
<a href='#5692d5d8d09d6756ba0000b5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1452463580000' class='quanto-date posted-at response-posted-at' href='#5692d5d8d09d6756ba0000b5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ah yes precisely - this information could be used to adjust all price values that someone has stored in <code>context</code>, for re-entering trailing stops or profit target orders at the same spot as yesterday, despite any splits of dividends overnight.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56934eb8e0a4ac9f340004cc' id='56934eb8e0a4ac9f340004cc'>
<a href='#56934eb8e0a4ac9f340004cc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5682be6750d401992e000219'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/305b95ea509e85b40be630e5a97a0f08?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5682be6750d401992e000219'>Alex K</a>
</div>
<a UTCms='1452494526000' class='quanto-date posted-at response-posted-at' href='#56934eb8e0a4ac9f340004cc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>So nobody is actually using stops, you just simulate them? My WIP version of trailing stops is below. I am actually modifying stop orders here, assuming that they are re-instated at market open (which is another thing I need to write). Note - this function assumes that all open orders are stops.</p>

<p>It uses the fixed percent of the price to trail, but I am working on storing the desired loss $ per entry order and using that instead.</p>

<p>Question - does Q update <code>position.amount</code> and and <code>position.cost_basis</code> during spits? (I mean for overnight positions of course)</p>

<pre><code># Returns the list of strings representing a log of trail events  
def trail_stops(context, close_prices):  
    trail_log = []  
    open_orders_by_security = get_open_orders()  
    for security, open_orders_for_security in open_orders_by_security.iteritems():  
        assert len(open_orders_for_security) &lt;= 1, &quot;Expected 0 or 1 open orders for security &quot; + security.symbol + &quot; but got: &quot; + str(len(open_orders_for_security)) + &quot;, orders: &quot; + print_orders(open_orders_for_security)  
        for open_order in open_orders_for_security:  
            if open_order.status == 0: # 0 = Open  
                current_price = close_prices[open_order.sid][-1]  
                assert open_order.amount != 0, &quot;open_order amount is not expected to be zero&quot;  
                isProtectingLong = open_order.amount &lt; 0 # stop = sell  
                optimum_stop_price = current_price * (1 + context.stop_loss_trailing_fraction * (-1 if isProtectingLong else 1))

                need_to_move_stop_order = optimum_stop_price &gt; open_order.stop if isProtectingLong else optimum_stop_price &lt; open_order.stop  
                if need_to_move_stop_order:  
                    o_sid = open_order.sid  
                    o_amount = open_order.amount  
                    trail_log.append(&quot;Moving %d/%d %s stop from %s to %s&quot; % (open_order.filled, open_order.amount, open_order.sid.symbol, print_nullable_money(open_order.stop), print_nullable_money(optimum_stop_price)))  
                    cancel_order(open_order) # order is not callable after cancelling  
                    order(o_sid, o_amount, style=StopOrder(stop_price = optimum_stop_price))  
                else:  
                    trail_log.append(&quot;Not moving stop: %s, opt price %s, curr price %s&quot; % (print_nullable_money(open_order.stop), print_nullable_money(optimum_stop_price), print_nullable_money(current_price)))  
    return trail_log

def print_nullable_money(number):  
    return (&quot;%.2f&quot; % number) if number is not None else &quot;null&quot;

def print_order(order):  
   return &quot;Status: %d, filled: %d out of %d, stop: %s, limit: %s, created: %s&quot; % (order.status, order.filled, order.amount, print_nullable_money(order.stop), print_nullable_money(order.limit), order.created)

def print_orders(orders):  
    result = &quot;&quot;  
    for o in orders:  
        result += print_order(o) + &quot;, &quot;  
    return result  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c9b9c9d2cb02433a17b33bc' id='5c9b9c9d2cb02433a17b33bc'>
<a href='#5c9b9c9d2cb02433a17b33bc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5c7b1c03644e12004bdf227d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f49cb5de4a2764f3e0b7a3729b81056d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5c7b1c03644e12004bdf227d'>Akira Charles</a>
</div>
<a UTCms='1553702045000' class='quanto-date posted-at response-posted-at' href='#5c9b9c9d2cb02433a17b33bc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi, I&#39;m new to Quantopian and only recently learnt python programming. I have what may seem as a very simple question. I noticed in some of the above source coding for Klaus Mogensen and David Edwards, under their Initialize function, they have &quot;context.stop_price = 0&quot; Why is the stop_price being equated to zero? For some reason I cannot understand it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c9ba61ad8e3305466fce778' id='5c9ba61ad8e3305466fce778'>
<a href='#5c9ba61ad8e3305466fce778'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5682be6750d401992e000219'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/305b95ea509e85b40be630e5a97a0f08?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5682be6750d401992e000219'>Alex K</a>
</div>
<a UTCms='1553704474000' class='quanto-date posted-at response-posted-at' href='#5c9ba61ad8e3305466fce778'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>That&#39;s just to initialize that value to something in the beginning. During algorithm execution <code>stop_price</code> is over-written with an actual calculated value.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c9ba67ed8e3305466fce77e' id='5c9ba67ed8e3305466fce77e'>
<a href='#5c9ba67ed8e3305466fce77e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5c7b1c03644e12004bdf227d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f49cb5de4a2764f3e0b7a3729b81056d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5c7b1c03644e12004bdf227d'>Akira Charles</a>
</div>
<a UTCms='1553704574000' class='quanto-date posted-at response-posted-at' href='#5c9ba67ed8e3305466fce77e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks for the reply. Appreciated  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/trailing-stop-loss'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/trailing-stop-loss'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#cea8ababaaacafada58ebfbbafa0baa1bea7afa0e0ada1a3">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
New Strategy - Presenting the “Quality Companies in an Uptrend” Model
</title>
<meta content='We wanted to share with the Quantopian community an algorithm named “Quality Companies in an Uptrend”.  This non-optimized, long-only strategy has produced returns of 18.0% using the Q500US universe since 2003 with a Sharpe Ratio of 1.05 and 12% of Alpha and a Beta of 0.53. We’d appreciate your input and feedback on the strategy. Combining Quality With Momentum This is a “quantamental” strategy, combining both fundamental factors (in this case, the quality factor) with technical factors (in...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="fsxG5zB2j3hq7nQWtO7itMQqrJDcjktWzYgykY7Pqq0CqjCqkoBdm9PzLSf7AUrA/KSP+aZCXk1Ph+n7JIrIFg==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=true;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1' property='og:url'>
<meta content='New Strategy - Presenting the “Quality Companies in an Uptrend” Model' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='New Strategy - Presenting the “Quality Companies in an Uptrend” Model' property='og:title'>
<meta content='We wanted to share with the Quantopian community an algorithm named “Quality Companies in an Uptrend”.  This non-optimized, long-only strategy has produced returns of 18.0% using the Q500US universe since 2003 with a Sharpe Ratio of 1.05 and 12% of Alpha and a Beta of 0.53. We’d appreciate your input and feedback on the strategy. Combining Quality With Momentum This is a “quantamental” strategy, combining both fundamental factors (in this case, the quality factor) with technical factors (in...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='5dd82ee4c3bff75e49955009'>
<div class='post-container' data-post-id='5dd82ee4c3bff75e49955009' id='5dd82ee4c3bff75e49955009'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>New Strategy - Presenting the “Quality Companies in an Uptrend” Model</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58e2d12a3bfa1b000ae0441b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fd6452e042524ac9f6bbd40c88e5668e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58e2d12a3bfa1b000ae0441b'>Chris Cain</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1574448868000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=New Strategy - Presenting the “Quality Companies in an Uptrend” Model&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fnew-strategy-presenting-the-quality-companies-in-an-uptrend-model-1%3Futm_source%3Dwebsite_share%26utm_campaign%3Dnew-strategy-presenting-the-quality-companies-in-an-uptrend-model-1%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fnew-strategy-presenting-the-quality-companies-in-an-uptrend-model-1%3Futm_source%3Dwebsite_share%26utm_campaign%3Dnew-strategy-presenting-the-quality-companies-in-an-uptrend-model-1%26utm_medium%3Dlinkedin&amp;title=New+Strategy+-+Presenting+the+%E2%80%9CQuality+Companies+in+an+Uptrend%E2%80%9D+Model+%28Chris+Cain%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class='tags tag-row'>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Momentum' data-tag-id='55c50e7d8d4710ec6e00000c' href='/posts/tag/Momentum/newest'>Momentum</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Pipeline' data-tag-id='561525bcf252a59171000001' href='/posts/tag/Pipeline/newest'>Pipeline</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Fundamentals' data-tag-id='5bbf6123cb181d749727e7fc' href='/posts/tag/Fundamentals/newest'>Fundamentals</a>
</div>
<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1?utm_source=website_share&amp;utm_campaign=new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Chris Cain" />
<div class='body-text'>
<div class='body-text-container post-body'><p>We wanted to share with the Quantopian community an algorithm named “Quality Companies in an Uptrend”. </p>

<p>This non-optimized, long-only strategy has produced returns of 18.0% using the Q500US universe since 2003 with a Sharpe Ratio of 1.05 and 12% of Alpha and a Beta of 0.53.</p>

<p>We’d appreciate your input and feedback on the strategy.</p>

<p><strong>Combining Quality With Momentum</strong></p>

<p>This is a “quantamental” strategy, combining both fundamental factors (in this case, the quality factor) with technical factors (in this case, the cross-sectional momentum factor) in a quantitative, rules-based way.</p>

<p>The idea of this strategy is to first identify high-quality companies then tactically rotate into the high-quality companies with the best momentum. </p>

<p><strong>What is Quality?</strong></p>

<p>The characteristics of “quality” companies are rather broad.  Quality is typically defined as companies that have some combination of:</p>

<ul>
<li>stable earnings<br></li>
<li>strong balance sheets (low debt)<br></li>
<li>high profitability<br></li>
<li>high earnings growth<br></li>
<li>high margins.</li>
</ul>

<p><strong>How Will We Measure Quality?</strong></p>

<p>For our strategy, we focus on companies with a high return on equity (ROE) ratio.  </p>

<p>ROE is calculated by dividing the net income of a company by the average shareholder equity.  Higher ROE companies indicate higher quality stocks.  High ROE companies have historically produced strong returns.  </p>

<p><strong>Rules for The “Quality Companies in an Uptrend” Strategy:</strong></p>

<ol>
<li>Universe = Q500US<br></li>
<li>Quality (ROE) Filter.  We then take the 50 stocks (top decile) with the highest ROE.  This is our quality screen, we are now left with 50 high-<br>
quality stocks.<br></li>
<li>Quality Stocks With Strong Momentum.  We then buy the 20 stocks (of our 50 quality stocks) with the strongest relative momentum, skipping the last 10 days (to account for mean reversion over this shorter time frame).<br></li>
<li>Trend Following Regime Filter. We only enter new positions if the trailing 6-month total return for the S&amp;P 500 is positive.  This is measured by the trailing 6-month total return of “SPY”.<br></li>
<li>This strategy is rebalanced once a month, at the end of the month.  We sell any stocks we currently hold that are no longer in our high ROE/high momentum list and replace them with stocks that have since made the list.  We only enter new long positions if the trend-following regime filter is passed (SPY’s 6-month momentum is positive).<br></li>
<li>Any cash not allocated to stocks gets allocated the IEF (7-10yr US Treasuries)</li>
</ol>

<p><strong>Potential Improvements?</strong></p>

<p>What potential improvements do you think we can add to this strategy?</p>

<p>Some of our ideas include:</p>

<ul>
<li>A composite to measure Quality, not just ROE<br></li>
<li>Adding a value component<br></li>
<li>Another way to measure momentum?<br></li>
<li>A better/different trend following filter?</li>
</ul>

<p>We’d love to see what you guys come up with.  Given the simple nature of this strategy, the performance is strong over the last 16+ years and should provide a good base for further testing.</p>

<p>Christopher Cain, CMT &amp; Larry Connors<br>
Connors Research LLC  </p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>443 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='5dd84195c3bff70048955789' id='5dd84195c3bff70048955789'>
<a href='#5dd84195c3bff70048955789'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574453653000' class='quanto-date posted-at response-posted-at' href='#5dd84195c3bff70048955789'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Wow, what a great strategy! Thank you for sharing this! I&#39;ve been meaning to create something similar for trading in my own account (paper only initially).</p>

<p>I made the below quick modifications:</p>

<ol>
<li>Use ROIC instead of ROE, as ROIC includes debt as well (high returns on equity with little leverage is high quality in my book)<br></li>
<li>Added low ltd to equity ranking to the &#39;quality ranking&#39; as again, low leverage is high quality in my book. This results in lower total returns, but also lower volatility and lower drawdowns, so a slightly higher Sharpe Ratio.<br></li>
<li>Also added two &#39;value&#39; metrics and added to the ranking. I prefer to buy &#39;quality&#39; when it&#39;s on sale, but you can easily comment this out.<br></li>
<li>Changed rebalance to 6 days before month end. My &#39;hypothesis&#39; is that most people get paid around this time (25th) so more money might be flowing into the market at this time, pushing it up (I have nothing to back this up, just my theory).</li>
</ol>

<p>Will try to improve it further when I have more time.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dd8454210d56b3de36b0f06' id='5dd8454210d56b3de36b0f06'>
<a href='#5dd8454210d56b3de36b0f06'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574454594000' class='quanto-date posted-at response-posted-at' href='#5dd8454210d56b3de36b0f06'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Another quality rank I would look at possibly add is consistently high ROIC over say the last 5 years. E.g. (mean 5yr ROIC) / (std_dev of 5yr ROIC).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dd869e6b7fadd0047984a79' id='5dd869e6b7fadd0047984a79'>
<a href='#5dd869e6b7fadd0047984a79'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59909a3270ea110010c7c5c3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/eab11bd2b7083139db0829c19e3968cc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59909a3270ea110010c7c5c3'>Albert King</a>
</div>
<a UTCms='1574463974000' class='quanto-date posted-at response-posted-at' href='#5dd869e6b7fadd0047984a79'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Interesting!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dda32d10ad4220051628f78' id='5dda32d10ad4220051628f78'>
<a href='#5dda32d10ad4220051628f78'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1574580945000' class='quanto-date posted-at response-posted-at' href='#5dda32d10ad4220051628f78'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Could someone please help me understand the line number 58 &amp; 59? I am new to coding and I can only understand that Line number 58 creates a dataframe for daily close price for 140 days. and Line number 59 calculates the 126 days return and gives that value. Is that correct? I dont understand what iloc[-1 does and why it is required? </p>

<p>Is my understanding correct that the trend filter basically means - if 126 days return are positive then true if not then false?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddab5bbb1b71700452816d4' id='5ddab5bbb1b71700452816d4'>
<a href='#5ddab5bbb1b71700452816d4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5965e9b60bfea9000d808f59'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/de62c5c978f9b99b6df23f7b97d5c15c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5965e9b60bfea9000d808f59'>Roy Lenders</a>
</div>
<a UTCms='1574614459000' class='quanto-date posted-at response-posted-at' href='#5ddab5bbb1b71700452816d4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>In good times smaller companies will grow faster than the big companies, in bad times it is better to invest in the big and large companies. You might want to adjust your universe filter based on some metric that allows allocation to small versus big.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddb0dd038574e6574ebe7e4' id='5ddb0dd038574e6574ebe7e4'>
<a href='#5ddb0dd038574e6574ebe7e4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58e2d12a3bfa1b000ae0441b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fd6452e042524ac9f6bbd40c88e5668e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58e2d12a3bfa1b000ae0441b'>Chris Cain</a>
</div>
<a UTCms='1574637008000' class='quanto-date posted-at response-posted-at' href='#5ddb0dd038574e6574ebe7e4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Great additions Joakim thank you. </p>

<p>I have found that &quot;composite&quot; methods to measure factors such as value and quality tend to work better.  This is consistent with the research I have read.  One that immediately comes to mind is Jim O&#39;Shaughnessy&#39;s book &quot;What Works on Wall Street&quot;, where he shows that a composite value factor outperforms each individual value factor.  I have found the same with quality.</p>

<p>To be honest I was surprised by how well this tests out given the simple nature of the original algo.  I have also done a lot of robustness testing with this algo, changing the trend following filter, the momentum look back, the days skipped, etc and it hold up well.</p>

<p>Interested to see what other come up with as far as improvements. </p>

<p>Chris  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddba76b8fcd84774de5d889' id='5ddba76b8fcd84774de5d889'>
<a href='#5ddba76b8fcd84774de5d889'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1574676331000' class='quanto-date posted-at response-posted-at' href='#5ddba76b8fcd84774de5d889'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I dont know if it is intentional but the algo frequently uses higher leverage. I tried this and the average leverage over same period is 1.19. Is there anyway to restrict it in range 1.00-1.02?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddbd8385e24530047ec3d40' id='5ddbd8385e24530047ec3d40'>
<a href='#5ddbd8385e24530047ec3d40'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5c4fdfe7e14cfb004889041b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/17dfa60f20385b8d3f7871b86f0171f1?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5c4fdfe7e14cfb004889041b'>Jamie Veitch (Azure Hawk)</a>
</div>
<a UTCms='1574688824000' class='quanto-date posted-at response-posted-at' href='#5ddbd8385e24530047ec3d40'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy, thank you very much for presenting us with screenshots instead of code of what you have managed to do with another&#39;s IP that they very kindly shared on the forums for us all to work on. Sure was useful...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddbf30efcca020049d663e4' id='5ddbf30efcca020049d663e4'>
<a href='#5ddbf30efcca020049d663e4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58e2d12a3bfa1b000ae0441b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fd6452e042524ac9f6bbd40c88e5668e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58e2d12a3bfa1b000ae0441b'>Chris Cain</a>
</div>
<a UTCms='1574695694000' class='quanto-date posted-at response-posted-at' href='#5ddbf30efcca020049d663e4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I have to agree with Jamie here. If you are going to modify the strategy please be transparent about what you did and provide the source code in the spirit of collaboration.  </p>

<p>Thanks,<br>
Chris  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddc1382d9c1df0046efc27c' id='5ddc1382d9c1df0046efc27c'>
<a href='#5ddc1382d9c1df0046efc27c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1574704002000' class='quanto-date posted-at response-posted-at' href='#5ddc1382d9c1df0046efc27c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Chris (Cain) I have done a great deal of work on these type of strategies and I tjink it essential to test using different rebalance dates. EG first of month, 13th, 21st....whatever. I found that huge and rather disturbing differences could result which made me feel uncomfortable with the robustness of the strategy. The effect was particularly noticeable where the filters resulted in small numbers of stocks in the portfolio.  Nonetheless I will clone your code (for which many thanks) and look more closely with interest.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddc14afaf2b8500409060ad' id='5ddc14afaf2b8500409060ad'>
<a href='#5ddc14afaf2b8500409060ad'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1574704303000' class='quanto-date posted-at response-posted-at' href='#5ddc14afaf2b8500409060ad'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Incidentally it is good to see some mofe ideas coming through which do not follow the stifling criteria for the Quantopian competitions. It makes for a much more interesting forum. I was getting very fes up with the &quot;neutral everything&quot; approach.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddc4e5eaf2b857d2d905d57' id='5ddc4e5eaf2b857d2d905d57'>
<a href='#5ddc4e5eaf2b857d2d905d57'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574719070000' class='quanto-date posted-at response-posted-at' href='#5ddc4e5eaf2b857d2d905d57'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s an update of my modified version of your strategy. Not sure it&#39;s much of an improvement, but posting nonetheless.</p>

<p>The main change is that this one is using SPY MA50 &gt; MA200 as the bull/bear market trend check, rather than trailing positive 6mo returns of SPY. Either way seem to work quite well.</p>

<p>I also added 3yr high and &#39;stable_roic&#39; and high and &#39;stable_margins&#39; ranks, but these are commented out as they seem to bring down performance , possibly due to making the model too complex. Or maybe I&#39;ve made a mistake with them?</p>

<blockquote>
<p>One that immediately comes to mind is Jim O&#39;Shaughnessy&#39;s book &quot;What<br>
Works on Wall Street&quot;, where he shows that a composite value factor<br>
outperforms each individual value factor. I have found the same with<br>
quality.</p>
</blockquote>

<p>^Indeed! I keep hoping they will release a 5th edition, with updates of how their value composites have performed since the last edition. Value factors have struggled in recent years I believe. </p>

<p>FYI, I won&#39;t be sharing any more updates unless others start to contribute as well.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddc7de0fcca026529d662e0' id='5ddc7de0fcca026529d662e0'>
<a href='#5ddc7de0fcca026529d662e0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574731232000' class='quanto-date posted-at response-posted-at' href='#5ddc7de0fcca026529d662e0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks @Guy, will you contribute any of your spectacular secret sauce here? :)</p>

<p>@All, looks like I did make a mistake in my CustomFactor. I believe this is the correct way of doing it:</p>

<pre><code>class Mean_Over_STD(CustomFactor):  
    window_length = 756  
    def compute(self, today, assets, out, value):  
            out[:] =  np.nanmean(value[0:-1]) / np.nanstd(value[0:-1])  
</code></pre>

<p>Let me know if I still got it wrong.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddd5135de6ed923ca5dd6b0' id='5ddd5135de6ed923ca5dd6b0'>
<a href='#5ddd5135de6ed923ca5dd6b0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55eefc2af269c592d80008a9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8985b490c95e135c2bbcd7d1a0dce16b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55eefc2af269c592d80008a9'>Jamie McCorriston</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1574785333000' class='quanto-date posted-at response-posted-at' href='#5ddd5135de6ed923ca5dd6b0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I didn&#39;t make any changes to the strategy, but in the spirit of collaborating to improve on the algorithm, I tried to clean up the style and efficiency of the code a bit. Some of the changes include:<br>
- Changed the custom factor definition to use the <code>axis</code> argument in the <code>np.nanmean</code> and <code>np.nanstd</code> functions.<br>
- Moved the <code>pipeline_output</code> into the scheduled function instead of <code>before_trading_start</code>. It <em>used</em> to be best practice to call <code>pipeline_output</code> in <code>before_trading_start</code>, but last year, we made a change such that pipelines are computed in their own special event and calling <code>pipeline_output</code> just reads the output, so you no longer need to put it in <code>before_trading_start</code>.<br>
- Condensed some of the code in <code>trade</code>.<br>
- Cleaned up some of the spacing and indentation to match common Python style guides.</p>

<p>Again, nothing material, and I don&#39;t think it perfectly follows Python style conventions, but hopefully others can learn from some of the changes!  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5ddd8c15eebfd864c21b42ac' id='5ddd8c15eebfd864c21b42ac'>
<a href='#5ddd8c15eebfd864c21b42ac'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58a629bc0ee39f0736043f98'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/00f9ef5a775629cae60a12144bb83ec5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58a629bc0ee39f0736043f98'>Indigo Monkey</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574800405000' class='quanto-date posted-at response-posted-at' href='#5ddd8c15eebfd864c21b42ac'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I tried few different known quality factors. Return on assets makes a tiny improvement in alpha and drawdown.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dddad4b4e54332746f68157' id='5dddad4b4e54332746f68157'>
<a href='#5dddad4b4e54332746f68157'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58a629bc0ee39f0736043f98'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/00f9ef5a775629cae60a12144bb83ec5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58a629bc0ee39f0736043f98'>Indigo Monkey</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574808907000' class='quanto-date posted-at response-posted-at' href='#5dddad4b4e54332746f68157'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>This version reduces risk.  The max drawdown is -10% , beta is way lower, and the Sharpe ratio is higher  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dddaee1901af266de7d28a6' id='5dddaee1901af266de7d28a6'>
<a href='#5dddaee1901af266de7d28a6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58a629bc0ee39f0736043f98'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/00f9ef5a775629cae60a12144bb83ec5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58a629bc0ee39f0736043f98'>Indigo Monkey</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574809313000' class='quanto-date posted-at response-posted-at' href='#5dddaee1901af266de7d28a6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>If you only care about returns this version is for you  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dddb41d901af228557d2672' id='5dddb41d901af228557d2672'>
<a href='#5dddb41d901af228557d2672'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1574810653000' class='quanto-date posted-at response-posted-at' href='#5dddb41d901af228557d2672'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>there is a flawed logic in algo above. it takes 3 times or more leverage. In fact, there are leverage spikes even in earlier version. Could someone please fix the earlier version so the leverage is not more than 1.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dddc796eebfd81c1d1b427c' id='5dddc796eebfd81c1d1b427c'>
<a href='#5dddc796eebfd81c1d1b427c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574815638000' class='quanto-date posted-at response-posted-at' href='#5dddc796eebfd81c1d1b427c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks @Jamie for fixing the CustomFactor. It seems to be working as I had intended now, and I&#39;ve included &#39;stable_roic&#39; in the ranking composite in the attached update.</p>

<p>Other changes I made:</p>

<ul>
<li>Changed the trading universe from Q500US to Q1500US, effectively a proxy for S&amp;P1500 (S&amp;P 500 LargeCaps + S&amp;P 400 MidCaps + S&amp;P 600 SmallCaps).<br></li>
<li>Excluded stocks in the Financial Services sector from the universe, since &#39;Quality&#39; for financial companies tend to be measured differently from stocks in other sectors, e.g. due to their larger balance sheets.</li>
</ul>

<p>I also kept latest ROIC rather than using latest ROA (to me, ROIC makes more intuitive sense, but I could be wrong).</p>

<p>Leverage is somewhat controlled in this one, but if anyone could help bringing it down to be consistently closer to 1.0 (without using the Q Optimizer), I think that would be a great contribution. Might require a daily check of leverage --&gt; rebalance?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dddca75de6ed942815dd727' id='5dddca75de6ed942815dd727'>
<a href='#5dddca75de6ed942815dd727'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58e2d12a3bfa1b000ae0441b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fd6452e042524ac9f6bbd40c88e5668e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58e2d12a3bfa1b000ae0441b'>Chris Cain</a>
</div>
<a UTCms='1574816373000' class='quanto-date posted-at response-posted-at' href='#5dddca75de6ed942815dd727'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@  Indigo Monkey , perhaps this was your intention, but all you are doing here is messing with the leverage (for the stock positions anyway)</p>

<p>The risk reduced version is just running the strategy at 0.5 leverage (again just for the equity positions).</p>

<p>The version with huge returns runs the strategy at elevated leverage.</p>

<p>In the code, &quot;context.Target_securities_to_buy&quot; and &quot;context.top_n_relative_momentum_to_buy&quot; need to be the same to keep the leverage around 1.  </p>

<p>These two variables control the amount we are buying (context.Target_securities_to_buy)  and our final momentum sort (context.top_n_relative_momentum_to_buy).</p>

<p>For the reduced risk version, this is hard to tell since we are putting unused cash into bonds.  It will show leverage around 1, but that is half bonds (how you have it coded)</p>

<p>Chris  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dddcc804fbc09424f0043ec' id='5dddcc804fbc09424f0043ec'>
<a href='#5dddcc804fbc09424f0043ec'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58e2d12a3bfa1b000ae0441b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fd6452e042524ac9f6bbd40c88e5668e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58e2d12a3bfa1b000ae0441b'>Chris Cain</a>
</div>
<a UTCms='1574816896000' class='quanto-date posted-at response-posted-at' href='#5dddcc804fbc09424f0043ec'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Joakim thank you great contributions as always</p>

<p>I know Joel Greenblatt and others have also taken out Financials as well, as they have a much different capital structure, making some value and quality metrics not analogous across sectors.</p>

<p>As for the leverage, I think one thing that we can do is change the rebalance logic.</p>

<p>As currently coded, if we are holding a stock for multiple months, we don&#39;t rebalance it back to the target allocation.  My thought here was to let our winners run, and not make the position size smaller just because it had good performance.</p>

<p>If we change this logic to rebalance each position in the portfolio back to target weights every month that will go a lot way I believe.</p>

<p>Chris  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dddf1ab4e54330042f68579' id='5dddf1ab4e54330042f68579'>
<a href='#5dddf1ab4e54330042f68579'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1574826411000' class='quanto-date posted-at response-posted-at' href='#5dddf1ab4e54330042f68579'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I deleted earlier post as there was no improvement. I thought I will just backtest with Joakim trend filter and shorter value factor. Improved returns.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dde16724fbc093159004606' id='5dde16724fbc093159004606'>
<a href='#5dde16724fbc093159004606'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574835826000' class='quanto-date posted-at response-posted-at' href='#5dde16724fbc093159004606'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks @Chris,</p>

<blockquote>
<p>As currently coded, if we are holding a stock for multiple months, we<br>
don&#39;t rebalance it back to the target allocation. My thought here was<br>
to let our winners run, and not make the position size smaller just<br>
because it had good performance.</p>
</blockquote>

<p>^This makes a lot of sense to me. Why penalize your winners? As you said, [cut your losses and] let your winners run! Or to paraphrase the Oracle: &quot;The best holding period for a great [quality] company is forever.&quot; :)</p>

<p>@Nadeem, thanks for your contribution! I wonder how your way of defining value is different from Morningstar&#39;s &#39;cash_return&#39;, which is also FCF / EV:</p>

<blockquote>
<p>cash_return<br>
Refers to the ratio of free cash flow to enterprise value. Morningstar calculates the ratio by using the underlying data reported in the company filings or reports: FCF /Enterprise Value.</p>
</blockquote>

<p>Here&#39;s another slight &#39;improved&#39; version (during this backtest period at least). Only change is that I changed &#39;stable_roic&#39; to be over 5 years instead of just 3. This won&#39;t really fully start to kick in until 2007 as there&#39;s no data on Q from before 2002.</p>

<p>Any kind soul out there want to help me set this up in IB&#39;s paper trading environment, using Quandl price and fundamental data (if available)? Would iBridgePy be the way to go? Or something else?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dde198beebfd8165d1b4343' id='5dde198beebfd8165d1b4343'>
<a href='#5dde198beebfd8165d1b4343'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1574836619000' class='quanto-date posted-at response-posted-at' href='#5dde198beebfd8165d1b4343'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Joakim - I read somewhere that morningstar cash_return gives ttm fcf. While I use latest fcf which is for latest quarter. My thinking is to use latest data (perhaps market has short memory). Just my opinion.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dde1aabeebfd81c1d1b44ae' id='5dde1aabeebfd81c1d1b44ae'>
<a href='#5dde1aabeebfd81c1d1b44ae'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574836907000' class='quanto-date posted-at response-posted-at' href='#5dde1aabeebfd81c1d1b44ae'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Fair enough, I didn&#39;t know that. Makes sense, thanks Nadeem.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dde238f85a48b004425b583' id='5dde238f85a48b004425b583'>
<a href='#5dde238f85a48b004425b583'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1574839183000' class='quanto-date posted-at response-posted-at' href='#5dde238f85a48b004425b583'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Joakim. I have a question. Maybe I m bit confused here. You are using (ascending=True) in debt to equity. This ascending order is default. Which means you are using high roic, high cash return, high total yield and high debt to equity. Isnt the original thought was to use lowest debt to equity? therefore, the parameter ascending should be set as False? Please help.. maybe I m confused about the logic here.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dde291d4fbc09424f0046e2' id='5dde291d4fbc09424f0046e2'>
<a href='#5dde291d4fbc09424f0046e2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574840605000' class='quanto-date posted-at response-posted-at' href='#5dde291d4fbc09424f0046e2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Nadeem, good catch! Yes, my thought was indeed that low debt to equity companies were high quality companies, so I should have set ascending order to False.  That doesn&#39;t work nearly as well obviously, but rather than keep this one as is, I would remove it and possibly replace it with some other quality factor.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dde3ff4901af201b07d2831' id='5dde3ff4901af201b07d2831'>
<a href='#5dde3ff4901af201b07d2831'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574846452000' class='quanto-date posted-at response-posted-at' href='#5dde3ff4901af201b07d2831'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Chris Cain, </p>

<p>The description of the strategy you presented fits my personal investment goal.<br>
Thanks for sharing.<br>
I backtested your original algorithm with line 9 commented. Why cheat myself.<br>
Results metric is good.<br>
When I tried to use order_optimal_portfolio() results got worse.<br>
I checked some positions (Backtest -&gt; Activity -&gt; Positions) and have some questions about your ordering engine:<br>
if TF_filter==False all positions in top_n_by_momentum should be sold or only part of them?<br>
I have seen the number of stock position slowly changing from 20 to 0 during several months in market  downtrend.<br>
Why at initial capital 100000<br>
2003-03-31 there was negative cash 68000 that is leverage 1.68<br>
2007-07-31 there was negative cash 50000  ...<br>
In one of Joakim Arvidsson   <em>long-only strategy</em>  I have seen negative position in bond (-80%) together with 20 stock positions?<br>
May be we need to fix engine first before we start send  <em>long-only strategy</em>  to the sky?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dde858d901af22d477d261f' id='5dde858d901af22d477d261f'>
<a href='#5dde858d901af22d477d261f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1574864269000' class='quanto-date posted-at response-posted-at' href='#5dde858d901af22d477d261f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>First of all thank you to Chis Cain. It&#39;s good of you to share your algo. And it&#39;s a very tempting proposition, although it probably needs a little more investigation. Now I am back at my computer I have been running a number of tests with different re-balancing dates, and, as I have always found with this type of algorithm, the differences in performance are worrying.</p>

<p>I have been using the tidied up code kindly provided by Jamie McCorriston un-amended save for the monthly re balance date.</p>

<p>Perhaps using the maximum of 22 days offset from the month end  is foolish - I imagine there are months where there are less than this number of trading days. Nonetheless the results were interesting.</p>

<p>Here are some of the total returns I got by varying the re-balance date:</p>

<p>1574%<br>
455%<br>
1674%<br>
1825%<br>
1477%</p>

<p>Leverage needs looking at - it reaches 2 on occasion with a corresponding net dollar exposure of 200%. Uncomfortable for the lily livered such as myself.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dde85f6901af201b07d2a48' id='5dde85f6901af201b07d2a48'>
<a href='#5dde85f6901af201b07d2a48'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1574864374000' class='quanto-date posted-at response-posted-at' href='#5dde85f6901af201b07d2a48'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Effectively,as I have always felt with these type of strategies, one would be best off hedging one&#39;s bets and split the portfolio into a few different parts, each part using a different re-balance date.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dde8eba55c2860042a50153' id='5dde8eba55c2860042a50153'>
<a href='#5dde8eba55c2860042a50153'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58e2d12a3bfa1b000ae0441b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fd6452e042524ac9f6bbd40c88e5668e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58e2d12a3bfa1b000ae0441b'>Chris Cain</a>
</div>
<a UTCms='1574866618000' class='quanto-date posted-at response-posted-at' href='#5dde8eba55c2860042a50153'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey @Zenothestoic.  Yes I think date_rules.month_end(days_offset=22) doesn&#39;t make much sense.  What happens in the months that have a holiday and less than 22 business days?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dde9a9a55c286004ba501a7' id='5dde9a9a55c286004ba501a7'>
<a href='#5dde9a9a55c286004ba501a7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57a5e05aaf3a4c589d0009ab'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7bdda3882c7b4b607ca34ae9a4029810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57a5e05aaf3a4c589d0009ab'>Peter Harrington</a>
</div>
<a UTCms='1574869658000' class='quanto-date posted-at response-posted-at' href='#5dde9a9a55c286004ba501a7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks to Chris for posting this algorithm.   It would be a good candidate to trade in one&#39;s IRA or another account that is restricted to long-only.  The issue of leverage over 1.00 will have to be solved before I would actually trade this.  The code that I suspect is causing excess leverage is the &quot;GETTING IN&quot; section.  There doesn&#39;t seem to be any consideration of the current positions.  It will add to the complexity, but the bonds/equities should be rebalanced together.  </p>

<p>@Zenothestoic I share your concern with different starting dates, and I have put together a list of the results starting at different times during 2003.  Although the total returns vary by 500% this is due to compounding, and once you adjust for time differences the CAGR is very similar.  I am more concerned with the starting year.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dde9d8c2e34510047dd400b' id='5dde9d8c2e34510047dd400b'>
<a href='#5dde9d8c2e34510047dd400b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1574870412000' class='quanto-date posted-at response-posted-at' href='#5dde9d8c2e34510047dd400b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Peter<br>
Yes, it would be interesting to see what would have happened in the tech crash. But good point on CAGR (and of course DD) being very close.<br>
Mind you the system rode through 2008 very well, but of course each crash is different.</p>

<p>It is likely for instance that a severe drawdown would have occurred in 1987 - no trend following system could have reacted with the swiftness required at that date, certainly not six month MOM or a 50/250 MA crossover.</p>

<p>But it looks very tempting otherwise if a few kinks can be ironed out.</p>

<p>Chris yes - offset = 22 does not make much sense probably. But I always find it difficult to drill down and find out why on these online back testers. Its the sort of stuff I need to have my own data for with which I can fiddle to my heart&#39;s content.</p>

<p>Also I need to check to see whether Q&#39;s standard com and slippage is included.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dde9e31f14386004c2b2e81' id='5dde9e31f14386004c2b2e81'>
<a href='#5dde9e31f14386004c2b2e81'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1574870577000' class='quanto-date posted-at response-posted-at' href='#5dde9e31f14386004c2b2e81'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Peter<br>
Did you have to run those tests one by one or does Q let you automate that sort of testing now?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddea45f4e5433695bf6813c' id='5ddea45f4e5433695bf6813c'>
<a href='#5ddea45f4e5433695bf6813c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574872159000' class='quanto-date posted-at response-posted-at' href='#5ddea45f4e5433695bf6813c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Chris Cain, </p>

<p>The description of the strategy you presented fits my personal investment goal.<br>
Thanks for sharing.<br>
I backtested your original algorithm with line 9 commented. Why cheat myself.<br>
Results metric is good.<br>
When I tried to use order_optimal_portfolio() results got worse.<br>
I checked some positions (Backtest -&gt; Activity -&gt; Positions) and have some questions about your ordering engine:<br>
if TF_filter==False all positions in top_n_by_momentum should be sold or only part of them?<br>
I have seen the number of stock position slowly changing from 20 to 0 during several months in market  downtrend.<br>
Why at initial capital 100000<br>
2003-03-31 there was negative cash 68000 that is leverage 1.68<br>
2007-07-31 there was negative cash 50000  ...<br>
In one of Joakim Arvidsson   <em>long-only strategy</em>  I have seen negative position in bond (-80%) together with 20 stock positions?<br>
May be we need to fix engine first before Guy Fleury start send  <em>long-only strategy</em>  to the sky?</p>

<p>@Peter Harrington,</p>

<p>Are the backtest results you posted from original (Chris Cane) algo or from others?<br>
They have different Trend Filters and Factors.<br>
Original (Chris Cane) algo with date_rules.month_end() has Total Returns 1521.59 %.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddeadde55c2860042a50275' id='5ddeadde55c2860042a50275'>
<a href='#5ddeadde55c2860042a50275'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55eefc2af269c592d80008a9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8985b490c95e135c2bbcd7d1a0dce16b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55eefc2af269c592d80008a9'>Jamie McCorriston</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1574874590000' class='quanto-date posted-at response-posted-at' href='#5ddeadde55c2860042a50275'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy Fleury: Multiple participants in this thread have expressed frustration with the sharing of screenshots instead of attaching a backtest. Please refrain from sharing screenshots built on top of the shared work in this thread. You are entitled to keep your work private, so if you don&#39;t want to share, that&#39;s fine. But please don&#39;t share screenshots in this thread as it seems the intent of the thread is to collaborate on improving the algorithm.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5ddeb38af1438600402b2f4f' id='5ddeb38af1438600402b2f4f'>
<a href='#5ddeb38af1438600402b2f4f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1574876042000' class='quanto-date posted-at response-posted-at' href='#5ddeb38af1438600402b2f4f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Jamie, understood. I have erased all my posts in this thread since my notes without screenshots become simple opinions without corroborating evidence.</p>

<p>(Added)</p>

<p>@Jamie, as you said: I have no obligation to share anything. I thought it was a forum where anything innovative or reasonably pertaining to the subject at hand would have been more welcomed in whatever form it was presented. My bad. </p>

<p>For those few that might be interested, this thing can exceed 30,000%. But, that is now just an opinion. Can&#39;t show a screenshot to corroborate or the program itself. It is nonetheless a 40% CAGR over the 16+ years giving a total profit of some $2.3 billion.</p>

<p>Of note, Jim Simons (Medallion Fund) has managed a 39% CAGR after fees for years. It required a 66% CAGR to make that happen. The fees were 5/44, a little bit more than the usual hedge fund 2/20. In case some are looking for objectives.</p>

<p>For me, this strategy is still not enough even though it could be pushed higher. I have other strategies that can go further without depending on what I consider an internal procedural bug. But, a program bug, if it is consistent, dependable and profitable, then it could come to be considered as some added “feature”.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddeb9a885a48b6b3125b3f6' id='5ddeb9a885a48b6b3125b3f6'>
<a href='#5ddeb9a885a48b6b3125b3f6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574877608000' class='quanto-date posted-at response-posted-at' href='#5ddeb9a885a48b6b3125b3f6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>No strategy change here -- just stylistic change (working off Jamie McCorriston&#39;s version). Moved the selection logic out of the rebalance function and into pipeline via a progressive mask, thinking it might be faster and that some might be more accustomed to doing the filtering via pipeline masks.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddebd4ff1438600462b2fb5' id='5ddebd4ff1438600462b2fb5'>
<a href='#5ddebd4ff1438600462b2fb5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574878543000' class='quanto-date posted-at response-posted-at' href='#5ddebd4ff1438600462b2fb5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Quality Companies in an Uptrend (original by Chris Cane) Long-Short Count and TF Check with line 9 commented.<br>
You may see the number of stock position slowly changing from 20 to 0 during several months in market downtrend.</p>

<p>@Chris Cane,<br>
Is it by design?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddec5f485a48b630025b475' id='5ddec5f485a48b630025b475'>
<a href='#5ddec5f485a48b630025b475'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574880756000' class='quanto-date posted-at response-posted-at' href='#5ddec5f485a48b630025b475'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Quality Companies in an Uptrend (original by Chris Cane) Leverage.</p>

<p>The best ways to fix the problem :</p>

<p>Use order_optimal_portfolio()<br>
Change execution time.<br>
Use @Peter Harrington recommendation <em>the bonds/equities should be rebalanced together.</em>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddec84455c286004ba50348' id='5ddec84455c286004ba50348'>
<a href='#5ddec84455c286004ba50348'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58e2d12a3bfa1b000ae0441b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fd6452e042524ac9f6bbd40c88e5668e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58e2d12a3bfa1b000ae0441b'>Chris Cain</a>
</div>
<a UTCms='1574881348000' class='quanto-date posted-at response-posted-at' href='#5ddec84455c286004ba50348'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Vladimir, Yes this is by design.</p>

<p>Here is the logic:</p>

<p>If the trend following filter is not passed (6-month momentum is negative, 50SMA&lt;200SMA, whatever) then we sell stocks that fall out of our final buy list (in the orginal algo, that was stocks with best ROE then best momentum).  </p>

<p>Since the TF filter is not passed, those stocks are not replaced.</p>

<p>If the TF filter is not passed and a stock remains in our final buy list, it is held.</p>

<p>The design is to scale out of positions if the market is trend down instead of get out of all of them at once.  This is evident in the graphs you posted.</p>

<p>Thanks for the great question,<br>
Chris  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddeda2885a48b2fda25b46a' id='5ddeda2885a48b2fda25b46a'>
<a href='#5ddeda2885a48b2fda25b46a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d3c56369eca8e31e2d692a3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b07bccab7e1bc10792fc86324865b167?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d3c56369eca8e31e2d692a3'>Steve Jost</a>
</div>
<a UTCms='1574885928000' class='quanto-date posted-at response-posted-at' href='#5ddeda2885a48b2fda25b46a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is a version that mostly fixes the leverage problem.</p>

<p>The starting point is the modified code posted by Viridian Hawk.</p>

<p>There is a problem in 2006-2007 time frame where a security BR is purchased but then is not able to be sold for many months.<br>
Eventually the sell order does fill a year later at exactly 4 pm (I wonder if the system forced the sale?)<br>
This led to a problem with bonds going short, I think because the max number of stock positions was exceeded.  </p>

<p>Anyway I made the following changes:</p>

<p>Changed the bond trading logic so that the allocation would not go negative.</p>

<p>Changed the stock trading logic so that it re-balances winning positions that carry forward to the next month.    Maybe better would be to let the winners run and reduce the size of new positions constrained by available cash,  but it&#39;s a bit more complicated to implement.</p>

<p>Changed the stock trading logic so that it re-balances high quality-momentum stock positions that are held when the trend is negative.  I think this  helps to balance the bond/stock allocation to reduce leverage during these times.  </p>

<p>I was NOT able to find a way to avoid buying BR, so there still is slightly elevated leverage during the 2006-2007 time frame.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddee8f485a48b2fda25b506' id='5ddee8f485a48b2fda25b506'>
<a href='#5ddee8f485a48b2fda25b506'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1574889716000' class='quanto-date posted-at response-posted-at' href='#5ddee8f485a48b2fda25b506'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@steve</p>

<p>I tried your algo - It is now always holding one extra position. Try recording number of positions and you will see that they are 21 instead of 20. Not sure what is going on. Perhaps it not selling Bond during uptrend and keeping it in portfolio. This might be a factor which is reducing returns. Not sure though.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddef2a585a48b25d725b5be' id='5ddef2a585a48b25d725b5be'>
<a href='#5ddef2a585a48b25d725b5be'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574892197000' class='quanto-date posted-at response-posted-at' href='#5ddef2a585a48b25d725b5be'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The 2.5 mo/1yr crossover filter on SPY is the weakest point in this strategy.  It saves the strategy during 2008. So it&#39;s basically a switch designed to in hindsight save the strategy during one historical market catastrophe. Who knows if it will work in the future -- we don&#39;t have enough data points to draw any statistically meaningful conclusions on that signal and how it correlates to &quot;quality.&quot; So, that bit of the code is likely an overfit.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddefd2a85a48b4aef25b573' id='5ddefd2a85a48b4aef25b573'>
<a href='#5ddefd2a85a48b4aef25b573'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574894890000' class='quanto-date posted-at response-posted-at' href='#5ddefd2a85a48b4aef25b573'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Steve Jost,</p>

<p><em>To avoid buying BR</em>  you may try  this code</p>

<pre><code>from quantopian.pipeline.filters import Q500US, StaticAssets

universe = Q500US() &amp; ~StaticAssets(symbols(&#39;BR&#39;))

</code></pre>

<p>I think this will not solve the problem completely.</p>

<p>@Nadeem,</p>

<p>You are right, in Steve algo  IEF exist all the time at least at the beginning.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddefe33452dc870c2ab72c1' id='5ddefe33452dc870c2ab72c1'>
<a href='#5ddefe33452dc870c2ab72c1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1574895155000' class='quanto-date posted-at response-posted-at' href='#5ddefe33452dc870c2ab72c1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>&quot;So it&#39;s basically a switch designed to in hindsight save the strategy during one historical market catastrophe.&quot;</p>

<p>Then cut it out. The strategy is still far from shabby without it and you have the comfort that it is no longer curve fit. The drawdown has increased from 20 to 40% in the attached test. Still way lower than the S&amp;P DD in 2008.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddf33742e34510041dd46ad' id='5ddf33742e34510041dd46ad'>
<a href='#5ddf33742e34510041dd46ad'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574908788000' class='quanto-date posted-at response-posted-at' href='#5ddf33742e34510041dd46ad'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Jamie McCorriston,</p>

<p>Can you advise on how to make this exclusion filter work?</p>

<pre><code>universe = Q500US() &amp;~StaticAssets(symbols(&#39;BR&#39;,&#39;PD&#39;))  
</code></pre>

<p>2006-04-20 13:00 WARN Your order for -111 shares of BR failed to fill by the end of day and was canceled.<br>
2006-05-22 13:00 WARN Your order for -111 shares of BR failed to fill by the end of day and was canceled.<br>
2006-06-22 13:00 WARN Your order for -111 shares of BR failed to fill by the end of day and was canceled.<br>
2006-07-21 13:00 WARN Your order for -111 shares of BR failed to fill by the end of day and was canceled.<br>
2006-08-23 13:00 WARN Your order for -111 shares of BR failed to fill by the end of day and was canceled.<br>
2006-09-21 13:00 WARN Your order for -111 shares of BR failed to fill by the end of day and was canceled.<br>
2006-10-23 13:00 WARN Your order for -111 shares of BR failed to fill by the end of day and was canceled.<br>
2006-11-21 13:00 WARN Your order for -111 shares of BR failed to fill by the end of day and was canceled.<br>
2006-12-20 13:00 WARN Your order for -111 shares of BR failed to fill by the end of day and was canceled.<br>
2007-01-23 13:00 WARN Your order for -111 shares of BR failed to fill by the end of day and was canceled.<br>
2007-02-20 13:00 WARN Your order for -111 shares of BR failed to fill by the end of day and was canceled.<br>
2007-03-22 12:30 WARN Cannot place order for PD, as it has de-listed. Any existing positions for this asset will be liquidated on 2007-03-22 00:00:00+00:00.<br>
2007-03-22 13:00 WARN Your order for -111 shares of BR failed to fill by the end of day and was canceled.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddf45b9f14386687f2b31cb' id='5ddf45b9f14386687f2b31cb'>
<a href='#5ddf45b9f14386687f2b31cb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d3c56369eca8e31e2d692a3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b07bccab7e1bc10792fc86324865b167?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d3c56369eca8e31e2d692a3'>Steve Jost</a>
</div>
<a UTCms='1574913465000' class='quanto-date posted-at response-posted-at' href='#5ddf45b9f14386687f2b31cb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Vladimir,  What are the mods?  Will you post the algo?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddf888cd09789004124c972' id='5ddf888cd09789004124c972'>
<a href='#5ddf888cd09789004124c972'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574930572000' class='quanto-date posted-at response-posted-at' href='#5ddf888cd09789004124c972'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Vladimir, @Jamie, looks like those stocks might have been halted trading or delisted around that time?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddfd13bd09789004424cb9f' id='5ddfd13bd09789004424cb9f'>
<a href='#5ddfd13bd09789004424cb9f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1574949179000' class='quanto-date posted-at response-posted-at' href='#5ddfd13bd09789004424cb9f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Vladimir, be ready to add to the list as you increase the number of stocks to be treated.</p>

<pre><code>universe = Q1500US() &amp; ~StaticAssets(symbols(&#39;CE&#39;, &#39;CFBX&#39;, &#39;DL&#39;, &#39;GPT&#39;, &#39;INVN&#39;, &#39;WLP&#39;, &#39;ADVP&#39;, &#39;IGEN&#39;, &#39;MME&#39;, &#39;MWI&#39;))  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddfd77f452dc814a0ab71fc' id='5ddfd77f452dc814a0ab71fc'>
<a href='#5ddfd77f452dc814a0ab71fc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574950783000' class='quanto-date posted-at response-posted-at' href='#5ddfd77f452dc814a0ab71fc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Why are you guys introducing lookahead bias by filtering specific stocks from the universe?  Stocks get halted and delisted all the time -- it&#39;s just part of trading. If you have found evidence of data errors, perhaps best to just report them to Quantopian so they can fix them.  Otherwise, I think it&#39;s best to make a strategy&#39;s logic robust enough that it doesn&#39;t trip up when positions get halted or delisted.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ddfee4d952f69003f083fb5' id='5ddfee4d952f69003f083fb5'>
<a href='#5ddfee4d952f69003f083fb5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1574956621000' class='quanto-date posted-at response-posted-at' href='#5ddfee4d952f69003f083fb5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Viridian, I these cases, stocks are delisted, halted or have gone bankrupt, but their positions stay open meaning that your bet is still on the table and might not be accounted for in the final result. Ignoring them should liberate those bets. A quick and dirty method, I agree. But in development, it becomes acceptable since your interest is at a much higher level than solving trivia.</p>

<p>As I have said before, you can push this strategy beyond 30,000% total return. You will be able to do so by putting more stocks at play and improving on the strategy design. </p>

<p>Leaving in those delisted stocks will require added code to track them yourself and somehow get rid of them as you go (in order to be more realistic). But then again, Quantopian could make it that their program takes care of it by automatically closing those positions as they appear. But, they will have to distinguish between halted stocks and permanently delisted.</p>

<p>(ADDED)</p>

<p>@Viridian, even if you put an exclude list, some come back anyway. Go figure.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de00ed42e34510041dd4e81' id='5de00ed42e34510041dd4e81'>
<a href='#5de00ed42e34510041dd4e81'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1574964948000' class='quanto-date posted-at response-posted-at' href='#5de00ed42e34510041dd4e81'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy</p>

<p>Guy I can understand that you have chosen not to share code on this forum but I am intrigued by the idea of a 30,000% return since 2003  Would you consider telling us exactly how it is achieved? I am assuming you use no leverage?</p>

<p>Can you also tell us the max DD and volatility on the system extended to these lofty levels? </p>

<p>I would love to invest for that sort of return, but lack those sort of skills.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de03e45cb9a2c00411653ab' id='5de03e45cb9a2c00411653ab'>
<a href='#5de03e45cb9a2c00411653ab'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574977093000' class='quanto-date posted-at response-posted-at' href='#5de03e45cb9a2c00411653ab'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Chris Cane, </p>

<p>it looks like I was able to take the leverage in your algorithm to an acceptable level using order_optimal_portfolio().<br>
I hope you will comment on the consistency of the backtest results with the design before I post the code snippet.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de03ebcb8ccfc0041f2c6a0' id='5de03ebcb8ccfc0041f2c6a0'>
<a href='#5de03ebcb8ccfc0041f2c6a0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1574977212000' class='quanto-date posted-at response-posted-at' href='#5de03ebcb8ccfc0041f2c6a0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Long-Short Count, and TF Check.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de15054c6b742004aa206b4' id='5de15054c6b742004aa206b4'>
<a href='#5de15054c6b742004aa206b4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55eefc2af269c592d80008a9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8985b490c95e135c2bbcd7d1a0dce16b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55eefc2af269c592d80008a9'>Jamie McCorriston</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1575047252000' class='quanto-date posted-at response-posted-at' href='#5de15054c6b742004aa206b4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Vladimir: The <code>symbols</code> method assumes you are asking for the asset whose ticker symbols are <code>BR</code> and <code>PD</code> as of today. So the <code>~StaticAssets(symbols(&#39;BR&#39;, &#39;PD&#39;))</code> filter is excluding two stocks that picked up the tickers <code>BR</code> and <code>PD</code> in 2007 and 2019, respectively. You can specify a reference date with <a href="https://www.quantopian.com/docs/api-reference/algorithm-api-reference#quantopian.algorithm.set_symbol_lookup_date">set_symbol_lookup_date</a> or use <code>sid</code> to specify the assets that delisted in 2006.</p>

<p>That said, I agree with Viridian Hawk. When an asset gets delisted, the backtester automatically closes out any shares held in that asset, 3 days after the delist date, at the last known price of the asset. It&#39;s probably best to let the backtester handle that position so as to avoid lookahead bias as much as possible.</p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5de18826c09faa0041c06dd9' id='5de18826c09faa0041c06dd9'>
<a href='#5de18826c09faa0041c06dd9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1575061542000' class='quanto-date posted-at response-posted-at' href='#5de18826c09faa0041c06dd9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Jamie McCorriston</p>

<p>set_symbol_lookup_date(&#39;2006-01-01&#39;) worked but it costs  30% of profit.</p>

<p>Thank you.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de1b59e08b8c6004a254e0b' id='5de1b59e08b8c6004a254e0b'>
<a href='#5de1b59e08b8c6004a254e0b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1575073182000' class='quanto-date posted-at response-posted-at' href='#5de1b59e08b8c6004a254e0b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p><strong>Properties of This Trading Strategy</strong></p>

<p>I got interested in the above strategy, first for its longevity (16+ years) and second, for its built-in alpha.</p>

<p>My first steps are always to see the limitations and then see if I can improve the thing or not. The initial strategy used \(\$\)100k and 20 stocks putting its initial bet size at \(\$\)5k. </p>

<p>A portfolio will have to live by the following payoff matrix equation: $$\mathsf{E}[\hat F(T)] = F_0 + \sum_1^n (\mathbf{H} \cdot \Delta \mathbf{P}) = F_0 \cdot (1 +g(t) - exp_t(e))^t$$The total return on the original scenario was 1551.58\(\%\) giving a total return of \(\$\)1,521,580, it surely demonstrated that even with 16+ years it did not get that far. Nonetheless, it is in CAGR terms, a 17.64\(\%\) compounded rate over the period. It starts to be interesting since it does outperform the majority of its peers. See the majority at a 10.00\(\%\) CAGR or less. Therefore, we could say there is approximately a 7.6\(\%\) alpha in the initial design.</p>

<p>The structure of the program can allow more. First, the design is scalable. It was my first acid test. I upped the initial stake to \(\$\)10M. But this makes the bet size jump to \(\$\)500,000 per initial bet. Due to the structure of the scheduled rebalance, these bets would catch most of their returns from common return (about 70\(\%\)) and not from specific returns. But it did generate alpha over and above its benchmark (SPY). And that was the point of interest.</p>

<p>I raised the number of stocks to be treated in order to reduce the bet size knowing that doing so would reduce the average portfolio CAGR. The reason is simple, the stocks were ranked by expected performance levels, and the more you took in the more the lower-ranked stocks with their lower expected CAGR would tend to lower the overall average. This could be compensated elsewhere and could even help produce higher returns.</p>

<p>There is a slight idiosyncracy in the original program which made it have a 1.04 average gross leverage. Its cost would have been about \(0.04 \times 0.04 = 0.0016 \) should we consider IB leveraging fee for instance. A negligible effect on the 17.64\(\%\) CAGR.</p>

<p><strong>The Basic Equation</strong></p>

<p>The equation illustrated above is all you can play with. However, when you break it down into its components, the only thing that matters in order to raise the overall CAGR of about any stock trading strategy is \(\mathbf{H}\), the behavior of the trading strategy itself. It is the how you will handle and manage the ongoing inventory over time.</p>

<p>The price matrix \(\mathbf{P}\) is the same for everyone. In this case, the original stock universe was Q500US. To get a better selection, I jumped to Q1500US since my intention was to raise the number of stocks to 100 and over. The \(\Delta \mathbf{P}\) is simply the price variation from period to period, and therefore, is also the same for everyone. The differences will come from the holding matrix \(\mathbf{H}\) which is the game at play. If the inventory is at zero, there is no money coming in nor is there any money going out. To win, you have to play, and that is where you also risk to lose.</p>

<p>The first chart I presented had an overall 2,405.92\(\%\) total return on a \(\$\)10M initial stake with 40 stocks. That resulted in overall profits of \(\$\)240M over the 16+ years. Already over 100 times the original trading script. Most of it coming from the 100 times the initial capital demonstrating the program&#39;s scalability.</p>

<p>By accepting a marginal increase in volatility and drawdown, I raised the bar to 3,803.87\(\%\) total return which is a 24.26\(\%\) CAGR equivalent for the period.</p>

<p><strong>@Joakim&#39;s Version of The Program</strong></p>

<p>I next switched to Joakim&#39;s version of the program because it accentuated an idiosyncracy of the original program and pushed on involuntary leveraging. But I did not see it as a detriment. The more I studied the impact the more I started to appreciate this &quot;feature&quot; even though it was not intended. If a program anomaly can become persistent, dependable, and can generate money, it might stop to be considered a &quot;potential bug&quot; and be view as an &quot;added feature&quot;.</p>

<p>Using Joakim&#39;s program version as base, I push on some of the buttons, increased the strategy&#39;s stock count again, changed the trading dates and timing, make the strategy more responsive to market swings and tried to capture more trades and a higher average net profit per trade. The impact was to raise the overall total return to 10,126.6\(\%\). On the same \(\$\)10M this translated to a 31.74\(\%\) CAGR with total profits in excess of \(\$\)1B. It is a far cry from the original strategy.</p>

<p>I kept on improving the design by adding new features and more stocks to be traded with result that the total return jumped to 13,138.85\(\%\) which is a 33.8\(\%\) CAGR over the 16+ years. To achieve those results, I also put the &quot;Financials&quot; back in play since there was no way of knowing in 2003 that the financial crisis would be unfolding and be as bad as it was.</p>

<p>But, you could do even more by accepting a little bit more of leverage as long as the strategy would be able to pay for it all, and remain consistent in its general behavior. Thereby exploiting the anomaly found in Joakim&#39;s and the original strategy. Here you could really push and not by pushing that much either. A leverage of 1.4 was sufficient to bring the total return to 32,143.38\(\%\) with a total profit of \(\$\)3.2B and a CAGR of 41.1\(\%\). Quantopian once said they were ready to leverage some strategies up to 6 times. So, 1.4 might look as not that high especially if the trading strategy can afford it.</p>

<p>You could do even more by accepting a leverage of 1.5, raising the total return to 50,921.98\(\%\) with a CAGR equivalent of 45.0\(\%\). In total profit that would be \(\$\)5.09B.</p>

<p>At 1.5 leverage, you would be charge on the 0.5 excess, and at IB&#39;s rate it would give: \(0.5 \times 0.04 = 0.02\). Thereby reducing the 45.0\(\%\) CAGR to 43.0\(\%\). Still costing some \(\$\)1.056B over the period and leaving some \(\$\)4.045B as net total profit in the account.</p>

<p>A prior version to the one above tried \(\$\)20M as initial stake and achieved a 43,795.04\(\%\) total return. It could have been jacked up higher, but it was not my main interest at the time. Nonetheless, in CAGR terms that was 43.79\(\%\) and in total profits \(\$\)8.76B.</p>

<p>I think the strategy could be improved even further, but I have not tried. My next steps would be to scale it down now that I know how far it can go and install better protective measures which would tend to increase overall performance while reducing drawdowns.</p>

<p>As part of my acid tests, I want to know how far a trading strategy can go. Therefore, I push on the strategy&#39;s pressure points in the first equation knowing that the inventory management procedures are where all the efforts should be concentrated. Once you know what your trading strategy can do, it is all easy to scale it down to whatever level you feel more comfortable, that it be in using lower leverage, reducing overall CAGR, or installing more downside protection. It becomes a matter of choice. </p>

<p>But once you have pushed the limits of your trading strategy, you at least know that those limits could be reached and even if you scale down a bit, you also know that your trading strategy could scale up it if you desired to. It would not come as a surprise, if at all, you would have planned for higher performance and you would know how you could deliver if need be.</p>

<p>It is all so simple, it is all in the first equation above. It is how you inject new equations to the mix that you can transform your trading strategy. In this case, the above equation was changed to:$$\mathsf{E}[\hat F(T)] = F_0 + \sum_1^n (\mathbf{H}\cdot (1+\hat g(t)) \cdot \Delta \mathbf{P}) = F_0 \cdot (1 +g(t) - exp_t(e))^t$$where \(\hat g(t)\) is partly the result of a collection of functions of your own design.</p>

<p>I would usually have shown screenshots as corroborating evidence of the numbers presented above. But, it appears that such charts are not desired in this forum. </p>

<p>To me, it transforms all the numbers above as claims, unsubstantiated claims at best since no kind of evidence is presented to support them. They become like just opinions. Nonetheless, I do have those screenshots on my machine, but they will stay private for the moment.</p>

<p>Of note, the explanations for these equations which can be considered innovative for what they can do, even if they have been around for quite a while, can be seen all over my website.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de2a14d15af4a752353d164' id='5de2a14d15af4a752353d164'>
<a href='#5de2a14d15af4a752353d164'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1575133517000' class='quanto-date posted-at response-posted-at' href='#5de2a14d15af4a752353d164'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Changed a single number in the last program that generated the 50,921.98\(\%\) with a CAGR equivalent of 45.0\(\%\). It resulted in a total return of 76,849.31\(\%\). A 48.8\(\%\) CAGR. In total profits: \(\$\)7.68B. I will still need to deduct the leveraging fees which will exceed \(\$\)1.B when compared to the previous scenario.</p>

<p>For a single digit, it increased the total outcome from \(\$\)5.09B to \(\$\)7.68B. Now that is a digit that is worthwhile... Sorry, no screenshot to display as some kind of evidence that those numbers were actually reached. But, they still happened.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de2a3a114f6e60b47226ed9' id='5de2a3a114f6e60b47226ed9'>
<a href='#5de2a3a114f6e60b47226ed9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575134113000' class='quanto-date posted-at response-posted-at' href='#5de2a3a114f6e60b47226ed9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Guy</p>

<p>In broad terms the above tells us that you increased the portfolio size from 500 to 1500 stocks and that leverage went to 1.4. But little else.</p>

<p>I can understand that the cost of leverage would not be high at current interest rates and that indeed such level of leverage is modest. As to Q&#39;s 6x leverage that of course was to be used on their &quot; zero everything&quot; strategy.  I have never understood Quantopian&#39;s approach to be honest and I refuse to believe that such neutrality would hold under all conditions.  I suspect it would get its comeuppance at some stage as do most strategies. But what do I know, to be honest.</p>

<p>The real problem people have with your posts is not the screenshots themselves but the lack of detail they contain as to how the results were achieved. And your above post does the same (to some extent!)</p>

<p>I now understand the increased portfolio size and the leverage- for which many thanks. But of course most of the detail is still hidden. And it is the detail people would like you to share. Which I also would like you to share.  If you would be willing of course.</p>

<p>You mention a starting capital of $20m but I&#39;m not sure that a huge starting capital is so relevant for stocks. With futures I can readily understand it.  The contract sizes are enormous for the humble retail investor such as you or I.</p>

<p>But with stocks, even 1500 of them (whittled down to 100, or 50 or whatever) its a different matter surely. Stocks are not all the price of Berkshire Hathaway and the lot size is not huge, so surely you could trade small capital up to dizzy levels?</p>

<p>If you would like to share more details I would be happy to put up some capital to try and shoot the lights out if I can make sense of it.  Perhaps you might prefer to discuss this in private.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de2d08601cbcf004e259282' id='5de2d08601cbcf004e259282'>
<a href='#5de2d08601cbcf004e259282'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb4fc8571ef9572db85c0af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a8d078cb83e513809bab0e31eabfa4fc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb4fc8571ef9572db85c0af'>Dan Whitnable</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1575145606000' class='quanto-date posted-at response-posted-at' href='#5de2d08601cbcf004e259282'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Great post. @Chris Cain . Thank you for sharing your original algo! Also, kudos to everyone pitching in with comments and improvements. I&#39;ve never felt quant trading to be a zero-sum game. Publishing, peer review, and building on previous ideas has worked in the sciences and serves as a model for moving from &#39;quant arts&#39; to &#39;quant science&#39;. A rising tide can raise all ships. </p>

<p>Anyway, in that spirit, here is a version of the original algo with several changes. The goal was 1) to separate the data from the logic  2) separate the security selection logic from order execution, and 3) use <code>order_optimal_portfolio</code>. This was in an effort to make modifications easier, add flexibility, and allow for using the various optimize constraints.</p>

<p>While the logic is faithful to the original, the execution differs a bit. The positions are the same however, the quantity of shares purchased vary by a few at times, which seems to account for the performance numbers not matching exactly.  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5de2e28108b8c6431e254e2a' id='5de2e28108b8c6431e254e2a'>
<a href='#5de2e28108b8c6431e254e2a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575150209000' class='quanto-date posted-at response-posted-at' href='#5de2e28108b8c6431e254e2a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Guy</p>

<p>I took a look at your paper here: <a href="https://alphapowertrading.com/papers/AlphaPowerImplementation.pdf" rel="nofollow">https://alphapowertrading.com/papers/AlphaPowerImplementation.pdf</a></p>

<p>To we who are not privy to the underlying methods, your formulas provide no real information. You mention trend following, re-investment of profits and covered calls. </p>

<p>And your formulas state that compounding your strategies will lead to outsized profits.</p>

<p>But the problem people here find with your posts is that we all know the benefits of compounding. What we do not know is how you achieve that compounding.</p>

<p>Much of your website repeats this basic message. But nowhere do you state how you achieve that compounding.   Except to mention &quot;boosters and enhancers&quot; which are never explicitly explained.</p>

<p>I think you would achieve much kudos here by providing a precise declaration of exactly what these boosters and enhancers are.  And if you would be willing to provide the code here then that would be a great step forward.</p>

<p>Thanks and regards  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de3067f01cbcf0045259451' id='5de3067f01cbcf0045259451'>
<a href='#5de3067f01cbcf0045259451'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1575159423000' class='quanto-date posted-at response-posted-at' href='#5de3067f01cbcf0045259451'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Dan - Thank You very much for posting the familiar version of the code.</p>

<p>I have a question though - in the record pane in your algo - it seems like the leverage is always at 1.05. Please check Stock weight + Bond weight. It seems like the bond of 0.05 is always in portfolio.  Is it intentional? If not, how we can make the leverage at 1.00?</p>

<p>Thank You in advance for your help.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de3164766a80500446eeef5' id='5de3164766a80500446eeef5'>
<a href='#5de3164766a80500446eeef5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d3c56369eca8e31e2d692a3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b07bccab7e1bc10792fc86324865b167?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d3c56369eca8e31e2d692a3'>Steve Jost</a>
</div>
<a UTCms='1575163463000' class='quanto-date posted-at response-posted-at' href='#5de3164766a80500446eeef5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Nadeem - You could make the following change to reduce the leverage from 1.04 to 1.00.<br>
Comment out the first line and replace it with the second line.</p>

<p>bond_weight = max(1.0 - context.stock_weights.sum(), stock_weight) / len(context.BONDS)<br>
bond_weight = max(1.0 - context.stock_weights.sum(), 0) / len(context.BONDS)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de31f7ae0f5934467ec76c9' id='5de31f7ae0f5934467ec76c9'>
<a href='#5de31f7ae0f5934467ec76c9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb4fc8571ef9572db85c0af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a8d078cb83e513809bab0e31eabfa4fc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb4fc8571ef9572db85c0af'>Dan Whitnable</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1575165818000' class='quanto-date posted-at response-posted-at' href='#5de31f7ae0f5934467ec76c9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Nadeem   Yes, @Steve Jost&#39;s code above will reduce the &#39;target leverage&#39; to 1.0. It will let the bond weight go to zero. In the original algo, the bond weight was always a minimum of .05 (specifically 1.0 / context.TARGET_SECURITIES) and the leverage would go to 1.05. This was a &#39;feature&#39; of the original algo so I left it in. It actually helps the sharpe ratio and returns.</p>

<p>Even with this change the leverage spikes to 1.05 in 2006. This is because the weights are set assuming all the orders fill. During that time, the algo tries to sell BR but cannot. The algo essentially &#39;over buys&#39; and the leverage goes above 1.0. The way to keep that from happening is to place all the sell orders. Cancel any open orders after a set time. Then place buys equal to the amount of cash left. Basically don&#39;t buy until all the sell orders fill or are canceled. </p>

<p>Good catch.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5de326f69862930043580a10' id='5de326f69862930043580a10'>
<a href='#5de326f69862930043580a10'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1575167734000' class='quanto-date posted-at response-posted-at' href='#5de326f69862930043580a10'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Dan, </p>

<p>You probably took as template for trading logic not the original @Chris Cane algo but somebody else together with its bugs which create<br>
Max 21-23 positions, leverage 1.05 - 1.1...  (see attached notebook)</p>

<p>Not selling BR during 11 month in 2006-2007 is more likely engine problem.</p>

<p>What is this for?  </p>

<pre><code>set_slippage(slippage.FixedSlippage(spread = 0.0))  
</code></pre>

<p>Try to do the same with the original @Chris Cane algo  trading logic .</p>

<p>I solved more or less everything except BR in 11 lines trade ().</p>

<p>PS. I will attach backtest when Quantopian let me to do that.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de3421266a80500416ef043' id='5de3421266a80500416ef043'>
<a href='#5de3421266a80500416ef043'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1575174674000' class='quanto-date posted-at response-posted-at' href='#5de3421266a80500416ef043'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here are the results :</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de3561a66a80500416ef0f3' id='5de3561a66a80500416ef0f3'>
<a href='#5de3561a66a80500416ef0f3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1575179802000' class='quanto-date posted-at response-posted-at' href='#5de3561a66a80500416ef0f3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@vladimir</p>

<p>these are some crazy coding skills. you have shrinked the original code from 90+ lines to 38 lines. &amp; yet improved the performance. Awesome work. Great to have you here and learn from you.</p>

<p>I have one question for you. In the algo posted by Joakim 4 days ago with 2811% return. What is the purpose of mask=universe in the mean_over_std factor? Isn&#39;t there will be a mismatch if we rank other factor without mask and rank mean_over_std with mask? and why does even it matter if we have mask in pipeline screen.</p>

<p>I am asking because if we remove mask=universe from line 90, the result are hugely different. Please see the attached backtest. the result with mask are somewhat similar to what Joakim had. (even though little different because of leverage fix in attached version).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de38435986293672a5809cb' id='5de38435986293672a5809cb'>
<a href='#5de38435986293672a5809cb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1575191605000' class='quanto-date posted-at response-posted-at' href='#5de38435986293672a5809cb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Nadeem</p>

<p>rank () -&gt; security factor rating among all traded securities in the Quantopian database</p>

<p>rank(mask=Q500US()) -&gt; rank security factor among Q500US() </p>

<p>Example:</p>

<p>In my code I have changed only ranking in make_pipeline(), added <em>mask = m</em> to all fundamentals factors,</p>

<p>And got some improvements in metrics.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de386ee01cbcf00452597e0' id='5de386ee01cbcf00452597e0'>
<a href='#5de386ee01cbcf00452597e0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1575192302000' class='quanto-date posted-at response-posted-at' href='#5de386ee01cbcf00452597e0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thank You @valdimir. I am still confuse as to why it should matter when we already have mask in pipeline. we should still end up with those stocks in pipeline which are in Q500US because we have mask in pipeline. Cant get me head around it. Could you please help me understand it?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de3ae7a66a805003e6ef38d' id='5de3ae7a66a805003e6ef38d'>
<a href='#5de3ae7a66a805003e6ef38d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5929c5f4a76c22000d329d92'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5ec18483d35ccb497ca800f820998851?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5929c5f4a76c22000d329d92'>Leo M</a>
<span class='badge medal'></span>
</div>
<a UTCms='1575202426000' class='quanto-date posted-at response-posted-at' href='#5de3ae7a66a805003e6ef38d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Dan, very well said &quot;A rising tide can raise all ships&quot;. I still remember one of your earlier quotes &quot;Communities are built from collaboration, not competition&quot;.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de3b58bc3d18c0041db8ba8' id='5de3b58bc3d18c0041db8ba8'>
<a href='#5de3b58bc3d18c0041db8ba8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58fe234c1b55a91d762f2654'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/60c9fdfbf06116fdac7f36cf352cc34c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58fe234c1b55a91d762f2654'>Tien Duy Vo</a>
</div>
<a UTCms='1575204235000' class='quanto-date posted-at response-posted-at' href='#5de3b58bc3d18c0041db8ba8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>It&#39;s an interesting strategy. However, it did not outperform the SP500 in the last 2 years. Do you guys think, that the alpha is gone?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de3dfe866a8057ef26eee3d' id='5de3dfe866a8057ef26eee3d'>
<a href='#5de3dfe866a8057ef26eee3d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d3c56369eca8e31e2d692a3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b07bccab7e1bc10792fc86324865b167?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d3c56369eca8e31e2d692a3'>Steve Jost</a>
</div>
<a UTCms='1575215080000' class='quanto-date posted-at response-posted-at' href='#5de3dfe866a8057ef26eee3d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Valdimir - I agree with @Nadeem - mad coding skills. Glad you found a workaround to not being able to post backtests. </p>

<p>@Nadeem - Thanks for pursuing the issue of mask in pipeline with @Valdimir.<br>
Using rank(mask=universe or sub-universe) turns out to be very important, otherwise ranks from the larger universe can skew the factor weightings.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de3e542c3d18c0044db8d49' id='5de3e542c3d18c0044db8d49'>
<a href='#5de3e542c3d18c0044db8d49'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5c027cfdc361a8004c82b40d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5016f6401ab96f40707f1db9883b85d1?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5c027cfdc361a8004c82b40d'>Wordsworthtopian</a>
</div>
<a UTCms='1575216450000' class='quanto-date posted-at response-posted-at' href='#5de3e542c3d18c0044db8d49'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Very interesting! Thanks for posting. For measuring &quot;quality,&quot; it would be good to see how adding (i) positive insider buying activity and (ii) positive analyst ratings affect the results.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de4984cc3d18c004ddb92ce' id='5de4984cc3d18c004ddb92ce'>
<a href='#5de4984cc3d18c004ddb92ce'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1575262284000' class='quanto-date posted-at response-posted-at' href='#5de4984cc3d18c004ddb92ce'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>Do you guys think, that the alpha is gone?</p>
</blockquote>

<p>Yes.  Significant drop-off in alpha from 2014 onwards.  I would think these factors have been discovered and arbitraged out of the market.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de4e9dbc1fd6d0044377768' id='5de4e9dbc1fd6d0044377768'>
<a href='#5de4e9dbc1fd6d0044377768'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575283163000' class='quanto-date posted-at response-posted-at' href='#5de4e9dbc1fd6d0044377768'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>&quot;Yes. Significant drop-off in alpha from 2014 onwards. I would think these factors have been discovered and arbitraged out of the market.&quot;</p>

<p>Rather reminds me of Keats Ode to Melancholy and the  concerns of the romantic poets regarding the temporary nature of our world. The fleetingness of life, the impermanence of the flower and all else in our temporal world. </p>

<p>At a time when many major hedge funds are struggling or closing their shutters, we may do well to dwell on impermanence.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de5971bf2ecbd0644a9d5f0' id='5de5971bf2ecbd0644a9d5f0'>
<a href='#5de5971bf2ecbd0644a9d5f0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1575327515000' class='quanto-date posted-at response-posted-at' href='#5de5971bf2ecbd0644a9d5f0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Moved make_pipeline() to initialize (), removed unnecessary masks, changed the end of the month to 7, and made some cosmetic changes.<br>
Got some more improvements in metrics.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de804ef41ce950049275735' id='5de804ef41ce950049275735'>
<a href='#5de804ef41ce950049275735'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1575486703000' class='quanto-date posted-at response-posted-at' href='#5de804ef41ce950049275735'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The attached notebook is based on Vladimir&#39;s program version which used the optimizer for trade execution (order_optimal_portfolio). </p>

<p>It is hard to &quot;force&quot; the optimizer in the direction you want. It is a &quot;black-box&quot; with a mindset of its own. Nonetheless, by changing the structure and objectives of the program, one can push the strategy to higher levels. Some leverage and shorts have been used to reach that 34.1\(\%\) CAGR. However, the strategy, at that level, can afford the extra leveraging fees.</p>

<p>Evidently, the strategy looked for more volatility and as a consequence suffered a higher max drawdown while keeping a relatively low beta. I have not improved on the protective measures as of yet. Currently, the trend definition is still the moving average crossover thingy which will alleviate the financial crisis drawdown but will also whipsaw a lot more than desired or necessary. </p>

<p>A total return of 14,059\(\%\) will turn a \(\$\)10M initial cap into a \(\$\)1.4B account.</p>

<p>Still more work to do.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de8117dc3cbe100469cadd4' id='5de8117dc3cbe100469cadd4'>
<a href='#5de8117dc3cbe100469cadd4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1575489917000' class='quanto-date posted-at response-posted-at' href='#5de8117dc3cbe100469cadd4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy. Not trying to criticize or anything but whatever you did with the strategy, didn&#39;t clearly worked. If you look closely, the highest returns were achieved in 2015 and at the end of 2019 it is still at same level. In other words, the strategy didnt make any money after 2015 if you stay invested. Clearly, the alpha has gone from the &quot;objectives of the program&quot;.</p>

<p>In contrast, vladimir algo is consistently making money. An ever increasing upward sloping curve.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de851fc41ce95003d27591b' id='5de851fc41ce95003d27591b'>
<a href='#5de851fc41ce95003d27591b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1575506428000' class='quanto-date posted-at response-posted-at' href='#5de851fc41ce95003d27591b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Nadeem, let me see. You are playing a money game and the final result is inconsequential. You like a smoother equity curve even if it is \(\$\)1.2B lower over the trading interval. Well, to each his own as they say. And as I have said, there is still work to be done. Especially in the protective measure department.</p>

<p>Vladimir does have a good trading strategy and I do admire his coding skills. They are a lot higher than mine.</p>

<p>Maybe you would prefer the following notebook. Who knows?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de86a55a1a7e00048bf56a2' id='5de86a55a1a7e00048bf56a2'>
<a href='#5de86a55a1a7e00048bf56a2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1575512661000' class='quanto-date posted-at response-posted-at' href='#5de86a55a1a7e00048bf56a2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy, I&#39;m curious if you&#39;ve allocated any real capital to any of your strategies, and if so, what the result has been in the live market?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de870d2a1a7e06a08bf5628' id='5de870d2a1a7e06a08bf5628'>
<a href='#5de870d2a1a7e06a08bf5628'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1575514322000' class='quanto-date posted-at response-posted-at' href='#5de870d2a1a7e06a08bf5628'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy Fleury</p>

<p>To my mind, </p>

<pre><code>order_optimal_portfolio(opt.TargetWeights(wt), [opt.MaxGrossExposure(LEV)])  
</code></pre>

<p>does not produce any weights optimization by any criteria it just exercise the requested weights more accurately and constrain target leverage.</p>

<p>When writing the code of my version of the strategy, I entered the LEV parameter specifically for you.<br>
Here are the results with only two changes in setup LEV = 2.0, initial capital = 10000.</p>

<p><em>It is not possible to trade this strategy with LEV &gt; 1.0 on IRA accounts.<br>
Results do not include marginal expenses.</em>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de8dd4241ce950043275cf3' id='5de8dd4241ce950043275cf3'>
<a href='#5de8dd4241ce950043275cf3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575542083000' class='quanto-date posted-at response-posted-at' href='#5de8dd4241ce950043275cf3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy Fleury</p>

<p>Guy, I am sorry to say that from my point of view you continue to make the same mistakes you have always made.  I simply do not see the point of your posts if you are not willing to share your code.</p>

<p>Or indeed to elucidate on the mysterious &quot;pressure points&quot; you refer to to produce the equity curves you come up with. I am well aware I have made no contribution to this thread either but I have at least taken the trouble to look through your website trying to find out exactly what your &quot;alpha power&quot; is based on.</p>

<p>Sadly it is more of the same - many formulae, many equity charts, and much obfuscation. </p>

<p>It is of course entirely your prerogative to present your trading systems in this way. But to my way of thinking the exercise is entirely pointless.</p>

<p>I am genuinely interested in your point of view but by refusing to provide details, what could have been an interesting contribution to the obscure and arcane arts you portray is rendered entirely without meaning.</p>

<p>Once again may I respectfully request that you provide the code behind your alterations to this system kindly provided by and improved upon by others.</p>

<p>And I repeat the words &quot;respectfully&quot; and &quot;request&quot; lest we get into the same sort of dispute we have so often fallen into in the past.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de8e00da1a7e04663bf53fb' id='5de8e00da1a7e04663bf53fb'>
<a href='#5de8e00da1a7e04663bf53fb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575542797000' class='quanto-date posted-at response-posted-at' href='#5de8e00da1a7e04663bf53fb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Vladimir<br>
In various posts above @Guy quotes leverage of 1.4 to achieve one of his more impressive equity curves. He also states that he has used the Q1500 portfolio rather than the Q500. I have tried the Q1500 as well and the Q3000 and the difference is underwhelming.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de8e50041ce955b08275720' id='5de8e50041ce955b08275720'>
<a href='#5de8e50041ce955b08275720'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575544064000' class='quanto-date posted-at response-posted-at' href='#5de8e50041ce955b08275720'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is a &quot;pressure point&quot;. Use the Q3000 and reduce the number of stocks invested in to 10. Probably very unstable but I have not bothered to run it over different re-balance dates.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de8e86aa1a7e01940bf547f' id='5de8e86aa1a7e01940bf547f'>
<a href='#5de8e86aa1a7e01940bf547f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575544938000' class='quanto-date posted-at response-posted-at' href='#5de8e86aa1a7e01940bf547f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is another pressure point for you....and hey, I&#39;m going to tell you what it is! Q3000 and invest in 5 stocks.  See we can all do it eh?  And of course you can make it even better with a little extra secret sauce....like reducing the max DD and vol.....but that is for another day. Don&#39;t want to over-excite myself.</p>

<p>If you take a look at the code you will see I have made a total mess of the parameters. But that is the point isn&#39;t it?  If you just present pretty pictures you have absolutely no idea how they were created. And no interest either.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de9392dc3cbe100499cb565' id='5de9392dc3cbe100499cb565'>
<a href='#5de9392dc3cbe100499cb565'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58e2d12a3bfa1b000ae0441b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fd6452e042524ac9f6bbd40c88e5668e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58e2d12a3bfa1b000ae0441b'>Chris Cain</a>
</div>
<a UTCms='1575565613000' class='quanto-date posted-at response-posted-at' href='#5de9392dc3cbe100499cb565'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey All,</p>

<p>Thank you so much for the contributions to this Algo. This was what I had in mind when I shared this strategy.</p>

<p>Special thanks to those that made the code more efficient (Jamie, Joakim, Dan, Vladimir)</p>

<p>As you can see, many versions of this idea work well. On a historical basis, we can say this tweak or that tweak worked “better”, but we have no way to knowing which tweak will have the best performance in the future.  As such, I look for strategies that are simple, explainable, robust and show good performance on a wide variety of parameter changes.  To me, this strategy does that. </p>

<p>I’ll address a few comments I read in this thread.</p>

<p>Some have said that perhaps the Alpha has gone away b/c the last couple years have had a bit lower performance. While this is always a possibility, I certainly don’t think this is the case.  First of all, things we are using here (value, quality, momentum, trend following) have been around for decades.  All of these have been used well before this backtest even started. Factors go in and out of favor (this is especially true with Value’s bad performance over the last 5 years).  To me, that certainly doesn’t mean the Alpha is gone.  Those that have had that opinion in the past (such as with Value’s underperformance in the late 1990s) were very mistaken.</p>

<p>I view these factors as rooted in human behavior (too long of an explanation to get into now).  I am of the opinion that human behavior will not change.</p>

<p>Some have questioned the validity of the trend following filter.  The original algo used a ROC over the last 6 months. Joakim’s versions used the 50 and 200-day moving averages.  Both of these techniques essentially do the same thing (though at slightly different speeds).  I think both are logical and will provide value in the future. </p>

<p>As far as the validity of this rule in general, the questions becomes -  do you believe in trend following (time-series momentum) or not?  I certainly do.  There are 100+ year backtests that prove its value (see AQR), not to mention decades of real-world practitioner results.</p>

<p>Over the last 9 years, we have only had equity pullbacks in the 10-20% range. In these type of shallow pullbacks, our trend-following regime filter rule will be a drag on performance.  What happens is you get out of the market, then have to but back in at a higher price. The question then becomes - do you think these shallow pullbacks are the new normal, or that we will eventually see a 30-50% pullback which has happened many times in history?  In a 30-50% pullback, our trend-following regime filter will add a ton of value (such as what happened in 2008).</p>

<p>You can always mess with the different speeds of the lookback for trend following.  Academic research has shown that 3-12 month lookbacks work.  Instead of trying to pick the optimal lookback, I am in favor of diversifying amongst several lookbacks (this is not implemented in the current algo).</p>

<p>Anyway, those are some of my thoughts. Thank you all for checking out my algo, I am happy with the great response from the wonderful Quantopian community!</p>

<p>Chris Cain, CMT  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de93d58efec1e0ba0f6d267' id='5de93d58efec1e0ba0f6d267'>
<a href='#5de93d58efec1e0ba0f6d267'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575566680000' class='quanto-date posted-at response-posted-at' href='#5de93d58efec1e0ba0f6d267'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Employing rotation into a mere 5 stocks monthly is somewhat more dependent on roll date - as i believed would be the case. 4 different roll dates produce CAGRs of between 19 and 29% when you don&#39;t employ any leverage.  The code still needs to correct the occasional unintended leverage.</p>

<p>But for what it is worth here is one such back test where I have not played fast and loose with the parameters. Pretty impressive.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de945f9a1a7e012f9bf55f6' id='5de945f9a1a7e012f9bf55f6'>
<a href='#5de945f9a1a7e012f9bf55f6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1575568889000' class='quanto-date posted-at response-posted-at' href='#5de945f9a1a7e012f9bf55f6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Chris, very well put. I 100% agree with your comments.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de94e36c3cbe166a89cb225' id='5de94e36c3cbe166a89cb225'>
<a href='#5de94e36c3cbe166a89cb225'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1575570998000' class='quanto-date posted-at response-posted-at' href='#5de94e36c3cbe166a89cb225'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anthony,</p>

<p>in your last 3 posts you probably used somebodies broken algo with bugs and added your own.<br>
By Christopher Cain definition this algo is long only with no  leverage.<br>
You set context.Target_securities_to_buy = 5.0.<br>
Initial capital $100000.<br>
Jast check positions on the first day of your algo trading 5-19-2003.<br>
It had 20 positions in stocks $20000 each, total $400000 and short position in bond -$315000.<br>
That is leverage more then 7, sometimes it reaches more then 13.</p>

<p>Did the algorithm realized your intentions?<br>
Is it appropriate to use the results of broken algo in argumentation?</p>

<p>I have tested your parameter setting in my algo.</p>

<p>QTU = Q3000US(); MKT = symbol(&#39;SPY&#39;); BONDS = symbols(&#39;IEF&#39;, &#39;TLT&#39;); D = 8;<br>
MOM = 126; EXCL = 10; N_Q = 50; N = 5; MA_F = 20; MA_S = 200; LEV = 1.0;</p>

<p>The results are not perfect but for somebody may be acceptable.<br>
Another proof of Christopher Cain concept.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de94f6cefec1e0eb2f6d18b' id='5de94f6cefec1e0eb2f6d18b'>
<a href='#5de94f6cefec1e0eb2f6d18b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575571308000' class='quanto-date posted-at response-posted-at' href='#5de94f6cefec1e0eb2f6d18b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Vladimir thanks for the comment. </p>

<p>The first couple of tests were simply to show the futility of posting charts without the code. I deliberately mucked up the parameters.</p>

<p>The third test I used Jamie Corriston&#39;s code (I believe?) and none of my own. I simply set the number of stocks to 5 in both relevant lines. Leverage is 1 most of the time with the occasional spike to 2 which I have not investigated.</p>

<p>I am going to look much further if I decide to trade this thing and will now download/clone your version of Jamie&#39;s&#39;s code as amended. </p>

<p>With many thanks to you.</p>

<p>I was originally attracted to the idea since I had drafted a monthly momentum re-balance system here on the website a couple of years ago. Which attracted much attention until Guy Fleury started commenting and the whole thread then went off the rails.</p>

<p>This system is much better - I had failed to add any fundamentals filter which certainly helps with the variability over different rebalance dates.</p>

<p>Actually Vladimir, I don&#39;t think you posted a version of the code? Whose or which version are you using?</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de9991a5900701bacf5dd04' id='5de9991a5900701bacf5dd04'>
<a href='#5de9991a5900701bacf5dd04'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1575590170000' class='quanto-date posted-at response-posted-at' href='#5de9991a5900701bacf5dd04'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>Employing rotation into a mere 5 stocks monthly is somewhat more dependent on roll date - as i believed would be the case. 4 different roll dates produce CAGRs of between 19 and 29%</p>
</blockquote>

<p>I know you&#39;re joking around/making a point, but my recommendation (and I believe Quantopian&#39;s guidance as well) is to eliminate day-of-the-month overfit noise by putting a 20-day SMA on the signal and trade every day instead of monthly. Typically this will give your backtest a lot more data points, allowing you to hold more positions at once without diluting your alpha signal (just the hits, no deep cuts, so to speak) nor increasing turnover, and is likely to improve your sharpe ratio (via lower volatility and slippage).  Though this algo trades on such low frequency data it&#39;s not likely to benefit so much from day-of-the-month diversification, I have successfully used this technique to great results in the past.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5de9b66a2ac8631b3070be64' id='5de9b66a2ac8631b3070be64'>
<a href='#5de9b66a2ac8631b3070be64'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5dddea4e4fbc096a20004592'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/39f55a90dca1d8179b261605fa4968f1?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5dddea4e4fbc096a20004592'>Tucker</a>
</div>
<a UTCms='1575597674000' class='quanto-date posted-at response-posted-at' href='#5de9b66a2ac8631b3070be64'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Chris, thanks for posting this. Has anyone been able to convert this algorithm to work with alpaca? Or if not can someone point me in the right direction of how to get started (with converting this or any other quantopian algorithm)?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dea6492cef94752caccb1ac' id='5dea6492cef94752caccb1ac'>
<a href='#5dea6492cef94752caccb1ac'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5c9a292788391322331f9413'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/38a1905cfc18f3d41e805d2ecc1d77d8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5c9a292788391322331f9413'>Mike Burke</a>
</div>
<a UTCms='1575642258000' class='quanto-date posted-at response-posted-at' href='#5dea6492cef94752caccb1ac'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey Viridian,</p>

<p>&quot;I know you&#39;re joking around/making a point, but my recommendation (and I believe Quantopian&#39;s guidance as well) is to eliminate day-of-the-month overfit noise by putting a 20-day SMA on the signal and trade every day instead of monthly.&quot;</p>

<p>Can you expand on this?  How would the logic work to implement this technique with this Algo?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dea8f0347058e5840f22558' id='5dea8f0347058e5840f22558'>
<a href='#5dea8f0347058e5840f22558'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575653123000' class='quanto-date posted-at response-posted-at' href='#5dea8f0347058e5840f22558'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Viridian Hawk<br>
Thank you for that. It certainly sounds an excellent idea to average the signal.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5deab70184d16f61cc389b11' id='5deab70184d16f61cc389b11'>
<a href='#5deab70184d16f61cc389b11'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575663361000' class='quanto-date posted-at response-posted-at' href='#5deab70184d16f61cc389b11'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Mike Burke<br>
I&#39;m not sure there would be much point averaging the fundamental factors, unless they are ratios to shareprice, since their frequency is so low. But you could easily average the momentum factor which is the second leg of this algo&#39;s filter.</p>

<p>I&#39;m a bit rusty with the Q API, but i believe all one has to do is to add the momentum provisions as a custom factor. Custom since the built in momentum factor does not adjust for not including the last ten mean reverting days.</p>

<p>Then add it to the pipline, find the top x, and use it as a filter as per the existing algo.</p>

<p>When I get around to it I will post an example.</p>

<p>I&#39;m still puzzling over the occasional spike in leverage - or rather how to correct it. I do not want to use optimise since I don&#39;t want equal weighting. Therefore you need to allocate slightly differently to the current algo. You need to only allocate a percentage of unused capital...which is not the way it is currently done.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5deaec4c47058e5e1bf226ff' id='5deaec4c47058e5e1bf226ff'>
<a href='#5deaec4c47058e5e1bf226ff'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1575677004000' class='quanto-date posted-at response-posted-at' href='#5deaec4c47058e5e1bf226ff'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Mike Burke --  Sometimes it&#39;s as easy as putting a SimpleMovingAverage on the pipeline output, but for this algorithm you&#39;d have to refactor the execution aspect of it.  Basically you&#39;ll want start by creating a dictionary of target weights (including the bond allocation) based on the current day&#39;s pipeline output and bull market crossover, but instead of ordering those weights, you&#39;d add them to a context list, ala <code>context.daily_weights.append(today_target_weights)</code> then you&#39;ll want to prevent overflow by popping off any entries once you&#39;re over 20, ala <code>if len(context.daily_weights) &gt; 20: context.daily_weights.pop(0);</code>Then you just combine the weights and normalize them. That&#39;ll give you the 20-day average portfolio, which you can then order (most easily via the optimizer w/<code>TargetWeights(combined_weights)</code>).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5deb7ee947058e21c8f2295e' id='5deb7ee947058e21c8f2295e'>
<a href='#5deb7ee947058e21c8f2295e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575714537000' class='quanto-date posted-at response-posted-at' href='#5deb7ee947058e21c8f2295e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Viridian Hawk.<br>
Yes, the portfolio management aspect is the key. Nice solution and simple. You just add the new stocks at a weight of 1/20th and existing stocks in the portfolio at whatever percentage of equity they have reached and then normalize. </p>

<p>This is what you should be doing even if you do not intend to average the signal or trade daily.</p>

<p>I find it very difficult to analyse the output on Q. Loathe it in fact. But I suppose what is happening is that for most of the time enough big hitting stocks drop out to make room for new entrants. And then sometimes they don&#39;t and you get huge leverage because you have failed to normalize the allocations.</p>

<p>At least with your suggestion new entrants get a fair crack of the whip and strongly trending stocks still retain an overweight position.</p>

<p>I was stupidly thinking of just dividing the un-allocated capital amongst the new entrants at a roll date, but I like your solution better.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5deb81852687be5b0eca7a9c' id='5deb81852687be5b0eca7a9c'>
<a href='#5deb81852687be5b0eca7a9c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575715205000' class='quanto-date posted-at response-posted-at' href='#5deb81852687be5b0eca7a9c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Viridian Hawk.<br>
Another thing I have been pondering is the running of this strategy now that you can no longer trade through Quantopian.   If you were wiling to take the risk of monthly allocation it would be no effort to run it manually, although whether you would take your signals from Quantopian, buy your own data, or look for online screeners I am not too sure. Perhaps Morningstar offer a free or cheap screener on the fundamentals.</p>

<p>If you wanted to run it daily, automation would be the better option and I suppose you could convert the algo to run on Quantconnect.</p>

<p>I suppose there must be other solutions but the last thing I would want is to have to run the system on my own server.</p>

<p>What do you do?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5deb832847058e21c8f22987' id='5deb832847058e21c8f22987'>
<a href='#5deb832847058e21c8f22987'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575715624000' class='quanto-date posted-at response-posted-at' href='#5deb832847058e21c8f22987'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Viridian Hawk.</p>

<p>I have become so used to designing my own systems on my own software and it is so very much better to be able to analyse a spreadsheet of your results which contains all the prices, all the signals, all the trades and so forth. You can turn them inside out and upside down and really get to the bottom of why the system is doing what it is doing. </p>

<p>In that respect I find Quantopian so very difficult - I can never grasp the full picture clearly enough.</p>

<p>I suppose logging is one option, although it is restricted. I suppose running in debug is another although so slow and tedious.</p>

<p>I understand the need to protect their data suppliers but for me at least it does make life difficult.</p>

<p>I suppose the research environment may be a better option since I think (?) you can use pipeline there now.</p>

<p>How best do you analyse your systems on Quantopian?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5deb8b5647058e21c8f229e5' id='5deb8b5647058e21c8f229e5'>
<a href='#5deb8b5647058e21c8f229e5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575717718000' class='quanto-date posted-at response-posted-at' href='#5deb8b5647058e21c8f229e5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Incidentally, for those who insist on using leverage by design, it is worth considering leveraging the bond portfolio using futures rather than IEF.  I did a great deal of work a while ago on the all weather portfolio concept and it might be worth looking at replacing IEF with the relevant future on US Government bonds. I have no idea yet whether Quantopian allows you to mix futures and equities within one system, but by way of example you could allocate 90% of your cash to stocks and 100% equivalent of your cash to bonds. Or whatever.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5debb304f40b6d08dd09a85c' id='5debb304f40b6d08dd09a85c'>
<a href='#5debb304f40b6d08dd09a85c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1575727876000' class='quanto-date posted-at response-posted-at' href='#5debb304f40b6d08dd09a85c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>tenquant.io looks to be a promising source of high quality free fundamental data.  In theory it is faster than MorningStar, which can have up to a three-day delay, whereas tenquant.io claims they scrape the financial data as soon as it goes public.  As far as automation goes, I&#39;ve been using Alpaca.  I couldn&#39;t get their version of zipline to run on my computer, so I just rolled my own barebones trading framework using the REST API, which was pretty simple.  So maybe somebody with more experience with Alpaca&#39;s version of zipline, which I think is called pylivetrader, can chime in whether there&#39;s any incompatibility that would stop this algo from running, but my impression is that it shouldn&#39;t be too hard to get it to work.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5debd46784d16f004738a650' id='5debd46784d16f004738a650'>
<a href='#5debd46784d16f004738a650'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575736423000' class='quanto-date posted-at response-posted-at' href='#5debd46784d16f004738a650'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thank you, most useful.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5decc8af70156d105fea13af' id='5decc8af70156d105fea13af'>
<a href='#5decc8af70156d105fea13af'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575798959000' class='quanto-date posted-at response-posted-at' href='#5decc8af70156d105fea13af'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I have by no means finished my work on this excellent algo but as an interim report I have made progress reducing leverage without using &quot;optimise&quot;.  Certain stocks were repeatedly not getting sold at or around the close so I moved the stock transactions to the open. By the time the bond trades happened at the close, in tests so far, all stock sales were getting processed.  And hence the allocations more accurate.</p>

<p>To combat negative allocations to bonds, I simply reduced any negative allocations to zero.</p>

<p>Imperfect and doubtless I shall improve on it once I get to the bottom of the matter.</p>

<p>I&#39;m not at all sure about trading every day and averaging the momentum signal. A similar effect could be achieved (so far as avoiding the dangers of using a single monthly re-allocation date) by trading weekly on an un-averaged signal. </p>

<p>My concern is that trading once a month is very convenient, if potentially risky. Trading every day or even every week would be impossible for me unless I automated.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5decf93488275a4bb3d364be' id='5decf93488275a4bb3d364be'>
<a href='#5decf93488275a4bb3d364be'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d3c56369eca8e31e2d692a3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b07bccab7e1bc10792fc86324865b167?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d3c56369eca8e31e2d692a3'>Steve Jost</a>
</div>
<a UTCms='1575811380000' class='quanto-date posted-at response-posted-at' href='#5decf93488275a4bb3d364be'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Zenothestoic</p>

<p>The thing that has always bothered me about the pipeline  implementation (starting with Joakim&#39;s version I think)  is that the ranking is done against all stocks (QTradableStocksUS ?).  In my mind the correct way to rank the factors is to use a mask to limit the comparison to those that are in your universe, i.e.  rank(mask=universe), in this case Q3000US.  However if you do it this way the cumulative return drops to less than half.   Can you make an argument (other than it works better) for using rank() and not rank(mask=universe) ?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5decfdfa88275a4d40d36508' id='5decfdfa88275a4d40d36508'>
<a href='#5decfdfa88275a4d40d36508'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575812602000' class='quanto-date posted-at response-posted-at' href='#5decfdfa88275a4d40d36508'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Steve Jost<br>
To be honest I am very unfamiliar with the Quantopian API especially as it seems to have changed somewhat since I last visited it.</p>

<p>I find working with the Quantopian IDE about as difficult an experience as engaging in carpentry where you are only allowed to look through a keyhole at your hands and the workbench.</p>

<p>Looks like you are right, how very bizarre. I added a mask separately to each of the fundamental rankings and came up with different (as it happens) worse results. Live and learn eh? </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ded0b1b88275a54b7d3635a' id='5ded0b1b88275a54b7d3635a'>
<a href='#5ded0b1b88275a54b7d3635a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d3c56369eca8e31e2d692a3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b07bccab7e1bc10792fc86324865b167?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d3c56369eca8e31e2d692a3'>Steve Jost</a>
</div>
<a UTCms='1575815963000' class='quanto-date posted-at response-posted-at' href='#5ded0b1b88275a54b7d3635a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Zenothestoic</p>

<p>I&#39;m not an expert on Quantopian API, but to understand how rank(mask=universe) differs from rank(), it can help to construct two versions of the pipeline in a notebook (see attached).   From this, it seems that rank() is ranking against a larger population than Q3000US and using screen = universe does not change the numerical ranks.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ded495320e2ec00482ca3bd' id='5ded495320e2ec00482ca3bd'>
<a href='#5ded495320e2ec00482ca3bd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575831891000' class='quanto-date posted-at response-posted-at' href='#5ded495320e2ec00482ca3bd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><pre><code>ltd_to_eq = Fundamentals.long_term_debt_equity_ratio.latest.rank(mask=universe,ascending=True)  
</code></pre>

<p>Yes, the wrong way round of course if you are seeking low debt to equity. As it stands, however, high debt to equity creates exceptional profits, presumably because the company&#39;s debt produces leveraged earnings......</p>

<p>If you are a leverage junkie then this might actually suit your purposes - a highly profitable system (at least for the test period) and no need to take on leverage in your trading account.</p>

<p>A sort of no-recourse borrowing where your account can not go below zero.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ded4d582d192e6b9bc1ef2f' id='5ded4d582d192e6b9bc1ef2f'>
<a href='#5ded4d582d192e6b9bc1ef2f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575832920000' class='quanto-date posted-at response-posted-at' href='#5ded4d582d192e6b9bc1ef2f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Steve Jost<br>
No, now you have pointed out the error, I can not put forward any argument for using rank() as opposed to rank(mask=universe).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ded5803860929003c1334b1' id='5ded5803860929003c1334b1'>
<a href='#5ded5803860929003c1334b1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d3c56369eca8e31e2d692a3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b07bccab7e1bc10792fc86324865b167?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d3c56369eca8e31e2d692a3'>Steve Jost</a>
</div>
<a UTCms='1575835651000' class='quanto-date posted-at response-posted-at' href='#5ded5803860929003c1334b1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Zenothestoic</p>

<p>It seems the prudent approach is to use rank(mask=universe) even though the return is less.<br>
Without the mask, I worry that the exceptional return may have been a happy accident and not likely to repeat going forward.</p>

<p>Regarding debt to equity ratio - I&#39;ve also found also that high &#39;financial_leverage&#39; gives good results.<br>
I think the two metrics are more or less equivalent.</p>

<p>That said it&#39;s most likely the combination of large debt and high &#39;roic&#39; that does the trick.<br>
A company that generates high return on capital will do well to leverage it&#39;s capital at low (and historically decreasing) interest rates.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ded59b520e2ec4ead2ca312' id='5ded59b520e2ec4ead2ca312'>
<a href='#5ded59b520e2ec4ead2ca312'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575836085000' class='quanto-date posted-at response-posted-at' href='#5ded59b520e2ec4ead2ca312'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Steve Jost<br>
Your logic sounds right. Lots of debt, but used profitably.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ded5cb1860929003f133515' id='5ded5cb1860929003f133515'>
<a href='#5ded5cb1860929003f133515'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575836849000' class='quanto-date posted-at response-posted-at' href='#5ded5cb1860929003f133515'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Steve Jost</p>

<p>For the private punter that sort of algo makes a lot of sense. Leverage is built in, but in such a way it can not bankrupt you. The return is high enough that you can devote a small amount of capital to it and still have it make you a decent amount of money over 5 or 10 years.   And your capital employed is small enough that if it all goes horribly wrong it won&#39;t be a catastrophe.</p>

<p>I&#39;m glad this sort of algo has made a return here. So much more interesting than what Big Steve wants for his Billions.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ded614220e2ec003f2ca454' id='5ded614220e2ec003f2ca454'>
<a href='#5ded614220e2ec003f2ca454'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1575838018000' class='quanto-date posted-at response-posted-at' href='#5ded614220e2ec003f2ca454'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@steve</p>

<p>Thank You for posting the notebook. Using mask=universe is something I have been experimenting a lot lately. I am trying to understand why choosing mask results in different returns. It should not. For example - Lets assume a scenario. Lets say you rank against the whole universe of 9000 securities (i.e. not using mask). Now lets pick one security in that universe - X. Lets say X is having highest fcf and hence has a rank of 9000. So it will be on top. Now lets assume you rank against Q500US but the stock X is not in Q500US. According to our screen - it will be excluded. Lets continue this further - say a stock Y is ranked as 8999 in whole universe and it also happens to be in Q500US, so it will end up in our selection. Now lets say had you use mask=ranking then the rank would be 500 and it would still end up in our selection. Therefore, using mask should not differ the results.</p>

<p>But the question is why it happens in the above algo - I think the answer lies in this line --&gt; quality = (roic +ltd_to_eq +value)</p>

<p>adding different rank scores messes up the whole ranking. If one instead use quality = (roic +ltd_to_eq +value).rank(mask=universe) the result will be exactly same. Hence, using mask in ranking does not change the result.</p>

<p>This is the most plausible explanation I can come up with. I might be missing something. Let me know please if this sounds logical.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ded74b5860929239413339f' id='5ded74b5860929239413339f'>
<a href='#5ded74b5860929239413339f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d3c56369eca8e31e2d692a3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b07bccab7e1bc10792fc86324865b167?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d3c56369eca8e31e2d692a3'>Steve Jost</a>
</div>
<a UTCms='1575842997000' class='quanto-date posted-at response-posted-at' href='#5ded74b5860929239413339f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Nadeem<br>
I agree, if it&#39;s just one factor it doesn&#39;t matter if you rank over the universe or over the entire population.<br>
If you combine several factors (as in this script) than it seems to me that it does matter which way you do it.<br>
You don&#39;t want stocks outside of your universe to influence the weighting placed on the factors.</p>

<p>I think Dan Whitnable maybe said it the best in comments that he added to his source code.<br>
Note that he included (mask=universe) for the various factors but commented out that part of the code.<br>
I think this was commented out only so that his back test would match the result of previous versions.</p>

<pre><code>    # Get the fundamentals we are using.  
    # Rank relative to others in the base universe (not entire universe)  
    # Rank allows for convenient way to scale values with different ranges  
    cash_return = ms.cash_return.latest.rank() #(mask=universe)  
    fcf_yield = ms.fcf_yield.latest.rank() #(mask=universe)  
    roic = ms.roic.latest.rank() #(mask=universe)  
    ltd_to_eq = ms.long_term_debt_equity_ratio.latest.rank(ascending=True) #, mask=universe)  
    # Create value and quality &#39;scores&#39;  
    value = (cash_return + fcf_yield).rank() #(mask=universe)  
    quality = roic + ltd_to_eq + value  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dee2d5b5847fd187be73852' id='5dee2d5b5847fd187be73852'>
<a href='#5dee2d5b5847fd187be73852'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575890267000' class='quanto-date posted-at response-posted-at' href='#5dee2d5b5847fd187be73852'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>In the spirit of co-operation I wanted to report that I am having better results by doing away with the skipped period of 10 days in the momentum calculation (which people leave out because stocks are claimed to mean revert over the period). Frankly, I have never been impressed by the argument. Yes, I tend to use 10 days in my mean reversion system tests, but the benefits of NOT leaving out the past 10 days in TF calculations seem sound.</p>

<p>The other change I have made is to use a more sensitive MA crossover of 10 / 100 for the SPY permission filter.</p>

<p>The algo is now reaching Guy Fleury proportions.</p>

<p>For a really ritzy and risky shoot the lights out type system, I&#39;m just using debt to equity as a factor - the higher the better.</p>

<p>Using 5 stocks creates 38% cagr over the 2003 to 2019 test period. Still the occasional leverage spike to iron out -average leverage 1.06.  Vol 30, max DD 37%.  Universe = Q3000US(). Weekly rebalancing.<br>
I won&#39;t bother to post the algo at this stage since I still have to deal with a few matter such as the leverage problem.  </p>

<p>But it is certainly all beginning to look highly amusing.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5deedc21c56b1a6f1a469c3c' id='5deedc21c56b1a6f1a469c3c'>
<a href='#5deedc21c56b1a6f1a469c3c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1575935009000' class='quanto-date posted-at response-posted-at' href='#5deedc21c56b1a6f1a469c3c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>This trading strategy has about the same structure as many others on Quantopian: select some stocks, rank them on some criteria and rebalance periodically. Use some minimal (lagging) protection, i.e.: a 50–200 SMA crossover for this stock to bond switcher. A simple technique that has been around for ages. </p>

<p>Would it have been reasonable in 2003 to do so? Definitely, we were just getting out of the aftermath of the Dot.com bubble. A lot of developers (and portfolio managers) had bad memories of that debacle. So, yes, going forward, they would have put some kind of protection which could have very well been some variant and serving the same purpose: to limit the impact of drawdowns and volatility. It would also appear that it is easier to sell to management an automated trading strategy with some kind of protection than without.</p>

<p>This trading strategy is very hard to play with high stakes and a limited number of stocks. However, for a smaller account, it should do quite fine, as long as it stays limited. </p>

<p>The strategy has built-in scalability by design (up to a limit). </p>

<p>Playing 5 stocks on a \(\$\)10M account is not that reasonable. It starts with a \(\$\)2M bet size. I do not think that many here are ready for that whatever the results of some backtests. However, as you increase the number of stocks you see a decline in overall performance. This is quite reasonable too. The strategy tries to pick stocks that are already performing above market averages, and therefore, should provide on average an above-average performance. The thing is that as you add new stocks, they have a lower-ranked expectancy than those already selected. And this will tend to lower bet size and overall performance. </p>

<p>The question becomes: is this still acceptable over the long term?</p>

<p>It is all a question of confidence. In which scenario would you put your money on the table for some 16+ years? A backtest can give you an indication of what could have been. It does not give you what will be. However, based on the behavior of a particular trading strategy, you can ascertain that going forward would be much like what the trading strategy did in the past. You will not have the exact numbers, but you can still make some reasonable approximations. Sometimes, relatively accurate, considering that, otherwise, you would not even have a clue as to what is coming your way.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5def577d4dba374209283cb4' id='5def577d4dba374209283cb4'>
<a href='#5def577d4dba374209283cb4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1575966589000' class='quanto-date posted-at response-posted-at' href='#5def577d4dba374209283cb4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>It is only Quantopian who is looking to place £10m into a strategy. I will be placing a mere £10k.</p>

<p>So yes, I entirely agree. And yes, as you expand to 20 stocks and beyond the returns decrease but that is what you would have to do as the capital grew.<br>
Trend following is old as the hills. The only difference with this strategy is the accidental discovery of the &quot;wrong&quot; use of the debt to equity ratio.</p>

<p>The big advantage of this strategy is that for a small amount of capital, large gains may be possible for some period without the use of leverage in the trading account. </p>

<p>The leverage is applied by the corporates themselves and is therefore not a direct risk to your trading account ~ it is non-recourse borrowing as regards the trader. </p>

<p>Incidentally, and not surprisingly, you will find returns are also pretty high using 10 and 20 stocks, so for the smaller account as the equity grows, you could employ the greater capital in this way.</p>

<p>All in all, this is a strategy for the small player looking for large returns from a leveraged play without the risks of taking on borrowings on his own balance sheet.</p>

<p>And agreed as to the future. Quo vadis. As in life, so in the markets.</p>

<p>Now, Guy – I have shared an exact strategy with the community. How about you share the code to one of your adaptations of this strategy so that we can see how you achieve your outsize returns?</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5defc067685b36003c2c1360' id='5defc067685b36003c2c1360'>
<a href='#5defc067685b36003c2c1360'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1575993447000' class='quanto-date posted-at response-posted-at' href='#5defc067685b36003c2c1360'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p><strong>Alpha Decay Compensation</strong></p>

<p>The following chart is based on Dan Whitnable&#39;s version of the program at the top of this thread. All the tests were done using \(\$\)10M as initial capital. The only thing I wanted to demonstrate was that the structure of the program itself will dictate some of its long-term behavior. And as such, one thing we could do was make an estimate as to the number of trades that will be taken based on how many stocks will be traded.</p>

<p><img src="https://image-proxy.prd.pub.quantopian.com/18c64cd7c4d9016f35e82e0eff63a9f17f2aa1ac/687474703a2f2f616c706861706f77657274726164696e672e636f6d2f7175616e746f7069616e2f576869746e61626c655f70726f6772616d2e706e67" /> </p>

<p>There are 17 consecutive tests presented on that chart. Each test having the number of stocks incremented as the BT number increased. The Q3000US was used instead of the Q500US universe. There was a 2\(\%\) CAGR advantage in doing so. No leverage was used. Nonetheless, the strategy did use some at times (up to 1.6) for short periods of time.  This mainly due to the slippage factor. On average the leverage was at 1.0, some 95+\(\%\) of the time. </p>

<p>An analysis of the data can help better understand the overall behavior of the trading strategy and plan for what you would like to see or might prefer as initial setting. I have not made any change to the logic of Whitnable&#39;s version except from BT #  24 where I commented out the no slippage line of code. Moved the rebalance function to beginning of month and beginning of day to allow more trades to be executed. On the last test you had 240 stocks, yet a rebalance generated 16,486 transactions in one day. That is about 3 hours for average trade execution. So, yes, there is a lot of slippage.</p>

<p>I have not put in any of my stuff in there either. No enhancers, no compensation measures, no additional protection. Nothing to force the strategy to do more than what it was initially designed for.</p>

<p>The strategy, as you increase the number of stocks, does generate a lot of slippage and there is a cost to that. I prefer having a picture net of costs. Therefore, the Quantopian default settings for commissions and slippage were in force.</p>

<p><strong>Some observations on the above chart.</strong></p>

<p>It takes about 30+ stocks to have a diversified portfolio. The more stocks you add, the more the portfolio&#39;s average price movement will start to resemble the market average indices. It is only if a trading strategy can generate some positive alpha that it can exceed market averages. </p>

<p>As the number of stocks increases, we see the total return increase up to BT # 25 with its 17.8\(\%\) CAGR. After that, we have the total CAGR decrease as the number of stocks increases.</p>

<p>As explained in my previous post, this is expected since as we increase the number of stocks we are adding lower-ranked stocks having lower CAGR expectancies. The result is reducing the overall portfolio performance.</p>

<p>The more you want to make this a diversified portfolio (having it trade more stocks), the more we have a reduction in the overall performance. It is still positive, it is still above market averages and it does generate some positive alpha.</p>

<p>What I find interesting is the actual vs estimated number of trades columns. The actual number of trades come from the tearsheets. Whereas, the estimate, is just that, an estimate based on the behavior of this type of portfolio rebalancing strategy. There is a direct relationship between the number of trades and the number of stocks to be traded as the following chart illustrates.</p>

<p><img src="https://image-proxy.prd.pub.quantopian.com/64a44125c103c8097c2f0c3777f910199793189a/687474703a2f2f616c706861706f77657274726164696e672e636f6d2f7175616e746f7069616e2f576869746e61626c655f5472616465732e706e67" /> </p>

<p><strong>Participation Prize</strong></p>

<p>A subject that is not discussed very often here. There is a participation prize to play the game. Since the rebalance is on a monthly basis, as the number of stocks grows, the average holding duration will too. Jumping by close to month multiples. Some attribute the gains as coming from their alpha generation when all it is is partly market average background. </p>

<p>The estimated free x_bar is a measure of what the market offers just for holding some positions over some time interval. If you hold SPY for 20 years, you should expect to get SPY&#39;s CAGR over that period. The same goes for holding stocks months at the time. And over the past 10 years, in an upmarket, just participating would have generated a profit on the condition you made a reasonable stock selection.</p>

<p>One cannot call the estimated free x_bar as alpha generation. It is a source of profit for sure, but that is not alpha per se. Alpha is what is above the market average. The stuff that exceeds the benchmark average total return. As the number of stock increases, we can see the proportion of the estimated free x_bar increase in percentage over the actual x_bar. It is understandable, the average net profit per trade is decreasing (actual x_bar) while the average duration increases and the turnover rate is decreasing (x_bar is the average net profit per trade, refer to the long equation in a previous post).</p>

<p>Having the total return decrease after BT #  25 can also be interpreted as alpha decay. This is due to the very structure of the program itself. No compensation is applied for this return degradation, and it should continue simply by adding more stocks to the portfolio, or adding more time. And this becomes a rather limiting factor. The more you want to scale this thing up by adding more stocks, more time, the more the alpha with disintegrate. All that is needed is to compensate for the phenomena. </p>

<p>I have this free and old 2014 paper, which is still valid today, that deals with how to compensate for this return decay (see <a href="https://alphapowertrading.com/index.php/publications/papers/263-fix-fraction-2" rel="nofollow">https://alphapowertrading.com/index.php/publications/papers/263-fix-fraction-2</a>). It should help anyone solve that problem, and thereby, achieve higher returns. The solution does not require much. However, the first step is to understand the problem, and then apply the solution. The paper does provide the explanations and equations needed to address the return decay problem.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5defdcfc2c12fa0049e7dabf' id='5defdcfc2c12fa0049e7dabf'>
<a href='#5defdcfc2c12fa0049e7dabf'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1576000764000' class='quanto-date posted-at response-posted-at' href='#5defdcfc2c12fa0049e7dabf'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thank You, Zenothestoic for your continued work on this. I look forward to seeing your final version.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5defef0526b8a5003de26383' id='5defef0526b8a5003de26383'>
<a href='#5defef0526b8a5003de26383'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576005381000' class='quanto-date posted-at response-posted-at' href='#5defef0526b8a5003de26383'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Nadeem Ahmed<br>
Thank you for your kind words!</p>

<p>@Guy Fleury<br>
&quot;I have not put in any of my stuff in there either. No enhancers, no compensation measures, no additional protection. Nothing to force the strategy to do more than what it was initially designed for.&quot;</p>

<p>Then just for once Guy, why don&#39;t you do so? It would be most interesting.   I am sure everyone would enjoy your adaptation of this system.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df00a7528e5497c7677547b' id='5df00a7528e5497c7677547b'>
<a href='#5df00a7528e5497c7677547b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576012405000' class='quanto-date posted-at response-posted-at' href='#5df00a7528e5497c7677547b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is Quality companies in an uptrend (Dan Whitnabl version with fixed bonds weights) and some other improvements.</p>

<pre><code># Quality companies in an uptrend (Dan Whitnabl version with bonds weights  fixed by Vladimir)  
import quantopian.algorithm as algo

# import things need to run pipeline  
from quantopian.pipeline import Pipeline

# import any built-in factors and filters being used  
from quantopian.pipeline.filters import Q500US, Q1500US, Q3000US, QTradableStocksUS, StaticAssets  
from quantopian.pipeline.factors import SimpleMovingAverage as SMA  
from quantopian.pipeline.factors import CustomFactor, Returns

# import any needed datasets  
from quantopian.pipeline.data.builtin import USEquityPricing  
from quantopian.pipeline.data.morningstar import Fundamentals as ms

# import optimize for trade execution  
import quantopian.optimize as opt  
# import numpy and pandas because they rock  
import numpy as np  
import pandas as pd


def initialize(context):  
    # Set algo &#39;constants&#39;...  
    # List of bond ETFs when market is down. Can be more than one.  
    context.BONDS = [symbol(&#39;IEF&#39;), symbol(&#39;TLT&#39;)]

    # Set target number of securities to hold and top ROE qty to filter  
    context.TARGET_SECURITIES = 20  
    context.TOP_ROE_QTY = 50 #First sort by ROE

    # This is for the trend following filter  
    context.SPY = symbol(&#39;SPY&#39;)  
    context.TF_LOOKBACK = 200  
    context.TF_CURRENT_LOOKBACK = 20

    # This is for the determining momentum  
    context.MOMENTUM_LOOKBACK_DAYS = 126 #Momentum lookback  
    context.MOMENTUM_SKIP_DAYS = 10  
    # Initialize any other variables before being used  
    context.stock_weights = pd.Series()  
    context.bond_weights = pd.Series()

    # Should probably comment out the slippage and using the default  
    # set_slippage(slippage.FixedSlippage(spread = 0.0))  
    # Create and attach pipeline for fetching all data  
    algo.attach_pipeline(make_pipeline(context), &#39;pipeline&#39;)  
    # Schedule functions  
    # Separate the stock selection from the execution for flexibility  
    schedule_function(  
        select_stocks_and_set_weights,  
        date_rules.month_end(days_offset = 7),  
        time_rules.market_close(minutes = 30)  
    )  
    schedule_function(  
        trade,  
        date_rules.month_end(days_offset = 7),  
        time_rules.market_close(minutes = 30)  
    )  
    schedule_function(record_vars, date_rules.every_day(), time_rules.market_close())  

def make_pipeline(context):  
    universe = Q500US()  
    spy_ma50_slice = SMA(inputs=[USEquityPricing.close],  
                         window_length=context.TF_CURRENT_LOOKBACK)[context.SPY]  
    spy_ma200_slice = SMA(inputs=[USEquityPricing.close],  
                          window_length=context.TF_LOOKBACK)[context.SPY]  
    spy_ma_fast = SMA(inputs=[spy_ma50_slice], window_length=1)  
    spy_ma_slow = SMA(inputs=[spy_ma200_slice], window_length=1)  
    trend_up = spy_ma_fast &gt; spy_ma_slow

    cash_return = ms.cash_return.latest.rank(mask=universe) #(mask=universe)  
    fcf_yield = ms.fcf_yield.latest.rank(mask=universe) #(mask=universe)  
    roic = ms.roic.latest.rank(mask=universe) #(mask=universe)  
    ltd_to_eq = ms.long_term_debt_equity_ratio.latest.rank(mask=universe) #, mask=universe)  
    value = (cash_return + fcf_yield).rank() #(mask=universe)  
    quality = roic + ltd_to_eq + value  
    # Create a &#39;momentum&#39; factor. Could also have been done with a custom factor.  
    returns_overall = Returns(window_length=context.MOMENTUM_LOOKBACK_DAYS+context.MOMENTUM_SKIP_DAYS)  
    returns_recent = Returns(window_length=context.MOMENTUM_SKIP_DAYS)  
    ### momentum = returns_overall.log1p() - returns_recent.log1p()  
    momentum = returns_overall - returns_recent  
    # Filters for top quality and momentum to use in our selection criteria  
    top_quality = quality.top(context.TOP_ROE_QTY, mask=universe)  
    top_quality_momentum = momentum.top(context.TARGET_SECURITIES, mask=top_quality)  
    # Only return values we will use in our selection criteria  
    pipe = Pipeline(columns={  
                        &#39;trend_up&#39;: trend_up,  
                        &#39;top_quality_momentum&#39;: top_quality_momentum,  
                        },  
                    screen=top_quality_momentum  
                   )  
    return pipe

def select_stocks_and_set_weights(context, data):  
    &quot;&quot;&quot;  
    Select the stocks to hold based upon data fetched in pipeline.  
    Then determine weight for stocks.  
    Finally, set bond weight to 1-total stock weight to keep portfolio fully invested  
    Sets context.stock_weights and context.bond_weights used in trade function  
    &quot;&quot;&quot;  
    # Get pipeline output and select stocks  
    df = algo.pipeline_output(&#39;pipeline&#39;)  
    current_holdings = context.portfolio.positions  
    # Define our rule to open/hold positions  
    # top momentum and don&#39;t open in a downturn but, if held, then keep  
    rule = &#39;top_quality_momentum &amp; (trend_up or (not trend_up &amp; index in @current_holdings))&#39;  
    stocks_to_hold = df.query(rule).index  
    # Set desired stock weights  
    # Equally weight  
    stock_weight = 1.0 / context.TARGET_SECURITIES  
    context.stock_weights = pd.Series(index=stocks_to_hold, data=stock_weight)  
    # Set desired bond weight  
    # Open bond position to fill unused portfolio balance  
    # But always have at least 1 &#39;share&#39; of bonds  
    ### bond_weight = max(1.0 - context.stock_weights.sum(), stock_weight) / len(context.BONDS)  
    bond_weight = max(1.0 - context.stock_weights.sum(), 0) / len(context.BONDS)  
    context.bond_weights = pd.Series(index=context.BONDS, data=bond_weight)  
def trade(context, data):  
    &quot;&quot;&quot;  
    Execute trades using optimize.  
    Expects securities (stocks and bonds) with weights to be in context.weights  
    &quot;&quot;&quot;  
    # Create a single series from our stock and bond weights  
    total_weights = pd.concat([context.stock_weights, context.bond_weights])

    # Create a TargetWeights objective  
    target_weights = opt.TargetWeights(total_weights) 

    # Execute the order_optimal_portfolio method with above objective and any constraint  
    order_optimal_portfolio(  
        objective = target_weights,  
        constraints = []  
        )  
    # Record our weights for insight into stock/bond mix and impact of trend following  
    # record(stocks=context.stock_weights.sum(), bonds=context.bond_weights.sum())  
def record_vars(context, data):  
    record(leverage = context.account.leverage)  
    longs = shorts = 0  
    for position in context.portfolio.positions.itervalues():  
        if position.amount &gt; 0: longs += 1  
        elif position.amount &lt; 0: shorts += 1  
    record(long_count = longs, short_count = shorts)  
</code></pre>

<p>And its performance with  parameters of my code.<br>
You may compare to <a href="https://www.quantopian.com/posts/new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1#5de5971bf2ecbd0644a9d5f0" rel="nofollow">the results of my 37 lines code.</a> </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df011eafd271900489b1e19' id='5df011eafd271900489b1e19'>
<a href='#5df011eafd271900489b1e19'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576014314000' class='quanto-date posted-at response-posted-at' href='#5df011eafd271900489b1e19'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Vladimir<br>
Wonderful, thank you for that I will look closely tomorrow. I too have been working on putting all the ranking and masking into Pipeline but so far it does not seem to relate at all to my former versions. I shall look to correct the errors over the next few days And in the meantime will look with great interest at your code.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df0147efd271900429b1e96' id='5df0147efd271900429b1e96'>
<a href='#5df0147efd271900429b1e96'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576014974000' class='quanto-date posted-at response-posted-at' href='#5df0147efd271900429b1e96'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Vladimir<br>
By the way I quite like the idea of NOT equal weighting each month but adding the % of existing holdings and new 20% weightings up and then normalizing if they come to over 1. As suggested by @ Viridian Hawk. So as to let profits run.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df01a7a28e549003c7756cd' id='5df01a7a28e549003c7756cd'>
<a href='#5df01a7a28e549003c7756cd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5c95b6ea5fc12a00427956d6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5f1156f8b93f24992a9822abede95f01?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5c95b6ea5fc12a00427956d6'>Asis L</a>
</div>
<a UTCms='1576016506000' class='quanto-date posted-at response-posted-at' href='#5df01a7a28e549003c7756cd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Dear All,</p>

<p>I have been following this thread since the start and thank you all for contributing. </p>

<p>I am Web Developer wanting to learn Python and algo trading.</p>

<p>I am new to Qauntopian and want to learn as much as possible. </p>

<p>I have backtested the Dan Whitnabl version with fixed bonds weights strategy posted by Vladimir. </p>

<p>Here is the results.</p>

<p>Thanks<br>
Ashish  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df02fd72c12fa0049e7dd42' id='5df02fd72c12fa0049e7dd42'>
<a href='#5df02fd72c12fa0049e7dd42'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576021975000' class='quanto-date posted-at response-posted-at' href='#5df02fd72c12fa0049e7dd42'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m finding a huge difference between using the momentum calculation within pipeline:  </p>

<pre><code>ltd_to_eq_rank = Fundamentals.long_term_debt_equity_ratio.latest  
indebted = ltd_to_eq_rank.top(50,mask=universe)  
mom =Returns(inputs=[USEquityPricing.close],window_length=126,mask=indebted)  
</code></pre>

<p>and Pandas used on the output of the pipeline:</p>

<pre><code>quality_momentum = prices[:-context.momentum_skip_days].pct_change(context.relative_momentum_lookback).iloc[-1]  
</code></pre>

<p>I suppose it could be the fill method and limit to the fill method: I guess I need to look at Zipline to see exactly what is going on. And it has nothing to do with the deduction of the mean reversion 10 days...I have accounted for that.</p>

<p>There again I could be overlooking something simple and obvious.</p>

<p>I will revert to the research notebook to compare the outputs and understand the differences.</p>

<p>The source code tells me that Returns uses:</p>

<pre><code>window_safe = True  
</code></pre>

<p>Whereas the Pandas interpretation is looking at the adjusted Close, I believe I am right in saying the Returns factor is looking some sort of normalized prices.  Which I confess puzzles me.  Hey ho. More work to be done. And then of course the necessity to re-code and move to Quantconnect or get my own data.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df031a0e683fd004b7f094e' id='5df031a0e683fd004b7f094e'>
<a href='#5df031a0e683fd004b7f094e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1576022432000' class='quanto-date posted-at response-posted-at' href='#5df031a0e683fd004b7f094e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>A trading strategy is just that: a trading strategy. It can easily be expressed as a payoff matrix:<br>
$$\mathsf{E}[\hat F(T)] = F_0 + \sum_1^n (\mathbf{H} \cdot \Delta \mathbf{P}) = F_0 + n \cdot \bar x = F_0 \cdot (1 +r_m(t) +\alpha_t(t) - exp_t(t))^t$$ where \(g(t) = r_m(t) +\alpha_t(t) – exp_t(t)\).</p>

<p>You intend to play small, you could look at the equation this way: $$\mathsf{E}[\hat F(T)] = F_0 + n \cdot \bar x = F_0 \cdot (1 + g(t))^t$$ where \(F_0\), the initial capital can play a major role.</p>

<p>As long as a trading strategy is scalable, sustainable, and marketable it does not care so much about how much you put on the table (\(F_0\)). However, because it is a compounding return game that can be made to last, (\(F_0\)) will matter a lot. </p>

<p>Using a small stake, even if the strategy is profitable, is like really wasting a strategy&#39;s potential. Say you get a 20\(\%\) long-term CAGR, you might get something like this depending on the initial capital:</p>

<p>\(\mathsf{E}[\hat F(T)] = 10,000 \cdot (1 + 0.20)^{20} = 383,376\)</p>

<p>\(\mathsf{E}[\hat F(T)] = 100,000 \cdot (1 + 0.20)^{20} = 3,833,760\)</p>

<p>\(\mathsf{E}[\hat F(T)] = 1,000,000 \cdot (1 + 0.20)^{20} = 38,337,600\)</p>

<p>\(\mathsf{E}[\hat F(T)] = 10,000,000 \cdot (1 + 0.20)^{20} = 383,375,999\)</p>

<p><strong>Putting up more initial capital does not require any trading skills, none at all.</strong> </p>

<p>However, it does require finding ways to either raise the cash or have it allocated to the strategy in some way. Nonetheless, 20 years wasted can also be considered as non-productive time, and that time has no reset button.</p>

<p>If a trading strategy has good long-term prospects, why waste its potential by constraining it to a small initial capital? Doesn&#39;t your strategy deserve better? And don&#39;t you?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df0325fe683fd00427f0936' id='5df0325fe683fd00427f0936'>
<a href='#5df0325fe683fd00427f0936'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576022623000' class='quanto-date posted-at response-posted-at' href='#5df0325fe683fd00427f0936'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy Fleury<br>
I give up. I just give up.<br>
For heavens sake either produce some code or just let it be.<br>
No offence meant but what is SO difficult about coming up with some code like the rest of us do?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df033d3fd271900489b1f2e' id='5df033d3fd271900489b1f2e'>
<a href='#5df033d3fd271900489b1f2e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1576022995000' class='quanto-date posted-at response-posted-at' href='#5df033d3fd271900489b1f2e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Anthony, there is no need to post the algo. Like I said in my previous post: I used Dan Whitnable&#39;s version that is already posted. Changed the Q500US to Q3000US. Anybody can do that. Changed the scheduled rebalancing to month_start and market_open. For each test 
<code>
context.TARGET_SECURITIES  
</code> and <code>
context.TOP_ROE_QTY  
</code> were incremented as per the # of stock column in the above chart. Almost forgot, commented out the <code>
set_slippage  
</code> line starting with BT #  24 due to high slippage. That&#39;s it. No other changes.</p>

<p>Here is Vladimir&#39;s latest version with the same changes.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df0364b26b8a54924e2630b' id='5df0364b26b8a54924e2630b'>
<a href='#5df0364b26b8a54924e2630b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576023627000' class='quanto-date posted-at response-posted-at' href='#5df0364b26b8a54924e2630b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy Fleury</p>

<p>&quot;I have not put in any of my stuff in there either. No enhancers, no compensation measures, no additional protection. Nothing to force the strategy to do more than what it was initially designed for.&quot;</p>

<p>So what is the point in simply re-posting someone else&#39;s code unaltered?</p>

<p>I&#39;m really not trying to be difficult Guy but you talk of enhancers and yet we never see your code for any enhancements. So perhaps you could post one of your 90% CAGR tests with code.</p>

<p>Unless the only enhancement is leverage over and above the few changes you refer to above? Perhaps you do not have any further enhancements to the code other than upping the leverage?</p>

<p>Somehow there is a  disconnect here. Perhaps I am simply misunderstanding you.</p>

<p>But if you DO have further enhancements to Dan&#39;s code(or Vladimir&#39;s)  perhaps you could post them?</p>

<p>If you do NOT have any further enhancements to contribute and your 90% CAGR was simply based on leverage then would you be very kind and say so?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df03c5efd271900489b1f84' id='5df03c5efd271900489b1f84'>
<a href='#5df03c5efd271900489b1f84'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576025182000' class='quanto-date posted-at response-posted-at' href='#5df03c5efd271900489b1f84'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Skip_days.</p>

<p>The argument is that stocks are mean reverting over 10 days hence the following code:</p>

<pre><code> context.momentum_skip_days = 10  
 prices = data.history(df.index,&quot;close&quot;, 180, &quot;1d&quot;)  
 #Calculate the momentum of our top ROE stocks  
 quality_momentum = prices[:-context.momentum_skip_days].pct_change(context.relative_momentum_lookback).iloc[-1]  
</code></pre>

<p>The argument does not seem to stand up in a few of the tests I have been running.</p>

<p>Using 10 skip_days and 5 stocks gives a 2261% total return<br>
Using 2 skip_ days and 5 stocks gives a 25000% return.</p>

<p>So the return increases as you reduce the number of excluded days. In other words in my tests using my parameters, it is best to NOT to exclude a period in the momentum calculation. Here is an example using only 2 skipped days.</p>

<p>Of course my tests have used 5 stocks only. </p>

<p>But using 20 stocks with the attached code provides similar evidence.<br>
10 skipped days = total return of 3845%<br>
1 skipped day = total return of 5121%</p>

<p>So what&#39;s with the much talked of mean reversion period of 10 days?</p>

<p>Is it nonsense or am I missing something?</p>

<p>You will notice that leverage has not yet been sorted out in this algo. It averages just above 1 but sometimes goes up to 1.2 ish. I will get around to normalizing the weights at some stage. Which will presumably reduce returns.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df08f45fd271900429b2281' id='5df08f45fd271900429b2281'>
<a href='#5df08f45fd271900429b2281'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576046405000' class='quanto-date posted-at response-posted-at' href='#5df08f45fd271900429b2281'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anthony,</p>

<p>The latest algo you have used in your research still have uncontrolled leverage problem.<br>
Here are the results of your latest setup in my version of the algo:  </p>
<h1>----------------------------------------------------------------------------</h1>


<p>QTU = Q3000US();  MKT = symbol(&#39;SPY&#39;); BONDS = symbols(&#39;IEF&#39;);<br>
MOM = 126; EXCL = 2; N_Q = 50; N = 5; MA_F = 10; MA_S = 100; LEV = 1.0;  </p>
<h1>----------------------------------------------------------------------------</h1>


<p>with commented # set_slippage(slippage.FixedSlippage(spread = 0.0)).<br>
Why cheat yourself?</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df0a9b9fd2719003f9b2327' id='5df0a9b9fd2719003f9b2327'>
<a href='#5df0a9b9fd2719003f9b2327'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5469bca83ab3de7bff000334'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4c4ecac20f2ccee61491516e54b67f72?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5469bca83ab3de7bff000334'>Tony Morland</a>
</div>
<a UTCms='1576053177000' class='quanto-date posted-at response-posted-at' href='#5df0a9b9fd2719003f9b2327'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi old &amp; new Q friends. For me, coming back after 6 months away, it is nice to see people sharing &amp; contributing to this algo. Thanks Chris for starting the thread. The idea of &quot;Quality Stocks in Uptrend&quot; is exactly what i like to try to achieve in my own very small-time personal investing. Now i ask if we can add a useful additional dimension besides &quot;Quality&quot; and &quot;Uptrend&quot; for individual stocks? Good quality stocks  will KEEP going up if the demand for them continues from the overall investment community, and this is related in part to what is the investing &quot;fashion&quot; at the time. Sometimes it is big caps, or sometimes small caps, sometimes high earnings growth stocks, sometimes value such as low-PE stocks, or low-debt stocks, or sometimes particular industries  or market segments or some other specific factors. Now anyone who has looked at  Markov Chains &amp; transition probabilities for different market regimes or different types of stocks will have noticed that generally there is a high degree of persistence in market behavior. If we identify what is currently the dominant &quot;investment fashion&quot; in the market at any given time, we can observe that this usually has a tendency to persist, at least for a while. As the saying goes: &quot;A rising tide tends to lift all boats&quot;, so i now propose adding an additional component or dimension to the mix  when seeking the best investment opportunity, based on THREE legs: 1) Quality, 2) Uptrend (as you already have), and now also 3) The leading &quot;investment fashion&quot; group at any given time. </p>

<p>As i see it, &quot;Investment fashion&quot; could potentially be any of the following:<br>
a)  Any of the &quot;Investing Styles&quot; as defined in Q, namely: Momentum, Size, Value, Short Term Reversal, Volatility.<br>
b)  Any of the 11 different Economic Sectors as defined &amp; used in Q.<br>
c) Other possibilities such as correlation with interest rates or with those commodities showing the greatest price appreciation, etc.</p>

<p>So, without going to code just yet (my python skills are not great), i envisage using what we already have in this thread, and then defining &amp; ranking the currently leading &quot;Investment Fashion&quot; as per a), b), c) above and adding this in, to further enhance the selection criteria for the best potential returns. </p>

<p>Comments, please. Anyone care to try coding up this additional component or dimension of &quot;Investment Fashion&quot; (in an adaptive way but with some lag), to improve the mix even further?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df0b655fd27197f2d9b200c' id='5df0b655fd27197f2d9b200c'>
<a href='#5df0b655fd27197f2d9b200c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576056405000' class='quanto-date posted-at response-posted-at' href='#5df0b655fd27197f2d9b200c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Vladimir</p>

<p>Many thanks for that. There is no specific setting for &quot;leverage&quot; in your code is there? I have spent most of my time trying to work out the Q API to be honest and intended to fix leverage later by normalizing the weights.</p>

<p>I need to work through your code to understand it.</p>

<p>I can&#39;t match your results using your code. Could you post the full version? I get a total return of around 7000% using those settings on your code.</p>

<p>I am nervous about using Optimise to be honest: I would prefer to see exactly how it is done. But I daresay its harmless enough.</p>

<p>Yes, quite agree re slippage.</p>

<p>Is your MOM calculation being done within Pipeline as per the code you posted above, or outside it? I can not achieve those results calculating MOM within pipeline. My results are achieved by calculating MOM outside pipeline.  </p>

<p>Also have you adjusted your code to re-balance weekly as I did or are you rebalancing &quot;date_rules.month_end(days_offset = 7)&quot; as per your code above?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df0cb842c12fa1f49e7de3e' id='5df0cb842c12fa1f49e7de3e'>
<a href='#5df0cb842c12fa1f49e7de3e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576061828000' class='quanto-date posted-at response-posted-at' href='#5df0cb842c12fa1f49e7de3e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anthony,</p>

<p>Happy backtesting.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df0d9b2fd271933499b1ca5' id='5df0d9b2fd271933499b1ca5'>
<a href='#5df0d9b2fd271933499b1ca5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576065458000' class='quanto-date posted-at response-posted-at' href='#5df0d9b2fd271933499b1ca5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anthony,</p>

<p><em>I am nervous about using Optimise to be honest...</em></p>

<pre><code>order_optimal_portfolio(opt.TargetWeights(wt), [opt.MaxGrossExposure(LEV)])  
</code></pre>

<p>doing almost the  same as this:</p>

<pre><code>for sec, weight in wt.items(): order_target_percent(sec, weight)  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df0db63fd271900489b250c' id='5df0db63fd271900489b250c'>
<a href='#5df0db63fd271900489b250c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576065891000' class='quanto-date posted-at response-posted-at' href='#5df0db63fd271900489b250c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Vladimir<br>
Very generous and thank you<br>
A  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df11de5fd2719003c9b26b6' id='5df11de5fd2719003c9b26b6'>
<a href='#5df11de5fd2719003c9b26b6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576082917000' class='quanto-date posted-at response-posted-at' href='#5df11de5fd2719003c9b26b6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>This is how I would approach the over-leverage/shorting issue.  I&#39;ve also simplified the code, while (hopefully) keeping the original logic intact.  (It does briefly over-leverage, probably due to a halted stock, but it&#39;s not bad.)  I&#39;m not sure why the performance lags <a href="https://www.quantopian.com/posts/new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1?utm_campaign=new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1&utm_medium=email&utm_source=forums#5decc8af70156d105fea13af" rel="nofollow">Zenothestoic&#39;s 7301% return version</a> so much, since I tried to match the parameters from that one. Can anyone spot the difference?</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df11fbb26b8a54924e26a87' id='5df11fbb26b8a54924e26a87'>
<a href='#5df11fbb26b8a54924e26a87'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576083387000' class='quanto-date posted-at response-posted-at' href='#5df11fbb26b8a54924e26a87'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anyways, the reason I did the above was to illustrate how if you approach portfolio construction as the creation of a <code>todays_weights</code> dictionary, then it becomes very easy to take it one step further and control the holding period via rolling portfolios. Here I show how to do 20 rolling portfolios that are each held for 20-days, thereby maintaining the same turnover rate as a monthly-rebalance while diversifying away from day-of-the-month overfit noise risk.</p>

<p>As I suspected, in the case of this strategy, it doesn&#39;t make much difference because the quarterly data is super low frequency and turnover was already ridiculously low.  However, this will create more uniform turnover, instead of monthly spikes.  It also allows you to hold more positions at once without resorting to holding positions with weaker alpha signals. Generally, this should lower volatility (via diversification and lower signal-name risk) without sacrificing alpha.</p>

<p>This technique is super useful if you are dealing with an alpha signal that fluctuates faster than the ideal holding period. It also gives you much more granularity than rebalance_weekly and rebalance_monthly.  You can do 10-day or 30-day holding periods. </p>

<p>The only drawback is that it doesn&#39;t keep track of a position&#39;s gains/losses and always rebalances back to its original target weight.  So on the long side it&#39;ll work against you on momentum stocks but to your advantage if the positions tend to mean revert.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df1267428e5491884775b83' id='5df1267428e5491884775b83'>
<a href='#5df1267428e5491884775b83'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1576085108000' class='quanto-date posted-at response-posted-at' href='#5df1267428e5491884775b83'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The following is based on @Anthony&#39;s latest version where I changed the number of stocks to 240 and moved the rebalancing to the beginning of the 
<code>
week_start  
</code> and <code>
market_open  
</code> to make it the same as in @Vladimir&#39;s version. Also commented out the no slippage line.</p>

<p>The surprise is the smoothness of the equity curve and how it passed the financial crisis with barely a dip, considering that period&#39;s market turmoil.</p>

<p>For some reason, the strategy did not trade the 240 stocks as requested but only about 50-53. Nonetheless, for a long only strategy, it is a remarkable equity curve with low volatility and low drawdowns.</p>

<p>Now, the problem becomes keeping the smoothness of the equity curve and raising its outcome. But first, there is a need to know why it did not trade the 240 stocks.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df174f742c4fc3ae7dfb728' id='5df174f742c4fc3ae7dfb728'>
<a href='#5df174f742c4fc3ae7dfb728'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54527c018d92c746f20003be'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/420d9d6b2858f6f1aa186a5bf9dc4bc0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54527c018d92c746f20003be'>Manfred Bastero</a>
</div>
<a UTCms='1576105207000' class='quanto-date posted-at response-posted-at' href='#5df174f742c4fc3ae7dfb728'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Guy, i believe it&#39;s not trading 240 stocks and only 50 because of this constraint in the code: indebted = ltd_to_eq_rank.top(50,mask=universe  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df2007842c4fc004ddfbbd3' id='5df2007842c4fc004ddfbbd3'>
<a href='#5df2007842c4fc004ddfbbd3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576140920000' class='quanto-date posted-at response-posted-at' href='#5df2007842c4fc004ddfbbd3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Changed  N_ Q   t  o  60</p>

<p>QTU = Q3000US();  MKT = symbol(&#39;SPY&#39;); BONDS = symbols(&#39;IEF&#39;, &#39;TLT&#39;);<br>
MOM = 126; EXCL = 2; N = 5; N_Q = 60; MA_F = 10; MA_S = 100; LEV = 1.0;  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df24dbed2e7b425e8de89e0' id='5df24dbed2e7b425e8de89e0'>
<a href='#5df24dbed2e7b425e8de89e0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576160702000' class='quanto-date posted-at response-posted-at' href='#5df24dbed2e7b425e8de89e0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Vladimir</p>

<p>For my taste, I would not invest in the US long bond.  The 7 to 10 year is already ritzy enough and may or may not offer protection in a stock market crash. In my testing, the long bond has sometimes been 90% correlated to stocks and had a VAST draw down in the early 1980s Volker interest rate rise regime.</p>

<p>In fact I might even down grade to IEI.</p>

<p>But who am I to say....</p>

<p>Super return anyway!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df2e1d04cdc7b0048794f22' id='5df2e1d04cdc7b0048794f22'>
<a href='#5df2e1d04cdc7b0048794f22'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1576198608000' class='quanto-date posted-at response-posted-at' href='#5df2e1d04cdc7b0048794f22'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Could someone please help me in getting this code right. I am trying to weight the portfolio according the strength of rank rather than equally weighting them. I am trying to use - wt_stk = output.quality / output.quality.sum() line instead of original - wt_stk = LEV/len(stocks). But it gives me a runtime error - TargetWeights() expected a value with dtype &#39;float64&#39; or &#39;int64&#39; for argument &#39;weights&#39;, but got &#39;object&#39; instead.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df30e7aed3d1c004019f2cc' id='5df30e7aed3d1c004019f2cc'>
<a href='#5df30e7aed3d1c004019f2cc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576210042000' class='quanto-date posted-at response-posted-at' href='#5df30e7aed3d1c004019f2cc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Nadeem -- I think you need to do something more like <code>wt_stk = output.quality[s] / output.quality.sum()</code>  Note the [s]  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df35a1a0059865a829ec7ad' id='5df35a1a0059865a829ec7ad'>
<a href='#5df35a1a0059865a829ec7ad'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576229402000' class='quanto-date posted-at response-posted-at' href='#5df35a1a0059865a829ec7ad'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Nadeen Ahmed</p>

<p>I dealt with the weighting as follows. This allows stocks to run but also allows new stocks to come in.  </p>

<pre><code>    context.stock_weights = pd.Series(index=top_n_by_momentum.index , data=0.0)  
    context.bond_weights = pd.Series(index=[context.bonds], data=0.0)  

    for x in context.portfolio.positions:  
        if x in top_n_by_momentum and (x.sid != context.bonds):  
            a=context.portfolio.positions[x].amount  
            b=context.portfolio.positions[x].last_sale_price  
            c=context.portfolio.portfolio_value  
            s_w=(a*b)/c  
            context.stock_weights.set_value(x,s_w)  
        if (x not in top_n_by_momentum) and (x.sid != context.bonds):  
            order_target_percent(x, 0)  
    for x in top_n_by_momentum.index:  
        if x not in context.portfolio.positions and context.TF_filter==True:  
            context.stock_weights.set_value(x,1.0 / context.Target_securities_to_buy)

    if context.stock_weights.sum()&gt;1:  
        stocks_norm=(1.00/context.stock_weights.sum())  
        context.stock_weights=context.stock_weights*stocks_norm  
        context.bond_weights.set_value(context.bonds,0.0)  
    else:  
        context.bond_weights.set_value(context.bonds,1-context.stock_weights.sum())  
    total_weights = pd.concat([context.stock_weights, context.bond_weights])

    for index, value in total_weights.iteritems():  
        order_target_percent(index, value)  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df367f2ed3d1c004919f5ed' id='5df367f2ed3d1c004919f5ed'>
<a href='#5df367f2ed3d1c004919f5ed'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576232946000' class='quanto-date posted-at response-posted-at' href='#5df367f2ed3d1c004919f5ed'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Viridian Hawk</p>

<blockquote>
<p>This is how I would approach the over-leverage/shorting issue. I&#39;ve also simplified the code, while (hopefully) keeping the original logic intact. (It does briefly over-leverage, probably due to a halted stock, but it&#39;s not bad.) I&#39;m not sure why the performance lags Zenothestoic&#39;s 7301% return version so much, since I tried to match the parameters from that one. Can anyone spot the difference?</p>
</blockquote>

<p>It is because I calculate momentum OUTSIDE pipeline.  This whole muck up about Window_Safe as mentioned in one of my posts above is what makes the difference.</p>

<p>Prices are adjusted for splits/consolidations/dividends anyway so I don&#39;t understand why this Window_Safe junket.  Also if you Window_Safe for Return() I don&#39;t understand why Q does NOT Window_Safe for a moving average.</p>

<p>Anyway life is too short to worry about it. I always base my systems on adjusted prices and don&#39;t muck about any further. I have no idea what this additional &quot;normalisation&quot; is all about and I mistrust what I can not see. Hence my dislike of optimise also.</p>

<p>But perhaps I am just an ignorant Luddite.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df369aa0059863dbe9ec874' id='5df369aa0059863dbe9ec874'>
<a href='#5df369aa0059863dbe9ec874'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576233386000' class='quanto-date posted-at response-posted-at' href='#5df369aa0059863dbe9ec874'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Since  a) I can&#39;t be arsed to place weekly trades manually and b) there is no live trading on Quantopian, I&#39;m off to try and replicate this on Quantconnect.</p>

<p>Anyone got any other ideas vis a vis the simplest way to automate?</p>

<p>I absolutely do NOT want to have to muck about obtaining stock and fundamental data and then load it all in the cloud. And then work out how to link it all up to a broker.</p>

<p>I have a habit of disappearing down rabbit holes for months, and I have a feeling if I tried to go it alone, I would never re-emerge.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df3b9ce0059863ed89ec7ab' id='5df3b9ce0059863ed89ec7ab'>
<a href='#5df3b9ce0059863ed89ec7ab'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bffd3f26fe48d25d5a9b0f4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/04ab116b535328bd5404b02f1ea9d996?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bffd3f26fe48d25d5a9b0f4'>John Sawyer</a>
</div>
<a UTCms='1576253902000' class='quanto-date posted-at response-posted-at' href='#5df3b9ce0059863ed89ec7ab'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I understand this may be a novice question, but I am wondering about the quality measure used.  Is there some “look forward” bias due to back testing vs. live trading? The quality factor used for the algo gathers the “latest” measure (roe, ltd_to_eq, etc.).  Assuming most measures are based on quarterly data the Morningstar database reports the measure for the end of the quarter.  Then, the back testing algo uses that data.  </p>

<p>For example, when back testing the algo on January 31, 2019, it would pull the measures for December 31, 2018 (the latest end of quarter).  However, in live trading we would most likely not know the December 31, 2018 measure on January 31, 2019.  The company had probably not reported earnings by January 31.  In real time if we screened the stocks on January 31, we would most likely get rankings based on the end of the 3rd quarter 2018.  </p>

<p>Again, I am new to platform and perhaps the Morningstar database only reports figures that coincide with reporting dates?  But that would seem odd.  I have very limited Python skills but am wondering what the results look like if we lag the fundamental measures by a quarter?  If my description of reporting date vs. database date is correct, I believe the way to accurately reflect live trading is to use the “known” measures.  In some cases, it would be the “latest” as used in the algo.  But in some cases, the correct fundamental measures would need to be lagged one quarter.<br>
Your feedback is welcome.  Thank you.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df3cc38ed3d1c029419f0b6' id='5df3cc38ed3d1c029419f0b6'>
<a href='#5df3cc38ed3d1c029419f0b6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576258616000' class='quanto-date posted-at response-posted-at' href='#5df3cc38ed3d1c029419f0b6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@John Sawyer, Quantopian timestamps data according to when it was actually available.  On historical data that predates Quantopian&#39;s real-time collecting, I believe they add a conservative delay to ensure there is no look ahead bias.  There is no need to delay data by one quarter.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df3de3dfd94da0044a72718' id='5df3de3dfd94da0044a72718'>
<a href='#5df3de3dfd94da0044a72718'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576263229000' class='quanto-date posted-at response-posted-at' href='#5df3de3dfd94da0044a72718'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Part of the reason why the original version over-leverages is this logic:</p>

<pre><code>    for x in top_n_by_momentum.index:  
        if x not in context.portfolio.positions and context.TF_filter==True:  
            order_target_percent(x, (1.0 / context.Target_securities_to_buy))  
            print(&#39;GETTING IN&#39;,x)  
</code></pre>

<p>New positions are given a 5% weight, but existing positions are allowed to grow above their original 5% allocation.  Since most positions are expected to generate a return (gain weight), the sum of the 20 position weights will be greater than 100%.</p>

<p>The version I posted solves this problem by adjusting all positions back to equal-weight at each rebalance.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df3e24efd94da65a4a72241' id='5df3e24efd94da65a4a72241'>
<a href='#5df3e24efd94da65a4a72241'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576264270000' class='quanto-date posted-at response-posted-at' href='#5df3e24efd94da65a4a72241'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Zeno, I figured out the discrepancy between my version and yours. Looks like momentum works just as fine inside of pipeline as out, and there is no window safe issue.  What I missed was the change from sma50/200 for the trend filter to 10/100.   That change contributes significant improvement!  If in addition I allow over-leveraging as I described in my previous post, my results are starting to look pretty close to yours.</p>

<p>While I&#39;ll generally agree that a bear market filter is a good idea, I&#39;m concerned that as soon as you start tweaking those settings, you&#39;re drifting into curve-fitting territory.  Finding the ideal historical SMAs probably isn&#39;t going to be any more predictive than choosing one at random.  Intuitively there are so many variables -- VIX, interest rates, volume, P/E, sentiment -- that simply looking at SMA crossovers is more like looking at the symptom than the cause. The reality is that it&#39;s going to behave erratically.  Perhaps there is a more fundamental metric we can use to determine when high lt debt-to-equity companies start to underperform.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df3e4a2fd94da7f2ca72024' id='5df3e4a2fd94da7f2ca72024'>
<a href='#5df3e4a2fd94da7f2ca72024'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576264866000' class='quanto-date posted-at response-posted-at' href='#5df3e4a2fd94da7f2ca72024'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Weird. I must check inside the pipeline version again. Totally agree on curve fitting. I will trade this but it WILL be very eratic.  Pity we can&#39;t see what happened in the tech crash of 2000.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df3e52ded3d1c7fab19f333' id='5df3e52ded3d1c7fab19f333'>
<a href='#5df3e52ded3d1c7fab19f333'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576265005000' class='quanto-date posted-at response-posted-at' href='#5df3e52ded3d1c7fab19f333'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>As you can see I solved over leverage in a different way.  I placed my code in this thread a few entries above. My version was more of a trend following version. No equal weighting.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df3ed744cdc7b67f2795016' id='5df3ed744cdc7b67f2795016'>
<a href='#5df3ed744cdc7b67f2795016'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1576267124000' class='quanto-date posted-at response-posted-at' href='#5df3ed744cdc7b67f2795016'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Viridian, there are still leverage spikes, even in your version. They occur when exiting from bonds. As if, at rebalancing, not all the bonds are sold. Note, that I tested with the no-slippage line commented out to give it a more realistic outcome. Also, initial capital was at $10M, and the number of stocks at 100.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df4523a999cef0048996e12' id='5df4523a999cef0048996e12'>
<a href='#5df4523a999cef0048996e12'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576292922000' class='quanto-date posted-at response-posted-at' href='#5df4523a999cef0048996e12'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy -- At $10m book w/slippage enabled it&#39;s not surprising that not all orders are getting filled, especially as the account grows. If it&#39;s limited liquidity on the bond ETF that&#39;s causing problems, you could distribute your bond position between more liquid ETFs like TLT. Also, I&#39;m aware my version over-leverages occasionally due to halted stocks as well, but I figure those aren&#39;t worth worrying about, since they aren&#39;t inflating the backtest returns in the same way over-leveraging on non-halted stocks does. Another consideration, many companies in the Russell 3000 aren&#39;t liquid enough for a $10m-$1t account, so I would do some market-cap weighting if you want to trade such a large book, though of course that will hurt returns.  I wouldn&#39;t trade $10m with this strategy, but if you were to do so, it would be wise to put in some extra execution logic in order to minimize slippage. Alpha decay is very low, so you can take your time legging in and out of positions if need be.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df45e5e64b683004bc1b100' id='5df45e5e64b683004bc1b100'>
<a href='#5df45e5e64b683004bc1b100'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576296030000' class='quanto-date posted-at response-posted-at' href='#5df45e5e64b683004bc1b100'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Moved trade execution to market_open().<br>
QTU = Q3000US(); MKT = symbol(&#39;SPY&#39;); BONDS = symbols(&#39;TLT&#39;, &#39;IEF&#39;); MIN = 1;<br>
MOM = 126; EXCL = 2; N = 5; N_Q = 60; MA_F = 10; MA_S = 100; LEV = 1.0;  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df51b5b4fcfe50047b0ecc1' id='5df51b5b4fcfe50047b0ecc1'>
<a href='#5df51b5b4fcfe50047b0ecc1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576344411000' class='quanto-date posted-at response-posted-at' href='#5df51b5b4fcfe50047b0ecc1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>EXCL = 2; </p>
</blockquote>

<p>I&#39;m finding Zeno is right, best to eliminate the momentum exclusion altogether.</p>

<blockquote>
<p>Moved trade execution to market_open()</p>
</blockquote>

<p>Is the idea that in live trading you would use OPG/MOO orders?  Otherwise spreads are too wide at open and Quantopian&#39;s fill model is going to be much too generous, especially on the small caps.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df52193999cef4912996d6c' id='5df52193999cef4912996d6c'>
<a href='#5df52193999cef4912996d6c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576346003000' class='quanto-date posted-at response-posted-at' href='#5df52193999cef4912996d6c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>TBH, yes. I am intending to do just that.  I&#39;m currently mucking about trying to get Quantconnect up and running. It&#39;s not laziness but I know I would loathe having to put the orders in manually. I also want to work on a few other filters (other than indebtedness) to see if there is something else I can complement this with. Momentum again, but hopefully with a different filter to ensure I end up with different stocks.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df53831aa6cc40047399c9c' id='5df53831aa6cc40047399c9c'>
<a href='#5df53831aa6cc40047399c9c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576351793000' class='quanto-date posted-at response-posted-at' href='#5df53831aa6cc40047399c9c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>We&#39;ve been juicing this algorithm&#39;s results without a hold-out.  I&#39;m going to put it on my calendar to check back in 6-months to a year and see whether any of what we did improved the OOS performance.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df54729999cef4912996e92' id='5df54729999cef4912996e92'>
<a href='#5df54729999cef4912996e92'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576355625000' class='quanto-date posted-at response-posted-at' href='#5df54729999cef4912996e92'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>A possible alternative is to go back and year by year  work out parameters which produce &quot;average results&quot;. In a sense that would be OOS. </p>

<p>Probably as good as looking at the optimal parameters in six months time.</p>

<p>In other words if you want to trade 5 stocks, keep that as a constant and fiddle around to find the average best days to re-balance and so on. Don&#39;t pick the worst or the best but somewhere in the middle.</p>

<p>We know well of course that the future will only vaguely resemble the past, and in that regard, no amount of hold out guarantees future results. No does the use of average parameters of course, but perhaps it may prove a useful exercise.</p>

<p>So you might end up trading parameters which have produced results off the very bottom and off the very top. Somewhere in the middle. You may have noticed that with some of the parameters, gradual changes occasioned quite smooth correlated  moves in the equity curve.</p>

<p>For instance reducing the momentum exclusion from 10 incrementally down to 0 produced a steadily increasing equity curve. So its probably as worth fiddling around with this as waiting six months.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df56870aa6cc40047399de9' id='5df56870aa6cc40047399de9'>
<a href='#5df56870aa6cc40047399de9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1576364144000' class='quanto-date posted-at response-posted-at' href='#5df56870aa6cc40047399de9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@vladimir - A quick question. Are those results without default slippage and transaction cost? I used same variables with weekly re-balance and commented out 0 slippage cost line. I am getting only half of your return. 15923% to be precise.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df56f1364b68350d4c1b20c' id='5df56f1364b68350d4c1b20c'>
<a href='#5df56f1364b68350d4c1b20c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576365843000' class='quanto-date posted-at response-posted-at' href='#5df56f1364b68350d4c1b20c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Nadeem,</p>

<p><em>Are those results without default slippage and transaction cost?</em><br>
With commented # set_slippage(slippage.FixedSlippage(spread = 0.0)). Why cheat yourself?<br>
I did not change anything in trade().<br>
What is your definition of quality in pipeline?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df5774e999cef3871996d18' id='5df5774e999cef3871996d18'>
<a href='#5df5774e999cef3871996d18'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1576367950000' class='quanto-date posted-at response-posted-at' href='#5df5774e999cef3871996d18'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>wow, so i m getting only half of your result.  I must be missing something crucial. I am using algo from Anthony. It is using only the following</p>

<p>indebted = ltd_to_eq_rank.top(60,mask=universe)</p>

<p>and then choosing top 5 momentum from those 60.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df5859d64b6833db5c1b2e9' id='5df5859d64b6833db5c1b2e9'>
<a href='#5df5859d64b6833db5c1b2e9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576371613000' class='quanto-date posted-at response-posted-at' href='#5df5859d64b6833db5c1b2e9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>amazing to find signal in this sort of noise.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df6076795bce0004a876144' id='5df6076795bce0004a876144'>
<a href='#5df6076795bce0004a876144'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576404839000' class='quanto-date posted-at response-posted-at' href='#5df6076795bce0004a876144'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Mr V Hawk<br>
Would you be kind enough to interpret that chart for me? I am not clear what it is purporting to show?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df60d2895bce0003e87611e' id='5df60d2895bce0003e87611e'>
<a href='#5df60d2895bce0003e87611e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5469bca83ab3de7bff000334'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4c4ecac20f2ccee61491516e54b67f72?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5469bca83ab3de7bff000334'>Tony Morland</a>
</div>
<a UTCms='1576406312000' class='quanto-date posted-at response-posted-at' href='#5df60d2895bce0003e87611e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>:-)</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df6287ca8c9d8004938a79c' id='5df6287ca8c9d8004938a79c'>
<a href='#5df6287ca8c9d8004938a79c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576413308000' class='quanto-date posted-at response-posted-at' href='#5df6287ca8c9d8004938a79c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Blue dots are forward 60-day gains, red dots are forward 60-day losses. Size of dot is size of gain/loss. X axis is the raw debt-to-equity value, and y axis is the 125-day return (which this algo has been using as &quot;momentum&quot;).  First chart shows how noisy this data is. Second chart is more in the region the algo acts on and you can kind of see more blue in the top quadrant.  I was just curious if viewing the data this would give any insights.  I don&#39;t think so, but mostly it&#39;s just pretty to look at.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df64a598199e900431f0038' id='5df64a598199e900431f0038'>
<a href='#5df64a598199e900431f0038'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576421977000' class='quanto-date posted-at response-posted-at' href='#5df64a598199e900431f0038'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Many thanks. Back to square one then I guess and either taking a punt or waiting through an OOS period. No guarantees either way of course!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df69299a8c9d8004638aab8' id='5df69299a8c9d8004638aab8'>
<a href='#5df69299a8c9d8004638aab8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1576440473000' class='quanto-date posted-at response-posted-at' href='#5df69299a8c9d8004638aab8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Viridian, your two charts are what you should have expected to find. The same kind of results as was found in the late &#39;60s and thereafter, that we still have to contend with today.</p>

<p>However, those two charts do say a lot. The short-term forward mean return is close to 0.0. However, even from a visual inspection, we can see a slight upward edge from the mostly bell-shaped distribution. There is a signal in there, but it is faint. Nonetheless, it does carry the long-term market average upward drift.</p>

<p>The chart also says how difficult it is to capture the positive side of those dots since a lot of randomness will have to be addressed. And by the very nature of the distribution, high hit rates will be difficult to achieve.</p>

<p>Discriminating those dots becomes a statistical problem in a tumultuous and quasi-unpredictable sea of variances.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df6a344a8c9d8004338aba0' id='5df6a344a8c9d8004338aba0'>
<a href='#5df6a344a8c9d8004338aba0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1576444740000' class='quanto-date posted-at response-posted-at' href='#5df6a344a8c9d8004338aba0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Why choose a 60 day return? Might not 20 days be more appropriate for monthly trading?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df6e51ff8d1265d5409eecb' id='5df6e51ff8d1265d5409eecb'>
<a href='#5df6e51ff8d1265d5409eecb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1576461599000' class='quanto-date posted-at response-posted-at' href='#5df6e51ff8d1265d5409eecb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Viridian, in reference to <a href="https://www.quantopian.com/posts/new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1#5df4523a999cef0048996e12" rel="nofollow">your post</a>, yes, agree. I had the same observations.</p>

<p>I am testing the limits and uses of this type of trading strategy. Currently, my interest is two-fold. How does it behave when you scale it up? And, a much more interesting question: how much of it can you anticipate?</p>

<p>This strategy can be viewed as a fixed fraction of equity position sizing with equal weighing monthly scheduled rebalancing, like many on this site. Its move to safety is a switch to bonds on a SPY 50-200 SMA crossover. On small quantities of stocks (5 to 20) and on relatively small initial capital (10k to 100k) it appears to be doing fine. However, most of those simulations here are on the same 5 or 20 stocks as they are using the same stock selection process. Nonetheless, the bet sizes start relatively small (2k to 20k for the 5-stock scenario and from 5k to 20k for the 100k scenario). The bet size varies from 5% to 20% of equity which, in general, would tend to make the proposition riskier. It could be viewed as a high portfolio concentration, especially at the 20% bet sizing level.</p>

<p>The nature of the problem changes as you increase the initial capital further. And if you want to play at higher levels, you will need your trading strategy to adapt to such an environment. </p>

<p>The ability of a trading strategy to scale up should almost be a prerequisite. You want to know if it can scale or not since it is designed to grow, and at an exponential rate at that. Also, since the strategy&#39;s stock selection process always results in the same ranking for the same stocks, you want to know how it will handle more stocks and/or a different selection in order to spread market risks to more than just 5 to 20 stocks.</p>

<p>The projected number of trades using the top 100-ranked stocks, as per the chart in a prior post, was 11,320. The backtest using your version of the program came in with 10,517 trades. Almost within its anticipated range of 10,613 to 11,497 over the trading interval (that is within 1% of the lower range&#39;s reach). Likewise, the projected CAGR was from 15.10% to 15.94%. The backtest came in with 15.03%.</p>

<p>What is remarkable here is that we can make such a projection (I have formulas and equations for that), not for a week or a month ahead, but for, in this case, a 16.7-year interval. And, these projections fell pretty close to the actual simulation result (look at the cited post above). </p>

<p>Putting these projections at play for big long-term targeted return funds opens up an interesting door for this type of strategy. As a matter of fact, any trading strategy where you could project that far into the future with a reasonable approximation could greatly benefit from those structural scaling capabilities.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dfa69ecf2f64d3e1ad0556e' id='5dfa69ecf2f64d3e1ad0556e'>
<a href='#5dfa69ecf2f64d3e1ad0556e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5673f0630a6bfa534b00000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/147dbb7c6d5789fd351a368486558c2a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5673f0630a6bfa534b00000d'>Giuseppe Moriconi</a>
</div>
<a UTCms='1576692204000' class='quanto-date posted-at response-posted-at' href='#5dfa69ecf2f64d3e1ad0556e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello I would like to give my little contribution to this also by putting the stock picking logic (first selection by ROE then more selection by momentum) inside each single sector, and the logic of sectors selection is basically <a href="https://www.quantopian.com/posts/momentum-value-and-a-little-bit-of-mean-reverting" rel="nofollow">this one</a>.<br>
It does not make huge money but I like the idea of <strong>sectors diversification</strong>, and also i like to <strong>compare fundamentals inside each sector separately</strong>  beacuse i think it gives more robustness to the algo, and maybe someone could improve this.<br>
Hope to be not too much “off topic” in regard to the original algo.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dfac688e4de215540399086' id='5dfac688e4de215540399086'>
<a href='#5dfac688e4de215540399086'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5df7162897bf21523f5b2a79'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1092c7f602521302b24e1c88d0c1e273?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5df7162897bf21523f5b2a79'>Andy Huynh</a>
</div>
<a UTCms='1576715912000' class='quanto-date posted-at response-posted-at' href='#5dfac688e4de215540399086'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Sorry in advance for a newbie question but I cannot seem to find this answer anywhere.  How do I get the current stock symbols for this model ?  Do I have to write some code to output the current symbols ?  </p>

<p>Thanks.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dfaccb35da04e003c5f818f' id='5dfaccb35da04e003c5f818f'>
<a href='#5dfaccb35da04e003c5f818f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1576717491000' class='quanto-date posted-at response-posted-at' href='#5dfaccb35da04e003c5f818f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Andy, probably the easiest is to run a &quot;full backtest&quot; through the most recent date and navigate to &quot;Activity&quot; -&gt; &quot;Positions&quot; and you&#39;ll see the positions organized by date.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dffc761f14795004a2b68a5' id='5dffc761f14795004a2b68a5'>
<a href='#5dffc761f14795004a2b68a5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d7ff4bd36e9942b32e7a4ed'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e672534e241d465d44a44d0ac2e3ff7b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d7ff4bd36e9942b32e7a4ed'>Peter Eriksson</a>
</div>
<a UTCms='1577043809000' class='quanto-date posted-at response-posted-at' href='#5dffc761f14795004a2b68a5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Sorry for some more newbie questions.. When I ran the backtest on the original Algo I noticed:</p>

<ol>
<li>  It is a bit confusing to see that the cash becomes negative (e.g. -$92,363.61 on 2019-11-18). Why is that?<br></li>
<li>  There are a couple of leverage spikes of about 2x (e.g. on 04/04/10). Why does that happen? Does that mean we need to borrow (e.g. on margin) $100,000 for those days?</li>
</ol>

<p>EDIT: 3. Oh, and one more thing.  In actual trading, since the backtest only gives the previous days data we need to do the actual rebalancing the next day with our broker.  I wonder if the backtest results of the Algo would change if this would be incorporated in the Algo? For example: Do the evaluation at closing at the last day of the month, and then do the actual rebalancing the following day (e.g. at 12 PM if the backtest data would be available then).<br>
I don&#39;t know enough of Quantopian/Python yet to test if this would make a difference in performance. </p>

<p>(p.s. I am used to Tradestation and in strategies with daily data, I would evaluate after closing and place potential orders for the opening at the next day).</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e03324618cedb5dfb627baf' id='5e03324618cedb5dfb627baf'>
<a href='#5e03324618cedb5dfb627baf'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5673f0630a6bfa534b00000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/147dbb7c6d5789fd351a368486558c2a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5673f0630a6bfa534b00000d'>Giuseppe Moriconi</a>
</div>
<a UTCms='1577267782000' class='quanto-date posted-at response-posted-at' href='#5e03324618cedb5dfb627baf'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I have noticed that if you comment out the maket cap filter in pipeline the strategy performs better.<br>
What are the main risks on doing that that one can encounter during live trading?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e076493f226df15c5e07a6a' id='5e076493f226df15c5e07a6a'>
<a href='#5e076493f226df15c5e07a6a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1577542803000' class='quanto-date posted-at response-posted-at' href='#5e076493f226df15c5e07a6a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Chris, @Joakim</p>

<p>according to “Berrnstein, style investing, 1995“ (book) the risk/return characteristic of quality measures in stocks favor low quality.<br>
In their example they used the S&amp;P quality rating, A+ to D, were A+ has the highest quality.</p>

<p>From 1986 to 1994<br>
A+ achieved a mean return of 9.57% (yearly) with a std. dev of 14.83%.<br>
C/D got a mean return of 19.28% with a std.dev. of 27.66.<br>
The other ranks behave accordingly (B 13.91%)<br>
(Source: Merrill Lynch Quantative Analysis)</p>

<p>This explains why the changes from Joakim boosted the performance.<br>
It might be probably a good idea to combine low quality with momentum.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e07845421de2a2ed241d704' id='5e07845421de2a2ed241d704'>
<a href='#5e07845421de2a2ed241d704'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5903b419886982000d186b53'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ec944215e7fb29b0e5ae46c28f97693f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5903b419886982000d186b53'>rogoman</a>
</div>
<a UTCms='1577550932000' class='quanto-date posted-at response-posted-at' href='#5e07845421de2a2ed241d704'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ carsten</p>

<p>Generally saying: &quot;combine low quality with momentum&quot; is wrong.</p>

<p>It ist widely known (research by novy-marx, aqr, ...) that the quality factor (long/short) is a source of equity outperformance and it might work long only as well. As far as I know low D/E (leverage) is not the the favored choice for the quality factor, and if it used than only as part of a larger quality composite. Norges Bank has a study showing that. Most often profitabilty ratios are used for quality. </p>

<p>By the way high D/E in combination with small size and value is used by Rasmussen to replicate a cheaper and public version of private equity investing.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e0791ce21de2a2d2741d6fe' id='5e0791ce21de2a2d2741d6fe'>
<a href='#5e0791ce21de2a2d2741d6fe'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1577554382000' class='quanto-date posted-at response-posted-at' href='#5e0791ce21de2a2d2741d6fe'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@rogoman</p>

<p>yes, this is what I read a lot.</p>

<p>BUT interestingly other publications state the opposite.<br>
The book from Richard Bernstein was quite interesting in that point.<br>
It&#39;s a bit old, but they show that low quality can be a source of alpha, as long as borrowing cost is low.<br>
It always depends in which market cycle we are.<br>
(The author was the Head of quantative equity at Merrill Lynch)</p>

<p>As an example, Tesla is not making any money at the moment but the return for their shareholders was not that bad since 2010.</p>

<p>I got the book, because I wanted to understand why my small, value, momentum did not work.<br>
(it performed great some years ago in backtest but actually does not work the last years)
So far I liked the book, unfortunately only in analog format, which is difficult to read...I like to read during commute<br>
<a href="https://www.amazon.com/Style-Investing-Unique-Insight-Management/dp/047103570X" rel="nofollow">https://www.amazon.com/Style-Investing-Unique-Insight-Management/dp/047103570X</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e079eaeab1cda23925b7001' id='5e079eaeab1cda23925b7001'>
<a href='#5e079eaeab1cda23925b7001'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5903b419886982000d186b53'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ec944215e7fb29b0e5ae46c28f97693f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5903b419886982000d186b53'>rogoman</a>
</div>
<a UTCms='1577557678000' class='quanto-date posted-at response-posted-at' href='#5e079eaeab1cda23925b7001'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ carsten</p>

<p>Factor strategies don&#39;t work all the time, they work on average. That might be a reason why they still work. If they had worked all the time, they would have been arbitraged away and we would not be talking about these factors/styles whatever you want to call them anymore.</p>

<p>Also: I dont know what you small, value, momentum strategy looks like but if you bought a couple of stocks of these characteristics, dont be surprised if they dont work at all. Again this is statistics, this stuff works on average not all the time and not all stocks or all coupe of stocks.</p>

<p>I would recommend this book as a starter : <a href="https://www.amazon.com/Your-Complete-Guide-Factor-Based-Investing/dp/0692783652/ref=sr_1_1?crid=3OPUCZY5UJ5JQ&keywords=factorbased+investing&qid=1577557634&sprefix=factor+based+%2Caps%2C236&sr=8-1" rel="nofollow">https://www.amazon.com/Your-Complete-Guide-Factor-Based-Investing/dp/0692783652/ref=sr_1_1?crid=3OPUCZY5UJ5JQ&amp;keywords=factorbased+investing&amp;qid=1577557634&amp;sprefix=factor+based+%2Caps%2C236&amp;sr=8-1</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e0e3a3a70dbda4c608a838d' id='5e0e3a3a70dbda4c608a838d'>
<a href='#5e0e3a3a70dbda4c608a838d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5420c95fdbad621be9000079'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ee66334d0a7b6dcad241f2127237830c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5420c95fdbad621be9000079'>Nathan</a>
</div>
<a UTCms='1577990714000' class='quanto-date posted-at response-posted-at' href='#5e0e3a3a70dbda4c608a838d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m intrigued by this strategy, and started messing around with it a bit in my spare time. Nothing to really improve on, but in the version I am testing, using the universe Q1500US performed better over the long-run. Still can&#39;t get close to @Vladimir 40.1% annual return, but closer than it was (Still seems to have a leverage issue, as cash drifts to $-65,718.98 on 2018-08-22 at one point even though leverage is at 1 [context.portfolio.cash], still looking into that...I think it is because some orders failed to fill...but not sure). 2018-07-20 13:00 WARN Your order for -6189 shares of OEC has been partially filled. 4165 shares were successfully sold. 2024 shares were not filled by the end of day and were canceled. But I would think order_optimal_portfolio should realize the sale didn&#39;t go through and not over order...anyone have insight into this?</p>

<p>EDIT: The negative cash is for sure from the unfilled orders - if I use set_slippage(slippage.FixedSlippage(spread = 0.0))  then it only goes to about $-300 starting with $10,000 which is definitely a weak point of only buying into 5 stocks - once you have significant capital you&#39;ll have trouble filling the orders in real life.</p>

<p>I&#39;m interested in looking at optimizing the code with something like this: <a href="https://ntguardian.wordpress.com/2017/06/12/getting-started-with-backtrader/" rel="nofollow">https://ntguardian.wordpress.com/2017/06/12/getting-started-with-backtrader/</a> (look at the Optimization section). Does anyone know if that is possible in Quantopian? It would be great to test all the variables and come up with the best outcome (instead of manually changing the variables and backtesting).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e0e3a6670dbda00468a8458' id='5e0e3a6670dbda00468a8458'>
<a href='#5e0e3a6670dbda00468a8458'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5420c95fdbad621be9000079'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ee66334d0a7b6dcad241f2127237830c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5420c95fdbad621be9000079'>Nathan</a>
</div>
<a UTCms='1577990758000' class='quanto-date posted-at response-posted-at' href='#5e0e3a6670dbda00468a8458'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s a notebook based on @Vladimir notebook for some more stats  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e0ea430c4c5e100477d46a8' id='5e0ea430c4c5e100477d46a8'>
<a href='#5e0ea430c4c5e100477d46a8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d7ff4bd36e9942b32e7a4ed'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e672534e241d465d44a44d0ac2e3ff7b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d7ff4bd36e9942b32e7a4ed'>Peter Eriksson</a>
</div>
<a UTCms='1578017840000' class='quanto-date posted-at response-posted-at' href='#5e0ea430c4c5e100477d46a8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Vladimir.<br>
Sorry for being a novice about this, but did you publish the modified Algorithm to generate the notebook with &quot;Annual return    40.1%&quot;?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e102678bbbe1c004acdf1a4' id='5e102678bbbe1c004acdf1a4'>
<a href='#5e102678bbbe1c004acdf1a4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5420c95fdbad621be9000079'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ee66334d0a7b6dcad241f2127237830c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5420c95fdbad621be9000079'>Nathan</a>
</div>
<a UTCms='1578116728000' class='quanto-date posted-at response-posted-at' href='#5e102678bbbe1c004acdf1a4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Highest I can get so far is 18915.42 % - here&#39;s code for anyone else wanting to tinker with it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e140887750d90003e8761d6' id='5e140887750d90003e8761d6'>
<a href='#5e140887750d90003e8761d6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5420c95fdbad621be9000079'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ee66334d0a7b6dcad241f2127237830c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5420c95fdbad621be9000079'>Nathan</a>
</div>
<a UTCms='1578371207000' class='quanto-date posted-at response-posted-at' href='#5e140887750d90003e8761d6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Well, I got there...32,051.054%<br>
I think in a different way than @Vladimir but still an interesting algorithm. Still have an issue with leverage, at one point cash went -$16,016 but given that the portfolio value was at $2.4 million by that point (starting with $10k in 2003) I don&#39;t think it effected things too much, but I could be wrong. But the trading day really seems to have a large impact as @Peter Harrington showed.</p>

<p>So while I&#39;m sure this isn&#39;t real life it still is a very interesting algorithm, especially because of how simple it is. Thanks for posting it @Chris Cain and for all those who worked on it as well!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e145cb280950a004005e63e' id='5e145cb280950a004005e63e'>
<a href='#5e145cb280950a004005e63e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d7ff4bd36e9942b32e7a4ed'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e672534e241d465d44a44d0ac2e3ff7b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d7ff4bd36e9942b32e7a4ed'>Peter Eriksson</a>
</div>
<a UTCms='1578392754000' class='quanto-date posted-at response-posted-at' href='#5e145cb280950a004005e63e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Nathan,<br>
Would you mind sharing your code for the 32,051.054% return?<br>
TIA!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e15b72643e4a4004b3fedf6' id='5e15b72643e4a4004b3fedf6'>
<a href='#5e15b72643e4a4004b3fedf6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56854bfeab8663647300029d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f7a78407c7fa1986e9fa6bb2fae2f2cf?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56854bfeab8663647300029d'>Oleg Kudrin</a>
</div>
<a UTCms='1578481446000' class='quanto-date posted-at response-posted-at' href='#5e15b72643e4a4004b3fedf6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>One more way to evaluate company&#39;s quality, Piotroski Score <a href="https://www.investopedia.com/terms/p/piotroski-score.asp" rel="nofollow">https://www.investopedia.com/terms/p/piotroski-score.asp</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e166adaa9cb3600451528f5' id='5e166adaa9cb3600451528f5'>
<a href='#5e166adaa9cb3600451528f5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1578527450000' class='quanto-date posted-at response-posted-at' href='#5e166adaa9cb3600451528f5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>My latest article: <a href="https://alphapowertrading.com/index.php/2-uncategorised/354-financing-your-stock-trading-strategy" rel="nofollow">Financing Your Stock Trading Strategy</a> is about the trading strategy discussed here. I built it based on Dan Whitnable&#39;s version as presented above. </p>

<p>I view the 12 simulations presented in my article as an exploration phase of the limits, strengths, and weaknesses of that particular trading strategy. The principles and trading methods used could be applied to many other strategies. </p>

<p>It is not a one solution does it all. I always look at trading strategies as a matter of choices, trading methods, preferences, and risk averseness. But, that does not mean that no one can design a trading strategy that can outperform market averages. Trading is like any other business, there is always a cost associated with it and there are always risks to be taken.</p>

<p>I wanted to share this new article, not only for what it does, but for what it conveys as well. There is math behind a strategy&#39;s structure. It is expressed concisely in the progression of the payoff matrix equation presented which served as backdrop for these simulations.</p>

<p>There are some screenshots to decorate the article. Here are some of its headers:</p>

<ul>
<li>The Basic Portfolio Equation<br></li>
<li>Reengineering For More<br></li>
<li>Financing Your Trading Strategy<br></li>
<li>Some Fundamentals Might Not Do What You Think<br></li>
<li>Scalable Strategy<br></li>
<li>Overriding The Ranking System<br></li>
<li>Increasing Leverage<br></li>
<li>Testing Methods<br></li>
<li>An Extended Strategy Payoff Matrix<br></li>
<li>Stopping Times</li>
</ul>

<p>Hope it can help some by presenting a different perspective.</p>

<p>Article link: <a href="https://alphapowertrading.com/index.php/2-uncategorised/354-financing-your-stock-trading-strategy" rel="nofollow">https://alphapowertrading.com/index.php/2-uncategorised/354-financing-your-stock-trading-strategy</a></p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e16a682ad5a690048b0c022' id='5e16a682ad5a690048b0c022'>
<a href='#5e16a682ad5a690048b0c022'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1578542722000' class='quanto-date posted-at response-posted-at' href='#5e16a682ad5a690048b0c022'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>awesome result @Nathan. Thank You for sharing and continue to motivate members to try and push the limits of algo. I think you have achieved the highest and most interesting result till now. The sharpe ratio of 1.48 is great!!!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e1b32ce312ace0040e0e5da' id='5e1b32ce312ace0040e0e5da'>
<a href='#5e1b32ce312ace0040e0e5da'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e0b9fa71e6b470dbb9d6f72'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f171076ca5ff12a5022f9a00d4cebb33?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e0b9fa71e6b470dbb9d6f72'>Kristof Friedrich</a>
</div>
<a UTCms='1578840782000' class='quanto-date posted-at response-posted-at' href='#5e1b32ce312ace0040e0e5da'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Regarding the selection of companies based upon high dept and high roic: I guess the reason why this strategy shows such strong returns, especially in the last years, is because of the influx of cheap money, caused by the rate cuts. My opinion is, that this strategy will probably only work this well in the current type of market enviroment. The backtest hints at this, since the big returns only started to come in after around 2009. However, this is probably one of the better strategies to exploit the availability of cheap money without taking excess risk. I&#39;m really intrigued by this approach!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e1c9c991d2fef00405bd86d' id='5e1c9c991d2fef00405bd86d'>
<a href='#5e1c9c991d2fef00405bd86d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1578933401000' class='quanto-date posted-at response-posted-at' href='#5e1c9c991d2fef00405bd86d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Kristof, a lot of the profit generated in that strategy comes from simply holding, on average, for a duration of about 5 months as if it was more like a participation prize. You get the profit because the portfolio had full exposure and the average 5-month position was positive in a generally up market. </p>

<p>There is some downside protection built in the selection process and the structure of the trading procedures on top of its declared move to safety bond switcher. </p>

<p>It becomes part of the reason why the strategy can benefit over the long term and why applying some leverage can benefit the bottom line as long as it is all paid for by the trading strategy itself which was demonstrated in my versions of this program in my previous posts.</p>

<p>This implies that most of the benefits of this trading strategy come from its structure since all the trades are made by the periodic rebalancing which comes on your preset schedule and not necessarily on the market&#39;s high or low price points. In fact, the program does not know the state of the market when rebalancing occurs. Its binary state is determined by an arbitrary and self-defined notion of a trend.</p>

<p>Nonetheless, I see alpha generation that can easily outpace many other trading methods. The 12 simulations presented in my last post were done using a slightly different set of stocks for each one of those tests. And still, the strategy successively outperformed in each of those simulations. One of my next steps will be to change the stock selection process altogether and see how the structure behaves.</p>

<p>For these reasons, I have a different perspective on the following:</p>

<p>“The backtest hints at this, since the big returns only started to come in after around 2009.”</p>

<p>The excess return was available almost from the start and for the duration of these 16.7-year simulations. In all those simulations, most of the equity came from the last few years simply because it is in a compounding return kind of game, and all it shows is this power of compounding over time.</p>

<p>However, the fundamentals on which the stock selection is made could benefit from better criteria. In my simulations, I downgraded the rankings of all fundamentals except one (which I will be attacking soon), and still obtained impressive results.</p>

<p>By assigning 
<code>
True  
</code> to the <code>
Do_More  
</code> option, the performance increases considerably. That option is part of the trading methodology. It has nothing to do with fundamentals, but everything to do with how you intend to play the game, or how aggressively you accept taking on incrementally risks. There, like in any other strategy, it becomes a matter of choice and preferences.</p>

<p>I am currently exploring how far this strategy can go. I&#39;ve increased the number of stocks to trade to 300 over the same 16.7-year trading interval. The purpose is to reduce the impact of each bet. Each stock. while in the portfolio. will account for 1/300 of equity (0.33%). If a stock ever goes bankrupt, all the damage it could do will not exceed 0.33% of the portfolio. Due to the stock selection method, this trading strategy, even limited to the top 300 ranked stocks at anyone period, will nonetheless trade over 2,400 different stocks.</p>

<p>In its current state, the strategy makes over 100,000 trades. I could double that easily by setting to <code>
True  
</code> another program option which has not been shown. The number of trades, just as the number of stocks traded are high enough to show, on average, statistical significance even after paying leveraging fees which are not negligible, but still part of the expenses of doing more business.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e20137556cc4824a8a6b775' id='5e20137556cc4824a8a6b775'>
<a href='#5e20137556cc4824a8a6b775'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/551136c8df5527b6e20002d2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/c319e4d3b04ab4d3731da47f9993a847?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/551136c8df5527b6e20002d2'>Hao Zhang</a>
</div>
<a UTCms='1579160437000' class='quanto-date posted-at response-posted-at' href='#5e20137556cc4824a8a6b775'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I didn&#39;t change much to the algorithm except I added another quality filter called ev_to_ebitda-( This reflects the fair market value of a company, and allows comparability to other companies as this is capital structure-neutral.), which I remember seeing from another algorithm. This combines the factors of Value and Quality together (somewhat). </p>

<p>I think if there is a regime switcher(Hidden Markov Model) so that different styles( ie Low Risk, Value, Volatility, Momentum, Quality, and Small Cap) can be cycled between that would be interesting or even combining each other (ie Quality- Momentum(Pretty much this thread), Value -Momentum ( <a href="https://www.quantopian.com/posts/value-momentum-and-trend)" rel="nofollow">https://www.quantopian.com/posts/value-momentum-and-trend)</a>) can also be interesting.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e242b668ba8ba0044a449d4' id='5e242b668ba8ba0044a449d4'>
<a href='#5e242b668ba8ba0044a449d4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5804841ed11a8ac44b0005b4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2c330d252d5fb3c0bc0109a5919d2ff4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5804841ed11a8ac44b0005b4'>Marc</a>
</div>
<a UTCms='1579428710000' class='quanto-date posted-at response-posted-at' href='#5e242b668ba8ba0044a449d4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi @Viridian,</p>

<blockquote>
<p>illustrate how if you approach portfolio construction as the creation<br>
of a todays_weights dictionary, then it becomes very easy to take it<br>
one step further and control the holding period via rolling<br>
portfolios. Here I show how to do 20 rolling portfolios that are each<br>
held for 20-days, thereby maintaining the same turnover rate as a<br>
monthly-rebalance while diversifying away from day-of-the-month<br>
overfit noise risk.</p>
</blockquote>

<p>Thanks for sharing, very useful!</p>

<p>One question, when you moved the stock selection into Pipeline with progressive masks and used the Returns Factor, why the .log1p()?</p>

<p>Thanks in advance.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e24698b8ba8ba0044a44b24' id='5e24698b8ba8ba0044a44b24'>
<a href='#5e24698b8ba8ba0044a44b24'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1579444619000' class='quanto-date posted-at response-posted-at' href='#5e24698b8ba8ba0044a44b24'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>why the .log1p()?</p>
</blockquote>

<p>Because you can&#39;t linearly subtract percentage changes.  If something for example goes up 60% (<code>$100+($100*0.6)=$160</code>) and then down 40% (<code>$160-($160*0.4)=$96</code>), it is not the same as being up 20% (<code>$100+($100*0.2)=$120</code>) overall. </p>

<p>I <em>think</em> converting to log solves this problem.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e2493dc04ae79003fcae713' id='5e2493dc04ae79003fcae713'>
<a href='#5e2493dc04ae79003fcae713'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58e5965dbe442b38c26b79f1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/25a286b9ad9658b5a926d67879940810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58e5965dbe442b38c26b79f1'>Jacob</a>
</div>
<a UTCms='1579455452000' class='quanto-date posted-at response-posted-at' href='#5e2493dc04ae79003fcae713'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I have been trying to modify this algorithm to have a dynamic TARGET_SECURITIES based on the context.portfolio.portfolio_value.  For example:</p>

<p>TARGET_SECURITIES = math.floor(context.portfolio.portfolio_value / 100000.00)</p>

<p>I have no idea if this is a good or bad thing to do but I can&#39;t seem to make it work because TARGET_SECURITIES is used in the Pipeline code, which appears to only be run once?  Anyone know of a way to code this?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e257d3411a4fb0047d2cb79' id='5e257d3411a4fb0047d2cb79'>
<a href='#5e257d3411a4fb0047d2cb79'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5804841ed11a8ac44b0005b4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2c330d252d5fb3c0bc0109a5919d2ff4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5804841ed11a8ac44b0005b4'>Marc</a>
</div>
<a UTCms='1579515188000' class='quanto-date posted-at response-posted-at' href='#5e257d3411a4fb0047d2cb79'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi @Vladimir (and other contributors that have been playing with this great contribution from @Chris),</p>

<p>I&#39;ve been playing with <a href="https://www.quantopian.com/posts/new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1#5df00a7528e5497c7677547b" rel="nofollow">your optimized version of Dan Whitnable code</a>. I&#39;ve used that one as in terms of code structure is super clear.</p>

<p>I&#39;m far from achieving anything closer to <a href="https://www.quantopian.com/posts/new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1#5df45e5e64b683004bc1b100" rel="nofollow">your results</a> and I just would like to know if I&#39;m missing something big or it&#39;s just a matter of parameter optimization.<br>
I have a doubt about a couple of parameters you mentioned, it might be related to that (among other things I guess):</p>

<p>I&#39;m using:<br>
date_rules.month_end(days_offset = 7)<br>
time_rules.market_open()<br>
QTU = Q3000US()<br>
MKT = symbol(&#39;SPY&#39;)<br>
BONDS = symbols(&#39;TLT&#39;, &#39;IEF&#39;)<br>
MOM = 126; Momentum lookback<br>
N = 5; Number of stocks to finally trade<br>
N_Q = 60; Number fo stocks filtered by the quality factor<br>
MA_F = 10; Fast moving average<br>
MA_S = 100; Slow moving average<br>
LEV = 1.0; Leverage passed as constrain to the optimizer</p>

<p>Regarding my doubts, what does parameters mean?<br>
MIN = 1; Is this related to bonds? How?<br>
EXCL = 2; Is this related to the momentum skip days? If I use 2 instead of 10 performance drops significantly.</p>

<p>I&#39;m attaching the backtest with the code and the notebook.</p>

<p>Thanks in advance!</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e257e0511a4fb004ad2cb1b' id='5e257e0511a4fb004ad2cb1b'>
<a href='#5e257e0511a4fb004ad2cb1b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5804841ed11a8ac44b0005b4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2c330d252d5fb3c0bc0109a5919d2ff4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5804841ed11a8ac44b0005b4'>Marc</a>
</div>
<a UTCms='1579515397000' class='quanto-date posted-at response-posted-at' href='#5e257e0511a4fb004ad2cb1b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>And here is the notebook with my results...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e25b552e66c140048fd38e5' id='5e25b552e66c140048fd38e5'>
<a href='#5e25b552e66c140048fd38e5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1579529554000' class='quanto-date posted-at response-posted-at' href='#5e25b552e66c140048fd38e5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thomas Wiecki recently posted about how <a href="https://www.quantopian.com/posts/when-to-combine-factors-and-when-not-to" rel="nofollow">linearly combining factors produces no additional alpha over the individual factors</a>, which got me to thinking about the hypothesis behind this strategy. Here the authors have used progressive filtering/masking to implement a factor combination hypothesis, and it appears to work -- momentum (which is mostly useless on its own) does seem to significantly improve the quality factor.  </p>

<p>I realize that there was no intention here of satisfying the Quantopian Allocation criteria, but I started to wonder how one would go about implementing a combination hypothesis such as &quot;quality companies in uptrend&quot; in a fashion that ranks the <em>entire</em> QTU universe of stocks.  As Tomas explains, <code>quality.zscore + momentum.zscore</code> obviously does not do it (that only gives you the average between the two factors, not the additive quality of them working in symbiosis).  </p>

<p>Any ideas?</p>

<p>(My hunch is that in this particular case there is too much noise once you stray from the extreme factor values, so it won&#39;t work.)</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e25c0310f9f56403312cd4f' id='5e25c0310f9f56403312cd4f'>
<a href='#5e25c0310f9f56403312cd4f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5804841ed11a8ac44b0005b4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2c330d252d5fb3c0bc0109a5919d2ff4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5804841ed11a8ac44b0005b4'>Marc</a>
</div>
<a UTCms='1579532337000' class='quanto-date posted-at response-posted-at' href='#5e25c0310f9f56403312cd4f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi @Viridian,</p>

<p>Definitely don&#39;t have an answer to your question but could add that in <a href="https://www.amazon.com/Quantitative-Strategies-Achieving-Alpha-McGraw-Hill/dp/0071549846" rel="nofollow">this book</a>, to combine 2 factors and test a strategy using 5 quintiles, what the author does is:<br>
1- It ranks all companies in our Backtest Universe by &quot;Main Factor&quot;. From lowest to highest, in case we want the lowest values in the top quintile.<br>
2- It selects the top 20% of this ranked list. The 20% of companies with the lowest &quot;Main Factor&quot; values. If we start with 2.000 companies, this step should select about 400 companies.<br>
3- It then ranks the 400 companies that passed the &quot;Main Factor&quot; test by &quot;Secondary Factor&quot;, again from lowest to highest supposing lowest is better.<br>
4- It selects the top 20% of this ranked list- those with the lowest &quot;Secondary Factor&quot; values. If we started with 400 companies in step 2, we should end up with about 80 companies at the end of step 4.<br>
5- Steps 1 to 4 are repeated until we have formed portfolios for the top quintile for each month (or whatever time frame we are interested in) to be tested.</p>

<p>This emphasizes the &quot;Main Factor&quot;. Somehow, reminded me what is being done in this strategy, the progressive filtering you mentioned.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e25c60d350eca00453bdff0' id='5e25c60d350eca00453bdff0'>
<a href='#5e25c60d350eca00453bdff0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58e2d12a3bfa1b000ae0441b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fd6452e042524ac9f6bbd40c88e5668e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58e2d12a3bfa1b000ae0441b'>Chris Cain</a>
</div>
<a UTCms='1579533837000' class='quanto-date posted-at response-posted-at' href='#5e25c60d350eca00453bdff0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey All,</p>

<p>This is a fantastic discussion and a good topic brought up by Viridian.</p>

<p>What we are discussing here, in essence, is what is sometimes called “sequential” vs “non-sequential” ranking/filtering methodologies when it comes to quant factors.</p>

<p>Non-sequential basically means you use all stocks in a universe and rank them (using some methodology) in all the factors you want to use.  An example would be taking the Q3000 universe then ranking each stock by a quality factor and a momentum factor then taking the top N based on the combined rankings. </p>

<p>Sequential is what we are doing here, and what the original algo did as well. Sequential means you rank by one or more factors first, filter the universe using that, then filter it again using the next factor.</p>

<p>In the original algo, we first filtered by quality then by momentum.</p>

<p>Some interesting things to note about this method. First of all, the first factor to filter by will have a larger impact on the portfolio. As such, I view “Quality Companies in an Uptrend” strategy to be mostly a quality strategy. It then uses momentum as a secondary factor which helps performance.  Time-series momentum (trend following) is also applied in our trend-following regime rule, this is most to manage risk. </p>

<p>In my research, I have had much better success with sequential factor strategies as opposed to non-sequential.  </p>

<p>Sequential strategies is also useful when you are trying to create a portfolio of strategies to take advantage of the diversification this offers. Again, keep in mind that the first factor you filter by in a sequential strategy will have the most impact on the strategy. </p>

<p>For example, maybe you have one sequential strategy that uses Value as a first factor then another sequential strategy that uses Quality as the first factor. It stands to reason that these should have lower correlation to each other than two squential straegies that use quality as a first factor. My research has shown that to be true.  Combining them into a portoflio can then less risk and lead to better risk-adjusted returns (Sharpe).</p>

<p>Great discussion here, thanks again to all that have investigated this algo, made changes, cleaned up code and provided thought leadership.</p>

<p>Chrisopther Cain, CMT  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e25cc5c11a4fb0047d2cdd5' id='5e25cc5c11a4fb0047d2cdd5'>
<a href='#5e25cc5c11a4fb0047d2cdd5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1579535452000' class='quanto-date posted-at response-posted-at' href='#5e25cc5c11a4fb0047d2cdd5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Marc,</p>

<p>Try to run your code with this parameters:</p>

<pre><code>QTU = Q3000US();  
MKT = symbol(&#39;SPY&#39;);  
BONDS = symbols(&#39;TLT&#39;, &#39;IEF&#39;);

MOM = 126;       # Momentum lookback  
EXCL = 2;        # Momentum skeep days  
N_Q = 60;        # Number quality stocks  
N = 5;           # Number to buy  
MA_F = 10;       # Fast Moving Average  
MA_S = 100;      # Slow Moving Average  
LEV = 1.0;       # Target Leverage  
MIN = 1;         # Minute to start trading


</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e25d524350eca00483be0b6' id='5e25d524350eca00483be0b6'>
<a href='#5e25d524350eca00483be0b6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5804841ed11a8ac44b0005b4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2c330d252d5fb3c0bc0109a5919d2ff4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5804841ed11a8ac44b0005b4'>Marc</a>
</div>
<a UTCms='1579537700000' class='quanto-date posted-at response-posted-at' href='#5e25d524350eca00483be0b6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi @Vladimir,</p>

<p>Thanks for the clarification. The difference is impressive. Specially when using just long term debt to equity as the quality factor.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e25eeb6350eca00453be106' id='5e25eeb6350eca00453be106'>
<a href='#5e25eeb6350eca00453be106'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5420c95fdbad621be9000079'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ee66334d0a7b6dcad241f2127237830c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5420c95fdbad621be9000079'>Nathan</a>
</div>
<a UTCms='1579544246000' class='quanto-date posted-at response-posted-at' href='#5e25eeb6350eca00453be106'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Very interesting conversation. And just want to reiterate what @Zenothestoic said a while back:</p>

<blockquote>
<p>&quot;Incidentally it is good to see some [more] ideas coming through which<br>
do not follow the stifling criteria for the Quantopian competitions.<br>
It makes for a much more interesting forum. I was getting very [fed] up<br>
with the &#39;neutral everything&#39; approach.&quot;</p>
</blockquote>

<p>Haha. It is a bummer that Quantopian has shut off all live-trading and even paper trading. I&#39;ve tried porting this to QuantConnect, but have had little success in mirroring the results. If anyone is interesting in exploring that, shoot me a message.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e25f6ee0f9f56403312cef4' id='5e25f6ee0f9f56403312cef4'>
<a href='#5e25f6ee0f9f56403312cef4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5804841ed11a8ac44b0005b4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2c330d252d5fb3c0bc0109a5919d2ff4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5804841ed11a8ac44b0005b4'>Marc</a>
</div>
<a UTCms='1579546350000' class='quanto-date posted-at response-posted-at' href='#5e25f6ee0f9f56403312cef4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi @Nathan,</p>

<p>Have you checked <a href="https://github.com/alpacahq/pylivetrader" rel="nofollow">pylivetrader</a>? It&#39;s a port of Zipline for <a href="https://alpaca.markets/" rel="nofollow">Alpaca</a>. I was messing a bit  with it a <a href="https://github.com/sturlese/pylivetrader/tree/mean_reversion/examples/reversion" rel="nofollow">while ago for paper trading</a>. However, as far as I know, there where some core version upgrades to the Alpaca API and not sure if the port is still supported.</p>

<p>If you are a US citizen you can use Alpaca for proper trading too. </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e26031a11a4fb004ad2ceeb' id='5e26031a11a4fb004ad2ceeb'>
<a href='#5e26031a11a4fb004ad2ceeb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5420c95fdbad621be9000079'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ee66334d0a7b6dcad241f2127237830c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5420c95fdbad621be9000079'>Nathan</a>
</div>
<a UTCms='1579549466000' class='quanto-date posted-at response-posted-at' href='#5e26031a11a4fb004ad2ceeb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Marc Thanks, that is interesting. I had seen it but hadn&#39;t looked too in depth. I&#39;ll try and see if I can come up with something that works.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e262bf6e5a6cb0041f060ef' id='5e262bf6e5a6cb0041f060ef'>
<a href='#5e262bf6e5a6cb0041f060ef'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5420c95fdbad621be9000079'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ee66334d0a7b6dcad241f2127237830c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5420c95fdbad621be9000079'>Nathan</a>
</div>
<a UTCms='1579559926000' class='quanto-date posted-at response-posted-at' href='#5e262bf6e5a6cb0041f060ef'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Marc Looks like there is no access to the MorningStar Fundamentals?<br>
<a href="https://github.com/alpacahq/user-docs/blob/master/content/alpaca-works-with/quantopian-to-pipeline-live.md" rel="nofollow">https://github.com/alpacahq/user-docs/blob/master/content/alpaca-works-with/quantopian-to-pipeline-live.md</a></p>

<blockquote>
<p>The Quantopian platform allows you to retrieve various proprietary<br>
data sources through pipeline, including Morningstar fundamentals.<br>
Previously, IEX was used by pipeline-live to supply equivalents to<br>
these, but recent changes to the IEX API have made this less possible<br>
for most use cases. The alternative at the moment is the Polygon<br>
dataset, which is available to users with funded Alpaca brokerage<br>
accounts and direct subscribers of Polygon&#39;s data feed. If you want to<br>
get started with Polygon fundamentals, please see the repository&#39;s<br>
readme file for more info on what Polygon information is currently<br>
available through pipeline-live.</p>
</blockquote>

<p>Did you find any way around that?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e263434e5a6cb0041f06141' id='5e263434e5a6cb0041f06141'>
<a href='#5e263434e5a6cb0041f06141'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5804841ed11a8ac44b0005b4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2c330d252d5fb3c0bc0109a5919d2ff4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5804841ed11a8ac44b0005b4'>Marc</a>
</div>
<a UTCms='1579562036000' class='quanto-date posted-at response-posted-at' href='#5e263434e5a6cb0041f06141'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi @Nathan, I knew there were several changes since I used it but was not aware of this one.<br>
<a href="https://docs.alpaca.markets/api-documentation/api-v2/" rel="nofollow">Apparently</a> with Alpaca API v2 you can access fundamental data but haven&#39;t checked it.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e279fa0bfd45f21928e6ba9' id='5e279fa0bfd45f21928e6ba9'>
<a href='#5e279fa0bfd45f21928e6ba9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1579655072000' class='quanto-date posted-at response-posted-at' href='#5e279fa0bfd45f21928e6ba9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p><strong>Durability And Scalability</strong></p>

<p>Two of the most important traits of any stock trading strategy should be: durability and scalability. The first so that the strategy does not blow up in your face during the entire trading interval, and the second so that a portfolio can grow big. </p>

<p>A stock trading strategy should operate in a compounding return environment. The objective is to obtain the highest possible long-term CAGR within your own set of constraints. </p>

<p>The portfolio&#39;s payoff matrix equation is quite simple:</p>

<p>\(F(t) = F_0 + Σ (H ∙ \Delta P)  =  E[F_0 ∙ (1 + r_m)^t]\)</p>

<p>where \(r_m\) is the average expected market return and where the final outcome will be shaped by \(F_0\) and \(t\). One variable says what you started with while the other how long you managed it. It does not say what strategy you took to get there, only that you needed one. It could be about anything as long as you participated in the game (H ≠ 0).</p>

<p>This is a crazy concept: you can win, IF you play. You have no control over the price matrix P, but you do have total control over H, the trading strategy itself. You can buy with your available funds any tradable stock at any time at almost any price for whatever reason in almost any quantity you want short of buying the whole company.</p>

<p>You already know that as time increases (20+ years), \(r_m\) will tend to be positive with an asymptotic probability approaching 1.00. The perfect argument for: you play, you win, and in all probability, you get the expected average market return over the period just for your full participation in the game.</p>

<p><strong>The Problem Comes When You Want To Have More</strong>!</p>

<p>You might need to reengineer your trading strategy. For example, the same strategy as I last illustrated in this thread was put to the test with the following initial state: $50 million as initial capital, same time interval (16.7 years), and 400 stocks. </p>

<p>The first thing I want to see when doing a backtest analysis is the output of the 
<code>
round_trips=True  
</code> section which tells the number of trades and the average net profit per trade. The reason is simple: the payoff matrix equation also has for expression:</p>

<p>\(F(t) = F_0 + Σ (H ∙ \Delta P)  = F_0 + n ∙ x_{bar} =  F_0 ∙ (1 + r_m)^t\)</p>

<p>where n is the number of trades and \(x_{bar}\) is the average net profit per trade. Therefore, these numbers become the most important numbers of a trading strategy. Whatever you can do to increase those two numbers will have an impact on your overall performance as long as \(x_{bar}\) is positive. Because n cannot be negative, a positive \(x_{bar}\) is a sufficient condition to have a positive rate of return.</p>

<p>The following chart is part of the <code>
round_trips=True  
</code> option of the backtest analysis. </p>

<p><strong>Backtest Section</strong>: <code>
round_trips=True  
</code> 
<img src="https://image-proxy.quantopian.com/32b5a64239aa8b6ef49ebcb411a08a6afc9b5b4d/687474703a2f2f616c706861706f77657274726164696e672e636f6d2f7175616e746f7069616e2f52616e6b65645f53656c656374696f6e5f533430305f4635305f323030332d323031382d31315f73746174732e706e67" /></p>

<p>The numbers are impressive. One, it shows that 400 stocks can indeed make a lot of trades over the years. The average net profit per trade increased with time to make its average a lot higher than where it started. It is understandable, the average net profit per trade is on an exponential curve due to the inherent structure of the trading strategy with the last few years having the most impact.</p>

<p>The number of stocks to trade might have been limited to 400 at any one time (or 0.25% of equity), but due to the nature of the selection process, some 2,698 different stocks were traded over those 16.7 years with an average holding period of 126 days (about 5.7 months&#39; time).</p>

<p>Instead of using bonds, I made the portfolio go short in periods of market turmoil. The strategy still managed, on average, to generate profits on those shorts.</p>

<p>The gross leverage came in at 1.50. However, the net liquidation value which is a rough estimate net of leveraging costs was more than enough of a reward to warrant going for it.</p>

<p>Why can such results be achievable? The reason is simple: compounding. </p>

<p>Every dollar of profit made is being compounded repeatedly, again and again. With the skills you brought to the game, you changed the above equation into:</p>

<p>\(F(t) = F_0 + Σ (H_a ∙ \Delta P)  = F_0 + n ∙ x_{bar} =  F_0 ∙ (1 + r_m + \alpha_a)^t\)</p>

<p>And it is the alpha you added to the game that is making such a difference, especially since it is also compounding over the entire time interval.</p>

<p>If you do not push your trading strategy, how will you ever know its limits? Those limits are the ones you do not want to exceed. And most of those limits might be due to your preferences and your averseness to losses. You want to do more than the other guy, then you will have to do more (a recurring mantra in my books).</p>

<p>Even if the numbers are big, it is still not the limit. For instance, increasing gross leverage by 5% in the above strategy would result in a gross leverage of 1.57. </p>

<p>Evidently, there would be progressively higher leveraging fees to pay. However, it would result in higher overall profits (adding about 6B more to net profits compared to the 0.5B more in leveraging fees). Max drawdown increased from -29.05% to -30.21%, while volatility went from 0.27 to 0.28. On the Sharpe ratio front, it stayed the same at 1.46 while the beta went from 0.44 to 0.46. The point being that if you could tolerate a drawdown of -29.05% why would you not stand for a -30.21% drawdown when you have no means to determine with any accuracy how far down the next drawdown will be?</p>

<p>The above numbers analyzing the state of the portfolio were marginal incremental moves except for the added overall profits. All of it is extracted by the same trading strategy where it was “requested” to do more. It incurred higher expenses, for sure, but it also delivered much higher profits (12 times more than the added costs). </p>

<p>Now, the strategy does face some problems in need of solutions. One is when going short. It does so on the stocks that the strategy considers as the best prospects for profit. That should be changed to a better short selection process. Another problem is the bet size. It is on an exponential curve and at some point will trade huge number of shares even if each stock will only get 0.25% of equity. </p>

<p>Therefore, as the strategy progresses in time, there will be a need for a scaling in and out of position procedure. I would prefer one of the sigmoid type. This has not yet been designed in that strategy, but I do see it will be needed, not so much in the beginning, but it will get there. So, I should plan for that too and have the strategy take care of those two potential problems. </p>

<p>However, there is more than ample time (years) to solve the second one.</p>

<p>Understandably, no one should be surprised if I am not providing the code.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e27b7555195f4003e215b8c' id='5e27b7555195f4003e215b8c'>
<a href='#5e27b7555195f4003e215b8c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1579661141000' class='quanto-date posted-at response-posted-at' href='#5e27b7555195f4003e215b8c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy,</p>

<p>Just a friendly reminder of the <a href="https://www.quantopian.com/posts/new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1#5ddeadde55c2860042a50275" rel="nofollow">below post from Jamie McCorriston</a>. I believe the purpose of this post was for collaboration - not for someone to write a long monologue on how they improved the strategy without actually sharing the code.</p>

<blockquote>
<p>@Guy Fleury: Multiple participants in this thread have expressed<br>
frustration with the sharing of screenshots instead of attaching a<br>
backtest. Please refrain from sharing screenshots built on top of the<br>
shared work in this thread. You are entitled to keep your work<br>
private, so if you don&#39;t want to share, that&#39;s fine. But please don&#39;t<br>
share screenshots in this thread as it seems the intent of the thread<br>
is to collaborate on improving the algorithm.</p>
</blockquote>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e28de8e90514c0044d42036' id='5e28de8e90514c0044d42036'>
<a href='#5e28de8e90514c0044d42036'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5420c95fdbad621be9000079'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ee66334d0a7b6dcad241f2127237830c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5420c95fdbad621be9000079'>Nathan</a>
</div>
<a UTCms='1579736718000' class='quanto-date posted-at response-posted-at' href='#5e28de8e90514c0044d42036'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Joakim (and @Guy),</p>

<p>I&#39;m no mathematician, so the stuff @Guy is posting doesn&#39;t make much sense to me. But I do believe the essence of what he is saying is that this strategy can be scaled to use more than 5 stocks and give amazing returns if someone is willing to use leverage. And while he is talking above me (and maybe most on here), that was interesting information. Liquidity in 5 stocks is going to be an issue in real-life, so by adding a leverage of 1.5 with 50 stocks, you can still get good returns if, for example, you start with $5k instead of $10k (and keep the other $5k in the bank cover yourself for a margin call). I&#39;m not really familiar with using leverage (so I might not be understanding all this correctly). And that way with 50 stocks at 1.5 leverage I can backtest a return of 30,000% turning $5k into $1.5mil (2003-2019) verses about 5,000% return on $10k with 50 stocks resulting in a portfolio of $500k.<br>
That is interesting.</p>

<p>Also, the point about dealing with bear situations in a more intelligent way is true - that would increase the return for this algorithm. So even though he didn&#39;t provide code, he did provide an idea that we could add to the strategy an benefit from.</p>

<p>I personally don&#39;t like leverage, but maybe others do. So I wouldn&#39;t say @Guy hasn&#39;t contributed. True, no code (except slightly modified from others - but really that&#39;s all I posted as well), but he does have ideas.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e2a4369818bcc0045f49284' id='5e2a4369818bcc0045f49284'>
<a href='#5e2a4369818bcc0045f49284'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1579828073000' class='quanto-date posted-at response-posted-at' href='#5e2a4369818bcc0045f49284'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Some think that this strategy is operating on ranked-fundamentals. Well, not so much. It is mostly playing market noise. </p>

<p>The stock selection process is just there to pick 400 stocks. Changing the ranking method will give quite different results as was illustrated in my <a href="https://alphapowertrading.com/index.php/2-uncategorised/354-financing-your-stock-trading-strategy" rel="nofollow">last article</a>. It is understandable especially in the scheduled periodic rebalance procedures where the weight&#39;s 7th decimal can be the deciding factor. When one of the weights changes, it will prompt all other weights to “readjust” as if in a domino effect. The rebalance occurs not because the fundamentals changed (their values changed about every 3 months), but because the 7th decimal of one of the weights changed. And that becomes playing on market noise a lot more than playing on ranked-fundamentals.</p>

<p>When designing a trading strategy we should look at where it is ultimately going, especially in a compounding environment where time might turn out to be the most important ingredient of all. It is your trading strategy <strong>H</strong> that is running the show, so do make the most of it.</p>

<p>Such a trading strategy is designed to accommodate large institutional sized players and the very rich to make them even richer. Nonetheless, looking at the equations presented and my latest articles, the strategy can be scaled down just as it was easily scaled up as is illustrated in the last shown equation in my article.</p>

<p>You want to find out more like equations, explanations and charts, follow the link below:</p>

<p><a href="https://alphapowertrading.com/index.php/2-uncategorised/355-durability-and-scalability" rel="nofollow">https://alphapowertrading.com/index.php/2-uncategorised/355-durability-and-scalability</a> </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e2afd0e0f0d87004549e290' id='5e2afd0e0f0d87004549e290'>
<a href='#5e2afd0e0f0d87004549e290'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58e5965dbe442b38c26b79f1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/25a286b9ad9658b5a926d67879940810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58e5965dbe442b38c26b79f1'>Jacob</a>
</div>
<a UTCms='1579875598000' class='quanto-date posted-at response-posted-at' href='#5e2afd0e0f0d87004549e290'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Okay I am pulling my hair out, can someone tell me the difference between the following:</p>

<pre><code>def make_pipeline():  
    top_quality = quality.top(N_Q, mask=universe)  
    top_quality_momentum = momentum.top(N, mask=top_quality)  
    pipe = Pipeline(  
        columns={  
            &#39;trend_up&#39;: trend_up,  
            &#39;screen&#39;: top_quality_momentum  
        },  
        screen=top_quality_momentum  
    )  
    return pipe

def rebalance(context, data):  
    df = algo.pipeline_output(&#39;pipeline&#39;)  
    current_holdings = context.portfolio.positions  
    rule = &#39;screen &amp; (trend_up or (not trend_up &amp; index in @current_holdings))&#39;  
    stocks_to_hold = df.query(rule).index  
</code></pre>

<p>VS</p>

<pre><code>def make_pipeline():  
    top_quality = quality.top(N_Q, mask=universe)  
    pipe = Pipeline(  
        columns={  
            &#39;trend_up&#39;: trend_up,  
            &#39;score&#39;: momentum  
        },  
        screen=top_quality  
    )  
    return pipe

def rebalance(context, data):  
    df = algo.pipeline_output(&#39;pipeline&#39;)  
    current_holdings = context.portfolio.positions  
    rule = &#39;trend_up or (not trend_up &amp; index in @current_holdings)&#39;  
    stocks_to_hold = df.sort_values(&#39;score&#39;, ascending=False).head(N).query(rule).index  
</code></pre>

<p>I have been trying to move the number of stocks to choose N into rebalance so that it can be calculated (scaled) on the fly, and I can&#39;t do this in make_pipeline.  I would think the two are equivalent, and when I test multiple dates in Notebook they are (IE same 5 stocks, but different order).  However, during backtest this makes a huge difference, and I can&#39;t figure out why.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e2b13dce68117003ba65819' id='5e2b13dce68117003ba65819'>
<a href='#5e2b13dce68117003ba65819'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1579881436000' class='quanto-date posted-at response-posted-at' href='#5e2b13dce68117003ba65819'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Jacob Champlin -- I can&#39;t spot what you&#39;re doing wrong.  It looks correct.  If you scroll up in this thread you can see a working example where I did precisely what you&#39;re trying to do (move all the filtering logic into pipeline), and it worked correctly.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e2b3ad17ddba4003eed6bbd' id='5e2b3ad17ddba4003eed6bbd'>
<a href='#5e2b3ad17ddba4003eed6bbd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58e5965dbe442b38c26b79f1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/25a286b9ad9658b5a926d67879940810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58e5965dbe442b38c26b79f1'>Jacob</a>
</div>
<a UTCms='1579891409000' class='quanto-date posted-at response-posted-at' href='#5e2b3ad17ddba4003eed6bbd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Viridian and Everyone</p>

<p>I am almost ashamed to admit this.  When I copied the code into a new algorithm, I forgot to change the Initial Capital to 10k.  I can&#39;t tell you how long I tried to debug the difference.  Sorry if I wasted anyone&#39;s time.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e2c348e4c32b3003ec7ec6d' id='5e2c348e4c32b3003ec7ec6d'>
<a href='#5e2c348e4c32b3003ec7ec6d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59acb513872a7c00107e20af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8c6c46ff4f05f58cdd179a7e1604f394?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59acb513872a7c00107e20af'>Donald Casson</a>
</div>
<a UTCms='1579955342000' class='quanto-date posted-at response-posted-at' href='#5e2c348e4c32b3003ec7ec6d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi @Marc and @Vladimer, </p>

<p>Thanks so much for your contribution to this algo and for @Chris Cain for originally posting! </p>

<p>I have been backtesting the code from @Marc&#39;s post with the parameters @Vladimer posted and I cant get it to perform the way you guys could ? Is it something in the parameters or am i missing something else ? </p>

<p>I have only modified the quality stocks to only include &quot;long term debit to equity&quot; </p>

<pre><code>#quality = roic + ltd_to_eq + value  
quality = ltd_to_eq  
</code></pre>

<p>Any help would be much appreciated  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e2dda94cf32ee00405e660e' id='5e2dda94cf32ee00405e660e'>
<a href='#5e2dda94cf32ee00405e660e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5804841ed11a8ac44b0005b4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2c330d252d5fb3c0bc0109a5919d2ff4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5804841ed11a8ac44b0005b4'>Marc</a>
</div>
<a UTCms='1580063380000' class='quanto-date posted-at response-posted-at' href='#5e2dda94cf32ee00405e660e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Donald, have a look  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e2e63e4156ac4003cfd5859' id='5e2e63e4156ac4003cfd5859'>
<a href='#5e2e63e4156ac4003cfd5859'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5420c95fdbad621be9000079'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ee66334d0a7b6dcad241f2127237830c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5420c95fdbad621be9000079'>Nathan</a>
</div>
<a UTCms='1580098532000' class='quanto-date posted-at response-posted-at' href='#5e2e63e4156ac4003cfd5859'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>If you use MaximizeAlpha for ordering you can push it a little higher.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e2eed2cec1fae003b40f220' id='5e2eed2cec1fae003b40f220'>
<a href='#5e2eed2cec1fae003b40f220'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58e5965dbe442b38c26b79f1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/25a286b9ad9658b5a926d67879940810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58e5965dbe442b38c26b79f1'>Jacob</a>
</div>
<a UTCms='1580133676000' class='quanto-date posted-at response-posted-at' href='#5e2eed2cec1fae003b40f220'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Nathan</p>

<p>I find it strange that target_weights are passed into MaximizeAlpha, aren&#39;t these just equal weighted....</p>

<pre><code>stock_weight = 1.0 / context.TARGET_SECURITIES  
</code></pre>

<p>I would think that the momentum score would be the alpha?  Not sure how this helps even though it looks like it does.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e2eef6f7be096004b5280bc' id='5e2eef6f7be096004b5280bc'>
<a href='#5e2eef6f7be096004b5280bc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1580134255000' class='quanto-date posted-at response-posted-at' href='#5e2eef6f7be096004b5280bc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Because if you use MaximizeAlpha without any position concentration constraints, you end up holding only one stock at a time.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e2ef7e47be0960045528117' id='5e2ef7e47be0960045528117'>
<a href='#5e2ef7e47be0960045528117'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58e5965dbe442b38c26b79f1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/25a286b9ad9658b5a926d67879940810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58e5965dbe442b38c26b79f1'>Jacob</a>
</div>
<a UTCms='1580136420000' class='quanto-date posted-at response-posted-at' href='#5e2ef7e47be0960045528117'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Viridian</p>

<p>I get that you want position concentration constraints.  My issue is I have never seening MaximizeAlpha used like this.  I have always seen it used like:</p>

<pre><code>opt.MaximizeAlpha(df[&quot;momentum&quot;])  
</code></pre>

<p>The documentation states &quot;Ideally, alphas should contain coefficients such that alphas[asset] is proportional to the expected return of asset for the time horizon over which the target portfolio will be held.&quot;.   Equal weighting doesn&#39;t give you any information about which stocks have a higher/lower expected return.  I would expect TargetWeights and MaximizeAlpha to be equal in this case.  I guess I don&#39;t entirely know what MaximizeAlpha is doing under the hood, where is it finding Alpha?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e2efae3156ac40042fd5c4e' id='5e2efae3156ac40042fd5c4e'>
<a href='#5e2efae3156ac40042fd5c4e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1580137187000' class='quanto-date posted-at response-posted-at' href='#5e2efae3156ac40042fd5c4e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I would avoid using MaximizeAlpha. I believe Quantopian&#39;s own conclusion is that the feature was ill conceived.</p>

<p>TargetWeights tries to order whatever weights you feed it.</p>

<p>MaximizeAlpha doesn&#39;t find alpha -- you feed it the alpha. It concentrates as much weight as the constraints allow in the positions with the highest alpha signal values. Equal-weighting is just a consequence of the constraints.  For example, if you feed it 1000 ranked stocks, and use a 10% position concentration limit, it will pick construct a portfolio with 10 of the highest ranked out of those 1000. Because the portfolio consists of only the 10 best instead of all 1000 stocks, the returns will be higher, at the sacrifice of diversification.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e2f7921ec1fae003e40f683' id='5e2f7921ec1fae003e40f683'>
<a href='#5e2f7921ec1fae003e40f683'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b9f22530d70bd003f3b78ba'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b2520c704f70d72d8acc0f90b85ccc84?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b9f22530d70bd003f3b78ba'>Lei Ding</a>
</div>
<a UTCms='1580169505000' class='quanto-date posted-at response-posted-at' href='#5e2f7921ec1fae003e40f683'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Need help on understanding the pipeline filters. Looking latest version of the code:  </p>

<pre><code>    ltd_to_eq = ms.long_term_debt_equity_ratio.latest.rank(mask=universe) #, mask=universe)  
...
    quality = ltd_to_eq  
...
    top_quality = quality.top(context.TOP_ROE_QTY, mask=universe)  
</code></pre>

<p>So the algo is picking companies with largest long_term_debt_equity_ratio values, doesn&#39;t that mean highest leverage companies? Those are riskiest not highest quality companies. Am I missing something obvious?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e2f85a79e7919004d36c0e0' id='5e2f85a79e7919004d36c0e0'>
<a href='#5e2f85a79e7919004d36c0e0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1580172711000' class='quanto-date posted-at response-posted-at' href='#5e2f85a79e7919004d36c0e0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>That is right Lei. Algo is selecting companies with high leverage. One of the reason for performance could be that leverage filter is merged with momentum filter. Although there is high leverage, but momentum filter is making sure only those companies are selected which are in uptrend. and as you know, leverage multiplies the returns. Hence only those companies are selected which are able to apply leverage profitably.</p>

<p>Another reason could be, and this is just my theory, I could be completely wrong, money managers who can not take leverage because they are limited by their IPS (investment Policy Statement) , tends to take leverage indirectly, i.e. investing in companies with high leverage. When big money flows into stock, they tends to increase in value.</p>

<p>Lastly, the highest performance is during past few years. If you add above two factors in a bull market, you end up with something like this algo.</p>

<p>Again, these are just my reasoning and I could be wrong.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e2f8847d97b37003f5d3a6d' id='5e2f8847d97b37003f5d3a6d'>
<a href='#5e2f8847d97b37003f5d3a6d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b9f22530d70bd003f3b78ba'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b2520c704f70d72d8acc0f90b85ccc84?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b9f22530d70bd003f3b78ba'>Lei Ding</a>
</div>
<a UTCms='1580173383000' class='quanto-date posted-at response-posted-at' href='#5e2f8847d97b37003f5d3a6d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thank you for the insight Nadeem, that makes sense! So the reason for this Algo&#39;s success is due to effectively increasing leverage during SPY up trend while move to TLT/IEF during SPY down trend.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e306836d97b37003c5d4044' id='5e306836d97b37003c5d4044'>
<a href='#5e306836d97b37003c5d4044'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58e2d12a3bfa1b000ae0441b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fd6452e042524ac9f6bbd40c88e5668e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58e2d12a3bfa1b000ae0441b'>Chris Cain</a>
</div>
<a UTCms='1580230710000' class='quanto-date posted-at response-posted-at' href='#5e306836d97b37003c5d4044'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Lei</p>

<p>This algo has certainly morphed since I first posted it. </p>

<p>The original design was to buy companies with high quality - commonly known as the quality factor. The quality factor typically encompasses metrics such as high profitability (ROE, ROIC, Gross Profitability), LOW leverage and stability of earnings.</p>

<p>As an example, I simply used ROE to measure quality in the original algo.</p>

<p>This algo was NOT intended to buy highly leveraged companies. </p>

<p>In fact, in many ways that is the complete opposite of the original design.</p>

<p>Chris  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e30a3004cf2da003e6b27d5' id='5e30a3004cf2da003e6b27d5'>
<a href='#5e30a3004cf2da003e6b27d5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5804841ed11a8ac44b0005b4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2c330d252d5fb3c0bc0109a5919d2ff4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5804841ed11a8ac44b0005b4'>Marc</a>
</div>
<a UTCms='1580245760000' class='quanto-date posted-at response-posted-at' href='#5e30a3004cf2da003e6b27d5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Curious  metamorphosis... and interesting discussion.</p>

<p>@Joakim, you added ltd_to_eq for the first time but in ascending order, which makes more sense to me if we think about plain quality. What do you think about the mutation and the mentioned reasonings?</p>

<p>@Vladimir, you changed the ascending order of the ltd_to_eq from the @Dan Whitnable version and removed the other quality factors. I&#39;m curious, is the reasoning that has been explained above the one you had in mind?</p>

<p>Thanks in advance.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e31d9f3db6cb70048420384' id='5e31d9f3db6cb70048420384'>
<a href='#5e31d9f3db6cb70048420384'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1580325363000' class='quanto-date posted-at response-posted-at' href='#5e31d9f3db6cb70048420384'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Chris, in your first post, you requested:</p>

<blockquote>
<p><em>“We’d love to see what you guys come up with.”</em></p>
</blockquote>

<p>Well, the participants in this thread did bring a diverse set of modifications to your trading script and showed different outcomes. </p>

<p>It is understandable, changing the stock selection process, the timing of trades, the scheduled rebalancing time, the ranking method, the weighing mechanism, the trading method, all within the set limits of available resources would have its impact on the strategy&#39;s payoff matrix: F(t) = F_0 + Σ (H ∙ ΔP).</p>

<p>Moreover, any of those changes would take a different opportunity set. Each day, the market would present a slightly different list of stocks based on the selected criteria. And some of those could be picked only if there was available cash to make the trades at that time. Rebalancing each month would make that set of selectable stocks that much more different.</p>

<p>The strategy made sure that whatever stock entered the portfolio, its weight was already determined to be the same as every other trade taken. Your program made the bet size 5% of ongoing equity. Each stock entering the portfolio would be starting on the same basis. You had a lot more trade opportunities available than the few that were dropping off the list of selectables.</p>

<p>The slightest change would cascade through the strategy, technically, making it a slightly (or widely) different set of trades. And hence, quite different results as illustrated by the number of variations displayed.</p>

<p>So, yes, the strategy was transformed in many ways. Either enhancing it or even redesigning it to do more than the original setup. There is nothing wrong with that. Nonetheless, it did answer your request. </p>

<p>Can we, as a community, transform your trading strategy to do more? Well, the answer is: YES. And from the shown algos, you can now modify your own program to include whatever modifications you liked and thereby further enhance the outcome of your trading script <strong>H</strong>_a.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e36f39bbbbdd6004abcf94f' id='5e36f39bbbbdd6004abcf94f'>
<a href='#5e36f39bbbbdd6004abcf94f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5db4a31c85cc0d68d9359086'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73efd481fc889053f32a6923f32f14a1?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5db4a31c85cc0d68d9359086'>James Hirst</a>
</div>
<a UTCms='1580659611000' class='quanto-date posted-at response-posted-at' href='#5e36f39bbbbdd6004abcf94f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Everyone, </p>

<p>I have recently started learning Python, and so far I have completed an online course/assessed the introductory content on Quantopian. I am using this algo as a case study to learn from, as I am a big believer of &#39;learning by doing&#39;. At present I have copied the source code into a word document, and I am making comments/annotations to try and figure everything out (and get my bearings). </p>

<p>This is quite a big ask, but I would find it invaluable if someone would be kind enough to take an hour out of their week (possibly a Sunday) to video call me and run me through it (I am also happy to pay you for the help!). Or, if you are based in London, I would happily also buy you a coffee.</p>

<p>If anyone is able to help with this, I would really appreciate it. You can reach me on whatsapp via +44(0)7305 318 323.</p>

<p>Thanks in advance :)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e37d941fa0777004ad01f6d' id='5e37d941fa0777004ad01f6d'>
<a href='#5e37d941fa0777004ad01f6d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1580718401000' class='quanto-date posted-at response-posted-at' href='#5e37d941fa0777004ad01f6d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>For anyone interested in the more exotic versions of this algorithm, promising extravagant returns by pursuing highly counter intuitive fundamental filters, I highly recommend back testing the system outside of the Quantopian IDE.</p>

<p>I have spent some weeks learning Quantconnect, which offers similar data and an online IDE based in Python and various other programming languages. To say that the learning curve has been uphill would be an absurd understatement, but I followed Sisyphus both up the hill and down the other side.</p>

<p>The results to be obtained bear little resemblance to the fantastic returns promised  on this thread.</p>

<p>Or not thus far in any event.</p>

<p>Perhaps by further torturing the data or the software I will be able to improve the theoretical back tested results, but this may be an occasion where the data and the software simply lie. Where back testing can produce the dangerous illusion of fabulous performance which exists only in the mind of the programmer.</p>

<p>The difference lies mainly in the universe. Here we have the Quantopian 3000 but little indication (?) as to how that is arrived at. In Quantconnect the universe selection is more or less DIY and selection of the more louche stocks cheers up the performance.</p>

<p>It has been a very valuable experience indeed.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e38333e7b398d0046999658' id='5e38333e7b398d0046999658'>
<a href='#5e38333e7b398d0046999658'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1580741438000' class='quanto-date posted-at response-posted-at' href='#5e38333e7b398d0046999658'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Zeno -- <a href="https://www.quantopian.com/docs/api-reference/pipeline-api-reference#quantopian.pipeline.filters.Q3000US" rel="nofollow">https://www.quantopian.com/docs/api-reference/pipeline-api-reference#quantopian.pipeline.filters.Q3000US</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e384799fa07770041d02285' id='5e384799fa07770041d02285'>
<a href='#5e384799fa07770041d02285'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1580746649000' class='quanto-date posted-at response-posted-at' href='#5e384799fa07770041d02285'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Mr V Hawk<br>
Thank you. This one puzzles me: &quot;capped at 30% of equities allocated to any single sector&quot;.  Not sure I see that one.  In any event, I have ratcheted up the CAGR  on Quantconnect to very reasonable levels but so far not to the dizzy heights we both reached here.</p>

<p>Frankly, good enough though and I think curve fitting played its part here - in my case particularly as regards the date of re-allocation.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e395816c0066400472a0db8' id='5e395816c0066400472a0db8'>
<a href='#5e395816c0066400472a0db8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e306cc743ea7d0042dec3a1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/581f21920f4e35be384afa76428f3d33?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e306cc743ea7d0042dec3a1'>Mário Pinto</a>
</div>
<a UTCms='1580816406000' class='quanto-date posted-at response-posted-at' href='#5e395816c0066400472a0db8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello everyone,<br>
I am new in this world of algorithms and, this work, has aroused a lot of interest.<br>
However, is it possible to adapt the algorithm for, instead of month, quarter, four-month, semester or annual?<br>
Thank you, so much.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e39b1c2c87cbd7e6ef70f90' id='5e39b1c2c87cbd7e6ef70f90'>
<a href='#5e39b1c2c87cbd7e6ef70f90'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59481158ff067f000da8ff72'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d5ccdd74809cac528dbb57c83342e997?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59481158ff067f000da8ff72'>Josh Genao</a>
</div>
<a UTCms='1580839362000' class='quanto-date posted-at response-posted-at' href='#5e39b1c2c87cbd7e6ef70f90'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Zenothestoic Have you checked the quantconnect QC500 universe. The source code is below<br>
<a href="https://github.com/QuantConnect/Lean/blob/master/Algorithm.Framework/Selection/QC500UniverseSelectionModel.py" rel="nofollow">Github QC500 Universe Selection Model</a></p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e39ce0f35287b5c670474a5' id='5e39ce0f35287b5c670474a5'>
<a href='#5e39ce0f35287b5c670474a5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1580846607000' class='quanto-date posted-at response-posted-at' href='#5e39ce0f35287b5c670474a5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Josh Genao<br>
Yes, I have been through the model in detail and adapted it to create my own Russel 3000 lookalike.  But thank you anyway. In an email just sent to a fellow user I expressed my opinion that one should not bother to try and replicate systems on the two Qs exactly. If the Quantopian 3000 picks different stocks than the QC 3000 and the system still works, then who cares. It shows it is robust.</p>

<p>Or rather &quot;has been robust&quot;!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4257caa1020b00448b02ef' id='5e4257caa1020b00448b02ef'>
<a href='#5e4257caa1020b00448b02ef'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530dc58192f94a48e80002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6a81c3996de61b5880d979f288a9a743?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530dc58192f94a48e80002b6'>Mikko M</a>
</div>
<a UTCms='1581406154000' class='quanto-date posted-at response-posted-at' href='#5e4257caa1020b00448b02ef'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I no longer use this site as I can&#39;t live or even paper trade (I have also moved to QuantConnect) so I can&#39;t share any code but I have also backtested some versions of this algorithm out of curiosity and wanted to share something back: I really recommend experimenting with piotroski f-score as the value filter. I think there are implementations of it on this site as well.</p>

<p><a href="https://en.wikipedia.org/wiki/Piotroski_F-Score" rel="nofollow">https://en.wikipedia.org/wiki/Piotroski_F-Score</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e42745c1173770042c1e470' id='5e42745c1173770042c1e470'>
<a href='#5e42745c1173770042c1e470'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1581413468000' class='quanto-date posted-at response-posted-at' href='#5e42745c1173770042c1e470'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Mikko M<br>
What sort of CAGR have you achieved since 2003?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e427ae938356e004aecb13b' id='5e427ae938356e004aecb13b'>
<a href='#5e427ae938356e004aecb13b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1581415145000' class='quanto-date posted-at response-posted-at' href='#5e427ae938356e004aecb13b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I have spent many weeks mastering Quantconnect and I have to say it is no great joy.  It is unbelievably slow even for the simplest code using daily data and you are unable to run more than one test at a time. Sadly Quantopian is unlikely to reverse its recent decisions on paper trading or live trading but it would certainly make life easier if it would. </p>

<p>I have also found dramatic differences in results between similar systems on each platform but with online IDEs with limited logging output, the task of nailing the differences  is a tough one.</p>

<p>I am tempted to download Lean and obtain the data for myself but I do not really relish running a server in the cloud or going through the hoops of connecting to Interactive brokers.</p>

<p>Swings and roundabouts but it is not ideal to rely on a third party provider for one&#39;s trading - they are all too capable of pulling the rug unexpectedly.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e429fa98cae5d5fea36df9a' id='5e429fa98cae5d5fea36df9a'>
<a href='#5e429fa98cae5d5fea36df9a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530dc58192f94a48e80002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6a81c3996de61b5880d979f288a9a743?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530dc58192f94a48e80002b6'>Mikko M</a>
</div>
<a UTCms='1581424553000' class='quanto-date posted-at response-posted-at' href='#5e429fa98cae5d5fea36df9a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Zenothestoic</p>

<p>NOTE: the results below are WITH quantconnects alphastreams slippage and commissions with 100k initial capital.<br>
I used pure 6 month momentum (not discarding last days) as my personal view is that including more recent data is beneficial.</p>

<p>Leverage is 1.</p>

<p>Testing universe is basically &quot;QC500&quot; ie 500 most traded stocks with fundamental data.</p>

<p>With ROE filter, 20 equities and 6 month momentum total return since 1/2003 was 639% ( 12.393% CAGR, sharpe  0.727)<br>
With f-score &gt;= 6, 20 equities and 6 month momentum total return since 1/2003 was 1441% ( 17.322% CAGR, sharpe 0.838)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e42a312a1020b00448b0524' id='5e42a312a1020b00448b0524'>
<a href='#5e42a312a1020b00448b0524'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1581425426000' class='quanto-date posted-at response-posted-at' href='#5e42a312a1020b00448b0524'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Mikko M</p>

<p>Thank you. Pretty healthy returns. I&#39;m not yet clear how to apply the slippage models and I am currently using the IB Brokerage Model.</p>

<p>I have drafted models 1) using the alpha framework and 2) using the much simpler classic mode.</p>

<p>For my own purposes I can see no advantages whatsoever in using the fantastically complex alpha framework but of course this is necessary if you want to rent out your algos.</p>

<p>Incidentally, unlike here, there seems to be little discussion between traders on Quantconnect. Perhaps that all takes place on the Slack channel.....</p>

<p>Yes, I agree there is no mileage whatsoever in delaying the signal. Those who promote it seem to be misguided and or simply wrong.</p>

<p>Using the high debt model (on an ersatz Russell 3000 universe) with 5 stocks I get a maximum of 9000% return since 2003 (30% cagr) as opposed to 30,000% (38% cagr) here but that may be as a result of the Interactive Brokers slippage model. I have not yet investigated other quantities or other filters since it has taken me a few weeks to learn the software.</p>

<p>Also no leverage.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e42d8b82bcbf5004151b07a' id='5e42d8b82bcbf5004151b07a'>
<a href='#5e42d8b82bcbf5004151b07a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1581439160000' class='quanto-date posted-at response-posted-at' href='#5e42d8b82bcbf5004151b07a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Zenothestoic</p>

<p>maybe I missed it, but how do you actually set up your live trading work flow?<br>
I was thinking to use backtrader.<br>
Unfortunately Quantopian platform looks most advanced, second Zipline (which I’m using know) don’t allow for live trading.<br>
It seems that backtrader has quite a large community as well.<br>
I did not look at QuantConnect in detail.<br>
What would be your recommendation?</p>

<p>Best<br>
Carsten  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e42da0d2bcbf5004151b08a' id='5e42da0d2bcbf5004151b08a'>
<a href='#5e42da0d2bcbf5004151b08a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1581439501000' class='quanto-date posted-at response-posted-at' href='#5e42da0d2bcbf5004151b08a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I am going to start live trading using Quantconnect. Using Quantconnect data and Quantconnect servers + Quanconnect&#39;s software to access the IB API. I really do not want to have to re-invent the wheel. </p>

<p>Having done that I may download the Quantconnect software locally and subscribe to fundamental and price data so that i can submit orders manually if I have  to and can work on connecting up to the IB API on my own via a cloud based server. </p>

<p>All of the latter steps will be a grind but as with Quantopian, who knows when Quantconnect may abandon live trading?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e42e48e4fb8d700464bc73e' id='5e42e48e4fb8d700464bc73e'>
<a href='#5e42e48e4fb8d700464bc73e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1581442190000' class='quanto-date posted-at response-posted-at' href='#5e42e48e4fb8d700464bc73e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I had subscribed to a nice platform with good data and a very helpful guy who setup everything. Unfortunately he had to close the platform as his data provider doubled the cost and he did not had enough subscribers...all my work I spent developing my strategies was gone. </p>

<p>Now I don’t want to use a platform any more.<br>
Your right the Quantconnect offer is nice - but....and a don’t like to re-invent as well, instead I just prefer to pay the appropriate fee/cost. </p>

<p>Actually I’m building my tools. I spend quite some time building a database and the programs to fill it and ingest them.(I searched on the internet but did not find any thing fitting to my requests, as well reaching out on freelancer did not help )</p>

<p>Next I’m building a tool to find alpha. I believe to start it takes a little longer but at the end it’s faster to do it more systematic.<br>
I found the Alphalens tool quite promising to see if a single and later combined factor produces significant (statistical ) gains above the market over time. Specially how It changes during time.</p>

<p>Than I would plug it I to a full algo and backtest it.<br>
Than start paper trading.<br>
Than live.<br>
Later semi or fully automated on a rented cloud server.</p>

<p>The problem I have with zipline, price only and no trading.<br>
The advantage is the carry over of  factors/strategies from Alphalens.</p>

<p>Would it be a lot work to carry over the strategies from Quantopian to Quantconnet?<br>
Did you already try to set up their software on your PC.<br>
With Zipline it’s a medium nightmare to get it running. Backtrader was super easy-like installing an app on the iPhone :)</p>

<p>Best<br>
Carsten  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e42e950be932e004012c2f3' id='5e42e950be932e004012c2f3'>
<a href='#5e42e950be932e004012c2f3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1581443408000' class='quanto-date posted-at response-posted-at' href='#5e42e950be932e004012c2f3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I tried downloading Zipline locally 5 or 6 years ago and briefly got it running. Then it gave up on me. You are right - it was a nightmare. Perhaps they have improved the mechanics now but I have not tried lately.</p>

<p>Likewise I downloaded Lean a few years ago but at that stage they did not offer Python and I could not be bothered with C# which I have no familiarity with.</p>

<p>Quantconnect has taken me quite a few weeks to learn and I am still finding the necessity from time to time to dig into C#. But having cracked it, further systems will not take much effort. Or not nearly so much effort.</p>

<p>If I were you I would try and download Lean and see how it goes. I hope to get around to that this week.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e43d4bdaf2637004058a943' id='5e43d4bdaf2637004058a943'>
<a href='#5e43d4bdaf2637004058a943'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1581503677000' class='quanto-date posted-at response-posted-at' href='#5e43d4bdaf2637004058a943'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I am not sure if you have heard or even tried the IBridgePy.com?</p>

<p>@Carsten<br>
Are you sure that no live-trading by zip-line?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4b15f329ef6b004948120b' id='5e4b15f329ef6b004948120b'>
<a href='#5e4b15f329ef6b004948120b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1581979123000' class='quanto-date posted-at response-posted-at' href='#5e4b15f329ef6b004948120b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I have had some answers back from the folk at Quantconnect. </p>

<p>My algorithm as drafted will not run on their$20 pcm  512Mb server leaving me with the option of cutting back on the number of stocks or opting for the 2 x Free 1024Mb Live Server at $250 pcm</p>

<p>If you want to run with a Russell 3000 type universe you are going to need to spend $250 pcm. Possibly if you cut the number of stocks down to 2000 you might make do with the $20 server. But it would be a close call. 500 stocks and you probably have no problems.</p>

<p>Net result, many weeks spent learning Lean and some difficult choices to be faced.  With sufficient confidence in the algo $250 a month would be perfectly reasonable depending on what capital you trade, but given the great disparity in backtested CAGR between identical systems on Quantopian and Quantconnect, the decision becomes more difficult.</p>

<p>Happily (in a sense at least) there proved to be nothing wrong with my coding.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4b8a9c00b03c004a529d78' id='5e4b8a9c00b03c004a529d78'>
<a href='#5e4b8a9c00b03c004a529d78'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1582008988000' class='quanto-date posted-at response-posted-at' href='#5e4b8a9c00b03c004a529d78'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Zenothestoic </p>

<p>thanks for sharing.<br>
That narrows for me the decision between a fork from zipline which allows live trading or backtrader....unfortunately backtrader does not have a kind of Alphalens. So for reasearch one can use zipline and for trading backtrader. Big bonus with backtrader is that it allows to use fundamental data.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4bb8c07e062a0049665d88' id='5e4bb8c07e062a0049665d88'>
<a href='#5e4bb8c07e062a0049665d88'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1582020800000' class='quanto-date posted-at response-posted-at' href='#5e4bb8c07e062a0049665d88'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Carsten<br>
It is just possible that I may be able to slim down the logic in my Quantconnect algo but looking back at what they offered in the past they have already cut down their offering once and so may presumably do so again. The other disadvantage (as with Quantopian) is that using an online IDE is like trying to code while looking through a microscope.</p>

<p>Also, TBH, Quantconnect is very slow and they do not allow multiple concurrent back tests.</p>

<p>&quot;Allows you to use fundamental data&quot; is one thing, subscribing to it as well as pricing data and mapping and matching up the two is a different kettle of fish.</p>

<p>Would you use daily data or minute data? If daily, the whole subscription would be quite cheap since fundamental data is offered quite cheaply by Quandl, and CSI Data have a well priced daily price offering.</p>

<p>All of this still leaves you to load everything on a server (presumably in the cloud) and connecting to the IB API.</p>

<p>And then of course some months or years after that you will discover whether or not the algo is a mere mirage destroyed by slippage in real trading.</p>

<p>No trying to be negative but merely pondering.</p>

<p>I think the route I will take initially is to try and slim down my algo further so as to run on the cheaper version of Quantconnect in the full realization that this may not provide a long term solution.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4bc4648825fa0041128f93' id='5e4bc4648825fa0041128f93'>
<a href='#5e4bc4648825fa0041128f93'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1582023780000' class='quanto-date posted-at response-posted-at' href='#5e4bc4648825fa0041128f93'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Zenothestoic</p>

<p>so far I got one month of data, daily price and fundamental for 20 years from Quandl for one month subscription for 100$.<br>
Actually I’m trying to build 3 Algos to run them together in a portfolio.<br>
I installed zipline and use Alphalens which runs fine (after spending quite a time to get it properly installed). But now it’s fine.<br>
I saw two options for live trading, but both are forks.<br>
In parallel I will try backtrader, the concept is quite similar. Backtrader was easy to install and get a first demo algo running. Everything within half an hour.<br>
Backtrader has an interface to IB Broker and allows for fundamental out of the box.<br>
It’s to bad that this is not possible with zipline. It’s a very good testing and research environment. If one works a lot with this, one would probably once in a while submit some Algos to them. But if they only want people to participate in their contests and not permit them to trade privately, a lot of people will go somewhere else...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4bdfac7e062a003d665e9c' id='5e4bdfac7e062a003d665e9c'>
<a href='#5e4bdfac7e062a003d665e9c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57a5e05aaf3a4c589d0009ab'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7bdda3882c7b4b607ca34ae9a4029810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57a5e05aaf3a4c589d0009ab'>Peter Harrington</a>
</div>
<a UTCms='1582030764000' class='quanto-date posted-at response-posted-at' href='#5e4bdfac7e062a003d665e9c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Carsten,<br>
What data did you get off of Quandl?  I use Sharadar&#39;s bundle.<br>
I have written loaders for Sharadar, Zacks, and CRSP (not from Quandl).  <a href="https://github.com/pbharrin/alpha-compiler/tree/master/alphacompiler/data/loaders" rel="nofollow">They are available on my Github alpha-compiler repo.</a><br>
If you are using Sharadar&#39;s data it does not include ETFs and the algos in this thread use SPY and IEF, but you can download that data for free.<br>
<a href="https://github.com/pbharrin/alpha-compiler/tree/master/alphacompiler/data" rel="nofollow">I also have code to load and use fundamental data, and sector codes.</a>  The documentation is not great but others have gotten it to work.  </p>

<p>Just thought I&#39;d let you know that code is out there.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4beae18825fa0044129072' id='5e4beae18825fa0044129072'>
<a href='#5e4beae18825fa0044129072'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1582033633000' class='quanto-date posted-at response-posted-at' href='#5e4beae18825fa0044129072'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>Backtrader has an interface to IB Broker and allows for fundamental out of the box.</p>
</blockquote>

<p>Good news indeed, I will take a look. Sounds better to ditch Zipline if it does not have this. I have not downloaded Lean - I wonder whether Lean has the connection built in?</p>

<p>Peter, thanks for that I will take a look. Magic - Sharadar includes price data as well.</p>

<p>The market is so disjointed and disparate for people like us. I can&#39;t help wondering whether a group should not try and set up some joint effort. There are so many people doing essentially the same thing and it is simply not realistic to rely in the longer term on third parties whose agenda keeps changing.</p>

<p>The big question is, as ever, monetisation. </p>

<p>The choices are: </p>

<ol>
<li>expect to make money trading - quite a challenge with ever changing markets but some form of momentum trading on stocks seems to have withstood the test of time.<br></li>
<li>flog something to someone.</li>
</ol>

<p>On 2, I wonder how the likes of Q and Q are actually making out? I can understand selling trading products to retail (fraught with regulatory difficulties as it is) but I wonder just how easy these people are finding it selling to hedge funds, most of whom presumably have teams of in-house nerds?</p>

<p>It&#39;s an odd place the internet - teeming with people but as to how many of them actually make a brass farthing is another matter.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4bed7b8825fa00411290cf' id='5e4bed7b8825fa00411290cf'>
<a href='#5e4bed7b8825fa00411290cf'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1582034299000' class='quanto-date posted-at response-posted-at' href='#5e4bed7b8825fa00411290cf'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Peter,</p>

<p>I’m using the Sharadar Bundle as well. It’s the combined price and fundamental.<br>
But it does not include ETFs, and due to that reason as well not the Index SPY and so on.<br>
The index I load from yahoo.</p>

<p>I spend quite a while to build a security databases with several tables.<br>
I build as well the codes to load from Quandl and yahoo and store it at that  database. As well I build some code to ingest it to zipline.</p>

<p>If you want you can have the code or maybe I host this on github. I was searching quite a while for a database and did not found anything for my needs. In this way other people could use it and don’t need to waste their time  - and maybe some builds code from other vendors for the database which I would use in the future :)</p>

<p>Are you using Zipline as well?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4bf5f58825fa004d1290c7' id='5e4bf5f58825fa004d1290c7'>
<a href='#5e4bf5f58825fa004d1290c7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57a5e05aaf3a4c589d0009ab'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7bdda3882c7b4b607ca34ae9a4029810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57a5e05aaf3a4c589d0009ab'>Peter Harrington</a>
</div>
<a UTCms='1582036469000' class='quanto-date posted-at response-posted-at' href='#5e4bf5f58825fa004d1290c7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Yes, I use Zipline.  I like Sharadar as it has OHLCV, fundamentals, and sector codes, and great coverage of the three.  </p>

<p>The strategies I trade rebalance 1x/month so I don&#39;t maintain a webserver.  You can just run a 1 day backtest in Zipline and write your positions to a text file then use some other code to place your trades or do it by hand.  I like to take a look at every trade just as a double check, and to see if there is something like a short selling restriction that would prevent the orders from filling.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4bf6a77e062a0049665f2a' id='5e4bf6a77e062a0049665f2a'>
<a href='#5e4bf6a77e062a0049665f2a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1582036647000' class='quanto-date posted-at response-posted-at' href='#5e4bf6a77e062a0049665f2a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Peter, Zenothestoic </p>

<p>what about to start a joint/open public github  repro.<br>
I don’t have the time to service something like this, but I’m interesting to contribute as I believe exactly what you (Zenothestoic) said. A lot of people are doing the same stuff and if you have to build on something from an organization it’s tricky as their interests are changing. It’s better to trust a community.</p>

<p>For me at the moment zipline looks quite advanced and I like all the small tools for displaying and special Alphalens. It’s a lot of work to build  something like this.</p>

<p>Actually I’m trying to run zipline with pipeline, very similar to the online version.<br>
This gives me the advantages to use first Alphalens tear sheets to see if the alpha is significant over time.<br>
Took me a while to get the tear sheet for Alphalens running offline and than use a copy paste solution to integrate it into zipline.</p>

<p>That’s why I believe I would be a great idea to contribute all this stuff to a central place.<br>
If we don’t get enough traffic to that place it will not grow.</p>

<p>Some ideas?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4c38d3dadac40042112d7a' id='5e4c38d3dadac40042112d7a'>
<a href='#5e4c38d3dadac40042112d7a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1582053587000' class='quanto-date posted-at response-posted-at' href='#5e4c38d3dadac40042112d7a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m definitely up for something but I would prefer to see a definite profit potential.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4dc9e4996cd4004c6e102a' id='5e4dc9e4996cd4004c6e102a'>
<a href='#5e4dc9e4996cd4004c6e102a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e4c6dc08e66a80045322545'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3d8117dcda874392561d2c50c284d6ef?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e4c6dc08e66a80045322545'>Robert Curzon</a>
</div>
<a UTCms='1582156260000' class='quanto-date posted-at response-posted-at' href='#5e4dc9e4996cd4004c6e102a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I modified to take the top 3 companies and also a few other minor tweaks.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4e09d4bac233004ad047bf' id='5e4e09d4bac233004ad047bf'>
<a href='#5e4e09d4bac233004ad047bf'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/554e33a53173e6978f00024e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/97bc0ec83d1503d714350b3a67abc5a6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/554e33a53173e6978f00024e'>Damiano Bolzoni</a>
</div>
<a UTCms='1582172628000' class='quanto-date posted-at response-posted-at' href='#5e4e09d4bac233004ad047bf'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Robert Curzon</p>

<p>Are you aware that leverage is around 4.6x?</p>

<p>Putting that aside, I came independently to the same original algorithm a month ago (haven&#39;t been on Quantopian for a few months) and my Backtrader implementation also works better with 3-5 assets. In order to avoid influencing results by picking a &quot;convenient&quot; rebalance date, I stick to the Monday in the 2nd week of the month. By doing so, every month the rebalancing takes place on a different date.<br>
I&#39;m working on implementing the suggestion somebody mentioned here of using the Piotroski score to improve results. I also believe that selecting the stocks with the best momentum first and THEN check for quality could deliver better results.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4e30eb707769004b31f40a' id='5e4e30eb707769004b31f40a'>
<a href='#5e4e30eb707769004b31f40a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1582182635000' class='quanto-date posted-at response-posted-at' href='#5e4e30eb707769004b31f40a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>cracy! :-)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4e7839707769004231f5fe' id='5e4e7839707769004231f5fe'>
<a href='#5e4e7839707769004231f5fe'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1582200889000' class='quanto-date posted-at response-posted-at' href='#5e4e7839707769004231f5fe'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I am glad that people are implementing the algo on different platforms using different data and different universes.</p>

<p>It confirms the basic premise but it does wean you away from the idea that any particular parameters are magical.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4f1c48af7f5a003f37d182' id='5e4f1c48af7f5a003f37d182'>
<a href='#5e4f1c48af7f5a003f37d182'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57a5e05aaf3a4c589d0009ab'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7bdda3882c7b4b607ca34ae9a4029810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57a5e05aaf3a4c589d0009ab'>Peter Harrington</a>
</div>
<a UTCms='1582242888000' class='quanto-date posted-at response-posted-at' href='#5e4f1c48af7f5a003f37d182'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is an alternate Pipeline version of the trend_up signal.  When I ported the above Pipeline code to Zipline it had some problems, and I wrote this version.  Functionally it is the same, but it is cleaner as you can take out the TrendUp logic and hide it elsewhere.  </p>

<pre><code>class TrendUp(CustomFilter):  
    inputs = [USEquityPricing.close]  
    window_length = TF_LOOKBACK  
    def __init__(self):  
        self.spy_sid = symbol(&#39;SPY&#39;).sid  
    def compute(self, today, assets, out, close):  
        spy_data = close[:, assets.get_loc(self.spy_sid)] # get only SPY data  
        ma_slow = spy_data.mean()  
        ma_fast = spy_data[-TF_CURRENT_LOOKBACK:].mean()  
        out[:] = ma_fast &gt; ma_slow  
</code></pre>

<p>You can utilize this in pipeline by: </p>

<pre><code>    pipe = Pipeline(columns={  
                        &#39;trend_up&#39;: TrendUp(),  
                        &#39;top_quality_momentum&#39;: top_quality_momentum,  
                        },  
                    screen=top_quality_momentum  
                   )  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4f33034d33da1e3d12c9d6' id='5e4f33034d33da1e3d12c9d6'>
<a href='#5e4f33034d33da1e3d12c9d6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1582248707000' class='quanto-date posted-at response-posted-at' href='#5e4f33034d33da1e3d12c9d6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>What about instead of SMA crossover using something more mainstream like negative GDP growth rate or yield curve inversion as a recession indicators/predictors?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4f7d33c297d73c4c09513c' id='5e4f7d33c297d73c4c09513c'>
<a href='#5e4f7d33c297d73c4c09513c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d7a21cf976616168b9a4235'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/261a63e6d60877480628f3b46e625409?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d7a21cf976616168b9a4235'>Shaun Murphy</a>
</div>
<a UTCms='1582267699000' class='quanto-date posted-at response-posted-at' href='#5e4f7d33c297d73c4c09513c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Robert Curzon</p>

<p>Just by removing the 0% brokerage and slippage. The performance is less than halved. </p>

<p>Looks like there is a either a bug in this algorithm or your strategy will make your broker richer than yourself. On top of that you still have to payback that high amount of leverage you are taking. </p>

<p>@Viridian that won&#39;t work. Negative GDP can show up 3 months after the stock market has dropped 10-30%. The stock market is the leading indicator of a recession.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e4fe2e04d33da7fc012cb35' id='5e4fe2e04d33da7fc012cb35'>
<a href='#5e4fe2e04d33da7fc012cb35'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57a5e05aaf3a4c589d0009ab'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7bdda3882c7b4b607ca34ae9a4029810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57a5e05aaf3a4c589d0009ab'>Peter Harrington</a>
</div>
<a UTCms='1582293728000' class='quanto-date posted-at response-posted-at' href='#5e4fe2e04d33da7fc012cb35'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Shaun Murphy<br>
You are absolutely right, slippage is a problem, however I do not see leverage as a problem for the versions I used.  </p>

<p>There are many versions including the original that do not use leverage.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e5011f2b27d19221020fb8c' id='5e5011f2b27d19221020fb8c'>
<a href='#5e5011f2b27d19221020fb8c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57a5e05aaf3a4c589d0009ab'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7bdda3882c7b4b607ca34ae9a4029810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57a5e05aaf3a4c589d0009ab'>Peter Harrington</a>
</div>
<a UTCms='1582305778000' class='quanto-date posted-at response-posted-at' href='#5e5011f2b27d19221020fb8c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I tested two versions of this algorithm with Zipline on my laptop using the SHARADAR data, and the alpha-compiler code linked above.<br>
The versions I tested were Chris&#39;s Cain&#39;s original version and Marc&#39;s high-balance sheet-leverage, weekly rebalancing version (internally I call this Marc&#39;s turnt up version.)  Both algorithms maintain a gross leverage of 1.0.  I used 10 years of data, so I ran backtests from 2010-7-1 to 2020-2-18.  (I needed a little buffer for the momentum lookback data.)  </p>

<p>The Chris Cain version backtested similar on my laptop as the Quantopian data.  On Quantopian it had a CAGR of 16.4%, and on my setup it had a CAGR of 16.2%.  </p>

<p>Marc&#39;s Turnt up version was not so accurate.  Using debt to equity (hold on) I was able to get 27% CAGR compared to the 43% CAGR with the Quantopian data.  The SHARADAR fundamental data only has 91 fields and long_term_debt_to_equity is not one of them (that is the field from Morningstar that Marc used for leverage).  I substituted debt/equity for this to get the 27%.  Here is where I need some help.  Do you think I can calculate something similar to  long_term_debt_to_equity using the SHARADAR fundamental data?  </p>

<ol>
<li><p>The Morningstar long_term_debt_to_equity is defined as long_term_debt/shareholders_equity.  I don&#39;t have a field for preferred stock in the SHARADAR data, so I cannot calculate shareholders_equity from common equity.  Am I missing something here?  </p></li>
<li><p>Long_term_debt is defined by MS as debt with maturities longer than one year minus the stuff that is going to be paid off within the year.  I don&#39;t see anything like that from SHARADAR only non-current debt which appears to be debt with maturities longer than one year.  AM I missing something here?  </p></li>
</ol>

<p>Thank you for the help.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e5014171c0f62004ad4ceca' id='5e5014171c0f62004ad4ceca'>
<a href='#5e5014171c0f62004ad4ceca'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1582306327000' class='quanto-date posted-at response-posted-at' href='#5e5014171c0f62004ad4ceca'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>There is definitely a bug in   <a href="https://www.quantopian.com/posts/new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1#5e4dc9e4996cd4004c6e102a" rel="nofollow">Robert Curzon</a> code:</p>

<pre><code>context.top_n_relative_momentum_to_buy = 10 # Number to buy  
context.Target_securities_to_buy = 3.0



    for x in top_n_by_momentum.index:  
        if x not in context.portfolio.positions and context.TF_filter==True:  
            order_target_percent(x, (1.0 / context.Target_securities_to_buy))  
</code></pre>

<p>It is buying 10 stocks with weight 33% each<br>
which create artificial leverage 3.33</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e502272f1f1640045090d35' id='5e502272f1f1640045090d35'>
<a href='#5e502272f1f1640045090d35'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1582310002000' class='quanto-date posted-at response-posted-at' href='#5e502272f1f1640045090d35'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi </p>

<p>i&#39;m trying to compute the momentum using the slope and R2 idea from Andreas Clenow.<br>
He uses this based on </p>

<pre><code>def my_rebalance(context, data):  
.....
hist = data.history(context.security_list, &quot;close&quot;, hist_window, &quot;1d&quot;)  
momentum = hist.apply(slope)  
</code></pre>

<p>I would like to use it inside the make pipeline</p>

<pre><code>def make_pipeline(universe, context):  
.....
momentum = Slope(inputs=[USEquityPricing.close],  
                        window_length=200,  
                        mask=universe)

return Pipeline(columns={  
            &#39;momentum&#39; : momentum.top(10)  
                             }, screen=(universe) )      

</code></pre>

<p>i defined a class</p>

<pre><code>class Slope(CustomFactor):  
    &quot;&quot;&quot;  
    Input:  Price time series.  
    Output: Annualized exponential regression slope,  
            multiplied by the R2  
    &quot;&quot;&quot;  
    inputs = [USEquityPricing.close]  
    window_safe = True

    def compute(self, today, assets, out, close):  
        x = np.arange(len(close))  
        log_ts = np.log(close)  
        # Calculate regression values  
        slope, intercept, r_value, p_value, std_err = stats.linregress(x, log_ts)  
        # Annualize percent  
        annualized_slope = (np.power(np.exp(slope), 252) - 1) * 100  
        #Adjust for fitness  
        out[:] = annualized_slope * (r_value ** 2)  
</code></pre>

<p>But its not working at all. Looks like I have to change the close some how to a Dataframe....</p>

<p>Could someone help me on this?</p>

<p>Thankx  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e502e585efe2f5df4d06844' id='5e502e585efe2f5df4d06844'>
<a href='#5e502e585efe2f5df4d06844'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57a5e05aaf3a4c589d0009ab'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7bdda3882c7b4b607ca34ae9a4029810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57a5e05aaf3a4c589d0009ab'>Peter Harrington</a>
</div>
<a UTCms='1582313048000' class='quanto-date posted-at response-posted-at' href='#5e502e585efe2f5df4d06844'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Cartsen  </p>

<ol>
<li><p>Add 
<code>window_length=200</code> to your class definition. In a CustomFactor the close price is a NumPy 2-D array, unless you have window length=1.  Now close will have shape (200, number_of_assets).  </p></li>
<li><p>Scipy Stats.linregress builds one model at a time.  You are trying to build a model for each asset, so you want to do a for loop (not the best in terms of speed).  </p></li>
</ol>

<p>This does what you are trying to do, but it is not the fastest thing in the world, merry Christmas.  </p>

<pre><code>class Slope(CustomFactor):  
    &quot;&quot;&quot;  
    Input: Price time series.  
    Output: Annualized exponential regression slope,  
    multiplied by the R2  
    &quot;&quot;&quot;  
    inputs = [USEquityPricing.close]  
    window_safe = True  
    window_length=200  
    def compute(self, today, assets, out, close):  
        out_pre = np.zeros(close.shape[1])  
        x = np.arange(close.shape[0])  
        for i in range(close.shape[1]):  # loop over all the assets  
            log_ts = np.log(close[:, i])   # 200x1  
            # # Calculate regression values  
            slope, _, r_value, _, _ = stats.linregress(x, log_ts)  
            # # Annualize percent  
            annualized_slope = (np.power(np.exp(slope), 252) - 1) * 100  
            # #Adjust for fitness  
            out_pre[i] = annualized_slope * (r_value ** 2)  
        out[:] = out_pre  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e506f4cb27d19448a20fc38' id='5e506f4cb27d19448a20fc38'>
<a href='#5e506f4cb27d19448a20fc38'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d7a21cf976616168b9a4235'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/261a63e6d60877480628f3b46e625409?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d7a21cf976616168b9a4235'>Shaun Murphy</a>
</div>
<a UTCms='1582329676000' class='quanto-date posted-at response-posted-at' href='#5e506f4cb27d19448a20fc38'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Peter Harrington. </p>

<p>Firstly I was referring to Roberts code not yours.</p>

<p>Also I noticed that yahoo financials has long-term debt and total assets on their balance sheets.</p>

<p>To actually calculate a companies true value by long-term debt to equity, you would calculate: </p>

<p>long-term debt / (long-term debt - total assets)</p>

<p>These are commonly available from the balance sheets and can be obtained for free just getting financials data rather then fundamentals.</p>

<p>The more I research fundamentals the more I find most of them not being useful at all. They use share prices or number of shares as a way to compare companies way to often. You would not compare companies based on the number of shares they have issued or their share price. So why do fundamentals include these as a metric to compare companies? </p>

<p>If its long term debt per share and total assets per share than it can makes sense as they are using a constant rather than a variable. But to use something like sales per share which is calculated based on Sales / Average Diluted Shares Outstanding. Not all companies have the same number average diluted shares outstanding, right? </p>

<p>A better metric would be Sales/EV. For the same reason you can not compare companies based on EBITDA unless you use EV/EBITDA.</p>

<p>It seems as though through an obsession to find ways to calculate fundamentals not commonly used by other share trading firms, they have only found ways to outsmart themselves.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e5161561c0f6221c5d4cfcc' id='5e5161561c0f6221c5d4cfcc'>
<a href='#5e5161561c0f6221c5d4cfcc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1582391638000' class='quanto-date posted-at response-posted-at' href='#5e5161561c0f6221c5d4cfcc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Peter</p>

<p>I just went to you GitHub repro to find out how to include the fundamental data to zipline, but I do not understand how it is done.<br>
It looks like it was not ingested, instead you read it during the zipline run?<br>
Could it be included during ingestion process?<br>
I&#39;m using a SQL database to store everything.<br>
would it be possible to ingest some fundamentals together with the price data?<br>
I just stored the files for the SQL database and the importing and ingesting code at my GitHub repro, <a href="https://github.com/carstenf/Security-Master" rel="nofollow">https://github.com/carstenf/Security-Master</a><br>
Just to let you know if you are interesting.</p>

<p>As well I found on your GitHub the Basic_Pipeline_Usage.ipynb.<br>
I&#39;m using something similar to run Alphalens with make_pipeline on my MacBook (as well on repro), which is working, but way more cluttered.<br>
The zipline library is missing the get get_pricing and the possibility to load individual bundles.<br>
To get it running I had to build some work around which makes the tear sheet a bit cluttered.<br>
You are using a very elegant way to store theses thing in a library.<br>
How do I instal that library in my Zipline? I could do similar thing for my tear sheet</p>

<p>And the last question, is there a way to run python/zipline with more cores? just have a MacBook Pro with 2, but it would already double the speed.<br>
(I find it as well strange that python only uses around 30% cpu, which is only 60% of the one core)</p>

<p>Thank you<br>
Carsten  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e51bd48b6dcc60041944abd' id='5e51bd48b6dcc60041944abd'>
<a href='#5e51bd48b6dcc60041944abd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57a5e05aaf3a4c589d0009ab'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7bdda3882c7b4b607ca34ae9a4029810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57a5e05aaf3a4c589d0009ab'>Peter Harrington</a>
</div>
<a UTCms='1582415176000' class='quanto-date posted-at response-posted-at' href='#5e51bd48b6dcc60041944abd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Carsten, I will send you a PM and we can keep this thread to the discussion of quality companies in an uptrend.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e51bfa58662b900440c0819' id='5e51bfa58662b900440c0819'>
<a href='#5e51bfa58662b900440c0819'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d7a21cf976616168b9a4235'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/261a63e6d60877480628f3b46e625409?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d7a21cf976616168b9a4235'>Shaun Murphy</a>
</div>
<a UTCms='1582415781000' class='quanto-date posted-at response-posted-at' href='#5e51bfa58662b900440c0819'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Peter and Carsten,</p>

<p>I would be happy to help out. I already have zipline working and have started looking into Backtrader.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e52ac7289f8fd6e7de5268e' id='5e52ac7289f8fd6e7de5268e'>
<a href='#5e52ac7289f8fd6e7de5268e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1582476402000' class='quanto-date posted-at response-posted-at' href='#5e52ac7289f8fd6e7de5268e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Shaun</p>

<p>thankx, are you using Zipline with fundamentals?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e52ad3d8662b946230c0789' id='5e52ad3d8662b946230c0789'>
<a href='#5e52ad3d8662b946230c0789'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57a5e05aaf3a4c589d0009ab'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7bdda3882c7b4b607ca34ae9a4029810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57a5e05aaf3a4c589d0009ab'>Peter Harrington</a>
</div>
<a UTCms='1582476605000' class='quanto-date posted-at response-posted-at' href='#5e52ad3d8662b946230c0789'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Shaun Murphy, do you have the fundamentals and sector codes working in Zipline?<br>
If not a good place to discuss this would be the <a href="https://groups.google.com/forum/#!forum/zipline" rel="nofollow">Zipline Google Group</a>, or you can just PM me.  </p>

<p>Once you got that working, I could use some help figuring out why the higher return versions of this algo perform worse on the Sharadar data than with the Q data.  Right now, I get 23% CAGR with my Zipline setup, but on Quantopian the CAGR is over 40%.  I implemented a filter similar to the Q3000US and that hurt performance.  What hurt performance was removing trading on the OTC market.  (This is certainly good to know, as I would avoid OTC positions.)  It could  be that the Sharadar data is just missing some tickers.  That is what I&#39;m looking into now.  </p>

<p>I&#39;m not sure where is the best place to discuss a specific implementation of this algorithm.  Is it here, is it on the Zipline Google Group?  I feel both of those are not perfect.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e52bb3fb6dcc61c5b94499c' id='5e52bb3fb6dcc61c5b94499c'>
<a href='#5e52bb3fb6dcc61c5b94499c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1582480191000' class='quanto-date posted-at response-posted-at' href='#5e52bb3fb6dcc61c5b94499c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Peter</p>

<p>are you aware that some companies publish reports in two different ways? one ist the standard accounting way and then they use their version.<br>
The more expensive data providers are giving you both, Sharadar uses  standard.<br>
You might compare the pure inputs from Morningstar and Sharadar if it&#39;s the same value for the factors.<br>
(For EPS you will for sure find different numbers.I was trying to replicate the William O&#39;Neil strategy (I use the IBD service) with Matlab and got a different ranking for TEAM, CYBR were the on for AAPL was spot on.)</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e52fdb9b6dcc646f1944923' id='5e52fdb9b6dcc646f1944923'>
<a href='#5e52fdb9b6dcc646f1944923'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1582497209000' class='quanto-date posted-at response-posted-at' href='#5e52fdb9b6dcc646f1944923'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi</p>

<p>got the momentum based on slope and R2 running. Unfortunately with loops its way too slow (as expected) to optimize something.<br>
From first try outs, it looks it produces a less volatile momentum curve, but with a bit less return as well.</p>

<p>To speed up the function, I tried to parallelize the code in this way, but I looks there is an issue with the linregress function.</p>

<pre><code>def mom(x,close):  
    log_ts = np.log(close)   # 200x1  
    # # Calculate regression values  
    slope, _, r_value, _, _ = stats.linregress(x, log_ts)  
    # # Annualize percent  
    annualized_slope = (np.power(np.exp(slope), 252) - 1) * 100  
    # #Adjust for fitness  
    return annualized_slope * (r_value ** 2) 

class Slope(CustomFactor):  
    &quot;&quot;&quot;  
    Input: Price time series.  
    Output: Annualized exponential regression slope,  
    multiplied by the R2  
    &quot;&quot;&quot;  
    inputs = [USEquityPricing.close]  
    window_safe = True  
    window_length=200  
    def compute(self, today, assets, out, close):  
        out_pre = np.zeros(close.shape[1])  
        x = np.zeros(close.shape[:])  
        for i in range(close.shape[1]):  
            x[:,i] = np.arange(close.shape[0])  
        out[:] = mom(x,close)

</code></pre>

<p>you can call the function from</p>

<pre><code>def make_pipeline(universe):

    momentum = Slope(inputs=[USEquityPricing.close], window_length=200, mask=mom_filter)  
    return Pipeline(columns={  
                              &#39;momentum&#39;: momentum,  
                          }, screen=(universe) )

</code></pre>

<p>Someone has an idea were to look?  </p>

<p>Apart from that idea, does someone has another idea for a momentum function which produces less volatile outcomes?<br>
(The classical return function sometime catches stocks with sudden gap ups which than later very probably crash)</p>

<p>Thanks  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e537e79537fe27f5cf21e43' id='5e537e79537fe27f5cf21e43'>
<a href='#5e537e79537fe27f5cf21e43'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d7a21cf976616168b9a4235'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/261a63e6d60877480628f3b46e625409?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d7a21cf976616168b9a4235'>Shaun Murphy</a>
</div>
<a UTCms='1582530169000' class='quanto-date posted-at response-posted-at' href='#5e537e79537fe27f5cf21e43'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Peter and Carsten,</p>

<p>Today I was working on fixing a scikit-learn numpy version issue on my zipline/backtrader environment. Which is all up and running now. </p>

<p>I do not have fundamental data yet but I do like the idea of Quandl Sharadar SFA bundle for $99 a month. Even if I sign up for a month to ingest and save all the data and then cancel until I am ready to use current data. </p>

<p>I have started looking into adding the fundamental and sector data to zipline from the zipline google group as well as working a stock selection criteria similar to Q3000US.  These are the thing&#39;s I can start to work on now. </p>

<p>It looks like you need eventvester mergers and acquisitions data to mimic the Q3000US. This looks expansive as you have to enquire. They don&#39;t provide their prices online. I wander if there is a way to search stocktwits for companies announced for mergers and acquisitions and remove them from trading if they are. </p>

<p>I agree with this not being the best place to chat about this. Maybe we could start a group chat somewhere, so we can take this off quantopian.  We can start out own google group or something similar.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e538ca5537fe27f5cf21eb2' id='5e538ca5537fe27f5cf21eb2'>
<a href='#5e538ca5537fe27f5cf21eb2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1582533797000' class='quanto-date posted-at response-posted-at' href='#5e538ca5537fe27f5cf21eb2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Shaun<br>
You get the company action data with the Sharadar bundle. It includes adjustments for merger, acquisition and splits  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e53e0df454e3243f48ef7a8' id='5e53e0df454e3243f48ef7a8'>
<a href='#5e53e0df454e3243f48ef7a8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57a5e05aaf3a4c589d0009ab'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7bdda3882c7b4b607ca34ae9a4029810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57a5e05aaf3a4c589d0009ab'>Peter Harrington</a>
</div>
<a UTCms='1582555359000' class='quanto-date posted-at response-posted-at' href='#5e53e0df454e3243f48ef7a8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Carsten  Check <a href="https://www.quantopian.com/posts/building-a-better-beta" rel="nofollow">out this post</a> for how to build a faster beta.  You may need to modify it a little as you want to have a static left side and this uses a static right side.  </p>

<p>LMK if you need help putting it in a custom factor.  </p>

<p>I looked at the raw fundamental values from the two data providers and they are not even close.  I looked at eight values of debt to equity and two of them even had the wrong sign.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e5430aed4fa740049ea986b' id='5e5430aed4fa740049ea986b'>
<a href='#5e5430aed4fa740049ea986b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1582575790000' class='quanto-date posted-at response-posted-at' href='#5e5430aed4fa740049ea986b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Peter, thanks, just send you a PM</p>

<p>Regarding the raw fundamentals.<br>
I guess all provides have wrong numbers, just a question how much do they affect the outcome.<br>
 if you would create an Alphalens tear sheet and compare raw factors one should see how each of them deviate...<br>
I just hope it does not explain the difference between 23% and 40%, otherwise we can stop here and think about ideas for casinos.... :)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e553c59cd7e42521d2214ac' id='5e553c59cd7e42521d2214ac'>
<a href='#5e553c59cd7e42521d2214ac'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1582644313000' class='quanto-date posted-at response-posted-at' href='#5e553c59cd7e42521d2214ac'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>My suspicion would be that 40% is an illusion for a number of reasons, some of which have been stated.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e5a972dee01a626e50b0946' id='5e5a972dee01a626e50b0946'>
<a href='#5e5a972dee01a626e50b0946'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54b7b0b31c64e7d0bc0001b7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f3fbec910795910efa5222d1a658c3a5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54b7b0b31c64e7d0bc0001b7'>Jay Teguh Wijaya</a>
</div>
<a UTCms='1582995245000' class='quanto-date posted-at response-posted-at' href='#5e5a972dee01a626e50b0946'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>For anyone interested in the more exotic versions of this algorithm, promising extravagant returns by pursuing highly counter intuitive<br>
fundamental filters, I highly recommend back testing the system<br>
outside of the Quantopian IDE.  </p>

<p>I have spent some weeks learning Quantconnect, which offers similar<br>
data and an online IDE based in Python and various other programming<br>
languages. To say that the learning curve has been uphill would be an<br>
absurd understatement, but I followed Sisyphus both up the hill and<br>
down the other side.  </p>

<p>The results to be obtained bear little resemblance to the fantastic<br>
returns promised on this thread.  </p>

<p>Or not thus far in any event.  </p>

<p>Perhaps by further torturing the data or the software I will be able<br>
to improve the theoretical back tested results, but this may be an<br>
occasion where the data and the software simply lie. Where back<br>
testing can produce the dangerous illusion of fabulous performance<br>
which exists only in the mind of the programmer.  </p>

<p>The difference lies mainly in the universe. Here we have the<br>
Quantopian 3000 but little indication (?) as to how that is arrived<br>
at. In Quantconnect the universe selection is more or less DIY and<br>
selection of the more louche stocks cheers up the performance.  </p>

<p>It has been a very valuable experience indeed.</p>
</blockquote>

<p>This is interesting. Therefore, I guess the safest algorithms to use by retail investors are the ones with the entire stocks as the universe, and let the algo sort the universe on its own? This is perhaps achievable by writing a custom Filter for the universe selection.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e5acdb988f5590045e86a26' id='5e5acdb988f5590045e86a26'>
<a href='#5e5acdb988f5590045e86a26'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e57e0b105457500410ae13c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7b5484fe7facc62a5d9fb06b913be625?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e57e0b105457500410ae13c'>Vivan Chayy</a>
</div>
<a UTCms='1583009209000' class='quanto-date posted-at response-posted-at' href='#5e5acdb988f5590045e86a26'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>How would I use this to live trade?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e5b152836e96355546c0388' id='5e5b152836e96355546c0388'>
<a href='#5e5b152836e96355546c0388'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e3a1433b583cb003de52130'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/993d3f46c0c59b2a35a4e039dcee45a0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e3a1433b583cb003de52130'>Jim Darcy</a>
</div>
<a UTCms='1583027496000' class='quanto-date posted-at response-posted-at' href='#5e5b152836e96355546c0388'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello,<br>
I am relatively new to Quantopian and have been trying to make a simpler form of this code. I&#39;m currently getting a runtime error on line 26 with security_list. Any chance someone can help me out?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e5b8cca18117f21a5f67eea' id='5e5b8cca18117f21a5f67eea'>
<a href='#5e5b8cca18117f21a5f67eea'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1583058122000' class='quanto-date posted-at response-posted-at' href='#5e5b8cca18117f21a5f67eea'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The route I am taking is to secure my own fundamental and price data and to back test the system for myself on my own server using basic Python/Pandas/Numpy. </p>

<p>The limitations of these online IDEs are severe- very severe indeed. You need to sort the data yourself, make your own different and unbiased universes. You need to be able to inspect every aspect of every line of data. You need to be able to see the portfolio and its progress through time. You need to be able to look at volumes, dividends; everything. Using an online IDE may be fine for an initial exploration - and indeed useful. I am gratified to have come across this simple idea and would not have done so other than through this thread.</p>

<p>But to test whether the idea has legs, it is ludicrous in my view to rely on one on-line back tester where you can not download and analyse the data.</p>

<p>I have downloaded zipline successfully but the frustrations are enormous right from the go. Outstanding issues make it pointless unless you are prepared to spend months if not years sorting them out.</p>

<p>The route I have taken is to start from scratch and use my reasonable competence with Python and its libraries to back test for myself from scratch. I do not need the frustrations of somebody else&#39;s software, on or off line.</p>

<p>The Python community is so huge that every question will have been answered on StackExchange or elsewhere. Not so for something like Zipline and its myriad of outstanding issues.</p>

<p>Just a personal view of course but having spent some weeks on both Quantopian and then the Quantconnect IDE with vastly differing results, for me the only sensible solution is to go it alone.</p>

<p>I believe the basic premise of this system &quot;works&quot;. I believe that every source of data (whether price or fundamental) will product different or very different results. Same for each back tester. But that basically the two sort process (fundamental and momentum) can produce above market returns. On an absolute basis anyway.</p>

<p>Call me obsessive and anal but I believe the best course of action is to return to basics and do it all yourself. And given the trade frequency, there really is no need to automate the orders, especially given the facility at IB to upload a CSV for the rebalancing.</p>

<p>For anyone familiar enough with Python and its dependencies, to back test one simple system such as this from scratch is a walk in the park and a satisying and instructive one at that.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e610f22ed240b1fc3430cd4' id='5e610f22ed240b1fc3430cd4'>
<a href='#5e610f22ed240b1fc3430cd4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57a5e05aaf3a4c589d0009ab'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7bdda3882c7b4b607ca34ae9a4029810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57a5e05aaf3a4c589d0009ab'>Peter Harrington</a>
</div>
<a UTCms='1583419170000' class='quanto-date posted-at response-posted-at' href='#5e610f22ed240b1fc3430cd4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Regarding my progress on this, I tested the original version of this algorithm and the results were similar (comparing my own setup and Quantopian&#39;s) over the last 10 years. </p>

<p>I was testing one of the higher return versions, and I realized the Sharadar fundamental data did not have the information needed.  Namely there is no way to calculate common equity.  I will need to find an alternate source.  It would be ideal to get Morningstar&#39;s data and I am waiting to hear back from them.  <a href="https://www.quandl.com/databases/ZFA/documentation" rel="nofollow">Zacks&#39;s also has a fundamental dataset</a> which could be used.  It is $1200/year on Quandl and you get a 10-years worth of the data.  </p>

<p>If anyone has any other ideas on where to get fundamental data: I am all ears.  I know some have suggested pulling it from Morninstar&#39;s website for free, and that is well documented, but it is limited to five quarters.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e615b66fb5c4c327bbb7ac0' id='5e615b66fb5c4c327bbb7ac0'>
<a href='#5e615b66fb5c4c327bbb7ac0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1583438694000' class='quanto-date posted-at response-posted-at' href='#5e615b66fb5c4c327bbb7ac0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Peter</p>

<p>i was not able so far to test the fundamental data, i&#39;m still trying to find a way to use them with zipline...but if I run in the same problem then you, and I guess I will, I would look for some historically top notch data. lets say 20years top notch 1998 to 2018 should be great.<br>
its just a question where to get them. I would look to university...most of them get data from the top notch data vendors for research purpose.<br>
Maybe you know somebody there. I was already playing with the idea to pay 100€ enrollment fee for one semester (at least in Europe its inexpensive) and get the data....</p>

<p>if you have the top data, you still need to clean them.<br>
I read a lot that the cleaning process is quite an important and overlooked issue.<br>
You would need to store the original and then generate the improved one. </p>

<p>If the cleaned historical data would perform as you expect, you could test them against cheaper data vendor data.<br>
Creating a kind of benchmark would be great (including an algo)<br>
At the end, I don&#39;t think that my algo will justify to pay something like 100k $/year for data (at least that was the price I understand you need to pay for the top notch ones)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e615d6aaed6e100448ffbe5' id='5e615d6aaed6e100448ffbe5'>
<a href='#5e615d6aaed6e100448ffbe5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5804841ed11a8ac44b0005b4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2c330d252d5fb3c0bc0109a5919d2ff4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5804841ed11a8ac44b0005b4'>Marc</a>
</div>
<a UTCms='1583439210000' class='quanto-date posted-at response-posted-at' href='#5e615d6aaed6e100448ffbe5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi @Peter,</p>

<p>I’m building a docker file to set up the environment, will upload it to github if I succeed. You mentioned you use Sharadar for fundamentals but where are you getting the base universe and price data?</p>

<p>Thanks in advance.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e615dcf1f59611c6755e609' id='5e615dcf1f59611c6755e609'>
<a href='#5e615dcf1f59611c6755e609'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1583439311000' class='quanto-date posted-at response-posted-at' href='#5e615dcf1f59611c6755e609'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Zenothestoic</p>

<p>I just tried to build a backtester by my own in Matlab. interesting experience, you learn a lot...<br>
Bevor you spend a lot of effort and time into that endeavor, just ask yourself:<br>
Why do you believe, that your homemade one does not have build in mistakes and performed better than zipline?<br>
I answered that question to myself and changed language and now moved to zipline.<br>
The biggest advantages with open code is that its review and tested by a huge amount of people for free.</p>

<p>Did you got zipline running so far? For me it was a bigger pain than a root canal treatment, but now its fine, like the root canal  :)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e616295aed6e100448ffc5b' id='5e616295aed6e100448ffc5b'>
<a href='#5e616295aed6e100448ffc5b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1583440533000' class='quanto-date posted-at response-posted-at' href='#5e616295aed6e100448ffc5b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Yes, I got zipline working on my laptop. But I did not, have not and do not intend to integrate it with fundamental data.</p>

<p>I have done much backtesting using Python Pandas and so on and I get a great deal more satisfaction from doing that than fiddling around trying to understand other peoples software.</p>

<p>In particular I feel burnt and pissed off having spent weeks learning Lean only to discover Quantconnect could not handle my system at a price I am comfortable to pay.</p>

<p>I do not wish to mess around with bundles, ingestion or any of the rest of the shenanigans when I have done such work so often with all sorts of data (including the complexities of options) . Using simple dataframes. I have done the work before, using CSI data, of replicating the Russell 3000 for instance.</p>

<p>Python and Pandas are open sourced code and used by a far larger number of people than zipline.  I have been coding systems for 20 years and simply don&#39;t need anything other than the basic tools.</p>

<p>But of course it is a personal choice. </p>

<p>Actually, in any event, I am in contact with somebody who has set up the entire zipline thing in the cloud with the connection to IB and who is also setting up fundamental data.  That person is somebody who has been in software as a business all his life and yet it has taken him (I think he said) years to get the setup to this stage.</p>

<p>If I wish to trade automatically I shall do so through his set up.</p>

<p>As an irrelevant and irreverent aside, my suspicion is that these algos will probably disappoint in time, particularly the very high performing ones. It is all based on prediction from past events. Which is not so very foolproof as countless failed hedge fund managers have managed to prove so admirably over the years.</p>

<p>My suspicion is that the most successful hedge funds may be the very short term operators who rely on things like trade flow. I am assuming (but may of course be entirely wrong) that funds such as Renaisance/ Medallion use rather more reliable methods of &quot;forecasting&quot; than most of us have been using here.  I am assuming that &quot;Flash Boys&quot; probably paints a fairly accurate picture as to why and how those people make so much money. But who knows.</p>

<p>It is particularly noteworthy that their equity fund has met with limited success by comparison to Medallion (their HFT effort). </p>

<p>Prediction over the very short term may be a better bet than forecasting (by way of example) that a small clutch of very highly indebted companies will shoot the lights out over the next twenty years as they (appear!) to have done over the past twenty.</p>

<p>Anyway please excuse my cynicism.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e6167cced240b0647430bab' id='5e6167cced240b0647430bab'>
<a href='#5e6167cced240b0647430bab'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1583441868000' class='quanto-date posted-at response-posted-at' href='#5e6167cced240b0647430bab'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Incidentally on Sharadar one does indeed need to be careful to make sure one is comparing apples to apples. I have not really done too much work on it so far, but I was a little alarmed that JPMorgan&#39;s DER was said to be over 11 in the sample data provided for 2018.</p>

<p>Here is Mornigstars definition:</p>

<blockquote>
<p>Debt-to-Equity Ratio The debt/equity ratio is calculated by dividing a<br>
company&#39;s long-term debt by total shareholders&#39; equity. It measures<br>
how much of a company is financed by its debtholders compared with its<br>
owners. A company with a lot of debt will have a very high debt/equity<br>
ratio, while one with little debt will have a low debt/equity ratio.<br>
Assuming everything else is identical, companies with lower<br>
debt/equity ratios are less risky than those with higher such ratios.</p>
</blockquote>

<p>Here is Sharadar&#39;s definition:</p>

<blockquote>
<p>Measures the ratio between [Liabilities] and [Equity].</p>
</blockquote>

<p>Not the same thing at all. Whether Sharadar contains the same definition of &quot;long term debt&quot; as Morningstar I have not yet troubled to ascertain. Nor have I looked at &quot;Equity&quot;.</p>

<p>This is no grumble at either party - merely an observation as to my surprise. </p>

<p>I believe the &quot;correct&quot; figure for JPMs DER in 2018 was more like 1.1 </p>

<p>Anyway, just saying......  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e616843fb5c4c327bbb7b9b' id='5e616843fb5c4c327bbb7b9b'>
<a href='#5e616843fb5c4c327bbb7b9b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1583441987000' class='quanto-date posted-at response-posted-at' href='#5e616843fb5c4c327bbb7b9b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Zenothestoic  </p>

<p>no worries mate :)</p>

<p>Interesting comment your last paragraph, the one bevor the cynicism....could be<br>
I was thinking, that mean reverting, momentum and factors should always work. Just a matter to understand in which regime we are at the moment.<br>
And if you have less money you can jump boot much faster which is the big advantage we have.<br>
If you have a lot, you need the latest trick and that probably fades away faster.</p>

<p>I&#39;m quite new to python, but start liking it..<br>
As I just have limited time, I just would like to invest it were it matters.<br>
By the way, do you think it would pay off to use Quantpedia to get building blocks?<br>
Im looking towards several diversified strategies, around 10 different ones.<br>
Im shooting for 30% with low volatility.</p>

<p>The person you are in contact did not publish that on a blog or at GitHub?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e616a0eaed6e100478ffc98' id='5e616a0eaed6e100478ffc98'>
<a href='#5e616a0eaed6e100478ffc98'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1583442446000' class='quanto-date posted-at response-posted-at' href='#5e616a0eaed6e100478ffc98'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>&quot;Just a matter to understand in which regime we are at the moment.&quot;</p>
</blockquote>

<p>Many have tried. Few have succeeded in the long term. </p>

<p>In particular look at the amusing history of JW Henry and Bill Dunn. The wonders of commodity trend following in the 1980s became a very different game in recent decades.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e616a8e3ca09e6b5d172f73' id='5e616a8e3ca09e6b5d172f73'>
<a href='#5e616a8e3ca09e6b5d172f73'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1583442574000' class='quanto-date posted-at response-posted-at' href='#5e616a8e3ca09e6b5d172f73'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>The person you are in contact did not publish that on a blog or at GitHub?</p>
</blockquote>

<p>I think he will make an announcement but I would not wish to comment at this stage. I think it is still a bit of a work in progress. Or at least (as I understand it) not wholly ready to offer out as reliable &quot;Software as a Service&quot;.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e616d4e3ca09e003d1738db' id='5e616d4e3ca09e003d1738db'>
<a href='#5e616d4e3ca09e003d1738db'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1583443278000' class='quanto-date posted-at response-posted-at' href='#5e616d4e3ca09e003d1738db'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Zenothestoic</p>

<p>ok, that will be than another monthly payed service...<br>
I would prefer a public shared software, because of the peer review advantage (even if I need to pay something, but than it has no public review and than I don&#39;t trust it...its an oxymoron)</p>

<p>regarding the other comment, what kind of strategies you are using? or are these totally creative off the track new stuff?<br>
Than you would need a lot of time for development.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e61717ced240b07c1430c9c' id='5e61717ced240b07c1430c9c'>
<a href='#5e61717ced240b07c1430c9c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1583444348000' class='quanto-date posted-at response-posted-at' href='#5e61717ced240b07c1430c9c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m not using any strategies currently. The last serious effort was trend following on futures. I successfully played the Vix a year or so ago.</p>

<p>To make decent money (imho) you either need stable assets under management or a game where the dice are heavily loaded in your favour. </p>

<p>I have been lucky enough to benefit from the latter on occasions in the past but am currently bereft of ideas.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e6179b41f5961003f55f200' id='5e6179b41f5961003f55f200'>
<a href='#5e6179b41f5961003f55f200'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d7a21cf976616168b9a4235'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/261a63e6d60877480628f3b46e625409?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d7a21cf976616168b9a4235'>Shaun Murphy</a>
</div>
<a UTCms='1583446452000' class='quanto-date posted-at response-posted-at' href='#5e6179b41f5961003f55f200'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I signed up for the quandle sharadar SFA bundle, and I have a serious issue with the SEP data. When I download the entire CSV table. I only get 3 months of data dating back to the 2019/11/29. If I call from the API I hit a limit of 10,000 rows of data. With 16,000 stocks sharadar provide data for I can not even get a singles days worth of data without hitting this limit. </p>

<p>Of course zipline ingest does not work for sharadar SEP data. </p>

<p>The only thing I can do is look at individual ticker data to get periods dating back 20 years and exporting the .csv individually, however this would require me to source my own universe of stocks before I even export the data. Then I would have to find a way to bundle and ingest this data. Which will create a lot of work. </p>

<p>@Carsten and @Peter, when you both got the Sharadar SEP data did these limits apply?</p>

<p>The alternative is to sign up for SEP separately here <a href="https://www.quandl.com/databases/SEP/pricing/plans" rel="nofollow">https://www.quandl.com/databases/SEP/pricing/plans</a> for $399 for a year. But there is no guarantee that I would not hit these same limits.</p>

<p>I have contacted Quandl to request access to the data I purchased. I&#39;ll wait to see what they say.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e617b551f59612d5f55e7ea' id='5e617b551f59612d5f55e7ea'>
<a href='#5e617b551f59612d5f55e7ea'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1583446869000' class='quanto-date posted-at response-posted-at' href='#5e617b551f59612d5f55e7ea'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Shaun Murphy</p>

<p>yes, happened to me in the first run as well...<br>
I use different calls for different amount of data, just see my repo <a href="https://github.com/carstenf/Security-Master" rel="nofollow">https://github.com/carstenf/Security-Master</a><br>
just check quandl_to_db.py  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e61999f1f59612d5f55e92c' id='5e61999f1f59612d5f55e92c'>
<a href='#5e61999f1f59612d5f55e92c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5804841ed11a8ac44b0005b4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2c330d252d5fb3c0bc0109a5919d2ff4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5804841ed11a8ac44b0005b4'>Marc</a>
</div>
<a UTCms='1583454623000' class='quanto-date posted-at response-posted-at' href='#5e61999f1f59612d5f55e92c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is one more version of the algo that longs or shorts depending on the uptrend. It has some of @Vladimir &#39;s tuning but keeps @Chris fundamentals regarding quality and momentum, I find those easier to explain (even results are less impressive).<br>
In this version, when the market is not in uptrend, I short bad quality companies with no momentum.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e619a323ca09e0043173ae0' id='5e619a323ca09e0043173ae0'>
<a href='#5e619a323ca09e0043173ae0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d7a21cf976616168b9a4235'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/261a63e6d60877480628f3b46e625409?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d7a21cf976616168b9a4235'>Shaun Murphy</a>
</div>
<a UTCms='1583454770000' class='quanto-date posted-at response-posted-at' href='#5e619a323ca09e0043173ae0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Marc, </p>

<p>For your bottom strategy did you realize that you are selecting the bottom of the top 60 ROE stocks, not the bottom of the bottom of the ROE Q3000US. Also they are still being selected from the a pool of stocks that meet the momentum criteria. You would need to create a bottom momentum SMA 200 &gt; SMA 50 and a context for bottom 60 ROE for your bottom strategy. </p>

<p>Trying to short good quality companies does not make much sense.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e61a330fb5c4c627bbb7d55' id='5e61a330fb5c4c627bbb7d55'>
<a href='#5e61a330fb5c4c627bbb7d55'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5804841ed11a8ac44b0005b4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2c330d252d5fb3c0bc0109a5919d2ff4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5804841ed11a8ac44b0005b4'>Marc</a>
</div>
<a UTCms='1583457072000' class='quanto-date posted-at response-posted-at' href='#5e61a330fb5c4c627bbb7d55'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi @Shaun,</p>

<blockquote>
<p>For your bottom strategy did you realize that you are selecting the bottom of the top 60 ROE stocks</p>
</blockquote>

<p>Looking at the code I would say I&#39;m getting the 60 low quality stocks of my universe  </p>

<pre><code>    context.TARGET_SECURITIES = 5  
    context.TOP_ROE_QTY = 60  
    universe = Q3000US()  
    bottom_quality = quality.bottom(context.TOP_ROE_QTY, mask=universe)  
    bottom_quality_momentum = momentum.bottom(context.TARGET_SECURITIES, mask=bottom_quality)  
</code></pre>

<blockquote>
<p>Also they are still being selected from the a pool of stocks that meet the momentum criteria.</p>
</blockquote>

<p>trend_up is set based on the SPY. I&#39;m using it to decide if I have to long or short (unless I&#39;m doing something wrong). To choose the stocks I filter the 5 with worse momentum from the 60 with lowest quality chosen before</p>

<pre><code>    context.TARGET_SECURITIES = 5  
    context.TOP_ROE_QTY = 60  
    universe = Q3000US()  
    bottom_quality = quality.bottom(context.TOP_ROE_QTY, mask=universe)  
    bottom_quality_momentum = momentum.bottom(context.TARGET_SECURITIES, mask=bottom_quality)  
</code></pre>

<pre><code>    if context.trend_up:  
        total_weights = context.stock_long_weights  
    else:  
        total_weights = context.stock_short_weights  
</code></pre>

<blockquote>
<p>Trying to short good quality companies does not make much sense.</p>
</blockquote>

<p>Agreed. My code might be buggy but that is not what I&#39;m trying to do.</p>

<p>Thanks!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e61ae0a3ca09e7f39173478' id='5e61ae0a3ca09e7f39173478'>
<a href='#5e61ae0a3ca09e7f39173478'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e61acbc1f596103fd55ea39'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0be7ca67281079f76f643b31ae07120d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e61acbc1f596103fd55ea39'>seers quant</a>
</div>
<a UTCms='1583459850000' class='quanto-date posted-at response-posted-at' href='#5e61ae0a3ca09e7f39173478'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Zenothestoic</p>

<p>Have looked at <a href="https://blueshift.quantinsti.com/" rel="nofollow">https://blueshift.quantinsti.com/</a> (currently supports Alpaca) and they are working on getting Interactive Brokers as well. However, they lack fundamental data at the moment.</p>

<p>I have spent quite a few weeks/month on the uphill curve on QC/Lean but the backtests seem very slow, especially after adding more stocks to the &#39;universe&#39;.</p>

<p>I am exploring setting up pipeline_live, with polygon fundamental data, but would really prefer using a server.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e66cbac02bf3900479c6334' id='5e66cbac02bf3900479c6334'>
<a href='#5e66cbac02bf3900479c6334'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5273491056c6d0b88b0000ef'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b64d857928fd7ac99efdcb547179b7aa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5273491056c6d0b88b0000ef'>Mohamed Ajmal</a>
</div>
<a UTCms='1583795116000' class='quanto-date posted-at response-posted-at' href='#5e66cbac02bf3900479c6334'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi,</p>

<p>New to Quantopion, trying to learn and understand, awesome thread, thanks everyone, having a basic question, how can we replace bonds with Gold, I tried with Gold ETF and Gold Spot symbols which are giving me error, tried searching in forum, one Gold symbol used seems to be deprecated, </p>

<p>Thanks before hand.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e6703e3613484003ed956ab' id='5e6703e3613484003ed956ab'>
<a href='#5e6703e3613484003ed956ab'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1583809507000' class='quanto-date posted-at response-posted-at' href='#5e6703e3613484003ed956ab'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p><code>symbol(&#39;GLD&#39;)</code> Keep in mind it will not work on a backtest starting prior to Dec 2004.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e680cef45b5aa0045bc7e57' id='5e680cef45b5aa0045bc7e57'>
<a href='#5e680cef45b5aa0045bc7e57'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5273491056c6d0b88b0000ef'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b64d857928fd7ac99efdcb547179b7aa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5273491056c6d0b88b0000ef'>Mohamed Ajmal</a>
</div>
<a UTCms='1583877359000' class='quanto-date posted-at response-posted-at' href='#5e680cef45b5aa0045bc7e57'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Viridian, Bond results were better than Gold, when calculated  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e694425ebe57a003bd28ed9' id='5e694425ebe57a003bd28ed9'>
<a href='#5e694425ebe57a003bd28ed9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5dad2ebcb7a55d0043c20ef6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/c0fddf077811c658e2e1365d4bb41f2d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5dad2ebcb7a55d0043c20ef6'>Matthew Kutzer</a>
</div>
<a UTCms='1583957029000' class='quanto-date posted-at response-posted-at' href='#5e694425ebe57a003bd28ed9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Is this sustainable in a live environment?<br>
If not, what needs to be improved for it to be &#39;live&#39; ready.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e696884951e7735ebcba60c' id='5e696884951e7735ebcba60c'>
<a href='#5e696884951e7735ebcba60c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57a5e05aaf3a4c589d0009ab'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7bdda3882c7b4b607ca34ae9a4029810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57a5e05aaf3a4c589d0009ab'>Peter Harrington</a>
</div>
<a UTCms='1583966340000' class='quanto-date posted-at response-posted-at' href='#5e696884951e7735ebcba60c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Matthew, can you please clarify what you mean by &quot;sustainable&quot; in this question?  </p>

<blockquote>
<p>Is this sustainable in a live environment?</p>
</blockquote>

<p>If you mean, can this be traded live, absolutely.<br>
If you mean are the returns shown in this backtest likely to be repeated going forward, that is another question.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e6a3502e3ec3a0040817126' id='5e6a3502e3ec3a0040817126'>
<a href='#5e6a3502e3ec3a0040817126'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5dad2ebcb7a55d0043c20ef6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/c0fddf077811c658e2e1365d4bb41f2d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5dad2ebcb7a55d0043c20ef6'>Matthew Kutzer</a>
</div>
<a UTCms='1584018690000' class='quanto-date posted-at response-posted-at' href='#5e6a3502e3ec3a0040817126'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Peter Harrington</p>

<p>Hey Peter, </p>

<p>Sorry for the confusion. I guess by sustainable I mean reliable. I am looking to throw some money into it ($1000) and let it run for 5+ years, but am scared by the level of returns. The leverage spikes to 2 a few times and I would not like to be trading on margin. I have seen many great algorithms here, but I lack some knowledge to decipher which algos would be practical and risk limited enough to take to a live environment.</p>

<p>**Also, if anyone has experience with TD Ameritrade TOS or Ameritrade developers who has taken any algorithms live and can help me through that process would be great.</p>

<p>Thanks for the help!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e6a393a6594d10046d45d02' id='5e6a393a6594d10046d45d02'>
<a href='#5e6a393a6594d10046d45d02'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1584019770000' class='quanto-date posted-at response-posted-at' href='#5e6a393a6594d10046d45d02'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Matthew There are a number of risks. Some of them are discussed above in this thread.</p>

<p>People worked on this strategy without employing a hold-out period. This makes it at particular risk of being &quot;overfit.&quot; Especially if you consider that many of the variations of this strategy posted above only hold 5-10 stocks at a time and turnover is very low, it&#39;s not very many datapoints. In other words, it could be latching on to a spurious correlation, which ultimately might not be predictive. The prudent thing to do would be to wait 6 months to a year and see how things are holding up.</p>

<p>Another risk is that market regime changes and what once worked stops working.</p>

<p>Both of these issues affect particularly the trend filter, which has been tuned to past events. We know every stock market crash/recession is different. So there&#39;s no reason to believe that what worked in 2008 will be effective in 2020.</p>

<p>Regarding the leverage spiking to 2, I believe I fixed that issue in the versions that I posted. I believe that was an artifact of the original algo&#39;s ordering logic.</p>

<p>Regarding executing this algorithm live, I don&#39;t see any reason to automate it. It holds few positions, turnover is low, and it exhibits negligible alpha decay. Just run a backtest through yesterday and check what the positions are at the end of the backtest and order them manually. Rebalance monthly -- it&#39;ll take you 15 minutes.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e6a3bcdfa7178449e81784f' id='5e6a3bcdfa7178449e81784f'>
<a href='#5e6a3bcdfa7178449e81784f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5dad2ebcb7a55d0043c20ef6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/c0fddf077811c658e2e1365d4bb41f2d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5dad2ebcb7a55d0043c20ef6'>Matthew Kutzer</a>
</div>
<a UTCms='1584020429000' class='quanto-date posted-at response-posted-at' href='#5e6a3bcdfa7178449e81784f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Viridian</p>

<p>Thanks for the insights! I read the above the posts, but appreciate you making sense of it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e6a446b951e776f63cba216' id='5e6a446b951e776f63cba216'>
<a href='#5e6a446b951e776f63cba216'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5273491056c6d0b88b0000ef'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b64d857928fd7ac99efdcb547179b7aa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5273491056c6d0b88b0000ef'>Mohamed Ajmal</a>
</div>
<a UTCms='1584022635000' class='quanto-date posted-at response-posted-at' href='#5e6a446b951e776f63cba216'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi, @viridian, thanks for the inputs, just to add like Matthew I&#39;m a new to quant, but not so to stockmarkets.. I&#39;m also looking at integrating IB accounts to algo trading, though I can understand code, but havent coded, learning.. </p>

<p>I&#39;m wanting to  learn or be guided though anyone from above if they can spend some time, like a talk for 10-20min, modify some ideas, help in integrating the account and start trading... my gmail is ajmal.doc @, kindly if anyone is interested please contact, I&#39;m willing to pay a reasonable amount for the services.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e6a48ce951e773ac1cba32f' id='5e6a48ce951e773ac1cba32f'>
<a href='#5e6a48ce951e773ac1cba32f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5273491056c6d0b88b0000ef'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b64d857928fd7ac99efdcb547179b7aa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5273491056c6d0b88b0000ef'>Mohamed Ajmal</a>
</div>
<a UTCms='1584023758000' class='quanto-date posted-at response-posted-at' href='#5e6a48ce951e773ac1cba32f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@viridian.. Like you have said regarding leverage is fixed in your code, can u advice on the below,</p>

<ol>
<li><p>why cant we have a holdout period integrated - rather a cash out period with a if condition, cash out or keep invested, like when trend positive year, we take out - fixed percentage like 10% of profits or average market returns of SPY of that positive year, a fixed time to cash out or even to cash out in optimized time frame within 6months like that...</p></li>
<li><p>As brokers do, giving higher leverage in positive times and stopping in negative periods, can we not have higher leverage during uptrends and reduce during negative times.</p></li>
<li><p>from the discussion it looks like u dont believe much in stop losses, looking at the data and back testing they seem to help less, strange it is though for me coming from a technical analysis background.. but a stop loss to not lose out of profits clubbed with cashing out regularly would be a good addition.</p></li>
<li><p>Spare my lesser knowledge, cant the optimize function not be used to - optimze time frame to lookback for trend or optimized crossover or optimized stock weightage or number of stocks, because each also would infact require a different set..</p></li>
<li><p>What u said is true that what worked earlier might not work today, but the best we do is learn from past and also have ahands on approach to algo to intervene or override when needed.</p></li>
<li><p>Why does the code need to be invested at anytime in a bond - is it as a alternative to having cash to purchase or hats the logic behind such in the code.</p></li>
<li><p>Going long and short simultaneously should generate more profits, but it doesnt, has anyone tested it out with the above code?  </p></li>
</ol>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e6a535ffa7178449e81792d' id='5e6a535ffa7178449e81792d'>
<a href='#5e6a535ffa7178449e81792d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1584026463000' class='quanto-date posted-at response-posted-at' href='#5e6a535ffa7178449e81792d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Mohamed Ajmal<br>
You can increase the sample size by trading more frequently. I have tested it weekly and daily rather than monthly.  Mr V Hawk quite rightly pointed out the dangers of trading 5 stocks. To be frank that probably amounts to quite a high risk gamble. 20 to 50 would be safer from the point of view of single stock risk.</p>

<p>The factor you use can also be an issue. Given the pandemic, companies with high debt may be considered a particular risk - how can they pay their interest charges if their shops and factories are closed and they have no income coming in?</p>

<p>The particular 5 stock High Debt algo I am considering is in the middle of a 40% drawdown thanks to this virus. The market is only down 20% from its recent high.</p>

<p>As to the canary in the cage - take a look at 1987. I was a stockbroker in Hong Kong during that crash and it was so swift and dramatic that few if any indicator would have saved you. Luckily it was a V shaped drawdown with a swift recovery.</p>

<p>If you are not prepared for high risk then look to trade a combination of good fundamental factors not a single high risk factor with this algo and look to hold 20 stocks upwards.  Frankly your risk then becomes more or less market risk with a momentum slant.</p>

<p>The only surefire way to make huge profits is either to manage money at least competently. Or find an unorthodox and possibly immoral edge. Read Flash Boys for example by Michael Lewis. Watch Wolf of Wall Street and Wall Street. </p>

<p>Nothing is secure or for sure. Few people will make big money over the very long term by trading predictive algorithms which rely on the past to predict the future.</p>

<p>Look at the Turtles.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e6f9492b4e8b20040294b07' id='5e6f9492b4e8b20040294b07'>
<a href='#5e6f9492b4e8b20040294b07'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e6f8e3f8963b3003cde7689'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/51a922e4fca03a06d67d1d0c6a970b61?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e6f8e3f8963b3003cde7689'>Cyril Bosch</a>
</div>
<a UTCms='1584370834000' class='quanto-date posted-at response-posted-at' href='#5e6f9492b4e8b20040294b07'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Impressive returns. I would say the strategy probably suffers from a large dose of outcome bias and/or (controversially) lookahead bias. The returns are impressive but it’s a well know fact that quality/momentum worked well in the US over that specific sample period. A guess - the returns will be less impressive if tested on a Japanese universe where those particular factors worked less well. That strategy might be taking unintended long bets on healthcare stocks and short best on financial/oil stocks. This type of factor risk exposure should be avoided to build really robust multifactor strategies. Try employing the same stock selection process one MSCI sector at a time, match sector beta (optimisation algo) and aggregate into the final portfolio rebalanced monthly. My guess - IR drops materially. It’s a bit like building a portfolio that’s long the tech/healthcare ‘factor’ and short the banks/oil/industrial ‘factor’. Such a portfolio will do similarly well over that period but might be meaningless going forward.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e6fee062bfcac003dcc0192' id='5e6fee062bfcac003dcc0192'>
<a href='#5e6fee062bfcac003dcc0192'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1584393734000' class='quanto-date posted-at response-posted-at' href='#5e6fee062bfcac003dcc0192'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I do not understand how this strategy could have &quot;lookahead&quot; bias. I agree that it may not work going forward if that is what you mean but the same could be said about each and every back tested strategy.  Quality can never be a bad thing. Any sensible long term investor would do well to invest in quality stocks while realizing that in some periods he will be outperformed by the latest fads. In the long term however he is likely to do well.</p>

<p>Momentum many be a different matter. Traditional CTAs have certainly struggled with trend following this last decade. Who knows, perhaps the momentum effect may end. </p>

<p>There is no shorting in this strategy so the system is not taking short positions in finance, oil or any other stocks.</p>

<p>Perhaps for those who are really seeking what you describe as a &quot;multifactor&quot; strategy, the investor should simply stick to widely based general index trackers.  There is certainly no shame in that and almost by definition each and every factor available in the market will be included.</p>

<p>I&#39;m afraid we could talk ad infinitum but it all boils down to useless prediction and talk. And speculation. Quality is NOT a factor - it is a measure of financial prudence. But I can understand why you seek to define it as such.</p>

<p>To be perfectly honest, much of the talk on trading forums is simply &quot;mathturbation&quot; as Seykota would put it.  As I ventured above, in the very long term perhaps the only likely chance of success is very wide diversification. Unless of course you have some built in advantage as do those who deal on inside information or have information on order flow. </p>

<p>Looking back to my time in Hong Kong in the 1980, I would not have gone too far wrong with wide global diversification. Japan included. You will never diversify away rotten eggs so you need to dilute them.</p>

<p>As I droned on about elsewhere, Imperial Russia, the Kaiser&#39;s Germany and Argentina were the hot markets in the 1900s.  Wide diversification would have been a wise policy in those days; it remains so.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e6ff58e68efb6004c07c87a' id='5e6ff58e68efb6004c07c87a'>
<a href='#5e6ff58e68efb6004c07c87a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e6f8e3f8963b3003cde7689'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/51a922e4fca03a06d67d1d0c6a970b61?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e6f8e3f8963b3003cde7689'>Cyril Bosch</a>
</div>
<a UTCms='1584395662000' class='quanto-date posted-at response-posted-at' href='#5e6ff58e68efb6004c07c87a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Lookahead bias was probably stretching the definition too far. What I meant was is that we all build strategies that we expect will work based on our own experience and what has worked in the past. The sample data usually starts at some point in the distant past (2002?) and at least some of our experience was gained during the sample period. Thus there is enourmous information leakage into a lot of trading algoritms. </p>

<p>You say there are no shorting in the strategy but it is measured against SPY so of course there are active overweight and underweight (short) exposures. There is no way the strategy screens for high ROE and are underweight (high ROE) healthcare and overweight (low ROE) banks. </p>

<p>Quality is definitely a well recognised factor in the industry. FTSE : &quot;Following Asness et al. (2013), we consider quality as the consistent ability to generate strong future cash flows. We assess quality from several perspectives: profitability, operating efficiency, earnings quality (accruals) and leverage. &quot;  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e706eca1904ca003b434ae1' id='5e706eca1904ca003b434ae1'>
<a href='#5e706eca1904ca003b434ae1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1584426698000' class='quanto-date posted-at response-posted-at' href='#5e706eca1904ca003b434ae1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Zenothestoic </p>

<p>I do see there is  &quot;lookahead&quot; bias.  Very simple, there is function before_trading_start(context, data). All the entry evaluations happen after market open.</p>

<p>I think one of the important rules of before_trading_start(context, data) is to avoid &quot;lookahead&quot; bias. Maybe one could say this &quot;lookahead&quot; bias is not so worse since it trade weekly or monthly.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e709d1768efb6004c07dc06' id='5e709d1768efb6004c07dc06'>
<a href='#5e709d1768efb6004c07dc06'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1584438551000' class='quanto-date posted-at response-posted-at' href='#5e709d1768efb6004c07dc06'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thomas<br>
All calculations are done on the previous night&#39;s close. In my algo anyway. There is therefore no lookahead involved.</p>

<p>Cyril<br>
Totally agree on the dangers of backtesting. I agree that the weightings in this strategy will differ from an index such as the S&amp;P although of course you could correct for that if you so chose. Nice quote from Asness. The word &quot;Factor&quot; always strikes me as somewhat akin to market timing. Now is the right time for this or that factor. I think my real point is that &quot;quality&quot; is not some fad, in vogue today out tomorrow. Quality is a consistent and lasting way of measuring companies which should last for the long term. But I am quibbling. People are of course free to use whatever terms they like.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e731a596fbc2d173b3535e7' id='5e731a596fbc2d173b3535e7'>
<a href='#5e731a596fbc2d173b3535e7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1584601689000' class='quanto-date posted-at response-posted-at' href='#5e731a596fbc2d173b3535e7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Zenothestoic  </p>

<blockquote>
<blockquote>
<p>All calculations are done on the previous night&#39;s close.<br>
Are you sure?</p>
</blockquote>
</blockquote>

<p>I see in your code the following:<br>
...
spy_ma50 = data.history(context.spy , &quot;close&quot;, 50, &quot;1d&quot;).mean()<br>
...</p>

<p>Have you ever tried to put this code in the before_trading_start(context, data) and see if there is difference?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e734554ae673f003d93e6f4' id='5e734554ae673f003d93e6f4'>
<a href='#5e734554ae673f003d93e6f4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1584612692000' class='quanto-date posted-at response-posted-at' href='#5e734554ae673f003d93e6f4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thomas Chang</p>

<p>There are probably greater problems to worry about.  In particular those raised by Cyril Bosch. Back testing is not the greatest tool for forward looking prediction.</p>

<p>I don&#39;t think there is any way around this.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e734bf3b6740d00414de219' id='5e734bf3b6740d00414de219'>
<a href='#5e734bf3b6740d00414de219'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e6f8e3f8963b3003cde7689'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/51a922e4fca03a06d67d1d0c6a970b61?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e6f8e3f8963b3003cde7689'>Cyril Bosch</a>
</div>
<a UTCms='1584614387000' class='quanto-date posted-at response-posted-at' href='#5e734bf3b6740d00414de219'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Zeno</p>

<p>I agree. Quality companies that have a sustainable competitve edge, pricing power, strong free cash flow and sensible management will perform well over the medium to long term. </p>

<p>I have to clarify my view on backtesting. I&#39;m an avid believer in a robustly backtested, systematic investment approach. I do believe however that computer scientists with little/no actual domain knowledge might be easily fooled by spurious correlations and build strategies that overfit to sample data and does not generalise well in the real world. Building an algorithm that beats the market consitently (after ALL real world costs and frictions) is a problem far more difficult than Level V autonomous driving! An unlevered IR of 1 is the holy grail. The best I&#39;ve ever achieved (1990-2020, rolling 3yr, <strong>unlevered</strong>) is around 0.8.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e73599168dc260047157c29' id='5e73599168dc260047157c29'>
<a href='#5e73599168dc260047157c29'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1584617873000' class='quanto-date posted-at response-posted-at' href='#5e73599168dc260047157c29'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Cyril Bosch</p>

<p>I guess I have been back testing for nigh on 20 years and frankly it has lead me astray. Many times. I totally agree on autonomous driving - the markets are far less &quot;bounded&quot;.</p>

<p>However I do agree on systematic investing. Which is why stock indices are so attractive. But of course even there they are not predictive. So long as economies thrive, so will stock markets and to a lesser extent commodities.</p>

<p>However the current crisis is a stark reminder that although the world has come through many crises pretty well over the period of the enlightenment there is no guarantee that that will continue.</p>

<p>I think all of this brings me back to the very same rather dull conclusion: the only systematic approach which has any validity in the very long term is wide diversification and regular re-balancing. Globally and over asset classes.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e9d340ef4da6b0ad2eef59d' id='5e9d340ef4da6b0ad2eef59d'>
<a href='#5e9d340ef4da6b0ad2eef59d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e977d2917b03726e9782a67'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7a40632c59a524ebfbc462ce4cc7cabf?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e977d2917b03726e9782a67'>Austin Spencer</a>
</div>
<a UTCms='1587360782000' class='quanto-date posted-at response-posted-at' href='#5e9d340ef4da6b0ad2eef59d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Marc @Vladimir</p>

<p>Hey guys, thanks for your input and thanks @Chris for the original post. I took what you guys had and added some tweaks. I used TMF which is a 3x leverage bond ETF as the safety asset. I also added a stop loss and a trailing stop loss to try to limit downside risk while also maximizing profits. I am happy with the results and would like to try paper trading with it. I&#39;m relatively new here but I have found that, unfortunately, we can&#39;t paper trade through Quantopian. So I was looking around and thought that pylivetrader would work well. However, I hit a roadblock when realizing that Optimize API is not currently supported by pylivetrader. I was trying to re-code to get around using the Optimize API but was having trouble. I&#39;m unsure if there is a live trading platform that supports Optimize API or if Optimize is only something within Quantopian. Any help would be much appreciated! Thanks in advance!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e9ef2b33eb41e5a1f0c5fe4' id='5e9ef2b33eb41e5a1f0c5fe4'>
<a href='#5e9ef2b33eb41e5a1f0c5fe4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57a5e05aaf3a4c589d0009ab'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7bdda3882c7b4b607ca34ae9a4029810?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57a5e05aaf3a4c589d0009ab'>Peter Harrington</a>
</div>
<a UTCms='1587475123000' class='quanto-date posted-at response-posted-at' href='#5e9ef2b33eb41e5a1f0c5fe4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Austin<br>
You don&#39;t need the optimize api for what you are doing.<br>
Simply replace lines 157-162 with this:  </p>

<pre><code>    for sec in total_weights.index:  
        order_target_percent(sec, total_weights.loc[sec])  
    for sec in context.portfolio.positions:  
        if sec not in total_weights:  
            order_target_percent(sec, 0)  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ea08437876b3d0043df2b75' id='5ea08437876b3d0043df2b75'>
<a href='#5ea08437876b3d0043df2b75'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1587577911000' class='quanto-date posted-at response-posted-at' href='#5ea08437876b3d0043df2b75'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I am astonished that anybody could refer to a triple leveraged 20 year bond as a refuge asset. In the early 1980s Fed Chairman Volker raised interest rates sharply over a 6 month period. The long bond lost 40% of its valuem. Go figure, as they say.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ea08780b0b495003fb5993d' id='5ea08780b0b495003fb5993d'>
<a href='#5ea08780b0b495003fb5993d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5804841ed11a8ac44b0005b4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2c330d252d5fb3c0bc0109a5919d2ff4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5804841ed11a8ac44b0005b4'>Marc</a>
</div>
<a UTCms='1587578752000' class='quanto-date posted-at response-posted-at' href='#5ea08780b0b495003fb5993d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Zenothestoic when I saw the approach, negative skew and the LTCM came to my mind...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ea0a586876b3d0041df331f' id='5ea0a586876b3d0041df331f'>
<a href='#5ea0a586876b3d0041df331f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb816f8ea8fd107889dc076'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/c578286c942e9deeb5148b30a9d75cdc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb816f8ea8fd107889dc076'>Simone Pantaleoni</a>
</div>
<a UTCms='1587586438000' class='quanto-date posted-at response-posted-at' href='#5ea0a586876b3d0041df331f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Zenothestoic Well pointed out! Didn&#39;t see the safe asset was changed with the leveraged TMF etf. I would honestly like to re-elaborate this one adding some volatility based logic for asset switch and a not leveraged safe asset.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ea15c5fb0b4957679b597d5' id='5ea15c5fb0b4957679b597d5'>
<a href='#5ea15c5fb0b4957679b597d5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1587633247000' class='quanto-date posted-at response-posted-at' href='#5ea15c5fb0b4957679b597d5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Incidentally, with my son on lockdown with us, we have been talking much about high debt to equity. Me in relation to this model and the &quot;hidden&quot; leverage it supplies, my son in relation to the private equity sector. My accidental discovery here (thanks to one of the participants sorting the debt equity ratio in the wrong direction) is that investing in the highest debt to equity ratios means that you are investing in highly leveraged companies which will or rather can produce outsized returns.  </p>

<p>If that leverage is used well - bingo, you will get great performance. It provides the investor with a leveraged return on a non recourse basis. In other words the investor is not taking the risk of margin finance and thus can not lose more than his invested capital.</p>

<p>My son works in M&amp;A and apparently this technique is usually used by Private Equity firms to boost the return on their equity. They take a small but controlling equity stake in a company but finance the leveraged buy out mostly by debt, Usually preference shares on which they get a hefty rate of return.</p>

<p>Typically returns on PE are 20 to 30% and much of this is achieved by the leveraged effect on their relatively small equity participation.</p>

<p>There is definitely a place for leverage but it must be done in an intelligent fashion and based on a real understanding of the fundamental realities behind markets and economy. </p>

<p>It is naive in the extreme to rely on back testing alone - especially since the data available through Quantopian and the ETF market does not cover all market situations. 1980, 1929 to 1933 for instance.</p>

<p>Incidentally, the high debt equity model I put together and intended to trade is holding up reasonably well so far.   I&#39;m glad I did not start trading it before the downturn but I still intend to trade it in moderation if I can find the right platform to automate it on.</p>

<p>In the meantime I am whiling away my days investigating Tim Sykes and Penny Stocks.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ea8fa2e72602800430a32cc' id='5ea8fa2e72602800430a32cc'>
<a href='#5ea8fa2e72602800430a32cc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ea731e139f49f2be4b3469b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/88eeaccdc8cf823c9641304089d6f763?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ea731e139f49f2be4b3469b'>Zachary Mansi</a>
</div>
<a UTCms='1588132398000' class='quanto-date posted-at response-posted-at' href='#5ea8fa2e72602800430a32cc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Just a thought...<br>
Would pulling historical ROE and linear regressing the data give us a new metric of how well an asset is improving its financial performance? This additional layer could be used as a long term exit strategy.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ea9d1b611207900413b06dd' id='5ea9d1b611207900413b06dd'>
<a href='#5ea9d1b611207900413b06dd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e3b3acaf92d8b0041b3ef12'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/baddff56ae48aee3f9e61a179c3e9ea5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e3b3acaf92d8b0041b3ef12'>Mike Belliveau</a>
</div>
<a UTCms='1588187574000' class='quanto-date posted-at response-posted-at' href='#5ea9d1b611207900413b06dd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I applied the ROE idea to a mean reversion strategy. It screens for stocks that have a sudden drop from long term moving average (200 days). Its then buys the stock with the best ROE from the screened list of stocks. Each stock is held for a week. </p>

<p>It is quite successful at identifying stocks primed for a dead cat bounce. Draw downs are less than impressive but clearly it&#39;s picking more winners than losers. Could very much benefit from a stop loss order but I don&#39;t have much experience with those type of orders.</p>

<p>I would like to find a way to buy a stock every day and hold for a week. Can portfolio.postitions tell you how long you have been holding your stock? Either that or i copy and paste this code 5 times to trade each day of the week.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eab5ee6ec691c004028d39c' id='5eab5ee6ec691c004028d39c'>
<a href='#5eab5ee6ec691c004028d39c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ea731e139f49f2be4b3469b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/88eeaccdc8cf823c9641304089d6f763?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ea731e139f49f2be4b3469b'>Zachary Mansi</a>
</div>
<a UTCms='1588289254000' class='quanto-date posted-at response-posted-at' href='#5eab5ee6ec691c004028d39c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Wow interesting metrics. idk if portfolio.positions keeps track of duration, but u can add a dictionary to keep track of it. Probably easier to work with than copying the code multiple times.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eb1980b0fcfb9003c569bdd' id='5eb1980b0fcfb9003c569bdd'>
<a href='#5eb1980b0fcfb9003c569bdd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e3b3acaf92d8b0041b3ef12'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/baddff56ae48aee3f9e61a179c3e9ea5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e3b3acaf92d8b0041b3ef12'>Mike Belliveau</a>
</div>
<a UTCms='1588697099000' class='quanto-date posted-at response-posted-at' href='#5eb1980b0fcfb9003c569bdd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>This is completely separate form the strategy I just posted.</p>

<p>This is a clone of the initial strategy posted except I replaced the bond module with my VIX hedging module and the returns are absurd. </p>

<p>Can anyone tell me if the VIX strategy is realistic? I don&#39;t think there is a way to get a straight short sell on TVIX or UVXY IRL (TD says the market is illiquid).</p>

<p>I&#39;m currently trying to implement the strategy on my live fund but I cant find an effective way to short the VIX. </p>

<p>Hit me up with any suggestions.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eb1a4b834272d004248e403' id='5eb1a4b834272d004248e403'>
<a href='#5eb1a4b834272d004248e403'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e3b3acaf92d8b0041b3ef12'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/baddff56ae48aee3f9e61a179c3e9ea5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e3b3acaf92d8b0041b3ef12'>Mike Belliveau</a>
</div>
<a UTCms='1588700344000' class='quanto-date posted-at response-posted-at' href='#5eb1a4b834272d004248e403'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>My apologies, I didnt realize my previous post used 2x leverage. </p>

<p>Here is the back test and code that fixed leverage to 1  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eb1bbe0a0f5a400466657d4' id='5eb1bbe0a0f5a400466657d4'>
<a href='#5eb1bbe0a0f5a400466657d4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1588706272000' class='quanto-date posted-at response-posted-at' href='#5eb1bbe0a0f5a400466657d4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>You could short the VIX future instead. I don’t think it’s possible to simulate this on Q though (they also stopped sporting futures end of 2017 I believe). I’d be super careful with it as well, and only paper trade to start with at least.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eb1c3b99d3a810041b224b9' id='5eb1c3b99d3a810041b224b9'>
<a href='#5eb1c3b99d3a810041b224b9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e0b9fa71e6b470dbb9d6f72'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f171076ca5ff12a5022f9a00d4cebb33?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e0b9fa71e6b470dbb9d6f72'>Kristof Friedrich</a>
</div>
<a UTCms='1588708281000' class='quanto-date posted-at response-posted-at' href='#5eb1c3b99d3a810041b224b9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Although certainly not ideal, I would recommend using a selection of  short-Vix ETF&#39;s or ETN&#39;s.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eb1cd1734272d004148e57b' id='5eb1cd1734272d004148e57b'>
<a href='#5eb1cd1734272d004148e57b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb816f8ea8fd107889dc076'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/c578286c942e9deeb5148b30a9d75cdc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb816f8ea8fd107889dc076'>Simone Pantaleoni</a>
</div>
<a UTCms='1588710679000' class='quanto-date posted-at response-posted-at' href='#5eb1cd1734272d004148e57b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Mike Belliveau: That strategy is exactly what I meant with my comment above! I was implementing it using (as Kristof said) vix ETFs  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eb1cfc6a0f5a4004666588c' id='5eb1cfc6a0f5a4004666588c'>
<a href='#5eb1cfc6a0f5a4004666588c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1588711366000' class='quanto-date posted-at response-posted-at' href='#5eb1cfc6a0f5a4004666588c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Mike, note that in your first iteration (with 2x leverage), TVIX all by itself represented 97.79% of all generated profits. That is almost like playing on a single position even if the strategy traded 408 different stocks which accounted for the remaining 2.21% of total profits.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eb2c1822554ff0045581059' id='5eb2c1822554ff0045581059'>
<a href='#5eb2c1822554ff0045581059'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1588773250000' class='quanto-date posted-at response-posted-at' href='#5eb2c1822554ff0045581059'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The RETURN is somewhat &#39;shaky&#39;. If you change the stock number to 5 or to 15, 20, the RETURN will very quite a lot. And the leverage will increase to 2.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eb33fc2fccf82003e2cd84d' id='5eb33fc2fccf82003e2cd84d'>
<a href='#5eb33fc2fccf82003e2cd84d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e3b3acaf92d8b0041b3ef12'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/baddff56ae48aee3f9e61a179c3e9ea5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e3b3acaf92d8b0041b3ef12'>Mike Belliveau</a>
</div>
<a UTCms='1588805570000' class='quanto-date posted-at response-posted-at' href='#5eb33fc2fccf82003e2cd84d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thank you all for the feedback !</p>

<p>@Joakim @Kristof I have come to accept that futures and inverse ETF&#39;s are looking like my two only options. I have run backtests using ZIV and SVXY but results were poor. The next most inversely correlated ETF to the VIX is TQQQ which I been using as the  hedge security for my live trading(I&#39;ll attach the pure TQQQ/VIX backtest). I&#39;m adverse to VIX futures because once VIX spikes and its time to short it, there is so much implied volatility the high premiums make it not worth the risk. I have have previously lost a lot of money experimenting with short term VIX options and capital restraints prevent me from purchasing longer term contracts, again due to the high implied volatility. </p>

<p>@ Simone It really makes sense. I had the VIX strategy in my pocket and hadn&#39;t considered tacking it onto another strategy until i saw the ETF back test from Austin. </p>

<p>@Guy  Essentially the strategy functions as a tail risk hedge. Although the VIX strategy generated 97% of the profits, it accounts for for less than 1/3 the leverage. The VIX strategy on its own is extremely volatile but has significant jumps (up 1000% due to Corona sell off). Allocating a the majority of leverage to a solid base strategy such as Quality companies in an uptrend allows you to limit the draw-downs from the VIX strategy while also priming the portfolio to spike in the case of a sell off. </p>

<p>@Thomas Of course the degree of diversification will have a major impact on returns. My initial mean reversion post only bought 2 stocks and held them for a week(now that&#39;s &#39;shaky&#39;). The less stocks you hold, the more risk, the more reward. 10 seems like a reasonable # of stocks to hold for the base strategy. The reason leverage increases is due to the code in the initial strategy posted. There are two variables you need to change if you wish to change the # of stocks you hold, other wise the leverage will be multiplied by a factor of however many fewer stocks you use from 20.<br>
These are the two variables to change in order to adjust # of stocks to hold without affecting leverage.<br>
    context.Target_securities_to_buy = 10.0<br>
    context.top_n_relative_momentum_to_buy = 10  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eb39b556c1b050e9694155f' id='5eb39b556c1b050e9694155f'>
<a href='#5eb39b556c1b050e9694155f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e3b3acaf92d8b0041b3ef12'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/baddff56ae48aee3f9e61a179c3e9ea5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e3b3acaf92d8b0041b3ef12'>Mike Belliveau</a>
</div>
<a UTCms='1588829013000' class='quanto-date posted-at response-posted-at' href='#5eb39b556c1b050e9694155f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I apologize for taking this of course from the initial strategy, but in the spirit of developing composite strategies, I&#39;ve meshed together the  mean reversion from my initial post and the VIX hedging strategy.</p>

<p>This will be the last back test I post for a while as I don&#39;t think the returns can get much better without &gt;1 leverage. Shout out to Connors Research for the amazing initial strategy. I learned much from it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eb41374fccf82761d2cd8b3' id='5eb41374fccf82761d2cd8b3'>
<a href='#5eb41374fccf82761d2cd8b3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1588859764000' class='quanto-date posted-at response-posted-at' href='#5eb41374fccf82761d2cd8b3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Mike, you must have done the following test!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eb5d94363f5dc029871b35c' id='5eb5d94363f5dc029871b35c'>
<a href='#5eb5d94363f5dc029871b35c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e3b3acaf92d8b0041b3ef12'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/baddff56ae48aee3f9e61a179c3e9ea5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e3b3acaf92d8b0041b3ef12'>Mike Belliveau</a>
</div>
<a UTCms='1588975939000' class='quanto-date posted-at response-posted-at' href='#5eb5d94363f5dc029871b35c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy This is the best I can do in making the VIX strategy work without shorting the VIX(Long TQQQ instead). I have not found a way to prevent that October drawdown but I&#39;m pretty sure it&#39;s the date that TVIX first started trading (twas extremely volatile early on) . Lowering the long tvix portfolio weight to .5 will make it back test better. </p>

<p>This strategy works best when set up as a tail-risk hedge for a more consistent strategy like Quality Companies in an Uptrend. The TQQQ non-VIX-shorting version can be implemented live but I&#39;m currently re-evaluating its implementation. I&#39;m going to learn more about VIX futures since it is clear the strategy is only effective when you can short the VIX. If anyone can suggest of any other assets that inversely correlates to VIX that could be helpful. Does anyone have experience with buying UVXY puts? If so, please reach out! (extremely helpful)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eb5dc50f2202b02be60c175' id='5eb5dc50f2202b02be60c175'>
<a href='#5eb5dc50f2202b02be60c175'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5eae97a88dc9021d90a14a4a'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/db98ad0a9b280283cea2fab63c877cc5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5eae97a88dc9021d90a14a4a'>Vadim Tkachenko</a>
</div>
<a UTCms='1588976720000' class='quanto-date posted-at response-posted-at' href='#5eb5dc50f2202b02be60c175'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is the video where the author talks about UVXY<br>
<a href="https://www.youtube.com/watch?v=H4AUJj9WsVQ&list=PLrnSgovOmBKZkn02B2J7tpta_jUxehSPs&index=39&t=0s" rel="nofollow">https://www.youtube.com/watch?v=H4AUJj9WsVQ&amp;list=PLrnSgovOmBKZkn02B2J7tpta_jUxehSPs&amp;index=39&amp;t=0s</a><br>
He uses EMA to timing UVXY from what I understand.</p>

<p>If to use options, I think the best way to short VIX is to buy VIX CALL options, but I am not sure if there is data available to backtest it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eb5df5d63f5dc018b71ba7a' id='5eb5df5d63f5dc018b71ba7a'>
<a href='#5eb5df5d63f5dc018b71ba7a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e3b3acaf92d8b0041b3ef12'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/baddff56ae48aee3f9e61a179c3e9ea5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e3b3acaf92d8b0041b3ef12'>Mike Belliveau</a>
</div>
<a UTCms='1588977501000' class='quanto-date posted-at response-posted-at' href='#5eb5df5d63f5dc018b71ba7a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Vladim Thank you for the video! Did you mean sell VIX CALL options? Doesn&#39;t make since to buy calls when we&#39;re trying to short the asset.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eb5e2378385e6003ffbcac5' id='5eb5e2378385e6003ffbcac5'>
<a href='#5eb5e2378385e6003ffbcac5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5db24b35daf860003e1faf76'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a40f10cb1848f7fae58b0a98e129b238?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5db24b35daf860003e1faf76'>Sudarshan Iyer</a>
</div>
<a UTCms='1588978231000' class='quanto-date posted-at response-posted-at' href='#5eb5e2378385e6003ffbcac5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Does this article line up with what you were trying to say @Vadim? <a href="https://www.investopedia.com/articles/optioninvestor/06/newvix.asp" rel="nofollow">https://www.investopedia.com/articles/optioninvestor/06/newvix.asp</a> Specifically this quote, &quot;Similarly, buying puts (or bear put spreads, or selling bear call spreads) can help a trader capitalize on moves in the other direction.&quot;</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eb5e485a100d604c41c1946' id='5eb5e485a100d604c41c1946'>
<a href='#5eb5e485a100d604c41c1946'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5eae97a88dc9021d90a14a4a'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/db98ad0a9b280283cea2fab63c877cc5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5eae97a88dc9021d90a14a4a'>Vadim Tkachenko</a>
</div>
<a UTCms='1588978821000' class='quanto-date posted-at response-posted-at' href='#5eb5e485a100d604c41c1946'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Mike<br>
Yes, Sorry, if you are trying to short VIX, you need to buy VIX puts, not calls.<br>
Selling naked options is not a very good idea, it can bite you very badly.<br>
I thought you are trying to use VIX as a hedge against SPY or QQQ decline, in this case VIX will raise, and to capitalize on VIX raise you want to buy VIX calls.<br>
The only question is timing. If you can get timing right, it can be very profitable.<br>
Another popular way to hedge is to buy SPY puts, but it is also question when to buy them. When you see that SPY went down, typically puts are very expensive already, and you won&#39;t get a proper return. So again it is the question when it is proper time to buy SPY puts.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eb5ec0463f5dc027471ba6c' id='5eb5ec0463f5dc027471ba6c'>
<a href='#5eb5ec0463f5dc027471ba6c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e3b3acaf92d8b0041b3ef12'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/baddff56ae48aee3f9e61a179c3e9ea5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e3b3acaf92d8b0041b3ef12'>Mike Belliveau</a>
</div>
<a UTCms='1588980740000' class='quanto-date posted-at response-posted-at' href='#5eb5ec0463f5dc027471ba6c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Vladim I am quite confident in the timing of the factors but only if the type of order is a straight short sell on VIX. The beauty of the strategy is that it trades long and short VIX based on recent momentum changes. In bull markets it makes significant gains through shorting the vix. It also preforms well in the case of a sell-off since you will long VIX once recent momentum ticks up (tail-risk hedge scenario ). The VIX is an index just like QQQ and SPY except it is a lot more volatile (and profitable). The 3 and 5 day moving average crossover does a good job at capturing this trend. The only problem is in executing the strategy and finding a way to short VIX without short-selling.</p>

<p>edit: Just realized you were talking about the timing of the options. It is a bit beyond my expertise, but i did find previous success in buying VIX puts ATM two weeks out. The problem is the premiums on VIX options are so expensive I&#39;m in no place to risk that much capital trying to experiment and find out.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eb5ef80a100d604c41c1dd1' id='5eb5ef80a100d604c41c1dd1'>
<a href='#5eb5ef80a100d604c41c1dd1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5eae97a88dc9021d90a14a4a'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/db98ad0a9b280283cea2fab63c877cc5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5eae97a88dc9021d90a14a4a'>Vadim Tkachenko</a>
</div>
<a UTCms='1588981632000' class='quanto-date posted-at response-posted-at' href='#5eb5ef80a100d604c41c1dd1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Mike,</p>

<p>Then to short VIX is really the best way to buy VIX puts or VXX puts.<br>
You also can make a case with buying SVXY or ZIV ETF, but I would be very scary to hold these overnight.<br>
VIX spike like on February 2018 was very bad.<br>
Another popular ETF XIV was eliminated during that time. for example:<br>
<a href="https://www.marketwatch.com/story/xiv-trader-ive-lost-4-million-3-years-of-work-and-other-peoples-money-2018-02-06" rel="nofollow">https://www.marketwatch.com/story/xiv-trader-ive-lost-4-million-3-years-of-work-and-other-peoples-money-2018-02-06</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ec7809ce626cb003ed28c1e' id='5ec7809ce626cb003ed28c1e'>
<a href='#5ec7809ce626cb003ed28c1e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ec69e61a19c7272096a31e6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ac9061184cc7f384bded56674418be90?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ec69e61a19c7272096a31e6'>motxumotxu JJ</a>
</div>
<a UTCms='1590132892000' class='quanto-date posted-at response-posted-at' href='#5ec7809ce626cb003ed28c1e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Good morning all.<br>
Nice thread by the way, nice work.<br>
Just two dumb questions:<br>
-Is it using quarterly, anual or TTM data for fundamentas?<br>
-Is the backtest accurate? I mean, while making the bakctest, fundamental data on f.e. 31/01/2020 it would use the data of 31/12/2019, but if we really were on 31/01/2020 would the data of 31/12/2019 accesible and updated on morningstar? I dont know whats the delay<br>
Regards  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ec7da03e626cb003fd28eff' id='5ec7da03e626cb003fd28eff'>
<a href='#5ec7da03e626cb003fd28eff'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb4fc8571ef9572db85c0af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a8d078cb83e513809bab0e31eabfa4fc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb4fc8571ef9572db85c0af'>Dan Whitnable</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1590155779000' class='quanto-date posted-at response-posted-at' href='#5ec7da03e626cb003fd28eff'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@motxumotxu JJ  Good questions. I&#39;ll try to answer...</p>

<p><em>Is it using quarterly, annual or TTM data for fundamentals?</em>  The Morningstar data is generally based on quarterly data. There are some valuation ratios however, which are TTM. Its best to do a quick check before making any assumptions.  If a number seems 4 times larger than a quarterly figure then it&#39;s TTM. In this case the <code>roe</code> number is quarterly and calculated from net quarterly income / average total common equity.</p>

<p><em>Is the backtest accurate? I mean, while making the backtest, fundamental data on f.e. 31/01/2020 it would use the data of 31/12/2019, but if we really were on 31/01/2020 would the data of 31/12/2019 be accessible and updated on Morningstar?</em>  Quantopian only exposes data to a backtest which would have been known as of each simulated backtest day. So, &quot;would the data of 31/12/2019 be accessible on 31/01/2020&quot;? That depends upon when the company made its quarterly report publicly available. Every Morningstar field has two dates associated with it - the <code>asof_date</code> and the <code>timestamp</code>. The <code>asof_date</code> in this case would be 31/12/2019. However, the <code>timestamp</code> is when Quantopian, and presumably the market, first learned about the data, typically 1 day after the filing date with the SEC. This is the first date that this data will be surfaced in pipeline.  There is more description of this in the documentation (<a href="https://www.quantopian.com/docs/data-reference/morningstar_fundamentals#point-in-time">https://www.quantopian.com/docs/data-reference/morningstar_fundamentals#point-in-time</a>). Therefore, the answer is yes, the backtests are accurate and meant to simulate trades which would have taken place by an individual with information they would have known at the time with no lookahead bias.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5ec7ded3b12d8f0041eb2ccb' id='5ec7ded3b12d8f0041eb2ccb'>
<a href='#5ec7ded3b12d8f0041eb2ccb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ec69e61a19c7272096a31e6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ac9061184cc7f384bded56674418be90?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ec69e61a19c7272096a31e6'>motxumotxu JJ</a>
</div>
<a UTCms='1590157011000' class='quanto-date posted-at response-posted-at' href='#5ec7ded3b12d8f0041eb2ccb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Dan.<br>
Thanks for your answer. Very clear. Ill take a deeper look.<br>
Regards.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ec90a0113826f004121db02' id='5ec90a0113826f004121db02'>
<a href='#5ec90a0113826f004121db02'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1590233601000' class='quanto-date posted-at response-posted-at' href='#5ec90a0113826f004121db02'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>In a sense of course Dan is right but he probably expresses himself in an unfortunate manner: &quot;the answer is yes, the backtests are accurate&quot;.  As regards what he is saying about the timing of releases of fundamental data it is of course important not to back test on any data not available at the relevant point in time.</p>

<p>However the &quot;accuracy&quot; of any back test is a dangerous assumption. Bearing in mind the many, many thousands of lines of code in Zipline and the vagaries and inaccuracies of&quot; historical&quot; data. </p>

<p>The slightest change in data or code can have a beneficial or detrimental cascading effect spreading like a virus through any backtest.  The only true &quot;accuracy&quot; concerning a given strategy comes with trading it forward. Even then changes of code, methods and data will creep in month by month going forward.</p>

<p>Regarding backtests, I have run an identical strategy on both Quantopian and Quantconnect. This strategy here which I posted above. The strategy yields a return of 30,000 % here on Quantopian and a mere 6,000% on Quantconnect.</p>

<p>I challenge anyone to talk about the &quot;accuracy&quot; of back testing given this context. Furthermore as someone who has been backtesting and trading for almost 30 years I can tell you categorically that the future never looks much like the past.</p>

<p>Feel free to take or leave my reflections as you choose. But my advice would be never to use the words &quot;accuracy&quot; and &quot;backtesting&quot; in the same sentence.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ecc2956769cb6789e765d6d' id='5ecc2956769cb6789e765d6d'>
<a href='#5ecc2956769cb6789e765d6d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ec69e61a19c7272096a31e6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ac9061184cc7f384bded56674418be90?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ec69e61a19c7272096a31e6'>motxumotxu JJ</a>
</div>
<a UTCms='1590438230000' class='quanto-date posted-at response-posted-at' href='#5ecc2956769cb6789e765d6d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello all.<br>
I&#39;d add/change some filters.<br>
For the stock selections, i&#39;d filter by sectors that are outperforming SP500 measured by RSCmansfield and only buy stocks that belong to those sectors.<br>
I&#39;d also try to test how the strategy behaves filtering stocks to buy only those that break their 52&#39;s weeks high instead (or in addition) the momentum.<br>
I mean conditions to buy: fundamental filter + sector &quot;power&quot; + 52&#39;s weeks high break + sp500 momentum (+stock momentum?). If sp 500 doesnt match the technical criteria stay in bonds. (no change).<br>
Can anyone code something similar?<br>
Regards.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee20a51380dc30045dd7fa1' id='5ee20a51380dc30045dd7fa1'>
<a href='#5ee20a51380dc30045dd7fa1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58c96573df2ce430c5446b21'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5a248de0f9985e91f426756f9fc70a7d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58c96573df2ce430c5446b21'>ZT YE</a>
</div>
<a UTCms='1591872081000' class='quanto-date posted-at response-posted-at' href='#5ee20a51380dc30045dd7fa1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I find its interesting that if you take out the bonds, the return looks a lot worse.<br>
Bonds plays a huge role in this . Why is that, should we only buy bonds?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee379103ab9ff0042121504' id='5ee379103ab9ff0042121504'>
<a href='#5ee379103ab9ff0042121504'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1591965968000' class='quanto-date posted-at response-posted-at' href='#5ee379103ab9ff0042121504'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>Bonds plays a huge role in this . Why is that, should we only buy bonds?</p>
</blockquote>

<p>My naive understanding is that it&#39;s partially because treasuries are treated as a safe-haven asset. When the stock market smells trouble, people flee to bonds, which drives up their price. The other major reason is that over this entire period we&#39;ve been in a massive &quot;falling rates&quot; environment. When the interest rate falls the value of existing bonds increases so that the fixed value they pay out matches the new rate. Can rates continue to fall forever? Who knows. We&#39;re already pretty close to zero. To me it seems that the same pattern can&#39;t continue forever.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee387e0bb7bbb00448f8fe2' id='5ee387e0bb7bbb00448f8fe2'>
<a href='#5ee387e0bb7bbb00448f8fe2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1591969760000' class='quanto-date posted-at response-posted-at' href='#5ee387e0bb7bbb00448f8fe2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Mr V Hawk is neither wrong nor naive. In times of great uncertainty people run to Sovereign bonds of a safe haven country and at these times stock and bonds often become strongly negatively correlated. </p>

<p>As to rising interest rates, these do not, in my view, present a problem unless the rise is too steep and too swift as in 1980 when the long bond crashed almost 40% after Volker&#39;s series of big rate increases.</p>

<p>Even then, simple mathematical analysis shows that 90% + of bond performance comes from coupon not price. In a rising interest rate environment, a fall in price is overcome over time by increased coupons.</p>

<p>I wish I could post my analysis here but perhaps I will post it on my website and link it.</p>

<p>In any event, even in the case of low to zero interest rates you can still expect sovereign debt to spike up in a crisis. Leading to temporarily negative yield if necessary.</p>

<p>The reason is simple: there is no where else to go.</p>

<p>Rather like when we briefly saw negative front month crude prices  - no storage, no capacity to take delivery.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee3b0fee1ea9130a7278aaf' id='5ee3b0fee1ea9130a7278aaf'>
<a href='#5ee3b0fee1ea9130a7278aaf'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57a240ca3a90ce1776000163'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9c8b1b02a4dc4f6a9da91f3cd44a522c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57a240ca3a90ce1776000163'>ishan kapoor</a>
</div>
<a UTCms='1591980286000' class='quanto-date posted-at response-posted-at' href='#5ee3b0fee1ea9130a7278aaf'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>good gravy!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee405fa4ce1591b53374385' id='5ee405fa4ce1591b53374385'>
<a href='#5ee405fa4ce1591b53374385'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58c96573df2ce430c5446b21'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5a248de0f9985e91f426756f9fc70a7d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58c96573df2ce430c5446b21'>ZT YE</a>
</div>
<a UTCms='1592002042000' class='quanto-date posted-at response-posted-at' href='#5ee405fa4ce1591b53374385'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I am still having a hard time understanding this bond part</p>

<p>def trade_bonds(context , data):<br>
    amount_of_current_positions=0<br>
    if context.portfolio.positions[context.bonds].amount == 0:<br>
        amount_of_current_positions = len(context.portfolio.positions)<br>
    if context.portfolio.positions[context.bonds].amount &gt; 0:<br>
        amount_of_current_positions = len(context.portfolio.positions) - 1<br>
    percent_bonds_to_buy = (context.Target_securities_to_buy - amount_of_current_positions) * (1.0 / context.Target_securities_to_buy)<br>
    order_target_percent(context.bonds , percent_bonds_to_buy)</p>

<p>if I am going to buy 3 stock(context.Target_securities_to_buy), I have 5 in hand, my current position would be 4( amount_of_current_positions-1)<br>
so  3 / 4 * (1/3)= 1/4<br>
How&#39;d this number relate to the stocks we are going to buy?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee62f1271adbb004250b9c9' id='5ee62f1271adbb004250b9c9'>
<a href='#5ee62f1271adbb004250b9c9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d3c56369eca8e31e2d692a3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b07bccab7e1bc10792fc86324865b167?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d3c56369eca8e31e2d692a3'>Steve Jost</a>
</div>
<a UTCms='1592143634000' class='quanto-date posted-at response-posted-at' href='#5ee62f1271adbb004250b9c9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ ZT YE,</p>

<p>Poorly chosen variable names may be contributing to your difficulty understanding the code.</p>

<p>A better name for &#39;amount_of_current_positions&#39; is &#39;number_of_current_stock_positions&#39;.<br>
You find the total number of current positions using len(context.portfolio.positions).<br>
But what you want to know is the number of stock positions.<br>
Keep in mind that context.bonds may be one of those positions. So you need to check for that.<br>
If it is one of your positions, then subtract 1 to get the number of current stock positions.</p>

<p>Another poorly chosen variable name is context.Target_securities_to_buy.<br>
A better name for this would have been context.max_number_of_stocks_to_hold.<br>
The reciprocal of this number gives the weight for new stock purchases.</p>

<p>To calculate open slots take the difference between the max number of stocks that you can hold and the number of stocks that you currently hold.  If you have open slots , but don&#39;t have replacement stocks to fill those open slots (because the market trend is currently negative), then you would fill the open slots with context.bonds. </p>

<p>To calculate the weight that to use for the bond order (order_target_percent), simply multiply the number of open slots by the weight that you would have given to new stock purchases.</p>

<p>Example: max number of stocks to hold = 10, current number of stocks held 6, open stock slots = 4,  target weight of bonds 40%.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee63ae47e79912e4f0c7555' id='5ee63ae47e79912e4f0c7555'>
<a href='#5ee63ae47e79912e4f0c7555'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58c96573df2ce430c5446b21'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5a248de0f9985e91f426756f9fc70a7d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58c96573df2ce430c5446b21'>ZT YE</a>
</div>
<a UTCms='1592146660000' class='quanto-date posted-at response-posted-at' href='#5ee63ae47e79912e4f0c7555'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Steve Jost, many thanks for your explaination<br>
To sum up it looks like this:  </p>

<pre><code>def trade_bonds(context , data):  
      amount_of_current_positions=0     #current number of stock positions  
   if context.portfolio.positions[context.bonds].amount == 0:  
      amount_of_current_positions = len(context.portfolio.positions)  
   if context.portfolio.positions[context.bonds].amount &gt; 0:  
      amount_of_current_positions = len(context.portfolio.positions) - 1      #Calculate the current stock position because when Bond+Stock, it must be over 1.#so we substruct 1 from the total position to get stock position  
      percent_bonds_to_buy = (context.Target_securities_to_buy - amount_of_current_positions) * (1.0 / context.Target_securities_to_buy)  
   #percent_bonds_to_buy  =( Max_stocks_to_hold - Current_stock_positoin)* (1/Max_stock_to_hold),  
  #---- Max we can hold minus current stock position gives the slot for us to buy bonds. divide by max stocks we can hold to  
                                                                   obtain the percentage that we can buy bonds.  
   order_target_percent(context.bonds , percent_bonds_to_buy)  
</code></pre>

<p><em>I am still confused on this part:<br>
amount_of_current_positions = len(context.portfolio.positions) - 1<br>
current_stock_position = len(tota_current_position) - 1, but why minus 1? Stocks can go up to 1, minus one means the left are bonds? confused</em>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee63f32339d06003f62ec86' id='5ee63f32339d06003f62ec86'>
<a href='#5ee63f32339d06003f62ec86'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d3c56369eca8e31e2d692a3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b07bccab7e1bc10792fc86324865b167?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d3c56369eca8e31e2d692a3'>Steve Jost</a>
</div>
<a UTCms='1592147762000' class='quanto-date posted-at response-posted-at' href='#5ee63f32339d06003f62ec86'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ ZT YE,</p>

<p>With that statement you are trying to find the <strong>number</strong> of current stock positions, <strong>not</strong> the percentage.<br>
If you have set context.Target_securities_to_buy =10 (a better name as I mentioned is &#39;context.max_number_of_stocks_to_hold&#39;),<br>
then &#39;current_stock_position&#39; in your equation above can be a maximum of 10.</p>

<p>Variable names can be whatever you choose, but do yourself a favor and pick a name that distills the essence of the thing.<br>
So instead of calling it &#39;current_stock_position&#39;, maybe call it &#39;number_of_currrent_stock_positions&#39;.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee64808260906551510fb7d' id='5ee64808260906551510fb7d'>
<a href='#5ee64808260906551510fb7d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58c96573df2ce430c5446b21'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5a248de0f9985e91f426756f9fc70a7d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58c96573df2ce430c5446b21'>ZT YE</a>
</div>
<a UTCms='1592150024000' class='quanto-date posted-at response-posted-at' href='#5ee64808260906551510fb7d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Steve Jost<br>
If its not percentage, why 1? Why not  minus 2 ?<br>
I mean we could have more than 1 unit of bond?<br>
Say we can hold up to 10 securities, and currently we have 8, what does it mean to minus 1 here? We only have 1 bond?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee651ea7e79912e4f0c7639' id='5ee651ea7e79912e4f0c7639'>
<a href='#5ee651ea7e79912e4f0c7639'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d3c56369eca8e31e2d692a3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b07bccab7e1bc10792fc86324865b167?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d3c56369eca8e31e2d692a3'>Steve Jost</a>
</div>
<a UTCms='1592152554000' class='quanto-date posted-at response-posted-at' href='#5ee651ea7e79912e4f0c7639'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ ZT YE</p>

<p>You are subtracting the number of bond positions.  </p>

<p>The number of bond positions is 1 if you own bonds, regardless of  how many units you own.<br>
For example you could have 30% of you portfolio in bonds but that would still only be 1 position.<br>
If you have 0% in bonds then the number of bond positions is 0.</p>

<p>Are you getting tripped up on len(context.portfolio.positions)?<br>
Not sure what your level of python knowledge is, but context.portfolio.positions is a dictionary with key:value pairs.<br>
The keys are the securities and the values are various attributes that we don&#39;t really care much about at this point.<br>
The len() function counts the number of key:value pairs in the dictionary which is the same as counting the number of keys or securities.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee6613e71adbb419850b691' id='5ee6613e71adbb419850b691'>
<a href='#5ee6613e71adbb419850b691'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1592156478000' class='quanto-date posted-at response-posted-at' href='#5ee6613e71adbb419850b691'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ ZT YE<br>
Try one of my versions<br>
<a href="https://www.quantopian.com/posts/new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1#5df00a7528e5497c7677547b" rel="nofollow">https://www.quantopian.com/posts/new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1#5df00a7528e5497c7677547b</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee672d1339d06343d62ea3b' id='5ee672d1339d06343d62ea3b'>
<a href='#5ee672d1339d06343d62ea3b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58c96573df2ce430c5446b21'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5a248de0f9985e91f426756f9fc70a7d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58c96573df2ce430c5446b21'>ZT YE</a>
</div>
<a UTCms='1592160977000' class='quanto-date posted-at response-posted-at' href='#5ee672d1339d06343d62ea3b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Steve Jost<br>
I think i kinda get it after your explanation. and I ran the code with log.info()</p>

<pre><code>def trade_bonds(context , data):  
    amount_of_current_positions=0  
    log.info(len(context.portfolio.positions))  
    log.info(context.portfolio.positions)  
    if context.portfolio.positions[context.bonds].amount == 0:  
        amount_of_current_positions = len(context.portfolio.positions)  
        log.info(amount_of_current_positions)  
    if context.portfolio.positions[context.bonds].amount &gt; 0:  
        amount_of_current_positions = len(context.portfolio.positions) - 1  
        log.info(amount_of_current_positions)  
    percent_bonds_to_buy = (context.Target_securities_to_buy - amount_of_current_positions) * (1.0 / context.Target_securities_to_buy)  
    log.info(percent_bonds_to_buy)  
    order_target_percent(context.bonds , percent_bonds_to_buy)  
</code></pre>

<pre><code>2005-06-30 20:40 trade_bonds:88 INFO 12  
2005-06-30 20:40 trade_bonds:89 INFO {Equity(23555 [WYE]): Position({&#39;last_sale_date&#39;: Timestamp(&#39;2005-06-30 19:40:00+0000&#39;, tz=&#39;UTC&#39;), &#39;asset&#39;: Equity(23555 [WYE]), &#39;last_sale_price&#39;: 44.45, &#39;cost_basis&#39;: 43.330999999999996, &#39;amount&#39;: 119}), Equity(1406 [CELG]): Position({&#39;last_sale_date&#39;: Timestamp(&#39;2005-06-30 19:40:00+0000&#39;, tz=&#39;UTC&#39;), &#39;asset&#39;: Equity(1406 [CELG]), &#39;last_sale_price&#39;: 40.7, &#39;cost_basis&#39;: 42.031, &#39;amount&#39;: 123}), Equity(26578 [GOOG_L]): Position({&#39;last_sale_date&#39;: Timestamp(&#39;2005-06-30 19:40:00+0000&#39;, tz=&#39;UTC&#39;), &#39;asset&#39;: Equity(26578 [GOOG_L]), &#39;last_sale_price&#39;: 295.40000000000003, &#39;cost_basis&#39;: 274.101, &#39;amount&#39;: 18}), Equity(7677 [TXU]): Position({&#39;last_sale_date&#39;: Timestamp(&#39;2005-06-30 19:40:00+0000&#39;, tz=&#39;UTC&#39;), &#39;asset&#39;: Equity(7677 [TXU]), &#39;last_sale_price&#39;: 83.04, &#39;cost_basis&#39;: 80.421, &#39;amount&#39;: 64}), Equity(24518 [STX]): Position({&#39;last_sale_date&#39;: Timestamp(&#39;2005-06-30 19:40:00+0000&#39;, tz=&#39;UTC&#39;), &#39;asset&#39;: Equity(24518 [STX]), &#39;last_sale_price&#39;: 17.490000000000002, &#39;cost_basis&#39;: 21.121000000000002, &#39;amount&#39;: 245}), Equity...  
2005-06-30 20:40 trade_bonds:92 INFO 12  
2005-06-30 20:40 trade_bonds:97 INFO 0.4  
2005-07-29 20:40 trade_bonds:88 INFO 21  
2005-07-29 20:40 trade_bonds:89 INFO {Equity(67 [ADSK]): Position({&#39;last_sale_date&#39;: Timestamp(&#39;2005-07-29 19:40:00+0000&#39;, tz=&#39;UTC&#39;), &#39;asset&#39;: Equity(67 [ADSK]), &#39;last_sale_price&#39;: 34.122, &#39;cost_basis&#39;: 34.041, &#39;amount&#39;: 160}), Equity(22406 [UPL]): Position({&#39;last_sale_date&#39;: Timestamp(&#39;2005-07-29 19:40:00+0000&#39;, tz=&#39;UTC&#39;), &#39;asset&#39;: Equity(22406 [UPL]), &#39;last_sale_price&#39;: 37.88, &#39;cost_basis&#39;: 37.900999999999996, &#39;amount&#39;: 144}), Equity(22983 [FRO]): Position({&#39;last_sale_date&#39;: Timestamp(&#39;2005-07-29 19:40:00+0000&#39;, tz=&#39;UTC&#39;), &#39;asset&#39;: Equity(22983 [FRO]), &#39;last_sale_price&#39;: 42.37, &#39;cost_basis&#39;: 42.341, &#39;amount&#39;: 128}), Equity(1406 [CELG]): Position({&#39;last_sale_date&#39;: Timestamp(&#39;2005-07-29 19:40:00+0000&#39;, tz=&#39;UTC&#39;), &#39;asset&#39;: Equity(1406 [CELG]), &#39;last_sale_price&#39;: 47.79, &#39;cost_basis&#39;: 42.031, &#39;amount&#39;: 123}), Equity(3660 [HRB]): Position({&#39;last_sale_date&#39;: Timestamp(&#39;2005-07-29 19:40:00+0000&#39;, tz=&#39;UTC&#39;), &#39;asset&#39;: Equity(3660 [HRB]), &#39;last_sale_price&#39;: 57.02, &#39;cost_basis&#39;: 56.931000000000004, &#39;amount&#39;: 95}), Equity(8655 [INTU]): Position({&#39;last_sal...  
2005-07-29 20:40 trade_bonds:95 INFO 20  
2005-07-29 20:40 trade_bonds:97 INFO 0.0

...

2005-10-31 21:40 trade_bonds:88 INFO 21  
2005-10-31 21:40 trade_bonds:89 INFO {Equity(25217 [PKZ]): Position({&#39;last_sale_date&#39;: Timestamp(&#39;2005-10-27 20:00:00+0000&#39;, tz=&#39;UTC&#39;), &#39;asset&#39;: Equity(25217 [PKZ]), &#39;last_sale_price&#39;: 54.92, &#39;cost_basis&#39;: 54.471, &#39;amount&#39;: 107}), Equity(1539 [CI]): Position({&#39;last_sale_date&#39;: Timestamp(&#39;2005-10-31 20:40:00+0000&#39;, tz=&#39;UTC&#39;), &#39;asset&#39;: Equity(1539 [CI]), &#39;last_sale_price&#39;: 116.28, &#39;cost_basis&#39;: 115.26100000000001, &#39;amount&#39;: 48}), Equity(22406 [UPL]): Position({&#39;last_sale_date&#39;: Timestamp(&#39;2005-10-31 20:40:00+0000&#39;, tz=&#39;UTC&#39;), &#39;asset&#39;: Equity(22406 [UPL]), &#39;last_sale_price&#39;: 52.6, &#39;cost_basis&#39;: 37.900999999999996, &#39;amount&#39;: 144}), Equity(24840 [ATI]): Position({&#39;last_sale_date&#39;: Timestamp(&#39;2005-10-31 20:40:00+0000&#39;, tz=&#39;UTC&#39;), &#39;asset&#39;: Equity(24840 [ATI]), &#39;last_sale_price&#39;: 28.55, &#39;cost_basis&#39;: 30.971000000000007, &#39;amount&#39;: 189}), Equity(13197 [FCX]): Position({&#39;last_sale_date&#39;: Timestamp(&#39;2005-10-31 20:40:00+0000&#39;, tz=&#39;UTC&#39;), &#39;asset&#39;: Equity(13197 [FCX]), &#39;last_sale_price&#39;: 49.61, &#39;cost_basis&#39;: 49.581, &#39;amount&#39;: 111}), Equity(7844 [USG]): Positio...  
2005-10-31 21:40 trade_bonds:92 INFO 21  
2005-10-31 21:40 trade_bonds:97 INFO -0.05  
</code></pre>

<p>We have bonds position = 0, Target_securities_to_buy = 20, amount_current _position = 12<br>
so 20-12 / 20 = 0.4 buy 40% bonds</p>

<p>then, we have 21 positions total, amount_of_current_positions = 21- 1 = 20<br>
20-20/20 = 0 buy 0% bonds</p>

<hr>

<p>To sum up: </p>

<p>1 means that we only buy one kind of bond which is  -- context.bonds = sid(23870)<br>
but we may pick different stocks, so the number of stocks could be up to 20 in this code.<br>
if whenever the bonds position &gt; 0,  it means we brought bonds, otherwise its 0.</p>

<p>@Steve Jost, thanks for your explaining. I really appreciate it.<br>
 I am getting started with python not long ago. I was trying to shift from finance background and trying to go further with learning coding into quant trading. Its a headache learning by myself and I am glad that quantopian provide such a great platform with everyone to be forthcoming and helpful with questions. </p>

<p>@Vladimir, I am research into your code. Thanks.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee69ec271adbb6bc350b5a4' id='5ee69ec271adbb6bc350b5a4'>
<a href='#5ee69ec271adbb6bc350b5a4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d3c56369eca8e31e2d692a3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b07bccab7e1bc10792fc86324865b167?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d3c56369eca8e31e2d692a3'>Steve Jost</a>
</div>
<a UTCms='1592172226000' class='quanto-date posted-at response-posted-at' href='#5ee69ec271adbb6bc350b5a4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ ZT YE - Yes, you got it!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eea5609dfd059727ddbdc09' id='5eea5609dfd059727ddbdc09'>
<a href='#5eea5609dfd059727ddbdc09'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e9712b49cba40004890bc76'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/79ef2067cba88c007f14737aa621c172?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e9712b49cba40004890bc76'>Ramon Gonzalez</a>
</div>
<a UTCms='1592415753000' class='quanto-date posted-at response-posted-at' href='#5eea5609dfd059727ddbdc09'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>HI pros,</p>

<p>Just trying to build the pipeline screener for this strategy.</p>

<p>I&#39;m starting in quantopian, could anybody help me how can i code the skip days using Returns() function?.</p>

<p>Im noticed that the way used in this algo is pct_change() but returns() include dividens.</p>

<p>Thanks in advance  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eea5f63dfd0592342dbe1e6' id='5eea5f63dfd0592342dbe1e6'>
<a href='#5eea5f63dfd0592342dbe1e6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d3c56369eca8e31e2d692a3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b07bccab7e1bc10792fc86324865b167?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d3c56369eca8e31e2d692a3'>Steve Jost</a>
</div>
<a UTCms='1592418147000' class='quanto-date posted-at response-posted-at' href='#5eea5f63dfd0592342dbe1e6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Ramon Gonzales,</p>

<p>Assuming your momentum look-back is 126 days and you want to skip the last 10 days?  </p>

<p>Define a return factor with window length of 126-days and another factor with window length of 10-days.<br>
Then subtract the two factors.   </p>

<p>Here&#39;s an example:</p>

<pre><code>    # Factor of momentum with skip days  
    roc_126d = Returns(mask=top_ranked_by_fundamentals,  
                       window_length=126)  
    roc_10d = Returns(mask=top_ranked_by_fundamentals,  
                      window_length=10)  
    momentum = roc_126d - roc_10d  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eea6221dfd0590041dbe461' id='5eea6221dfd0590041dbe461'>
<a href='#5eea6221dfd0590041dbe461'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e9712b49cba40004890bc76'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/79ef2067cba88c007f14737aa621c172?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e9712b49cba40004890bc76'>Ramon Gonzalez</a>
</div>
<a UTCms='1592418849000' class='quanto-date posted-at response-posted-at' href='#5eea6221dfd0590041dbe461'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Easy! thanks!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eede46bee662d35cf494760' id='5eede46bee662d35cf494760'>
<a href='#5eede46bee662d35cf494760'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e7b91337e843b0049d21100'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/01eaae40a0e4ba3392c64771182ebdc3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e7b91337e843b0049d21100'>Theo Smith-Devey</a>
</div>
<a UTCms='1592648811000' class='quanto-date posted-at response-posted-at' href='#5eede46bee662d35cf494760'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey Folks... Here&#39;s a long/short adaptation of this algo.</p>

<p>No momentum factor.<br>
No trend indicator.<br>
20 longs - top quality.<br>
20 shorts -bottom quality.</p>

<p>The edge seems to dissipate within the last 5 years. Any ideas what fundamentals could be added to help distribute the alpha more evenly. What enabled the edge prior to 2015 and is there a fundamental factor explaining the behavioural change in the market post 2015?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eeeb230764f810016aca73b' id='5eeeb230764f810016aca73b'>
<a href='#5eeeb230764f810016aca73b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5edafe6cbd5e1e08f68400e3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/c883ecb2d92dee56b33aa937a45bb25e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5edafe6cbd5e1e08f68400e3'>Mikhail Vnukov</a>
</div>
<a UTCms='1592701488000' class='quanto-date posted-at response-posted-at' href='#5eeeb230764f810016aca73b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Theo,</p>

<p>Without momentum it&#39;s just pure value investment and value overall was abnormally cheap the last 10 years. I don&#39;t believe there is a combination of factors that would give you that edge you are looking for. People just don&#39;t buy cheap and good(-ish) companies these days.</p>

<p>Good news its that&#39;s it&#39;s unlikely to be a shift in a paradigm, but just temporary trend of mis-pricing.</p>

<p>I recommend reading this analysis <a href="https://www.aqr.com/Insights/Perspectives/Is-Systematic-Value-Investing-Dead" rel="nofollow">Is Systematic Value Investing Dead</a> for a better picture </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eef7da94346314bcb636038' id='5eef7da94346314bcb636038'>
<a href='#5eef7da94346314bcb636038'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1592753577000' class='quanto-date posted-at response-posted-at' href='#5eef7da94346314bcb636038'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Mikhail, you say: </p>

<blockquote>
<p>I don&#39;t believe there is a combination of factors that would give you<br>
that edge you are looking for.</p>
</blockquote>

<p>I think there are whole families of strategy solutions that would turn out superior results contradicting that assertion. </p>

<p>I have enhanced the trading strategy used here a lot. Changed the stock selection method to select up to 400 stocks, added a fair amount of code to weight those stocks differently, applied long-term governing equations to the mix, added boosters and amplifiers while modulating the use of leverage, and forced the strategy to seek out more volatile stocks. As protective measure, instead of going to bonds or cash during periods of market turmoil, the strategy went to modulating its shorts as well but to a lesser degree. The bet sizing process followed its payoff matrix equation which I often cite in these forums.</p>

<p>The object of a stock trading strategy is to trade enough and profitably to supply more funds in order to trade even more profitably going forward. Thereby putting your trading strategy on steroids and achieving a higher CAGR than the expected long-term market averages.</p>

<p>So, yes, I do think that anyone can easily do better than what has been shown in this thread.</p>

<p>Take a look at the notebook in the following post which shows the results of the 4th walk-forward simulation of this modified trading strategy. It displays phenomenal numbers, even if I have to say so myself.</p>

<p><a href="https://www.quantopian.com/posts/what-i-have-seen-over-the-past-few-weeks#5ee584dffa40b2003edf555c" rel="nofollow">https://www.quantopian.com/posts/what-i-have-seen-over-the-past-few-weeks#5ee584dffa40b2003edf555c</a> </p>

<p>[Edited]
The attached notebook in the above link does not display any of the charts. See the attached notebook instead.</p>

<p>[Re-edited] 
There must be something wrong for the moment when displaying notebooks. Even the attached notebook shows no charts. Sorry.</p>

<p><strong>[Re-re-edited]     June 22.</strong></p>

<p>The attached notebook does not display any of the charts. So, here is a HTML version of the same. This way you should at least see the charts.</p>

<p><a href="https://alphapowertrading.com/quantopian/Ranked_Selection_NB-4.html" rel="nofollow">https://alphapowertrading.com/quantopian/Ranked_Selection_NB-4.html</a></p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5eef925e9945786278c843a4' id='5eef925e9945786278c843a4'>
<a href='#5eef925e9945786278c843a4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5edafe6cbd5e1e08f68400e3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/c883ecb2d92dee56b33aa937a45bb25e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5edafe6cbd5e1e08f68400e3'>Mikhail Vnukov</a>
</div>
<a UTCms='1592758878000' class='quanto-date posted-at response-posted-at' href='#5eef925e9945786278c843a4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy</p>

<p>Absolutely, there are ton of things you can use in your strategy and do vastly better than market. I was answering to Theo, who removed everything but value factors and questioned why they don&#39;t perform well.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ef0d649bcaa8f77778c1f7f' id='5ef0d649bcaa8f77778c1f7f'>
<a href='#5ef0d649bcaa8f77778c1f7f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1592841801000' class='quanto-date posted-at response-posted-at' href='#5ef0d649bcaa8f77778c1f7f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Tony Morland </p>

<p>Just a question regarding the technique of the Markov chains as you mentioned it that you were using it.<br>
If you have, let’s say, 50 factors (PE, reduction of shares and so on) how do you determine what factors are up using Markov chains?<br>
Specially how do you finde the hidden elements, which could be volatility, interest rate or what ever?<br>
Can you point to a literature which explains this.<br>
Thanks<br>
Carsten  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ef11ef46f1ce806d7911029' id='5ef11ef46f1ce806d7911029'>
<a href='#5ef11ef46f1ce806d7911029'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1592860404000' class='quanto-date posted-at response-posted-at' href='#5ef11ef46f1ce806d7911029'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>People just don&#39;t buy cheap and good(-ish) companies these days.</p>
</blockquote>

<p>I prefer to view it from the other side. Cheap companies are failing at reinvesting to grow shareholder value these days.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ef555d0b7d63f0012afba6d' id='5ef555d0b7d63f0012afba6d'>
<a href='#5ef555d0b7d63f0012afba6d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de868f1a1a7e063c1bf55bb'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e952c5caf8bae8f830af14f4488b2d52?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de868f1a1a7e063c1bf55bb'>Caramel xbj</a>
</div>
<a UTCms='1593136592000' class='quanto-date posted-at response-posted-at' href='#5ef555d0b7d63f0012afba6d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Vladimir</p>

<blockquote>
<p>The description of the strategy you presented fits my personal investment goal.<br>
Thanks for sharing.<br>
I backtested your original algorithm with line 9 commented. Why cheat myself.<br>
Results metric is good.<br>
When I tried to use order_optimal_portfolio() results got worse.<br>
I checked some positions (Backtest -&gt; Activity -&gt; Positions) and have some questions about your ordering engine:<br>
if TF_filter==False all positions in top_n_by_momentum should be sold or only part of them?<br>
I have seen the number of stock position slowly changing from 20 to 0 during several months in market downtrend.<br>
Why at initial capital 100000<br>
2003-03-31 there was negative cash 68000 that is leverage 1.68<br>
2007-07-31 there was negative cash 50000 ...<br>
In one of Joakim Arvidsson long-only strategy I have seen negative position in bond (-80%) together with 20 stock positions?<br>
May be we need to fix engine first before we start send long-only strategy to the sky?</p>
</blockquote>

<p>While many people on this thread trying to implement this strategy on a real live trading system, I saw your post mentioned you also want to implement this strategy for your personal investment. As probably one of the best coders in this forum, could you please be so kind to share with us what is your approaches/thoughts on implementing this strategy for live trading?</p>

<p>Thank you in advance.</p>

<p>Caramel  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ef5fd4769853c0012c7ceb0' id='5ef5fd4769853c0012c7ceb0'>
<a href='#5ef5fd4769853c0012c7ceb0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1593179463000' class='quanto-date posted-at response-posted-at' href='#5ef5fd4769853c0012c7ceb0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Caramel</p>

<p>Saying <em>&quot;the strategy you presented fits my personal investment goal&quot;</em><br>
I mean going long quality companies with positive momentum in an up trending market<br>
otherwise switching to bonds is my investment approach.<br>
But I never even try to paper trade the strategy.<br>
Zenothestoic was very close to live trading the strategy through Quantconnect.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ef65ffe32abdd0012112e8d' id='5ef65ffe32abdd0012112e8d'>
<a href='#5ef65ffe32abdd0012112e8d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de868f1a1a7e063c1bf55bb'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e952c5caf8bae8f830af14f4488b2d52?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de868f1a1a7e063c1bf55bb'>Caramel xbj</a>
</div>
<a UTCms='1593204734000' class='quanto-date posted-at response-posted-at' href='#5ef65ffe32abdd0012112e8d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Vladimir</p>

<p>Thank you for the clarification.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ef9d3283bda960014b5579e' id='5ef9d3283bda960014b5579e'>
<a href='#5ef9d3283bda960014b5579e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cc023d22890f712cff5fb14'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a08783e0dc0d59a2b46860f0f9081671?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cc023d22890f712cff5fb14'>El Rojito</a>
</div>
<a UTCms='1593430824000' class='quanto-date posted-at response-posted-at' href='#5ef9d3283bda960014b5579e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Caramel,</p>

<p>I got this up and running in a live environment through the Interactive Brokers API.  I took it on as a covid-19 lockdown exercise.  I decided to switch from paper to liver trading with it a few weeks ago when the SPY SMA crossover indicated we were back to bull.  Maybe that was a bit too early, I&#39;m currently down a little but I don&#39;t have a life changing amount of money running with it, just enough to make it interesting ;).  I&#39;ve decided to run with it as my whole motivation was to trust the algorithm and take the emotion out of trading decisions.  </p>

<p>Some things I learned porting this to IB are below.  Maybe these aren&#39;t exactly what you are looking for as they are implementation details rather than refinements to the algorithm:</p>

<ul>
<li><p>The IB API is completely different.  Porting involves starting from scratch essentially.</p></li>
<li><p>The IB API uses asynchronous calls, I wasted quite a bit of time trying to figure out how to handle this properly.  However, there is an open source set of wrapper classes out there though that make things synchronous and a lot easier.</p></li>
<li><p>The Morningstar data used in Quantopian is expensive in IB, over $14 per month.  Given the amount of money I have involved it didn&#39;t make sense to subscribe to this, especially considering I&#39;d only be using a small portion of what Morningstar give.  IB give access to basic fundamentals through the API, I have had to do some additional calculations to get the same values as Quantopian/Morningstar. I haven&#39;t been able to get ROIC quite right.  I&#39;m hoping the value I have for it is close enough not to make a huge long term difference to the combined quality metric.</p></li>
<li><p>I found instances where Quantopian wasn&#39;t actually using the correct Morningstar data at given points in time, it could be a year or more out of date.  My live trading algo should be &quot;better&quot; but it remains to be seen how much this problem in Quantopian skewed the back testing results.  </p></li>
</ul>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ef9f768267367001728655f' id='5ef9f768267367001728655f'>
<a href='#5ef9f768267367001728655f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de868f1a1a7e063c1bf55bb'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e952c5caf8bae8f830af14f4488b2d52?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de868f1a1a7e063c1bf55bb'>Caramel xbj</a>
</div>
<a UTCms='1593440104000' class='quanto-date posted-at response-posted-at' href='#5ef9f768267367001728655f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@  El Rojito</p>

<p>Thank you for the information. </p>

<p>I think it would be useful to many other people on Q trying to implement this strategy, such as @ Zenothestoic, @seers quant, @Shaun Murphy, @Carsten and, @ Peter Harrington too.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ef9f90183ca6a0011178757' id='5ef9f90183ca6a0011178757'>
<a href='#5ef9f90183ca6a0011178757'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1593440513000' class='quanto-date posted-at response-posted-at' href='#5ef9f90183ca6a0011178757'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ El Rojito</p>

<p>Did you had a look at backtrader?<br>
It has an integration with IB.<br>
From the method it looks quite similar to Quantopian/Zipline, but I never took a closer look how difficult it would be to port a strategy  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5efaf5e2ff09e8001a4d09ae' id='5efaf5e2ff09e8001a4d09ae'>
<a href='#5efaf5e2ff09e8001a4d09ae'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cc023d22890f712cff5fb14'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a08783e0dc0d59a2b46860f0f9081671?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cc023d22890f712cff5fb14'>El Rojito</a>
</div>
<a UTCms='1593505250000' class='quanto-date posted-at response-posted-at' href='#5efaf5e2ff09e8001a4d09ae'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Carsten</p>

<p>I need to revisit backtrader, I had gone all in on the IB API initially and the library I found, ib_insync, is more aligned with that.  Backtrader has some impressive advanced features however that I would like to experiment with now that I am bit more comfortable with live trading.</p>

<p>I don&#39;t want to take this thread too far off topic, it is truely excellent. I am hoping my original post was saved by its discussion of getting Morningstar data in a live env, given it is so integral to the algorithm here on Quantopian.  However, feel free to message me directly though if you wish to discuss further.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5efc6821ff09e8001a4d0ebd' id='5efc6821ff09e8001a4d0ebd'>
<a href='#5efc6821ff09e8001a4d0ebd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56fe6da9329fc61b0e0007d6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8eadc9693f5aadd188d4b2f96f837b3f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56fe6da9329fc61b0e0007d6'>Rajiv Kalwar</a>
</div>
<a UTCms='1593600033000' class='quanto-date posted-at response-posted-at' href='#5efc6821ff09e8001a4d0ebd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Is anyone running this strategy successfully in Live Trading ? if yes please provide some stats around it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5effc058d986d300112826ef' id='5effc058d986d300112826ef'>
<a href='#5effc058d986d300112826ef'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e24e21511a4fb004dd2c7f2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8e79650c201c80ddb5b773df193449ed?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e24e21511a4fb004dd2c7f2'>Luiz Godoy</a>
</div>
<a UTCms='1593819224000' class='quanto-date posted-at response-posted-at' href='#5effc058d986d300112826ef'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>That´s what I really want to know... Live Trading, it seems it´s to be only on backtesting in Quantopian, I tried zipline config but I couldn´t use the Fundamentals to get the roe. Did anybody try to use this strategy using zipline ?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f000c8425f104396bb87db9' id='5f000c8425f104396bb87db9'>
<a href='#5f000c8425f104396bb87db9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5240a6ecbdf6a1bc83000193'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8235b5577851aef505246c1ff3846894?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5240a6ecbdf6a1bc83000193'>Aalap Sharma</a>
</div>
<a UTCms='1593838724000' class='quanto-date posted-at response-posted-at' href='#5f000c8425f104396bb87db9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Completely dumb question may be but I am trying to understand these lines in the past algorithm here</p>

<p>sma_1 = SimpleMovingAverage(inputs=[USEquityPricing.close],window_length=200, mask=universe)<br>
sma_2=SimpleMovingAverage(inputs=[USEquityPricing.close],window_length=2,mask=universe)<br>
sma_change=(sma_2-sma_1)/sma_1 #momentum factor</p>

<p>recent_sma_zscore = sma_change.zscore()    </p>

<p>How are you and why are you calculating a zscore on the sma change?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f00982cd986d32d3f281377' id='5f00982cd986d32d3f281377'>
<a href='#5f00982cd986d32d3f281377'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e24e21511a4fb004dd2c7f2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8e79650c201c80ddb5b773df193449ed?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e24e21511a4fb004dd2c7f2'>Luiz Godoy</a>
</div>
<a UTCms='1593874476000' class='quanto-date posted-at response-posted-at' href='#5f00982cd986d32d3f281377'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I tested the algorithm for the last 2 years (01/01/2018 to 05/31/2020) but the results were not much exciting, we have to find out relevant information about the securities and maybe change from time to time. I believe the behavior of the market change from time to time, some are relevant in a period and some others not in another period.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f060a34d986d33f1b282995' id='5f060a34d986d33f1b282995'>
<a href='#5f060a34d986d33f1b282995'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1594231348000' class='quanto-date posted-at response-posted-at' href='#5f060a34d986d33f1b282995'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Luiz, you say: </p>

<blockquote>
<p>“... but the results were not much exciting …”</p>
</blockquote>

<p>I would tend to disagree with that. You could extract a lot more from the above strategy. However, you might have to change the perception of what is possible and how far you want to go. A two-year simulation is not enough data to show the merits of a trading strategy. Not enough diversity, not enough time to see underlying trends (should you need some), not enough market events to generalize. Portfolio management is a compounded return game and time is a major ingredient in that equation.</p>

<p>The structure of a trading program can predetermine how it will trade as if you were designing some mathematical contraption of what your program might do. This will hold for a prescheduled rebalancing portfolio.</p>

<p>I also disagree with: </p>

<blockquote>
<p>“... I believe the behavior of the market change from time to time<br>
...”</p>
</blockquote>

<p>You design a trading strategy that does not adapt to market data or that is poorly designed and the market is wrong, the market has changed because your model does not fit anymore. How convenient. Is it so hard to accept that what you designed is a poor model and that you need not change the market or see it differently but change the trading strategy instead.</p>

<p>To gain an idea of what could be done, look at the following file:</p>

<p><a href="https://alphapowertrading.com/quantopian/Ranked_Selection_NB-4.html" rel="nofollow">https://alphapowertrading.com/quantopian/Ranked_Selection_NB-4.html</a> </p>

<p>It is the HTML version of its originating notebook. Even though that simulation was the 4th short-term walk-forward, its last two years showed phenomenal results. Way beyond what we usually see on Quantopian and kind of contradicts your statement: “... for the last 2 years ... results were not much exciting...”.</p>

<p>The trading principles used, in the above HTML notebook, include modulated leveraging, shorting in periods of market turmoil instead of just going to cash or bonds among other things. The strategy does take risks, but still manages reasonably well.</p>

<p>Nonetheless, it is always a matter of choice as to how far you want to go. Should you find the strategy beyond your level of risk averseness, then simply scale it down to a more acceptable level. See how the strategy progressed with its added risks in its previous iterations:</p>

<p><a href="https://alphapowertrading.com/quantopian/Ranked_Selection_NB.html" rel="nofollow">https://alphapowertrading.com/quantopian/Ranked_Selection_NB.html</a></p>

<p><a href="https://alphapowertrading.com/quantopian/Ranked_Selection_NB-2.html" rel="nofollow">https://alphapowertrading.com/quantopian/Ranked_Selection_NB-2.html</a>  </p>

<p><a href="https://alphapowertrading.com/quantopian/Ranked_Selection_NB-3.html" rel="nofollow">https://alphapowertrading.com/quantopian/Ranked_Selection_NB-3.html</a>  </p>

<p>What I would say is: If you go for conventional trading methods, you should get what should be expected: conventional results. </p>

<p>However, if your trading strategy does have a positive edge above its leveraging costs, you can compound your performance higher by recycling every penny generated. Simply, it would produce something like this: \(F(t) = F_0 + \$X = F_0 + \Sigma (H ∙ ΔP) = F_0 ∙ (1 + g + \alpha –  exp_t)^t\). If you want to exceed market averages, it would be sufficient to have \( \alpha – exp_t &gt; 0\) which is what the above HTML files show. The higher your alpha, the better. One could also point out: no alpha, no candy.</p>

<p>BTW, I also did the HTML file: <strong>Ranked_Selection_NB-5</strong> which pushes the performance level even higher. But, I am not showing that.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f065d3774916705f5adb59d' id='5f065d3774916705f5adb59d'>
<a href='#5f065d3774916705f5adb59d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e24e21511a4fb004dd2c7f2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8e79650c201c80ddb5b773df193449ed?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e24e21511a4fb004dd2c7f2'>Luiz Godoy</a>
</div>
<a UTCms='1594252599000' class='quanto-date posted-at response-posted-at' href='#5f065d3774916705f5adb59d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Yes, anyway, it´s just a start, I´m learning a lot with these algorithms.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f071df7d986d31b29281e26' id='5f071df7d986d31b29281e26'>
<a href='#5f071df7d986d31b29281e26'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb816f8ea8fd107889dc076'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/c578286c942e9deeb5148b30a9d75cdc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb816f8ea8fd107889dc076'>Simone Pantaleoni</a>
</div>
<a UTCms='1594301943000' class='quanto-date posted-at response-posted-at' href='#5f071df7d986d31b29281e26'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy Fleury: </p>

<blockquote>
<p>You design a trading strategy that does not adapt to market data or that is poorly designed and the market is wrong, the market has changed because your model does not fit anymore. How convenient. It is so hard to accept that what you designed is a poor model and that you need not change the market or see it differently but change the trading strategy instead.</p>
</blockquote>

<p>APPLAUSE! :D</p>

<p>I totally agree with you, and that is one of the main reason why I think technical analysis strategies fail overtime.</p>

<p>By the way, I&#39;ve tested some changes on this algo including some volatility logic and obtained far better returns with lower Drawdown (around 30%) - indeed testing for the last 20years or so.</p>

<p>ps. Guy: I would love to have a chat with you. Any way we can get in touch?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f0732627491671d41adb948' id='5f0732627491671d41adb948'>
<a href='#5f0732627491671d41adb948'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1594307170000' class='quanto-date posted-at response-posted-at' href='#5f0732627491671d41adb948'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Curve fit nonsense, the whole thread. Fools dancing on the deck of the Titanic. Including my own efforts.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f07a070749167060fadbad0' id='5f07a070749167060fadbad0'>
<a href='#5f07a070749167060fadbad0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d918c95bd3bcb004343fc30'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af13508f8b516f22229d4eb5ba19c2e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d918c95bd3bcb004343fc30'>Martin Shkreli</a>
</div>
<a UTCms='1594335344000' class='quanto-date posted-at response-posted-at' href='#5f07a070749167060fadbad0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I tend to agree.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f08ce4911589a2d763f31bd' id='5f08ce4911589a2d763f31bd'>
<a href='#5f08ce4911589a2d763f31bd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1594412617000' class='quanto-date posted-at response-posted-at' href='#5f08ce4911589a2d763f31bd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I stated before that the modifications to this strategy (which more than tripled in size) has made it to trade mainly on market noise (which it also did before). </p>

<p>On such a premise, it almost surely precludes over-fitting in the conventional sense. </p>

<p>For that matter, it would not even make sense mathematically to ascertain any kind of over or under-fitting in such a scenario without providing corroborating evidence of some kind. Something more than just an “opinion” would do. I would accept any academic paper, even on the flimsiest of evidence, demonstrating that trading on market noise will generate alpha and lead to over-fitting on prolonged time intervals. At least, there would be some data making that point.</p>

<p>I could see an exception in the form of some outlier, an extremely lucky streak for instance. But an outlier might not, in all probability, stretch the extent of a 17-year time interval. To statistically over-fit 140,000+ trades over the life of a portfolio would be stretching it really really way beyond realistic expectation probabilities.</p>

<p>The expected value of trading on market noise is very simple to determine, it has been so for centuries. It is zero. </p>

<p>We get: \(F(t) = F_0 + \$X = F_0 + \Sigma (H ∙ ΔP) \to  F_0 \) which implies \(\Sigma (H ∙ ΔP) \to 0 \) meaning that the strategy&#39;s whole payoff matrix, whatever its composition, would tend to zero. Even more so the longer you played the game. </p>

<p>There is no edge there, and understandably, it also means that \(\Sigma (H ∙ ΔP) = n ∙ x_{avg} \to 0 \) where your average net profit per trade tends to zero since n is certainly not zero, nor will it tend to zero. In fact, in trading, n is a monotonic ever increasing function, it only goes up.</p>

<p>Designing a long-term winning trading strategy would uphold the hypothesis that the market is not purely random but does exhibit some secular underlying trend. At least in the historical US market. Designing a long-term trend-following strategy in an upward secular trending market appears as the way to go. And since the market does not go up all the time, you put in some protective measures for periods when the market is identified as declining. Just common sense stuff.</p>

<p>Some think that because they can&#39;t do it, others can&#39;t either. That is very sad and, (I will use a kind word), “shortsighted”. You will always find someone doing better, just as you can easily find people doing worse. Still, overall, you remain the one ultimately making all the decisions and a trading program is just a means to automate those decisions you might think are to your own benefit. You will win some and lose some. That is the promise of trading on quasi-market noise. If you want more than that, you will have to do more. That too is very simple. At least, you will need to do it differently.</p>

<p>I would reiterate what was said in the previous post:</p>

<blockquote>
<p>“If you go for conventional trading methods, you should get what<br>
should be expected: conventional results.“</p>
</blockquote>

<p>It is your trading strategy that has to extract from the market every penny it is going to make. And the market will not make it easy for you. You will have to work for every penny. You will also lose or pay for every “mistake” you make. All you can do is make a bet based on whatever data you have and determine later if it was productive or not. </p>

<p>There is only one person that needs to be convinced of what your trading strategy can do, no other, and that is you. Without that, your strategy is not worth much if you do not even understand or have enough confidence in your own work to know what your strategy really does. But then, everybody has to make those trading choices and live by them.</p>

<p>All my modifications to this strategy deal with the payoff matrix and its equivalent functions. I make the program answer to these equations. Because of the time element, these functions are accepted as dynamic and chaotic. They will change over time the value of their controlling parameters at the market&#39;s whim or your own.</p>

<p>Some confuse over-fitting with leveraging. My version of this program uses leveraging. The amount of leverage used is printed on the equity charts. All 4 HTML files presented saw leveraging hover around 1.5x to 1.6x. </p>

<p>As was said in my last post, if \( \alpha – exp_t &gt; 0\), it can become worthwhile leveraging a portfolio. As long as you cover more than the added leveraging expenses, your trading strategy can increase its overall return. What those 4 HTML files showed is just that: you increase the leveraging slightly, you should get higher returns. Otherwise, why would you ever even consider leveraging your portfolio in the first place?</p>

<p>Those 4 HTML notebooks mostly show that adding leverage to a positive alpha strategy can be a means to achieving higher profits. Evidently, there are added operational costs to it, just like in any other business.</p>

<p>The strategy does not demonstrate over-fitting. But it does show the tremendous impact leveraging can have on the final result. </p>

<p>Leveraging is an administrative decision. It is not your program which out of the blue will decide to use some. It is you coding its use and magnitude based on whatever data you consider relevant to the task. And with a 1.5x to 1.6x average gross leverage, the strategy is not in the over-leveraging business yet. </p>

<p>I do these simulations to answer the questions: How far can this trading strategy go? How much leverage can it take? Do I want to go that far? Can I accept that level of added risks and added expenses? Those questions can only be answered by doing those simulations and should be part of anyone&#39;s battery of tests for any “worthwhile” strategy. Otherwise, how could you ever know a strategy&#39;s full potential, strengths, and weaknesses?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f298f1a6d90260015f008cb' id='5f298f1a6d90260015f008cb'>
<a href='#5f298f1a6d90260015f008cb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1596559130000' class='quanto-date posted-at response-posted-at' href='#5f298f1a6d90260015f008cb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Some might be interested in my last post in the following thread: <a href="https://www.quantopian.com/posts/what-i-have-seen-over-the-past-few-weeks#5f288fd14c72e60015da31c4" rel="nofollow">https://www.quantopian.com/posts/what-i-have-seen-over-the-past-few-weeks#5f288fd14c72e60015da31c4</a> dated Aug. 3rd. It is a continuation of what has been previously presented here and elaborates on the inner workings of this modified trading strategy with yet another walk-forward (its fifth). Hope it can help some.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f3d33930295ec001112d707' id='5f3d33930295ec001112d707'>
<a href='#5f3d33930295ec001112d707'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1597846419000' class='quanto-date posted-at response-posted-at' href='#5f3d33930295ec001112d707'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Managed to put out more explanations surrounding the above-cited strategy in the following post: <a href="https://www.quantopian.com/posts/what-i-have-seen-over-the-past-few-weeks#5f3ab8722471750011004c8a" rel="nofollow">https://www.quantopian.com/posts/what-i-have-seen-over-the-past-few-weeks#5f3ab8722471750011004c8a</a></p>

<p>The post puts the emphasis on the rebalancing portfolio&#39;s payoff matrix equation where we can make a reasonable estimate on the number of trades such a strategy can perform over its entire trading interval. It can even be used to make long-term projections on the expected value of n: \(E[n]\).</p>

<p>The post ends with the notion that the part of the payoff matrix equation that might have the most impact is the trading unit function u(t) which can be of your own design. It can be an expression of what you want to accomplish. Nonetheless, profits will be controlled by \(E[PT]\) which represents the ability to extract a real averaged positive edge from the gyration of price movements. And since \(E[n]\) will tend to be large over the years, one should look for anything that is statistically significant. There are a lot of solutions to the payoff matrix equation. Therefore, your solution can be as good as mine if not better.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f3d5d6dc785b40011a85dd5' id='5f3d5d6dc785b40011a85dd5'>
<a href='#5f3d5d6dc785b40011a85dd5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1597857133000' class='quanto-date posted-at response-posted-at' href='#5f3d5d6dc785b40011a85dd5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I am reminded of Henry II, Plantagenet King of England. He had some good lines.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f50f6def8b31f0016859f51' id='5f50f6def8b31f0016859f51'>
<a href='#5f50f6def8b31f0016859f51'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1599141598000' class='quanto-date posted-at response-posted-at' href='#5f50f6def8b31f0016859f51'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is my latest walk-forward, the 6th of its kind for this strategy. I used the same program version as illustrated in notebook 5 (see <a href="https://alphapowertrading.com/quantopian/Ranked_Selection_NB-5.html" rel="nofollow">https://alphapowertrading.com/quantopian/Ranked_Selection_NB-5.html</a>). I wanted to maintain the leverage at 1.60, just as in notebook 5. That simulation was from 2003-01-02 to 2020-06-11 while the new backtest ran from 2003-01-02 up to 2020-08-31 (total 210 months).</p>

<p>The portfolio metrics came out about the same. We can compare the captured metrics of notebook 8 to notebook 5. A prior version of the table below was published in <a href="https://alphapowertrading.com/index.php/2-uncategorised/379-another-walk-forward" rel="nofollow"><strong>Another Walk-Forward</strong></a>  where results for notebooks 1 to 7 were first presented with some context.</p>

<p>Again, the strategy did not break down. The program continued to answer to the payoff matrix equation as illustrated in prior posts generating more money due mainly to the added time.</p>

<p>Here is the link to notebook 8:</p>

<p><a href="https://alphapowertrading.com/quantopian/Ranked_Selection_NB-8.html" rel="nofollow">https://alphapowertrading.com/quantopian/Ranked_Selection_NB-8.html</a>  </p>

<p>Of note, since leveraging was used, an estimate of the costs incurred was recorded on the equity chart. That amount should be deducted from the final results. As can be observed, leveraging fees did not destroy the strategy, nor did the added time.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f50f95c0d7df00013991323' id='5f50f95c0d7df00013991323'>
<a href='#5f50f95c0d7df00013991323'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cc2ec1ca91fc7791ebca796'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/934f72cca764a131c3c0497e1ee648d5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cc2ec1ca91fc7791ebca796'>James Veitch</a>
</div>
<a UTCms='1599142236000' class='quanto-date posted-at response-posted-at' href='#5f50f95c0d7df00013991323'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Guy. For the love of god, please stop talking. You&#39;ve been told multiple times by members of the community and Quantopian employees that if you&#39;re not sharing code, your contributions are not welcome here.</p>

<p>Can somebody from Quantopian please ban him from talking in the forums or something, he does nothing but share screenshots of backtests he&#39;s created with associated maths that means nothing and just serves to make him feel smart.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f50fa2c3b9dba000f6aa1dd' id='5f50fa2c3b9dba000f6aa1dd'>
<a href='#5f50fa2c3b9dba000f6aa1dd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cc2ec1ca91fc7791ebca796'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/934f72cca764a131c3c0497e1ee648d5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cc2ec1ca91fc7791ebca796'>James Veitch</a>
</div>
<a UTCms='1599142444000' class='quanto-date posted-at response-posted-at' href='#5f50fa2c3b9dba000f6aa1dd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>As Jamie McCorriston and Joakim have now both said</p>

<blockquote>
<p>@Guy Fleury: Multiple participants in this thread have expressed<br>
frustration with the sharing of screenshots instead of attaching a<br>
backtest. Please refrain from sharing screenshots built on top of the<br>
shared work in this thread. You are entitled to keep your work<br>
private, so if you don&#39;t want to share, that&#39;s fine. But please don&#39;t<br>
share screenshots in this thread as it seems the intent of the thread<br>
is to collaborate on improving the algorithm.  </p>
</blockquote>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f5134c9a7c6ad00162f9c65' id='5f5134c9a7c6ad00162f9c65'>
<a href='#5f5134c9a7c6ad00162f9c65'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5da672b2960d8304a98a6e6f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2e9244abdbc390c3bed349092f38c114?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5da672b2960d8304a98a6e6f'>Nadeem Ahmed</a>
</div>
<a UTCms='1599157449000' class='quanto-date posted-at response-posted-at' href='#5f5134c9a7c6ad00162f9c65'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Guy is just a failed trader/investor/mathematician/statistician or whatever he wanna call himself. He is stuck in a loop where he thinks the work he has done years ago is still relevant. All he is doing is trying to put his message at the end of the famous thread so any new visitor will see his message which will drive traffic to his website. thats all he is doing. He do not have any substance whatsoever in his posts. My advise to anyone reading his posts - there is absolutely nothing in it. Save yourself some time and better read the post of people who actually do the real work here.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f5158aa22590f000e1ee9a4' id='5f5158aa22590f000e1ee9a4'>
<a href='#5f5158aa22590f000e1ee9a4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1599166634000' class='quanto-date posted-at response-posted-at' href='#5f5158aa22590f000e1ee9a4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Jamie Veitch!</p>

<p>Congratulations on your position as <a href="https://www.linkedin.com/in/james-veitch-109163172/?originalSubdomain=uk" rel="nofollow">Head of Algorithmic Trading at KCL Asset Management</a>.<br>
I really want to see your real contributions to improve the &quot;Quality Companies in the Uptrend&quot; code,<br>
but not a criticism of Guy R. Fleury <a href="https://www.amazon.com/s?k=%22Guy%20R.%20Fleury%22%20%2b%20books%22&ref=nb_sb_noss" rel="nofollow">the author of 8 books on algorithmic stock trading</a>,<br>
which is not the topic of this thread.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f516e69646fef00179eedf1' id='5f516e69646fef00179eedf1'>
<a href='#5f516e69646fef00179eedf1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1599172201000' class='quanto-date posted-at response-posted-at' href='#5f516e69646fef00179eedf1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@James, every program we design or modify has objectives and constraints. There comes a point where giving away your code is simply ridiculous for the simple reason it has become valuable. And I think that most who do design more valuable programs than average are not always ready or willing to share them freely. What I see on Quantopian are often half-baked programs, but that is an opinion I try not to express when I see those.</p>

<p>I use math as an underlying rationale for my strategies. The math is relatively simple, it has been around for generations. There is nothing new in the math I use. Nonetheless, there appears to be some statistical advantage in the way I use it. My views of markets are more like Mr. Buffett&#39;s than anybody else. The reason is simple there too. If your trading strategy cannot survive over the long-term it is practically worthless.</p>

<p>You might have noticed that all the equations I have used have an equal sign, and that is not some kind of opinion. You should also have noticed that the equations I use have more than one solution. They have been given away freely. My simulations are simply a demonstration of their application in a portfolio setting. In a way validating their use. If the equations were of no value, my trading scripts would fail too.</p>

<p>All that I have presented, using the same Python tools as everybody else, and the same market data as everybody else is that it is possible and doable to do better than just hoping to reach some long-term market average.</p>

<p>Some do not like it that I do not share my programs. I can understand that. I have said many times before, I do not want to be responsible for the person losing money while misusing code I might have “shared”. Why should they not do their own homework as I do to fully understand what is being done? I presented in these forums a dozen different ways of doing it. And there are a lot more.</p>

<p>My article: <a href="https://alphapowertrading.com/index.php/2-uncategorised/357-the-making-of-a-stock-trading-strategy" rel="nofollow">https://alphapowertrading.com/index.php/2-uncategorised/357-the-making-of-a-stock-trading-strategy</a> showed that just the stock selection process could have a very large number of possible outcomes. The case was made there could be more than \(&gt;10^{400}\) possible combinations and that is a huge number. I only presented one of those possible outcomes using a highly modified version of the strategy in this thread. What I see is that anyone could make their own unique version, have similar results or better. It would demonstrate that each person trying to design their own would barely scratch the surface of possibilities and still make outstanding programs. Why should they not design their own strategies with their own understanding of how they view their market data?</p>

<p>When has any hedge fund given away their programs? Ask Jim Simons (Renaissance Technology) for their programs and see what they will answer? Simons achieved a long-term 66% CAGR, 39% net after fees. I am not there yet, but working on it. Or ask Steven Cohen (Point 72) if he would share his firm&#39;s programs? And while you are at it, why not ask for his best programs in order not to lose any time doing what should be your homework.</p>

<p>A trading program is just like a recipe. You make it public, it becomes free with no further claims to its IP. Another simple question: why would anyone pay for it when it is available free on the web? I learned my lesson in the past, it took only hours after sharing a program to see it misused. I am not going to do that again.</p>

<p>So, you have my point of view, everyone should do their homework.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f517a80f8b31f001085a313' id='5f517a80f8b31f001085a313'>
<a href='#5f517a80f8b31f001085a313'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cc2ec1ca91fc7791ebca796'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/934f72cca764a131c3c0497e1ee648d5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cc2ec1ca91fc7791ebca796'>James Veitch</a>
</div>
<a UTCms='1599175296000' class='quanto-date posted-at response-posted-at' href='#5f517a80f8b31f001085a313'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy</p>

<p>I understand your wish to keep your IP a secret, it should be noted that companies such as Point72 and Ren Tech tend not to spend their time spamming forums - which have been developed to encourage collaboration on code - with useless information designed to make themselves feel better about themselves. </p>

<p>They most definitely do not write paragraphs which bury the actual collaboration in between dense essays - on what I&#39;m sure is interesting maths - which makes the collaboration and the following of the post harder on everyone else.</p>

<p>The best way to keep your IP secret and not have it misused is to not publicly talk about its contents. You seem to be wanting to live in the mid-ground where you want the praise that comes along with sharing IP in a public forum, whilst not actually sharing anything. Please do us all a favour and do what Ren Tech and Point72 do. Keep your thoughts behind closed doors.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f51b2bbf8b31f000f85a42b' id='5f51b2bbf8b31f000f85a42b'>
<a href='#5f51b2bbf8b31f000f85a42b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1599189691000' class='quanto-date posted-at response-posted-at' href='#5f51b2bbf8b31f000f85a42b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Jamie, </p>

<p>If you <em>don&#39;t have anything to add to this model</em>  than your latest posts may be considered as<br>
distraction of the topic in the direction of your own verbiage.<br>
Please delete them and don&#39;t do that in future.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f536ee5682f3b00133e2a3e' id='5f536ee5682f3b00133e2a3e'>
<a href='#5f536ee5682f3b00133e2a3e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f2dcd73efd14f001491fd55'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/23ad824da4efaa4d59204e2dac732e7f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f2dcd73efd14f001491fd55'>john tzu</a>
</div>
<a UTCms='1599303397000' class='quanto-date posted-at response-posted-at' href='#5f536ee5682f3b00133e2a3e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Currently working on some drawdown improvements (which are rather serious, but in other editions are less bad) I apologize for the mess of code since I&#39;ve been trying different things, and just wanted some advice on what to further improve. Current editions reduce drawdown to around 30% at the expense of a slightly lower annual return. Some ideas that have worked are making lists to not buy stock immediately, combining IBD buy and sell days with raised stop losses. Looking at slightly different factors during different markets.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f53afb69cb4550016bd6dbe' id='5f53afb69cb4550016bd6dbe'>
<a href='#5f53afb69cb4550016bd6dbe'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1599319990000' class='quanto-date posted-at response-posted-at' href='#5f53afb69cb4550016bd6dbe'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>Guy. For the love of god, please stop talking. You&#39;ve been told multiple times by members of the community and Quantopian employees that if you&#39;re not sharing code, your contributions are not welcome here.  </p>

<p>Can somebody from Quantopian please ban him from talking in the forums or something, he does nothing but share screenshots of backtests he&#39;s created with associated maths that means nothing and just serves to make him feel smart.</p>
</blockquote>

<p>I have always been puzzled by Mr Fleury. Perhaps he is just an algorithm and not a real person at all.  Nobody has ever been able to get through to him on any level. He just talks.....and talks....and talks....To what end is a mystery.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f53cf7f682f3b00103e2c8f' id='5f53cf7f682f3b00103e2c8f'>
<a href='#5f53cf7f682f3b00103e2c8f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1599328127000' class='quanto-date posted-at response-posted-at' href='#5f53cf7f682f3b00103e2c8f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@John</p>

<p>Quite interesting. But the leverage is often near 2. If you can keep the leverage &lt;= 1, could be more true?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f54a5d0c875f9000fc9edd2' id='5f54a5d0c875f9000fc9edd2'>
<a href='#5f54a5d0c875f9000fc9edd2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f2dcd73efd14f001491fd55'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/23ad824da4efaa4d59204e2dac732e7f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f2dcd73efd14f001491fd55'>john tzu</a>
</div>
<a UTCms='1599382992000' class='quanto-date posted-at response-posted-at' href='#5f54a5d0c875f9000fc9edd2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@thomas<br>
You can uncomment the rebalancing part to make it closer to one, but I realized I had a pretty embarrassing typo that explains a lot of the previous difficulty I&#39;d been having in lowering drawdowns. Will have to go through previous backtests and see if fixing this typo improves returns.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f54ccf9c875f9000fc9eedd' id='5f54ccf9c875f9000fc9eedd'>
<a href='#5f54ccf9c875f9000fc9eedd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1599393017000' class='quanto-date posted-at response-posted-at' href='#5f54ccf9c875f9000fc9eedd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@john tzu</p>

<p>The same algo as above with only one line commented </p>

<pre><code>### set_slippage(slippage.FixedSlippage(spread = 0.0)) # why cheat yourself?  
</code></pre>

<p>and added </p>

<pre><code>def before_trading_start(context, data):  
    record(leverage = context.account.leverage, pos_count = len(context.portfolio.positions))  
</code></pre>

<p>to visualize leverage.</p>

<p>Too many unused variables and names.</p>

<p>The performance may be better if you lower initial capital.</p>

<p>Move trading closer to open.</p>

<p>I see the code not controlling the leverage properly.<br>
The best way to fix that execute all orders except stop loss in one place &quot;trade&quot;.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f54ece92a13e5000f927378' id='5f54ece92a13e5000f927378'>
<a href='#5f54ece92a13e5000f927378'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f2dcd73efd14f001491fd55'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/23ad824da4efaa4d59204e2dac732e7f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f2dcd73efd14f001491fd55'>john tzu</a>
</div>
<a UTCms='1599401193000' class='quanto-date posted-at response-posted-at' href='#5f54ece92a13e5000f927378'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@vladimir Yes, I&#39;ve been trialing a lot of different ideas, so I haven&#39;t yet cleaned it up. Performance does significantly improve with lowering of capital, but I suppose since it has high turnover and does entries around the close each day, a better way to deal with slippage would be to use something like what Fleury once mentioned and buy in several batches based on some signal. For higher initial capital, (when accounting for slippage), would require a different method to decide entries.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f5501f907e61d001104bd9d' id='5f5501f907e61d001104bd9d'>
<a href='#5f5501f907e61d001104bd9d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1599406585000' class='quanto-date posted-at response-posted-at' href='#5f5501f907e61d001104bd9d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@John, I second @Vladimir&#39;s observations. Commenting out the no-slippage greatly reduced the strategy&#39;s performance. In fact, the overall total return was reduced by 99%! We can ignore slippage in a backtest, no problem. It can help give us an idea of the built-in alpha. </p>

<p>However, the market will not be so compliant. Also, percent slippage is a small number. And this would imply that most of the return came from not considering it.</p>

<p>I could not make all the tests I wanted since the backtest analysis would not complete (that is in a way frustrating). I wanted the outcome of “
<code>
round_trips=True  
</code>”. Had to reduce the time interval in order to get an idea on the direction of those numbers. But for me, that is counterproductive since my interest is in the long term survival of a trading strategy.</p>

<p>Nonetheless, I would add to @Vladimir&#39;s comments that the strategy is “delicate”. For instance, raising the number of stocks to 50 in order to reduce the bet size and volatility blew the portfolio up. Not by a small measure. Overall return was -3,331% with a drawdown of -1,121%! That is 11.21 times the initial $10M stake. So, there might also be some work to do there. I did not try to raise the number of stocks any higher.</p>

<p>With the no-slippage on, and the small number of stocks, your program version gets to trade millions of shares in the last 30 minutes of the day. A lot of orders get partially filled. That might not be that realistic using market orders. However, in real life, you would be able to spread that volume over a few days or weeks. It would change the way you will have to look at moving prices and fills. First, may I suggest moving your trading decisions to the beginning of the day in order to give more time for trades to fill.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f55c249b3092b00102c202b' id='5f55c249b3092b00102c202b'>
<a href='#5f55c249b3092b00102c202b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f2dcd73efd14f001491fd55'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/23ad824da4efaa4d59204e2dac732e7f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f2dcd73efd14f001491fd55'>john tzu</a>
</div>
<a UTCms='1599455817000' class='quanto-date posted-at response-posted-at' href='#5f55c249b3092b00102c202b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@guy<br>
The slippage problem is somewhat reduced when I use 50 stocks, since as you said, the lot size decreases.<br>
I did not have the same problem you did upon raising stocks to 50, but I think this might be because my code was rather confusing and requires you to change the stop loss function as well since that is affected by the number of stocks sold. I have moved my trading decisions. to the beginning of the day per your suggestion.<br>
Attached is a version that has allowed you to change the two variables context.Top_n_roe_to_buy and context.Target_securities_to_buy to change the top quality stocks and the number to buy, respectively. As would be expected, choosing slightly less quality stocks (by increasing these numbers) decreases returns.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f55c8de682f3b00133e3a09' id='5f55c8de682f3b00133e3a09'>
<a href='#5f55c8de682f3b00133e3a09'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1599457502000' class='quanto-date posted-at response-posted-at' href='#5f55c8de682f3b00133e3a09'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I also find out, when the leverage is controlled &lt;=1, the total return is just about 6000%. But this is more reality. </p>

<p>Higher leverage will create huge total return. Is this the effect of Einstein&#39;s 8th world wonder? :-)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f55d8e6b3092b00152c208f' id='5f55d8e6b3092b00152c208f'>
<a href='#5f55d8e6b3092b00152c208f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f2dcd73efd14f001491fd55'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/23ad824da4efaa4d59204e2dac732e7f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f2dcd73efd14f001491fd55'>john tzu</a>
</div>
<a UTCms='1599461606000' class='quanto-date posted-at response-posted-at' href='#5f55d8e6b3092b00152c208f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Thomas Oh, could you tell me the max drawdown? If drawdowns decreased to say 20% and it still had a 6k% return (about 27% annually), that&#39;s still significant outperformance.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f562d53682f3b00153e3c30' id='5f562d53682f3b00153e3c30'>
<a href='#5f562d53682f3b00153e3c30'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1599483219000' class='quanto-date posted-at response-posted-at' href='#5f562d53682f3b00153e3c30'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>here it is. The drawdown is &lt; 22%, not bad. :-)</p>

<p>I am not sure if I can say this strategy&#39;s annual return is about 27%. One can see there is a huge jump (I call it Donald  Jump or Fed Jump?)) from 2020. Such could happen one time in 100 years.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f56577ab3092b000f2c2308' id='5f56577ab3092b000f2c2308'>
<a href='#5f56577ab3092b000f2c2308'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1599494010000' class='quanto-date posted-at response-posted-at' href='#5f56577ab3092b000f2c2308'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Thomas</p>

<p>One third of the gain coming from this line:</p>

<pre><code> set_slippage(slippage.FixedSlippage(spread = 0.0))   # why cheat yourself?  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f57100aac6b8e00128285b8' id='5f57100aac6b8e00128285b8'>
<a href='#5f57100aac6b8e00128285b8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1599541258000' class='quanto-date posted-at response-posted-at' href='#5f57100aac6b8e00128285b8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Vladimir<br>
You are right. If the slippage is concerned, the total return will be reduced from about 6400% to about 4500%.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f571077682f3b00143e43ab' id='5f571077682f3b00143e43ab'>
<a href='#5f571077682f3b00143e43ab'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1599541367000' class='quanto-date posted-at response-posted-at' href='#5f571077682f3b00143e43ab'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@john tzu<br>
What does the name of the function &#39;dg&#39; mean?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f5a8469f7666d0010d4cf30' id='5f5a8469f7666d0010d4cf30'>
<a href='#5f5a8469f7666d0010d4cf30'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e4eb89905834b004ba2834f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e70ba1e3b74f0731be223f446be8329f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e4eb89905834b004ba2834f'>Blind Squirrel</a>
</div>
<a UTCms='1599767657000' class='quanto-date posted-at response-posted-at' href='#5f5a8469f7666d0010d4cf30'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>ROE can be a poor quality metric. If ROE is poor, there&#39;s a good chance the company&#39;s quality is poor but if it is &quot;good&quot; that doesn&#39;t mean the company&#39;s quality is &quot;good&quot;. The reason is that ROE can be heavily skewed by various accounting issues such as stock repurchases, asset write-offs, and high debt. Stock repurchases lower the amount of equity (the denominator) which can make ROE improve even if earnings are the same as last year. If a company shuts down a plant or decides an acquisition they made is worth less, they will reduce the value on their balance sheet by lowering the value of the asset AND the total equity in the company. That&#39;s hardly an indication of quality but it results in higher ROE. And lastly, higher debt magnifies ROE. A company can only be financed by two types of capital: debt and equity. If the company chooses to issue a ton of debt to finance acquisitions or buy back stock, the total capital of the company will be dominated by debt rather than equity and ROE will increase. It&#39;s more difficult, but if you can divide operating earnings (pre tax) by assets minus cash you&#39;ll get a cleaner number. ROA is a nice metric but it suffers from a similar problem because it includes cash. If I&#39;m comparing two companies in the same industry, I want to know how about the returns they get on their operating assets (factories, offices, etc.) not on their cash balances. Many tech companies have huge piles of cash so it&#39;s really important to adjust for that issue.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f5a9030e704d800107610b0' id='5f5a9030e704d800107610b0'>
<a href='#5f5a9030e704d800107610b0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1599770672000' class='quanto-date posted-at response-posted-at' href='#5f5a9030e704d800107610b0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p><strong>Building Blocks For Your Stock Portfolio</strong></p>

<p>No one seems to be much concerned by the stock selection process used when it has a major role to play over the long term. First, let&#39;s set “long term” as 15 years or more. I would prefer 20-30+ years, but we do not have that much data available.</p>

<p>I will use Dan Whitnable&#39;s version of the initial program as highly representative of the various versions I looked at. I could have used other versions, but I do like Dan&#39;s programming style.</p>

<p><strong>A Trading Strategy</strong></p>

<p>The strategy has a “self-proclaimed” definition for “quality” and “trend”. The trend is up if the SPY 50-day SMA is higher than the 200 SMA. The trend is down otherwise. A simple SMA crossover triggering system used by many of the program versions. Whereas quality was set as the sum of the ranked scores of <em>stable earnings, strong balance sheets (low debt), high profitability, high earnings growth, and high margins</em>. Conditionals were applied to extract stocks from the selected stock universe. The portfolio was then scheduled for periodic rebalancing.</p>

<p>We assume it is all good and do not even question the premises since they all sound logical and reasonable. But, are they really? </p>

<p><strong>Redesigning It</strong></p>

<p>I questioned everything in this strategy, even the stock universe used, to gain a better understanding of its structure and all its nuances. I ended up modifying every important aspect of it: changed premises, initial assumptions, stock selection method, trading logic, goals, and methods of play. Added modulated leveraging with boosters and amplifiers where I thought they should apply as general rule, that they be mostly profitable, even if at times not.</p>

<p>Trading, by its very nature, and due to the high number of executed trades (&gt;100,000), becomes more a statistical undertaking where playing unknown and developing averages tend to dominate the scene. The most important of them is the average net profit per trade \(x_{avg}\). Evidently, you end up with a profit if, and only if, \(x_{avg} &gt; 0\).</p>

<p>I like designing trading scripts and push them beyond their limits (using whatever) in order to scale them back later knowing that they could go further if wanted. All I can do is make a simulation of those trading principles and rationales to see if it would have worked on past data, and maybe from the simulation make estimates of how much such strategies might produce going forward. Like in many other training and/or forecasting endeavors.</p>

<p>Simulations, once done, need the test of time as corroboration going forward. It might take years to show a strategy&#39;s live merit. It is why we do simulations in the first place. We want to know now if the designed contraptions have value.</p>

<p><strong>Understanding Better</strong></p>

<p>Simulations and their variants can provide a better understanding of the trading logic and interactions between all the variables having some impact on a strategy&#39;s outcome. The future will be different, we all know that. But still, a program is code and it will execute its commands. Will the market be the same going forward? Absolutely not, but your program might be the same if not modified along the way!</p>

<p>We are all entitled to trade whichever stock is out there using whatever trading methods we have. Therefore, again, why choose those stocks? Why choose that particular stock universe? Why force that particular selection when there are trillions and trillions of other possibilities? There are even more basic questions to ask.</p>

<p><strong>The Portfolio&#39;s Payoff Matrix</strong></p>

<p>The point I raised using the portfolio&#39;s payoff matrix equation is that there IS an equation for a rebalancing portfolio:</p>

<p>\( F(t) = F_0 + \displaystyle{ E[n ∙ \frac{\Sigma (H ∙ \Delta P)}{n}]} = F_0 + y ∙ rb ∙ j ∙ E[tr] ∙ u(t) ∙ E[PT] \)</p>

<p>What is the average long-term probability that the expected average net profit will help you exceed your long-term objective \(P[E[n] ∙ x_{avg} &gt; z]\)?  And a corollary, how could you improve on z? But first, let&#39;s look at the stock selection process itself.</p>

<p>In the above payoff matrix, \(\Delta P\) is simply the price difference matrix of your selected tradable stock universe. It has for origin the price matrix \(P\) which is the same for everyone. If there is one thing in the payoff matrix that you do not control, it is the price matrix. Either of the following stock universes could have been used: “<em>Q500US, Q1500US, QtradableStocksUS, Q3000US, USEquityPricing</em>”, and each would have provided a different answer to the applied code. </p>

<p><strong>Trade Timing</strong></p>

<p>The timing of most trades and their respective quantities would have been different simply due to the selected universe. The outcome would even change if you changed the starting date by a month, a week, a day, or even by an hour for that matter. As you would increase the size of the stock universe, the ranked set of selected stocks would not be identical at each rebalancing, nor would their actual rankings. Yet, the strategy&#39;s trading logic would be the same. </p>

<p>In my case, it would have taken the 400 highest ranked momentum stocks of the lot to which would be applied my tailored trading unit function, a variant of the multitude of other possibilities. This says that everyone could have a different solution to the problem and win. So, my suggestion would be: design your own and do not make it public. At the very least, do not give away your best solutions. My intent is to help you design your own solution and not to give you mine. Without understanding what you will do and why what level of confidence would you give your trading strategy solution and what would be its real worth?</p>

<p><strong>Rebalancing</strong></p>

<p>In previous notes, I emphasized that we could make an estimate as to the number of trades a rebalancing strategy might make over the years. Its formula was simple: \( E[n] = y ∙ rb ∙ j ∙ E[tr]\), where \(y\) was the number of years the strategy would run, \(rb\) the number of rebalance per year, \(j\) the number of stocks in the portfolio, and \(E[tr]\) the expected turnover rate. The bet sizing function was defined as  \( u(t) = \displaystyle{\frac{F(t)}{j} = \frac{ F_0 + \Sigma (H ∙ \Delta P) }{j} } \) with \(F_0\) the initial capital.</p>

<p>What does it all say? It says that initially, all you have is your initial capital that could be moved around according to the ongoing value of the trading unit function \(u(t)\) and that this function is subject to your ability to generate profits. In fact, generating alpha is totally dependent on your trading strategy <strong>H</strong>. The higher the average net profit per trade, the better since your portfolio is highly dependent on it: \( F(t) = F_0 + y ∙ rb ∙ j ∙ E[tr] ∙ u(t) ∙ E[PT] = F_0 + E[n] ∙ x_{avg}\). </p>

<p>Moreover, by increasing the number of years you manage a portfolio, the higher the expected outcome. You increase the number of stocks in the portfolio and you should expect higher profits, but, this move also decreases the bet size. You increase the number of rebalances, and it should improve on performance, but this would tend to reduce the average percent profit per trade. As if there was always some kind of trade-off to be had. </p>

<p><strong>Seeking Volatility</strong></p>

<p>Nonetheless, here is an interesting observation. In a rebalancing portfolio such as this one, and keeping all other things equal, that you increase the number of stocks to be traded will have little impact since the bet size will be reduced proportionally \( u(t) = \displaystyle{\frac{F(t)}{j} } \). For instance, doubling the number of stocks will half the bet size:  \( F(t) = F_0 + y ∙ rb ∙ (2 ∙ j) ∙ E[tr] ∙ \displaystyle{ \frac{u(t)}{2}} ∙ E[PT] = F_0 + 2 ∙ E[n] ∙ \frac{x_{avg}}{2}\). Nevertheless, the move would tend to reduce the portfolio&#39;s volatility simply due to the smaller bet size.</p>

<p>Also, the quest to reduce volatility at all costs might not be the best route for a trader. Volatility should be sought since<br>
 \( E[PT] = \displaystyle{E[\frac{\Delta_i p_i}{ p_i} ] = E_{avg}[r_i]} \).  This leads to the notion of an average return on the bets made since each bet was initially designed to be the same, a fixed fraction of equity (0.25% ∙ F(t)). Therefore, what should be maximized is: \( {max}\, E_{avg}[r_i]\). </p>

<p>One of the easiest ways of doing this, with little effort, is to give your trades more time in order to give them more time to appreciate. </p>

<p>As Jesse Livermore once said: “It was never my thinking that made the big money for me. It was always my sitting.” Turns out it was pretty good advice since there will be a lot of sitting going forward.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f674d88165996001312d5a2' id='5f674d88165996001312d5a2'>
<a href='#5f674d88165996001312d5a2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cc023d22890f712cff5fb14'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a08783e0dc0d59a2b46860f0f9081671?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cc023d22890f712cff5fb14'>El Rojito</a>
</div>
<a UTCms='1600605576000' class='quanto-date posted-at response-posted-at' href='#5f674d88165996001312d5a2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I have noticed that the fundamental data used  in these algorithms is frequently out of date.  Consider the attached notebook.  This shows that as of the end of May 2020, the long term debt to equity ratio being used for ABBV was dated back to March 2018.</p>

<p>I am not sure if the problem always lies with Quantopian or Morningstar.  I have noticed data is sometimes missing from Morningstars actual website, but it could be possible on other occasions that the correct data is just not available in Quantopian.</p>

<p>It is preferable to filter out outdated data as invariably it is going to skew the results in random ways.  Using only the stocks where recent data is available also ensures the algorithm is more reflective of what would happen in a live trading environment.</p>

<p>Old data can be filtered out  using the BusinessDaysSincePreviousEvent function.  This can be used in code as follows:</p>

<pre><code>from quantopian.pipeline.factors      import SimpleMovingAverage, Returns, BusinessDaysSincePreviousEvent  
# only data from within the last 12 weeks  
OLD_DATA_FILTER = 61  
def make_pipeline():  
    # Base universe set to the Q500US  
    universe = Q500US()  
    m = universe  
    roic_asofd = BusinessDaysSincePreviousEvent(inputs=[Fundamentals.roic_asof_date.latest]) &lt;= OLD_DATA_FILTER  
    ltd_to_eq_asofd = BusinessDaysSincePreviousEvent(inputs=[Fundamentals.long_term_debt_equity_ratio_asof_date.latest]) &lt;= OLD_DATA_FILTER  
    cash_return_asofd = BusinessDaysSincePreviousEvent(inputs=[Fundamentals.cash_return_asof_date.latest]) &lt;= OLD_DATA_FILTER  
    fcf_yield_asofd = BusinessDaysSincePreviousEvent(inputs=[Fundamentals.fcf_yield_asof_date.latest]) &lt;= OLD_DATA_FILTER 

    m &amp;= roic_asofd  
    m &amp;= ltd_to_eq_asofd  
    m &amp;= cash_return_asofd  
    m &amp;= fcf_yield_asofd  
</code></pre>

<p>This has a noticeable affect on the behaviour of the algorithm.  I can only attach one notebook or backtest per post, so I&#39;ll make follow up posts with before and after tests.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f674dd0165996000d12d625' id='5f674dd0165996000d12d625'>
<a href='#5f674dd0165996000d12d625'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cc023d22890f712cff5fb14'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a08783e0dc0d59a2b46860f0f9081671?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cc023d22890f712cff5fb14'>El Rojito</a>
</div>
<a UTCms='1600605648000' class='quanto-date posted-at response-posted-at' href='#5f674dd0165996000d12d625'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>This is the &quot;before&quot; test, using whatever is listed as the &quot;latest&quot; available fundamental data ratios.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f674e0ceaa913000ea64bad' id='5f674e0ceaa913000ea64bad'>
<a href='#5f674e0ceaa913000ea64bad'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cc023d22890f712cff5fb14'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a08783e0dc0d59a2b46860f0f9081671?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cc023d22890f712cff5fb14'>El Rojito</a>
</div>
<a UTCms='1600605708000' class='quanto-date posted-at response-posted-at' href='#5f674e0ceaa913000ea64bad'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>And this is &quot;After&quot;.</p>

<p>I&#39;ve only executed this over the last 5 years here just to demo the effect it has on the outcome.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f68a89e715e42000fb7e2ea' id='5f68a89e715e42000fb7e2ea'>
<a href='#5f68a89e715e42000fb7e2ea'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f11df4da1976f3df081b3f7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/106954932b276e1d0695ef0fd6ae42e0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f11df4da1976f3df081b3f7'>Russell Cox</a>
</div>
<a UTCms='1600694430000' class='quanto-date posted-at response-posted-at' href='#5f68a89e715e42000fb7e2ea'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello,<br>
I am relatively new to Quantopian, so please be patient for novice type questions.<br>
I have read through this long thread and seen there are two themes:<br>
• How to address glitches in the code for leverage and order execution and holdings
• How to increase the performance of the algorithm.
I cannot contribute on the first point. Indeed, I lost my way with regards to the modifications to correct the bugs, so I have worked on a version of the original and 2nd version of the code.<br>
I see performance has been improved by increasing the stock universe or adding several additional combined factors or reducing the number of stocks held.<br>
However, I have seemingly managed this with a much simpler adjustment.<br>
I experimented with PE. Firstly in place of ROE, which reduced returns significantly. Secondly, PE in combination with PE.<br>
Results:<br>
ROE (baseline) - 1521.59 %<br>
PE  - 726.33 %<br>
ROE + PE - 1912.45 %<br>
I do not know how you guys are including the back tests in the posts, but the only change in the code of the original model is:<br>
    roe = Fundamentals.roe.latest.rank(mask=universe)<br>
    pe = Fundamentals.pe_ratio.latest.rank(ascending=False, mask=universe)<br>
    pipe = Pipeline(columns={&#39;roe&#39;: roe+pe},screen=universe)</p>

<p>I have several questions:<br>
• I do not have enough statistics to determine if the return performance is statistically significant or know which report to look at to tell me, are there any pointers here?</p>

<p>• The performance comes with a slight increase in drawdown (-25.21%    vs 24.22%) and Sharpe ratio (0.75 vs 1.05). I do not know how to    analysis these vs the better performance. Could anyone evaluate this    for me? •    I do not understand the reported sharp ratios. There seems    to be an overriding one (-25.21%) as stated here, but also one under    the performance tab, reporting 1.12 (vs 1.17, so seemingly better for    roe+pe) in this case. Why 2 of them and why are they different? •  How    do you include back tests in the posts?</p>

<p>Russell  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f69aa2a3a40420010759e3d' id='5f69aa2a3a40420010759e3d'>
<a href='#5f69aa2a3a40420010759e3d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1600760362000' class='quanto-date posted-at response-posted-at' href='#5f69aa2a3a40420010759e3d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Russell  </p>

<blockquote>
<blockquote>
<p>... I do not know how you guys are including the back tests in the posts, ...</p>
</blockquote>
</blockquote>

<p>Quite simple:<br>
click Attach, choose Backtest, select your algo and the backtest number. That&#39;s it.</p>

<p>Or you could simply paste your code gere. I can do the backtesting and attch it here. After that you can delete your pasted code.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f6a11dac74d88000d100688' id='5f6a11dac74d88000d100688'>
<a href='#5f6a11dac74d88000d100688'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1600786906000' class='quanto-date posted-at response-posted-at' href='#5f6a11dac74d88000d100688'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Some added notions to my previous post where I said I questioned every assumption in the original version of this program even if I used Dan Whitnable&#39;s version as starting point. </p>

<p>One of those assumptions was the fixed and generalized trend declaration which can have a major impact on trade dynamics. </p>

<p>When the program declares the trend as up, it becomes evident what the program should do next. It is relatively simple to declare something that will be seen as a trend up or down for a strategy.</p>

<p>The trading logic and methods used should be consistent with the trend definition used. It is not what the market is necessarily saying, it is us, as strategy designers, making that declaration. It is based on our understanding of the game we want to play or based on the simple assumption that we might need some kind of trend definition, if at all. Whatever is used, our programs will have to live with it, and indirectly, with our parameter choices, our own generalized market structure assumptions, that they be right or wrong.</p>

<p>In this case, an uptrend was originally defined as the SPY&#39;s 50-day SMA being above its 200-day SMA. Nobody seems to have questioned the validity of using that particular SMA crossover trend-following definition. I understand. It is an easy solution and has been around for decades as if part of some market folklore. But, shouldn&#39;t we dig further than that? Shouldn&#39;t we first demonstrate that it is indeed part of the best trend definitions out there?</p>

<p>If you applied, for example, the above trend definition over the last year, (and in many other flat or volatile periods), you might have noticed that its overall timing was not that great. For instance, during the course of the recent pandemic, one could say: <em>it was rather late to the party</em>. And as such, that “trend definition” would have turned out to be quite expensive. The following chart illustrates this point.</p>

<p><img src="https://image-proxy.prd.pub.quantopian.com/7f0165abef76d9806743cac9d853945993438d6c/687474703a2f2f616c706861706f77657274726164696e672e636f6d2f7175616e746f7069616e2f5350595f35305f3230305f534d41736d616c6c2e706e67" />  </p>

<p>The SMA negative crossover. declaring the trend as down, happened after the recovery was already underway and the positive SMA crossover occurred 3.5 months after the low. </p>

<p>The strategy would have lost on the major part of the decline, and then, would have lost again on a big chunk of the recovery. </p>

<p>Early on when modifying this program, I changed the trend definition to something more responsive to price variations. It served the strategy well as time progressed, especially in the subsequent walk-forwards (see from last January&#39;s simulations onward for instance:<br>
<a href="https://alphapowertrading.com/index.php/2-uncategorised/354-financing-your-stock-trading-strategy" rel="nofollow">https://alphapowertrading.com/index.php/2-uncategorised/354-financing-your-stock-trading-strategy</a> ) </p>

<p>This turned out to be a worthwhile move since during the pandemic the portfolio surged upward more than initially expected. As said before, the program was transformed to seek volatility and the pandemic did provide it. The program had no knowledge of what a pandemic was nor did it see it coming. But with a more sensitive trend definition, it handled the added volatility just as it had during the financial crisis. </p>

<p>You define a trend as part of a portfolio&#39;s protective measures. If the uptrend breaks down, the first intent is to get out of harm&#39;s way. In my version of the program, the portfolio went short, according to its own trend definition instead of going to cash or bonds.</p>

<p>Nevertheless, the strategy was still operating mostly on market noise. It is just that there was a lot of noise at times. And being more sensitive to its trend definition, the program easily switched from long to short even if there were more false positives that also had a cost. It turned out quite well as illustrated in the 6 successive walk-forwards presented.</p>

<p>A trend definition dictates what your trading strategy should do while it is defined as up or down. It is a binary choice. If it is ill-defined, not sensitive enough, or suffers from too much lag as in the original program version, your portfolio will <strong>definitely</strong> pay the price. But, as said many times before, it is your choice, you decide what is best for you.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f6a204db0564e0010298bd3' id='5f6a204db0564e0010298bd3'>
<a href='#5f6a204db0564e0010298bd3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f11df4da1976f3df081b3f7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/106954932b276e1d0695ef0fd6ae42e0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f11df4da1976f3df081b3f7'>Russell Cox</a>
</div>
<a UTCms='1600790605000' class='quanto-date posted-at response-posted-at' href='#5f6a204db0564e0010298bd3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks - I have attached the backtest here.<br>
Russell  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f6bbe2bb0564e00142997fc' id='5f6bbe2bb0564e00142997fc'>
<a href='#5f6bbe2bb0564e00142997fc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f11df4da1976f3df081b3f7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/106954932b276e1d0695ef0fd6ae42e0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f11df4da1976f3df081b3f7'>Russell Cox</a>
</div>
<a UTCms='1600896555000' class='quanto-date posted-at response-posted-at' href='#5f6bbe2bb0564e00142997fc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello,<br>
There was discussion back in Nov 19 that orders were placed for stocks that could not be traded and leverage went up as a result. I am not sure if/how that was resolved. Anyway, I seem to have found my own solution using the data.can_trade() function. Example snip for sell side would be<br>
if (data.can_trade(x)==True):<br>
                order_target_percent(x, 0)<br>
            else:<br>
                print(&#39;CANNOT GET OUT OF&#39;,x)<br>
I do not get any system WARN messages in the attached backtest and only see my own messages saying I cannot get out of stock (but I have not placed the order).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f6c0ac9c74d88001310152c' id='5f6c0ac9c74d88001310152c'>
<a href='#5f6c0ac9c74d88001310152c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51d125a71144e60865000044'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b7dd86784deedc047d5ad0fb30378bdd?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51d125a71144e60865000044'>Peter Bakker</a>
</div>
<a UTCms='1600916169000' class='quanto-date posted-at response-posted-at' href='#5f6c0ac9c74d88001310152c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy What do you use as trend definition? As this is the part where this strategy is not so well versed in.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f6f6abdbf82150014eb307e' id='5f6f6abdbf82150014eb307e'>
<a href='#5f6f6abdbf82150014eb307e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1601137341000' class='quanto-date posted-at response-posted-at' href='#5f6f6abdbf82150014eb307e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Peter, my trend definition is rather intricate and weaved into the code. For me, it seems a reasonable solution for what I intend a stock trading strategy to do over the long term. I have been working with the portfolio payoff matrix equation and its ramifications for years. </p>

<p>As you know, I do not give out code. However, I can explain the extensive modifications made to this program and for what purpose. </p>

<p>Technically, it does use a relatively short-term trend definition but within a medium to long-term trend. Some overrides are allowed meaning that other sections of code can change the direction of that loosely defined trend. Therefore, it is not a one size fits all hard-coded definition. It has quite fuzzy boundaries that at times can be triggered even by market noise.</p>

<p>When you put this in context with the amplifiers, boosters, and the use of modulated leveraged, then that “trend” is of major concern, ill-defined or not, since what you apply over it will dominate the trading function. Nonetheless, there is an underlying trend that is considered, but most of it is injected, designer made. It does not come from the data but from the preset objectives as my attempt to control the portfolio&#39;s payoff matrix equation.</p>

<p>This highly relates to my trading unit function u(t) which itself is compounding. This function is injected and made proportional to the number of stocks in the portfolio by design: \(u(t) = \frac{F_0 ∙ (1 + \gamma _{avg})^t}{j}\). Evidently, this “gamma” function is made positive: \(\gamma _{avg} &gt; 0\). It can be under your control which makes it very different from the conventional fixed betting functions we use, especially if it is leverage modulated with those amplifiers and boosters. The strategy can operate with market noise and low-predictability because most of the trend it considers is “fabricated” and correlated to a portfolio&#39;s long-term objectives.</p>

<p>The result is that I am the one injecting an upward trend into the betting system with the use of the gamma function as described. Such a formula has its own built-in feedback control, it is compounding and can increase one&#39;s alpha over the trading interval. A small positive change in this gamma function \(\Delta \gamma _{avg}\) will push performance higher due to its long-term compounding.</p>

<p>For me, all that stays in line with how I consider long-term trading strategies. Over the years, I&#39;ve designed trading strategies that used hard trend definitions, some with fuzzy trend definitions, and some with none at all. At times, I&#39;ve used a few technical indicators to many to none at all. I&#39;ve also used random entries from a low percent to medium to high to totally random. One of my preferred strategies has totally randomly generated entries and exits. They all worked, mainly due to the trend betting injections (their respective gamma functions).</p>

<p>The portfolio payoff matrix equation has gazillions of solutions. It is up to us to pick the ones that satisfy our own way of thinking. No matter how you want to slice the game, you can find a way to make it work for you based on how you think that game should be played over the long term. My own market views are more Buffett-like than anything else. Time is a big requirement in showing the power of long-term compounding, but to show outstanding results will also require our ability to generate some alpha.</p>

<p>There are literally millions of us trying to find solutions to a portfolio&#39;s long-term payoff matrix equation and it is not by doing the same thing as everyone else that you will make the result that different from theirs, it is by innovating or reengineering trading methods if needed. </p>

<p>If you do not design your trading strategy for the long term, how will you know that your portfolio will survive? At least, realistically simulating your strategy, you can know if it would have survived over past market data. The future might still remain an unknown, but that will not change the portfolio&#39;s payoff matrix equation.</p>

<p>Hope it helps.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f6fc32506421002890de226' id='5f6fc32506421002890de226'>
<a href='#5f6fc32506421002890de226'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e43e62daf2637003d58a9c6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b1bd9ca2cef312b16b3a88044cfe3bf6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e43e62daf2637003d58a9c6'>Matthieu Crétier</a>
</div>
<a UTCms='1601159973000' class='quanto-date posted-at response-posted-at' href='#5f6fc32506421002890de226'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi folks,</p>

<p>I have followed the entire thread since the very first message and here comes my contribution.<br>
Here&#39;s a list of the element characterising the strategy:</p>

<ol>
<li>I have kept a very conservative and fearful approach: no use of futures, no leverage above 1.0.<br></li>
<li>The returns are good, but not the best. Same thing can be said about the Sharpe Ratio.<br></li>
<li>The max drawdown is high -33.43%, due to the dip in March this year.<br></li>
<li>The factors composing the quality (renamed value) indicator are: return on invested capital, debt-to-equity ratio, free cash flow / enterprise value, free cash flow / number of shares / share value and ebitda. All are metrics to assess the financial performances of a stock.</li>
</ol>

<p>All in all the algorithm works fine and it is a good starting point. I&#39;d like to bring it live, so I might ping those of you have done it already!</p>

<p>Nevertheless there are some things bugging me, that I hope you can help me solving:</p>

<ul>
<li>The variable for selecting the number of securities to buy is context.TARGET_SECURITIES. Despite being set to 5, I noticed that for long period of times the portfolio positions are well above 5. What&#39;s wrong in the functions select_stocks_and_set_weights and trade?<br></li>
<li>There is a variable called context.TARGET_WEIGHT_EQUAL that allows switching from equal weight to weight based on the top_value_momentum variable. I tried it both True and False, but I see no differences in the result. Could you help identify why?</li>
</ul>

<p>Cheers!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f703e5f32618b0016506e4c' id='5f703e5f32618b0016506e4c'>
<a href='#5f703e5f32618b0016506e4c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb05c81a1c4ac0040c7ae0c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2c03d939c8c879cddb1c770fadd01841?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb05c81a1c4ac0040c7ae0c'>Tentor Testivis</a>
</div>
<a UTCms='1601191519000' class='quanto-date posted-at response-posted-at' href='#5f703e5f32618b0016506e4c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Matthieu<br>
The part starting in line 202 answers your first question</p>

<pre><code>    context.daily_weights.append(total_weights)  
    if len(context.daily_weights) &gt; context.HOLD_DAYS:  
        context.daily_weights.pop(0)  
    ## Average the rolling portfolios  
    combined_weights = {}  
    for weights in context.daily_weights:  
        for s, w in weights.items():  
            if s not in combined_weights:  
                combined_weights[s] = 0 # initialize  
            combined_weights[s] += w / len(context.daily_weights)  
</code></pre>

<p>It stores the current weights in a list and if they are not older than HOLD_DAYS days they get added to the new ones.</p>

<p>The reason why TARGET_WEIGHT_EQUAL doesn&#39;t do anything is, that top_value_momentum is a boolean value - True or False. When used in a calculation this becomes 1 or 0. So this part of the calculation in line 181</p>

<pre><code>stocks_value.top_value_momentum[s] / stocks_value.top_value_momentum.sum() * len(stocks_value)  
</code></pre>

<p>translated into numbers this would be<br>
1 / 5 * 5<br>
= 1.</p>

<p>I&#39;ve added an additional column with the actual momentum value to the pipeline and used this instead of the boolean for calculating the weights.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f70ae1e06421002890de781' id='5f70ae1e06421002890de781'>
<a href='#5f70ae1e06421002890de781'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1601220126000' class='quanto-date posted-at response-posted-at' href='#5f70ae1e06421002890de781'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>I&#39;d like to bring it live, so I might ping those of you have done it already!</p>
</blockquote>

<p>only 5 positions and  you only need to rebalance once a week or once a month because these factors are slow moving and have negligible decay.. the easiest thing is manual execution. Really no advantage to automating such a small and slow strategy.</p>

<p>Just be aware of all the overfitting going on here.. don&#39;t expect future returns/risk to be as good.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f70cd36064210000e0df53a' id='5f70cd36064210000e0df53a'>
<a href='#5f70cd36064210000e0df53a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e43e62daf2637003d58a9c6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b1bd9ca2cef312b16b3a88044cfe3bf6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e43e62daf2637003d58a9c6'>Matthieu Crétier</a>
</div>
<a UTCms='1601228086000' class='quanto-date posted-at response-posted-at' href='#5f70cd36064210000e0df53a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Tentor thanks for the catch. That was a poor bug fix.</p>

<p>I have fixed the weight factor. Attached you can find the updated backtest.<br>
It does not present a major improvement!</p>

<p>@Viridian thanks for the suggestion and the heads-up.</p>

<p>It might indeed be overkilling it. I am really eager to delegate all the operations &amp; decision making process regarding my portfolio.<br>
I have an additional question for you. I have bluntly copied the following code from a Source Code that you have shared on Dec 11, 2019.  </p>

<pre><code>context.daily_weights.append(total_weights)  
    if len(context.daily_weights) &gt; context.HOLD_DAYS:  
        context.daily_weights.pop(0)  
    ## Average the rolling portfolios  
    combined_weights = {}  
    for weights in context.daily_weights:  
        for s, w in weights.items():  
            if s not in combined_weights:  
                combined_weights[s] = 0 # initialize  
            combined_weights[s] += w / len(context.daily_weights)  
</code></pre>

<p>The way I have understand it, the lines above shall enable the rebalance of the portfolio depending on given context.HOLD_DAYS.<br>
But it appears that the rebalance is carried almost daily. What was your original idea?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f715cb69e351d0011d20202' id='5f715cb69e351d0011d20202'>
<a href='#5f715cb69e351d0011d20202'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59065fbb5afa7d0010371ea1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/08e3b9ac969cdd40340b6094e6ce2bd7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59065fbb5afa7d0010371ea1'>Viridian Hawk</a>
<span class='badge medal'></span>
</div>
<a UTCms='1601264822000' class='quanto-date posted-at response-posted-at' href='#5f715cb69e351d0011d20202'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Matthieu Crétier - That bit of code implements a rolling portfolio. While it does rebalance each day, the target weights are a combination of the current day&#39;s weights, the previous day&#39;s weights, the day before that&#39;s weights, etc. So lets say pipeline only returns 5 positions, this allows you to hold more than 5 positions because you hold onto old positions longer, so you get more diversification without having to dig deeper into weaker alpha signals. It also smooths turnover. For this strategy though I think it doesn&#39;t really add much value. I would just leave it out and rebalance less often instead.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f7ca97b1072a600123bcc22' id='5f7ca97b1072a600123bcc22'>
<a href='#5f7ca97b1072a600123bcc22'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f2829d956816b0017feb5c9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d3f70bb690fff38b46129a8fd24de2b1?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f2829d956816b0017feb5c9'>Mohamed Adel</a>
</div>
<a UTCms='1602005371000' class='quanto-date posted-at response-posted-at' href='#5f7ca97b1072a600123bcc22'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello,</p>

<p>I spent a lot of time learning this study, but I have noted is that 1,500% cumulative profits are published as a great achievement, but if we think realistically and do the test for one year, we will find that the profit for one year is less than the bank interest and if it is slightly higher than the interest The bank does not mean anything in return for the risk</p>

<p>If my opinion is wrong, please correct me</p>

<p>Thanks  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f861944a77d390015520099' id='5f861944a77d390015520099'>
<a href='#5f861944a77d390015520099'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5a8b3f4e7006f539ce90d05d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a0d6416183cf99840fa6ad804300598?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5a8b3f4e7006f539ce90d05d'>Peter Guenther</a>
</div>
<a UTCms='1602623812000' class='quanto-date posted-at response-posted-at' href='#5f861944a77d390015520099'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p><strong><em>Amazing returns = superior stock selection strategy + superior in &amp; out strategy</em></strong><br>
In the forum thread New Strategy — “In &amp; Out” we are discussing the idea that the total returns that we can generate are the result of a great strategy regarding ‘what stocks to buy’ (e.g. “Quality companies in an uptrend”) and a clever timing (“In &amp; out strategy”) regarding when we are ‘in’ the market and hold the stocks versus when we are ‘out’ of the market and hold alternative assets (e.g., bonds). The timing is derived from early economic signals (see the forum thread for details). While in the thread, we only focus on the in &amp; out side of things, I wanted to give the combination a shot here.</p>

<p><strong><em>SEL[“Qual Up”] + I/O[“Death Cross”]</em></strong><br>
The “Quality Companies in an Uptrend” strategy has an integrated in &amp; out component, which is the ‘death cross’, i.e. the short-term moving average in the SPY breaking below the long-term moving average. The ‘death cross’ is popular but has issues such as that it only provides a lagged ‘out’ signal, i.e. when a drop already has occurred (see Tentor Testivis’s comment and the corresponding test in the “In &amp; Out” thread; search for ‘death cross’).<br>
The combined strategy’s (stock selection = “Qual Up” and in &amp; out = “Death Cross”) total return between 1 Jan 2008 and 2 Oct 2020 is 452.81%.</p>

<p><strong><em>SEL[“Qual Up”] + I/O[“In &amp; Out”]</em></strong><br>
Attached is a backtest for the same period (1 Jan 2008 to 2 Oct 2020) that combines the stock selection side of the “Quality in an Uptrend” strategy (“Qual Up”) with a recent version of the “In &amp; Out” strategy. Compared with the “Death Cross” in &amp; out strategy, additional returns can be realized.</p>

<p><strong><em>Implication</em></strong><br>
It can be worthwhile to separately optimize the stock selection strategy and the in &amp; out strategy. Of course, the ultimate results will also be driven by a certain synergy or dissonance between the two components.</p>

<p><strong><em>Limitations</em></strong><br>
SEL[“Qual Up”] + I/O[“Death Cross”] trades monthly, while SEL[“Qual Up”] + I/O[“In &amp; Out”] trades weekly due to how the In &amp; Out strategy is defined.<br>
SEL[“Qual Up”] + I/O[“In &amp; Out”] sells all stocks when the indicator is ‘out’, while SEL[“Qual Up”] + I/O[“Death Cross”] continues to hold certain stocks although the death cross indicates ‘out’.<br>
I/O[“In &amp; Out”] is based on a set of ETFs to derive important price signals, creating a lower boundary regarding the date that a backtest can start from. When testing periods before 1 Jan 2008, make sure that all the ETF prices are indeed available.<br>
(hopefully no substantial errors in the code, otherwise, if someone could post an updated backtest that would be greatly appreciated)</p>

<p><strong><em>Where to from here? Quest of the Grail</em></strong><br>
I suppose the ultimate objective is <em>let&#39;s get rich together</em>. A means to achieve this objective, I reckon, is further engagement in five key areas:<br>
1. improve existing stock selection strategies (SEL*)<br>
2. find additional amazing stock selection strategies (+SEL)<br>
3. improve existing in &amp; out strategies (I/O*)<br>
4. find additional clever in &amp; out strategies (+I/O)<br>
5. find optimal SEL + I/O combinations  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f863c1e0662ef0013d6418f' id='5f863c1e0662ef0013d6418f'>
<a href='#5f863c1e0662ef0013d6418f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1602632735000' class='quanto-date posted-at response-posted-at' href='#5f863c1e0662ef0013d6418f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Peter,</p>

<p>Here is a backtest of your algo with <a href="https://www.quantopian.com/posts/new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1" rel="nofollow">Chris Cain&#39;s original</a> quality definition.</p>

<pre><code>quality = ms.roe.latest.rank(mask = universe).  
</code></pre>

<p>Pretty good.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f89f433b5245b2d20e2a3bb' id='5f89f433b5245b2d20e2a3bb'>
<a href='#5f89f433b5245b2d20e2a3bb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/584709c0d105bc4727000072'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fbbdf71510a43bd01dc2b787ecd3c797?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/584709c0d105bc4727000072'>luc prieur</a>
</div>
<a UTCms='1602876467000' class='quanto-date posted-at response-posted-at' href='#5f89f433b5245b2d20e2a3bb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is the exact same logic but without using all the pipeline acrobatics to get the job done.  Thanks to all who contributed.</p>

<p>/L</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f8a090c982b653e7b8973ac' id='5f8a090c982b653e7b8973ac'>
<a href='#5f8a090c982b653e7b8973ac'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/584709c0d105bc4727000072'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fbbdf71510a43bd01dc2b787ecd3c797?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/584709c0d105bc4727000072'>luc prieur</a>
</div>
<a UTCms='1602881804000' class='quanto-date posted-at response-posted-at' href='#5f8a090c982b653e7b8973ac'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is another version of my code above, but with a different momentum logic. It cannot be considered &quot;quality&quot; companies,  I cannot take credit for the pipeline logic, it comes from &quot;Volatility time momentum algo&quot;</p>

<p>/L</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f8b035eb5245b0012e2e6f0' id='5f8b035eb5245b0012e2e6f0'>
<a href='#5f8b035eb5245b0012e2e6f0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59c023063d5f81000f2c6689'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ffaec44a1995e8e86e968502d749c864?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59c023063d5f81000f2c6689'>Frank Sch</a>
</div>
<a UTCms='1602945886000' class='quanto-date posted-at response-posted-at' href='#5f8b035eb5245b0012e2e6f0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Peter, Vladimir, please find some tweaks building on the version of Vladimir from 4 days ago with the goal of increasing Return and Sharpe:</p>

<ul>
<li>working with Q1500US and the top 150 to have a broader range for quality &amp; momentum<br></li>
<li>creating a compound &#39;quality&#39;: quality = (roic*.25 + roe*.27 + value*.20 + ltd_to_eq*.13).rank()<br></li>
<li>adjusting the &#39;momentum&#39; rank for assests with high volatility to improve sharpe: adj_momentum = (momentum-.03)/(1+volatility*0.3)<br></li>
<li>adding 10% &#39;GLD&#39; to the bonds to better balance when out of market</li>
</ul>

<p>Peter, great move to include the “In &amp; Out” here. Another addition could be to include &quot;mean returns of SPY &lt; mean returns of TLT or IEF&quot; into the bear filter  to be even more adaptive to regime changes.</p>

<p>Have fun!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f934356cb90f0001305e4c4' id='5f934356cb90f0001305e4c4'>
<a href='#5f934356cb90f0001305e4c4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f4a461a91ad32000f2c62bc'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b286983e22265093ee49e551f61c05d9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f4a461a91ad32000f2c62bc'>denis ermilov</a>
</div>
<a UTCms='1603486550000' class='quanto-date posted-at response-posted-at' href='#5f934356cb90f0001305e4c4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello, guys</p>

<p>I would like to make an impulse portfolio from 1998 to 2020 from US stocks (SP500 or NASDAQ).</p>

<p>testing rules</p>

<p>1 if VBMFX etf grows more than TBIL in 40 days, then turn on the risk mode on it</p>

<p>in risk mode, when enabled, we select n stocks (20-30 quontity) that performed better in the last 40/80 and 160 days of trading (in equal proportions) - better than SPY and QQQ</p>

<p>shares with capitalization over $ 1 billion</p>

<p>rsi14 for shares within 55-75</p>

<p>plus some fundamental indicators (but I would like to disable them)</p>

<p>2 if VBMFX grows less than SHY in 40 days, then we go in defense - TLT or IEF</p>

<p>please help with testing!</p>

<p>I attach a basic backtest, I would like to add these conditions there </p>

<p>my thoughts are based on the following back test <a href="https://bit.ly/31SXgeP" rel="nofollow">https://bit.ly/31SXgeP</a> ( in PortfolioVisualizer) (cagr 17, max draw down - 16)</p>

<p>I would like to replace ETF with shares and, with the help of an expert, reduce the risk</p>

<p>moreover, I noticed that all current models behave badly in 18-20 years. the model on the link from the PortfolioVisualizer, on the contrary, performed well at 18-20 years</p>

<p>I would like to try to include ideas from there in our backtest  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f974c224012510015c1692e' id='5f974c224012510015c1692e'>
<a href='#5f974c224012510015c1692e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1603750946000' class='quanto-date posted-at response-posted-at' href='#5f974c224012510015c1692e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Luc<br>
just searched for Hidden Markov Model to switch on/off strategies...like in this example the bull signal<br>
I found your old post, looked promising and tried it.<br>
Are you still using HMM? What is your experience? could it be used in alternative to  this bull signal<br>
It would like to use at least 3 phases, one for moment trades, one for mean reversing and maybe one to try for shorting.<br>
If one uses the whole time series it provides good results, but if one just uses 1000-2000 days past data and try to determine the present stage it’s not that clear anymore.<br>
Some ideas were to look?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f9ae62c1e18df000f39db18' id='5f9ae62c1e18df000f39db18'>
<a href='#5f9ae62c1e18df000f39db18'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f3bd0a80295ec001412d0b3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/292633755c82235eaa40cde1b47f5fe8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f3bd0a80295ec001412d0b3'>Joseph Morrissey</a>
</div>
<a UTCms='1603986988000' class='quanto-date posted-at response-posted-at' href='#5f9ae62c1e18df000f39db18'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Quants,<br>
New here but with experience in programming/machine learning.  I stumbled across Chris&#39;s whitepaper: <a href="https://cmtassociation.org/association/awards/charles-h-dow-award/" rel="nofollow">https://cmtassociation.org/association/awards/charles-h-dow-award/</a> as the 2020 winner. I noticed the original algo posted here has gone through a good number of tweaks before ending up at the finished product, namely:<br>
Summary of the rules:<br>
1) We start with a universe of the 500 most liquid US Stocks. This is Quantopian’s<br>
“Q500US” universe. This universe is derived by taking the 500 US stocks with the largest
average 200-day dollar volume, reconstituted monthly, capped at 30% of the equities<br>
derived from one sector.<br>
2) We then rank our stocks 1-500, based on the quality, value and low volatility factors.<br>
The stock ranked 500 would be the most attractive of these attributes and the stock<br>
ranked 1 would be the least attractive.<br>
a. Quality - Rank stocks by ROIC, the higher the better<br>
b. Value - Rank stocks by EBIT/EV, the higher the better<br>
c. Volatility - Rank stocks by trailing 100-day standard deviation, the lower the better<br>
19<br>
Quantamentals<br>
3) Add up the three rankings and take the top decile. We are now left with 50 stocks<br>
that have a combination of high quality, low valuation, and low volatility.<br>
4) Of our 50 stocks, take the top 20 based on cross-sectional momentum. This is<br>
measured by stocks with the highest 6-month total return, skipping the last month.<br>
5) Every month we rebalance our portfolio, selling any stock we currently hold that<br>
didn’t make the top 20 list based on the logic above and buying stocks that have<br>
since made the list. Stocks are equally weighted.<br>
6) We only take new entries if our time-series momentum regime filter is passed.<br>
For our time-series momentum regime filter, we simply use SPY’s price compared<br>
to its 100-day moving average. If the price of SPY is above its 100-day moving<br>
average, we take new entries. If the price of SPY is below its 100-day moving<br>
average, no new entries are taken.<br>
7) Any capital not allocated to stocks gets allocated to SHY (1-3yr US Treasuries).<br>
8) Assumptions include a beginning portfolio balance of $1,000,000 and commissions<br>
of $0.005 per share with a minimum trade ticket cost of $1. This models the real-life<br>
commission schedule of Interactive Brokers.<br>
Does anyone have the source code for this algo?  I think I can make improvements on the strategy side, but would rather not go through the process of alterations to get it from original to finished beforehand.  Many thanks in advance.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f9c2a69d46cba000e569d7a' id='5f9c2a69d46cba000e569d7a'>
<a href='#5f9c2a69d46cba000e569d7a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/573c8cc840046c7b8700003a'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/374a694cabf9cbafb64b8152f6b498dc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/573c8cc840046c7b8700003a'>alex zinny</a>
</div>
<a UTCms='1604069993000' class='quanto-date posted-at response-posted-at' href='#5f9c2a69d46cba000e569d7a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>check out <a href="http://www.cloudquant.com" rel="nofollow">www.cloudquant.com</a> or reach out to me to talk about our platform: <a href="/cdn-cgi/l/email-protection#badbc0d3d4d4c3fad9d6d5cfdecbcfdbd4ce94d9d5d7" rel="nofollow"><span class="__cf_email__" data-cfemail="86e7fcefe8e8ffc6e5eae9f3e2f7f3e7e8f2a8e5e9eb">[email&#160;protected]</span></a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f9c58e0a97fe6000b45c292' id='5f9c58e0a97fe6000b45c292'>
<a href='#5f9c58e0a97fe6000b45c292'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5d16eab28b9d8700426e4403'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/795715af6885876a93db325eb3f1a4c0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5d16eab28b9d8700426e4403'>Yu Huang</a>
</div>
<a UTCms='1604081888000' class='quanto-date posted-at response-posted-at' href='#5f9c58e0a97fe6000b45c292'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anyone has a copy of the code for this algorithm? want to download it. Thanks!  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1'>join Quantopian</a> to
post a reply.
</div>
</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#fa9c9f9f9e989b9991ba8b8f9b948e958a939b94d4999597">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

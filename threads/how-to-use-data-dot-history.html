<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
How to Use data.history
</title>
<meta content='Hi guys,  I am having trouble using the data.history. The examples that I found was: def initialize(context):     # AAPL, MSFT, and SPY     context.assets = [sid(24), sid(5061), sid(8554)] def handle_data(context, data):     price_history = data.history(context.assets, fields=&quot;price&quot;, bar_count=20, frequency=&quot;1d&quot;) However, I am now having a DataFrame of stocks filtered from Pipeline. I tried to convert that DataFrame with tolist() and assign it as context.assets. However, it didn&#39;t seem to...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="r7iV26+vaI/B5qV3ri3xLJsz2YXH8Bf7RXw9yXJYf4LT3uOWDVm6bHj7/EbhwllYo7367L08AuDHc+aj2B0dOQ==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=true;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/how-to-use-data-dot-history' property='og:url'>
<meta content='How to Use data.history' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/how-to-use-data-dot-history' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='How to Use data.history' property='og:title'>
<meta content='Hi guys,  I am having trouble using the data.history. The examples that I found was: def initialize(context):     # AAPL, MSFT, and SPY     context.assets = [sid(24), sid(5061), sid(8554)] def handle_data(context, data):     price_history = data.history(context.assets, fields=&quot;price&quot;, bar_count=20, frequency=&quot;1d&quot;) However, I am now having a DataFrame of stocks filtered from Pipeline. I tried to convert that DataFrame with tolist() and assign it as context.assets. However, it didn&#39;t seem to...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/how-to-use-data-dot-history">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='5c085941bdd6f8451ce7f54e'>
<div class='post-container' data-post-id='5c085941bdd6f8451ce7f54e' id='5c085941bdd6f8451ce7f54e'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>How to Use data.history</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1544051009000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=How to Use data.history&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fhow-to-use-data-dot-history%3Futm_source%3Dwebsite_share%26utm_campaign%3Dhow-to-use-data-dot-hitory%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fhow-to-use-data-dot-history%3Futm_source%3Dwebsite_share%26utm_campaign%3Dhow-to-use-data-dot-hitory%26utm_medium%3Dlinkedin&amp;title=How+to+Use+data.history+%28Thanh+Duong%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/how-to-use-data-dot-history?utm_source=website_share&amp;utm_campaign=how-to-use-data-dot-hitory&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Thanh Duong" />
<div class='body-text'>
<div class='body-text-container post-body'><p>Hi guys, </p>

<p>I am having trouble using the data.history. The examples that I found was:</p>

<p>def initialize(context):<br>
    # AAPL, MSFT, and SPY<br>
    context.assets = [sid(24), sid(5061), sid(8554)]</p>

<p>def handle_data(context, data):<br>
    price_history = data.history(context.assets, fields=&quot;price&quot;, bar_count=20, frequency=&quot;1d&quot;)</p>

<p>However, I am now having a DataFrame of stocks filtered from Pipeline. I tried to convert that DataFrame with tolist() and assign it as context.assets. However, it didn&#39;t seem to work when I pass that list through data.history.  Is there any way that I can convert the DataFrame into a list of sid? </p>

<p>Thank you very much!  </p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>40 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='5c09406fac3e670043de4daa' id='5c09406fac3e670043de4daa'>
<a href='#5c09406fac3e670043de4daa'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5642cf6c6348c383cd000336'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1365a60fdbd1a58b4b68d221ef240603?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5642cf6c6348c383cd000336'>JJ Rhomatixx</a>
</div>
<a UTCms='1544110191000' class='quanto-date posted-at response-posted-at' href='#5c09406fac3e670043de4daa'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>HI THanh,</p>

<p>if you assign your pipeline output you should be able to loop through each pipeline generated symbol.</p>

<pre><code>context.results = pipeline_output(&#39;factors&#39;)  
 for stock in context.results.index:  
            var=1  
            sym=stock.symbol  
</code></pre>

<p>Hope this helps  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c09d0bc5d2b687020b8b2f7' id='5c09d0bc5d2b687020b8b2f7'>
<a href='#5c09d0bc5d2b687020b8b2f7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1544147132000' class='quanto-date posted-at response-posted-at' href='#5c09d0bc5d2b687020b8b2f7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi JJ,</p>

<p>Thanks a lot for your help! I am very new to both programming and Quantopian. Would you kindly explain what does the line var=1 do? From what I understand, the for loop will go through all values in context.results.index and input the stock.symbol value for each stock in the variable &quot;sym.&quot; Is it correct? </p>

<p>Thanks so much!</p>

<p>Thanh Duong  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c0a81ff0f09c62c32f6cb36' id='5c0a81ff0f09c62c32f6cb36'>
<a href='#5c0a81ff0f09c62c32f6cb36'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5642cf6c6348c383cd000336'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1365a60fdbd1a58b4b68d221ef240603?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5642cf6c6348c383cd000336'>JJ Rhomatixx</a>
</div>
<a UTCms='1544192511000' class='quanto-date posted-at response-posted-at' href='#5c0a81ff0f09c62c32f6cb36'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>var=1 doesn&#39;t it&#39;s just from an old code,<br>
yes that is correct  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c0eead1ffa1eb004799f9c3' id='5c0eead1ffa1eb004799f9c3'>
<a href='#5c0eead1ffa1eb004799f9c3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1544481489000' class='quanto-date posted-at response-posted-at' href='#5c0eead1ffa1eb004799f9c3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><pre><code>def before_trading_start(context, data):  
...
    result10 = result[result[&#39;score&#39;] == 10]  
    context.securities = result10.tail(10)  
    context.sym = []  
    for stock in context.securities.index:  
           context.sym.append(stock.symbol)  
def my_rebalance(context,data):  
    prices = data.history(context.sym, &#39;price&#39;, bar_count=100, frequency=&#39;1d&#39;)  
    returns = prices.pct_change().dropna()  
    returns = returns.values  
    print type(prices)  
    print prices  
</code></pre>

<p>Hi JJ, I followed your instruction to loop through the Dataframe index and append a list of stock symbols. However, when I ran the algorithm and print the prices, it showed me that &quot;prices&quot; is an empty DataFrame. I really wish there would be a way to debug this.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c0eeaf5d58e280044bb7405' id='5c0eeaf5d58e280044bb7405'>
<a href='#5c0eeaf5d58e280044bb7405'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1544481525000' class='quanto-date posted-at response-posted-at' href='#5c0eeaf5d58e280044bb7405'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is my full code:</p>

<pre><code>from quantopian.algorithm import attach_pipeline, pipeline_output  
from quantopian.pipeline.classifiers.fundamentals import Sector  
from quantopian.pipeline import Pipeline  
from quantopian.pipeline.data import morningstar  
from quantopian.pipeline.data import Fundamentals  
from quantopian.pipeline import CustomFactor  
from quantopian.pipeline.filters import QTradableStocksUS  
import numpy as np  
import cvxopt as opt  
from cvxopt import blas, solvers  
import pandas as pd


def initialize(context):  
    context.opt_frame = 180

    # Rebalance on the first trading day of each month at 11AM.  
    schedule_function(my_rebalance,  
                      date_rules.every_day(),  
                      time_rules.market_open(hours=1, minutes=30))

    # Create and attach our pipeline (dynamic stock selector), defined below.  
    attach_pipeline(make_pipeline(context), &#39;pit&#39;)

def make_pipeline(context):  
  # Get Latest Fundamentals  
  OCF = Fundamentals.operating_cash_flow.latest  
  debt_to_asset = Fundamentals.debtto_assets.latest  
  quick_ratio = Fundamentals.quick_ratio.latest  
  outstanding_shares = Fundamentals.shares_outstanding.latest  
  gross_margin = Fundamentals.gross_margin.latest  
  assets_turnover = Fundamentals.assets_turnover.latest  
  NI = Fundamentals.net_income_from_continuing_operations.latest  
  cash_return = Fundamentals.cash_return.latest  
  enterprise_value = Fundamentals.enterprise_value.latest  
  total_revenue = Fundamentals.total_revenue.latest  
  fcf_yield = Fundamentals.fcf_yield.latest  
  book_value_yield = Fundamentals.book_value_yield.latest  


  #Get Last Year Fundamentals  
  class Previous(CustomFactor):  
    # Returns value of input x trading days ago where x is the window_length  
    # Both the inputs and window_length must be specified as there are no defaults  
      def compute(self, today, assets, out, inputs):  
          out[:] = inputs[0]  
  window_length = 252  
  debt_to_asset2 = Previous(inputs = [Fundamentals.debtto_assets], window_length = window_length)  
  quick_ratio2 = Previous(inputs = [Fundamentals.quick_ratio], window_length = window_length)  
  outstanding_shares2 = Previous(inputs = [Fundamentals.shares_outstanding], window_length = window_length)  
  gross_margin2 = Previous(inputs = [Fundamentals.gross_margin], window_length = window_length)  
  assets_turnover2 = Previous(inputs = [Fundamentals.assets_turnover], window_length = window_length)  
  NI2 = Previous(inputs = [Fundamentals.net_income_from_continuing_operations], window_length = window_length)  
  total_revenue2 = Previous(inputs = [Fundamentals.total_revenue], window_length = window_length)  
  cash_return2 = Previous(inputs = [Fundamentals.cash_return], window_length = window_length)  
  enterprise_value2 = Previous(inputs = [Fundamentals.enterprise_value], window_length = window_length)

  result = Pipeline(  
    columns={  
        &#39;OCF&#39;:OCF,  
        &#39;debt_to_asset&#39;:debt_to_asset,  
        &#39;debt_to_asset2&#39;:debt_to_asset2,  
        &#39;quick_ratio&#39;:quick_ratio,  
        &#39;quick_ratio2&#39;:quick_ratio2,  
        &#39;outstanding_shares&#39;:outstanding_shares,  
        &#39;outstanding_shares2&#39;:outstanding_shares2,  
        &#39;gross_margin&#39;:gross_margin,  
        &#39;gross_margin2&#39;:gross_margin2,  
        &#39;assets_turnover&#39;:assets_turnover,  
        &#39;assets_turnover2&#39;:assets_turnover2,  
        &#39;NI&#39;: NI,  
        &#39;NI2&#39;: NI2,  
        &#39;total_revenue&#39;: total_revenue,  
        &#39;total_revenue2&#39;: total_revenue2,  
        &#39;cash_return&#39;: cash_return,  
        &#39;cash_return2&#39;: cash_return2,  
        &#39;enterprise_value&#39;: enterprise_value,  
        &#39;enterprise_value2&#39;: enterprise_value2,  
        &#39;fcf_yield&#39;: fcf_yield,  
        &#39;book_value_yield&#39;: book_value_yield  
        }, screen = QTradableStocksUS()  
  )  
  return result

def before_trading_start(context, data):

    context.output = pipeline_output(&#39;pit&#39;)  
    result = context.output.dropna(axis=0)  
    result2 = context.output.dropna(axis=0)

    result.loc[:,(&#39;total_avg_assets&#39;)] = result.loc[:,(&#39;total_revenue&#39;)]/result.loc[:,(&#39;assets_turnover&#39;)]  
    result.loc[:,(&#39;ROA&#39;)] = result.loc[:,(&#39;NI&#39;)]/result.loc[:,(&#39;total_avg_assets&#39;)]  
    result.loc[:,(&#39;FCF&#39;)] = result.loc[:,(&#39;cash_return&#39;)]*result.loc[:,(&#39;enterprise_value&#39;)]  
    result.loc[:,(&#39;FCFTA&#39;)] = result.loc[:,(&#39;FCF&#39;)]/result.loc[:,(&#39;total_avg_assets&#39;)]

    result.loc[:,(&#39;total_avg_assets2&#39;)] = result.loc[:,(&#39;total_revenue2&#39;)]/result.loc[:,(&#39;assets_turnover2&#39;)]  
    result.loc[:,(&#39;ROA2&#39;)] = result.loc[:,(&#39;NI2&#39;)]/result.loc[:,(&#39;total_avg_assets2&#39;)]  
    result.loc[:,(&#39;FCF2&#39;)] = result.loc[:,(&#39;cash_return2&#39;)]*result.loc[:,(&#39;enterprise_value2&#39;)]  
    result.loc[:,(&#39;FCFTA2&#39;)] = result.loc[:,(&#39;FCF2&#39;)]/result.loc[:,(&#39;total_avg_assets2&#39;)]

#Current Profitability  
#ROA &gt; 0  
    result.loc[:,(&#39;FS_ROA&#39;)] = result.loc[:,(&#39;ROA&#39;)] &gt;0  
#FCFTA &gt; 0  
    result.loc[:,(&#39;FS_FCFTA&#39;)] = result.loc[:,(&#39;FCFTA&#39;)] &gt;0  
#Accrual  
    result.loc[:,(&#39;F_ACCRUAL&#39;)] = result.loc[:,(&#39;OCF&#39;)] &gt; result.loc[:,(&#39;NI&#39;)]

#Stability  
#Lever  
    result.loc[:,(&#39;delta_lever&#39;)] = result.loc[:,(&#39;debt_to_asset&#39;)] - result.loc[:,(&#39;debt_to_asset2&#39;)] &lt; 0  
#Liquidity  
    result.loc[:,(&#39;delta_quick_ratio&#39;)] = result.loc[:,(&#39;quick_ratio&#39;)] - result.loc[:,(&#39;quick_ratio2&#39;)] &gt; 0  
#Equity Repurchase  
    result.loc[:,(&#39;delta_OS&#39;)] = result.loc[:,(&#39;outstanding_shares&#39;)] - result.loc[:,(&#39;outstanding_shares2&#39;)] &lt;= 0

#Operational Improvement  
#Increasing ROA  
    result.loc[:,(&#39;delta_roa&#39;)] = result.loc[:,(&#39;ROA&#39;)] - result.loc[:,(&#39;ROA2&#39;)] &gt; 0  
#Increasing FCFTA  
    result.loc[:,(&#39;delta_FCFTA&#39;)] = result.loc[:,(&#39;FCFTA&#39;)] - result.loc[:,(&#39;FCFTA2&#39;)] &gt; 0  
#Increasing gross margin  
    result.loc[:,(&#39;delta_gross_margin&#39;)] = result.loc[:,(&#39;gross_margin&#39;)] - result.loc[:,(&#39;gross_margin2&#39;)] &gt; 0  
#Increasing assets turnover  
    result.loc[:,(&#39;delta_assets_turnover&#39;)] = result.loc[:,(&#39;assets_turnover&#39;)] - result.loc[:,(&#39;assets_turnover2&#39;)] &gt; 0

    result = result.drop([&#39;OCF&#39;,&#39;assets_turnover&#39;,&#39;assets_turnover2&#39;,&#39;debt_to_asset&#39;,  
                      &#39;debt_to_asset2&#39;,&#39;gross_margin&#39;,&#39;gross_margin2&#39;,&#39;outstanding_shares&#39;,  
                      &#39;outstanding_shares2&#39;,&#39;quick_ratio&#39;,&#39;quick_ratio2&#39;,&#39;ROA&#39;,&#39;ROA2&#39;,&#39;NI&#39;,&#39;NI2&#39;,&#39;total_revenue&#39;,&#39;total_revenue2&#39;,&#39;cash_return&#39;, &#39;cash_return2&#39;, &#39;enterprise_value&#39;, &#39;enterprise_value2&#39;,  
                     &#39;total_avg_assets&#39;,&#39;FCF&#39;,&#39;FCFTA&#39;,&#39;total_avg_assets2&#39;,&#39;FCF2&#39;,&#39;FCFTA2&#39;,&#39;fcf_yield&#39;], axis=1)  
    result = result.astype(int)  
  #Sum row to get the score  
    result.loc[:,(&#39;score&#39;)] = result.sum(axis=1)  
    result.loc[:,(&#39;fcf_yield&#39;)] = result2.loc[:,(&#39;fcf_yield&#39;)]  
    result.sort_values(by=[&#39;fcf_yield&#39;])  
    result = result[result[&#39;book_value_yield&#39;] &gt; result[&#39;book_value_yield&#39;].quantile(0.7)]  
    result10 = result[result[&#39;score&#39;] == 10]  
    context.securities = result10.tail(10)  
    context.sym = []  
    for stock in context.securities.index:  
            context.sym.append(stock.symbol)  
def optimal_portfolio(returns):  
    &quot;&quot;&quot;  
    Finds the Optimal Portfolio according to the Markowitz Mean-Variance Model  
    &quot;&quot;&quot;  
    n = len(returns)  
    returns = np.asmatrix(returns)  

    print type(returns)  
    print returns  
    N = 200  
    mus = [10**(5.0 * t/N - 1.0) for t in range(N)]  
    # Convert to cvxopt matrices  
    S = opt.matrix(np.cov(returns))  
    pbar = opt.matrix(np.mean(returns, axis=1))  
    print pbar  

    # Create constraint matrices  
    G = -opt.matrix(np.eye(n))   # negative n x n identity matrix  
    h = opt.matrix(0.0, (n ,1))  
    A = opt.matrix(1.0, (1, n))  
    b = opt.matrix(1.0)  
    # Calculate efficient frontier weights using quadratic programming  
    portfolios = [solvers.qp(mu*S, -pbar, G, h, A, b)[&#39;x&#39;]  
                  for mu in mus]  
    ## CALCULATE RISKS AND RETURNS FOR FRONTIER  
    returns = [blas.dot(pbar, x) for x in portfolios]  
    risks = [np.sqrt(blas.dot(x, S*x)) for x in portfolios]  
    ## CALCULATE THE 2ND DEGREE POLYNOMIAL OF THE FRONTIER CURVE  
    m1 = np.polyfit(returns, risks, 2)  
    x1 = 10 #= np.sqrt(m1[2] / m1[0])  
    # CALCULATE THE OPTIMAL PORTFOLIO  
    wt = solvers.qp(opt.matrix(x1 * S), -pbar, G, h, A, b)[&#39;x&#39;]  
    return np.asarray(wt), returns, risks

def my_rebalance(context,data):  
    &quot;&quot;&quot;  
     Called daily to rebalance the Portfolio according to the equity weights calulated by optimal_portfolio()  
    &quot;&quot;&quot;

    prices = data.history(context.sym, &#39;price&#39;, bar_count=100, frequency=&#39;1d&#39;)  
    returns = prices.pct_change().dropna()  
    returns = returns.values  
    print type(prices)  
    print prices

    try:  
        # Calculate weights by method of choice  
        weights, _, _ = optimal_portfolio(returns.T)  
        #weights = equal_portfolio(returns.T)  

        # Rebalance portfolio accordingly  
        for stock, weight in zip(prices.columns, weights):  
            order_target_percent(stock, weight)  
    except ValueError as e:  
        # Sometimes this error is thrown  
        # ValueError: Rank(A) &lt; p or Rank([P; A; G]) &lt; n  
        pass  
    pass  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c0f04cd45c1410049c3e1b8' id='5c0f04cd45c1410049c3e1b8'>
<a href='#5c0f04cd45c1410049c3e1b8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ed38379b1e7efbfb0006f8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fe429093818ef2b5c8f29dc274a188b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ed38379b1e7efbfb0006f8'>Karl Mun</a>
</div>
<a UTCms='1544488141000' class='quanto-date posted-at response-posted-at' href='#5c0f04cd45c1410049c3e1b8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks for sharing, Thanh Duong.</p>

<p>Do you find the Markowitz Mean-Variance optimisation results stable?<br>
Keen to see a backtest :)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c0fc13449bfdd0040d6d69f' id='5c0fc13449bfdd0040d6d69f'>
<a href='#5c0fc13449bfdd0040d6d69f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5642cf6c6348c383cd000336'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1365a60fdbd1a58b4b68d221ef240603?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5642cf6c6348c383cd000336'>JJ Rhomatixx</a>
</div>
<a UTCms='1544536372000' class='quanto-date posted-at response-posted-at' href='#5c0fc13449bfdd0040d6d69f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Thanh,</p>

<p>Context.sym is being appended, but your issue is<br>
prices = data.history(context.sym, &#39;price&#39;, bar_count=100, frequency=&#39;1d&#39;)   not really sure what invalid literal for int() with base 10: &#39;S&#39; means  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c100bf445c14161d6c3e1fd' id='5c100bf445c14161d6c3e1fd'>
<a href='#5c100bf445c14161d6c3e1fd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1544555508000' class='quanto-date posted-at response-posted-at' href='#5c100bf445c14161d6c3e1fd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I found the issue! Turned out my initial DataFrame had too many filters that made it empty! I removed some of those filters and now the algorithm is up and running. I will post the result shortly. Thanks a lot, JJ.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c100e0349bfdd4907d6d27d' id='5c100e0349bfdd4907d6d27d'>
<a href='#5c100e0349bfdd4907d6d27d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5642cf6c6348c383cd000336'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1365a60fdbd1a58b4b68d221ef240603?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5642cf6c6348c383cd000336'>JJ Rhomatixx</a>
</div>
<a UTCms='1544556035000' class='quanto-date posted-at response-posted-at' href='#5c100e0349bfdd4907d6d27d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>can&#39;t wait to see the results Thanh, glad I could help  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c113dd630c1e97b9dc0a3c7' id='5c113dd630c1e97b9dc0a3c7'>
<a href='#5c113dd630c1e97b9dc0a3c7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1544633814000' class='quanto-date posted-at response-posted-at' href='#5c113dd630c1e97b9dc0a3c7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is a backtest from 2016 to 2018. I tried to backtest from 2004 to 2018 but the algorithm crashed sometime in 2009 or 2015. I am still trying to find out why. This algorithm is basically a combination of a couple of strategies that I learned on Quantopian. I selected 10 financially stable stocks with Piotroski Score + sorted dividend yield. Then, I constructed a portfolio with those ten stocks with optimized weights from Markowitz Mean-Variance Frontier. </p>

<p>The result: TOO RISKY! The return just seemed like a magnified market return with 4.99 beta! Maximum drawdown is 52%. In one of my backtest, in 2008, the max drawdown was 2000%... There has to be something wrong with the algorithm as everything seemed too absurd to me, haha. </p>

<p>JJ and Karl, I hope that you guys can offer some insights as to why this happened.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c113e926b95d00046029edd' id='5c113e926b95d00046029edd'>
<a href='#5c113e926b95d00046029edd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1544634002000' class='quanto-date posted-at response-posted-at' href='#5c113e926b95d00046029edd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is the original backtest with equally weighted Piotroski + sorted dividend yield stocks (No Markowitz involved)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c11401361f3d300474289c9' id='5c11401361f3d300474289c9'>
<a href='#5c11401361f3d300474289c9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5642cf6c6348c383cd000336'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1365a60fdbd1a58b4b68d221ef240603?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5642cf6c6348c383cd000336'>JJ Rhomatixx</a>
</div>
<a UTCms='1544634387000' class='quanto-date posted-at response-posted-at' href='#5c11401361f3d300474289c9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Did you put a limit on your leverage?? </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c11469a61f3d357d9428383' id='5c11469a61f3d357d9428383'>
<a href='#5c11469a61f3d357d9428383'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1544636058000' class='quanto-date posted-at response-posted-at' href='#5c11469a61f3d357d9428383'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I did not! I will now.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c11b1bfdec09e0049dabb2f' id='5c11b1bfdec09e0049dabb2f'>
<a href='#5c11b1bfdec09e0049dabb2f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1544663487000' class='quanto-date posted-at response-posted-at' href='#5c11b1bfdec09e0049dabb2f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I summed all the weights up in variable &quot;leverage&quot; and changed<br>
order_target_percent(stock, weight) </p>

<p>to </p>

<p>order_target_percent(stock, weight/leverage) </p>

<p>I also changed the rebalancing frequency to monthly and fixed minor errors. The result, however, is still a very high beta portfolio. The sharp ratio does look good. I am backtesting from 2004 - 2018 to see how it would perform during a recession.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c1200248acc2f003c98539d' id='5c1200248acc2f003c98539d'>
<a href='#5c1200248acc2f003c98539d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1544683556000' class='quanto-date posted-at response-posted-at' href='#5c1200248acc2f003c98539d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The real reason for the leverage problem is that your algorithm does not sell stocks that are no more in the context.securities.<br>
These 4 lines in <strong>my rebalance</strong> can help to do that.</p>

<pre><code>    for stock in context.portfolio.positions.keys():  
        if stock not in context.securities.index:  
             if data.can_trade(stock):  
                 order_target_percent(stock, 0)  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c1204594a7eaf0047fec9d9' id='5c1204594a7eaf0047fec9d9'>
<a href='#5c1204594a7eaf0047fec9d9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1544684633000' class='quanto-date posted-at response-posted-at' href='#5c1204594a7eaf0047fec9d9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks, Vladimir. I can&#39;t believe I forgot about this... I&#39;m rerunning everything now.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c13c4b10d212b004bfa58ff' id='5c13c4b10d212b004bfa58ff'>
<a href='#5c13c4b10d212b004bfa58ff'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1544799409000' class='quanto-date posted-at response-posted-at' href='#5c13c4b10d212b004bfa58ff'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Fixed everything! Here is the final result. The return slightly increases as compared to the algorithm without Markowitz (equally weighted). Alpha increased from 5% to 6%. Max drawdown increase as the result of slightly higher beta causing a bigger downswing during the recession. However, the sharp ratio decrease, which is odd because I thought the whole point of Markowitz weighting is to maximize sharp ratio. Do you guys have any suggestion on how to further improve the algorithm?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c13de04d7f0ec73b57bc778' id='5c13de04d7f0ec73b57bc778'>
<a href='#5c13de04d7f0ec73b57bc778'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5642cf6c6348c383cd000336'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1365a60fdbd1a58b4b68d221ef240603?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5642cf6c6348c383cd000336'>JJ Rhomatixx</a>
</div>
<a UTCms='1544805892000' class='quanto-date posted-at response-posted-at' href='#5c13de04d7f0ec73b57bc778'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>it looks great did you submit it already  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c13f3310d212b003ffa5aa5' id='5c13f3310d212b003ffa5aa5'>
<a href='#5c13f3310d212b003ffa5aa5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1544811313000' class='quanto-date posted-at response-posted-at' href='#5c13f3310d212b003ffa5aa5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi JJ, do you mean submitting for the competition? Unfortunately, this algorithm is a long-only and not a long-short, and I didn&#39;t use the appropriate constraints and order_optimize to qualify for the competition. I do have a long-short version but it is horrible. Here is the long-short version with all contest condition met. Even though stocks with high Piotroski scores do seem to out-perform the market, ones with low Piotroski scores do not. Hence, when I shorted the low Piotroski score stocks, the whole portfolio underperformed.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c1541b9aa8f470045880629' id='5c1541b9aa8f470045880629'>
<a href='#5c1541b9aa8f470045880629'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5642cf6c6348c383cd000336'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1365a60fdbd1a58b4b68d221ef240603?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5642cf6c6348c383cd000336'>JJ Rhomatixx</a>
</div>
<a UTCms='1544896953000' class='quanto-date posted-at response-posted-at' href='#5c1541b9aa8f470045880629'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>how did you get risk_loadings to work even the one from quantopian has a runtime error  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c168b0c724bec0049b75c76' id='5c168b0c724bec0049b75c76'>
<a href='#5c168b0c724bec0049b75c76'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1544981260000' class='quanto-date posted-at response-posted-at' href='#5c168b0c724bec0049b75c76'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey JJ,</p>

<p>I followed the contest instruction and read sample codes from Quantopian to construct this algo. I ran this backtest a couple months ago. Maybe the runtime error is a recent issue?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c181453ae1028045a6f6b31' id='5c181453ae1028045a6f6b31'>
<a href='#5c181453ae1028045a6f6b31'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5642cf6c6348c383cd000336'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1365a60fdbd1a58b4b68d221ef240603?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5642cf6c6348c383cd000336'>JJ Rhomatixx</a>
</div>
<a UTCms='1545081939000' class='quanto-date posted-at response-posted-at' href='#5c181453ae1028045a6f6b31'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I found the issue, I wasn&#39;t creating a proper pipeline.<br>
Ill show you the algo when it completes the backtest  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c1824c2253e097ebcd056ef' id='5c1824c2253e097ebcd056ef'>
<a href='#5c1824c2253e097ebcd056ef'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5642cf6c6348c383cd000336'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1365a60fdbd1a58b4b68d221ef240603?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5642cf6c6348c383cd000336'>JJ Rhomatixx</a>
</div>
<a UTCms='1545086146000' class='quanto-date posted-at response-posted-at' href='#5c1824c2253e097ebcd056ef'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here it is, I based this on some value investing but I couldn&#39;t get any info on bond ratings  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c18709881caf1003e2ac27a' id='5c18709881caf1003e2ac27a'>
<a href='#5c18709881caf1003e2ac27a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1545105560000' class='quanto-date posted-at response-posted-at' href='#5c18709881caf1003e2ac27a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey JJ. Can you explain what this line does?</p>

<p>beta = 0.66*RollingLinearRegressionOfReturns(<br>
                    target=sid(8554),<br>
                    returns_length=5,<br>
                    regression_length=260,<br>
                    mask=combined_alpha.notnull() &amp; Sector().notnull()<br>
                    ).beta + 0.33*1.0  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c19248de435dc004812847c' id='5c19248de435dc004812847c'>
<a href='#5c19248de435dc004812847c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5642cf6c6348c383cd000336'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1365a60fdbd1a58b4b68d221ef240603?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5642cf6c6348c383cd000336'>JJ Rhomatixx</a>
</div>
<a UTCms='1545151629000' class='quanto-date posted-at response-posted-at' href='#5c19248de435dc004812847c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>believe that is the restriction for beta to spy<br>
<a href="https://www.quantopian.com/tutorials/contest#lesson8" rel="nofollow">https://www.quantopian.com/tutorials/contest#lesson8</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c1a866000f8c2004628c240' id='5c1a866000f8c2004628c240'>
<a href='#5c1a866000f8c2004628c240'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5642cf6c6348c383cd000336'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1365a60fdbd1a58b4b68d221ef240603?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5642cf6c6348c383cd000336'>JJ Rhomatixx</a>
</div>
<a UTCms='1545242208000' class='quanto-date posted-at response-posted-at' href='#5c1a866000f8c2004628c240'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Heres a better one that meets the constraints but only for the time period ,<br>
Im still working on the alpha, the key is to get a positive return 2 years prior to the current date where I&#39;m not<br>
just improving the algo for that period only.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c1acc96e10b260043072964' id='5c1acc96e10b260043072964'>
<a href='#5c1acc96e10b260043072964'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5642cf6c6348c383cd000336'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1365a60fdbd1a58b4b68d221ef240603?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5642cf6c6348c383cd000336'>JJ Rhomatixx</a>
</div>
<a UTCms='1545260182000' class='quanto-date posted-at response-posted-at' href='#5c1acc96e10b260043072964'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanh would you happen to know how many stocks are in QTradableStocksUS  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c1d3e1539da2420ce35baf7' id='5c1d3e1539da2420ce35baf7'>
<a href='#5c1d3e1539da2420ce35baf7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5642cf6c6348c383cd000336'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1365a60fdbd1a58b4b68d221ef240603?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5642cf6c6348c383cd000336'>JJ Rhomatixx</a>
</div>
<a UTCms='1545420309000' class='quanto-date posted-at response-posted-at' href='#5c1d3e1539da2420ce35baf7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey Thanh,</p>

<p>I wondering if you can help me out with something,</p>

<p>can you tell me how you manage your backtest in research environment,<br>
there doesn&#39;t seem to be a direct way to this.<br>
Im trying to run backtest on Fundamentals  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c1d4c804764a5003fca0747' id='5c1d4c804764a5003fca0747'>
<a href='#5c1d4c804764a5003fca0747'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1545424000000' class='quanto-date posted-at response-posted-at' href='#5c1d4c804764a5003fca0747'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey JJ. Sorry I have been busy all week. I normally only create the pipeline in the research environment and move that right away to backtest. I will try to help you this weekend.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c1d4d8e4764a5003fca074d' id='5c1d4d8e4764a5003fca074d'>
<a href='#5c1d4d8e4764a5003fca074d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5642cf6c6348c383cd000336'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1365a60fdbd1a58b4b68d221ef240603?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5642cf6c6348c383cd000336'>JJ Rhomatixx</a>
</div>
<a UTCms='1545424270000' class='quanto-date posted-at response-posted-at' href='#5c1d4d8e4764a5003fca074d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>thank you ,<br>
my goal is to loop through all combination of fundamentals to get the combo with the highest returns,<br>
but I can&#39;t seem to get the return comparison right .<br>
Thank you in advance for you help  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c1e899607de6a003e0cc699' id='5c1e899607de6a003e0cc699'>
<a href='#5c1e899607de6a003e0cc699'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5642cf6c6348c383cd000336'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1365a60fdbd1a58b4b68d221ef240603?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5642cf6c6348c383cd000336'>JJ Rhomatixx</a>
</div>
<a UTCms='1545505174000' class='quanto-date posted-at response-posted-at' href='#5c1e899607de6a003e0cc699'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s the updated notebook it seems to have a problem appending run pipeline,<br>
I had to attach a break in combo so the kernel can stop dying  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c266114aee6fb004423cefe' id='5c266114aee6fb004423cefe'>
<a href='#5c266114aee6fb004423cefe'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1546019092000' class='quanto-date posted-at response-posted-at' href='#5c266114aee6fb004423cefe'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey JJ. Sorry for the delay in response. I think your idea is solid. </p>

<p>However, isn&#39;t from <a href="https://www.quantopian.com/posts/backtest-in-research" rel="nofollow">this post</a>. It&#39;s still not yet possible to run a sustainable backtest on research? I try to run zipline locally also, but we can&#39;t access Fundamental or anything like QtradableStockUS()  from the Quantopian API. </p>

<p>I might try to scrape fundamental data from the SEC and test out your hypothesis (that there exists a combination of fundamental features that would yield the highest alpha). But it would be a very lengthy process and might not be applicable to Quantopian&#39;s order_optimize. </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c266be3b3148e0042e57536' id='5c266be3b3148e0042e57536'>
<a href='#5c266be3b3148e0042e57536'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5642cf6c6348c383cd000336'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1365a60fdbd1a58b4b68d221ef240603?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5642cf6c6348c383cd000336'>JJ Rhomatixx</a>
</div>
<a UTCms='1546021859000' class='quanto-date posted-at response-posted-at' href='#5c266be3b3148e0042e57536'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>IT&#39;s ok I decided instead of backtesting Fundamentals  I&#39;m just going to determine which indicator is more prevalent within high returns  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c2d780b4d7e39003d649d55' id='5c2d780b4d7e39003d649d55'>
<a href='#5c2d780b4d7e39003d649d55'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ed38379b1e7efbfb0006f8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fe429093818ef2b5c8f29dc274a188b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ed38379b1e7efbfb0006f8'>Karl Mun</a>
</div>
<a UTCms='1546483723000' class='quanto-date posted-at response-posted-at' href='#5c2d780b4d7e39003d649d55'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Thanh Duong,</p>

<p>One <a href="https://twitter.com/chanep/status/1080455778543325184" rel="nofollow">tweet by Earnest Chan</a> on Mean-Variance optimisation may be of interest to you :)</p>

<p>ps: Reference paper <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3300976" rel="nofollow">Optimized Fundamental Portfolios</a> abstract.. using &quot;a fundamentals-based returns model in conjunction with classic mean-variance portfolio optimization and find that portfolio optimization combined with fundamental analysis offers substantial improvements in portfolio performance over either fundamental analysis or portfolio optimization alone. Long-only mean-variance optimized fundamental portfolios produce CAPM alphas of over 3.2% per quarter and 5-factor alphas of over 2.2% per quarter, with high Sharpe and Information ratios.&quot;</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c2e47e171352751be90fbcd' id='5c2e47e171352751be90fbcd'>
<a href='#5c2e47e171352751be90fbcd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1546536929000' class='quanto-date posted-at response-posted-at' href='#5c2e47e171352751be90fbcd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey Karl, </p>

<p>This is fascinating. Thanks a lot for sharing! I will play around with it. Have you tested it out yet?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c2e7d603fb2d6004648a76b' id='5c2e7d603fb2d6004648a76b'>
<a href='#5c2e7d603fb2d6004648a76b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1546550624000' class='quanto-date posted-at response-posted-at' href='#5c2e7d603fb2d6004648a76b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s some preliminary work, in which I made a data frame with the return, operating assets growth, financing growth, roe, and book to market value. </p>

<p>However, in the research, their regression model is a five years time series updated every month, not a cross-section. Right now, I only know how to queue data from one previous period by using the function:  </p>

<pre><code>  class Previous(CustomFactor):  
    # Returns value of input x trading days ago where x is the window_length  
    # Both the inputs and window_length must be specified as there are no defaults  
      def compute(self, today, assets, out, inputs):  
          out[:] = inputs[0]  
</code></pre>

<p>Karl, do you know how to get historical data for different periods in the past?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c2f681ad4bc56004378e632' id='5c2f681ad4bc56004378e632'>
<a href='#5c2f681ad4bc56004378e632'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ed38379b1e7efbfb0006f8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fe429093818ef2b5c8f29dc274a188b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ed38379b1e7efbfb0006f8'>Karl Mun</a>
</div>
<a UTCms='1546610714000' class='quanto-date posted-at response-posted-at' href='#5c2f681ad4bc56004378e632'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Thanh Duong,</p>

<p>Previous(CustomFactor) is versatile to customise for user-defined periods in Pipeline, for example:</p>

<pre><code>period = 5 # say 5 years

for n in range(0, period):  
    wL = 252 * n + 1 # Note: wL = 1 at n = 0 is equivalent to .latest  
    net_income = Previous(inputs=[Fundamentals.net_income_income_statement], window_length=wL, mask=my_universe)  
    pipe.add(net_income, &#39;netIncome&#39;+str(n))  
    return pipe

class Previous(CustomFactor):  
    window_safe = True  
    def compute(self, today, assets, out, inputs):  
        out[:] = inputs[0]  
</code></pre>

<p>As for mean-variance optimization, I have tried to make it work but found it tenuous and unpredictable - try Quantopian&#39;s multivariate Optimize API that is very effective and highly customisable :)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c2fef4f21fe3b0046990606' id='5c2fef4f21fe3b0046990606'>
<a href='#5c2fef4f21fe3b0046990606'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5924fb11043b59000ff634dd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d0f6e75f7548a9d3eff034fa09c4b0f9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5924fb11043b59000ff634dd'>Thanh Duong</a>
</div>
<a UTCms='1546645327000' class='quanto-date posted-at response-posted-at' href='#5c2fef4f21fe3b0046990606'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Karl. </p>

<p>Thanks a lot for your help. I tested your code but somehow the data frame only showed netIncome0 :(. Sorry for being such a noob. I am still new to coding and would very much appreciate your help!</p>

<p>Thanks!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c302aa70eb6c451b7fee478' id='5c302aa70eb6c451b7fee478'>
<a href='#5c302aa70eb6c451b7fee478'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ed38379b1e7efbfb0006f8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fe429093818ef2b5c8f29dc274a188b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ed38379b1e7efbfb0006f8'>Karl Mun</a>
</div>
<a UTCms='1546660519000' class='quanto-date posted-at response-posted-at' href='#5c302aa70eb6c451b7fee478'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>No worries, Thanh perhaps try if my Notebook snippets are any good..</p>

<p>Hope this helps.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c436ad1709e37004aa2650e' id='5c436ad1709e37004aa2650e'>
<a href='#5c436ad1709e37004aa2650e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ed38379b1e7efbfb0006f8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fe429093818ef2b5c8f29dc274a188b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ed38379b1e7efbfb0006f8'>Karl Mun</a>
</div>
<a UTCms='1547922129000' class='quanto-date posted-at response-posted-at' href='#5c436ad1709e37004aa2650e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Thanh Duong,</p>

<p>Just recalled.. there were recent posts on the subject that may be relevant to your quest.</p>

<ul>
<li><p><a href="https://www.quantopian.com/posts/quarter-on-quarter-growth-factors#5ae9daf9cfd424595e2068d7" rel="nofollow">QonQ Growth</a> by Michael Matthews extending from an earlier post:</p></li>
<li><p><a href="https://www.quantopian.com/posts/faster-fundamental-data#59fd3bcc5efb363c71d00a83" rel="nofollow">LastFourQuarters</a> by Jamie McCorriston of Quantopian.</p></li>
</ul>

<p>Hope they are useful for reference.</p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/how-to-use-data-dot-history'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/how-to-use-data-dot-history'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#65030000010704060e251410040b110a150c040b4b060a08">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

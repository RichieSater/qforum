<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
MAD Portfolio an alternative to Markowitz?
</title>
<meta content='Markowitz style portfolio optimization is ubiquitous and the bedrock of modern portfolio theory. Though it is not without flaws... Assumes normality in returns Requires computation of a covariance matrix Requires inverting of a covariance matrix Often ends up highly concentrated in one security An alternative presented by  Konno and Yamazaki in 1991  suggested that Markowitz style portfolio optimization could be replaced/improved with a model utilizing the Mean Absolute Deviation (MAD) as a...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="yOxWQBOZ24FfQ9Xs37Oxfok/kbFf9XbkHuncriYIw+y0iiANsW8JYuZejN2QXBkKsbGy2CU5Y/+c5gfEjE2hVw==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/mad-portfolio-an-alternative-to-markowitz' property='og:url'>
<meta content='MAD Portfolio an alternative to Markowitz?' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/mad-portfolio-an-alternative-to-markowitz' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='MAD Portfolio an alternative to Markowitz?' property='og:title'>
<meta content='Markowitz style portfolio optimization is ubiquitous and the bedrock of modern portfolio theory. Though it is not without flaws... Assumes normality in returns Requires computation of a covariance matrix Requires inverting of a covariance matrix Often ends up highly concentrated in one security An alternative presented by  Konno and Yamazaki in 1991  suggested that Markowitz style portfolio optimization could be replaced/improved with a model utilizing the Mean Absolute Deviation (MAD) as a...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/mad-portfolio-an-alternative-to-markowitz">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='55cb9ffcc3c40fdfac0000a1'>
<div class='post-container' data-post-id='55cb9ffcc3c40fdfac0000a1' id='55cb9ffcc3c40fdfac0000a1'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>MAD Portfolio an alternative to Markowitz?</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/557bd955ed001022f30003e8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/13ab569823126bf80ea032e4332e73e4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/557bd955ed001022f30003e8'>James Christopher</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1439408124000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=MAD Portfolio an alternative to Markowitz?&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fmad-portfolio-an-alternative-to-markowitz%3Futm_source%3Dwebsite_share%26utm_campaign%3Dmad-portfolio-an-alternative-to-markowitz%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fmad-portfolio-an-alternative-to-markowitz%3Futm_source%3Dwebsite_share%26utm_campaign%3Dmad-portfolio-an-alternative-to-markowitz%26utm_medium%3Dlinkedin&amp;title=MAD+Portfolio+an+alternative+to+Markowitz%3F+%28James+Christopher%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class='tags tag-row'>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Finance Theory' data-tag-id='55c50e7d8d4710ec6e000002' href='/posts/tag/Finance-Theory/newest'>Finance Theory</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Show Q' data-tag-id='55c50e7d8d4710ec6e000010' href='/posts/tag/Show-Q/newest'>Show Q</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Research' data-tag-id='55c50e7d8d4710ec6e000018' href='/posts/tag/Research/newest'>Research</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Portfolio Optimization' data-tag-id='55d33f293f6ba10061000000' href='/posts/tag/Portfolio-Optimization/newest'>Portfolio Optimization</a>
</div>
<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/mad-portfolio-an-alternative-to-markowitz?utm_source=website_share&amp;utm_campaign=mad-portfolio-an-alternative-to-markowitz&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="James Christopher" />
<div class='body-text'>
<div class='body-text-container post-body'><p>Markowitz style portfolio optimization is ubiquitous and the bedrock of modern portfolio theory. Though it is not without flaws...</p>

<ul>
<li>Assumes normality in returns<br></li>
<li>Requires computation of a covariance matrix<br></li>
<li>Requires inverting of a covariance matrix<br></li>
<li>Often ends up highly concentrated in one security</li>
</ul>

<p>An alternative presented by <a href="http://web.stanford.edu/class/msande348/papers/Konno_MeanAbDev_ManSciMay91.pdf">Konno and Yamazaki in 1991</a> suggested that Markowitz style portfolio optimization could be replaced/improved with a model utilizing the Mean Absolute Deviation (MAD) as a measure of risk. Some benefits of MAD portfolio optimization they claim are it...</p>

<ul>
<li>Requires no computation or inversion of a covariance matrix<br></li>
<li>Is computationally more efficient as it solves a linear optimization vs a quadratic optimization<br></li>
<li>Does not assume normality of returns</li>
</ul>

<p>In their paper <a href="http://www.rose-hulman.edu/mathjournal/archives/2005/vol6-n2/paper3/v6n2-3pd.pdf"><em>Portfolio Optimization: MAD vs. Markowitz</em></a> Beth Bower, and Pamela Wentz show there is little significance between Markowitz and MAD portfolios. They went on to compute the tangent portfolio for both Markowitz and MAD. I stopped at the minimum variance portfolio as there is a non trivial amount of minimum variance material on Quantopian for comparison.</p>

<p>The code in the notebook is directly copyable into the IDE.  </p>
</div>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>55 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='55cba07388b233185200008c' id='55cba07388b233185200008c'>
<a href='#55cba07388b233185200008c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/557bd955ed001022f30003e8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/13ab569823126bf80ea032e4332e73e4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/557bd955ed001022f30003e8'>James Christopher</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1439408250000' class='quanto-date posted-at response-posted-at' href='#55cba07388b233185200008c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is a backtest using the code in the notebook. I chose the stocks by Googling for &#39;volatile stocks&#39; and randomly picking a few.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='55d35a892ffbaa5d3b000120' id='55d35a892ffbaa5d3b000120'>
<a href='#55d35a892ffbaa5d3b000120'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/557bd955ed001022f30003e8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/13ab569823126bf80ea032e4332e73e4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/557bd955ed001022f30003e8'>James Christopher</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1439914638000' class='quanto-date posted-at response-posted-at' href='#55d35a892ffbaa5d3b000120'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is a backtest using the same stocks as above but with equal weightings. The MAD Portfolio results in a decreased Beta, Max Drawdown, and Volatility, and increased Sharpe, and Sortino Ratios comparatively.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='55d372156fe8237b89000202' id='55d372156fe8237b89000202'>
<a href='#55d372156fe8237b89000202'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/557bd955ed001022f30003e8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/13ab569823126bf80ea032e4332e73e4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/557bd955ed001022f30003e8'>James Christopher</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1439920664000' class='quanto-date posted-at response-posted-at' href='#55d372156fe8237b89000202'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is the same backtest using a Markowitz style Minimum Variance Portfolio optimization routine I found in the Quantopain Community written by <a href="https://www.quantopian.com/users/5258725aa09fa7ebaa000024">David Edwards.</a> The MAD portfolio results in a decreased Beta, and Max Drawdown; an equal Volatility; and increased Sharpe, and Sortino Ratios comparatively.</p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='55d379e02ffbaa5d3b000267' id='55d379e02ffbaa5d3b000267'>
<a href='#55d379e02ffbaa5d3b000267'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/541c92f7db2aaa63d10002e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f3d5fc46809ef9bff5e3c170b0a3ff76?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/541c92f7db2aaa63d10002e2'>Deleted User</a>
</div>
<a UTCms='1439922659000' class='quanto-date posted-at response-posted-at' href='#55d379e02ffbaa5d3b000267'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Interesting results, it seems like there&#39;s not a huge significant (statistically) difference between MAD and Min-var.  Interesting use of NNLS, never heard about it but it seems incredibly efficient, (i&#39;ve always been using minimize when it came down to constrained optim).  After a bit research I think I understand how its used where NNLS minimizes each specific stock&#39;s risk contribution in the portfolio <a href="http://thierry-roncalli.com/download/erc.pdf">(e.g, footnote #2 and subsequent paragraph after)</a>.  </p>

<p>For the MAD portfolio, do you know why it rarely shorts any stocks?</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='55d37e085cf3fb26a8000230' id='55d37e085cf3fb26a8000230'>
<a href='#55d37e085cf3fb26a8000230'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/557bd955ed001022f30003e8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/13ab569823126bf80ea032e4332e73e4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/557bd955ed001022f30003e8'>James Christopher</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1439923723000' class='quanto-date posted-at response-posted-at' href='#55d37e085cf3fb26a8000230'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I can&#39;t speak too much to NNLS, maybe David will jump in this thread and comment. </p>

<p>You know I&#39;m not sure why it rarely shorts, my <code>_sum_check</code> function probably isn&#39;t the best constraint, as the absolute value sum can lead to a sum less than one. Though in the backtest the leverage hovered extremely close to one. Trying this with different securities did yield me more short values, and in the notebook the routine does short 9.5% of the portfolio value to FB.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='55d37f4d7f4f759322000286' id='55d37f4d7f4f759322000286'>
<a href='#55d37f4d7f4f759322000286'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/541c92f7db2aaa63d10002e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f3d5fc46809ef9bff5e3c170b0a3ff76?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/541c92f7db2aaa63d10002e2'>Deleted User</a>
</div>
<a UTCms='1439924048000' class='quanto-date posted-at response-posted-at' href='#55d37f4d7f4f759322000286'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>aha! That is precisely why.  I skimmed over that part.  An absolute sum is considered a &quot;Lintnerian&quot; short sale constraint <a href="https://books.google.ca/books?id=aOtcTEQ3DAUC&amp;pg=PA191&amp;lpg=PA191&amp;dq=Lintner%20short%20sale&amp;source=bl&amp;ots=owHHTazIlU&amp;sig=Sk4oom-EaWUAWnAgitvV_fFxoNI&amp;hl=en&amp;sa=X&amp;ved=0CB0Q6AEwAGoVChMIg6_vvaazxwIVhdCACh245QFK#v=onepage&amp;q=Lintner%20short%20sale&amp;f=false">See footnote 4</a> where he sets the assumption that any short sale amount isnt received in cash but rather the investor has to put up an equal amount as collateral. I&#39;ve had similar experiences with the Lintner short sale constraint where most weights are positive, however, I do not exactly know why it rarely shorts under this constraint so it might be a suboptimal portfolio (if all information was known).</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='55d381256fe8237b8900027f' id='55d381256fe8237b8900027f'>
<a href='#55d381256fe8237b8900027f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/557bd955ed001022f30003e8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/13ab569823126bf80ea032e4332e73e4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/557bd955ed001022f30003e8'>James Christopher</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1439924520000' class='quanto-date posted-at response-posted-at' href='#55d381256fe8237b8900027f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>So I did run a backtest without the absolute value sum and it still rarely shorts which makes me think that it may be more a function of the securities chosen. I&#39;ve also noticed that choosing a shorter look back window results in more shorts.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='55d6398ac6a92f492d0000f5' id='55d6398ac6a92f492d0000f5'>
<a href='#55d6398ac6a92f492d0000f5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5258725aa09fa7ebaa000024'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7734b86e32e834268bee6749eb322fb4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5258725aa09fa7ebaa000024'>David Edwards</a>
</div>
<a UTCms='1440102798000' class='quanto-date posted-at response-posted-at' href='#55d6398ac6a92f492d0000f5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is MAD using the sector ETFs since &#39;05. It seems to taper out of being all long when volatility increases, I&#39;m guessing that&#39;s because the absolute deviations increase, which is its measure of risk. Pretty interesting though.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='55d67e1d66fda14d450002af' id='55d67e1d66fda14d450002af'>
<a href='#55d67e1d66fda14d450002af'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/544e4e072e3b44400f000009'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/565e41a29e0bf9f2de0864ee72290186?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/544e4e072e3b44400f000009'>Rob Welsh</a>
</div>
<a UTCms='1440120352000' class='quanto-date posted-at response-posted-at' href='#55d67e1d66fda14d450002af'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I am having a problem with the optimizer used in this post. I have posted a notebook to the forum <a href="https://www.quantopian.com/posts/mad-portfolio-optimizer-problem">in this forum topic</a> to demonstrate my concern.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='55d699b7c6a92f9db3000338' id='55d699b7c6a92f9db3000338'>
<a href='#55d699b7c6a92f9db3000338'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5258725aa09fa7ebaa000024'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7734b86e32e834268bee6749eb322fb4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5258725aa09fa7ebaa000024'>David Edwards</a>
</div>
<a UTCms='1440127418000' class='quanto-date posted-at response-posted-at' href='#55d699b7c6a92f9db3000338'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I glanced over the math and did find one issue, the returns are incorrectly calculated, the optimizing routine looks fine at first glance but I did not dig into it TBH. When using log prices the returns are difference or ratio of the log prices, not the percent change. That might be a good place to start investigating further.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='55d6a25dc55ef15ee8000330' id='55d6a25dc55ef15ee8000330'>
<a href='#55d6a25dc55ef15ee8000330'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/544e4e072e3b44400f000009'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/565e41a29e0bf9f2de0864ee72290186?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/544e4e072e3b44400f000009'>Rob Welsh</a>
</div>
<a UTCms='1440129635000' class='quanto-date posted-at response-posted-at' href='#55d6a25dc55ef15ee8000330'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@David<br>
I didn&#39;t notice that the link to my notebook which shows the issue with the optimizer didn&#39;t post. I have corrected that issue with the link in my previous posting. I believe that <a href="https://www.quantopian.com/posts/mad-portfolio-optimizer-problem">my notebook</a> demonstrates a problem with the optimizer. Two different optimizers have two different results. In the instance that I captured, results from the current NNLS optimizer appear to be incorrect. It&#39;s an intermittent problem dependent upon the characteristics of the windowed securities prices utilized at the time. I believe that the failure may occur with the same securities at different points in their price history.</p>

<p>I agree with you that the handling of the math with the logarithms is a concern. That&#39;s a good catch.</p>

<p>However, I am also concerned about potential failure of the optimizer if used in an online manner based upon my findings.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='55d734d4fa0d8cd5f700076c' id='55d734d4fa0d8cd5f700076c'>
<a href='#55d734d4fa0d8cd5f700076c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/544e4e072e3b44400f000009'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/565e41a29e0bf9f2de0864ee72290186?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/544e4e072e3b44400f000009'>Rob Welsh</a>
</div>
<a UTCms='1440167128000' class='quanto-date posted-at response-posted-at' href='#55d734d4fa0d8cd5f700076c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@David<br>
I replaced the percent change with the difference of the log prices and ran the backtest. Here are the results. It doesn&#39;t beat the benchmark for return any more, but the metrics look better.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5672c56225d0ed32ce0000e7' id='5672c56225d0ed32ce0000e7'>
<a href='#5672c56225d0ed32ce0000e7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1450362215000' class='quanto-date posted-at response-posted-at' href='#5672c56225d0ed32ce0000e7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>James, David, Rob<br>
Please excuse my laziness.  While I am ploughing my way through various guides on constrained optimisation may I ask a few specific questions about this particular MAD Portfolio optimisation?</p>

<p>What is the best way to impose the following additional constraints/provisions:</p>

<ol>
<li>Maximum and minimum boundaries for weights BY INSTRUMENT. In other words <strong>not</strong> an overall boundary of say 0 to 1 on all instruments <strong>but 0 to 0.15 on some and by way of example 0 to 1 on others</strong>.<br></li>
<li><strong>A target for the object of minimisation itself</strong> (IE the MAD of the portfolio). EG as with Markowitz you might want to target a specific volatility (or MAD) range. Rather than just getting the minimum variance or MAD portfolio.<br></li>
<li> It is probably worth looking at the equivalent of semi-deviation here rather than deviation. In other words minimize or target a specific MAD for downward deviation only.</li>
</ol>

<p>I&#39;ll probably have some other thoughts as I work through the example but thanks to the Q team for bringing it up and coding it. This is a wonderful forum.</p>

<p>I suppose it is not entirely a surprise that so little attention has been focussed by the community in general on this post or other posts discussing portfolio optimisation.</p>

<p>In general, the vast majority of people in on-line trading forums quite understandably want to ape the hedge fund giants and seek outsize returns from minuscule starting  capital.  Usually using leverage.</p>

<p>Sadly, history tells us that the vast majority of such &quot;racy&quot; trading schemes are doomed to failure in the long term.  Too few of us concentrate on risk control. Too few of us are interested in the dull low volatility returns achieved by back tests of schemes such as MAD.</p>

<p>History tells us that even MAD and other portfolio asset allocation schemes will meet their black swans in due course. But at least a loss of all capital is unlikely, even in a 1929 situation.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='567306a625d0edc775000115' id='567306a625d0edc775000115'>
<a href='#567306a625d0edc775000115'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1450378921000' class='quanto-date posted-at response-posted-at' href='#567306a625d0edc775000115'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Slowly getting there. Here is the code to add bounds to the whole 9 asset portfolio:  </p>

<pre><code>   bnds= [(0, 1)]*9  
    cons = {&#39;type&#39;:&#39;eq&#39;, &#39;fun&#39;: _sum_check}  
    min_mad_results = minimize(_mad, guess, args=returns, bounds=bnds, constraints=cons)  
</code></pre>

<p>No doubt tomorrow I&#39;ll manage the rest......  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5673234a25d0edc775000211' id='5673234a25d0edc775000211'>
<a href='#5673234a25d0edc775000211'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1450386253000' class='quanto-date posted-at response-posted-at' href='#5673234a25d0edc775000211'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Separate bounds for each stock in the portfolio:  </p>

<pre><code>def _mad(x, returns):  
        return (returns - returns.mean()).dot(x).abs().mean()  
    num_assets = len(returns.columns)  
    guess = np.ones(num_assets)  
    bnds= [(0, 1),(0, 1),(0, 1),(0, 1),(0, 1),(0, 1),(0, 1),(0, 1),(0, 1)]  
    cons = {&#39;type&#39;:&#39;eq&#39;, &#39;fun&#39;: _sum_check}  
    min_mad_results = minimize(_mad, guess, args=returns, bounds=bnds, constraints=cons)  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5673327ae5a4a5068600015e' id='5673327ae5a4a5068600015e'>
<a href='#5673327ae5a4a5068600015e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/557bd955ed001022f30003e8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/13ab569823126bf80ea032e4332e73e4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/557bd955ed001022f30003e8'>James Christopher</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1450390143000' class='quanto-date posted-at response-posted-at' href='#5673327ae5a4a5068600015e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Glad you like it!</p>

<p>I see that you found your way to setting the bounds, so that is great. In answer to your question about setting a target deviation that is definitely possible: minimize the absolute value of the target deviation minus the current iteration&#39;s mean deviation. </p>

<pre><code># Computes the weights for the portfolio with the smallest Mean Absolute Deviation  
def minimum_MAD_portfolio(returns, deviation_target):  

    def _sum_check(x):  
        return sum(x) - 1  

    # Computes the Mean Absolute Deviation for the current iteration of weights  
    def _mad(x, returns, deviation_target):  
        return abs(deviation_target - (returns - returns.mean()).dot(x).abs().mean())  

    num_assets = len(returns.columns)  
    guess = np.ones(num_assets)  
    bnds= [(0, 1),(0, 1),(0, 1),(0, 1),(0, 1),(0, 1),(0, 1),(0, 1),(0, 1)]  
    cons = {&#39;type&#39;:&#39;eq&#39;, &#39;fun&#39;: _sum_check}  
    min_mad_results = minimize(_mad, guess, args=(returns, deviation_target), bounds=bnds, constraints=cons)  
    return pd.Series(index=returns.columns, data=min_mad_results.x)  
</code></pre>

<p>With just the downside deviation I imagine you could do something like <code>returns[returns &lt; 1]</code> and feed that into the minimizer as one of the args.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='567357a2743988eac100007c' id='567357a2743988eac100007c'>
<a href='#567357a2743988eac100007c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/557bd955ed001022f30003e8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/13ab569823126bf80ea032e4332e73e4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/557bd955ed001022f30003e8'>James Christopher</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1450399656000' class='quanto-date posted-at response-posted-at' href='#567357a2743988eac100007c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is an implementation using the just downside deviations...</p>

<p><strong>See my response correcting the typo in the code below.</strong>  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5673647a3172ccf9650000d7' id='5673647a3172ccf9650000d7'>
<a href='#5673647a3172ccf9650000d7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1450402944000' class='quanto-date posted-at response-posted-at' href='#5673647a3172ccf9650000d7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I like the local functions within a function using the convention of function name starting with underscore.</p>

<p>Hits a maximum leverage of 1.45 early, on 2005-07-15 so it might be fairly easy to address for anyone interested in doing so.<br>
Might have happened on only one frame and then recovered right away yet is significant because it means $1,450,000 is needed to achieve that result rather just $1M and the return per dollar used is lower than shown.<br>
Not visible on the custom chart. Ah, I see, not due to smoothing in this case, instead I think because record() is daily level.</p>

<p>Here are 4 lines that can be easily dropped into handle_data() to catch maximum leverage even when minute level, at least within a day:</p>

<pre><code>def handle_data(context, data):

    if &#39;max_lvrg&#39; not in context: context.max_lvrg = 0 # init this instead in initialize() for better efficiency  
    if context.account.leverage &gt; context.max_lvrg:  
        context.max_lvrg = context.account.leverage  
        record(mx_lvrg = context.account.leverage)      # take time for this new record only when there is a change

</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5673cc5b7b6c8bac8f000072' id='5673cc5b7b6c8bac8f000072'>
<a href='#5673cc5b7b6c8bac8f000072'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1450429537000' class='quanto-date posted-at response-posted-at' href='#5673cc5b7b6c8bac8f000072'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Very, very early days for me on this algo but herewith an amusing back test of the semi_deviation model incorporating volatility targeting.  Thank you James.Thank you garyha - yes, I must get to the bottom of controlling leverage on Quantopian.</p>

<p>You will note that the system shown incorporate boundaries equal to all instruments of (0,1) and includes two additions to the portfolio - they are bond funds and so help the dash to safety in troubled times.</p>

<p>I far prefer this approach to volatility dampening rather than using shorting.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56d2180cf8e5da104900012c' id='56d2180cf8e5da104900012c'>
<a href='#56d2180cf8e5da104900012c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530dc58192f94a48e80002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6a81c3996de61b5880d979f288a9a743?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530dc58192f94a48e80002b6'>Mikko M</a>
</div>
<a UTCms='1456609296000' class='quanto-date posted-at response-posted-at' href='#56d2180cf8e5da104900012c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Isn&#39;t the downside deviation part incorrect at the latest posted algos? I mean the returns&lt;1 part here? returns is pct_change of history therefore it&#39;s taking everyhting under 100% (meaning probably every bar)</p>

<p>min_mad_results = minimize(_mad, guess, args=returns[returns &lt; 1], constraints=cons)</p>

<p>The filter above also leaves the data full of NaNs even if the number would be correct..  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56d21bf6e408a685e800012c' id='56d21bf6e408a685e800012c'>
<a href='#56d21bf6e408a685e800012c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1456610300000' class='quanto-date posted-at response-posted-at' href='#56d21bf6e408a685e800012c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>1 would be flat less than one a negative return.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56d21d7743328be3f600016c' id='56d21d7743328be3f600016c'>
<a href='#56d21d7743328be3f600016c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530dc58192f94a48e80002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6a81c3996de61b5880d979f288a9a743?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530dc58192f94a48e80002b6'>Mikko M</a>
</div>
<a UTCms='1456610685000' class='quanto-date posted-at response-posted-at' href='#56d21d7743328be3f600016c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m not sure what you mean by that but returns is history(...).pct_change().dropna() (= pandas dataframe) and returns[returns &lt; 1]  as used here returns all points where percentage change is under 100% (per day) and returns all other points as NaN (it&#39;s 2 dimensional table with dates as index and securities as columns). I don&#39;t even think the _mad() calculation would work with NaNs all over the dataframe (numpys mean() returns nan if any element of calculation is nan).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56d21f2643328be3f6000182' id='56d21f2643328be3f6000182'>
<a href='#56d21f2643328be3f6000182'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1456611117000' class='quanto-date posted-at response-posted-at' href='#56d21f2643328be3f6000182'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Then I guess you should redraft it and post a correct solution.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56d220bcde4713f9100001a7' id='56d220bcde4713f9100001a7'>
<a href='#56d220bcde4713f9100001a7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530dc58192f94a48e80002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6a81c3996de61b5880d979f288a9a743?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530dc58192f94a48e80002b6'>Mikko M</a>
</div>
<a UTCms='1456611522000' class='quanto-date posted-at response-posted-at' href='#56d220bcde4713f9100001a7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Sure, I just wanted to make sure I didn&#39;t misunderstood some part of the calculation before posting but here is a version  where only downside changes are calculated.</p>

<p>As the whole idea of the calculation is to optimize the volatility from mean I&#39;m not totally sure how beneficial it is to calculcate only the downside part of the mean but we&#39;ll see in couple of minutes (the backtest I attached is still running).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56d27af443328be3f60004d8' id='56d27af443328be3f60004d8'>
<a href='#56d27af443328be3f60004d8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/557bd955ed001022f30003e8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/13ab569823126bf80ea032e4332e73e4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/557bd955ed001022f30003e8'>James Christopher</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1456634616000' class='quanto-date posted-at response-posted-at' href='#56d27af443328be3f60004d8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Mikko</p>

<p>Yup. That returns less than 1 is a typo. Here is a version that is corrected to using less than 0.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='56d2d8b0de4713f9100006c1' id='56d2d8b0de4713f9100006c1'>
<a href='#56d2d8b0de4713f9100006c1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1456658613000' class='quanto-date posted-at response-posted-at' href='#56d2d8b0de4713f9100006c1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s a working link to the paper:</p>

<p><a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.176.6746&amp;rep=rep1&amp;type=pdf">http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.176.6746&amp;rep=rep1&amp;type=pdf</a></p>

<p>The link in the original post doesn&#39;t work.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56dadeb4410ca74d930003d7' id='56dadeb4410ca74d930003d7'>
<a href='#56dadeb4410ca74d930003d7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1457184440000' class='quanto-date posted-at response-posted-at' href='#56dadeb4410ca74d930003d7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Just curious...is this a Q hedge fund viable strategy?  James&#39; recent post has beta = 0.1 &amp; sharpe = 1.02, with decent returns.  What&#39;s missing?  Or is it good to go?  I&#39;m wondering if it&#39;d be worth fiddling with it, and submitting to the contest or running it for 6 months separately and then sending to the Q fund committee for evaluation?  Or since it uses ETFs, would it be rejected out of hand, since the desire seems to be the long-short algos with lots of individual securities?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56daeca5dfeb8fc4d40003c3' id='56daeca5dfeb8fc4d40003c3'>
<a href='#56daeca5dfeb8fc4d40003c3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530dc58192f94a48e80002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6a81c3996de61b5880d979f288a9a743?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530dc58192f94a48e80002b6'>Mikko M</a>
</div>
<a UTCms='1457188009000' class='quanto-date posted-at response-posted-at' href='#56daeca5dfeb8fc4d40003c3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant, </p>

<p>You should note that the values (sharpe, etc) and curves you see here are without commission/slippage.. The picture is quite different if you set the algo to default commission/slippage.</p>

<p>I didn&#39;t note that using ETFs is a negative thing for the fund, why do you think that it is? It&#39;s quite understandable that over 1 leveraged etfs are issue because the laccount everage doesn&#39;t reveal the actual leverage anymore.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56daf2575e0720171f0003aa' id='56daf2575e0720171f0003aa'>
<a href='#56daf2575e0720171f0003aa'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/557bd955ed001022f30003e8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/13ab569823126bf80ea032e4332e73e4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/557bd955ed001022f30003e8'>James Christopher</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1457189467000' class='quanto-date posted-at response-posted-at' href='#56daf2575e0720171f0003aa'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant</p>

<p>Mikko is right, with slippage taken into account this algo does poorly at this level of capital. (It trades lots of capital on a handful of securities everyday) Overall, using ETFs doesn&#39;t exclude any algorithm from the Quantopian fund.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='56daf3f372047781330003dc' id='56daf3f372047781330003dc'>
<a href='#56daf3f372047781330003dc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1457189880000' class='quanto-date posted-at response-posted-at' href='#56daf3f372047781330003dc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>As drafted it trades daily. No wonder slippage and com mount up! Try monthly.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56daf6ea410ca74d93000484' id='56daf6ea410ca74d93000484'>
<a href='#56daf6ea410ca74d93000484'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1457190638000' class='quanto-date posted-at response-posted-at' href='#56daf6ea410ca74d93000484'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Interesting that slippage kills it.  I would think that these are whopping big sector ETFs and that rebalancing a $1M portfolio daily wouldn&#39;t be a big deal.  Regarding commissions, if the strategy were part of a big pot of hedge fund money, say $50M-$100M, I&#39;d think they&#39;d be negligible, no?</p>

<p>When I get the chance, maybe I&#39;ll read the paper and play with the algo, since perhaps it has legs.</p>

<p>Let me re-phrase my question.  Assuming that commissions and slippage are negligible, would this be an attractive strategy for the hedge fund?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56daf839afffe5ad9c0004c0' id='56daf839afffe5ad9c0004c0'>
<a href='#56daf839afffe5ad9c0004c0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1457190977000' class='quanto-date posted-at response-posted-at' href='#56daf839afffe5ad9c0004c0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Note that turnover would reduce and allocations would be more stable if the optimization was bootstrapped over subsamples.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56db0068dfeb8fc4d400045d' id='56db0068dfeb8fc4d400045d'>
<a href='#56db0068dfeb8fc4d400045d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1457193068000' class='quanto-date posted-at response-posted-at' href='#56db0068dfeb8fc4d400045d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Simon,</p>

<p>Thanks for pointing that out.  I&#39;d started playing around with that approach.  The optimization can be run every minute, and the resulting portfolio vectors stored, and then averaged on a rolling basis.  At least that&#39;s my interpretation of bootstrapping over subsamples.  Then when the re-allocation is applied daily/weekly/monthly, it&#39;ll be smoothed over a trailing window of allocations.  Coolamundo!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56db0590c3ccef0a7500000f' id='56db0590c3ccef0a7500000f'>
<a href='#56db0590c3ccef0a7500000f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1457194392000' class='quanto-date posted-at response-posted-at' href='#56db0590c3ccef0a7500000f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Yeah, I meant boot strapping where you draw random samples of the returns vector and optimize just on the samples and average the results, not rolling averaging per se.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56db0663a488b97b9c00001b' id='56db0663a488b97b9c00001b'>
<a href='#56db0663a488b97b9c00001b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/557bd955ed001022f30003e8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/13ab569823126bf80ea032e4332e73e4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/557bd955ed001022f30003e8'>James Christopher</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1457194600000' class='quanto-date posted-at response-posted-at' href='#56db0663a488b97b9c00001b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;d be hesitant to say this is the kind of algo we want in the fund. I say that because the algo doesn&#39;t really demonstrate any predictive capability. It uses a fixed universe and simply adjusts exposure. There isn&#39;t really any signal generating power due to some underlying model. The algo demonstrates more of the &quot;how to hold?&quot; vs the &quot;what to hold?&quot; question. </p>

<p>That being said a bootstrapped version of the long only version that Anthony created with the bond ETFs could potentially be a good algo to trade with Robinhood.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='56db31f6a488b97dc60001c6' id='56db31f6a488b97dc60001c6'>
<a href='#56db31f6a488b97dc60001c6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530dc58192f94a48e80002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6a81c3996de61b5880d979f288a9a743?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530dc58192f94a48e80002b6'>Mikko M</a>
</div>
<a UTCms='1457205758000' class='quanto-date posted-at response-posted-at' href='#56db31f6a488b97dc60001c6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Just for informative purposes, here is Anthonys latest algo with default slippage and commission (I just cloned the algo and commented commission/slippage commands)</p>

<p>James, by the way the latest returns[returns &lt; 0] version you posted is still not correct if you allow short positions and want to only calculate negative volatility. If you allow shorts those returns &lt; 0 will become positive and will be calculated. Check of returns &lt; 0 should not be  applied before dot(..) as dot doesn&#39;t work with sparse matrixes that returns &lt; 0 gives. You will get  NaN for any day where  return of <em>any</em> security is &gt; 0 so your final value .abs().mean() will be calculated only from days where return for every security is &lt; 0.</p>

<p>NaN problem can be solved by using mul(....).sum(axis=1) instead of dot() as sum just ignores NaNs and whole row doesn&#39;t become nan as in dot.</p>

<p>So the whole negative returns - only calculation would be</p>

<p>dfp = returns.mul(x)<br>
dfp = dfp[dfp &lt; 0]<br>
(dfp - dfp.mean()).sum(axis=1).abs().mean()</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56db47e8e20e1c5deb0001ef' id='56db47e8e20e1c5deb0001ef'>
<a href='#56db47e8e20e1c5deb0001ef'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1457211377000' class='quanto-date posted-at response-posted-at' href='#56db47e8e20e1c5deb0001ef'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>Yeah, I meant boot strapping where you draw random samples of the returns vector and optimize just on the samples and average the results, not rolling averaging per se.</p>
</blockquote>

<p>@Simon, you&#39;d mentioned this approach before, I recall.  Is there an advantage in drawing random returns samples (picked from a trailing window) compared to running the optimization on a rolling basis, as I describe?  Is it just a matter of computational efficiency to do the sampling, yielding essentially the same result as a rolling optimization?  Or is there something more subtle?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56f6b65ca86fdd0b120003de' id='56f6b65ca86fdd0b120003de'>
<a href='#56f6b65ca86fdd0b120003de'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1459009128000' class='quanto-date posted-at response-posted-at' href='#56f6b65ca86fdd0b120003de'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Mikko Mattila<br>
Many thanks for all your work and comments on this. I&#39;m afraid my work on this algo and comments so far have been very cursory and off the cuff. I do not short ETFs hence I was unconcerned with the problem you outlined, nonetheless it makes obvious sense to make the corrections you suggested even if only for the sake of completeness.</p>

<p>I am going to take a closer look at this thing with and without semi deviation. I note Rob Welsh&#39;s concern with the optimiser but have not looked into the problem myself yet.</p>

<p>I am also totally perplexed by the idea of DAILY optimisation.  Why in god&#39;s name would anyone want to take on that sort of commission and slippage for a scheme such as this which seems designed for long term investment not short term trading. Another factor is that monthly re-allocation would let profits run.</p>

<p>Anyway, enough. I must do some work on this and come back with further thoughts.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56f6be2c9ce79b75f90002f2' id='56f6be2c9ce79b75f90002f2'>
<a href='#56f6be2c9ce79b75f90002f2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1459011123000' class='quanto-date posted-at response-posted-at' href='#56f6be2c9ce79b75f90002f2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Rob Welsh<br>
I believe I am correct in saying that making this change in your notebook ironed out the difference between the two scipy optimize algos?  </p>

<blockquote>
<p>I replaced the percent change with the difference of the log prices and ran the backtest.  </p>
</blockquote>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56f6cd8694d606ae9000080e' id='56f6cd8694d606ae9000080e'>
<a href='#56f6cd8694d606ae9000080e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1459015050000' class='quanto-date posted-at response-posted-at' href='#56f6cd8694d606ae9000080e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>James</p>

<blockquote>
<p>I say that because the algo doesn&#39;t really demonstrate any predictive capability. It uses a fixed universe and simply adjusts exposure. </p>
</blockquote>

<p>I&#39;m not at all sure about that one. The whole point of Markowitz and/or MAD is to make &quot;predictions&quot;. Markowitz was expecting punters to make a one time guess as to the future returns and vol of portfolio components. Modern algos at least use historic returns and vol and then repeat the calculations periodically. As per your algo here.</p>

<p>If you target vol you are predicting that future returns will look somewhat like the past (or at least the past 200 days as in your algo). Agreed of course that you are merely adjusting exposure if you trade this model with a fixed portfolio of ETFs but that is still prediction.</p>

<p>By way of example you target annualised volatility of say 16% and &quot;predict&quot; high returns for relatively high volatility. Or you target 5% vol for &quot;predicted&quot; bond like returns.</p>

<p>I am increasingly perplexed by conversations about including and excluding trading / investment styles and instruments. The distinctions are so often meaningless and counter productive. </p>

<p>At least where &quot;probability&quot; type trading and investment are concerned. And this forum is concerned with &quot;probability&quot; trading.</p>

<p>HFT by contrast uses (or so I am told) many techniques such as arbitrage and legal (?) front running.   There you really are talking a very different animal. And haven&#39;t they done well?</p>

<p>But what about hedge funds in general? In general they have been a disappointment: for all the hype HFs have not lived up to the promise of absolute return over the past 20 years. With few exceptions, &quot;all weather&quot; portfolios have proved elusive.</p>

<p>I very much doubt that this forum will come up with anything superior (over the long term) to the simple Markowitz type approach typified by the example in this thread.</p>

<p>Call me sceptical but the vast majority of trading talk is so much BS. And curve fitting.</p>

<p>My serious point is that as an investor I would probably look towards a simple approach along the lines of this thread. I don&#39;t think in the long run there will be many other HF techniques which will do much better. In general, investment will give you market returns. You can boost those by leverage at the expense of higher volatility. You can cut draw down by techniques outlined in this and other threads.</p>

<p>But you won&#39;t come up with any magic bullet, predictive or otherwise. Unless you trade arbitrage or some other game such as front running where the odds are heavily loaded in your favour.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56fbfde57f5cc5fa2f000271' id='56fbfde57f5cc5fa2f000271'>
<a href='#56fbfde57f5cc5fa2f000271'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1459355115000' class='quanto-date posted-at response-posted-at' href='#56fbfde57f5cc5fa2f000271'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>There are definitely further problems with this algorithm. It is simply not working as expected. </p>

<p>Let us take the target deviation model for a start. As we know from a &quot;normal&quot; Markowitz type optimisation scheme , there will be a whole bullet shaped set of returns and deviations for any one period calculation, made up by using many different weight combinations.</p>

<p>Therefore it is no good just setting a target deviation. One has to find the target deviation which actual sits on the efficient portfolio line. You can do this by turning the optimisation around: maximise return but limit volatility as a constraint.</p>

<p>Leaving that aside, there seems to be a problem with the basic scipy.optimise.minimise routine as drafted. </p>

<p>I used Excel to generate 15,000 random weightings on a single period of returns and MADs for three stocks. The minimum absolute deviation came out around 0.004 on the brute force approach. Even if I had used 100,000 random weightings, the results would be similar.</p>

<p>Using the code in this algo however totally failed to find the minimum: it came up with 0.008.</p>

<p>I guess I ought to code the brute force approach in Python  and combine it with the algo in a Notebook and post it here.  One problem may be that MAD is not strictly speaking a convex problem? The scatter plot does not show a smooth efficiency curve - or as least not to the extent you get with the normal co-var optimisation. I notice others have had similar problems with scipy optimise in traditional Markowitz set ups however. See Joel Hubert&#39;s comments here:<br>
<a href="https://www.quantopian.com/posts/markowitz-portfolio-construction">Markowitz Portfolio Construction</a></p>

<p>One problem is that the Scipy documentation is absolutely useless. </p>

<p>Anyway it is worth getting this right.</p>

<p>If scipy optimise can not not be made to work as expected then either:</p>

<p>a) use a brute force approach but using a random seed for repeatability (costly); or<br>
b) revert to the Critical Line Algo; or<br>
c) use a closed form solution?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56fc3581f1e1ed48f6000141' id='56fc3581f1e1ed48f6000141'>
<a href='#56fc3581f1e1ed48f6000141'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1459369349000' class='quanto-date posted-at response-posted-at' href='#56fc3581f1e1ed48f6000141'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is a link to the brute force spreadsheet I created:<br>
<a href="http://anthonyfjgarner.net/returns/">MAD Spreadsheet</a></p>

<p>Can you use Scipy Optimise Brute on multiple weights? I&#39;m not sure. The documentation is not very explicit. Anyway this spreadsheet suffices for the purpose and shows the tickers, returns etc used.</p>

<p>Click on &quot;returns&quot; and it will download.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56fc38d44949ca2db90000f0' id='56fc38d44949ca2db90000f0'>
<a href='#56fc38d44949ca2db90000f0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1459370203000' class='quanto-date posted-at response-posted-at' href='#56fc38d44949ca2db90000f0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is the Notebook code adapted from Rob Welsh&#39;s Notebook. Data taken from Yahoo.</p>

<pre><code>Tickers=[&#39;EWC&#39;,&#39;F&#39;,&#39;C&#39;]  
data =  np.log(get(Tickers, start=&#39;2014-01-01&#39;))  
returns = (data - data.shift(1)).dropna()

# Computes the weights for the portfolio with the smallest Mean Absolute Deviation.  
def minimum_MAD_portfolio(returns):  
    def _sum_check(x):  
        return sum(abs(x)) - 1  
    # Computes the Mean Absolute Deviation for the current iteration of weights  
    def _mad(x,returns):  
        return (returns - returns.mean()).dot(x).abs().mean()  

    def _performance(x,returns):  
        return returns.mean().dot(x).mean()  
    num_assets = len(returns.columns)  
    guess = np.ones(num_assets)  
    cons = {&#39;type&#39;:&#39;eq&#39;, &#39;fun&#39;: _sum_check}  
    min_mad_results = minimize(_mad, guess, args=returns, constraints=cons, options={&#39;disp&#39;:True})  
    return pd.Series(index=returns.columns, data=min_mad_results.x)

weights = minimum_MAD_portfolio(returns)  
print (&#39;\n&#39;, weights)  
</code></pre>

<p>And here are the results:</p>

<pre><code>Optimization terminated successfully.    (Exit mode 0)  
            Current function value: 0.00806300687814  
            Iterations: 8  
            Function evaluations: 40  
            Gradient evaluations: 8

ewc    0.669923  
f          0.283561  
c         0.046516  
dtype: float64  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56fe42a2329fc61b0e000694' id='56fe42a2329fc61b0e000694'>
<a href='#56fe42a2329fc61b0e000694'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530dc58192f94a48e80002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6a81c3996de61b5880d979f288a9a743?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530dc58192f94a48e80002b6'>Mikko M</a>
</div>
<a UTCms='1459503786000' class='quanto-date posted-at response-posted-at' href='#56fe42a2329fc61b0e000694'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>Leaving that aside, there seems to be a problem with the basic<br>
scipy.optimise.minimise routine as drafted.  </p>

<p>I used Excel to generate 15,000 random weightings on a single period<br>
of returns and MADs for three stocks. The minimum absolute deviation<br>
came out around 0.004 on the brute force approach. Even if I had used<br>
100,000 random weightings, the results would be similar.  </p>

<p>Using the code in this algo however totally failed to find the<br>
minimum: it came up with 0.008.  </p>

<p>I guess I ought to code the brute force approach in Python and combine<br>
it with the algo in a Notebook and post it here. One problem may be<br>
that MAD is not strictly speaking a convex problem? The scatter plot<br>
does not show a smooth efficiency curve - or as least not to the<br>
extent you get with the normal co-var optimisation. I notice others<br>
have had similar problems with scipy optimise in traditional Markowitz<br>
set ups however. See Joel Hubert&#39;s comments here: Markowitz Portfolio<br>
Construction  </p>

<p>One problem is that the Scipy documentation is absolutely useless.</p>
</blockquote>

<p>Scipy optimization is not useless per se, you just have to undestand how it works. It&#39;s a gradient algorithm (I think? it&#39;s from Kraft / Sequential quadratic programming if someone wants to look at the paper) that looks for local minima so it&#39;s important to have some idea on what good initial guess would be.</p>

<p>You can use basinhopping to find global minima (ie. to escape local minima) but for that it would be good thing to know few things about fitness landscape ie rought estimate on what is the distance of the peaks. In situations where the fitness lanscape is not known I have used totally random shuffle to hop from one point to another. It&#39;s bascically a glorified brute force as it takes random point and then uses SLSQP to solve it. Solving global minima for N dimensional space in reasonable time is not exactly the easiest thing in the world to do. </p>

<p><a href="http://docs.scipy.org/doc/scipy-0.16.0/reference/generated/scipy.optimize.basinhopping.html">http://docs.scipy.org/doc/scipy-0.16.0/reference/generated/scipy.optimize.basinhopping.html</a></p>

<p>(Some info about optimization and fitness landscapes in general)
<a href="http://www.turingfinance.com/fitness-landscape-analysis-for-computational-finance/">http://www.turingfinance.com/fitness-landscape-analysis-for-computational-finance/</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56fec492329fc67910000b38' id='56fec492329fc67910000b38'>
<a href='#56fec492329fc67910000b38'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1459537051000' class='quanto-date posted-at response-posted-at' href='#56fec492329fc67910000b38'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Mikko Mattila<br>
Many thanks indeed for the tips. I am one of those people who is completely obsessive and has to work out precisely how things work!  It looks to me as if my quasi brute force approach is rather useful after all but I very much appreciate the explanations and additional reading material.  </p>

<p>I take it we are agreed at least that as drafted the algorithm contained in this thread is not &quot;fit for purpose&quot;?</p>

<blockquote>
<p>so it&#39;s important to have some idea on what good initial guess would be</p>
</blockquote>

<p>Understood. And this is all well and good for a single period optimisation but I fear it would not be possible to make a good guess for each period in a back test.</p>

<p>The major problem here with the MAD (as opposed to the standard Mean Variance optimisation) is perhaps that the &quot;efficient frontier&quot; is jagged in the former and smooth in the latter. In the latter the global minimum is likely to be the same as the single local minimum.  Not so perhaps with MAD.</p>

<p>Actually of course what I really need to do is to go back and read the papers quoted in James Christopher&#39;s first post above and see what method they used to find the global minimum.</p>

<p>If the &quot;efficient frontier&quot; is jagged then I assume using the Critical Line algo would be a mistake.</p>

<p>Call me anal and slow but I do like to investigate properly.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56fec9f5329fc67910000b5f' id='56fec9f5329fc67910000b5f'>
<a href='#56fec9f5329fc67910000b5f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1459538428000' class='quanto-date posted-at response-posted-at' href='#56fec9f5329fc67910000b5f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>In their paper Portfolio Optimization: MAD vs. Markowitz Beth Bower, and Pamela Wentz  use a hunt and peck approach using Excel.</p>

<blockquote>
<p>Using the Excel<br>
add-in called Solver, we were able to numerically minimize this value by changing our<br>
xj’s and using constraints (4.2) through (4.4). </p>
</blockquote>

<p>Not over sophisticated!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58dc7ad6a3b6223ca3b56f5d' id='58dc7ad6a3b6223ca3b56f5d'>
<a href='#58dc7ad6a3b6223ca3b56f5d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5441e3042c869f0bc00000e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/07eec08109406c6cd989e75416ffbbb8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5441e3042c869f0bc00000e2'>Jonathan Larkin</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1490844374000' class='quanto-date posted-at response-posted-at' href='#58dc7ad6a3b6223ca3b56f5d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;ve taken a recent interest in Konno&#39;s use of the L1 risk measure. To refresh the discussion on this topic, here is some updated code which relies on <code>CVXPY</code> (which I do not believe was whitelisted on Quantopian at the time of James Christopher&#39;s initial post). This routine is significantly faster than using <code>scipy.optimize</code> or related brute-force general function solvers and can even handle universe sizes on the order of the Q500US or Q1500US. The <code>alpha_vector</code> could be, for example, ranks from a pipeline expression. The L1 risk in this function is quoted in daily % units (i.e., 0.001 for 10 basis points of daily risk). </p>

<pre><code>import cvxpy as cvx  
import numpy as np

def calc_opt_L1_weights(alpha_vector, hist_returns, max_risk, max_position=0.05):

    num_stocks = len(alpha_vector)  
    num_days = len(hist_returns)  
    A = hist_returns.fillna(0.0).as_matrix()  
    x = cvx.Variable(num_stocks)  
    objective = cvx.Maximize(alpha_vector*x)

    constraints = [  
        sum(cvx.abs(A*x))/num_days &lt;= max_risk,  
        sum(x) == 0,  
        sum(cvx.abs(x)) &lt;= 1,  
        x &lt;= max_position,  
        x &gt;= -max_position  
    ]  
    prob = cvx.Problem(objective, constraints)  
    prob.solve(verbose=False)  
    print prob.value  
    sol = np.asarray(x.value).flatten()  
    return sol  
</code></pre>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='58dc885ca83b43360571bb5b' id='58dc885ca83b43360571bb5b'>
<a href='#58dc885ca83b43360571bb5b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/527612eb2de84d52740000d5'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/873c5860f8b916285b474f56cbd6f135?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/527612eb2de84d52740000d5'>Deleted User</a>
</div>
<a UTCms='1490847836000' class='quanto-date posted-at response-posted-at' href='#58dc885ca83b43360571bb5b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Jonathan,</p>

<p>You appear to be an expert in optimization. I was wondering if there is any way I can set a minimum variance threshold constraint? I have implemented this <a href="http://jmlr.org/proceedings/papers/v28/cuturi13.pdf">paper</a> but it does not fit into alpha.T* X paradigm since it uses SDP and assumes all weights are positive.</p>

<p>Would you know how I can maximize alpha but set a minimum variance threshold? something like risk &gt; 0.01?</p>

<p>Best regards,<br>
Pravin</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58dd05702603b92670153263' id='58dd05702603b92670153263'>
<a href='#58dd05702603b92670153263'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5441e3042c869f0bc00000e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/07eec08109406c6cd989e75416ffbbb8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5441e3042c869f0bc00000e2'>Jonathan Larkin</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1490879856000' class='quanto-date posted-at response-posted-at' href='#58dd05702603b92670153263'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Pravin for sharing that paper! I had not seen it and upon quick read it looks novel and promising. It&#39;s a dense paper so I have to spend some real time working through it and I can&#39;t do that in the near term. You are right though that the spirit of the paper is not consistent with the objective <code>max alpha&#39;x</code>. This is because <code>max alpha&#39;x s.t. risk &gt; y</code> simply collapses to the unconstrained <code>max alpha&#39;x</code>. The <code>risk</code> is an increasing function of <code>alpha&#39;x</code>. Hence you just optimize to maximize the alpha without the risk constraint and then, post optimization, if the resulting portfolio <code>risk</code> is greater than <code>y</code>, you have a solution; if it is not, then the problem is infeasible.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='58df937de253656fc4ddbbe6' id='58df937de253656fc4ddbbe6'>
<a href='#58df937de253656fc4ddbbe6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51d125a71144e60865000044'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b7dd86784deedc047d5ad0fb30378bdd?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51d125a71144e60865000044'>Peter Bakker</a>
</div>
<a UTCms='1491047293000' class='quanto-date posted-at response-posted-at' href='#58df937de253656fc4ddbbe6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Jonathan, alpha_vector is a list of equities or something else?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59046cc597a88a723cfbfd88' id='59046cc597a88a723cfbfd88'>
<a href='#59046cc597a88a723cfbfd88'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58b69f9cc073195f89a2aeb0'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/55d77868fc6abbd6aa432789c4815fe2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58b69f9cc073195f89a2aeb0'>Mikkel Jansen</a>
</div>
<a UTCms='1493462213000' class='quanto-date posted-at response-posted-at' href='#59046cc597a88a723cfbfd88'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi all,</p>

<p>I have really trouble using this algorithm. I want the algorithm to only consider a specific set of stocks to calculate the mean-variance optimal portfolio. The reason is that I want to compare the most basic portfolio strategies with each other and write a paper for a school course. It works until the period 01/01/2009-12/31/2009. Im am not trying to beat the market only show how the mean-variance optimal portfolio performs on the market. Does anyone have a solution?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5904ae6ec207e0689e81ce69' id='5904ae6ec207e0689e81ce69'>
<a href='#5904ae6ec207e0689e81ce69'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1493479022000' class='quanto-date posted-at response-posted-at' href='#5904ae6ec207e0689e81ce69'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I don&#39;t understand your problem. You test seems have run OK?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5904bea4d6f3bb0010648ee3' id='5904bea4d6f3bb0010648ee3'>
<a href='#5904bea4d6f3bb0010648ee3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1493483172000' class='quanto-date posted-at response-posted-at' href='#5904bea4d6f3bb0010648ee3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Mikkel.</p>

<p>Try this:  </p>

<pre><code>def rebalance(context, data):

    returns = data.history(context.stocks , &#39;price&#39;, 200, &#39;1d&#39;).pct_change().dropna()  
    weights = pd.Series(min_var_weights(returns, False))  
    weights[weights != weights] = 0  
    wt = weights/np.sum(abs(weights))  
    wt[wt != wt] = 0  
    print wt

    if get_open_orders(): return

    for stock in context.stocks :  
        if not data.can_trade(stock): continue  
        order_target_percent(stock, wt[stock])  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59061068e68e6b1959ac8e29' id='59061068e68e6b1959ac8e29'>
<a href='#59061068e68e6b1959ac8e29'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58b69f9cc073195f89a2aeb0'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/55d77868fc6abbd6aa432789c4815fe2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58b69f9cc073195f89a2aeb0'>Mikkel Jansen</a>
</div>
<a UTCms='1493569640000' class='quanto-date posted-at response-posted-at' href='#59061068e68e6b1959ac8e29'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi @Vladimir Yevtushenko  </p>

<p>Yes it works just fine know. Thank You!</p>

<p>@Anthony FJ Garner  - The problem was that the algorithm worked just fine in every yearly period except the period 01/01/2009-12/31/2009. But know it works.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='590a38891f7c7a00101e16ae' id='590a38891f7c7a00101e16ae'>
<a href='#590a38891f7c7a00101e16ae'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5441e3042c869f0bc00000e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/07eec08109406c6cd989e75416ffbbb8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5441e3042c869f0bc00000e2'>Jonathan Larkin</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1493842057000' class='quanto-date posted-at response-posted-at' href='#590a38891f7c7a00101e16ae'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Peter, I realized I never responded to your question above.</p>

<blockquote>
<p>@Jonathan, alpha_vector is a list of equities or something else?</p>
</blockquote>

<p>Yes - It would be a list of equities with an associated score. There is some discussion on this in another forum post (<a href="https://www.quantopian.com/posts/max-long-exposure-and-max-short-exposure-with-a-quadratic-objective">https://www.quantopian.com/posts/max-long-exposure-and-max-short-exposure-with-a-quadratic-objective</a>). Quoting from there:</p>

<blockquote>
<p>The alpha_vector could be anything -- ranks, z-scored values, actual expected returns, etc. -- anything where &quot;higher is better&quot;.  </p>
</blockquote>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/mad-portfolio-an-alternative-to-markowitz'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/mad-portfolio-an-alternative-to-markowitz'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#bbdddededfd9dad8d0fbcacedad5cfd4cbd2dad595d8d4d6">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

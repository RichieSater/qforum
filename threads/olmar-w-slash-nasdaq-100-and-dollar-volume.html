<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
OLMAR w/ NASDAQ 100 &amp; dollar-volume
</title>
<meta content='Here&#39;s the OLMAR algorithm with the NASDAQ 100 and dollar-volume data (instead of prices).  --Grant' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="dJ7oFvfh735BLIM5C7at2PBD/t1eoT9VmWnakIFgapII+J5bVRc9nfgx2ghEWQWsyM3dtCRtKk4bZgH6KyUIKQ==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/olmar-w-slash-nasdaq-100-and-dollar-volume' property='og:url'>
<meta content='OLMAR w/ NASDAQ 100 &amp; dollar-volume' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/olmar-w-slash-nasdaq-100-and-dollar-volume' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='OLMAR w/ NASDAQ 100 &amp; dollar-volume' property='og:title'>
<meta content='Here&#39;s the OLMAR algorithm with the NASDAQ 100 and dollar-volume data (instead of prices).  --Grant' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/olmar-w-slash-nasdaq-100-and-dollar-volume">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='52594188435e213fb7000116'>
<div class='post-container' data-post-id='52594188435e213fb7000116' id='52594188435e213fb7000116'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>OLMAR w/ NASDAQ 100 &amp; dollar-volume</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1381581192000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=OLMAR w/ NASDAQ 100 &amp; dollar-volume&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Folmar-w-slash-nasdaq-100-and-dollar-volume%3Futm_source%3Dwebsite_share%26utm_campaign%3Dolmar-w-slash-nasdaq-100-and-dollar-volume%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Folmar-w-slash-nasdaq-100-and-dollar-volume%3Futm_source%3Dwebsite_share%26utm_campaign%3Dolmar-w-slash-nasdaq-100-and-dollar-volume%26utm_medium%3Dlinkedin&amp;title=OLMAR+w%2F+NASDAQ+100+%26+dollar-volume+%28Grant+Kiehne%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/olmar-w-slash-nasdaq-100-and-dollar-volume?utm_source=website_share&amp;utm_campaign=olmar-w-slash-nasdaq-100-and-dollar-volume&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Grant Kiehne" />
<div class='body-text'>
<div class='body-text-container post-body'><p>Here&#39;s the OLMAR algorithm with the NASDAQ 100 and dollar-volume data (instead of prices).  --Grant  </p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>33 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='525bcc02493189a02300011e' id='525bcc02493189a02300011e'>
<a href='#525bcc02493189a02300011e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1381747715000' class='quanto-date posted-at response-posted-at' href='#525bcc02493189a02300011e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I reduced the initial capital to $25K, and added:</p>

<pre><code>    open_orders = []  
    for stock in context.stocks:  
        open_orders.append(bool(get_open_orders(stock)))  
    if True in open_orders:  
        return  
</code></pre>

<p>I use the built-in slippage and commission models, and plot the cash balance.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='525bd86ebac56a3b44000153' id='525bd86ebac56a3b44000153'>
<a href='#525bd86ebac56a3b44000153'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1381750895000' class='quanto-date posted-at response-posted-at' href='#525bd86ebac56a3b44000153'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Grant,</p>

<p>I wish I knew what it&#39;s doing! But you might as well &#39;return&#39; as soon as you find the first pending order:</p>

<pre><code>    #open_orders = []  
    for stock in context.stocks:  
        if bool(get_open_orders(stock)):  
            return  
    #if True in open_orders:  
    #    return  
</code></pre>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='525c876ed7cb555793000034' id='525c876ed7cb555793000034'>
<a href='#525c876ed7cb555793000034'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1381795699000' class='quanto-date posted-at response-posted-at' href='#525c876ed7cb555793000034'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Peter,</p>

<p>The link to the paper describing the original algorithm is <a href="http://icml.cc/2012/papers/168.pdf">http://icml.cc/2012/papers/168.pdf</a>.  It uses prices rather than dollar-volumes.</p>

<p>Grant</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='525c9c2900ad33fe1500005b' id='525c9c2900ad33fe1500005b'>
<a href='#525c9c2900ad33fe1500005b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9283fb2eb000200015b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fd495584fba0d660ede58a26a676f2d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9283fb2eb000200015b'>Aidan O&#39;Mahony</a>
</div>
<a UTCms='1381801005000' class='quanto-date posted-at response-posted-at' href='#525c9c2900ad33fe1500005b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant,</p>

<p>Nice idea to use the dollar-volume data! How does the performance compare to using OLMAR with price data over the same period?</p>

<p>Aidan  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='525d0e8997cbda962d0000df' id='525d0e8997cbda962d0000df'>
<a href='#525d0e8997cbda962d0000df'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1381830282000' class='quanto-date posted-at response-posted-at' href='#525d0e8997cbda962d0000df'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Aidan,</p>

<p>Here you go.  It&#39;s a simple code change:</p>

<pre><code>@batch_transform(refresh_period=R_P, window_length=W_L) # set globals R_P &amp; W_L above  
def get_data(datapanel,sids):  
    p = datapanel[&#39;price&#39;].as_matrix(sids)  
    # v = datapanel[&#39;volume&#39;].as_matrix(sids)  
    # return np.multiply(p,v)  
    return p  
</code></pre>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='525daca797cbdac96e000248' id='525daca797cbdac96e000248'>
<a href='#525daca797cbdac96e000248'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1381870760000' class='quanto-date posted-at response-posted-at' href='#525daca797cbdac96e000248'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s an attempt at minute-level trading.  Seems to improve the return, but then it completely tanks at the end...not sure why.  --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='525f1fdeeaf98756fa0000d3' id='525f1fdeeaf98756fa0000d3'>
<a href='#525f1fdeeaf98756fa0000d3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5126613453410ea24100022c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e0a104fbcb34fae39074877d3c017ee8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5126613453410ea24100022c'>ben v</a>
</div>
<a UTCms='1381965791000' class='quanto-date posted-at response-posted-at' href='#525f1fdeeaf98756fa0000d3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant,</p>

<p>I think it would be really cool if we could add a penalization term to the optimization problem when we readjust the portfolio. So that you don&#39;t have to buy or sell too many stocks. The transaction costs probably wipes out profit if we try to match b to b* exactly every period.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='525fc000eaf98756fa000382' id='525fc000eaf98756fa000382'>
<a href='#525fc000eaf98756fa000382'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1382006785000' class='quanto-date posted-at response-posted-at' href='#525fc000eaf98756fa000382'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Note that I don&#39;t think that the dollar-volume computation in this algorithm is quite right, since the batch transform forward-fills both price and volume for missing bars (not yet confirmed).  If a bar is missing, the volume should be zero in the dollar-volume code.  I&#39;m considering ways of fixing the problem; if you have a solution, please post it.  --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='525fdfc8f98b80a8f20003b1' id='525fdfc8f98b80a8f20003b1'>
<a href='#525fdfc8f98b80a8f20003b1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525e851789a9a4dd28000127'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7c528312ca62bd686e4de060f50bedca?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525e851789a9a4dd28000127'>Miguel Libre</a>
</div>
<a UTCms='1382014921000' class='quanto-date posted-at response-posted-at' href='#525fdfc8f98b80a8f20003b1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant - studying this one... I like the potential of OLMAR... is anyone running this in live trading yet?</p>

<p>when u say &quot; If a bar is missing, the volume should be zero in the dollar-volume code.&quot;  so what happens now? it&#39;s using a previous dollar-volume from a previous get_data or the as_matrix call &quot;datapanel[&#39;volume&#39;].as_matrix(sids) &quot; is not returning a 0?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='525fecae06ae589c590003d1' id='525fecae06ae589c590003d1'>
<a href='#525fecae06ae589c590003d1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1382018224000' class='quanto-date posted-at response-posted-at' href='#525fecae06ae589c590003d1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Miguel,</p>

<p>Grant will expand but Grant and myself have just realised that Quantopian data forward fills empty bars with price and volume information. This surprised me and perhaps I should have considered this before. Some discussion from the last few days in these threads:</p>

<p><a href="https://www.quantopian.com/posts/thinly-traded-stocks-why-no-gaps">https://www.quantopian.com/posts/thinly-traded-stocks-why-no-gaps</a><br>
<a href="https://www.quantopian.com/posts/why-does-the-data-in-handle-data-have-different-dates-for-some-securities">https://www.quantopian.com/posts/why-does-the-data-in-handle-data-have-different-dates-for-some-securities</a></p>

<p>and some examples here:</p>

<p><a href="https://www.quantopian.com/posts/feature-request-display-hh-mm-in-log-entries-in-a-minutely-backtest">https://www.quantopian.com/posts/feature-request-display-hh-mm-in-log-entries-in-a-minutely-backtest</a></p>

<p>I think, although he can confirm or deny it, that Grant would like either no forward fill of price and volume or a forward fill of price with volume set to &#39;0&#39;. </p>

<p>Related, Simon asked some questions here about the forthcoming &#39;history&#39; feature:</p>

<p><a href="https://www.quantopian.com/posts/draft-proposal-of-new-data-history-api">https://www.quantopian.com/posts/draft-proposal-of-new-data-history-api</a></p>

<p>i.e.</p>

<p><i>Also re forward filling, are you forward filling a nil tick to produce a degenerate bar with 0 volume? Or are you actually forward filling whatever the last bar was, causing any code that has exponential decay, volume accumulation or really any calculation at all to change...?</i></p>

<p>EDIT: I just re-read the reply from Eddie to Simon re: &#39;history&#39;:</p>

<p><i>&#39;ffill=True&#39; - fill the pricing information forward with the last known value (with the exception of inserting a &quot;0&quot; for volume)</i></p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52605915bc3290280300002e' id='52605915bc3290280300002e'>
<a href='#52605915bc3290280300002e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1382045975000' class='quanto-date posted-at response-posted-at' href='#52605915bc3290280300002e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Miguel and Peter,</p>

<p>I don&#39;t know if anyone is running the OLMAR algorithm in paper trading.  I tried and there was an error.  I haven&#39;t gotten back to it.</p>

<p>Regarding the forward filling, there are a couple issues at play here.  I need to check if the forward filling used by the batch transform sets the volume to zero.  If not, I think that I can turn off the forward filling and then just ignore the missing data (and with the upcoming history method, there will be a way to deal with missing data).  The issue described on <a href="https://www.quantopian.com/posts/thinly-traded-stocks-why-no-gaps">https://www.quantopian.com/posts/thinly-traded-stocks-why-no-gaps</a> is different in that I think that it impacts order submission/fulfillment/slippage, since I think the filling is applied before the backtest is started...we&#39;ll have to see what the Quantopian response is to my questions.</p>

<p>Grant</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='526075c66472426e7900005a' id='526075c66472426e7900005a'>
<a href='#526075c66472426e7900005a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f1edd0b03b228000d000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/81292895877c628963a3b56b408533e7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f1edd0b03b228000d000001'>Thomas Wiecki</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1382053319000' class='quanto-date posted-at response-posted-at' href='#526075c66472426e7900005a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant,</p>

<p>Glad to see our OLMAR is having a revival, the results are also very promising.</p>

<p>Have you played around with eps and window_length at all? In my optimization experiments I found that those have a huge effect, especially epsilon. This also leads to @Ben&#39;s question: you can clone the algo and play around with eps which essentially is a parameter of how aggressively the portfolio should be rebalanced; the lower the more conservative.</p>

<p>Thomas  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='526079e913659e3522000058' id='526079e913659e3522000058'>
<a href='#526079e913659e3522000058'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1382054381000' class='quanto-date posted-at response-posted-at' href='#526079e913659e3522000058'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Thomas,</p>

<p>I&#39;ve played around a bit with both eps and window_length...I may do a more systematic study once I sort out a few things.  I got the algo to run on minute data, with slippage by adding:</p>

<pre><code>for stock in context.stocks:  
        if bool(get_open_orders(stock)):  
            return  
</code></pre>

<p>This way, the portfolio can&#39;t be reallocated until all orders are filled.</p>

<p>Particularly in minute mode, I&#39;m concerned how missing bars (thinly traded securities) impact the algorithm.  I can fix up the batch transform, but I&#39;m not sure how to interpret my finding described on <a href="https://www.quantopian.com/posts/thinly-traded-stocks-why-no-gaps">https://www.quantopian.com/posts/thinly-traded-stocks-why-no-gaps</a>.  My work-around is:</p>

<pre><code>    for stock in data:  
        if data[stock].datetime &lt; get_datetime():  
            return  
</code></pre>

<p>The portfolio won&#39;t get reallocated if any of the securities did not trade (historically).  However, I think that orders still get filled, right?  Or not?</p>

<p>Also, how does the backtester handle orders for fractional shares?  I suspect as the algo is written now, there can be a difference between the actual portfolio state and the one that I record with:</p>

<pre><code># update portfolio  
    context.b_t = b_norm  
</code></pre>

<p>Grant</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52607b7c18f1c0513300004b' id='52607b7c18f1c0513300004b'>
<a href='#52607b7c18f1c0513300004b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f1edd0b03b228000d000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/81292895877c628963a3b56b408533e7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f1edd0b03b228000d000001'>Thomas Wiecki</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1382054783000' class='quanto-date posted-at response-posted-at' href='#52607b7c18f1c0513300004b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant,</p>

<p>Yeah, those work-arounds make sense. Orders should still get filled if you just return, yes.</p>

<p>I also share you concern regarding the internal portfolio allocation vector b_t to get out of sync with the actual portfolio. Instead we should probably just recalculate b_t at the beginning of each handle_data().</p>

<p>Thomas  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5260e14a13659ebde4000128' id='5260e14a13659ebde4000128'>
<a href='#5260e14a13659ebde4000128'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5260d85c2fd071662e0000f2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/cd647aba53013f2d3402a10f0996419e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5260d85c2fd071662e0000f2'>xiayan yang</a>
</div>
<a UTCms='1382080843000' class='quanto-date posted-at response-posted-at' href='#5260e14a13659ebde4000128'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>good  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='526120d36472426e790001ee' id='526120d36472426e790001ee'>
<a href='#526120d36472426e790001ee'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1382097110000' class='quanto-date posted-at response-posted-at' href='#526120d36472426e790001ee'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Another minute-level run.  Still crashes at the end, though...hmm?  --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5261d6b3f3b6825012000076' id='5261d6b3f3b6825012000076'>
<a href='#5261d6b3f3b6825012000076'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1382143668000' class='quanto-date posted-at response-posted-at' href='#5261d6b3f3b6825012000076'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s an update with the sid fix (<a href="https://www.quantopian.com/posts/list-of-nasdaq-100-sids-to-use-in-your-algo">https://www.quantopian.com/posts/list-of-nasdaq-100-sids-to-use-in-your-algo</a>).  Note that this algorithm isn&#39;t as great as it might appear, since it seems that most of the return can be obtained by just buying the entire Nasdaq 100, with equal dollar weights (set context.eps = 0).</p>

<p>--Grant   </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='526288d9121cc5959f00016b' id='526288d9121cc5959f00016b'>
<a href='#526288d9121cc5959f00016b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1382189274000' class='quanto-date posted-at response-posted-at' href='#526288d9121cc5959f00016b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s an update (switched to using VWAP for the moving average, per Ben V. on <a href="https://www.quantopian.com/posts/olmar-implementation-fixed-bug">https://www.quantopian.com/posts/olmar-implementation-fixed-bug</a>).  I also only allow shares to be transacted in even lots (multiples of 100).  There&#39;s likely some bias in this approach, since I ran the algorithm a number of times to find 5 random stocks out of the Nasdaq 100 that juiced up the return.  --Grant</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5262b12ef3b68250120001b3' id='5262b12ef3b68250120001b3'>
<a href='#5262b12ef3b68250120001b3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1382199604000' class='quanto-date posted-at response-posted-at' href='#5262b12ef3b68250120001b3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s basically the same algo as immediately above, except run over a longer time period.  --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='526e875332901d40e7000105' id='526e875332901d40e7000105'>
<a href='#526e875332901d40e7000105'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f1edd0b03b228000d000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/81292895877c628963a3b56b408533e7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f1edd0b03b228000d000001'>Thomas Wiecki</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1382975317000' class='quanto-date posted-at response-posted-at' href='#526e875332901d40e7000105'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant:</p>

<p>I tried to paper trade the last version you posted but get:</p>

<p>IndexError: index -1 is out of bounds for axis 0 with size 0<br>
USER ALGORITHM:168, in simplex_projection<br>
rho = np.where(u &gt; (sv - b) / np.arange(1, p+1))[0][-1]</p>

<p>Seems like some issue with missing sids? Anyway, just wondering if you perhaps encountered this as well and know more.</p>

<p>Thomas  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='526ed55ca0395d2a580001b7' id='526ed55ca0395d2a580001b7'>
<a href='#526ed55ca0395d2a580001b7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1382995293000' class='quanto-date posted-at response-posted-at' href='#526ed55ca0395d2a580001b7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Thomas,</p>

<p>The problem might be due to missing sids, but I&#39;m not sure.  I&#39;ll tinker around with it when I get the chance.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='526edeeca0395d2a580001e2' id='526edeeca0395d2a580001e2'>
<a href='#526edeeca0395d2a580001e2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1382997741000' class='quanto-date posted-at response-posted-at' href='#526edeeca0395d2a580001e2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thomas,</p>

<p>Here&#39;s basically the same algo.  I&#39;ll try live trading with it to see if I get an error, too.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='527025ed09449b1257000177' id='527025ed09449b1257000177'>
<a href='#527025ed09449b1257000177'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1383081454000' class='quanto-date posted-at response-posted-at' href='#527025ed09449b1257000177'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Thomas,</p>

<p>I got through my first day of paper trading with no error.  Here&#39;s the code I&#39;m running:</p>

<pre><code>import numpy as np  
import math

# globals for get_data batch transform decorator  
R_P = 0 #refresh period in days  
W_L = 5 #window length in days

def initialize(context):  
    context.stocks = [sid(1419),sid(12652),sid(6546),sid(5061),sid(6683)]  
    for stock in context.stocks:  
        print stock.symbol  
    context.m = len(context.stocks)  
    context.b_t = np.ones(context.m) / context.m  
    context.eps = 1 # change epsilon here  
    context.init = False  
def handle_data(context, data):  
    cash = context.portfolio.cash  
    record(cash=cash)  
    if not context.init:  
        rebalance_portfolio(context, data, context.b_t)  
        context.init = True  
    # get data  
    d = get_data(data,context.stocks)  
    if d == None:  
       return  
    # skip tic if any orders are open or any stocks did not trade  
    for stock in context.stocks:  
        if bool(get_open_orders(stock)) or data[stock].datetime &lt; get_datetime():  
            return  
    # update portfolio  
    for i, stock in enumerate(context.stocks):  
        context.b_t[i] = context.portfolio.positions[stock].amount*data[stock].price  
    context.b_t = np.divide(context.b_t,np.sum(context.b_t))  
    prices = d[0]  
    volumes = d[1]    

    m = context.m

    x_tilde = np.zeros(m)

    b = np.zeros(m)  
    # find relative moving volume weighted average price for each secuirty  
    for i, stock in enumerate(context.stocks):  
        vwa_price = np.dot(prices[:,i],volumes[:,i])/np.sum(volumes[:,i])  
        x_tilde[i] = vwa_price/prices[-1,i]  
    ###########################  
    # Inside of OLMAR (algo 2)

    x_bar = x_tilde.mean()

    # Calculate terms for lambda (lam)  
    dot_prod = np.dot(context.b_t, x_tilde)  
    num = context.eps - dot_prod  
    denom = (np.linalg.norm((x_tilde-x_bar)))**2

    # test for divide-by-zero case  
    if denom == 0.0:  
        lam = 0 # no portolio update  
    else:  
        lam = max(0, num/denom)  
    b = context.b_t + lam*(x_tilde-x_bar)

    b_norm = simplex_projection(b)

    rebalance_portfolio(context, data, b_norm)

@batch_transform(refresh_period=R_P, window_length=W_L) # set globals R_P &amp; W_L above  
def get_data(datapanel,sids,clean_nans=False):  
    p = np.nan_to_num(datapanel[&#39;price&#39;].as_matrix(sids))  
    v = np.nan_to_num(datapanel[&#39;volume&#39;].as_matrix(sids))  
    return [p,v]

def rebalance_portfolio(context, data, desired_port):  
    #rebalance portfolio  
    current_amount = np.zeros_like(desired_port)  
    desired_amount = np.zeros_like(desired_port)  
    if not context.init:  
        positions_value = context.portfolio.starting_cash  
    else:  
        positions_value = context.portfolio.positions_value + context.portfolio.cash  
    for i, stock in enumerate(context.stocks):  
        current_amount[i] = context.portfolio.positions[stock].amount  
        desired_amount[i] = desired_port[i]*positions_value/data[stock].price

    diff_amount = desired_amount - current_amount

    for i, stock in enumerate(context.stocks):  
        # order(stock, int(math.floor(diff_amount[i]/100.0))*100) #order_stock  
        order(stock, int(math.floor(diff_amount[i])))

def simplex_projection(v, b=1):  
    &quot;&quot;&quot;Projection vectors to the simplex domain

Implemented according to the paper: Efficient projections onto the  
l1-ball for learning in high dimensions, John Duchi, et al. ICML 2008.  
Implementation Time: 2011 June 17 by <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7d3f14133d11141f1413">[email&#160;protected]</a> AT pmail.ntu.edu.sg  
Optimization Problem: min_{w}\| w - v \|_{2}^{2}  
s.t. sum_{i=1}^{m}=z, w_{i}\geq 0

Input: A vector v \in R^{m}, and a scalar z &gt; 0 (default=1)  
Output: Projection vector w

:Example:
&gt;&gt;&gt; proj = simplex_projection([.4 ,.3, -.4, .5])  
&gt;&gt;&gt; print proj  
array([ 0.33333333, 0.23333333, 0. , 0.43333333])  
&gt;&gt;&gt; print proj.sum()  
1.0

Original matlab implementation: John Duchi (<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0c6668796f64654c6f7f226e697e676960697522696879">[email&#160;protected]</a>)  
Python-port: Copyright 2012 by Thomas Wiecki (<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="6b1f0304060a18451c020e0800022b0c060a020745080406">[email&#160;protected]</a>).  
&quot;&quot;&quot;

    v = np.asarray(v)  
    p = len(v)

    # Sort v into u in descending order  
    v = (v &gt; 0) * v  
    u = np.sort(v)[::-1]  
    sv = np.cumsum(u)

    rho = np.where(u &gt; (sv - b) / np.arange(1, p+1))[0][-1]  
    theta = np.max([0, (sv[rho] - b) / (rho+1)])  
    w = (v - theta)  
    w[w&lt;0] = 0  
    return w  
</code></pre>

<p>I&#39;m confused what happened, though, since I should have approximately the same dollar amount in each security.  Instead, I have:</p>

<p>CERN<br>
$32,915.62</p>

<p>SBUX<br>
$28,902.06 </p>

<p>DLTR<br>
$24,547.25 </p>

<p>MSFT<br>
$8,029.78 </p>

<p>ROST<br>
$4,988.75 </p>

<p>For some reason, the algo both bought and sold shares.  Due to the warm-up?  I&#39;d expected, after the first trading day to have about the same dollar amount in each security, with only buys.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52728e7596b1b486bf00002c' id='52728e7596b1b486bf00002c'>
<a href='#52728e7596b1b486bf00002c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f1edd0b03b228000d000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/81292895877c628963a3b56b408533e7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f1edd0b03b228000d000001'>Thomas Wiecki</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1383239287000' class='quanto-date posted-at response-posted-at' href='#52728e7596b1b486bf00002c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant,</p>

<p>Thanks, that code runs fine now. I did notice the same behavior as you did though. Do we have a bug in the portfolio filling?</p>

<p>Btw. we have some new order methods in zipline that allow better control over how many shares to order that should make it to quantopian soon.</p>

<p>Thomas  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5272f51196b1b43c44000092' id='5272f51196b1b43c44000092'>
<a href='#5272f51196b1b43c44000092'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1383265555000' class='quanto-date posted-at response-posted-at' href='#5272f51196b1b43c44000092'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thomas,</p>

<p>I think that the start-up behavior under paper trading is due to the warm up.  I had coded to do an initial buy, with equal dollar amounts in each security, before the batch transform window was full.  Apparently, paper trading went back in time, applied the initial buy, then the warm-up period ensued, followed by the first day of trading, when the re-balancing was reported.  So, I don&#39;t think that there is a bug in portfolio filling.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='527317413ae78889db0000c8' id='527317413ae78889db0000c8'>
<a href='#527317413ae78889db0000c8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e2887701c8cf8364f000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f0da8e39938dae306beaf315b3cb0156?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e2887701c8cf8364f000001'>John Fawcett</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1383274306000' class='quanto-date posted-at response-posted-at' href='#527317413ae78889db0000c8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant,</p>

<p>I used the flags in many of my own algos and shares, and it always causes problems. Using a boolean flag for the init is brittle in simulated trading, precisely because of the warmup sequence for the algorithms you mention. However, we&#39;ve found that simple switches also tend to break in real trading, because the switch assumes a clean slate start in the account. This assumption breaks down when you have pre-existing positions in your account, or you make transfers/transactions from outside the algorithm, or your broker updates your account, etc.</p>

<p>Instead of the boolean flag, we&#39;ve been writing snippets to look at the current portfolio and determine if we want our algorithm to return the positions to some baseline. Sometimes that means liquidating, sometimes it means rebalancing to equal weights, etc. In this case, it might be as simple as checking if any of your stocks are missing from the portfolio. In other algorithms, we&#39;ve looked at the total percent invested as a trigger to return to baseline.</p>

<p>thanks,<br>
fawce  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='527444338a34f2ed1a0000a3' id='527444338a34f2ed1a0000a3'>
<a href='#527444338a34f2ed1a0000a3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1383351348000' class='quanto-date posted-at response-posted-at' href='#527444338a34f2ed1a0000a3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Fawce,</p>

<p>In this case, the algo is initialized by buying equal dollar amounts across all of the securities in the portfolio.  Then, the portfolio is re-balanced.  I could have just as well initialized after the warm-up period, so that on the first day of paper trading, I would have seen equal dollar amounts in each security.  There is no provision to return to a baseline (e.g. equal dollar amounts), although it would be straightforward.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52787c2a1ec5b80a0e0000a9' id='52787c2a1ec5b80a0e0000a9'>
<a href='#52787c2a1ec5b80a0e0000a9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5111a1ad248050ae28000021'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8af9f699610a29765824cf08801dd696?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5111a1ad248050ae28000021'>Ken Shiring</a>
</div>
<a UTCms='1383627819000' class='quanto-date posted-at response-posted-at' href='#52787c2a1ec5b80a0e0000a9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant, I&#39;m very pleased to see this implementation on Quantopian. I have run many experiments in the past using many of the predecessor algorithms cited in the paper (Cover&#39;s alg, EG, and the Hungarians&#39; KNN). </p>

<p>One thing I can&#39;t tell by looking at the code: Is this a long only portfolio? No negative allocations?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5278caf3afc5120573000141' id='5278caf3afc5120573000141'>
<a href='#5278caf3afc5120573000141'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1383647988000' class='quanto-date posted-at response-posted-at' href='#5278caf3afc5120573000141'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Ken,</p>

<p>The algorithm is long only (no negative allocations).  The question has come up before, but to my knowledge, no one has posted a solution.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='527e9c81ad6e1f4c980000ea' id='527e9c81ad6e1f4c980000ea'>
<a href='#527e9c81ad6e1f4c980000ea'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1384029315000' class='quanto-date posted-at response-posted-at' href='#527e9c81ad6e1f4c980000ea'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>As Fawce informed me <a href="https://www.quantopian.com/posts/paper-trading-questions">here</a>, &quot;All live trading, paper or real money, is minutely.&quot;  So, I added some code to execute the algorithm at market open under minutely trading.  Here&#39;s the result, which basically replicates the one above.</p>

<p>In the end, it might be better to make a trading decision every minute, but based on my testing, it seems that there may need to be some sort of smoothing/filtering of the data to replicate the results I obtain with daily re-balancing.</p>

<p>--Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52aa35d6ea4bf381ca000032' id='52aa35d6ea4bf381ca000032'>
<a href='#52aa35d6ea4bf381ca000032'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f1edd0b03b228000d000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/81292895877c628963a3b56b408533e7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f1edd0b03b228000d000001'>Thomas Wiecki</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1386886616000' class='quanto-date posted-at response-posted-at' href='#52aa35d6ea4bf381ca000032'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>To demonstrate the usefulness of the new features (history() and new order methods; see <a href="https://www.quantopian.com/posts/new-features-history-and-new-order-methods">here</a> for more description), I updated the OLMAR algorithm. As you can see the code is much simpler now, especially order_target_percent() allows us to get rid of the rebalance_portfolio() logic.</p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='556bf356255560e5a4000270' id='556bf356255560e5a4000270'>
<a href='#556bf356255560e5a4000270'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5563459330cfd91fff0001e6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/151f48cead3bf5343bdb68941064e183?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5563459330cfd91fff0001e6'>James Miller</a>
</div>
<a UTCms='1433138010000' class='quanto-date posted-at response-posted-at' href='#556bf356255560e5a4000270'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>so what happens here ? :S  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='556d53865fa36ed0550001b6' id='556d53865fa36ed0550001b6'>
<a href='#556d53865fa36ed0550001b6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55263f70660e382642000361'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b7386c2d21c82004675b4f92393c4eb5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55263f70660e382642000361'>Bharath Rao</a>
</div>
<a UTCms='1433228172000' class='quanto-date posted-at response-posted-at' href='#556d53865fa36ed0550001b6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The returns are fantastic. But seem correlated with the benchmark. Is there evidence of alpha (say bear market performance)? Also, a big question is how do we select the universe of stocks? I would think limiting to bluechips may help ensure reversion to the moving average in the long run.  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/olmar-w-slash-nasdaq-100-and-dollar-volume'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/olmar-w-slash-nasdaq-100-and-dollar-volume'>join Quantopian</a> to
post a reply.
</div>
</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#e88e8d8d8c8a898b83a8999d89869c8798818986c68b8785">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
Hedging Beta Dynamically in Algorithm
</title>
<meta content='Hi,I am having difficulty trying to implement a hedge-ratio in a back testing algorithm. As an example, I am trying to use beta as a factor (short high beta, long low beta). I want to leverage the longs such that my beta = 0.Below is the best I have generated from the notebook but I&#39;m not sure how it fits in to the algorithm component to dynamically leverage the shorts (I&#39;m using beta as a factor) so that i am shorting high beta &amp; longing low beta &amp; portfolio beta = 0.high_beta =...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="wn0ULaPTbFQp+LkkG+gaH5tkmCJtuLP3DZg0sPBirey+G2JgASW+t5Dl4BVUB7Jro+q7Sxd0puyPl+/aWifPVw==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/hedging-beta-dynamically-in-algorithm' property='og:url'>
<meta content='Hedging Beta Dynamically in Algorithm' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/hedging-beta-dynamically-in-algorithm' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='Hedging Beta Dynamically in Algorithm' property='og:title'>
<meta content='Hi,I am having difficulty trying to implement a hedge-ratio in a back testing algorithm. As an example, I am trying to use beta as a factor (short high beta, long low beta). I want to leverage the longs such that my beta = 0.Below is the best I have generated from the notebook but I&#39;m not sure how it fits in to the algorithm component to dynamically leverage the shorts (I&#39;m using beta as a factor) so that i am shorting high beta &amp; longing low beta &amp; portfolio beta = 0.high_beta =...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/hedging-beta-dynamically-in-algorithm">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='582db51e4f70b20015000db7'>
<div class='post-container' data-post-id='582db51e4f70b20015000db7' id='582db51e4f70b20015000db7'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>Hedging Beta Dynamically in Algorithm</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/580d82d24e82e056aa00026c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/54ea9828452c6f4ae1187ecc8e6a1889?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/580d82d24e82e056aa00026c'>Lex</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1479390494000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=Hedging Beta Dynamically in Algorithm&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fhedging-beta-dynamically-in-algorithm%3Futm_source%3Dwebsite_share%26utm_campaign%3Dhedging-beta-dynamically-in-algorithm%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fhedging-beta-dynamically-in-algorithm%3Futm_source%3Dwebsite_share%26utm_campaign%3Dhedging-beta-dynamically-in-algorithm%26utm_medium%3Dlinkedin&amp;title=Hedging+Beta+Dynamically+in+Algorithm+%28Lex%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class='tags tag-row'>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Seeking Help' data-tag-id='55c50e7d8d4710ec6e000003' href='/posts/tag/Seeking-Help/newest'>Seeking Help</a>
</div>
<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/hedging-beta-dynamically-in-algorithm?utm_source=website_share&amp;utm_campaign=hedging-beta-dynamically-in-algorithm&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Lex" />
<div class='body-text'>
<div class='body-text-container post-body'><p>Hi,</p>

<p>I am having difficulty trying to implement a hedge-ratio in a back testing algorithm. As an example, I am trying to use beta as a factor (short high beta, long low beta). I want to leverage the longs such that my beta = 0.</p>

<p>Below is the best I have generated from the notebook but I&#39;m not sure how it fits in to the algorithm component to dynamically leverage the shorts (I&#39;m using beta as a factor) so that i am shorting high beta &amp; longing low beta &amp; portfolio beta = 0.</p>

<pre><code>high_beta = results.groupby(&#39;highbeta&#39;)[&#39;risk_factor&#39;].mean()[True]  
low_beta = results.groupby(&#39;lowbeta&#39;)[&#39;risk_factor&#39;].mean()[True]  
hedge_ratio = high_beta/-low_beta  
print high_beta,low_beta,hedge_ratio  
</code></pre>

<p>Thanks  </p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>13 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='582dcfa655c2720942000158' id='582dcfa655c2720942000158'>
<a href='#582dcfa655c2720942000158'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54460194d718f327fd000380'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e511e4eeb9334ef82f1caa7bd66c36dc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54460194d718f327fd000380'>Luca</a>
</div>
<a UTCms='1479397291000' class='quanto-date posted-at response-posted-at' href='#582dcfa655c2720942000158'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Have a look at <a href="https://www.quantopian.com/posts/pfcf-with-momentum-strategy#57bf16e3d8e71744b60001c5">here</a></p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='582fd7d3e335fe00120008f0' id='582fd7d3e335fe00120008f0'>
<a href='#582fd7d3e335fe00120008f0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/580d82d24e82e056aa00026c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/54ea9828452c6f4ae1187ecc8e6a1889?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/580d82d24e82e056aa00026c'>Lex</a>
</div>
<a UTCms='1479530458000' class='quanto-date posted-at response-posted-at' href='#582fd7d3e335fe00120008f0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks - I&#39;ve had a look &amp; still can&#39;t get it working based on how mine is set up. My intuition is the following process:<br>
1. Calculate beta of the short portfolio (high beta)<br>
2. Calculate beta of the long portfolios (low beta)<br>
3. Find the hedge ratio ( -beta_long/beta_short ). Should give a value like 1.5 or something.<br>
4.  Adjust &quot;context.short_leverage&quot; to the short_leverage*hedge ratio for each iteration to make beta=0. Maybe my thinking is wrong &amp; alternatively you could be leveraging the weights of the short position by the hedge ratio.</p>

<p>Below is the code I added in, it is causing some whacky things with the leverage which I cannot understand &amp; cant get beta to normalize. Can&#39;t tell who to interpret the output from pipeline, copying the code into a notebook isn&#39;t working for me, maybe the math is wrong.</p>

<pre><code>def before_trading_start(context, data):  
    # Call pipeline_output to get the output  
    # Note this is a dataframe where the index is the SIDs for all  
    # securities to pass my screen and the columns are the factors which  
    output = pipeline_output(&#39;ranking_example&#39;)  
    ranks = output[&#39;factor&#39;]  
    long_ranks = ranks[output[&#39;longs&#39;]].rank()  
    short_ranks = ranks[output[&#39;shorts&#39;]].rank()  
#    context.beta_long = context.output.loc[context.long_ranks.index][&#39;beta&#39;].mean()  
    beta_long = output.groupby(&#39;longs&#39;)[&#39;beta&#39;].mean()[True]  
    beta_short = output.groupby(&#39;shorts&#39;)[&#39;beta&#39;].mean()[True]  
    hedge_ratio = beta_long/-beta_short  
    context.short_leverage = context.short_leverage*hedge_ratio

    context.long_weights = (long_ranks / long_ranks.sum())  
    log.info(&quot;Long Weights:&quot;)  
    log.info(context.long_weights)  
    context.short_weights = (short_ranks / short_ranks.sum())  
    log.info(&quot;Short Weights:&quot;)  
    log.info(context.short_weights)  
    context.active_portfolio = context.long_weights.index.union(context.short_weights.index)

</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58307166ebc8530012000915' id='58307166ebc8530012000915'>
<a href='#58307166ebc8530012000915'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/580d82d24e82e056aa00026c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/54ea9828452c6f4ae1187ecc8e6a1889?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/580d82d24e82e056aa00026c'>Lex</a>
</div>
<a UTCms='1479569772000' class='quanto-date posted-at response-posted-at' href='#58307166ebc8530012000915'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Heres the latest backtest  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='583081678ea40400120009ad' id='583081678ea40400120009ad'>
<a href='#583081678ea40400120009ad'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/571d1bab2616ef09ce0002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a69e9457dd2832a76875bcae334d5baf?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/571d1bab2616ef09ce0002b6'>Dan Whitnable</a>
</div>
<a UTCms='1479573870000' class='quanto-date posted-at response-posted-at' href='#583081678ea40400120009ad'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Lex,</p>

<p>Two comments.</p>

<p>I believe your hedge_ratio calculation should be</p>

<pre><code>hedge_ratio  =  beta_long / (beta_short + beta_long)  
short_leverage  = -hedge_ratio     # negative because we want to go short these securities  
long_leverage   = 1-hedge_ratio    # will be positive and therefore long if both betas are positive

</code></pre>

<p>As long as the betas are both greater than 0, the hedge_ratio will be between 0 and 1.  This ensures the net portfolio leverage is 1. Your code may already include this but make sure the long_leverage is also modified by the hedge ratio.</p>

<p>Second, remember that beta may be negative. &quot;Beta_short&quot; and/or &quot;beta_long&quot; could potentially be negative. I assume the intention of the algorithm is to short the &quot;short&quot; securities. However, if it turns out the beta for those securities is negative, then in order to achieve a net zero beta, you would actually need to go long on those &quot;shorts&quot;. Consider the case where beta_long = .5 and beta_short = -.5. To get a net 0 beta one would need to go LONG an equal amount of each.</p>

<p>The other problem with negative betas is the absolute value of the hedge_ratio could go above 1. This in turn causes the portfolio leverage to increase above 1. Consider the case where beta_long = .5 and beta_short = -.4. The hedge_ratio then equals -.4 / (-.4 + .5) or -4. The short_leverage would then be -4 and the long_leverage would be 5. The portfolio leverage would then be around 9. </p>

<p>The above issues aren&#39;t insurmountable but need to be considered in the algorithm.</p>

<p>Good luck.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58383f3f454adf2505000849' id='58383f3f454adf2505000849'>
<a href='#58383f3f454adf2505000849'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/580d82d24e82e056aa00026c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/54ea9828452c6f4ae1187ecc8e6a1889?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/580d82d24e82e056aa00026c'>Lex</a>
</div>
<a UTCms='1480081223000' class='quanto-date posted-at response-posted-at' href='#58383f3f454adf2505000849'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi sorry I figured out what the noob error was, just need some help trying to fix it. My beta_long (should be 0.87ish) &amp; beta_short(meant to be 1.28ish) calculations are wrong. If I hard code the value for deleverage as 0.68 - (0.87 / 1.28) then it works perfectly. Can anyone help with figure out the beta calc? </p>

<pre><code>    long_ranks = ranks[output[&#39;longs&#39;]].rank()  
    short_ranks = ranks[output[&#39;shorts&#39;]].rank()  
    beta_long = output.groupby(long_ranks)[&#39;beta&#39;].mean()[True]  
    beta_short = output.groupby(short_ranks)[&#39;beta&#39;].mean()[True]  
    deleverage = beta_long/beta_short  
</code></pre>

<p>I have also tried these from Luca to calculate beta but is not working because I do not understand the index method.</p>

<pre><code>    beta_long = context.output.loc[context.long_ranks.index][&#39;beta&#39;].mean()  
    beta_short = context.output.loc[context.short_ranks.index][&#39;beta&#39;].mean()  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='583857b31f57860015000b1e' id='583857b31f57860015000b1e'>
<a href='#583857b31f57860015000b1e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1480087485000' class='quanto-date posted-at response-posted-at' href='#583857b31f57860015000b1e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s a function I use, that mixes in SPY, to bring beta close to zero.  The assumption is that the stocks in the universe are, on average, highly correlated to SPY, which for a relatively large portfolio of equities, in practice, will be the case.  Apparently, using such a &quot;hedging instrument&quot; as SPY is not copacetic for the Q fund, but I haven&#39;t heard a cogent argument from them yet as to why it would be problematic, and an all-equity solution would be preferred.</p>

<pre><code>denom = np.sum(np.absolute(a))  
    if denom &gt; 0:  
        a = a/denom  
    allocate(context, data, a)  
</code></pre>

<pre><code>def allocate(context, data, desired_port):  
    stocks = context.stocks + [sid(8554)]  
    for stock in context.portfolio.positions.keys():  
        if stock not in stocks:  
            if data.can_trade(stock):  
                order_target_percent(stock,0)  
    pct_ls = np.sum(desired_port)  
    record(pct_ls = pct_ls)  
    scale = 1.0-0.5*abs(pct_ls)  
    m = len(context.stocks) + 1

    weight = np.zeros(m)  
    for i, stock in enumerate(context.stocks):  
        weight[i] = scale*context.leverage*desired_port[i]  
    weight[-1] = -0.5*context.leverage*pct_ls  
    for i, stock in enumerate(stocks):  
            if data.can_trade(stock):  
                order_target_percent(stock, weight[i])  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5838a3d91f57862696000211' id='5838a3d91f57862696000211'>
<a href='#5838a3d91f57862696000211'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/571d1bab2616ef09ce0002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a69e9457dd2832a76875bcae334d5baf?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/571d1bab2616ef09ce0002b6'>Dan Whitnable</a>
</div>
<a UTCms='1480106977000' class='quanto-date posted-at response-posted-at' href='#5838a3d91f57862696000211'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>There are a couple of things wrong with your leveraging, but first want to clarify what you are trying to accomplish. Typically, one tries to create a portfolio which has a net beta of zero. However, you could strive for a net beta of any number. If the market is going up maybe try for a positive beta. If the market is going down then maybe a negative one. The Quantopian contest is looking for betas less than .3. Maybe that would be a good number?</p>

<p>So, starting with some basic math, how to calculate the net beta? </p>

<p>Consider two securities, ABC and XYZ, with betas of .5 and 1.5 respectively. One holds $1000 of each so equal dollar values of each. The net beta, beta_net, equals (.5 + 1.5) / 2 = 1. </p>

<p>In general, for an arbitrary number of securities, with d1, d2 ... d_n representing the amount (in dollars) held, and beta1, beta2 ... beta_n the betas, then beta_net can be calculated as below. It&#39;s really just a weighted average of betas. The weights (the d&#39;s) are the dollar amounts  and not the quantity of shares.</p>

<pre><code>beta_net  =  ((d1 * beta1) + (d2 * beta2) ... + (d_n * beta_n) ) / (d1 + d2 ... + d_n)

# in Pythonic pseudo-code this looks like

beta_net = d * beta / d.sum

# a convenient Numpy method is &quot;average&quot; which has a &quot;weights&quot; parameter to give a weighted average

beta_net  =  np.average(beta, weights=d)


</code></pre>

<p>Now, IF there are equal dollar amounts of each security then d1 = d2 = d_n , so beta_n can be simplified to</p>

<pre><code>beta_n  =   ((d * beta1) + (d * beta2) ... + (d * beta_n)) / (d*n)  
beta_n  =   ( beta1  +  beta2 ... +  beta_n) / n            # which is just the mean or average beta

</code></pre>

<p>The formulas that both you and Luca used incorporate the &quot;mean&quot; method. That is fine as long as one later goes on to order equal amounts of each security. However, that is not the way your order logic is written. Your order logic seems to weight each security by it&#39;s rank. Therefore you also need to weight each beta by this same amount.</p>

<p>See if that fixes your logic. </p>

<p>Also, I&#39;m not really familiar with the term &quot;deleverage&quot;. Ultimately, you don&#39;t want to calculate the net beta (as above) but rather calculate how much to weight the long basket of stocks and how much to weight the short basket. This gets back to the question of what you want for the net beta. So, let&#39;s assume one has a dollar amount of long stocks and call that &quot;dollars_long&quot;. What one wants to know is how much of the short stocks to purchase so the net beta of the portfolio is some value (call it beta_net). It&#39;s really just the equation above but instead of solving for beta_net one solves for the dollars_short.</p>

<pre><code># starting with the equation for beta_net and two positions (long and short)  
beta_net  =  ((dollars_long * beta_long) + (dollars_short * beta_short)) / (dollars_long + dollars_short)  
(dollars_long + dollars_short) * beta_net = (dollars_long * beta_long) + (dollars_short * beta_short)
dollars_short * beta_net  =   (dollars_long * beta_long) + (dollars_short * beta_short) - (dollars_long * beta_net)  
dollars_short * beta_net  =   ((dollars_long * (beta_long - beta_net)) + (dollars_short * beta_short)  
(dollars_short * beta_net)  -  (dollars_short * beta_short) =   dollars_long * (beta_long - beta_net) 
((dollars_short * (beta_net - beta_short))  =  dollars_long * (beta_long - beta_net)  
dollars_short  =  (dollars_long * (beta_long - beta_net)) /  (beta_net - beta_short)

# so finally.... move the negative sign out front and we solve the amount of dollars short  
# notice the negative sign implies &quot;sell&quot; or &quot;short&quot; this amount

dollars_short  =  -(dollars_long * (beta_net - beta_long)) /  (beta_net - beta_short)   

# we can check this with $1000 of longs with a beta of .5 and shorts with a beta of 1.5  
# How much of the shorts to purchase to net a zero beta?

dollars_short  =  -1000 * (0 - .5)/(0 - 1.5)  = -(1000*-.5)/ (-1.5)  = -333.3   

# Put this value into the original equation for beta_net to double check. We do indeed get 0 beta if we short $333.3 of the shorts.

beta_net  =  ((1000 * .5)  +  (-333.3 * 1.5)) / (1000 -333.3)  
beta_net  =  (500 - 500) / -666.6 = 0

</code></pre>

<p>I won&#39;t go into the math here, but if you are trying to get a zero beta, a more useful number may be the &quot;hedge_ratio&quot; or the percentage of the portfolio which should be allocated to the &quot;hedge&quot;. In this case the &quot;shorts&quot; are our hedge. This only works when you are trying for a zero beta. A non-zero beta has a little different equation.</p>

<pre><code>hedge_ratio  =  beta_long / (beta_short + beta_long)  
short_percentage  = -hedge_ratio     # negative because we want to go short these securities  
long_percentage   =  1-hedge_ratio  # will be positive and therefore long if both betas are positive

</code></pre>

<p>Make sure you define what net beta you are trying to achieve and then calculate the correct values for the amounts of longs and shorts. Also, as I mentioned in a previous post, maybe ensure that both the long and short betas are positive. </p>

<p>Maybe something like this</p>

<pre><code># output is a pandas dataframe returned from the pipeline. It has columns named &quot;beta&quot;, &quot;longs&quot;, &quot;shorts&quot;, and &quot;rank&quot;  
# I assume the &quot;longs&quot; and &quot;shorts&quot; columns are boolean.  
# There are many ways to index and slice a dataframe, but one convenient one is the query method.  
# Both of the below statements are equivalent since &quot;longs&quot; is bolean.  
long  = output.query(&#39;longs&#39;)  
long  = output.query(&#39;longs == True&#39;)

# long is a dataframe with the same columns as output but only the rows where the column &quot;longs&quot; is True  
# The betas can be accessed as follows. The result is a Pandas series type.  
long[&#39;beta&#39;]

# Pandas series can be multiplied as long as the lengths are the same and then returns another Pandas series.  
# Pandas series also have a convenient &quot;sum&quot; method.  
# Putting this together we can get the average beta weighted by rank  
beta_long  =  (long[&#39;beta&#39;] * long[&#39;rank&#39;]).sum()  /  long[&#39;rank&#39;].sum

# Another (perhaps faster) method is to use the numpy &quot;average&quot; method (remember to import numpy)  
beta_long  =  numpy.average(long[&#39;beta&#39;], weights = long[&#39;rank&#39;])

</code></pre>

<p>I&#39;d finally make a separate pandas series which has all the weights. Assuming one wants to weight based upon rank.</p>

<pre><code>long_weights = output.query(&#39;longs&#39;)[&#39;rank&#39;] / output.query(&#39;longs&#39;)[&#39;rank&#39;].sum()

</code></pre>

<p>The order logic could then be something like this</p>

<pre><code>short_percentage  =  beta_long / (beta_short + beta_long)    #  This should be positive. Remember to order a negative amount.  
long_percentage  = 1 - short_percentage

for stock in long_weights:  
        if data.can_trade(stock):  
            order_target_percent(stock, context.leverage * long_percentage * long_weight[stock])

for stock in short_weights:  
        if data.can_trade(stock):  
            order_target_percent(stock, context.leverage * short_percentage * -short_weight[stock])


</code></pre>

<p>Hope this helps? I didn&#39;t actually run any of the code or double check my math, so please excuse any mistakes and let me know.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5838ac540a4da32c540002a8' id='5838ac540a4da32c540002a8'>
<a href='#5838ac540a4da32c540002a8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1480109151000' class='quanto-date posted-at response-posted-at' href='#5838ac540a4da32c540002a8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Dan,</p>

<p>The idea is that this tells me how long/short the portfolio will be:</p>

<pre><code>pct_ls = np.sum(desired_port)  
</code></pre>

<p>For example, for equal sums of weights, long and short, <code>pct_ls = 0</code>, then no SPY is needed.  If <code>pct_ls =  1.0</code>, then an SPY weight of -1.0 is needed (and vice versa), times a factor of 0.5 to normalize the leverage.</p>

<p>You are correct, though, that it is a hack.  For the algo I&#39;m working on, it keeps beta well within the +/- 0.3 range, and I don&#39;t have to mess around a more complicated approach.  Thanks for the input.  It might not be that difficult to incorporate the actual betas, so that at each portfolio update, <code>beta ~ 0</code>.  I&#39;ll think about it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5838bf8587fc900a4300051a' id='5838bf8587fc900a4300051a'>
<a href='#5838bf8587fc900a4300051a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/571d1bab2616ef09ce0002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a69e9457dd2832a76875bcae334d5baf?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/571d1bab2616ef09ce0002b6'>Dan Whitnable</a>
</div>
<a UTCms='1480114062000' class='quanto-date posted-at response-posted-at' href='#5838bf8587fc900a4300051a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant</p>

<p>Good input.Simplest is often best.  I&#39;ve tried an algorithm with weighted average betas like above but it leads to a lot of complexity. The devil is in the details. The case of daily trading that doesn&#39;t also just use a simple &quot;rebalance everything at one time&quot; approach is problematic. Unless I rebalanced everything, I ran into issues with how to really size a single new position. Additionally, negative betas, and how they impacted the average, created problems. </p>

<p>Moreover, as they say, &quot;past performance is no indication of the future&quot;. I had some portfolios which had net zero betas (based upon past price history) which nonetheless  moved up and down with the market anyway.  The 250 day betas were much different than the 5 or 10 day betas.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5838edaaa16dd900150001cb' id='5838edaaa16dd900150001cb'>
<a href='#5838edaaa16dd900150001cb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/580d82d24e82e056aa00026c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/54ea9828452c6f4ae1187ecc8e6a1889?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/580d82d24e82e056aa00026c'>Lex</a>
</div>
<a UTCms='1480125878000' class='quanto-date posted-at response-posted-at' href='#5838edaaa16dd900150001cb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks for your in-depth reply Dan. I am trying to implement this at the most basic level possible. It is correct that I am equal-weighting the securities &amp; hence simply using &#39;mean()&#39; should be fine. I am trying to neutralise beta, beta=0. &amp; am using a decent chunk of correlated S&amp;P500 securities so both long &amp; short betas will be positive. Since I am short high-beta securities &amp; long low-beta securities, in this case long portfolio X, has beta = 0.87, and short portfolio Y, has beta 1.28, I am &#39;deleveraging&#39; or allocating less to the short portfolio (beta 1.28) so that it equals the beta of the long portfolio (beta 0.87). In this particular case, I have cheated &amp; know the beta_long &amp; beta_short through the backtesting, so know that the leverage for the short portfolio should = 0.68 &amp; the leverage for the long portfolio = 1. This makes the beta of the combined portfolio = 0;    (long weights * long beta) -> 1 * 0.87 = 0.68 * -1.28 &lt;- (short weights adjusted for deleverage * short portfolio beta). This makes combined portfolio beta = 0.</p>

<p>Very simple &amp; basic logic here, I have tested the logic by hard-coding the short leverage as 0.68 (as I know what the beta_long &amp; beta_short are meant to be from backtesting) &amp; it indeed makes beta close to 0. My problems lie with the simple python calculation of the portfolio betas. </p>

<pre><code>    beta_long = output.groupby(&#39;longs&#39;)[&#39;beta&#39;].mean()[True]  
    beta_short = output.groupby(&#39;shorts&#39;)[&#39;beta&#39;].mean()[True]  
</code></pre>

<p>The above does not seem to return the correct portfolio betas &amp; I don&#39;t know where its wrong. I cant copy paste this &amp; check in a notebook as the code is different &amp; too difficult for me to decipher how to replicate it. I think the dataframe coming from below isn&#39;t quite how I expect it:</p>

<pre><code>output = pipeline_output(&#39;ranking_example&#39;)  
ranks = output[&#39;factor&#39;]  
long_ranks = ranks[output[&#39;longs&#39;]].rank()  
short_ranks = ranks[output[&#39;shorts&#39;]].rank()
</code></pre>

<p>I have attached the latest backtest where you can see I have hard-coded the leverage in the line below:</p>

<pre><code>    context.short_weights = (short_ranks / short_ranks.sum())*0.68  
</code></pre>

<p>I would like to replace 0.68 with &#39;deleverage&#39; &amp; be able to achieve the same output after beta is properly calculated under beta_long &amp; beta_short.</p>

<p>Thanks  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5838ee620c70d000150001ed' id='5838ee620c70d000150001ed'>
<a href='#5838ee620c70d000150001ed'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/580d82d24e82e056aa00026c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/54ea9828452c6f4ae1187ecc8e6a1889?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/580d82d24e82e056aa00026c'>Lex</a>
</div>
<a UTCms='1480126056000' class='quanto-date posted-at response-posted-at' href='#5838ee620c70d000150001ed'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Forgot to attach backtest  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='583954d2daac1500150005a1' id='583954d2daac1500150005a1'>
<a href='#583954d2daac1500150005a1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/580d82d24e82e056aa00026c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/54ea9828452c6f4ae1187ecc8e6a1889?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/580d82d24e82e056aa00026c'>Lex</a>
</div>
<a UTCms='1480152287000' class='quanto-date posted-at response-posted-at' href='#583954d2daac1500150005a1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ok so only just found out you can actually print stuff in the algorithm which is a great help to me.... Here are the results of my print:</p>

<p>beta_long: -0.0538497417778<br>
beta_short: 5.43614342964<br>
deleverage: -0.00990587214535</p>

<p>So for now back to the drawing board &amp; Dan&#39;s first comment.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58397a1b6c3f1e00150006f8' id='58397a1b6c3f1e00150006f8'>
<a href='#58397a1b6c3f1e00150006f8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/571d1bab2616ef09ce0002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a69e9457dd2832a76875bcae334d5baf?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/571d1bab2616ef09ce0002b6'>Dan Whitnable</a>
</div>
<a UTCms='1480161828000' class='quanto-date posted-at response-posted-at' href='#58397a1b6c3f1e00150006f8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Lex</p>

<p>I saw those beta numbers last night and glad you noticed them too. Basically it calls into question the ability to construct a beta zero portfolio based upon past betas.</p>

<p>Attached is a backtest that I changed 4 things:</p>

<ol>
<li>line 109  removed the .68 &quot;fudge factor&quot;<br></li>
<li>lines 114-118  added logic to calculate weighted average for betas<br></li>
<li>lines 121-123  added logging for beta variables<br></li>
<li>line 165  commented out the short ordering (so only long orders)</li>
</ol>

<p>Look at the log and it shows  betas similar to what you posted. Primarily note that beta long is about zero and the weighted beta long is a negative .3. </p>

<p>With the short ordering commented out, the algorithm only buys the long picks. The premise is that the resulting &quot;long only&quot; portfolio will have a beta similar to the historical beta of the long stocks (about zero or about -.3 depending upon the calculation). However, the portfolio beta turns out to be .87. I didn&#39;t try it, but commenting out the long buys and going only short will probably yield  similar disagreement with historical betas. One can also play with the beta regression length but I&#39;ve found this doesn&#39;t improve things much.</p>

<p>My thoughts are that past betas don&#39;t ensure similar future betas. One may get a little better correlation using randomly picked stocks, but the effect seems exacerbated using &quot;good picks&quot;. What I mean is our algorithms start by picking stocks that we feel will over or under perform the market. They are stocks that are changing. They are outliers. We expect the future prices of these stocks to be different from the past prices. It shouldn&#39;t be a surprise then that their future betas are different from their past betas?  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/hedging-beta-dynamically-in-algorithm'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/hedging-beta-dynamically-in-algorithm'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#30565555545251535b704145515e445f4059515e1e535f5d">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

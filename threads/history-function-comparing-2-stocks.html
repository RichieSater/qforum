<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
History Function Comparing 2 Stocks
</title>
<meta content='Algorithm works by comparing ratio of  prices A/B to average of 15 period A / average of 15 periods of BHow can I use the history function to record the historical 15 day average price for each stock and then record the Mean and Standard Deviation of this ratio?' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="2MCDP5ci6reehSJTTVzx0WZM2Cd0F3WjNMyJz2JM0r6kpvVyNdQ4VCeYe2ICs1mlXsL7Tg7bYLi2w1KlyAmwBQ==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/history-function-comparing-2-stocks' property='og:url'>
<meta content='History Function Comparing 2 Stocks' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/history-function-comparing-2-stocks' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='History Function Comparing 2 Stocks' property='og:title'>
<meta content='Algorithm works by comparing ratio of  prices A/B to average of 15 period A / average of 15 periods of BHow can I use the history function to record the historical 15 day average price for each stock and then record the Mean and Standard Deviation of this ratio?' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/history-function-comparing-2-stocks">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='53a0d983bbea92c7b9000046'>
<div class='post-container' data-post-id='53a0d983bbea92c7b9000046' id='53a0d983bbea92c7b9000046'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>History Function Comparing 2 Stocks</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/524d8df4f77b13a0050003c9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/233cc6781515d301e0fcc9522926c94f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/524d8df4f77b13a0050003c9'>Al W</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1403050371000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=History Function Comparing 2 Stocks&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fhistory-function-comparing-2-stocks%3Futm_source%3Dwebsite_share%26utm_campaign%3Dhistory-function-comparing-2-stocks%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fhistory-function-comparing-2-stocks%3Futm_source%3Dwebsite_share%26utm_campaign%3Dhistory-function-comparing-2-stocks%26utm_medium%3Dlinkedin&amp;title=History+Function+Comparing+2+Stocks+%28Al+W%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/history-function-comparing-2-stocks?utm_source=website_share&amp;utm_campaign=history-function-comparing-2-stocks&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Al W" />
<div class='body-text'>
<div class='body-text-container post-body'><p>Algorithm works by comparing ratio of  prices A/B to average of 15 period A / average of 15 periods of B</p>

<p>How can I use the history function to record the historical 15 day average price for each stock and then record the Mean and Standard Deviation of this ratio?  </p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>16 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='53a0f8eabbea92ae7c00007a' id='53a0f8eabbea92ae7c00007a'>
<a href='#53a0f8eabbea92ae7c00007a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/524d8df4f77b13a0050003c9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/233cc6781515d301e0fcc9522926c94f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/524d8df4f77b13a0050003c9'>Al W</a>
</div>
<a UTCms='1403058412000' class='quanto-date posted-at response-posted-at' href='#53a0f8eabbea92ae7c00007a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Trying something like this but it&#39;s not working. Any idea why?  </p>

<pre><code>def avgstd(context,data):  
    #Get X day period data  
    price_history = history(bar_count=20, frequency=&#39;1d&#39;, field=&#39;price&#39;)  
    mean = price_history.mean()  

    a_price = mean[data[context.stocks[0]]]  
    b_price = mean[data[context.stocks[1]]]

   ratio =a_price / b_price  
   ratio_mean = ratio.mean()  
   ratio_std = ratio.std()

</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53a104f1abb4e754bb00008a' id='53a104f1abb4e754bb00008a'>
<a href='#53a104f1abb4e754bb00008a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5351146d50e6b24f1e000043'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5ee4e8d7cdeb7eaea5604c7324ad3542?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5351146d50e6b24f1e000043'>Sekuri Jouri</a>
</div>
<a UTCms='1403061490000' class='quanto-date posted-at response-posted-at' href='#53a104f1abb4e754bb00008a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>try:  </p>

<pre><code>    a_price = mean[context.stocks[0]]  
    b_price = mean[context.stocks[1]]

</code></pre>

<p>history returns a pandas DataFrame and its keys/columns are the sids. So your mean dataframe expects a sid as an identifying key. Hope this helps.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53a10b6aabb4e754bb000097' id='53a10b6aabb4e754bb000097'>
<a href='#53a10b6aabb4e754bb000097'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/524d8df4f77b13a0050003c9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/233cc6781515d301e0fcc9522926c94f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/524d8df4f77b13a0050003c9'>Al W</a>
</div>
<a UTCms='1403063148000' class='quanto-date posted-at response-posted-at' href='#53a10b6aabb4e754bb000097'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>That works, but how do I record the standard deviation of the ratio?  </p>

<pre><code>def ratiostd(context,data):  
    #Get X day period data  
    price_history = history(bar_count=15, frequency=&#39;1d&#39;, field=&#39;price&#39;)  
    mean = price_history.mean()  

    a_price = mean[context.stocks[0]]  
    b_price = mean[context.stocks[1]]

   ratio =a_price / b_price  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53a17624152ffac9e4000198' id='53a17624152ffac9e4000198'>
<a href='#53a17624152ffac9e4000198'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5351146d50e6b24f1e000043'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5ee4e8d7cdeb7eaea5604c7324ad3542?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5351146d50e6b24f1e000043'>Sekuri Jouri</a>
</div>
<a UTCms='1403090470000' class='quanto-date posted-at response-posted-at' href='#53a17624152ffac9e4000198'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m probably misunderstanding your question but your price_history.mean() will give you an average price over 15 periods for each of the securities in your universe. For example, say you have context.stocks set up with 2 sids. Then your price_history.mean() will give you 2 numbers, each a mean for a stock. By doing a_price/b_price you&#39;re calculating the ratio of the means of 2 securities and that&#39;s just a single number. If you meant to store values calculated for each handle_data run, the you can simply store the value in some context list variable or such. e.g.  </p>

<pre><code>rolling_means.append(ratio)  
</code></pre>

<p>Similar idea if you also track stdev where stdev = price_history.std(). See <a href="https://www.quantopian.com/help#ide-history">https://www.quantopian.com/help#ide-history</a> for more guidance. If you have a more complete example to share, I&#39;m happy to go through it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53a1a5cb15c4bc5d3f0001ec' id='53a1a5cb15c4bc5d3f0001ec'>
<a href='#53a1a5cb15c4bc5d3f0001ec'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/524d8df4f77b13a0050003c9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/233cc6781515d301e0fcc9522926c94f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/524d8df4f77b13a0050003c9'>Al W</a>
</div>
<a UTCms='1403102669000' class='quanto-date posted-at response-posted-at' href='#53a1a5cb15c4bc5d3f0001ec'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>That makes sense, but when I try to get std of the rolling_means it breaks down. I added a log to see the data and it is only holding 1 number I think?  </p>

<pre><code>import numpy  
def initialize(context):  
    # this example works on Apple&#39;s data  
    context.aapl = sid(24)  
    context.msft = sid(5061)

def handle_data(context, data):  
    # use history to pull the last 10 days of price  
    price_history = history(bar_count=10, frequency=&#39;1d&#39;, field=&#39;price&#39;)  
    # calculate the standard deviation using std()  
    mean = price_history.mean()  
    # ratio calculation  
    m1=mean[context.aapl]  
    m2=mean[context.msft]  
    ratio=m1/m2  
    rolling_means = []  
    rolling_means.append(ratio)  
    std_ratio= numpy.std(rolling_means)  
    record(m1=m1)  
    record(m2=m2)  
    record(ratio=ratio)  
    record(ratio_std=std_ratio)  
    log.info(rolling_means)  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53a1aee6abb4e7585200022a' id='53a1aee6abb4e7585200022a'>
<a href='#53a1aee6abb4e7585200022a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5351146d50e6b24f1e000043'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5ee4e8d7cdeb7eaea5604c7324ad3542?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5351146d50e6b24f1e000043'>Sekuri Jouri</a>
</div>
<a UTCms='1403105000000' class='quanto-date posted-at response-posted-at' href='#53a1aee6abb4e7585200022a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Al, I made some edits to the code with explanations that I hope will be clear. Let me know if you have any questions. Thanks</p>

<pre><code>import numpy as np  
from pytz import timezone

def initialize(context):  
    # this example works on Apple&#39;s data  
    context.aapl = sid(24)  
    context.msft = sid(5061)

&#39;&#39;&#39;
Make rolling_means a context variable (instead of local to handle_data) so it doesn_t reset every time handle_data is called  
&#39;&#39;&#39;
    context.rolling_means = []

def handle_data(context, data):

&#39;&#39;&#39;
Calling history() requires running backtest in minute mode.  
Handle_data runs every time there_s data in a minute bar.  
For brevity of logs and faster testing, let_s force handle_data to run through completely only once a day.  
For this, use the newDay function defined below to check for a new day.  
newDay() checks the exchange time and allows execution of the rest of handle_data only if it_s 9:31am  
Otherwise, handle_data just keeps looping, doing nothing until the next 9:31am.  
There is no bar at 9:30am (the first bar is timed at it_s end - 9:31am. It has the open (at 9:30am), hi,lo and close at 9:31am)  
You can change the time to suit your needs or it can be implemented to simply check dates instead of times.  
&#39;&#39;&#39;
    context.exchange_time = get_datetime().astimezone(timezone(&#39;US/Eastern&#39;))  
    if not newDay(context):  
        return  
    # use history to pull the last 10 days of price  
    price_history = history(bar_count=10, frequency=&#39;1d&#39;, field=&#39;price&#39;)  
    # calculate the standard deviation using std()  
    mean = price_history.mean()  
    # ratio calculation  
    m1=mean[context.aapl]  
    m2=mean[context.msft]  
    ratio=m1/m2  
    context.rolling_means.append(ratio)  
    std_ratio= np.std(context.rolling_means)  
    record(m1=m1)  
    record(m2=m2)  
    record(ratio=ratio)  
    record(ratio_std=std_ratio)  
#    log.info(context.rolling_means)  
&#39;&#39;&#39;
edited the log messaging a bit for clarity  
&#39;&#39;&#39;
    message = &#39;{dt}: m1={m1}, m2={m2}, ratio={ratio}, std_ratio={std_ratio}&#39;  
    message = message.format(dt=context.exchange_time,m1=m1,m2=m2,ratio=ratio,std_ratio=std_ratio)  
    log.debug(message)  


def newDay(context):  
    new_day = False  
    if context.exchange_time.hour == 9 and context.exchange_time.minute == 31:  
        new_day=True  
    return new_day

</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53a1b96215c4bc5d3f000224' id='53a1b96215c4bc5d3f000224'>
<a href='#53a1b96215c4bc5d3f000224'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/524d8df4f77b13a0050003c9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/233cc6781515d301e0fcc9522926c94f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/524d8df4f77b13a0050003c9'>Al W</a>
</div>
<a UTCms='1403107685000' class='quanto-date posted-at response-posted-at' href='#53a1b96215c4bc5d3f000224'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The  only issue is keeping std of ratio to only include last X days. I added this code and was working on a way to have it function for anytime frame.</p>

<pre><code>    #keep # of periods for std steady  
    if len(context.rolling_means)==10:  
        del context.rolling_means[0]  
        return  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53a1c75fabb4e77efc00027b' id='53a1c75fabb4e77efc00027b'>
<a href='#53a1c75fabb4e77efc00027b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5351146d50e6b24f1e000043'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5ee4e8d7cdeb7eaea5604c7324ad3542?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5351146d50e6b24f1e000043'>Sekuri Jouri</a>
</div>
<a UTCms='1403111265000' class='quanto-date posted-at response-posted-at' href='#53a1c75fabb4e77efc00027b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>You probably  want to use python&#39;s deque object from the collections module instead of a list. Deque is like a list just more efficient and you can specify a maximum length. Once you reach the max length, each time you append on one end, it removes an item from the opposite end. See <a href="https://docs.python.org/2/library/collections.html#collections.deque">https://docs.python.org/2/library/collections.html#collections.deque</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53a207b5abb4e75852000319' id='53a207b5abb4e75852000319'>
<a href='#53a207b5abb4e75852000319'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1403127734000' class='quanto-date posted-at response-posted-at' href='#53a207b5abb4e75852000319'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>You might also want to take a look at some of the rolling stats methods provided natively by pandas.  For example, it looks like rolling_mean and rolling_std might do exactly what you want with no more effort on your part.  I threw together an example that shows some common idioms for working with DataFrames here.</p>

<p><a href="https://www.quantopian.com/posts/working-with-history-dataframes">https://www.quantopian.com/posts/working-with-history-dataframes</a>  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='53b08b0f1be550b1300031cd' id='53b08b0f1be550b1300031cd'>
<a href='#53b08b0f1be550b1300031cd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/524d8df4f77b13a0050003c9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/233cc6781515d301e0fcc9522926c94f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/524d8df4f77b13a0050003c9'>Al W</a>
</div>
<a UTCms='1404078865000' class='quanto-date posted-at response-posted-at' href='#53b08b0f1be550b1300031cd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Scott,</p>

<p>I have been trying to build a newer method that uses data frames, but am having trouble figuring out how to add new columns of data to the price history.</p>

<p>Ideally I would like to add:<br>
a column called ratio and set its values = price of Sid[1] / price of Sid[2]<br>
a column called historical_ratio and set its values = the average of the ratio for the period set by bar count<br>
a final column called ratio_std and set its values = std of the ratio  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53b180d279a8e63ec2000037' id='53b180d279a8e63ec2000037'>
<a href='#53b180d279a8e63ec2000037'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1404141781000' class='quanto-date posted-at response-posted-at' href='#53b180d279a8e63ec2000037'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Al, </p>

<p>It sounds like what you want is pandas.rolling_mean and pandas.rolling_std.  One caveat with their usage is that if you want a rolling mean of length 10 extending back 10 days, you actually need to request a history of length 19, because you need the 9 days prior to the earliest day you care about to calculate the mean.  In general you to calculate a N bars of a rolling stat of length K, you&#39;ll need (N + K - 1) history bars.  I&#39;ve attached a backtest with a source code example for this sort of setup (I accidentally used 20 bars instead of 19.  Index arithmetic is hard...).</p>

<p>You can read more about pandas rolling statistics capabilities here: <a href="http://pandas.pydata.org/pandas-docs/stable/computation.html#moving-rolling-statistics-moments">http://pandas.pydata.org/pandas-docs/stable/computation.html#moving-rolling-statistics-moments</a>.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='53b35dfd439b18fc15000184' id='53b35dfd439b18fc15000184'>
<a href='#53b35dfd439b18fc15000184'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/524d8df4f77b13a0050003c9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/233cc6781515d301e0fcc9522926c94f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/524d8df4f77b13a0050003c9'>Al W</a>
</div>
<a UTCms='1404263935000' class='quanto-date posted-at response-posted-at' href='#53b35dfd439b18fc15000184'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks for explaining that Scott. The last part that I am having difficulty with is getting 1 particular value from the dataframe. I can get a particular column and the last row, but it returns the Date index with the value I want.</p>

<pre><code>ratio=prices[&#39;historical_ratio&#39;][-1:]  
``` returns
2014-05-01 13:31:00+00:00    1.999622  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53b364b54684539d83000175' id='53b364b54684539d83000175'>
<a href='#53b364b54684539d83000175'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1404265655000' class='quanto-date posted-at response-posted-at' href='#53b364b54684539d83000175'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I think you&#39;ll get what you want if you drop the colon from the second indexer.  The way to think about this is by analogy with python&#39;s list slicing semantics.</p>

<p>If I have a list, my_list = [1, 2, 3, 4], then  </p>

<pre><code>my_list[N]  
</code></pre>

<p>means &quot;give me the Nth element of my_list&quot;.  One of the nice features of Python&#39;s list slicing is that negative indices wrap to the end of lists, so<br>
<code>
my_list[-1]  
</code>
becomes syntactic sugar for &quot;give me the <strong>last</strong> element of my_list&quot;.</p>

<p>Adding a colon to your indexer changes the semantics of what you&#39;re asking Python to do.  When you write<br>
<code>
my_list[N:]  
</code>
you&#39;re now saying &quot;give me the sub-list of elements drawn from my_list, starting at index N.&quot;  So for example,</p>

<pre><code>my_list = [1, 2, 3, 4]  
sub_list = my_list[2:] # sub_list = [3,4]  
</code></pre>

<p>In the particular case where N = -1, you&#39;re saying &quot;give me the sub-list of elements drawn from my_list, <strong>starting with the last element of the list</strong>.  Thus we get</p>

<pre><code>my_list = [1, 2, 3, 4]  
sub_list = my_list[-1:] # sub_list = [4]  
</code></pre>

<p>Pandas Series (1D), DataFrame (2D), and Panel (3D) objects extend these semantics in a natural way.  Indexing into one of these objects with a scalar value (i.e., without a colon), returns an object of one dimension lower than the original object.  Indexing with a slice (i.e. using the colon syntax) returns a filtered-down object of the same dimension as the original object.</p>

<p>In the example above, prices is a 2D DataFrame object.  When you index into it with the string &#39;historical_ratio&#39; you&#39;ve indexed by a scalar, so you get back a 1D Series, because that&#39;s the pandas data type of one dimension lower than your original DataFrame.  This is analogous to doing my_list[N] in the simple list case. You then index into the resulting series with the slice [-1:], and because you used a slice instead of a scalar, we get a length-1 Series instead of a value.  This is analogous to doing my_list[N:] in the list case.  </p>

<p>If instead you index with [-1], pandas will return 1.999622.  You can think of this as pandas again &quot;lowering the dimension&quot; of our 1D Series to a &quot;0D&quot; object, which is just a simple scalar.</p>

<p>Hope that helps,<br>
-Scott  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='53b36679b5c75406a40001a7' id='53b36679b5c75406a40001a7'>
<a href='#53b36679b5c75406a40001a7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/524d8df4f77b13a0050003c9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/233cc6781515d301e0fcc9522926c94f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/524d8df4f77b13a0050003c9'>Al W</a>
</div>
<a UTCms='1404266108000' class='quanto-date posted-at response-posted-at' href='#53b36679b5c75406a40001a7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thank you that clears it up very well. I had not been able to figure it out based on the documentation for data frames for some reason. This makes a lot of sense.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53b368eac95f810a9a0001a3' id='53b368eac95f810a9a0001a3'>
<a href='#53b368eac95f810a9a0001a3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/524d8df4f77b13a0050003c9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/233cc6781515d301e0fcc9522926c94f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/524d8df4f77b13a0050003c9'>Al W</a>
</div>
<a UTCms='1404266733000' class='quanto-date posted-at response-posted-at' href='#53b368eac95f810a9a0001a3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>working well:</p>

<pre><code>import pandas as pd  
from pytz import timezone

def initialize(context):  
    # Set Equities  
    context.sid1 = sid(24)   # Stock A  
    context.sid2 = sid(5061) # Stock B

def handle_data(context, data):  
    stockA = context.sid1  
    stockB = context.sid2  
    #Set Confidence interval  

    # Run the algorithm only if it is a new day  
    context.exchange_time =         get_datetime().astimezone(timezone(&#39;US/Eastern&#39;))  
    if not newDay(context):  
        return  
    # Request history from the last 20 days, so that we can compute  
    # a 10 day mean/std starting from 10 days ago.  
    prices = history(20, &#39;1d&#39;, &#39;price&#39;).copy()

    # Each column in a DataFrame is a pandas Series, and  
    # Series / Series does the division pairwise.  
    prices[&#39;ratio&#39;] = prices[stockA] / prices[stockB]  
    # rolling_mean(series, 10) gives us the mean over the last 10 entries for each entry  
    # in the series.  Note that the first 10 entries will be NaN, because we don&#39;t have  
    # a long enough window to compute the full mean.  
    prices[&#39;historical_ratio&#39;] = pd.rolling_mean(prices[&#39;ratio&#39;], 10)  
    # rolling_std is analogous to rolling_mean.  
    prices[&#39;ratio_std&#39;] = pd.rolling_std(prices[&#39;ratio&#39;], 10)

    # Truncate the prices dataframe to the length we actually care about,  
    # which is the last 10 entries.  
    prices = prices.iloc[-10:]  
    log.info(prices)  
    log.info(list(prices.columns.values))

    # Do stuff with our calcuated DataFrame!  
    # ****Trading Locic****  
    # Get last period ratio  
    ratio=prices[&#39;ratio&#39;][-1]  
    record(ratio=ratio)  
    # Get last period rolling ratio &amp; standard deviation of rolling ratio  
    historical_ratio=prices[&#39;historical_ratio&#39;][-1]  
    ratio_std=prices[&#39;ratio_std&#39;][-1]  
    upper=historical_ratio+ratio_std*1.5  
    lower=historical_ratio+ratio_std*-1.5  
    record(historical_ratio=historical_ratio)  
    record(upper=upper)  
    record(lower=lower)  


# Determines if it is a new day  
def newDay(context):  
    new_day = False  
    if context.exchange_time.hour == 9 and context.exchange_time.minute == 31:  
        new_day=True  
    return new_day  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53b36e75b5c75406a40001af' id='53b36e75b5c75406a40001af'>
<a href='#53b36e75b5c75406a40001af'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1404268156000' class='quanto-date posted-at response-posted-at' href='#53b36e75b5c75406a40001af'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Awesome!  Glad to be of help.</p>

<p>It&#39;s also worth noting that another (likely more efficient) way to do this would be  </p>

<pre><code>prices.ix[-1, &#39;historical_ratio&#39;]  
</code></pre>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/history-function-comparing-2-stocks'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/history-function-comparing-2-stocks'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#41272424252320222a013034202f352e3128202f6f222e2c">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

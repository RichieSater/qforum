<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
order_target_percent
</title>
<meta content='How Quantopian function  order_target_percent calculate existing percent?A. From Initial Capital.B. From Initial Capital+Closed Position Profit.C. From Initial Capital+Closed Position Profit+Open Position Profit[0]+Cash.D. From Initial Capital+Closed Position Profit+Open Position Profit[-1]+Cash.If C (the right way) then why it during backtest on minute data create orders every minute on single security with target percent 1.0 ?def initialize(context):    passdef handle_data(context, data):  ...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="9KWDG/WTVSuZPvisHICFFbPxokiFTJbbHcZ/VlU24WuIw/VWV2WHyCAjoZ1Tby1hi3+BIf+Ag8CfyaQ8/3OD0A==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/order-target-percent-1' property='og:url'>
<meta content='order_target_percent' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/order-target-percent-1' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='order_target_percent' property='og:title'>
<meta content='How Quantopian function  order_target_percent calculate existing percent?A. From Initial Capital.B. From Initial Capital+Closed Position Profit.C. From Initial Capital+Closed Position Profit+Open Position Profit[0]+Cash.D. From Initial Capital+Closed Position Profit+Open Position Profit[-1]+Cash.If C (the right way) then why it during backtest on minute data create orders every minute on single security with target percent 1.0 ?def initialize(context):    passdef handle_data(context, data):  ...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/order-target-percent-1">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='54f7f75ac8e506d879000117'>
<div class='post-container' data-post-id='54f7f75ac8e506d879000117' id='54f7f75ac8e506d879000117'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>order_target_percent</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<span class='posted-at'>edited </span>
<span UTCms='1425559852000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=order_target_percent&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Forder-target-percent-1%3Futm_source%3Dwebsite_share%26utm_campaign%3Dorder-target-percent-1%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Forder-target-percent-1%3Futm_source%3Dwebsite_share%26utm_campaign%3Dorder-target-percent-1%26utm_medium%3Dlinkedin&amp;title=order_target_percent+%28Vladimir%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/order-target-percent-1?utm_source=website_share&amp;utm_campaign=order-target-percent-1&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Vladimir" />
<div class='body-text'>
<div class='body-text-container post-body'><p>How Quantopian function  order_target_percent calculate existing percent?<br>
A. From Initial Capital.<br>
B. From Initial Capital+Closed Position Profit.<br>
C. From Initial Capital+Closed Position Profit+Open Position Profit[0]+Cash.<br>
D. From Initial Capital+Closed Position Profit+Open Position Profit[-1]+Cash.</p>

<p>If C (the right way) then why it during backtest on minute data create orders every minute on single security with target percent 1.0 ?</p>

<p>def initialize(context):<br>
    pass<br>
def handle_data(context, data):<br>
    SPY = symbol(&#39;SPY&#39;)<br>
    order_target_percent(SPY, 1.0)</p>

<p>2007-05-02 - Buys $50,695.19, Sells $35,600.70 (244 transactions)<br>
6:31 AM<br>
SPY<br>
BUY<br>
5<br>
$148.82
$744.10
6:32 AM<br>
SPY<br>
BUY<br>
17<br>
$148.87
$2,530.79
6:33 AM<br>
SPY<br>
BUY<br>
4<br>
$148.86
$595.44
6:35 AM<br>
SPY<br>
BUY<br>
6<br>
$149.00
$894.00
6:36 AM<br>
SPY<br>
BUY<br>
7<br>
$149.06
$1,043.42</p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>29 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='54f867dec8e506f2d300025a' id='54f867dec8e506f2d300025a'>
<a href='#54f867dec8e506f2d300025a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/535a81c51f0913316a000242'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/25e01741319f428a0e81b61b4b37b406?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/535a81c51f0913316a000242'>Lucas Silva</a>
</div>
<a UTCms='1425565664000' class='quanto-date posted-at response-posted-at' href='#54f867dec8e506f2d300025a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Every minute your portfolio value changes consequently 1% of your portfolio also changes. Portfolio value is probably holding cash + closed positions using the bid/ask. If you want a function that performs daily on 1min back-test you can either use the date or schedule a function  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f892604d1a6461060003e1' id='54f892604d1a6461060003e1'>
<a href='#54f892604d1a6461060003e1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/526e9e7132901d693b000128'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/99559a0f4d9622a23096caaeede1def2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/526e9e7132901d693b000128'>Gavin Heale</a>
</div>
<a UTCms='1425576546000' class='quanto-date posted-at response-posted-at' href='#54f892604d1a6461060003e1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I dont think that is correct.  From the documentation: </p>

<p>&quot; Portfolio value is calculated as the sum of the positions value and ending cash balance. Orders are always truncated to whole shares, and percentage must be expressed as a decimal (0.50 means 50%).&quot;</p>

<p>So the above example is trying to make SPY 100% of the portfolio.  So I would assume this means there would only ever be a small amount of cash (less than the value of 1 SPY) in the portfolio. Now I can see that perhaps not 100% of the order is executed on each call to handle data but why does that lead to many transactions?  In the real world, if I put in a BUY order it can be filled using several partial fills and would still only count as one transaction.  I am also mystified as to why there are any sell orders since the code seems to ask for 100% in SPY, what scenario leads to it selling anything at all?</p>

<p>I too am confused by this behavior.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f8acc2dbd60571e800047e' id='54f8acc2dbd60571e800047e'>
<a href='#54f8acc2dbd60571e800047e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b9b56c02cabe5dae000143'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e9388ae5102f3b152fa6225f955a29d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b9b56c02cabe5dae000143'>Alisa Deychman</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1425583300000' class='quanto-date posted-at response-posted-at' href='#54f8acc2dbd60571e800047e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The order_target_percent calculates the percentage based on the current portfolio value. You can find the Zipline code here: <a href="https://github.com/quantopian/zipline/blob/98ee8efe3db6a5cf3edb6b44b675bdb3276a750b/zipline/algorithm.py#L931">https://github.com/quantopian/zipline/blob/98ee8efe3db6a5cf3edb6b44b675bdb3276a750b/zipline/algorithm.py#L931</a></p>

<p>In general, the order_target methods are robust in your algorithm and will scale as your portfolio shrinks/grows. It will seek to the target value by checking the portfolio value each minute.  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='54f8cd1b2b6ce38982000086' id='54f8cd1b2b6ce38982000086'>
<a href='#54f8cd1b2b6ce38982000086'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/526e9e7132901d693b000128'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/99559a0f4d9622a23096caaeede1def2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/526e9e7132901d693b000128'>Gavin Heale</a>
</div>
<a UTCms='1425591581000' class='quanto-date posted-at response-posted-at' href='#54f8cd1b2b6ce38982000086'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I added some debug&#39;s see what was happening.  It seems that cash accumulates in the account at certain times (do we get dividends?) and then extra equity is purchased.  To simplify the numbers, I just used $10000 and ran on daily data.</p>

<p>From the log we see cash changing:</p>

<p>2007-10-24handle_data:11DEBUGportfolio value 10760.76 : spy value 10849.95 : spy amount    71.00 : spy price   151.56 : cash    89.19 : leverage     0.99<br>
2007-10-25handle_data:11DEBUGportfolio value 10743.01 : spy value 10832.20 : spy amount    71.00 : spy price   151.31 : cash    89.19 : leverage     0.99<br>
2007-10-26handle_data:11DEBUGportfolio value 10894.95 : spy value 10984.14 : spy amount    71.00 : spy price   153.45 : cash    89.19 : leverage     0.99<br>
2007-10-29handle_data:11DEBUGportfolio value 10934.00 : spy value 11023.19 : spy amount    71.00 : spy price   154.00 : cash    89.19 : leverage     0.99<br>
2007-10-30handle_data:11DEBUGportfolio value 10867.26 : spy value 10956.45 : spy amount    71.00 : spy price   153.06 : cash    89.19 : leverage     0.99<br>
2007-10-31handle_data:11DEBUGportfolio value 10990.80 : spy value 11131.02 : spy amount    71.00 : spy price   154.80 : cash   140.22 : leverage     0.99<br>
2007-11-01handle_data:11DEBUGportfolio value 10705.38 : spy value 10845.60 : spy amount    71.00 : spy price   150.78 : cash   140.22 : leverage     0.99<br>
2007-11-02handle_data:11DEBUGportfolio value 10729.52 : spy value 10869.74 : spy amount    71.00 : spy price   151.12 : cash   140.22 : leverage     0.99<br>
2007-11-05handle_data:11DEBUGportfolio value 10663.49 : spy value 10803.71 : spy amount    71.00 : spy price   150.19 : cash   140.22 : leverage     0.99<br>
2007-11-06handle_data:11DEBUGportfolio value 10798.39 : spy value 10938.61 : spy amount    71.00 : spy price   152.09 : cash   140.22 : leverage     0.99</p>

<p>And then eventually an extra SPY is bought</p>

<p>2008-01-03handle_data:11DEBUGportfolio value 10256.66 : spy value 10396.88 : spy amount    71.00 : spy price   144.46 : cash   140.22 : leverage     0.99<br>
2008-01-04handle_data:11DEBUGportfolio value 10006.03 : spy value 10146.25 : spy amount    71.00 : spy price   140.93 : cash   140.22 : leverage     0.99<br>
2008-01-07handle_data:11DEBUGportfolio value 10043.66 : spy value 10183.88 : spy amount    71.00 : spy price   141.46 : cash   140.22 : leverage     0.99<br>
2008-01-08handle_data:11DEBUGportfolio value  9855.51 : spy value  9995.73 : spy amount    71.00 : spy price   138.81 : cash   140.22 : leverage     0.99<br>
2008-01-09handle_data:11DEBUGportfolio value 10136.16 : spy value 10135.57 : spy amount    72.00 : spy price   140.78 : cash    -0.59 : leverage     1.00<br>
2008-01-10handle_data:11DEBUGportfolio value 10209.60 : spy value 10209.01 : spy amount    72.00 : spy price   141.80 : cash    -0.59 : leverage     1.00<br>
2008-01-11handle_data:11DEBUGportfolio value 10080.72 : spy value 10080.13 : spy amount    72.00 : spy price   140.01 : cash    -0.59 : leverage     1.00</p>

<p>It appears that price &lt; cash triggers a BUY but it is not done at the price listed as it somehow got to negative cash.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f8d6542b6ce3d5550000b3' id='54f8d6542b6ce3d5550000b3'>
<a href='#54f8d6542b6ce3d5550000b3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b9b56c02cabe5dae000143'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e9388ae5102f3b152fa6225f955a29d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b9b56c02cabe5dae000143'>Alisa Deychman</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1425593944000' class='quanto-date posted-at response-posted-at' href='#54f8d6542b6ce3d5550000b3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>In the backtest, dividends are added as cash to your portfolio. Since your code is saying &quot;use all of my cash to buy SPY&quot; it takes the extra cash and reinvests it to buy more SPY shares. You can read more about the handling of dividend and M&amp;A events in the help doc: <a href="https://www.quantopian.com/help#ide-dividends">https://www.quantopian.com/help#ide-dividends</a></p>

<p>One thing to keep in mind is order_target() methods don&#39;t consider the status of open orders when they make their target calculations. They only look at the number of filled orders and then calculate the buy/sells needed to reach the target value. To prevent overbuying/overselling swings, you can add a check to the code to exit if orders are still being filled:</p>

<pre><code>handle_data(context,data):  
  if get_open_orders():  
    return  
</code></pre>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='54f8ef762b6ce3898200016f' id='54f8ef762b6ce3898200016f'>
<a href='#54f8ef762b6ce3898200016f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1425600376000' class='quanto-date posted-at response-posted-at' href='#54f8ef762b6ce3898200016f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Today order_target_percent behave much better than yesterday only 7 transaction instead 244 on first day.<br>
But there left overshot on first day of trading. It ordering 40% more than available cash and sell those positions on next two bars.  Why?</p>

<p>2 2007-05-02 - Buys $14,962,812.86, Sells $4,962,919.52 (7 transactions)<br>
6:32 AM<br>
SPY<br>
BUY<br>
34092<br>
$149.80
$5,106,981.60
6:33 AM<br>
SPY<br>
BUY<br>
33116<br>
$149.38
$4,946,934.31
6:33 AM<br>
SPY<br>
BUY<br>
11099<br>
$149.79
$1,662,519.21
6:34 AM<br>
SPY<br>
BUY<br>
21775<br>
$149.06
$3,245,781.50
6:34 AM<br>
SPY<br>
SELL<br>
-11532<br>
$148.57
($1,713,263.11)
6:35 AM<br>
SPY<br>
SELL<br>
-21819<br>
$148.94
($3,249,656.40)
6:36 AM<br>
SPY<br>
BUY<br>
4<br>
$149.06
$596.24</p>

<p>The rest orders are dividends reinvestment, but why it happens <strong>six week later</strong> on last day of the month in Jan, Apr, Jul, Oct?<br>
SPY pays dividends on quarterly expiration Friday in Mar, Jun, Sep, Dec.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54ffd893253736d694000497' id='54ffd893253736d694000497'>
<a href='#54ffd893253736d694000497'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1426053269000' class='quanto-date posted-at response-posted-at' href='#54ffd893253736d694000497'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Why Q buying 40% more than available cash and sell those positions on next two bars?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5500332f94f4e7ae98000642' id='5500332f94f4e7ae98000642'>
<a href='#5500332f94f4e7ae98000642'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4ec777fc345f20000e000008'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d1c340e13d187142fc34a5cff3a5eed5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4ec777fc345f20000e000008'>James Jack</a>
</div>
<a UTCms='1426076465000' class='quanto-date posted-at response-posted-at' href='#5500332f94f4e7ae98000642'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Vlad,</p>

<ol>
<li>Your algorithm is using 10,000,000 dollars and trying to buy all that in 1 minute. If an order is too big, Quantopian assumes the order would fill over 2 or 3 minutes.<br></li>
<li>order_target_percent() <strong>does not check for open orders</strong> which have not fully filled yet. So the over-ordering is because of this.</li>
</ol>

<p>I have added lots of PRINT statements to your example to show the state of open orders:</p>

<pre><code>2007-05-02 PRINT 13:31 : SPY=148.79, volume=395908, SPYshares=0, open position value=0.00  
2007-05-02 PRINT 13:31 : NO OPEN ORDERS  
2007-05-02 PRINT 13:31 : target_value=10000000.00, req_shares=67208  
2007-05-02 PRINT 13:31 : OPEN ORDER 2007-05-02 13:31:00+00:00 [amt=67208,filled=0,left=67208]  
2007-05-02 PRINT --  
2007-05-02 PRINT 13:32 : SPY=148.84, volume=136368, SPYshares=34092, open position value=5074253.28  
2007-05-02 PRINT 13:32 : OPEN ORDER 2007-05-02 13:31:00+00:00 [amt=67208,filled=34092,left=33116]  
2007-05-02 PRINT 13:32 : target_value=9967263.16, req_shares=32874  
2007-05-02 PRINT 13:32 : OPEN ORDER 2007-05-02 13:31:00+00:00 [amt=67208,filled=34092,left=33116]  
2007-05-02 PRINT 13:32 : OPEN ORDER 2007-05-02 13:32:00+00:00 [amt=32874,filled=0,left=32874]  
2007-05-02 PRINT --  
2007-05-02 PRINT 13:33 : SPY=148.83, volume=176860, SPYshares=78307, open position value=11654430.81  
2007-05-02 PRINT 13:33 : OPEN ORDER 2007-05-02 13:32:00+00:00 [amt=32874,filled=11099,left=21775]  
2007-05-02 PRINT 13:33 : target_value=9937991.59, req_shares=-11532  
2007-05-02 PRINT 13:33 : OPEN ORDER 2007-05-02 13:32:00+00:00 [amt=32874,filled=11099,left=21775]  
2007-05-02 PRINT 13:33 : OPEN ORDER 2007-05-02 13:33:00+00:00 [amt=-11532,filled=0,left=-11532]  
2007-05-02 PRINT --  
2007-05-02 PRINT 13:34 : SPY=148.90, volume=233100, SPYshares=88550, open position value=13185095.00  
2007-05-02 PRINT 13:34 : NO OPEN ORDERS  
2007-05-02 PRINT 13:34 : target_value=9936138.75, req_shares=-21819  
2007-05-02 PRINT 13:34 : OPEN ORDER 2007-05-02 13:34:00+00:00 [amt=-21819,filled=0,left=-21819]  
2007-05-02 PRINT --  
2007-05-02 PRINT 13:35 : SPY=148.97, volume=1484000, SPYshares=66731, open position value=9940917.07  
2007-05-02 PRINT 13:35 : NO OPEN ORDERS  
2007-05-02 PRINT 13:35 : target_value=9941612.41, req_shares=4  
2007-05-02 PRINT 13:35 : OPEN ORDER 2007-05-02 13:35:00+00:00 [amt=4,filled=0,left=4]  
2007-05-02 PRINT --  
2007-05-02 PRINT 13:36 : SPY=149.03, volume=490577, SPYshares=66735, open position value=9945517.05  
2007-05-02 PRINT 13:36 : NO OPEN ORDERS  
2007-05-02 PRINT 13:36 : target_value=9945616.15, req_shares=0  
2007-05-02 PRINT 13:36 : NO OPEN ORDERS  
2007-05-02 PRINT --  
</code></pre>

<p>Which account for all 7 transactions.<br>
Hope that is now clear!</p>

<p>You can get round this by using</p>

<pre><code>    # check there are no current open orders  
    if not sid in get_open_orders().keys():  
        order_target_percent(sid, target)  
</code></pre>

<p>and you get the following output</p>

<pre><code>2007-05-02 PRINT 13:31 : SPY=148.79, volume=395908, SPYshares=0, open position value=0.00  
2007-05-02 PRINT 13:31 : NO OPEN ORDERS  
2007-05-02 PRINT 13:31 : target_value=10000000.00, req_shares=67208  
2007-05-02 PRINT 13:31 : OPEN ORDER 2007-05-02 13:31:00+00:00 [amt=67208,filled=0,left=67208]  
2007-05-02 PRINT --  
2007-05-02 PRINT 13:32 : SPY=148.84, volume=136368, SPYshares=34092, open position value=5074253.28  
2007-05-02 PRINT 13:32 : OPEN ORDER 2007-05-02 13:31:00+00:00 [amt=67208,filled=34092,left=33116]  
2007-05-02 PRINT 13:32 : target_value=9967263.16, req_shares=32874  
2007-05-02 PRINT 13:32 : OPEN ORDER 2007-05-02 13:31:00+00:00 [amt=67208,filled=34092,left=33116]  
2007-05-02 PRINT --  
2007-05-02 PRINT 13:33 : SPY=148.83, volume=176860, SPYshares=67208, open position value=10002566.64  
2007-05-02 PRINT 13:33 : NO OPEN ORDERS  
2007-05-02 PRINT 13:33 : target_value=9948648.71, req_shares=-362  
2007-05-02 PRINT 13:33 : OPEN ORDER 2007-05-02 13:33:00+00:00 [amt=-362,filled=0,left=-362]  
2007-05-02 PRINT --  
2007-05-02 PRINT 13:34 : SPY=148.90, volume=233100, SPYshares=66846, open position value=9953369.40  
2007-05-02 PRINT 13:34 : NO OPEN ORDERS  
2007-05-02 PRINT 13:34 : target_value=9953342.40, req_shares=0  
2007-05-02 PRINT 13:34 : NO OPEN ORDERS  
2007-05-02 PRINT --  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5500664289242ee80b000070' id='5500664289242ee80b000070'>
<a href='#5500664289242ee80b000070'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1426089541000' class='quanto-date posted-at response-posted-at' href='#5500664289242ee80b000070'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The elephant in the room; <strong>why</strong> does that ordering function not take into account  open orders? Seems like a no-brainer, and the first step to relieving everyone of having to put the same tedious boilerplate in every algorithm in python.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='550067be4e2a84e95d000063' id='550067be4e2a84e95d000063'>
<a href='#550067be4e2a84e95d000063'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1426089921000' class='quanto-date posted-at response-posted-at' href='#550067be4e2a84e95d000063'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>James,</p>

<p>If order_target_percent() does not check for open orders why not to incorporate</p>

<p>if not sid in get_open_orders().keys():  into the function?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='550069170f44affe3c00006a' id='550069170f44affe3c00006a'>
<a href='#550069170f44affe3c00006a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1426090267000' class='quanto-date posted-at response-posted-at' href='#550069170f44affe3c00006a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>To be correct, they&#39;d probably want to add code that modified outstanding orders to the new target. Of course if they do that, they maybe need to handle the possibility that an old order gets filled before the cancel-and-replace or modify is committed, and so then they need to resubmit a new delta order.</p>

<p>Perhaps they hope to leave all this complexity to algo writers.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5500696c89e4d8736a000063' id='5500696c89e4d8736a000063'>
<a href='#5500696c89e4d8736a000063'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1426090351000' class='quanto-date posted-at response-posted-at' href='#5500696c89e4d8736a000063'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>To be correct, they&#39;d probably want to add code that modified outstanding orders to the new target. Of course if they do that, they maybe need to handle the possibility that an old order gets filled before the cancel-and-replace or modify is committed, and so then they need to resubmit a new delta order.</p>

<p>Perhaps they hope to leave all this complexity to algo writers.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='550070274e2a84e95d000093' id='550070274e2a84e95d000093'>
<a href='#550070274e2a84e95d000093'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4ec777fc345f20000e000008'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d1c340e13d187142fc34a5cff3a5eed5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4ec777fc345f20000e000008'>James Jack</a>
</div>
<a UTCms='1426092073000' class='quanto-date posted-at response-posted-at' href='#550070274e2a84e95d000093'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>As Simon points out, its probably not that easy.There is no certainty that the order will ever get executed completely. </p>

<p>It would be nice to see a function which calculates the percentage taking into account what is still left open though.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5500726089242e276100008a' id='5500726089242e276100008a'>
<a href='#5500726089242e276100008a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1426092644000' class='quanto-date posted-at response-posted-at' href='#5500726089242e276100008a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Well, I would add that it&#39;s easier for them, in event-driven C++ or Java, than it is for us, in once-per-minute python! :)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='550074efc25427e9ab000096' id='550074efc25427e9ab000096'>
<a href='#550074efc25427e9ab000096'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4ec777fc345f20000e000008'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d1c340e13d187142fc34a5cff3a5eed5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4ec777fc345f20000e000008'>James Jack</a>
</div>
<a UTCms='1426093297000' class='quanto-date posted-at response-posted-at' href='#550074efc25427e9ab000096'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The thing is, anyone ordering 10,000,000 dollars of SPY in a single order is, of course, clinically insane. The way they do this is by building it up in small amounts, based on time (e.g. every 10 minutes plus some random component) and volume (e.g. 3% of overall volume).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='55007d320f44affe3c0000be' id='55007d320f44affe3c0000be'>
<a href='#55007d320f44affe3c0000be'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1426095412000' class='quanto-date posted-at response-posted-at' href='#55007d320f44affe3c0000be'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Yup, in real life, one would be using an IB-provided smart execution algo, VWAP or otherwise.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='550081980f44affe3c0000ce' id='550081980f44affe3c0000ce'>
<a href='#550081980f44affe3c0000ce'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1426096538000' class='quanto-date posted-at response-posted-at' href='#550081980f44affe3c0000ce'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Dear Quantopian Support Team,</p>

<p>It looks like Q using x% of overall volume limitation.<br>
But how big is x?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='55008571c2542750390000f1' id='55008571c2542750390000f1'>
<a href='#55008571c2542750390000f1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1426097527000' class='quanto-date posted-at response-posted-at' href='#55008571c2542750390000f1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>25% of the bar&#39;s volume I believe.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='550085d989e4d84b690000eb' id='550085d989e4d84b690000eb'>
<a href='#550085d989e4d84b690000eb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4ec777fc345f20000e000008'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d1c340e13d187142fc34a5cff3a5eed5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4ec777fc345f20000e000008'>James Jack</a>
</div>
<a UTCms='1426097627000' class='quanto-date posted-at response-posted-at' href='#550085d989e4d84b690000eb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Its in the help doc:</p>

<blockquote>
<p>Slippage must be defined in the initialize method. It has no effect if defined in handle_data(). If you do not specify a slippage method, slippage defaults to VolumeShareSlippage(volume_limit=0.25, price_impact=0.1).<br>
To set slippage, use the set_slippage method and pass in FixedSlippage, VolumeShareSlippage, or a custom slippage model that you define.</p>
</blockquote>

<p><a href="https://github.com/quantopian/zipline/blob/c49b00e9a104d26939091002990fafe3e58bdc7f/zipline/finance/slippage.py#L215">someone more familiar with zipline may explain it in words?</a></p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='550096a3d375be977c000144' id='550096a3d375be977c000144'>
<a href='#550096a3d375be977c000144'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4ec777fc345f20000e000008'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d1c340e13d187142fc34a5cff3a5eed5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4ec777fc345f20000e000008'>James Jack</a>
</div>
<a UTCms='1426101926000' class='quanto-date posted-at response-posted-at' href='#550096a3d375be977c000144'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>So I can&#39;t decipher everything in that code but essentially its:</p>

<ul>
<li>if order amount &gt; 25% of this bar&#39;s volume, you get a fill for 25% of the bar&#39;s volume and the rest is left for next minute.<br></li>
<li>volume_share = the minimum of  [0.25, volume of <strong>all</strong> your transactions for this stock processed in this minute / this bar&#39;s volume]<br></li>
<li>simulated_impact = volume_share^2 * the &#39;price_impact&#39; as 0.1 by default * last traded price                    (this is negative for shorts)<br></li>
<li>the price you get for this transaction is  =  last traded price + simulated_impact</li>
</ul>

<p>so for a huge order (&gt;25% of volume) for a stock trading at $110 with a minutely volume of 2000, then you will get it at...<br>
volume = 0.25*2000 = 500 for first transaction<br>
simulated_impact = 0.25^2 * 0.1 * 110 = 0.6875<br>
so you got 500 volume for price of 110+0.6875 = $110.6875 each</p>

<p>Or at least something like that...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5500ae644e2a842d59000188' id='5500ae644e2a842d59000188'>
<a href='#5500ae644e2a842d59000188'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1426108006000' class='quanto-date posted-at response-posted-at' href='#5500ae644e2a842d59000188'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Regarding the problem of open orders &amp; order_target_percent(), one brute-force approach is just to cancel all open orders prior to applying order_target_percent(), although I&#39;m wondering if this could be done confidently in a single call to handle_data.  It seems that the right way to do it would be to cancel the open orders, confirm that they are canceled, and then apply order_target_percent() with the new allocation (a minimum of two calls to handle_data).  Otherwise, if the order cancellation and order_target_percent() are both called within the same bar, it could be such that more ordering is done than desired (a question for the Quantopian staff)?  --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='55028cf84f8cb05d600001d3' id='55028cf84f8cb05d600001d3'>
<a href='#55028cf84f8cb05d600001d3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5258725aa09fa7ebaa000024'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7734b86e32e834268bee6749eb322fb4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5258725aa09fa7ebaa000024'>David Edwards</a>
</div>
<a UTCms='1426230522000' class='quanto-date posted-at response-posted-at' href='#55028cf84f8cb05d600001d3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello everybody,<br>
This has to be the most common wall people run into. I&#39;ve explored a few ways to get consistent functionality regardless of pending orders, but everything seems to have unintended consequences, mostly because limit/stop orders throw a wrench in everything. In my mind, the biggest reason for not including open orders is because it&#39;s not right for an execution engine to &#39;assume&#39; it knows how the developer wants to handle pending orders. All the ugliness around partial fills, open orders, rejected orders, etc. are decisions the trader should consider. I am coming at this with live trading in mind, but I&#39;d argue it&#39;s good practice to run into these issues while backtesting too.</p>

<p>The attached algo is a re-write of the &quot;order_target&quot; style functions in zipline, I added a couple extra keyword arguments to allow you to either include or cancel any open orders. Including the open orders seems intuitively more correct to me if you only use market orders (faster in backtests too). Canceling is probably the better choice for limits because you most likely missed the market and have a stale limit on the book. For stop orders, it depends on why that stop is there, you may or may not want to include it in your position.  </p>

<p>This issue is pretty annoying, but because there&#39;s so many possible scenarios and different order types (hopefully more coming), the best solution is to make no assumptions and leave you to deal with the nitty gritty.</p>

<p>Best,<br>
David  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5502b248b09017a8bf000262' id='5502b248b09017a8bf000262'>
<a href='#5502b248b09017a8bf000262'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1426240074000' class='quanto-date posted-at response-posted-at' href='#5502b248b09017a8bf000262'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Fine idea there, makes for a tidy way to keep things organized.  Thanks for sharing that, worth checking out.</p>

<p>Quick side note and pardon me as I don&#39;t want to detract from the important subject being discussed, I wish this part could be tiny 6pt font barely readable:  700% percent returns are acceptable, I guess, for a couple of months, although there is an important thing for folks to keep in mind, the code above borrowed $15 million to buy SVXY 1,410 times and never sold, only appears that impressive b/c Quantopian&#39;s chart and metrics like Sharpe are based on initial capital and currently (3-2015) ignore margin/borrowing.  <a href="https://www.quantopian.com/posts/returns">more info</a><br>
An easy way to watch out for that is to use this occasionally:</p>

<pre><code>record(cash = context.portfolio.cash)  
</code></pre>

<p>Anyway, alright, back to the topic, the examples, extending functions and what they do, and orders. I&#39;ve been using something a little bit similar, trade() where all buys/sells take place. </p>

<p>Incidentally at some point I&#39;m hoping to see a variation on the typical order_target_percent() algos that could soften the occasional selling at a loss that occurs, somehow.</p>

<p>Today I was writing some code for the tracking of orders that might relate to this and I find it clarifies more than I had expected:<br>
It uses context.orders (as a dictionary with order id&#39;s as keys, and values simply as 1 or the number of shares etc, or could be a list instead), storing only the id any time a new order is made, everything else in the order object is thrown away for now.  Then in each bar, iterate thru context.orders and use get_order( the id ) to retrieve the order object. This dipsy-doodle is because once filled, the order is otherwise gone and won&#39;t show up with get_open_orders(). So, knowing when the order is filled (and to what degree) can be useful in a lot of ways, plus the commissions are there too.  (Just wish it had the official fill price for certainty).  Once the filled info is collected, that key (id) in context.orders is deleted. That&#39;s the general idea I hope can help someone at some point in some way.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='550321594f8cb05d6000043d' id='550321594f8cb05d6000043d'>
<a href='#550321594f8cb05d6000043d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1426268507000' class='quanto-date posted-at response-posted-at' href='#550321594f8cb05d6000043d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;ll just reiterate that I think it&#39;s a mistake to casually delegate all this algo writers, who have the distinct handicap that they are working in python, and only get one shot per minute to deal with it, not to mention that tedious event-driven order handling code <strong>is not what they came here to do</strong>.  The promise of a function like order_target_percent is that, upon reading it, the trader thinks, &quot;Thank god this method exists, because I have an asset allocation algorithm I&#39;ve been working on, and I just want the OMS to work the orders necessary to get me to my target allocation.  Now, where are the arguments that specify the aggressiveness and timeframe?&quot;.  Oh wait, there aren&#39;t any, because this method isn&#39;t order_target_percent, it&#39;s order_immediately_at_market_the_delta_between_the_current_believed_portfolio_and_target_percent.</p>

<p>Honestly, and I feel like I have been repeating myself on this point, providing and owning the smart OMS and risk management components is THE killer feature, in my mind.  Disowning this responsibility is a huge turnoff.  </p>

<p>Frankly, if people are going to be compelled to each write a real OMS in every Quantopian algorithm, they are sure going to hate doing it in python, once a minute, from a partially reconstructed history of what happened sometime in the last minute.  My 2c.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5503250ee674bcc4980004ac' id='5503250ee674bcc4980004ac'>
<a href='#5503250ee674bcc4980004ac'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1426269456000' class='quanto-date posted-at response-posted-at' href='#5503250ee674bcc4980004ac'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Also, perhaps you should do a poll of how many people actually use order_target_* methods in combination with stops, or even limits.  I would bet that 99% don&#39;t, stops and limits are for jockeying a single asset, order_target_percent is to track a moving target.  In fact, it might be worthwhile to make it clear that this is an OMS-level function, perhaps something like (pardon my terrible python):</p>

<p>oms.order_target_percent(weightedSids=[12345,0.5,345345.0.5], legExecutionAlgo={&#39;Name&#39;:&#39;VWAP&#39;,&#39;Aggressiveness&#39;:0.1,&#39;Timeframe&#39;,&#39;2h&#39;}, keepLegsBalancedToWithin=0.05)</p>

<p>If such an OMS algorithm was running, I&#39;d personally be happy to have the whole thing cancelled the moment my algo made any manual orders, to avoid conflict.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='550378f11bd42037e600011d' id='550378f11bd42037e600011d'>
<a href='#550378f11bd42037e600011d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51d125a71144e60865000044'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b7dd86784deedc047d5ad0fb30378bdd?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51d125a71144e60865000044'>Peter Bakker</a>
</div>
<a UTCms='1426290932000' class='quanto-date posted-at response-posted-at' href='#550378f11bd42037e600011d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>At first I was charmed with the simplicity of the function and when I saw the behaviour in live trading I quickly stopped the algorithm and rewrote the order function myself. One flaw is that it looks at cash.... The order function should not read the cash balance but the settled cash. Even settled cash needs to have a cushion as it does not reflect orders already in play so at the moment I use the following to rebalance: the settled cash minus value of current orders*1.01 minus the estimated transaction cost. Then I execute every minute one leg if the previous leg was executed where I readjust the limit price in case it moved. This is at the moment in experiment mode and I&#39;ll post it when it works properly... </p>

<p>I need to build the function such that it can handle cash accounts... First execute the sell parts of the rebalance and then during the next 3 days iteratively execute the buy parts as it takes up to 3 days to get the sale reflected in Settled Cash. Big disadvantage is off course that the price will move in 3 days and that the rebalancing will be imperfect and could even be damn dangerous when you are hedging legs against each other and the hedge starts moving. Because of this delay I&#39;ll adjust the # of shares to the price movement so the value of the legs are defined. </p>

<p>A python guru can make a class structure out of it as I&#39;m just a simple algo builder. </p>

<p>Did anyone make something like this already?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='550405db41de94e106000449' id='550405db41de94e106000449'>
<a href='#550405db41de94e106000449'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1426327005000' class='quanto-date posted-at response-posted-at' href='#550405db41de94e106000449'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>There&#39;s a potential problem with this check:</p>

<pre><code>handle_data(context,data):  
  if get_open_orders():  
    return  
</code></pre>

<p>Presently, under live real-money trading (and paper trading at IB, as well, I think), Q automatically cancels all open orders at the market close.  However, if this practice is ever discontinued, then if an order get botched up and hangs around at IB, you&#39;ll never be able to order the security again.  So, it would seem to be a good practice to also do a periodic sweep of open orders, cancelling any potential stragglers.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5504d0de2d28d776c000007d' id='5504d0de2d28d776c000007d'>
<a href='#5504d0de2d28d776c000007d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5258725aa09fa7ebaa000024'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7734b86e32e834268bee6749eb322fb4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5258725aa09fa7ebaa000024'>David Edwards</a>
</div>
<a UTCms='1426378976000' class='quanto-date posted-at response-posted-at' href='#5504d0de2d28d776c000007d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant, you should definitely periodically sweep through an cancel open orders, you should really do it at the end of each day since that&#39;s what happens in live trading, schedule_function makes that pretty easy to do. It really shouldn&#39;t make a difference if Q stops canceling orders at EOD, IB&#39;s default &quot;time-in-force&quot; is a DAY order, so they would still get cancelled by IB even if Q didn&#39;t explicitly do it. </p>

<p>An issue I see is almost the opposite scenario where backtests are inaccurate because limit orders can fill several days later in backtests when they would have been cancelled at EOD in live trading.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='55233d6241b13c1c5c0005dd' id='55233d6241b13c1c5c0005dd'>
<a href='#55233d6241b13c1c5c0005dd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4ec777fc345f20000e000008'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d1c340e13d187142fc34a5cff3a5eed5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4ec777fc345f20000e000008'>James Jack</a>
</div>
<a UTCms='1428372836000' class='quanto-date posted-at response-posted-at' href='#55233d6241b13c1c5c0005dd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Peter,</p>

<p>did you end up getting anywhere with that function? Just wondering... would be good to look at.  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/order-target-percent-1'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/order-target-percent-1'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#15737070717774767e556460747b617a657c747b3b767a78">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

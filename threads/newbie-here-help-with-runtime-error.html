<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
Newbie here - help with runtime error
</title>
<meta content='I am trying to implement this algo, but I get a runtime error on line 252 Would someone know what is wrong? I copy the algo here in case you cant see the source code &quot;&quot;&quot;Select 10 stocks from Q500US universe based on following ranking system:  1) VALUATION     60%      - Price to Book ratio (lowest).......33%      - TTM PE (lowest)....................33%      - 5 year Sales % CAGR (highest)......33%  &lt;--- coded with growth_score, but not exactly correct, i.e. should be only growth of sales  2)...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="D+zGG+thDZtXD2gRltolhi35fuZHKSHcczxZbg8ZZohzirBWSZffeO4SMSDZNY3yFXddjz3lNMfxM4IEpVwEMw==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/newbie-here-help-with-runtime-error' property='og:url'>
<meta content='Newbie here - help with runtime error' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/newbie-here-help-with-runtime-error' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='Newbie here - help with runtime error' property='og:title'>
<meta content='I am trying to implement this algo, but I get a runtime error on line 252 Would someone know what is wrong? I copy the algo here in case you cant see the source code &quot;&quot;&quot;Select 10 stocks from Q500US universe based on following ranking system:  1) VALUATION     60%      - Price to Book ratio (lowest).......33%      - TTM PE (lowest)....................33%      - 5 year Sales % CAGR (highest)......33%  &lt;--- coded with growth_score, but not exactly correct, i.e. should be only growth of sales  2)...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/newbie-here-help-with-runtime-error">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='59ecc8283549240009389494'>
<div class='post-container' data-post-id='59ecc8283549240009389494' id='59ecc8283549240009389494'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>Newbie here - help with runtime error</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59a335b0f6a63f00101c2bd6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f38a6b789130c6b46006fd564288d828?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59a335b0f6a63f00101c2bd6'>Matteo Busetti</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1508689960000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=Newbie here - help with runtime error&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fnewbie-here-help-with-runtime-error%3Futm_source%3Dwebsite_share%26utm_campaign%3Dnewbie-here-help-with-runtime-error%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fnewbie-here-help-with-runtime-error%3Futm_source%3Dwebsite_share%26utm_campaign%3Dnewbie-here-help-with-runtime-error%26utm_medium%3Dlinkedin&amp;title=Newbie+here+-+help+with+runtime+error+%28Matteo+Busetti%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/newbie-here-help-with-runtime-error?utm_source=website_share&amp;utm_campaign=newbie-here-help-with-runtime-error&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Matteo Busetti" />
<div class='body-text'>
<div class='body-text-container post-body'><p>I am trying to implement this algo, but I get a runtime error on line 252<br>
Would someone know what is wrong?</p>

<p>I copy the algo here in case you cant see the source code</p>

<pre><code>&quot;&quot;&quot;
Select 10 stocks from Q500US universe based on following ranking system:  
1) VALUATION     60%  
    - Price to Book ratio (lowest).......33%  
    - TTM PE (lowest)....................33%  
    - 5 year Sales % CAGR (highest)......33%  &lt;--- coded with growth_score, but not exactly correct, i.e. should be only growth of sales  
2) MOMENTUM     40%  
    - 3 Months Pct Change................50%  
    - 3 Months Pct Change 3 Months ago...50%


Rules:  
- Entry if SMA50 &gt; SMA200 with following settings:  
- Exit if SMA50 &lt;= SMA200 with following settings:


&quot;&quot;&quot;



from quantopian.algorithm import attach_pipeline,pipeline_output  
from quantopian.pipeline import Pipeline  
from quantopian.pipeline.data.builtin import USEquityPricing  
from quantopian.pipeline.factors import AverageDollarVolume,SimpleMovingAverage  
from quantopian.pipeline.filters.morningstar import Q500US  
from quantopian.pipeline.data import morningstar  
# from quantopian.pipeline.data import Fundamentals as income_statement  
# from quantopian.pipeline.data import Fundamentals as balance_sheet  
from quantopian.pipeline.data import Fundamentals as valuation_ratios  
from quantopian.pipeline.data import Fundamentals as valuation  
# from quantopian.pipeline.classifiers.fundamentals import Sector  
from quantopian.pipeline import CustomFactor  
import numpy

#========================================================================================

&#39;&#39;&#39;
Set constants  
&#39;&#39;&#39;

# Set quarter look-back period  
trading_days_in_year = 252  
Q1=-1  
Q2=0-(trading_days_in_year/4)  
Q3=0-(trading_days_in_year/4)*2  
Q4=0-(trading_days_in_year/4)*3

# Set number of stocks going long during positive market trends  
target_stocks = 10

#Set Max leverage  
stocks_long_max_leverage = +1.0

spy = sid(8554)

#========================================================================================

def initialize(context):  
    &quot;&quot;&quot;  
    Called once at the start of the algorithm.  
    &quot;&quot;&quot;  
    # Rebalance every day, 1 hour after market open.  
    schedule_function(my_rebalance, date_rules.every_day(),time_rules.market_open(minutes=5))  
    # Record tracking variables at the end of each day.  
    schedule_function(my_record_vars, date_rules.every_day(), time_rules.market_close())  
    # # Import SPY for 130/30 portfolio  
    # context.spy = sid(8554)  
    # # Import IEI for adverse market conditions  
    # context.iei = sid(33151)  
    my_pipe = make_pipeline()  
    attach_pipeline(my_pipe,&#39;my_pipeline&#39;)  
    # Keep track of market conditions  
    context.spy_uptrend = False  
    context.spy_downtrend = False  
#========================================================================================  
&#39;&#39;&#39;
RELATIVE STRENGTH SIGNALS  
&#39;&#39;&#39;

# 3 months momentum  
class Momentum3M(CustomFactor):  
    # Pre-declare inputs and window_length  
    inputs = [USEquityPricing.close]  
    window_length = 62  
    # Compute factor1 value  
    def compute(self, today, assets, out, close):  
        out[:] = close[-2]/close[-62]  
# 3 months momentum 3 months ago  
class Momentum3M3M(CustomFactor):  
    # Pre-declare inputs and window_length  
    inputs = [USEquityPricing.close]  
    window_length = 120  
    # Compute factor2 value  
    def compute(self, today, assets, out, close):  
        out[:] = close[-60]/close[-120]   


#========================================================================================

&#39;&#39;&#39;VALUATION RATIOS&#39;&#39;&#39;

# Calculate trailing 12 months EPS sum  
class EPS_TTM(CustomFactor):  
    inputs = [morningstar.earnings_report.basic_eps]  
    window_length = trading_days_in_year  
    def compute(self, today, asset_ids, out, eps):  
        out[:] = eps[Q1] + eps[Q2] + eps[Q3] + eps[Q4]


# Latest Price to Book ratio  
class Price_to_book(CustomFactor):  
    inputs = [morningstar.valuation_ratios.pb_ratio]  
    window_length = 2  
    def compute(self, today, asset_ids, out, pb):  
        out[:] = pb[-1]

# Past 5 years revenue growth rate  
class Growth5yr(CustomFactor):  
    inputs = [morningstar.asset_classification.growth_score]  
    window_length = trading_days_in_year  
    def compute(self, today, asset_ids, out, value):  
        out[:] = value[-1]

#========================================================================================

def make_pipeline():  
    # Base universe set to the Q500US  
    base_universe = Q500US()  
    &#39;&#39;&#39;  
    Import momentum signals  
    &#39;&#39;&#39;  
    momentum3M = Momentum3M()  
    # pipe.add(momentum3M, &#39;momentum3M&#39;)  
    momentum3M3M = Momentum3M3M()  
    # pipe.add(momentum3M3M, &#39;momentum3M3M&#39;)

    &#39;&#39;&#39;  
    Rank momentum signals  
    &#39;&#39;&#39;  
    momentum3M_rank = momentum3M.rank(mask=base_universe, ascending=False)  
    # pipe.add(momentum3M_rank, &#39;mom3M_rank&#39;)  
    momentum3M3M_rank = momentum3M3M.rank(mask=base_universe, ascending=False)  
    # pipe.add(momentum3M3M_rank, &#39;mom3M3M_rank&#39;)  

    # Combine momentum ranking  
    mom_comb = (momentum3M_rank*0.5 + momentum3M3M_rank*0.5)  
    # my_pipe.add(mom_comb, &#39;Momentum combination&#39;)  
    # Rank the mom_comb  
    mom_rank = mom_comb.rank(mask=base_universe, ascending=False)  
    # pipe.add(mom_rank, &#39;Momentum Rank&#39;)  

    &#39;&#39;&#39;  
    Valuation ratios  
    &#39;&#39;&#39;  
    # Last quarter Price to Book ratio  
    pb_ratio = Price_to_book()  
    # Get last closing price  
    yesterday_close = USEquityPricing.close.latest  
    # Trailing 12 months PE ratio  
    eps_ttm = EPS_TTM()  
    pe_ttm =  eps_ttm / yesterday_close

    # 5 year growth  
    growth = Growth5yr()  
    # growth = morningstar.asset_classification.growth_score.latest  
    &#39;&#39;&#39;  
    Rank valuation ratios  
    &#39;&#39;&#39;  
    # dividend yield  
    pb_rank = pb_ratio.rank(mask=base_universe, ascending=True)  
    pe_rank = pe_ttm.rank(mask=base_universe, ascending=True)  
    growth_rank = growth.rank(mask=base_universe, ascending=False)  

    # Combine Valuation ranking  
    val_comb = (pb_rank*0.33 + pe_rank*0.33 + growth_rank*0.33)  
    # Rank the val_comb  
    val_rank = val_comb.rank(mask=base_universe, ascending=False)  
    &#39;&#39;&#39;  
    Combined Total Rank (Momentum + Valuation)  
    &#39;&#39;&#39;  
    comb = (val_rank * 0.6 + mom_rank * 0.4)  
    # Rank the combined ranking  
    comb_rank = comb.rank(mask=base_universe, ascending=False)  

    &#39;&#39;&#39;  
    Return values  
    &#39;&#39;&#39;  
    pipe = Pipeline(  
        screen = base_universe,  
        columns = {  
            &#39;Mom Value&#39;: mom_comb,  
            &#39;Val Value&#39;:val_comb,  
            &#39;Total Ranking&#39;:comb_rank  
        }  
    )  
    return pipe

#========================================================================================

def before_trading_start(context, data):  
    &quot;&quot;&quot;  
    Called every day before market open.  
    &quot;&quot;&quot;  
    context.output = pipeline_output(&#39;my_pipeline&#39;)  
    # These are the long securities that we are interested in trading each day in favourable mkt conditions  
    # i.e. SMA50 &gt; SMA200  
    context.long_list = context.output.sort([&#39;comb_rank&#39;], ascending=False).iloc[:target_stocks]  


#========================================================================================

def my_assign_weights(context, data):  
    &quot;&quot;&quot;  
    Assign weights to securities that we want to order.  
    &quot;&quot;&quot;  
    pass

#========================================================================================

def my_rebalance(context,data):  
    &quot;&quot;&quot;  
    Execute orders according to our schedule_function() timing.  
    &quot;&quot;&quot;  
    # Check that list of stocks to buy is not empty  
    try:  
        long_stocks_weight = stocks_long_max_leverage / float(len(context.long_list))  
    except ZeroDivisionError:  
        long_stocks_weight = 0.0  
        log.info(&#39;no stocks to buy today&#39;)  
    # Calcualte SMA50 and SMA200 for entry/exit and hedge rules  
    sma_50 = SimpleMovingAverage(inputs=[USEquityPricing.close], window_length=50, mask=spy)  
    sma_200 = SimpleMovingAverage(inputs=[USEquityPricing.close], window_length=200, mask=spy)  
    # When SMA50 &gt; SMA200 go 130% long on list of stocks and 30% short on SPY  
    if sma_50 &gt; sma_200:  
        for long_stock in context.long_list.index:  
            if data.can_trade(long_stock):  
                order_target_percent(long_stock, long_stocks_weight)  
        context.spy_uptrend = True  
        context.spy_downtrend = False  
    # When SMA50 &lt;= SMA200 go 100% long on bond ETF  
    elif sma_50 &lt;= sma_200:  
        order_target_percent(long_stock, 0.0)  
        context.spy_uptrend = False  
        context.spy_downtrend = True  

        # for stock in context.portfolio.positions.iterkeys():  
        #     # if stock not in context.long_list.index and stock not in context.short_list.index:  
        #     if stock not in context.long_list.index:  
        #         order_target(stock, 0)

#========================================================================================

def my_record_vars(context, data):  
    &quot;&quot;&quot;  
    Plot variables at the end of each day.  
    &quot;&quot;&quot;  
    # Record and plot the leverage of our portfolio over time.  
    record(leverage = context.account.leverage)  
    print &quot;Long List&quot;  
    log.info(&quot;\n&quot; + str(context.long_list.sort([&#39;comb_rank&#39;], ascending=True)))  


#========================================================================================

def handle_data(context,data):  
    &quot;&quot;&quot;  
    Called every minute.  
    &quot;&quot;&quot;  
    pass

#========================================================================================

# def daily_clean(context, data):  
#     for stock in context.portfolio.positions:  
#         if stock not in context.security_set and data.can_trade(stock):  
#             order_target_percent(stock, 0)

</code></pre>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>11 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='59ed16f69569220009788493' id='59ed16f69569220009788493'>
<a href='#59ed16f69569220009788493'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/594000044ba376000d1b8349'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d3463553dff276fc7bdb6e50f2ead18a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/594000044ba376000d1b8349'>Mikko Nevaluoto</a>
</div>
<a UTCms='1508710134000' class='quanto-date posted-at response-posted-at' href='#59ed16f69569220009788493'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Matteo,</p>

<p>I copied your code and got run time error on line 207 which is strange cause you say you got it on line 252. My error was caused &#39;comb_rank&#39;. You have defined Pipeline colums as &#39;Total Ranking&#39;:comb_rank, but you&#39;ve used &#39;comb_rank&#39; in following lines:</p>

<p>context.long_list = context.output.sort([&#39;comb_rank&#39;], ascending=False).iloc[:target_stocks] </p>

<p>log.info(&quot;\n&quot; + str(context.long_list.sort([&#39;comb_rank&#39;], ascending=True)))  </p>

<p>While you should&#39;ve used &#39;Total rank&#39; instead of &#39;comb_rank&#39;.  So I changed &#39;comb_rank&#39; to &#39;Total rank&#39; on those two lines and now your algorithm runs.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59ed9320354924000638a5e2' id='59ed9320354924000638a5e2'>
<a href='#59ed9320354924000638a5e2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59a335b0f6a63f00101c2bd6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f38a6b789130c6b46006fd564288d828?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59a335b0f6a63f00101c2bd6'>Matteo Busetti</a>
</div>
<a UTCms='1508741920000' class='quanto-date posted-at response-posted-at' href='#59ed9320354924000638a5e2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Mikko J</p>

<p>Would you happen to know also why the leverage keeps increasing? I would assume its because some positions are not being closed correctly, but how can I amend that? as you see in line 52, I would like leverage to be 1.0 max</p>

<p>I have tried to change the exit rules from line 241 but i still a very high leverage  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59edeef5e421950006689a22' id='59edeef5e421950006689a22'>
<a href='#59edeef5e421950006689a22'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/594000044ba376000d1b8349'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d3463553dff276fc7bdb6e50f2ead18a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/594000044ba376000d1b8349'>Mikko Nevaluoto</a>
</div>
<a UTCms='1508765429000' class='quanto-date posted-at response-posted-at' href='#59edeef5e421950006689a22'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Matteo,</p>

<p>Somehow target_stocks = 10 messes up leverage. I&#39;m not really familiar with target_stock implementation so I can&#39;t help you how to set it correctly, but I deleted it from line 49 and from line 209, context.long_list = context.output.sort([&#39;Total Ranking&#39;], ascending=False).iloc[:target_stocks] and now leverage stays around 1.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59edf92c76679c000639541e' id='59edf92c76679c000639541e'>
<a href='#59edf92c76679c000639541e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59a335b0f6a63f00101c2bd6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f38a6b789130c6b46006fd564288d828?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59a335b0f6a63f00101c2bd6'>Matteo Busetti</a>
</div>
<a UTCms='1508768044000' class='quanto-date posted-at response-posted-at' href='#59edf92c76679c000639541e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks a lot Mikko, have you made any other changes?<br>
I have made the changes you suggest +  </p>

<pre><code>current_position = context.portfolio.positions[long_stock].amount  
</code></pre>

<p>in the order section, but as you can see leverage is still pretty high around 5  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59ee025a76679c00093954c2' id='59ee025a76679c00093954c2'>
<a href='#59ee025a76679c00093954c2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59a335b0f6a63f00101c2bd6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f38a6b789130c6b46006fd564288d828?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59a335b0f6a63f00101c2bd6'>Matteo Busetti</a>
</div>
<a UTCms='1508770394000' class='quanto-date posted-at response-posted-at' href='#59ee025a76679c00093954c2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Also, having tested your algo on a longer time period, it seems like the leverage increases and especially the positions held at any given time are much more than 10 </p>

<p>Do you know how to make sure that only 10 stock are held at any given time and to make sure that stocks that do not fit the requirements are sold at re-balancing?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59ee0cbd7179050009c50a51' id='59ee0cbd7179050009c50a51'>
<a href='#59ee0cbd7179050009c50a51'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4fe8beb792a029000200000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fe3ffe502559d05f16eb9fe41ab7e9a1?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4fe8beb792a029000200000d'>Dan Dunn</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1508773053000' class='quanto-date posted-at response-posted-at' href='#59ee0cbd7179050009c50a51'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Matteo - take a look at the new <a href="https://www.quantopian.com/posts/optimize-api-generally-available">Optimize API</a>.  You can construct your <code>long_list</code> using a <a href="https://www.quantopian.com/posts/optimize-api-generally-available#59ab32bfa5385e000d6f0bf8">helper function</a> like Scott describes.  Then, pass that objective into the optimizer and it will take care of opening and closing positions for you.</p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='59ee16f2282a46000679376b' id='59ee16f2282a46000679376b'>
<a href='#59ee16f2282a46000679376b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/594000044ba376000d1b8349'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d3463553dff276fc7bdb6e50f2ead18a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/594000044ba376000d1b8349'>Mikko Nevaluoto</a>
</div>
<a UTCms='1508775666000' class='quanto-date posted-at response-posted-at' href='#59ee16f2282a46000679376b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ah yeah. I made some other changes while I was locating leverage issue. My plan was to delete anything I tried, but seems like I&#39;ve missed a spot. :-)<br>
I used current_position = context.portfolio.positions[long_stock].amount  and current_position == 0: when I thought it was issue of algorithm buying and buying more and more of stock which it already owns. But it didn&#39;t solve issue after that I figured out target_stocks stuff which I wrote about.<br>
I&#39;m honestly sorry if my additional code caused some confusion. Here&#39;s your original code without target_stocks and without any of my code, as you see leverage stays around 1.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59ee246a282a4600067938a7' id='59ee246a282a4600067938a7'>
<a href='#59ee246a282a4600067938a7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59a335b0f6a63f00101c2bd6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f38a6b789130c6b46006fd564288d828?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59a335b0f6a63f00101c2bd6'>Matteo Busetti</a>
</div>
<a UTCms='1508779114000' class='quanto-date posted-at response-posted-at' href='#59ee246a282a4600067938a7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Mikko, I have tried to run the above algo and on longer time frames, the leverage increases as time passes also if you take a look at the transactions you will see that there are days with over 500 transactions - i am only looking at holding 10 stocks each day - do you know what could be causing the problem?</p>

<p>Dan - many thanks for the inputs, i have looked at the docs but i am having troubles in understanding how to implement it in the algo. I think more generally, there might be something wrong with the number of stocks selected and the daily rebalancing  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59ee320e5180a100068322e2' id='59ee320e5180a100068322e2'>
<a href='#59ee320e5180a100068322e2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/583340ea732ecc70cc0003cc'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/32705daeb665b5cb5718e37bb2649ace?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/583340ea732ecc70cc0003cc'>Ernesto Perez</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1508782606000' class='quanto-date posted-at response-posted-at' href='#59ee320e5180a100068322e2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Matteo, </p>

<p>First, there are a couple of issues with the algo&#39;s structure that I would like to point out:</p>

<p>1) In lines 210, 211 you are trying to use SimpleMovingAverage to calculate sma for SPY, but this will not have the result you intend. The SimpleMovingAverage factor can only be used within a pipeline&#39;s definition. Instead, you should query pricing data for SPY using data.history and calculate the mean over the periods you want. You can find a good example of how to do this in the sample algorithm from the <a href="https://www.quantopian.com/tutorials/getting-started">Getting Started</a> tutorial. </p>

<p>2) The long_stock variable is only defined within the for loop inside the if condition that triggers when sma50 &gt; sma_200 (line 214), but you try to use it outside this block in line 221. This will cause an error if the second condition is triggered. </p>

<p>With that out of the way, I&#39;ll address your original question. Currently, your algorithm does not limit the amount of securities that it trades. The pipeline will output ~500 securities, and your algorithm will try to open long positions on all of them, regardless of their comb_rank value. To fix this, you can change your pipeline&#39;s screen to comb_rank.top(10), which will limit the number of securities that your pipeline outputs to 10, based on their comb_rank value. </p>

<p>Also, the algorithm&#39;s leverage slowly increases because it never exits securities that are no longer a part of its target universe. When the first condition is triggered (sma_50 &gt; sma200), you need to check your portfolio&#39;s positions against your list of targets (context.long_list) and sell off any positions that are no longer a part of your target universe. </p>

<p>I hope the sample algorithm attached helps. </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='59ee68756e1dfe00094faa44' id='59ee68756e1dfe00094faa44'>
<a href='#59ee68756e1dfe00094faa44'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59a335b0f6a63f00101c2bd6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f38a6b789130c6b46006fd564288d828?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59a335b0f6a63f00101c2bd6'>Matteo Busetti</a>
</div>
<a UTCms='1508796533000' class='quanto-date posted-at response-posted-at' href='#59ee68756e1dfe00094faa44'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thank you all! J seems to be working fine now!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59ef812c369dec00097bfcc0' id='59ef812c369dec00097bfcc0'>
<a href='#59ef812c369dec00097bfcc0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59a335b0f6a63f00101c2bd6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f38a6b789130c6b46006fd564288d828?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59a335b0f6a63f00101c2bd6'>Matteo Busetti</a>
</div>
<a UTCms='1508868396000' class='quanto-date posted-at response-posted-at' href='#59ef812c369dec00097bfcc0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ernesto - I have tried to run this from 2003 and it seems like it doe snot buy anything until 2009 - would you happen to know why?  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/newbie-here-help-with-runtime-error'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/newbie-here-help-with-runtime-error'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#07616262636566646c47767266697368776e66692964686a">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
My first Pipeline: How to find stocks with consecutive higher lows?    low[-4] &lt; low[-3] &lt; low[-2] &lt; low[-1]
</title>
<meta content='I am trying to create my first Pipeline, but I&#39;m not sure how to do it.   I want the Pipeline to only include stocks that have had several consecutive higher lows.  With a standard algorithm universe, I could do something like the attached algo.How do I do this in pipeline?  Am I on the right track?class Lows(CustomFactor):      inputs = [USEquityPricing.low]      window_length = 10    def compute(self, today, assets, out, low):          out[:] = lowdef initialize(context):    pipe =...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="vhheCofGMIa6Fxnoc9Lr/Q09MJM35Xkkz6l8XoU3KV3CfihHJTDiZQMKQNk8PUOJNbMT+k0pbD9Npqc0L3JL5g==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/my-first-pipeline-how-to-find-stocks-with-consecutive-higher-lows-low-4-low-3-low-2-low-1' property='og:url'>
<meta content='My first Pipeline: How to find stocks with consecutive higher lows?    low[-4] &lt; low[-3] &lt; low[-2] &lt; low[-1]' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/my-first-pipeline-how-to-find-stocks-with-consecutive-higher-lows-low-4-low-3-low-2-low-1' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='My first Pipeline: How to find stocks with consecutive higher lows?    low[-4] &lt; low[-3] &lt; low[-2] &lt; low[-1]' property='og:title'>
<meta content='I am trying to create my first Pipeline, but I&#39;m not sure how to do it.   I want the Pipeline to only include stocks that have had several consecutive higher lows.  With a standard algorithm universe, I could do something like the attached algo.How do I do this in pipeline?  Am I on the right track?class Lows(CustomFactor):      inputs = [USEquityPricing.low]      window_length = 10    def compute(self, today, assets, out, low):          out[:] = lowdef initialize(context):    pipe =...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/my-first-pipeline-how-to-find-stocks-with-consecutive-higher-lows-low-4-low-3-low-2-low-1">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='566f84e4323df03b7e000298'>
<div class='post-container' data-post-id='566f84e4323df03b7e000298' id='566f84e4323df03b7e000298'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>My first Pipeline: How to find stocks with consecutive higher lows?    low[-4] &lt; low[-3] &lt; low[-2] &lt; low[-1]</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/550b97655b83ee32fd000132'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1f9775d029ff45e78e133f3379a9299a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/550b97655b83ee32fd000132'>Tristan Rhodes</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1450149092000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=My first Pipeline: How to find stocks with consecutive higher lows?    low[-4] &lt; low[-3] &lt; low[-2] &lt; low[-1]&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fmy-first-pipeline-how-to-find-stocks-with-consecutive-higher-lows-low-4-low-3-low-2-low-1%3Futm_source%3Dwebsite_share%26utm_campaign%3Dmy-first-pipeline-how-to-find-stocks-with-consecutive-higher-lows-low-4-low-3-low-2-low-1%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fmy-first-pipeline-how-to-find-stocks-with-consecutive-higher-lows-low-4-low-3-low-2-low-1%3Futm_source%3Dwebsite_share%26utm_campaign%3Dmy-first-pipeline-how-to-find-stocks-with-consecutive-higher-lows-low-4-low-3-low-2-low-1%26utm_medium%3Dlinkedin&amp;title=My+first+Pipeline%3A+How+to+find+stocks+with+consecutive+higher+lows%3F++++low%5B-4%5D+%3C+low%5B-3%5D+%3C+low%5B-2%5D+%3C+low%5B-1%5D+%28Tristan+Rhodes%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/my-first-pipeline-how-to-find-stocks-with-consecutive-higher-lows-low-4-low-3-low-2-low-1?utm_source=website_share&amp;utm_campaign=my-first-pipeline-how-to-find-stocks-with-consecutive-higher-lows-low-4-low-3-low-2-low-1&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Tristan Rhodes" />
<div class='body-text'>
<div class='body-text-container post-body'><p>I am trying to create my first Pipeline, but I&#39;m not sure how to do it.   I want the Pipeline to only include stocks that have had several consecutive higher lows.  With a standard algorithm universe, I could do something like the attached algo.</p>

<p>How do I do this in pipeline?  Am I on the right track?</p>

<pre><code>class Lows(CustomFactor):  
    inputs = [USEquityPricing.low]  
    window_length = 10

    def compute(self, today, assets, out, low):  
        out[:] = low

def initialize(context):

    pipe = Pipeline()  
    pipe = attach_pipeline(pipe, name=&#39;consecutive_lows&#39;)

    lows = Lows()  
    pipe.add(lows, &quot;lows&quot;)

    pipe.set_screen(lows[-4] &lt; lows[-3] &lt; lows[-2] &lt; lows[-1])  
</code></pre>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>15 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='56705b7d323df0402600078f' id='56705b7d323df0402600078f'>
<a href='#56705b7d323df0402600078f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/53dfa27b197bbb2516000159'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/51e4ba51c431ce2b4373006a33ade2aa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/53dfa27b197bbb2516000159'>Karen Rubin</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1450204033000' class='quanto-date posted-at response-posted-at' href='#56705b7d323df0402600078f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Tristan,<br>
A custom factor only outputs one number, not the entire array of numbers. I think in this case, you would want to include more of your logic in the custom factor. For example, you could get the lows over a 10 day window, and then output the number of consecutive lows each stock had as the out. Then your filter could be for all securities where the lows was &gt; 3, to get every company that had 3 or more consecutive lows in the last 10 days. </p>

<p>Let me know if that makes sense.  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='56707256323df04026000838' id='56707256323df04026000838'>
<a href='#56707256323df04026000838'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/550b97655b83ee32fd000132'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1f9775d029ff45e78e133f3379a9299a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/550b97655b83ee32fd000132'>Tristan Rhodes</a>
</div>
<a UTCms='1450209883000' class='quanto-date posted-at response-posted-at' href='#56707256323df04026000838'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ok, that make sense!  I&#39;ll try to do it that way, and share my results (good or bad).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='567085631989a16b940004bf' id='567085631989a16b940004bf'>
<a href='#567085631989a16b940004bf'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/550b97655b83ee32fd000132'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1f9775d029ff45e78e133f3379a9299a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/550b97655b83ee32fd000132'>Tristan Rhodes</a>
</div>
<a UTCms='1450214764000' class='quanto-date posted-at response-posted-at' href='#567085631989a16b940004bf'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m running into a few issues:</p>

<p>1) Can I use the &quot;window_length&quot; value in my compute() function?  I am getting an undefined error.</p>

<p>2) ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all():<br>
USER ALGORITHM:41, in compute<br>
if low[i-1] &lt; low [i]:</p>

<pre><code>class ConsecutiveHigherLows(CustomFactor):  
    window_length = 10  
    inputs = [USEquityPricing.low]

    def compute(self, today, assets, out, low):

        # Smart way to check lows  
        for i in range(-1,-window_length,-1):  
            pattern = 0  
            if low[i-1] &lt; low [i]:  
                pattern = abs(i)  
            else:  
                break  
# Dumb way of coding this:  
#        pattern = 0  
#        if low[-2] &lt; low[-1]:  
#            pattern=1  
#            if low[-3] &lt; low[-2]:  
#                pattern=2  
#                if low[-4] &lt; low[-3]:  
#                    pattern=3  
#                    if low[-5] &lt; low[-4]:  
#                        pattern=4  
#                        if low[-6] &lt; low[-5]:  
#                            pattern=5  
#                            if low[-7] &lt; low[-6]:  
#                                pattern=6  
#                                if low[-8] &lt; low[-7]:  
#                                    pattern=7  
#                                    if low[-9] &lt; low[-8]:  
#                                        pattern=8  
#                                        if low[-10] &lt; low[-9]:  
#                                            pattern=9

        # Return the number of times the pattern occurred  
        out[:] = pattern  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='567193c6079a4300f10000d6' id='567193c6079a4300f10000d6'>
<a href='#567193c6079a4300f10000d6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/550b97655b83ee32fd000132'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1f9775d029ff45e78e133f3379a9299a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/550b97655b83ee32fd000132'>Tristan Rhodes</a>
</div>
<a UTCms='1450283981000' class='quanto-date posted-at response-posted-at' href='#567193c6079a4300f10000d6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks to Fawce for giving me the answer to #1 in the &quot;quantopian-users&quot; Slack chat.</p>

<p>You need to reference that variable like this: &quot;self.window_length&quot;</p>

<pre><code>    # Smart way to check lows  
        for i in range(-1,-window_length,-1):  
            pattern = 0  
            if low[i-1] &lt; low [i]:  
                pattern = abs(i)  
            else:  
                break  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='567199d2d239a949c0000157' id='567199d2d239a949c0000157'>
<a href='#567199d2d239a949c0000157'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52670e6a2763c5cfb70002c7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/da33ec858011a8fad211c7e0ae68160c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52670e6a2763c5cfb70002c7'>Alan Coppola</a>
</div>
<a UTCms='1450285529000' class='quanto-date posted-at response-posted-at' href='#567199d2d239a949c0000157'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Tristan,<br>
Not sure if your loop does what you want, as all the if-statements in the loop are not nested,<br>
     while the big if statement probably does.</p>

<p>From a compact python expression point of view, here is another way:</p>

<p>-Use numpy arrays for vector operations<br>
-Use np.diff to difference consecutive entries (Size of result array will be one less)<br>
-Take a slice of the last window_length entries<br>
-Create a True/False array based on the condition that the diff entry is &gt; 0<br>
-Use the all() method to see if all entries are True (ie. there is a run of positive differences)</p>

<pre><code>#Example  
import numpy as np  
wl = 4                                                             #window length  
X = np.arange(10) *  arange(10)         # Squares of first ten integers(Test sequence)  
isRun = (np.diff(X)[-(wl-1):]&gt;0).all()  #True if a wl run of diffs is &gt;0 

</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5671dd575b43edc05f000359' id='5671dd575b43edc05f000359'>
<a href='#5671dd575b43edc05f000359'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/550b97655b83ee32fd000132'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1f9775d029ff45e78e133f3379a9299a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/550b97655b83ee32fd000132'>Tristan Rhodes</a>
</div>
<a UTCms='1450302812000' class='quanto-date posted-at response-posted-at' href='#5671dd575b43edc05f000359'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Alan,</p>

<p>Thanks for the reply!  I barely know my way around Python, so I appreciate the help.  This is the second time I have seen diff() used to determine when a value changes relative to it&#39;s neighbor.   </p>

<p>However, I believe your code only checks the condition when ALL days within the window_length are consecutively getting bigger.  This is good, but  I would like to rank stocks based on the number of consecutive days.  I think I would have to encapsulate your logic inside a for loop and increment &quot;wl&quot;.</p>

<pre><code>for wl in range(self.window_length):                                                             #window length  
    isRun = (np.diff(lows)[-(wl-1):]&gt;0).all()  #True if a wl run of diffs is &gt;0  
    if isRun == True:  
         pattern == wl  
    else:  
         break  
</code></pre>

<p>Am I understanding this correctly?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56721e338b7b30b7a6000429' id='56721e338b7b30b7a6000429'>
<a href='#56721e338b7b30b7a6000429'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52670e6a2763c5cfb70002c7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/da33ec858011a8fad211c7e0ae68160c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52670e6a2763c5cfb70002c7'>Alan Coppola</a>
</div>
<a UTCms='1450319416000' class='quanto-date posted-at response-posted-at' href='#56721e338b7b30b7a6000429'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Tristan,<br>
Pretty much.<br>
If you want the maximal length monotonic run at the end of the lows array,<br>
then you want the first place, scanning backward,  a False occurs in the np.diff(lows)&gt;0 boolean array,</p>

<p>This is probably overkill, but it&#39;s hard to get all this niggly stuff right without actually running it in a debugger, IMHO...so here you go...<br>
alan</p>

<pre><code>
#File:      max_lastrun_idx.py  
#Normal:    python max_lastrun_idx.py  
#Debugging: Run under ipython terminal with:  
#           ipython -i -c=&quot;%run max_lastrun_idx.py&quot;

import numpy as np

#Debug On: uncomment tracer statements  
#from IPython.core.debugger import Tracer  
#tracer = Tracer()

def max_lstrun_idx(lows, window_length):  
    pat = 0  
    # Warning: Take care of window_length&lt;=3 cases here.  
    for wl in range(2, window_length):                       #window length  
        isRun = np.array((np.diff(lows)[-(wl-1):]&gt;0).all())  #True if a wl run of diffs is &gt;0  
        if isRun:  
            pat = wl-1  
        else:  
            break  
    return pat

#Test  
#tracer()  
X = np.array([  0,   1,   4,   2,  16,  25, -10,  49,  64,  81])  
idx = max_lstrun_idx(X, len(X))  
print &quot;Test array X=&quot;, X  
print &quot;max_lstrun_idx(X, len(X))=&quot;, idx

# Alternative using np arrays  
wl=len(X)  
diff_gt0          = (np.diff(X)[-(wl-1):]&gt;0)     # array of diff&gt;0 bools  
false_idxs_diff   = np.nonzero(~diff_gt0)        # array of indices of &lt;=0 bools  
max_run_start_idx = np.max(false_idxs_diff) + 2  # max of false indices (+2 to adjust for diff and python index conventions)

#Ans  
print &quot;Longest Run Length=&quot;, len(X)-max_run_start_idx, &quot;MaxRun=&quot;, X[max_run_start_idx:]


#Run result  
#&gt;&gt; python max_lastrun_idx.py  
#&gt;&gt; Test array X= [  0   1   4   2  16  25 -10  49  64  81]  
#&gt;&gt; max_lstrun_idx(X, len(X))= 3  
#&gt;&gt; Longest Run Length= 3 MaxRun= [49 64 81]

</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='567247abe5a4a55fde000073' id='567247abe5a4a55fde000073'>
<a href='#567247abe5a4a55fde000073'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/550b97655b83ee32fd000132'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1f9775d029ff45e78e133f3379a9299a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/550b97655b83ee32fd000132'>Tristan Rhodes</a>
</div>
<a UTCms='1450330033000' class='quanto-date posted-at response-posted-at' href='#567247abe5a4a55fde000073'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Alan, </p>

<p>Great stuff, I am going to try implementing your code next.  In the meantime, I was trying to get around this by iterating through the assets, like this:</p>

<pre><code>class ConsecutiveHigherLows(CustomFactor):  
    window_length = 10  
    inputs = [USEquityPricing.low]

    def compute(self, today, assets, out, low):  
        for a in range(len(assets)):  
            for i in range(-1,-self.window_length,-1):  
                pattern = 0  
                if low[i-1,a] &lt; low[i,a]:  
                    pattern = abs(i)  
                else:  
                    break  
            out[a] = pattern  
</code></pre>

<p>However, I am getting this error when &quot;update_universe&quot; is run:</p>

<pre><code>TypeError:  
There was a runtime error on line 73

def before_trading_start(context, data):  
    results = pipeline_output(&#39;MyPipeline&#39;).dropna()  
    update_universe(results)  
</code></pre>

<p>I did some debugging to see what object is created, and it is a Pandas frame with what looks like the right data.  Here are a few rows:</p>

<pre><code>pipeline_output(&#39;MyPipeline&#39;).dropna()  
DataFrame:  
                        num_of_lows  recent_returns  recent_returns_rank  
Equity(764 [OMX])                 9        0.039216                 5684  
Equity(4128 [JFC])                9        0.166261                 6904  
Equity(4580 [LUK])                9        0.046154                 5934  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56734a5bc2b6ccff60000012' id='56734a5bc2b6ccff60000012'>
<a href='#56734a5bc2b6ccff60000012'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52670e6a2763c5cfb70002c7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/da33ec858011a8fad211c7e0ae68160c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52670e6a2763c5cfb70002c7'>Alan Coppola</a>
</div>
<a UTCms='1450396258000' class='quanto-date posted-at response-posted-at' href='#56734a5bc2b6ccff60000012'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Tristan,<br>
Good catch on setting out one asset at a time...I didn&#39;t know how to do that,<br>
as all the examples I had seen had been arithmetic operations that worked on whole columns of assets.<br>
Seems like the comparison operators SHOULD work on columns.<br>
Some points:<br>
1. pattern needs to be moved outside the inside loop...otherwise, it keeps getting reset to 0.  </p>

<pre><code>class ConsecutiveHigherLows(CustomFactor):  
    window_length = 10  
    inputs = [USEquityPricing.low]

    def compute(self, today, assets, out, low):  
        for a in range(len(assets)):  
            pattern = 0  
            for i in range(-1,-self.window_length,-1):  
                if low[i-1,a] &lt; low[i,a]:  
                    pattern = abs(i)  
                else:  
                    break  
            out[a] = pattern  

</code></pre>

<ol>
<li>From the community post: <a href="https://www.quantopian.com/posts/ranked-universe-and-long-short-equity-strategy">&quot;Ranked Universe &amp; Long-Short Equity Strategy&quot;</a>, you can try out your new factor....<br>
  produce the column of low runs, then produce a rank column from that column, then sort it and take the top number.<br>
They are the assets ones that&#39;ll have your  top runs.<br>
Here is the code I added to make it work.</li>
</ol>

<pre><code>
def initialize(context):  
...
    consec_lows = ConsecutiveHigherLows()  
    pipe.add(consec_lows, &#39;consec_lows&#39;)

    # Rank factor 3 and add the rank to our pipeline  
    consec_lows_rank = consec_lows.rank(mask=top_2000, ascending=False)  
    pipe.add(consec_lows_rank, &#39;consec_lows_rank&#39;)  


def before_trading_start(context, data):  
    # Call pipelive_output to get the output  
    context.output = pipeline_output(&#39;ranked_2000&#39;)  
    # Narrow down the securities to only the top 100 &amp; update my universe  
    context.long_list = context.output.sort([&#39;consec_lows_rank&#39;], ascending=True).iloc[:100]  
    update_universe(context.long_list.index)  
...

</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='567395b20a6bfa94ce000064' id='567395b20a6bfa94ce000064'>
<a href='#567395b20a6bfa94ce000064'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/550b97655b83ee32fd000132'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1f9775d029ff45e78e133f3379a9299a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/550b97655b83ee32fd000132'>Tristan Rhodes</a>
</div>
<a UTCms='1450415543000' class='quanto-date posted-at response-posted-at' href='#567395b20a6bfa94ce000064'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Wow, it feels great to finally figure something out!   I couldn&#39;t have done it without the help of others. (Lots of thanks to Alan!)</p>

<p>I have attached a working backtest that uses Pipeline and a few CustomFactor classes.  I have modified these classes so that they can be used for different input types (lows, highs, close, volume, etc).</p>

<pre><code>class PercentChange(CustomFactor):  
    # Tristan Rhodes  
    # https://www.quantopian.com/posts/my-first-pipeline-how-to-find-stocks-with-consecutive-higher-lows-low-4-low-3-low-2-low-1  
    #  
    # PercentChange will calculate the percent change of an input over the n-most recent days, where n = window_length.  
    # This can by used for price inputs (low, high, close, open), volume, or even fundamentals (set window length for desired period)

    # Set the default list of inputs as well as the default window_length.  
    # Default values are used if the optional parameters are not specified.  
    inputs = [USEquityPricing.close]  
    window_length = 10

    def compute(self, today, assets, out, input1):  
        out[:] = (input1[-1] - input1[0]) / input1[0]

class ConsecutiveHigherValues(CustomFactor):  
    # Tristan Rhodes  
    # https://www.quantopian.com/posts/my-first-pipeline-how-to-find-stocks-with-consecutive-higher-lows-low-4-low-3-low-2-low-1  
    #  
    # ConsecutiveHigherValues will return the number of periods that the value has consecutively increased, leading up to the current period.  
    # This can by used for price inputs (low, high, close, open) or volume.  (Fundamentals don&#39;t usually change on a daily basis, right?)  
    #  
    # Set the default list of inputs as well as the default window_length.  
    # Default values are used if the optional parameters are not specified.  
    window_length = 10  
    inputs = [USEquityPricing.low]

    def compute(self, today, assets, out, input1):  
        for a in range(len(assets)):  
            consecutive = 0  
            for i in range(-1,-self.window_length,-1):  
                if input1[i-1,a] &lt; input1[i,a]:  
                    consecutive = abs(i)  
                else:  
                    break  
            out[a] = consecutive  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56746ec10a6bfa25fd00013a' id='56746ec10a6bfa25fd00013a'>
<a href='#56746ec10a6bfa25fd00013a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52670e6a2763c5cfb70002c7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/da33ec858011a8fad211c7e0ae68160c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52670e6a2763c5cfb70002c7'>Alan Coppola</a>
</div>
<a UTCms='1450471108000' class='quanto-date posted-at response-posted-at' href='#56746ec10a6bfa25fd00013a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Tristan,<br>
Looks good...<br>
I keep learning more about the pipeline stuff a bit at a time!<br>
alan  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='567e6f25501c5fe73a000736' id='567e6f25501c5fe73a000736'>
<a href='#567e6f25501c5fe73a000736'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55b882cbc0ede3945900072f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/15c9d72ddb533306db1b262389f0a135?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55b882cbc0ede3945900072f'>chan john</a>
</div>
<a UTCms='1451126568000' class='quanto-date posted-at response-posted-at' href='#567e6f25501c5fe73a000736'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Tristan.. how many how many consecutive lows... is this..?  I want 3 to 5 days consecutive lows.. is that what is written in your.. algo..? thanks....  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='567ef97535138520e90002cf' id='567ef97535138520e90002cf'>
<a href='#567ef97535138520e90002cf'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/550b97655b83ee32fd000132'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1f9775d029ff45e78e133f3379a9299a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/550b97655b83ee32fd000132'>Tristan Rhodes</a>
</div>
<a UTCms='1451161980000' class='quanto-date posted-at response-posted-at' href='#567ef97535138520e90002cf'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Chan John,</p>

<p>This is the line that says &quot;more than 5 consecutive higher lows&quot;.  </p>

<pre><code> #Screen out penny stocks and low liquidity securities.  
    pipe.set_screen((consec_highers &gt; 5) &amp; (sma_200 &gt; 5.00) &amp; (dollar_volume &gt; 10**7))  
</code></pre>

<p>To accomplish what you want (3,4, or 5 days), you can modify that line:</p>

<pre><code> #Screen out penny stocks and low liquidity securities.  
    pipe.set_screen((consec_highers &gt;= 3) &amp; (consec_highers &lt;= 5) &amp; (sma_200 &gt; 5.00) &amp; (dollar_volume &gt; 10**7))  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='567f525f5355dded47000423' id='567f525f5355dded47000423'>
<a href='#567f525f5355dded47000423'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55b882cbc0ede3945900072f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/15c9d72ddb533306db1b262389f0a135?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55b882cbc0ede3945900072f'>chan john</a>
</div>
<a UTCms='1451184739000' class='quanto-date posted-at response-posted-at' href='#567f525f5355dded47000423'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>thanks...  tristaN.  appreciate it... ;)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='581f0f64be011615a10006c9' id='581f0f64be011615a10006c9'>
<a href='#581f0f64be011615a10006c9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56bb4f9d8df82c54a80009a7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ae547fcdf9aadb83dfe491fe91fee18b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56bb4f9d8df82c54a80009a7'>Oliver Laslett</a>
</div>
<a UTCms='1478430572000' class='quanto-date posted-at response-posted-at' href='#581f0f64be011615a10006c9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi all,</p>

<p>I was trying to do the exact same thing and stumbled upon this thread. I settled on a pandas solution, which is less general than Tristan&#39;s final implementation. Given a window length it&#39;ll return a bool to indicate if there were consecutive lower-lows over the window period. </p>

<pre><code>class ConsecutiveLowerLows(CustomFactor):  
    inputs = [USEquityPricing.low]  
    def compute(self, today, assets, out, lows):  
        low_change = pd.DataFrame(lows, columns=assets).diff()  
        negative_change = low_change.loc[1:,:] &lt; 0  
        out[:] = negative_change.min(axis=0)  
</code></pre>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/my-first-pipeline-how-to-find-stocks-with-consecutive-higher-lows-low-4-low-3-low-2-low-1'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/my-first-pipeline-how-to-find-stocks-with-consecutive-higher-lows-low-4-low-3-low-2-low-1'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#086e6d6d6c6a696b6348797d69667c6778616966266b6765">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

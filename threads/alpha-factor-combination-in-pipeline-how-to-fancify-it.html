<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
alpha factor combination in Pipeline - how to fancify it?
</title>
<meta content='Anyone have guidance on how to combine a set of Pipeline factors using something fancier than the typical sum-of-z-scores method?  For example say I wanted to weight each factor by dividing by the variance in its returns?  Or compute the minimum variance portfolio of factors?  Or perhaps compute the information coefficient for each factor, and use it to drop/add factors?' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="TQULCIm7fRWB2M4Zh1XxTMG68iTGnPOQC3BjrKemgOExY31FK02v9jjFlyjIulk4+TTRTbxQ5ouJf7jGDePiWg==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/alpha-factor-combination-in-pipeline-how-to-fancify-it' property='og:url'>
<meta content='alpha factor combination in Pipeline - how to fancify it?' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/alpha-factor-combination-in-pipeline-how-to-fancify-it' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='alpha factor combination in Pipeline - how to fancify it?' property='og:title'>
<meta content='Anyone have guidance on how to combine a set of Pipeline factors using something fancier than the typical sum-of-z-scores method?  For example say I wanted to weight each factor by dividing by the variance in its returns?  Or compute the minimum variance portfolio of factors?  Or perhaps compute the information coefficient for each factor, and use it to drop/add factors?' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/alpha-factor-combination-in-pipeline-how-to-fancify-it">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='5b9992c3f19b8c3eab3a0cb4'>
<div class='post-container' data-post-id='5b9992c3f19b8c3eab3a0cb4' id='5b9992c3f19b8c3eab3a0cb4'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>alpha factor combination in Pipeline - how to fancify it?</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1536791235000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=alpha factor combination in Pipeline - how to fancify it?&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Falpha-factor-combination-in-pipeline-how-to-fancify-it%3Futm_source%3Dwebsite_share%26utm_campaign%3Dalpha-factor-combination-in-pipeline-how-to-fancify-it%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Falpha-factor-combination-in-pipeline-how-to-fancify-it%3Futm_source%3Dwebsite_share%26utm_campaign%3Dalpha-factor-combination-in-pipeline-how-to-fancify-it%26utm_medium%3Dlinkedin&amp;title=alpha+factor+combination+in+Pipeline+-+how+to+fancify+it%3F+%28Grant+Kiehne%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class='tags tag-row'>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Seeking Help' data-tag-id='55c50e7d8d4710ec6e000003' href='/posts/tag/Seeking-Help/newest'>Seeking Help</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Tools and Tips' data-tag-id='55c50e7d8d4710ec6e000011' href='/posts/tag/Tools-and-Tips/newest'>Tools and Tips</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Pipeline' data-tag-id='561525bcf252a59171000001' href='/posts/tag/Pipeline/newest'>Pipeline</a>
</div>
<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/alpha-factor-combination-in-pipeline-how-to-fancify-it?utm_source=website_share&amp;utm_campaign=alpha-factor-combination-in-pipeline-how-to-fancify-it&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Grant Kiehne" />
<div class='body-text'>
<div class='body-text-container post-body'><p>Anyone have guidance on how to combine a set of Pipeline factors using something fancier than the typical sum-of-z-scores method?  For example say I wanted to weight each factor by dividing by the variance in its returns?  Or compute the minimum variance portfolio of factors?  Or perhaps compute the information coefficient for each factor, and use it to drop/add factors?  </p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>28 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='5b9af2f66b2aff0048d3d593' id='5b9af2f66b2aff0048d3d593'>
<a href='#5b9af2f66b2aff0048d3d593'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1536881398000' class='quanto-date posted-at response-posted-at' href='#5b9af2f66b2aff0048d3d593'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Just found this in the help:</p>

<p><a href="https://www.quantopian.com/help#quantopian_pipeline_CustomFactor" rel="nofollow">https://www.quantopian.com/help#quantopian_pipeline_CustomFactor</a></p>

<pre><code>class MultipleOutputs(CustomFactor):  
    inputs = [USEquityPricing.close]  
    outputs = [&#39;alpha&#39;, &#39;beta&#39;]  
    window_length = N

    def compute(self, today, assets, out, close):  
        computed_alpha, computed_beta = some_function(close)  
        out.alpha[:] = computed_alpha  
        out.beta[:] = computed_beta

# Each output is returned as its own Factor upon instantiation.  
alpha, beta = MultipleOutputs()

# Equivalently, we can create a single factor instance and access each  
# output as an attribute of that instance.  
multiple_outputs = MultipleOutputs()  
alpha = multiple_outputs.alpha  
beta = multiple_outputs.beta  
</code></pre>

<p>So, perhaps for each factor I can output the factor itself and some statistics that could be used to combine it with other factors?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5b9b2c344ca0a1003f4ac982' id='5b9b2c344ca0a1003f4ac982'>
<a href='#5b9b2c344ca0a1003f4ac982'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52670e6a2763c5cfb70002c7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/da33ec858011a8fad211c7e0ae68160c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52670e6a2763c5cfb70002c7'>Alan Coppola</a>
</div>
<a UTCms='1536896052000' class='quanto-date posted-at response-posted-at' href='#5b9b2c344ca0a1003f4ac982'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant,<br>
There are two ways...both of which you&#39;ve participated in before...so perhaps this is not what you want.</p>

<p>A. Use the expression compiler(Pipeline) to combine factors that run across the data.<br>
The best example I know of that does this is variants of the ML pipeline.<br>
    I use this, and until it gets passed over the data in before_trading_starts, it&#39;s just a big expression of Pipeline code.<br>
Here is the business end of specifying combining a bunch of factors by applying a function to the array of factors.<br>
<a href="https://www.quantopian.com/posts/machine-learning-on-quantopian-part-3-building-an-algorithm" rel="nofollow">https://www.quantopian.com/posts/machine-learning-on-quantopian-part-3-building-an-algorithm</a></p>

<pre><code>def make_ml_pipeline(universe, window_length=21, n_forward_days=5):  
    pipeline_columns = OrderedDict()

    # ensure that returns is the first input  
    pipeline_columns[&#39;Returns&#39;] = Returns(  
        inputs=(USEquityPricing.open,),  
        mask=universe, window_length=n_forward_days + 1,  
    )

    # rank all the factors and put them after returns  
    pipeline_columns.update({  
        k: v.rank(mask=universe) for k, v in features.items()  
    })

    # Create our ML pipeline factor. The window_length will control how much  
    # lookback the passed in data will have.  
    pipeline_columns[&#39;ML&#39;] = ML(  
        inputs=pipeline_columns.values(),  
        window_length=window_length + 1,  
        mask=universe,  
    )

    pipeline_columns[&#39;Sector&#39;] = Sector()

    return Pipeline(screen=universe, columns=pipeline_columns)

</code></pre>

<p>B. Take the output of<br>
 <code>
context.output = algo.pipeline_output(&quot;pipe&quot;)  
</code>
as an output dataframe, and combine (alpha factors) columns using all the methods you want(e.g. dataframe methods),  to create an alpha factor combination as a new column...usually done in something like a rebalance method.</p>

<p>alan  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5b9b7a52a19c4e004123b1c5' id='5b9b7a52a19c4e004123b1c5'>
<a href='#5b9b7a52a19c4e004123b1c5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1536916050000' class='quanto-date posted-at response-posted-at' href='#5b9b7a52a19c4e004123b1c5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Alan -</p>

<p>Your &quot;B&quot; above might be the preferred approach, but my understanding is that Pipeline does not neatly support output of a trailing window of values (if I&#39;m wrong, someone please correct me).  One can only output a Pandas DataFrame with row labels corresponding to the current universe, and column labels applied within Pipeline.  I suppose one could create a column for each trailing day.  For example, for 2 alpha factors and 5 days, I would have columns with labels:</p>

<pre><code>alpha00, alpha01, alpha02, alpha03, alpha04,  
alpha10, alpha11, alpha12, alpha13, alpha14  
</code></pre>

<p>In a similar fashion, I would add columns for returns:</p>

<pre><code>ret00, ret01, ret02, ret03, ret04,  
ret10, ret11, ret12, ret13, ret14  
</code></pre>

<p>Then, in <code>before_trading_start</code> I would do the alpha combination.  Alternatively, the alpha combination step could be postponed until during the trading day, if it could be done within ~50 seconds, and it were advantageous (e.g. generally, the alpha combination computation could include mid-day minutely OHLCV data).</p>

<p>This seems workable (and would seem to be the only data structure supported by Pandas anyway, since Pandas Panel has been deprecated...although I see that the non-Pandas <a href="http://xarray.pydata.org/en/stable/" rel="nofollow">xarray</a> has developed an alternative).</p>

<p>Doing the potentially computationally expensive alpha combination within <code>before_trading_start</code> (with a full 5 minutes allocated per day) would seem to be the way to go, versus the chunked computations within Pipeline, over a 10 minute limit (where, for back testing, one gets nowhere near 5 minutes per trading day for computations).</p>

<p>Another potential approach would be to create a separate Pipeline for each trailing day, but this seems very awkward, and my understanding is that one could bump into overhead issues, since each Pipeline runs independently with respect to fetching chunks of data (I think).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5b9bdd5ba19c4e792523b2c5' id='5b9bdd5ba19c4e792523b2c5'>
<a href='#5b9bdd5ba19c4e792523b2c5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52670e6a2763c5cfb70002c7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/da33ec858011a8fad211c7e0ae68160c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52670e6a2763c5cfb70002c7'>Alan Coppola</a>
</div>
<a UTCms='1536941403000' class='quanto-date posted-at response-posted-at' href='#5b9bdd5ba19c4e792523b2c5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant,<br>
Good idea for B!...I&#39;ll have to try that!</p>

<p>For A., it&#39;s a bit of magic to me, as it seems like Pipeline is a kind of dataflow compiler, and I could never figure out <em>why</em>
<code>
 inputs=pipeline_columns.values()  
</code>
works in ML above, in that the other columns are computed and ready for the ML method to be run.  <em>How</em> does that happen?</p>

<p>alan  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5b9c3710a19c4e40f023b04f' id='5b9c3710a19c4e40f023b04f'>
<a href='#5b9c3710a19c4e40f023b04f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1536964368000' class='quanto-date posted-at response-posted-at' href='#5b9c3710a19c4e40f023b04f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Alan -</p>

<p>I don&#39;t think I&#39;ll try to sort out how to do the alpha combination within Pipeline, since it would seem advantageous to do it in <code>before_trading_start</code>.  Generally, the more I can do in common Python, I think the better off I&#39;ll be.  I&#39;m sure that the Q Pipeline API is pure wonderfulness, but if it is not used widely, and I can&#39;t Google, etc. for help, I lose patience.</p>

<p>Thanks for your feedback, by the way.  Somehow, it made me realize that I could get the data required out of Pipeline.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5b9ca48eb653e7004aa09113' id='5b9ca48eb653e7004aa09113'>
<a href='#5b9ca48eb653e7004aa09113'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ed38379b1e7efbfb0006f8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fe429093818ef2b5c8f29dc274a188b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ed38379b1e7efbfb0006f8'>Karl Mun</a>
</div>
<a UTCms='1536992398000' class='quanto-date posted-at response-posted-at' href='#5b9ca48eb653e7004aa09113'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Perhaps try, Grant a routine I use in 
<code>
Pipeline  
</code>to append data by columns:</p>

<pre><code>steps = np.arange(start, end, interval)  
for s, step in enumerate(steps):  
    a = myCustomFactor(inputs=[myInputs], window_length=step, mask=myUniverse)  
    myPipeline.add(a, &#39;alpha&#39; + str(s))  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5b9cbc7221771a0042e8cef1' id='5b9cbc7221771a0042e8cef1'>
<a href='#5b9cbc7221771a0042e8cef1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1536998514000' class='quanto-date posted-at response-posted-at' href='#5b9cbc7221771a0042e8cef1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Karl -</p>

<p>I&#39;ll need something like your code to automatically label the alphas and anything else to be spit out by Pipeline.</p>

<p>An example of a possible data structure mapping is given in the &quot;Deprecate Panel&quot; section of <a href="https://pandas.pydata.org/pandas-docs/stable/dsintro.html" rel="nofollow">https://pandas.pydata.org/pandas-docs/stable/dsintro.html</a>, in the form of a MultiIndex DataFrame:</p>

<pre><code>                     ItemA     ItemB     ItemC  
major      minor  
2000-01-03 A     -0.390201 -1.624062 -0.605044  
           B      1.562443  0.483103  0.583129  
           C     -1.085663  0.768159 -0.273458  
           D      0.136235 -0.021763 -0.700648  
2000-01-04 A      1.207122 -0.758514  0.878404  
           B      0.763264  0.061495 -0.876690  
           C     -1.114738  0.225441 -0.335117  
           D      0.886313 -0.047152 -1.166607  
2000-01-05 A      0.178690 -0.560859 -0.921485  
           B      0.162027  0.240767 -1.919354  
           C     -0.058216  0.543294 -0.476268  
           D     -1.350722  0.088472 -0.367236  
2000-01-06 A     -1.004168 -0.589005 -0.200312  
           B     -0.902704  0.782413 -0.572707  
           C     -0.486768  0.771931 -1.765602  
           D     -0.886348 -0.857435  1.296674  
</code></pre>

<p>Using this example, the columns would be SIDs, the major axis would be some sort of datetime stamp, and the minor axis would be the alpha factors along with any additional data required to combine them (N alpha factors, followed by M data sets).</p>

<p>I&#39;ve never bothered with it, but presumably Pipeline has datetime stamps?  I&#39;ll have to dig into that one.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5b9db4c1c5fb3e003b134f0b' id='5b9db4c1c5fb3e003b134f0b'>
<a href='#5b9db4c1c5fb3e003b134f0b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ed38379b1e7efbfb0006f8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fe429093818ef2b5c8f29dc274a188b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ed38379b1e7efbfb0006f8'>Karl Mun</a>
</div>
<a UTCms='1537062081000' class='quanto-date posted-at response-posted-at' href='#5b9db4c1c5fb3e003b134f0b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Pandas API Reference for <a href="http://pandas.pydata.org/pandas-docs/stable/advanced.html" rel="nofollow">MultiIndex and Advance Indexing</a> methods.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5b9e36fcce035f00441c42d2' id='5b9e36fcce035f00441c42d2'>
<a href='#5b9e36fcce035f00441c42d2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1537095420000' class='quanto-date posted-at response-posted-at' href='#5b9e36fcce035f00441c42d2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Karl -</p>

<p>That&#39;s quite a reference, with lots of examples!   I&#39;ll have to search around for examples of how to do this:</p>

<p>DataFrame --&gt; MultiIndex</p>

<p>Then I can back out how to construct the DataFrame in Pipeline so that I can create the MultiIndex in <code>before_trading_start</code> without too much fuss.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5b9ec6afce035f00441c45c3' id='5b9ec6afce035f00441c45c3'>
<a href='#5b9ec6afce035f00441c45c3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1537132207000' class='quanto-date posted-at response-posted-at' href='#5b9ec6afce035f00441c45c3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>One possible set of Pipeline columns would be (datetime stamp followed by two alpha factors and the returns of each SID):</p>

<pre><code>dt0, alpha00, alpha01, r0, dt1, alpha10, alpha11, r1, dt2, alpha20, alpha21, r2  
</code></pre>

<p>Then, this would be converted into a MultiIndex, with the major axis the datetime stamps, and the minor axis the alphas and the SID returns, with SIDs as the column labels.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ba21d346dae9f004376e0d4' id='5ba21d346dae9f004376e0d4'>
<a href='#5ba21d346dae9f004376e0d4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1537350964000' class='quanto-date posted-at response-posted-at' href='#5ba21d346dae9f004376e0d4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Karl -</p>

<p>So are you exporting only point-in-time alpha factors from Pipeline?  Or a trailing window of alpha factors?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ba239956dae9f004676e179' id='5ba239956dae9f004676e179'>
<a href='#5ba239956dae9f004676e179'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ed38379b1e7efbfb0006f8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fe429093818ef2b5c8f29dc274a188b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ed38379b1e7efbfb0006f8'>Karl Mun</a>
</div>
<a UTCms='1537358229000' class='quanto-date posted-at response-posted-at' href='#5ba239956dae9f004676e179'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Point-in-time alpha columns, Grant from Pipeline upon start date then append subsequent point-in-time data columns into a context.DataFrame for global access throughout the backtest period until end date, and beyond for OOS point-in-time where relevant.</p>

<p>Quite simple to initialise a DataFrame in def initialise():</p>

<pre><code>context.myAlpha = pd.DataFrame(np.nan, index=range(0, 1), columns=[&#39;alpha0&#39;, &#39;alpha1&#39;, &#39;alpha2&#39;, &#39;alpha3&#39;])  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ba2d9205b771900431f2810' id='5ba2d9205b771900431f2810'>
<a href='#5ba2d9205b771900431f2810'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1537399072000' class='quanto-date posted-at response-posted-at' href='#5ba2d9205b771900431f2810'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Karl -</p>

<p>The thing is, when you start a backtest or live trading, you have to wait N days to fill whatever trailing window you need.  If I wanted a year&#39;s worth of data, then I don&#39;t think building up the data set would be workable.  The trailing window needs to come out of Pipeline from the get-go.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf4a6e32d3eb2003ce2ce61' id='5bf4a6e32d3eb2003ce2ce61'>
<a href='#5bf4a6e32d3eb2003ce2ce61'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1542760163000' class='quanto-date posted-at response-posted-at' href='#5bf4a6e32d3eb2003ce2ce61'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Another degree of freedom to crack this nut would be to have a separate pipeline for each alpha factor, to help with the bookkeeping.  Then one could output lagged values of the factor along the columns of its pipeline output (e.g. see <a href="https://www.quantopian.com/posts/get-lagged-output-of-pipeline-custom-factor" rel="nofollow">https://www.quantopian.com/posts/get-lagged-output-of-pipeline-custom-factor</a>).  Then, everything could be pieced together in <code>before_trading_start</code>.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf4d6c83f88ef32dee55e44' id='5bf4d6c83f88ef32dee55e44'>
<a href='#5bf4d6c83f88ef32dee55e44'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ed38379b1e7efbfb0006f8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fe429093818ef2b5c8f29dc274a188b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ed38379b1e7efbfb0006f8'>Karl Mun</a>
</div>
<a UTCms='1542772424000' class='quanto-date posted-at response-posted-at' href='#5bf4d6c83f88ef32dee55e44'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>That&#39;s creative thinking, Grant :) I may try that too!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf525d4ab895f004b7011ab' id='5bf525d4ab895f004b7011ab'>
<a href='#5bf525d4ab895f004b7011ab'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1542792660000' class='quanto-date posted-at response-posted-at' href='#5bf525d4ab895f004b7011ab'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The attached algo is an example of how to do simple alpha combination in <code>before_trading_start</code>.  Each alpha is a daily vector stored in the pandas dataframe as alpha_N.  This is accomplished with:</p>

<pre><code>def factor_pipeline():  
    factors = make_factors()  
    pipeline_columns = {}  
    for k,f in enumerate(factors):  
        pipeline_columns[&#39;alpha_&#39;+str(k)] = f(mask=QTradableStocksUS())  
    pipe = Pipeline(columns = pipeline_columns,  
    screen = QTradableStocksUS())  
    return pipe  
</code></pre>

<p>If a trailing window of alpha values is needed in <code>before_trading_start</code> then one tidy approach would be to use a separate pipeline for each alpha factor.  Then each column could correspond to a set of lagged alpha values.  For example, for the Nth alpha factor (e.g. N = 2), the columns could be labelled (for a 5-day window):</p>

<p><code>alpha_2_0, alpha_2_1, alpha_2_2, alpha_N_3, alpha_2_4</code></p>

<p>The announcement for multiple pipelines is <a href="https://www.quantopian.com/posts/multiple-pipelines-available-in-algorithms" rel="nofollow">https://www.quantopian.com/posts/multiple-pipelines-available-in-algorithms</a>.  It is worth noting:</p>

<blockquote>
<p>Multiple pipelines can easily lead to a slowdown in your algorithm, because the pipeline machinery can optimize your data fetching within a single pipeline, but does not optimize data fetching across separate pipelines. In general, it&#39;s better to use a single pipeline.</p>
</blockquote>

<p>Note also this announcement: <a href="https://www.quantopian.com/posts/before-trading-start-timeout-fix" rel="nofollow">https://www.quantopian.com/posts/before-trading-start-timeout-fix</a>.  It basically says that for all pipelines combined, 10 minutes per trading day is allocated (however, large chunks of data are processed, as discussed <a href="https://www.quantopian.com/posts/pipeline-timeoutexception-any-hope-for-a-fix" rel="nofollow">here</a>).  The change also enables a full, predictable 5 minutes per trading day for <code>before_trading_start</code> (and so, my thinking is that alpha combination should be done there, and not in pipeline, even though it is awkward to get the data out).</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf5b01792fff067c9a102a2' id='5bf5b01792fff067c9a102a2'>
<a href='#5bf5b01792fff067c9a102a2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ed38379b1e7efbfb0006f8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fe429093818ef2b5c8f29dc274a188b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ed38379b1e7efbfb0006f8'>Karl Mun</a>
</div>
<a UTCms='1542828055000' class='quanto-date posted-at response-posted-at' href='#5bf5b01792fff067c9a102a2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>On your thinking, Grant that:</p>

<blockquote>
<p>for 
<code>before_trading_start</code> ..that alpha combination should be<br>
done there, and not in pipeline</p>
</blockquote>

<p>It works fine in <code>
before_trading_start  
</code> when the <code>
scheduled_function  
</code> is daily (as in yours) though I noticed <code>
before_trading_start  
</code> keeps running everyday even if the <code>
schedule_function  
</code> is weekly.</p>

<p>In algorithms where scheduled weekly, perhaps alpha combination (if outside Pipeline) may have move further down in the order of work flow.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf5e155a6c5820041f5638c' id='5bf5e155a6c5820041f5638c'>
<a href='#5bf5e155a6c5820041f5638c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1542840661000' class='quanto-date posted-at response-posted-at' href='#5bf5e155a6c5820041f5638c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Karl -</p>

<p>The function <code>before_trading_start</code> is special in that a full 5 minutes is allocated for it to complete every trading day.  During the trading day, in any given minute, everything has to be done in ~ 50 secs.</p>

<p>You can still use <code>before_trading_start</code>for less frequent trading.  For example, say you wanted to rebalance every Thursday.  Schedule a function for Wednesday just to set a flag for the next day, <code>context.run_alpha_combination = True</code>.  Then in <code>before_trading_start</code> run if <code>context.run_alpha_combination = True</code> and set <code>context.run_alpha_combination = False</code> once the run is complete.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c03cf6a1073f400445df0f8' id='5c03cf6a1073f400445df0f8'>
<a href='#5c03cf6a1073f400445df0f8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1543753578000' class='quanto-date posted-at response-posted-at' href='#5c03cf6a1073f400445df0f8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s a first-cut at assigning each alpha factor its own pipeline, for the purpose of exporting a trailing window of each alpha factor to <code>before_trading_start</code>.  For the example, I&#39;ve limited the number of factors to 2, and the length of the trailing window to 5 days.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c04376ef15cd90046c591db' id='5c04376ef15cd90046c591db'>
<a href='#5c04376ef15cd90046c591db'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1543780206000' class='quanto-date posted-at response-posted-at' href='#5c04376ef15cd90046c591db'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s a different approach that uses a single Pipeline for all of the factors (more in line with the Q guidance on scaling with the number of Pipelines).  Oddly, if I scale up <code>N_FACTOR_WINDOW</code> I get an timeout for <code>initialize</code> within less than 2 minutes, which is sorta odd.  I didn&#39;t realize that there is a timeout for <code>initialize</code>.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c0557511610ff62de729ad3' id='5c0557511610ff62de729ad3'>
<a href='#5c0557511610ff62de729ad3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ad636d2955ced0ecfc2f6db'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8411312585beb78041fb872650e0da84?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ad636d2955ced0ecfc2f6db'>Cal Mitchell</a>
</div>
<a UTCms='1543853905000' class='quanto-date posted-at response-posted-at' href='#5c0557511610ff62de729ad3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant, interesting idea. Please note that attaching multiple pipelines to an algorithm can introduce inefficiencies if you aren&#39;t careful.</p>

<p>The thing you want to avoid is attaching multiple pipelines that use the same data fields. For example, if you have multiple alpha factors that make use of <code>USEquityPricing.close.latest</code>, you should perform all logic that needs that particular data in one pipeline (or in post processing in <code>before_trading_start()</code>). </p>

<p>The problem simplifies to this: If you attach two pipelines that use the same data field, the entire dataset will be loaded twice.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c05b878fb84e9687a3f1379' id='5c05b878fb84e9687a3f1379'>
<a href='#5c05b878fb84e9687a3f1379'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1543878776000' class='quanto-date posted-at response-posted-at' href='#5c05b878fb84e9687a3f1379'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Cal -</p>

<p>My objective here is to get data from Pipeline into <code>before_trading_start</code> where it would be processed.  I think I&#39;ll abandon the idea of using a Pipeline per factor, and output all of the factors in one Pipeline (each of M factors having a trailing window length of N).  And there will be K stocks in the <code>QTradableStocksUS</code>.  So, we are talking about a Pandas dataframe with MxN columns and K rows .  So what is a reasonable limit on MxN (given that K is fixed as the number of stocks in the `QTradableStocksUS&#39;)?</p>

<p>Also, is there no way to set the chunk size in Pipeline in the backtester?  Presumably this would help with memory management (at the expense of more data loads, I suppose, which, if taken to an extreme, would cause a timeout of Pipeline?).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c065b073b3cba003ff8ffd3' id='5c065b073b3cba003ff8ffd3'>
<a href='#5c065b073b3cba003ff8ffd3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1543920391000' class='quanto-date posted-at response-posted-at' href='#5c065b073b3cba003ff8ffd3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Cal -</p>

<p>Another question - would multiple Pipelines help in memory management?  My thinking is that the Pipelines must be processed serially.  Data are read into a buffer, processed, and the results stored in an output buffer.  Once all of the Pipelines have been processed, then the algo starts outputting the results to <code>before_trading_start</code>.  So, if the input buffer memory space is recycled as the algo steps from one Pipeline to the next, then it should be easier to avoid memory limitations, right?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c16562bc58d7a00497389b1' id='5c16562bc58d7a00497389b1'>
<a href='#5c16562bc58d7a00497389b1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1544967723000' class='quanto-date posted-at response-posted-at' href='#5c16562bc58d7a00497389b1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s an architecture I&#39;ve been developing.  The basic idea is to output trailing windows of each of N alpha factors computed in Pipeline, and do the alpha combination in <code>before_trading_start</code>.  I&#39;ve managed to get clustering to work, which is kinda cool.  My thinking is that the clustering would be used in a factor weighting scheme.  For example, say there are five factors, alpha_0, alpha_1, alpha_2, alpha_3, alpha_4, and they are clustered like this:</p>

<p>Cluster 0: alpha_0, alpha_3, alpha_4<br>
Cluster 1: alpha_1, alpha_2</p>

<p>The factors would then be combined something like this:</p>

<pre><code>alpha = wc_0*(w_0*alpha_0 + w_3*alpha_3  + w_4*alpha_4) + wc_1*(w_1*alpha_1 + w_2*alpha_2)  
</code></pre>

<p>The individual factor weights (e.g. w_0, w_1, ...) would be static, and based on some global, long-term analysis if the value of each factor in the portfolio (e.g. from Alphalens or some such thing).  The cluster weights (e.g. wc_0, wc_1, etc.) would be dynamic and based on the short-term clustering result.</p>

<p>EDIT: See post below for a minor update to the code.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c1685deec1333004b1246ae' id='5c1685deec1333004b1246ae'>
<a href='#5c1685deec1333004b1246ae'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1544979934000' class='quanto-date posted-at response-posted-at' href='#5c1685deec1333004b1246ae'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Man that is just super cool! Are you thinking a ‘Value Cluster’, a ‘Momentum Cluster’, etc?</p>

<p>What are you thinking of using to determine the dynamic cluster weights? And what trailing window would you use (or would this be dynamic as well, based on something, say market volatility)?</p>

<p>A few options I can think of: Absolute Returns, Risk-adjusted Returns, Volatility of Returns (inverse weight), or IC (mean or risk-adjusted). </p>

<p>Not really sure how to get any of that in Pipeline or anywhere in the IDE for that matter, so I’m not much help unfortunately. Maybe you or someone else know?</p>

<p>Other things to consider may be ‘momentum weight’ or ‘reversal weight.’ If a cluster has done really well during the trailing window, will it continue to do well, or will it ‘reverse?’ Is the trend increasing or decreasing, from a high or low value? Maybe use some sort of smoothing (eg SMA or EWMA) of whatever you’re using? Maybe use both a ‘momentum weight’ (longer trailing window) and a ‘reversal weight’ (shorter trailing window)?</p>

<p>Pretty obvious stuff maybe, just sharing my thoughts. :)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c16aad8cc49a40043c03345' id='5c16aad8cc49a40043c03345'>
<a href='#5c16aad8cc49a40043c03345'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1544989400000' class='quanto-date posted-at response-posted-at' href='#5c16aad8cc49a40043c03345'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Joakim -</p>

<p>One thought is that clustering may be a way of avoiding having too much weight on a given alpha source, should multiple factors be tapping into it.  For example, have a look at <a href="https://scikit-learn.org/stable/auto_examples/applications/plot_stock_market.html" rel="nofollow">https://scikit-learn.org/stable/auto_examples/applications/plot_stock_market.html</a>.  You can see that companies in similar industries are clustered together.  The same should be true of alpha factors, I figure (even if the reason for the clustering may not be so easy to sort out).  Basically, I think one could think of all of the factors that land in a given cluster to be from the same hidden sector.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c178226253e090046d0589b' id='5c178226253e090046d0589b'>
<a href='#5c178226253e090046d0589b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1545044518000' class='quanto-date posted-at response-posted-at' href='#5c178226253e090046d0589b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s a minor update.  I&#39;m still getting up the learning curve, but I think the clustering should be done like this:</p>

<pre><code>clustering = SpectralClustering(n_clusters=3,assign_labels=&quot;discretize&quot;,random_state=0).fit(alphas_flattened)  
</code></pre>

<p><code>SpectralClustering</code> takes the data and creates an affinity matrix (whatever that is...), not a similarity matrix.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c18bcff81caf100402ac3fe' id='5c18bcff81caf100402ac3fe'>
<a href='#5c18bcff81caf100402ac3fe'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1545125119000' class='quanto-date posted-at response-posted-at' href='#5c18bcff81caf100402ac3fe'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I published a complete algo on <a href="https://www.quantopian.com/posts/alpha-combination-via-clustering" rel="nofollow">https://www.quantopian.com/posts/alpha-combination-via-clustering</a>.  Thanks all for the helpful input.  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/alpha-factor-combination-in-pipeline-how-to-fancify-it'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/alpha-factor-combination-in-pipeline-how-to-fancify-it'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#c5a3a0a0a1a7a4a6ae85b4b0a4abb1aab5aca4abeba6aaa8">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

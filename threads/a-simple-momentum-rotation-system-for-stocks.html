<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
A Simple Momentum Rotation System for Stocks
</title>
<meta content='I really need to add a provision whereby only &quot;winners&quot; are rebalanced not losers. But there you go. Many people here can&#39;t seem to get a handle on simple trend following systems so I thought this might help!' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="tVRjL7l3tUBKEHWeBtQsPkCthO7XM2StAIoHyCDsC43JMhViG4Fno/MNLK9JO4RKeCOnh63/cbaChdyiiqlpNg==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/a-simple-momentum-rotation-system-for-stocks' property='og:url'>
<meta content='A Simple Momentum Rotation System for Stocks' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/a-simple-momentum-rotation-system-for-stocks' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='A Simple Momentum Rotation System for Stocks' property='og:title'>
<meta content='I really need to add a provision whereby only &quot;winners&quot; are rebalanced not losers. But there you go. Many people here can&#39;t seem to get a handle on simple trend following systems so I thought this might help!' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/a-simple-momentum-rotation-system-for-stocks">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='5672ccec6891c22735000212'>
<div class='post-container' data-post-id='5672ccec6891c22735000212' id='5672ccec6891c22735000212'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>A Simple Momentum Rotation System for Stocks</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1450364140000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=A Simple Momentum Rotation System for Stocks&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fa-simple-momentum-rotation-system-for-stocks%3Futm_source%3Dwebsite_share%26utm_campaign%3Da-simple-momentum-rotation-system-for-stocks%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fa-simple-momentum-rotation-system-for-stocks%3Futm_source%3Dwebsite_share%26utm_campaign%3Da-simple-momentum-rotation-system-for-stocks%26utm_medium%3Dlinkedin&amp;title=A+Simple+Momentum+Rotation+System+for+Stocks+%28Anthony+FJ+Garner%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class='tags tag-row'>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Pipeline' data-tag-id='561525bcf252a59171000001' href='/posts/tag/Pipeline/newest'>Pipeline</a>
</div>
<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/a-simple-momentum-rotation-system-for-stocks?utm_source=website_share&amp;utm_campaign=a-simple-momentum-rotation-system-for-stocks&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Anthony FJ Garner" />
<div class='body-text'>
<div class='body-text-container post-body'><p>I really need to add a provision whereby only &quot;winners&quot; are rebalanced not losers. But there you go. Many people here can&#39;t seem to get a handle on simple trend following systems so I thought this might help!  </p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>134 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='5672ec0968d2add09000019c' id='5672ec0968d2add09000019c'>
<a href='#5672ec0968d2add09000019c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5590c016248f1472ae000286'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1a2b21eaf54a819d57cb3044dba06888?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5590c016248f1472ae000286'>Tim Vidmar</a>
</div>
<a UTCms='1450372111000' class='quanto-date posted-at response-posted-at' href='#5672ec0968d2add09000019c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Many thanks, Anthony, for sharing your insight and congratulations on an impressive performance of your algorithm!</p>

<p>Could you please explain what the algorithm does and how it ranks the stocks?</p>

<p>Regards,</p>

<p>Tim  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5672f55268d2ad16650005e2' id='5672f55268d2ad16650005e2'>
<a href='#5672f55268d2ad16650005e2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1450374489000' class='quanto-date posted-at response-posted-at' href='#5672f55268d2ad16650005e2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p><a href="http://www.investorschronicle.co.uk/2015/11/12/tips-and-ideas/trading-on-auto-pilot-3EyihEk7UiBOKwMIVnoXTL/article.html">Pretty similar stuff to this article I wrote recently for the Investors Chronicle</a></p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5672fd7925d0edc7750000ca' id='5672fd7925d0edc7750000ca'>
<a href='#5672fd7925d0edc7750000ca'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1450376572000' class='quanto-date posted-at response-posted-at' href='#5672fd7925d0edc7750000ca'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Real money trading would hit a high of over $9 per dollar put to work, this code is promising.  A margin account would be needed, max leverage is 1.29, altho amount risked is higher than that at $185K due to shorting spikes ~ 11/2010, 8/2011.</p>

<p>Drawdown and Beta, areas to work on, I&#39;ve found that one way I can sort of address those two is by storing SPY prices in a list and making decisions based on a certain lookback window or two based on slopes:</p>

<pre><code>import statsmodels.api as sm  
def slope_calc(in_list):  
    time = sm.add_constant(range(-len(in_list) + 1, 1))  
    return sm.OLS(in_list, time).fit().params[-1]  # slope  
</code></pre>

<p>... tho I haven&#39;t quite nailed down a key to good reliability on that yet. If the slope_calc function is perfectly reliable, I think my use of those values may need another ingredient added, recent volatility, amount of time since latest high/low, or something.</p>

<p>One thing in tandem with that I&#39;ve found helpful is a little routine to log the values (and/or use record()):</p>

<pre><code>def track_val(c, var):    # Diagnostics  
    if &#39;val&#39; not in c:  
        c.val = {  
            &#39;hi&#39; : var,  
            &#39;lo&#39; : var,  
            &#39;avg&#39;: [0, 0],  
        }  
    avg, num     = c.val[&#39;avg&#39;]  
    avg_new      = ((avg * num) + var) / (num + 1)  
    c.val[&#39;avg&#39;] = [avg_new, num + 1]  
    if var &gt; c.val[&#39;hi&#39;]: c.val[&#39;hi&#39;] = var  
    if var &lt; c.val[&#39;lo&#39;]: c.val[&#39;lo&#39;] = var  
    log.info(&#39;now {}  avg {}  lo {}  hi {} &#39;.format(  
        &#39;%.2f&#39; % var, &#39;%.2f&#39; % avg_new, &#39;%.2f&#39; % c.val[&#39;lo&#39;], &#39;%.2f&#39; % c.val[&#39;hi&#39;]))  
</code></pre>

<p>Together could look something like:</p>

<pre><code>        slope1  = slope_calc(spy_prices_list[-8:])  
        track_val(context, slope1)         # now 0.14  avg -0.13  lo -3.09  hi 1.01  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='567303287b6c8b59a60001a4' id='567303287b6c8b59a60001a4'>
<a href='#567303287b6c8b59a60001a4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1450378029000' class='quanto-date posted-at response-posted-at' href='#567303287b6c8b59a60001a4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Actually, this code is far from optimal from my point of view and is only a poor reflection of what I use in trading ETFs.  The paucity of this system as coded here is largely as a result of being very new to Python and also I am finding the Q IDE not the ideal work place.</p>

<p>In coding elsewhere (and in real trading), I prohibit leverage. Haven&#39;t quite worked out how to do that successfully here. I don&#39;t take any short positions - and I don&#39;t think I have been shorting spikes in this code - or at least I hope not! </p>

<p>I do have enormous difficulties in relying on signals based on a single factor (such as the slope of or MA crossover on the downside of SPY, S&amp;P 500, whatever). Its a nice idea but the trade sample size is far too small (IE the number of times the signal tells you to stop trading). I have also done tests on trading the equity curve of the system itself which is similarly flawed. Rather than ramble on at length I explain my misgivings in greater detail here:</p>

<p><a href="http://anthonyfjgarner.net/2014/09/24/much-quantitative-research-is-misleading-at-best/">Post 1</a></p>

<p><a href="http://anthonyfjgarner.net/2014/11/30/dangerous-nonsense-market-timing/">Post 2</a></p>

<p>Sometimes trading the equity curve / using the S&amp;P etc will work for you, sometimes it won&#39;t.</p>

<p>The problem with a system such as this applied to a large universe of stocks is that the will ALWAYS be a bunch of stocks showing positive momentum.   Therefore the &quot;don&#39;t trade if momentum is negative&quot; provision is useless. As I think you will see in my research on ETF systems using similar principals, because you are there trading indices, and not too many of them,  at times of market crisis the system refuses to take negative momentum positions  and goes to cash as more and more indices show negative returns at re-allocation dates.  This is what supplies a &quot;hedge&quot; and the trade sample size is much larger because you have 60 indices giving you a signal to go to cash not a single one.</p>

<p>In short, if you apply and on/off switch to THIS system trading THIS portfolio, I believe you will be disappointed by the results in real life.</p>

<p>Hope I&#39;m making sense and not garbling!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56730d9d6125fdecb400031c' id='56730d9d6125fdecb400031c'>
<a href='#56730d9d6125fdecb400031c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55eefc2af269c592d80008a9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8985b490c95e135c2bbcd7d1a0dce16b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55eefc2af269c592d80008a9'>Jamie McCorriston</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1450380706000' class='quanto-date posted-at response-posted-at' href='#56730d9d6125fdecb400031c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anthony, thank you very much for sharing this with the community! </p>

<p>I made some slight modifications to your algo to remove forward lookahead bias on delisted securities (more feasible for live trading). As expected, the number of open positions now creeps up as positions in these securities do open up. I also added a few comments and removed some lines of code that weren&#39;t being run. In your version, lines 109-113 didn&#39;t seem to be doing anything so I removed them - I&#39;m not sure whether this was intended or not, but I removed them for clarity. </p>

<p>I&#39;m also wondering if you have run this algo in minute mode. The time rules for the <code>schedule_function()</code> method actually only work in minute mode so the <code>rebalance()</code> method won&#39;t be run at market open like you might expect.</p>

<p>Thanks again for sharing this! I&#39;m curious to hear your thoughts on my comments.  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='56731ece68d2add090000369' id='56731ece68d2add090000369'>
<a href='#56731ece68d2add090000369'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55eefc2af269c592d80008a9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8985b490c95e135c2bbcd7d1a0dce16b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55eefc2af269c592d80008a9'>Jamie McCorriston</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1450385107000' class='quanto-date posted-at response-posted-at' href='#56731ece68d2add090000369'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s a version that tracks delisted securities and ignores them in the trading logic. Note how the positions count doesn&#39;t creep up like in my previous version.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='56732da56891c21ada00059a' id='56732da56891c21ada00059a'>
<a href='#56732da56891c21ada00059a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5073d46290be600200000013'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7bb1c49b65033386ad94ab7d5aea5671?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5073d46290be600200000013'>Michael Bennett</a>
</div>
<a UTCms='1450388905000' class='quanto-date posted-at response-posted-at' href='#56732da56891c21ada00059a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@James</p>

<p>How would you take something like this, which is backtesting and running pipelines in Daily mode and convert it to run live on IB? Seems like the pipeline would be running every bar/minute? Is this the case or am I missing something here?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56733829e5a4a5e7ca000474' id='56733829e5a4a5e7ca000474'>
<a href='#56733829e5a4a5e7ca000474'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1450391599000' class='quanto-date posted-at response-posted-at' href='#56733829e5a4a5e7ca000474'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anthony, let me know if you&#39;d like code to make the shorting spikes easily visible.</p>

<p>MB, just don&#39;t try the latest with real money on IB, it starts with 1M and goes 10.5M into the hole, margin. Those are dollars put into play to achieve that result, the highest profit per dollar risked is only around $1.3 vs Anthony&#39;s $9.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56736e953172cc75c7000110' id='56736e953172cc75c7000110'>
<a href='#56736e953172cc75c7000110'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/565385c38ea1f8a305000110'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/597fa40ddaac118f542ca3ab04dabea9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/565385c38ea1f8a305000110'>Jeremy Schroeder</a>
</div>
<a UTCms='1450405530000' class='quanto-date posted-at response-posted-at' href='#56736e953172cc75c7000110'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m new to Quantopian and have a lot to learn, apparently; why is it that this strategy&#39;s leverage creeps upward over time? This is something I&#39;ve noticed in a few other algorithms I&#39;ve looked at. In general, how does one go about prohibiting taking on leverage?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5673b3a23172cc75c70002ae' id='5673b3a23172cc75c70002ae'>
<a href='#5673b3a23172cc75c70002ae'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1450423207000' class='quanto-date posted-at response-posted-at' href='#5673b3a23172cc75c70002ae'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Garyha<br>
Thank you, that code would be gratefully accepted. My code is supposed to take profits but not short. If it is shorting I need to investigate further. </p>

<p>Jeremy<br>
There are a number of factors which can cause this (leverage) and a number of ways to alleviate it. The first major reason here is that de-listed stocks are getting stuck in the portfolio and appear as positions whereas in reality they are cash.  Or at least they are cash if in reality they could have been sold at the last traded price!</p>

<p>Jamie<br>
No, I have not yet run this in minute mode and am not sure how to do that. I am a mere beginner in this environment I fear!  I will have a good look through your comments and alterations and come back on them.  I have only really just begun on this algo here in Q and there is a whole pile of stuff I know I need to attend to. </p>

<p>There is also a whole bunch of stuff I have not begun to explain here. For instance it is essential to experiment with different re-allocation dates. And from there an investor is likely to conclude that he needs to split his capital into 4 or so and trade 4 subsystems each starting on an equally spaced weekly re-allocation date.</p>

<p>Liquidity is essential to consider. Note I have chosen a Russell 3000 proxy - fine on very small capital, hopeless for institutional size on a 10 stock rotation  scheme. Institutions would need to rotate into 100 or 300 stocks monthly to find enough liquidity.</p>

<p>On de-listed stocks, yes and no. Since this is purely mechanical, it is perfectly fair to assume you would have sold on the de-listing date. In practice that works in real trading also. Let us put it this way: on a takeover, you would get paid out the agreed price. On bankruptcy ...er...that might be a different matter: the stock might be suspended and then crash the next day having been de-listed and re-quoted OTC.   But then keeping the stock in the portfolio does not make any difference in the latter case: it is still unrealistic since you would not get the last traded price anyway - you would get the (unrecorded ) price on the pink sheets or whatever. </p>

<p>None of this really matters in a sense but of course it screws the leverage estimate to leave the stock in the portfolio. I&#39;ll have a word or two to say on your chosen efficiency rating as well, but more of that anon.  Briefly, you need to set the Efficiency limit at 0 &lt; Efficiency Limit &lt; 1 while being careful not to curve fit it to a portfolio. An ER of zero or 1 does not exist in practice other than 1 for time deposits (assuming the bank remains solvent!).</p>

<p>Anyway, you guys have an excellent forum here and a wonderful product which can only get better.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5673c67e0a6bfa1e1000005a' id='5673c67e0a6bfa1e1000005a'>
<a href='#5673c67e0a6bfa1e1000005a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1450428034000' class='quanto-date posted-at response-posted-at' href='#5673c67e0a6bfa1e1000005a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Mouse over the custom chart to see the shorting, I also added <a href="https://www.quantopian.com/posts/track-orders">track_orders()</a>.  Am curious what effect the removal of those shorts will have when you or someone find the best way, could be higher returns, just watch out for negative cash unless intentional.<br>
I wonder if it is feasible for someone to write a function to run at the end of handle_data() that would take a look at open orders and adjust them targeting no more than a particular  maximum leverage if necessary.</p>

<pre><code>1970-01-01 initialize:114 INFO 2003-01-04 to 2015-11-30  100000  daily  
2003-01-10 pvr:277 INFO 0 MaxLv 1.0 QRet -0.1 PvR -0.1   CshLw 696 Shrt 0  RskHi 99303  
2003-01-28 track_orders:323 INFO    Sell -1158 SINA at 7.44  
2003-01-29 track_orders:298 INFO       Sold -1158 SINA at 7.935  
2003-01-29 track_orders:323 INFO    Sell -1521 CEDC at 8.296  
2003-01-30 track_orders:298 INFO       Sold -1521 CEDC at 8.196  
  ...  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5673c9603172ccf96500034a' id='5673c9603172ccf96500034a'>
<a href='#5673c9603172ccf96500034a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1450428772000' class='quanto-date posted-at response-posted-at' href='#5673c9603172ccf96500034a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>garyha<br>
Many thanks for the most useful code. I will track down what is happening. Most helpful!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='567429200a6bfa66d200006a' id='567429200a6bfa66d200006a'>
<a href='#567429200a6bfa66d200006a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55eefc2af269c592d80008a9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8985b490c95e135c2bbcd7d1a0dce16b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55eefc2af269c592d80008a9'>Jamie McCorriston</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1450453287000' class='quanto-date posted-at response-posted-at' href='#567429200a6bfa66d200006a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Michael:<br>
Pipeline gets run once per day, regardless of which mode you are in. It gets run before the first call to <code>handle_data()</code> on daily data. While its not available for live trading with IB yet, it&#39;s something we are actively working on.</p>

<p>Anthony:<br>
I&#39;ll have to admit the efficiency rating is new to me. If I chose something different from what you did, that wasn&#39;t my intention! Can you point me to the difference that you&#39;re noticing?</p>

<p>For the bit of code on profit taking, did you intentionally increase your position in stocks that were doing well, or did you mean to sell of part of the stock?</p>

<p>Regarding delisted stocks, I agree that it&#39;s fair to assume you may have sold the stocks on their delisted date, but I noticed that you seemed to be looking ahead several days and selling the stock before it was delisted. There is one point where stocks already in the portfolio are being closed out if their <code>end_date</code> is today or tomorrow and there&#39;s another guard against ordering a security with an <code>end_date</code> less than 35 days away, which is definitely lookahead bias! Either way, the algorithm is still impressive after having removed the lookahead and of course you have the freedom to make whatever guards you&#39;d like. The main reason I drew attention to this was because I&#39;m sure there are plenty of members looking at what you posted and considering it for live trading, so I wanted to make it clear which parts of it won&#39;t translate to live trading.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='56742a5a85b53bf2bc000219' id='56742a5a85b53bf2bc000219'>
<a href='#56742a5a85b53bf2bc000219'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55eefc2af269c592d80008a9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8985b490c95e135c2bbcd7d1a0dce16b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55eefc2af269c592d80008a9'>Jamie McCorriston</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1450453600000' class='quanto-date posted-at response-posted-at' href='#56742a5a85b53bf2bc000219'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anthony:<br>
One more note. I was experimenting with converting the algo to minute mode and the period from 2003-2015 took too long to run, but I got about 5 years into it, and the returns were nothing like they were in daily mode. This suggests to me that the intraday tinkering in handle_data was not productive. I didn&#39;t look closely enough to determine whether the cause was commission fees or just bad betting, but I figured I&#39;d share my partial results in case you try a similar experiment. I might play around with the algo a bit more to make a &quot;minute mode equivalent&quot; that has the same functionality as this daily mode version, but is compatible with live trading.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='567436690a6bfa66d20000dc' id='567436690a6bfa66d20000dc'>
<a href='#567436690a6bfa66d20000dc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1450456686000' class='quanto-date posted-at response-posted-at' href='#567436690a6bfa66d20000dc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Garyha<br>
Wow! Thanks so much for the logging code - its a work of art and makes my task so much easier. Its the sort of thing I have done for years successfully in my current signal generating engine but had not learnt to do yet in Zipline/Q.</p>

<p>Jamie</p>

<blockquote>
<p>Blockquote There is one point where stocks already in the portfolio are being closed out if their end_date is today or tomorrow and there&#39;s another guard against ordering a security with an end_date less than 35 days away, which is definitely lookahead bias!</p>
</blockquote>

<p>Agreed.....it was merely a desperate attempt to stop de-listed stock getting stuck in the portfolio! Which for some reason the first trading guard alone did not seem to cover. What we really need in Zipline is a dictionary of the de-listing dates, a note of whether the stock is de-listed or not and if so a failsafe provision to exit on the last day of trading. To be honest I had forgotten the second trading guard!</p>

<p>Efficiency Ratio<br>
This crept in in line 11:   </p>

<blockquote>
<p>Blockquote     # Only consider stocks with a positive efficiency rating<br>
    ranked_stocks = context.output[context.output.factor_5 &gt; 0]</p>
</blockquote>

<p>Which I think probably overrides this from line 89:</p>

<blockquote>
<p>Blockquote factor_5_filter = factor5 &gt; 0.031<br>
    total_filter = (stocks&amp; factor_5_filter)<br>
    pipe.set_screen(total_filter)  </p>
</blockquote>

<p>A filter of somewhere around 0.031 is very suitable for a wide range of futures and stocks. Is it curve fitting? Who knows?<br>
I wrote this about the futures markets a few years back (unfortunately I can not post the chart):</p>

<blockquote>
<p>Blockquote Kaufman’s Efficiency Ratio has values ranging from 0 and a theoretical +1 when markets are perfectly directional.  </p>

<p>For a given day, Kaufman’s ratio is calculated as: the absolute value of net price change over time (e.g. 120 days) / the sum of the absolute value of all day to day price ranges over the same time period.  You can readily see that if a price goes smoothly upwards from day to day with no retracement (ever!) the index for any given day will equate to 1.  </p>

<p>I based my code on true range rather than close to close price change (arguably not what Kaufman intended). I ran the code over an entire portfolio of over 100 [FUTURES] instruments from 1970 to date. Each day I added each individual instrument efficiency ratio for the whole portfolio and divided it by the number of instruments for which I had a price on that day.  </p>

<p>See the chart set out below for the combined Efficiency Ratio at portfolio level on a daily basis.  </p>

<p>It would seem to indicate that indeed [FUTURES] markets as a whole have become less trend friendly/ more noise over time and that the last two years look particularly “inefficient” and trendless on the 120 day calculation period I used.  I could of course (and probably shall) calculate the aggregate trendiness indicator for different periods: 1, 3, 12 months for instance. But this is an interesting start.</p>
</blockquote>

<p>Minute Trading Mode<br>
I simply have not looked at this. I only ever trade end of day on EOD prices and long term. I promised Michael Bennett I would have a look at converting the algo but got waylaid by Markowitz!<br>
NOBODY should rush into trading this algo. At a rotation of 10 stocks there may be instability. Personally I would be trading 20 + for greater stability. Stability disappears entirely in you reduce to 5 stocks.  Do NOT rely on just trading at month end when it looks best in back testing. There may be fundamental reason for the success of month end re-allocation, there may not. But I would hedge my bets on rolling allocation days or splitting the portfolio into 4 as suggested above.</p>

<p>Shorts<br>
The algo seems to be taking short trades by reversing positions winning profit taking positions from long to short. Its the order logic and I will take a look at correcting this. In other words there is an error in the profit taking logic...In the vast majority of cases it is working as expected and no short arises.....and then.......  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56743a9785b53b2567000279' id='56743a9785b53b2567000279'>
<a href='#56743a9785b53b2567000279'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55eefc2af269c592d80008a9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8985b490c95e135c2bbcd7d1a0dce16b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55eefc2af269c592d80008a9'>Jamie McCorriston</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1450457755000' class='quanto-date posted-at response-posted-at' href='#56743a9785b53b2567000279'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The line:  </p>

<pre><code>ranked_stocks = context.output[context.output.factor_5 &gt; 0]  
</code></pre>

<p>is actually in your code as well (line 114 in the version you posted)!</p>

<p>The good news is that this actually won&#39;t be overwriting the &gt;0.031 bit, because the pipeline has already been screened for securities with an efficiency rating &gt; 0.031. However, this does mean that line 111 in my version is obsolete.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='56743bb11869e73f4a000002' id='56743bb11869e73f4a000002'>
<a href='#56743bb11869e73f4a000002'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1450458037000' class='quanto-date posted-at response-posted-at' href='#56743bb11869e73f4a000002'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ah! Thanks....I did warn you I am new to Q and find de-bugging rather tough here....chortle.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56746e72cf3eec9455000153' id='56746e72cf3eec9455000153'>
<a href='#56746e72cf3eec9455000153'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56533925245cf09dfe00034c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9d0196a7611553bd4b77e649cd8de7cb?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56533925245cf09dfe00034c'>lukas lepi</a>
</div>
<a UTCms='1450471032000' class='quanto-date posted-at response-posted-at' href='#56746e72cf3eec9455000153'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Anthony, </p>

<p>Thanks for sharing! I ran a back test in minute mode, I modified the reblance function to trade 30 minutes after start and close_orders to 30 minutes before close. </p>

<pre><code>schedule_function(rebalance, date_rules.month_start(days_offset=5), time_rules.market_open(minutes=30))  
# half_days is True by default  
schedule_function(close_orders, date_rules.week_end(), time_rules.market_close(minutes=30))  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56747068f2b5871ba5000774' id='56747068f2b5871ba5000774'>
<a href='#56747068f2b5871ba5000774'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1450471536000' class='quanto-date posted-at response-posted-at' href='#56747068f2b5871ba5000774'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>That&#39;s brilliant lukas, thanks.<br>
I believe the unintentional &quot;shorts &quot; are as a result of double selling from the various exit rules so I will look at putting in some flags to prevent it.  I will also look at why the minute mode results are so horrible......  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5674742e3172ccf9650007e9' id='5674742e3172ccf9650007e9'>
<a href='#5674742e3172ccf9650007e9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56533925245cf09dfe00034c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9d0196a7611553bd4b77e649cd8de7cb?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56533925245cf09dfe00034c'>lukas lepi</a>
</div>
<a UTCms='1450472497000' class='quanto-date posted-at response-posted-at' href='#5674742e3172ccf9650007e9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>No worries! Its been my experience on quantopian that daily mode cannot be trusted except for quick tests.<br>
I usually just use daily mode to see if my code has syntax / programming errors and so on but actual backtesting.</p>

<p>Seong Lee had a very good explanation on this thread on the difference between minute and daily mode.<br>
Also Grant has a solution to test in daily mode but I havent tried it myself yet.<br>
<a href="https://www.quantopian.com/posts/backtest-results-different-in-minute-and-daily-mode">https://www.quantopian.com/posts/backtest-results-different-in-minute-and-daily-mode</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5674779d85b53b31fa0001d3' id='5674779d85b53b31fa0001d3'>
<a href='#5674779d85b53b31fa0001d3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/550b97655b83ee32fd000132'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1f9775d029ff45e78e133f3379a9299a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/550b97655b83ee32fd000132'>Tristan Rhodes</a>
</div>
<a UTCms='1450473377000' class='quanto-date posted-at response-posted-at' href='#5674779d85b53b31fa0001d3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anthony:  Thanks for sharing your algo!  I have recently learned enough about pipeline to know that you can accomplish the same functionality by using a single class for the first 4 factors.  </p>

<p>This backtest is a copy of Gary&#39;s, except I reuse the same class four times.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5674781f1869e7ed170003e0' id='5674781f1869e7ed170003e0'>
<a href='#5674781f1869e7ed170003e0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55eefc2af269c592d80008a9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8985b490c95e135c2bbcd7d1a0dce16b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55eefc2af269c592d80008a9'>Jamie McCorriston</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1450473508000' class='quanto-date posted-at response-posted-at' href='#5674781f1869e7ed170003e0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ah yes, it looks like you are reducing position in stocks that hit the target profit of 25% down to 1% of their initial position. Were you looking to reduce the position by 1% instead of to 1%? I can take a stab at correcting it if you explain the logic!  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='56747a133172ccf96500081f' id='56747a133172ccf96500081f'>
<a href='#56747a133172ccf96500081f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1450474007000' class='quanto-date posted-at response-posted-at' href='#56747a133172ccf96500081f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The difference is SO serious it can&#39;t be left at that. I will investigate when I get the chance. It makes no kind of sense at all unless it is some kind of very severe difference in the price of illiquid stocks.</p>

<p>For me, this casts grave doubts over my entire understanding of the Quantopian back testing engine.</p>

<p>It is simply not the sort of puzzle I could leave investigated if I intend to continue to use Q and Zipline!</p>

<p>I&#39;ll report back when I get a chance.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56747f391869e7ed1700041a' id='56747f391869e7ed1700041a'>
<a href='#56747f391869e7ed1700041a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1450475325000' class='quanto-date posted-at response-posted-at' href='#56747f391869e7ed1700041a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Tristan, very nice indeed.<br>
No, I was looking at reducing the position TO 1% although clearly this is a user definable parameter.  So my logic is correct although I could have achieved the same thing in a more obvious way:</p>

<pre><code> context.profit_taking_factor = 0.99  
 profit_taking_amount = context.portfolio.positions[stock].amount * context.profit_taking_factor  
        order(stock, -profit_taking_amount)  
</code></pre>

<p>I believe the unintentional shorting is arising because of multiple exit rules so that you can get a double exit on certain rare days.</p>

<p>The answer is to ascertain which orders are triggered first in the loop and then flag them:<br>
Set &quot;Exit OK flag&quot; to 0<br>
Exit order 1 is triggered<br>
Exit order is processed because &quot;Exit order flag&quot; set to &quot;0&quot;<br>
Switch &quot;Exit OK flag&quot; from 0 (OK to process trade) to 1 (don&#39;t process trade.<br>
Exit order 2 is triggered<br>
on the same day but will not be executed because &quot;Exit OK flag&quot; no reads &quot;1&quot; - IE don&#39;t process trade  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='567484fc3172ccf96500086b' id='567484fc3172ccf96500086b'>
<a href='#567484fc3172ccf96500086b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55eefc2af269c592d80008a9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8985b490c95e135c2bbcd7d1a0dce16b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55eefc2af269c592d80008a9'>Jamie McCorriston</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1450476800000' class='quanto-date posted-at response-posted-at' href='#567484fc3172ccf96500086b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ah, that makes sense to me, though I would use the <a href="https://www.quantopian.com/help#api-get-open-orders">get_open_orders()</a> method to see which orders you&#39;ve made that have yet to be filled. I should have added that in my version of the algo. In general it&#39;s good practice to make a check like  </p>

<pre><code>open_orders = get_open_orders()  
#some more code here  
#for loop  
    if stock not in open_orders:  
        #order  
</code></pre>

<p>before placing any order.</p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='56750fbcb60b25d52e00024a' id='56750fbcb60b25d52e00024a'>
<a href='#56750fbcb60b25d52e00024a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1450512321000' class='quanto-date posted-at response-posted-at' href='#56750fbcb60b25d52e00024a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Jamie<br>
That is very helpful, thank you. Yes, a very nice shortcut to what I was trying to achieve.</p>

<p>As I suspected, the question of the vast difference between the daily results and minutely results boils down to one of liquidity. On a daily back test basis Zipline/Q lets you take [up to?] the whole day&#39;s volume at a single price.</p>

<p>On a minutely basis you get much more accurate data and Q lets you take [up to?] the full volume at price for the minute in question.</p>

<p>In practice this means that if you trade a tiny amount of capital you may very well be able to profit handsomely on trading the top 10 or 20 out of the Russell 3000 but since there is a whole lot of illiquid junk in there you may be better advised to stick to the top 1,000 by way of market cap even on tiny capital such as $5,000. </p>

<p>This exercise has emphasised a number of factors to me. Above all the enormous benefits of co-operation - so thanks to all those of you who have made such valuable contributions to the code.  </p>

<p>I am going to work over the next few days on correcting all remaining errors in the code and unifying the system to take account of all the excellent features contributed by others in the various different posts above.</p>

<p>I am going to provide a switch so that you can see the effects of not re-allocating to losing positions. And I am going to get rid of the unintended shorting.</p>

<p>Then I will publish the amalgamated system here together with one or two examples to &quot;prove&quot; that momentum can achieve better returns than a conventional market cap index both on an absolute and risk adjusted basis.</p>

<p>&quot;Prove&quot; is of course a ridiculous word to use in this context.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56752941a93c8c760d000318' id='56752941a93c8c760d000318'>
<a href='#56752941a93c8c760d000318'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5073d46290be600200000013'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7bb1c49b65033386ad94ab7d5aea5671?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5073d46290be600200000013'>Michael Bennett</a>
</div>
<a UTCms='1450518853000' class='quanto-date posted-at response-posted-at' href='#56752941a93c8c760d000318'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Excellent work everyone,</p>

<p>Jamie, thanks for the info on the pipeline, when I ran it over a longer period in minute mode it ran out of memory a few years in and I thought it would have been the pipeline but perhaps there is a memory leak elsewhere in the algo. I think once you all have the algo settled down a bit I will try and run it again! I was away for a day looking at this site and I got 15 emails about this thread!</p>

<p>Thanks again everyone, especially Anthony, for sharing with the community.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56794dd2210712a25800005e' id='56794dd2210712a25800005e'>
<a href='#56794dd2210712a25800005e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/562545816f0077be2a000054'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/65eed7bd690af7911cb4e82f70d3a8f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/562545816f0077be2a000054'>Shawn Emhe II</a>
</div>
<a UTCms='1450790359000' class='quanto-date posted-at response-posted-at' href='#56794dd2210712a25800005e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I use a technique similar to Jamie&#39;s to prevent orders from going through multiple times and causing over-leverage or  unintentionally causing shorts. But instead of looking for stocks not in open orders I look for stocks that are in open_orders and then use the <em>continue</em> command to skip that loop iteration. I just find it cleaner to do it that way rather than nesting the order logic deeper and deeper into if statements. It makes debugging that much easier.  </p>

<pre><code>open_orders = get_open_orders()  
for stock in [some_iterable]  
    if stock in open_orders:  
        continue  
    #order management logic here  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='567c092f49f3c4dcd1000597' id='567c092f49f3c4dcd1000597'>
<a href='#567c092f49f3c4dcd1000597'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1450969395000' class='quanto-date posted-at response-posted-at' href='#567c092f49f3c4dcd1000597'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Once again, thank you to all contributors for their hep. I believe I have now incorporated most suggestions and added some notes explaining what most of the parameters are designed to do. The system rotates into the top ten of the 500 biggest market cap stocks each month and sells 99% of the relevant holding each time  the stock concerned doubles.  The back test is run in daily mode. Try it in minute mode.</p>

<p>Some shorting is still occurring but has largely been eliminated. It is hard to believe that there are still liquidity problems for S&amp;P 500 stocks and that volume at price is still causing such problems in minute mode. This needs looking at and considering further.</p>

<p>Interesting to note that I have NOT had these problems running systems on highly ETFs liquid  in minute mode...so.....come to your own conclusions. Typically an institutional momentum system on stocks will tend to trade the top 300 out of 1,000....see AQRs product.  Typically a product like AQRs does not invest equal weightings but uses market cap weightings - and hence avoids liquidity problems.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='567c7307c49d2bb788000851' id='567c7307c49d2bb788000851'>
<a href='#567c7307c49d2bb788000851'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/562545816f0077be2a000054'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/65eed7bd690af7911cb4e82f70d3a8f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/562545816f0077be2a000054'>Shawn Emhe II</a>
</div>
<a UTCms='1450996490000' class='quanto-date posted-at response-posted-at' href='#567c7307c49d2bb788000851'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I increased the logging and found the problem; it was in the re-balancing function. The open_orders variable was not reset in between exiting positions and readjusting weights. This allowed for a situation in which orders were sent to close the position and sell part of the position at the same time, leaving behind a negative holding. I fixed it by combining the two checks into and if / elif. This way the algorithm does not even bother adjusting the position size of positions that are being closed.<br>
I also added a few other checks. The logging revealed that the strategy was attempting to close and take profit from flat positions. I added logic that prevents that.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='567c8fd9fa86fb1507000063' id='567c8fd9fa86fb1507000063'>
<a href='#567c8fd9fa86fb1507000063'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/550b97655b83ee32fd000132'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1f9775d029ff45e78e133f3379a9299a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/550b97655b83ee32fd000132'>Tristan Rhodes</a>
</div>
<a UTCms='1451003869000' class='quanto-date posted-at response-posted-at' href='#567c8fd9fa86fb1507000063'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks all for your sharing of knowledge.  I have learned a lot from this thread.  I will play with this algo and share any improvements I come up with.</p>

<p>May I humbly suggest, NEVER use Daily mode.  Paper-trading and real-world-trading only uses Minute mode, so the results from Daily mode are not very useful.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='567c92235232ad69d200006d' id='567c92235232ad69d200006d'>
<a href='#567c92235232ad69d200006d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/550b97655b83ee32fd000132'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1f9775d029ff45e78e133f3379a9299a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/550b97655b83ee32fd000132'>Tristan Rhodes</a>
</div>
<a UTCms='1451004454000' class='quanto-date posted-at response-posted-at' href='#567c92235232ad69d200006d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>This is just the Minute version of Shawn&#39;s most recent algo.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='567d03bbfa86fb15070002dd' id='567d03bbfa86fb15070002dd'>
<a href='#567d03bbfa86fb15070002dd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1451033534000' class='quanto-date posted-at response-posted-at' href='#567d03bbfa86fb15070002dd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Wonderful thank you to you both. Very, very helpful. The benefits of co-operation are great indeed. </p>

<p>I am still not satisfied with minute mode and had a thought in the middle of the night  which I must investigate: where a trade is split into numerous parts I suspect the USD 1 minimum per trade is being (incorrectly!) charged on each part. This may have some bearing.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='568138d42f72172a84000023' id='568138d42f72172a84000023'>
<a href='#568138d42f72172a84000023'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5657a09af95a18caf600085a'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/cb7ba84227ef79495f4a09f8bf9aea38?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5657a09af95a18caf600085a'>Adam Smith</a>
</div>
<a UTCms='1451309274000' class='quanto-date posted-at response-posted-at' href='#568138d42f72172a84000023'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I noticed there is significant negative cash (~ -7000) after 2012 in this algorithm.  I am wondering whether there is an intention or I am missing something important. Or there is any way to avoid it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56814b302f7217afa0000056' id='56814b302f7217afa0000056'>
<a href='#56814b302f7217afa0000056'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1451313976000' class='quanto-date posted-at response-posted-at' href='#56814b302f7217afa0000056'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>There is no intention to use leverage. One trick I use elsewhere is to invest only 95%...or whatever. This can be achieved in this system by reducing the weighting:  </p>

<pre><code>weight = context.acc_leverage / len(context.stock_list)  
</code></pre>

<p>Yes, there are other ways to avoid it but in practice......  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='568160413b0e8f6c740002fc' id='568160413b0e8f6c740002fc'>
<a href='#568160413b0e8f6c740002fc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/568155b7df850a5e5d0000cf'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0f9be0d477c1e851855ab8f9dc1198b3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/568155b7df850a5e5d0000cf'>John Doe</a>
</div>
<a UTCms='1451319365000' class='quanto-date posted-at response-posted-at' href='#568160413b0e8f6c740002fc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi, I have learned so much reading this single thread! Thank you all. Has anyone live tested this strategy using RobinHood. Any specific addition to ensure compatibility with the broker cash trading requirements?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56818babdf850a2632000243' id='56818babdf850a2632000243'>
<a href='#56818babdf850a2632000243'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55eefc2af269c592d80008a9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8985b490c95e135c2bbcd7d1a0dce16b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55eefc2af269c592d80008a9'>Jamie McCorriston</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1451330482000' class='quanto-date posted-at response-posted-at' href='#56818babdf850a2632000243'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Lionel,</p>

<p>Since Pipeline isn&#39;t yet available with real $ trading, you won&#39;t be able to hook this algorithm up to your Robinhood account. We&#39;re currently working on making Pipeline available in real money trading so stay tuned for that! I&#39;ll leave it to Anthony to respond to the cash trading requirements question as I&#39;m not sure of what&#39;s required for the strategy.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5686f31d921625c10f000572' id='5686f31d921625c10f000572'>
<a href='#5686f31d921625c10f000572'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5617f96aa8e03d758000076e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/494daee3e64dd6a51af88b4e5939d3de?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5617f96aa8e03d758000076e'>Nicolas Y</a>
</div>
<a UTCms='1451684641000' class='quanto-date posted-at response-posted-at' href='#5686f31d921625c10f000572'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Anthony, </p>

<p>Thanks for sharing your code. Could you elaborate more details in the following line of code: </p>

<p>a=np.array(([high[1:(lb):1]-low[1:(lb):1],abs(high[1:(lb):1]-close[0:(lb-1):1]),abs(low[1:(lb):1]-close[0:(lb-1):1])]))</p>

<p>my understanding is that high or low are not time series as they represent the low or high of all security in the universe. </p>

<p>Happy new year!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='568703caa6df03991000025b' id='568703caa6df03991000025b'>
<a href='#568703caa6df03991000025b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1451688913000' class='quanto-date posted-at response-posted-at' href='#568703caa6df03991000025b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The  best way to understand it is to look at in debug mode and look at the structure and content and shape of the various arrays. You will find there is a separate column for each of the 7000 odd different securities for each of the H,  L and C and rows for each date in the test giving the H,L and  C for each stock for each day. So the Efficiency Ratio is calcluated separately for each stock in the universe. Later the universe is whittled down to the top X and when looping through candidate stocks the ER is linked by indexing to the correct stock so that a<br>
trade can be accepted or rejected.</p>

<p>You will only really be able to grasp this with the help of the debugger and the Numpy manual.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5688b010073993ae560001ae' id='5688b010073993ae560001ae'>
<a href='#5688b010073993ae560001ae'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5617f96aa8e03d758000076e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/494daee3e64dd6a51af88b4e5939d3de?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5617f96aa8e03d758000076e'>Nicolas Y</a>
</div>
<a UTCms='1451798548000' class='quanto-date posted-at response-posted-at' href='#5688b010073993ae560001ae'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks for your suggestions, Anthony.  Sometimes it was frustrating to understand the data associated with the API in run time.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5691668995c7421ade000531' id='5691668995c7421ade000531'>
<a href='#5691668995c7421ade000531'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5394bbbdeee25762d2000102'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0af1296044050e221f0e9a9593dee746?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5394bbbdeee25762d2000102'>Daniel C. Place</a>
</div>
<a UTCms='1452369548000' class='quanto-date posted-at response-posted-at' href='#5691668995c7421ade000531'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Great code, Anthony! I am a little concerned with the drawdown, however. This sort of drawdown could wipe out your account, though it obviously is much less drawback than the overall market in 2009. Is their anyway to put in a line of code to move to cash or a short ETF if drawdown hits a certain number? I havent been able to figure out how to do it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56920d3da8c19dd39f000738' id='56920d3da8c19dd39f000738'>
<a href='#56920d3da8c19dd39f000738'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1452412224000' class='quanto-date posted-at response-posted-at' href='#56920d3da8c19dd39f000738'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Posted some basic starter code for <a href="https://www.quantopian.com/posts/liquidating">liquidating</a>, thanks for mentioning that Daniel.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='569da4040e9008fe2d000204' id='569da4040e9008fe2d000204'>
<a href='#569da4040e9008fe2d000204'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/550b93dd8be2416fcf0004ed'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9ada400124648a3aaa133654cd5ccb13?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/550b93dd8be2416fcf0004ed'>zhixing tang</a>
</div>
<a UTCms='1453171720000' class='quanto-date posted-at response-posted-at' href='#569da4040e9008fe2d000204'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi , Anthony, can you  explain the  meaning of efficiency_ratio (factor 5) ? Why it&#39;s used as a filter  and how did you get  number 0.031 ?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='569e01c7ddbbf2d7f6000108' id='569e01c7ddbbf2d7f6000108'>
<a href='#569e01c7ddbbf2d7f6000108'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1453195725000' class='quanto-date posted-at response-posted-at' href='#569e01c7ddbbf2d7f6000108'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Efficiency Ratio devised by Perry Kaufman   - see his book Smarter Trading page 134. The figure I used is merely an example.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='569e0a4b8832140fab0005e2' id='569e0a4b8832140fab0005e2'>
<a href='#569e0a4b8832140fab0005e2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5575fd876e0da58be60005f7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/749dcc84c1932c93677550c787758d69?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5575fd876e0da58be60005f7'>BO LI</a>
</div>
<a UTCms='1453197908000' class='quanto-date posted-at response-posted-at' href='#569e0a4b8832140fab0005e2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Anthony,  I&#39;m trying to use debugger to understand your algorithm, but it crashes from time to time. Take the line 51 for example,<br>
a=np.array(([high[1:(lb):1]-low[1:(lb):1],abs(high[1:(lb):1]-close[0:(lb-1):1]),abs(low[1:(lb):1]-close[0:(lb-1):1])]))<br>
I tried to check the content of the variable a, the IDE became irresponsive as soon as I clicked the variable. After a few secs, the IDE threw up a runtime exception and exited the debugging mode. My guess is the variable consumes too much memory, but not sure. Any idea how to debug the algorithm without crashing? Thanks  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='569e31ca8e5581a511000200' id='569e31ca8e5581a511000200'>
<a href='#569e31ca8e5581a511000200'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/514a23ed46a2329dd8000027'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f292ab7887c2e8698d013b40e1718e8b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/514a23ed46a2329dd8000027'>Suminda Dharmasena</a>
</div>
<a UTCms='1453208013000' class='quanto-date posted-at response-posted-at' href='#569e31ca8e5581a511000200'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Since there is a lot of interest in these type of strategies, it will be good if this can be made available for lie trading as well soon as possible. Eagerly awaiting the role out of these features for live trading.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56a085b74b5192f17d0002e9' id='56a085b74b5192f17d0002e9'>
<a href='#56a085b74b5192f17d0002e9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/550b93dd8be2416fcf0004ed'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9ada400124648a3aaa133654cd5ccb13?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/550b93dd8be2416fcf0004ed'>zhixing tang</a>
</div>
<a UTCms='1453360571000' class='quanto-date posted-at response-posted-at' href='#56a085b74b5192f17d0002e9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>OK , I get it . Thanks very much.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56a09854716937913500005c' id='56a09854716937913500005c'>
<a href='#56a09854716937913500005c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1453365341000' class='quanto-date posted-at response-posted-at' href='#56a09854716937913500005c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>No idea why it crashes during debugging.  I never had that problem but have not revisited the algo recently. Perhaps the Q team can help?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56a1026b4b5192e423000046' id='56a1026b4b5192e423000046'>
<a href='#56a1026b4b5192e423000046'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55eefc2af269c592d80008a9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8985b490c95e135c2bbcd7d1a0dce16b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55eefc2af269c592d80008a9'>Jamie McCorriston</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1453392498000' class='quanto-date posted-at response-posted-at' href='#56a1026b4b5192e423000046'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi BO,</p>

<p>I suspect the timeout is occurring because the components of the <code>a</code> array are quite large. Can you try inspecting just a subset of them?  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5704996b55a254974300054a' id='5704996b55a254974300054a'>
<a href='#5704996b55a254974300054a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/570310bcd7137f70a000035c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fac9334eb979089dd464854c6bac8d58?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/570310bcd7137f70a000035c'>Steven Hayes</a>
</div>
<a UTCms='1459919220000' class='quanto-date posted-at response-posted-at' href='#5704996b55a254974300054a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi </p>

<p>I&#39;m new but I really like this concept. Is there any chance someone could provide instructions or help with making this usable for live trading using Robinhood?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5718f43ade4a2ca636000a57' id='5718f43ade4a2ca636000a57'>
<a href='#5718f43ade4a2ca636000a57'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55eefc2af269c592d80008a9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8985b490c95e135c2bbcd7d1a0dce16b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55eefc2af269c592d80008a9'>Jamie McCorriston</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1461253185000' class='quanto-date posted-at response-posted-at' href='#5718f43ade4a2ca636000a57'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Anthony With the recent upgrade to Quantopian 2, and the work that was done last month to handle delisted securities, this algo can now be run in minute mode. It occasionally times out when run from 2003-2015, but can be thinned out by scheduling the stop-loss check to run less frequently than minutely (for example, every 15 minutes).  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5718fc37bb3e7d6347000acf' id='5718fc37bb3e7d6347000acf'>
<a href='#5718fc37bb3e7d6347000acf'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/53dfa27b197bbb2516000159'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/51e4ba51c431ce2b4373006a33ade2aa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/53dfa27b197bbb2516000159'>Karen Rubin</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1461255227000' class='quanto-date posted-at response-posted-at' href='#5718fc37bb3e7d6347000acf'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I moved the stop-loss check into the daily rebalance. It&#39;s much speedier than in handle_data and interestingly has even higher returns.  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='571a23aaa8750c8b6c000715' id='571a23aaa8750c8b6c000715'>
<a href='#571a23aaa8750c8b6c000715'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1461330862000' class='quanto-date posted-at response-posted-at' href='#571a23aaa8750c8b6c000715'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Jamie, Karen thank you indeed for your work. I shall check it all through, run a few tests and report back with any interesting findings.  One thing people should be very wary of is the rebalance date.  You will get very different results depending on what date you choose (1st day, 15th whatever). For what it is worth it is best to use rolling dates and to split the portfolio into 4, each with a different rolling monthly re-allocation date.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='571a3190a8750c8fa000095b' id='571a3190a8750c8fa000095b'>
<a href='#571a3190a8750c8fa000095b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5501f65c1417ee47b4000053'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4e1f11275965a4ecbc9abef70305008a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5501f65c1417ee47b4000053'>Geert Nijs</a>
</div>
<a UTCms='1461334421000' class='quanto-date posted-at response-posted-at' href='#571a3190a8750c8fa000095b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Anthony,</p>

<p>Impressive algorithm. Just one question: what do you mean with &quot;rolling monthly&quot; date ? Do you mean at a fixed interval, for example, starting on 1 jan and then every 30 days (loosing the month designation by time)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='571a53d1fb008d53b3000120' id='571a53d1fb008d53b3000120'>
<a href='#571a53d1fb008d53b3000120'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1461343198000' class='quanto-date posted-at response-posted-at' href='#571a53d1fb008d53b3000120'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Yes, exactly. Starting on any given day and then the next allocation date will be 20 business days later or whatever.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='571b8332f81ec44059001023' id='571b8332f81ec44059001023'>
<a href='#571b8332f81ec44059001023'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1461420855000' class='quanto-date posted-at response-posted-at' href='#571b8332f81ec44059001023'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>My belief is that this algorithm should probably not be used to rotate into a small number of ordinary stocks (such as 10). It is an entirely different matter with index tracking ETFs where I am happy to rotate into 10 (and do).  You will find a low number very unstable and unreliable - make the smallest change and the results will radically alter. Try running it on different days of the month and you will see what I mean.</p>

<p>Use bigger numbers and the stability begins to disappear - not surprisingly. The problem is that the Q back framework does not appear to be up to it. I have been trying to run rotations into 50 stocks for instance and I keep getting:</p>

<blockquote>
<p>MemoryError<br>
Algorithm used too much memory. Need to optimize your code for better performance</p>
</blockquote>

<p>Please also see line 132 in Karen&#39;s source code:</p>

<blockquote>
<pre><code># Increase our position in stocks that are performing better than their target and reset the target
</code></pre>
</blockquote>

<p>This was not my intention. The algo actually takes profit rather than pyramids. Or at least did.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='571e2939afc494880400001a' id='571e2939afc494880400001a'>
<a href='#571e2939afc494880400001a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5501f65c1417ee47b4000053'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4e1f11275965a4ecbc9abef70305008a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5501f65c1417ee47b4000053'>Geert Nijs</a>
</div>
<a UTCms='1461594433000' class='quanto-date posted-at response-posted-at' href='#571e2939afc494880400001a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Sorry but i am a beginner in python and Quantopian, and i don&#39;t really understand what &quot;context.acc_leverage&quot; is in the code above (can&#39;t find it in the help pages either). Is this the total value of everything (ie sum of all stock values at current date + cash amount) ? I understand that when a new position is taken, it is taken as 1/n th part of this, but if it includes stock value, how is enough cash freed if 1/n of total value is larger than the amound of available cash ?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='571f1c3eafc4948804000b4e' id='571f1c3eafc4948804000b4e'>
<a href='#571f1c3eafc4948804000b4e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1461656643000' class='quanto-date posted-at response-posted-at' href='#571f1c3eafc4948804000b4e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>It is a user defined variable. It works only because reallocations are done on the same date. 1/total number of stocks means the account will be fully invested at  max....IE no leveraging  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='571f570490965334c9000181' id='571f570490965334c9000181'>
<a href='#571f570490965334c9000181'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5501f65c1417ee47b4000053'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4e1f11275965a4ecbc9abef70305008a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5501f65c1417ee47b4000053'>Geert Nijs</a>
</div>
<a UTCms='1461671690000' class='quanto-date posted-at response-posted-at' href='#571f570490965334c9000181'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ok thanks Anthony, i get it now (i didn&#39;t see the global definition of the variable). So acc_leverage is not an amount, it is just a way to set how much you want to go in &quot;debt&quot;. By setting it to 1 , you say &quot;no debt positions&quot;. Anyway, taking this into account, the weight will actually always be 1/10th if you are evaluating many many stock. In fact, you are just ranking them, the only way that a stock can drop from the list is by the filter (ie market cap &amp; efficiency ratio). So most of the time you are going to have 10 stocks in the list, but you are only really buying into one, if its short term (one month) momentum is positive, which is not the same as being in the list.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='571f5a2ccdf86e9f37000ca4' id='571f5a2ccdf86e9f37000ca4'>
<a href='#571f5a2ccdf86e9f37000ca4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5501f65c1417ee47b4000053'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4e1f11275965a4ecbc9abef70305008a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5501f65c1417ee47b4000053'>Geert Nijs</a>
</div>
<a UTCms='1461672497000' class='quanto-date posted-at response-posted-at' href='#571f5a2ccdf86e9f37000ca4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Only one remark: ignoring the filters of efficiency rating/market cap etc, you are ranking by average momentum and then taking top 10. Then you are only checking the short term momentum for ordering. This means it is still possible that a stock with negative average momentum can make it to the TOP10 and then be ordered, if its short term momentum is positive. Is this intentionally ? Or shouldn&#39;t a stock with negative average momentum be ignored from the buy list , even if short_term mom is positive ?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='571f6f41afc4948804000e60' id='571f6f41afc4948804000e60'>
<a href='#571f6f41afc4948804000e60'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1461677895000' class='quanto-date posted-at response-posted-at' href='#571f6f41afc4948804000e60'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>That is the way I originally drafted it and I agree with your view. I have not yet looked in detail at the helpful Q2 redraft.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='572089c68e9373e56c0000e9' id='572089c68e9373e56c0000e9'>
<a href='#572089c68e9373e56c0000e9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5501f65c1417ee47b4000053'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4e1f11275965a4ecbc9abef70305008a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5501f65c1417ee47b4000053'>Geert Nijs</a>
</div>
<a UTCms='1461750220000' class='quanto-date posted-at response-posted-at' href='#572089c68e9373e56c0000e9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Analysing the transaction history, i noticed that a lot of trades are spread across multiple minutes because the volume at that minute was 0.<br>
This leads to many small orders on the rebalancing day spread across multiple minutes.<br>
I removed these small orders by disabling the slippage model basically:<br>
 set_slippage(slippage.FixedSlippage(spread=0.00))</p>

<p>Because we are trading high market cap stock, and with relatively low money (10.000$), order size is small and we can assume orders will be executed at order price and in one block. This reduced the number of transactions heavily.</p>

<p>Another change i would like to do is in the rebalancing. Today the rebalancing is done for every stock, sometimes leading to small orders like 1 or 2 stocks to get the weight right. I&#39;d like to rebalance only when the trade size is considerably so only when the stock is considerably overweight, not a small bit (ie min 5% overweight), still looking how to do that.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5732031ccf7432850a0009a6' id='5732031ccf7432850a0009a6'>
<a href='#5732031ccf7432850a0009a6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5501f65c1417ee47b4000053'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4e1f11275965a4ecbc9abef70305008a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5501f65c1417ee47b4000053'>Geert Nijs</a>
</div>
<a UTCms='1462895393000' class='quanto-date posted-at response-posted-at' href='#5732031ccf7432850a0009a6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The same goes for the selling:</p>

<p>or stock in context.portfolio.positions:<br>
        if data.can_trade(stock) not in context.stock_list or context.stock_factors.factor_1[stock]&lt;=1:<br>
            order_target(stock, 0)</p>

<p>This will sell a stock immediatly when its one month momentum is negative, even if his average momentum across the 4 periods is positive. Is this intentionally ?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57331013ce4e0cab020009de' id='57331013ce4e0cab020009de'>
<a href='#57331013ce4e0cab020009de'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5501f65c1417ee47b4000053'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4e1f11275965a4ecbc9abef70305008a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5501f65c1417ee47b4000053'>Geert Nijs</a>
</div>
<a UTCms='1462964246000' class='quanto-date posted-at response-posted-at' href='#57331013ce4e0cab020009de'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I always wondered why you calculated the average rank number. I would calculate an average of the return (momentum) itself and pick the top 10 with highest average return. So i took the code from Tristan Dec18th and changed the following lines:</p>

<pre><code>combo_raw = (factor1+factor2+factor3+factor4) / 4  
pipe.add(combo_raw, &#39;combo_raw&#39;)  
pipe.add(combo_raw.rank(mask=total_filter,ascending=False), &#39;combo_rank&#39;)
</code></pre>

<p>So instead of averaging the rank numbers, i am calculating an average of the momentum itself and then sort by highest average momentum across the 4 periods.<br>
Now that was not a good idea !<br>
Below you can see the partial results, since it crashed, but it is very clear, the return is very bad.<br>
So it seems ordering according to the rank is vastly more superior then ordering on the real average momentum itself !</p>

<p><a href="http://i.imgur.com/xK1UE8e.png">Partial Run</a></p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57361c8909880f48020000d4' id='57361c8909880f48020000d4'>
<a href='#57361c8909880f48020000d4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5501f65c1417ee47b4000053'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4e1f11275965a4ecbc9abef70305008a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5501f65c1417ee47b4000053'>Geert Nijs</a>
</div>
<a UTCms='1463164054000' class='quanto-date posted-at response-posted-at' href='#57361c8909880f48020000d4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I am also having some doubt about the efficiency ratio calculation. When debugging, i am seeing er higher than 2 which should be impossible.<br>
Of course, your definition is not the standard one, but still:  </p>

<pre><code>
                     combo_rank  factor_1        er  
Equity(19660 [XLU])         738  1.096878  1.407129  
Equity(21757 [EWZ])         750  1.141883  1.223757  
Equity(19658 [XLK])         993  1.027546  2.334963  
Equity(19656 [XLF])        1101  1.014971  0.676471  
Equity(19654 [XLB])        1238  1.013098  0.439252  
Equity(19920 [QQQ])        1324  1.009743  2.215429  
Equity(21520 [IWV])        1510  1.005367  1.552392  
Equity(8554 [SPY])         1559  1.003080  1.460942  
Equity(21516 [IWB])        1571  1.002289  1.457763  
Equity(12915 [MDY])        1583  0.995635  1.049301  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5737a618881a42884900027c' id='5737a618881a42884900027c'>
<a href='#5737a618881a42884900027c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56b00aea4339666f650001cb'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5d8f88a1960d4cd79d20b17a2631df1e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56b00aea4339666f650001cb'>Peter Falter</a>
</div>
<a UTCms='1463264797000' class='quanto-date posted-at response-posted-at' href='#5737a618881a42884900027c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I second Geert&#39;s concern about er values outside (-1,1) and have a basic question on the strategy.</p>

<p>While the standard Kaufman ER (KER) value must be in the range (-1,1) it is possible for the Garner ER (GER) to be exceed this range.<br>
This should be rarely encountered except for short windows since it requires behavior that is unlikely<br>
a) the daily price change (Close-Close[prior day] ) must be consistently of one sign (nearly monotonic trending)<br>
b) the daily High-Low to be consistently less than absolute of the daily price change (overnight change dominates daily change)</p>

<p>KER seems to be used by others an indicator of trend strength over short periods (periods &lt; typical trend durations)<br>
What is the rationale for using a similar measure (GER) over a long window (252 days)?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5738091b34809278310006c2' id='5738091b34809278310006c2'>
<a href='#5738091b34809278310006c2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57367bfe11ac838d4a0003f2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a496de1bd43866237b4e765963df6ded?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57367bfe11ac838d4a0003f2'>Hai Lu</a>
</div>
<a UTCms='1463290143000' class='quanto-date posted-at response-posted-at' href='#5738091b34809278310006c2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>No shorting in thid algo?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5739836679c0971f6d000316' id='5739836679c0971f6d000316'>
<a href='#5739836679c0971f6d000316'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5501f65c1417ee47b4000053'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4e1f11275965a4ecbc9abef70305008a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5501f65c1417ee47b4000053'>Geert Nijs</a>
</div>
<a UTCms='1463386987000' class='quanto-date posted-at response-posted-at' href='#5739836679c0971f6d000316'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Indeed, no shorting.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='573a1316705632a593000a62' id='573a1316705632a593000a62'>
<a href='#573a1316705632a593000a62'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1463423770000' class='quanto-date posted-at response-posted-at' href='#573a1316705632a593000a62'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>A trend follower wants and needs to avoid false signals due to noise. A trend following model will reap the greatest and cleanest profits when a market breaks out in one direction and never looks back – a perfect (non-achievable!) trend would go from point A at the bottom left hand corner of the chart to point B at the top right hand corner in an absolutely straight line with no retracements. </p>

<p>Kaufman’s Efficiency Ratio as I had meant to draft it has values ranging from 0 when markets are very noisy and a theoretical +1 when markets are perfectly directional. </p>

<p>Any value above 1 indicates an error in the coding.</p>

<p>252 days was chosen because round about a year is  generally considered the maximum sensible look back for a momentum indicator.</p>

<p>I have not looked at Q 2 and regrettably do not have time to.  Haven&#39;t looked at the calculations for a while. </p>

<p><a href="http://intel.harriman-house.com/trading/the-growing-problem-of-trendless-markets-a-trend-efficiency-index-study/">Trendless Markets</a></p>

<p>The one hundred instruments tested were all concatenated futures prices back adjusted to eliminate gaps.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='573a1e3d6e78b3ab95000001' id='573a1e3d6e78b3ab95000001'>
<a href='#573a1e3d6e78b3ab95000001'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1463426626000' class='quanto-date posted-at response-posted-at' href='#573a1e3d6e78b3ab95000001'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><pre><code>#calculations for efficiencyRatio  
a = abs(data - data.shift(periods=1, freq=None, axis=0))  
a[a.isnull()] = 0.0  
b=pd.rolling_sum(a, efficiencyLookback)  
b[b.isnull()] = 0.0  
efficiencyRatio = abs(data - data.shift(periods=efficiencyLookback, freq=None, axis=0))/b  
efficiencyRatio[efficiencyRatio.isnull()] = 0.0  
</code></pre>

<p>data = Closing price pandas data-frame with 2 columns - date and Close.<br>
So, this is how I calculate it in a simpler Python interpretation and the values are between a theoretical 0 and +1. As indeed happens.<br>
My article referenced above might help to explain how and why I use the indicator / find it useful. </p>

<p>I am afraid I really can not face Pipeline and Q2 just at the moment but if the code IS wrong, perhaps you can at least see what I was getting at.</p>

<p>Not at all keen on logging and de-bugging in Q. On my python back tester at home I would typically download data,  a, b and efficiency Ratio into a csv spreadsheet for inspection.</p>

<p>Does make life a bit easier.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='573a35df89bb64093f000097' id='573a35df89bb64093f000097'>
<a href='#573a35df89bb64093f000097'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57222d42b586294c7700031d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7f373e513d97f0a8c4b78ba33d9178a7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57222d42b586294c7700031d'>Tyler Trumbo</a>
</div>
<a UTCms='1463432674000' class='quanto-date posted-at response-posted-at' href='#573a35df89bb64093f000097'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Anthony,</p>

<p>thanks for the awesome lesson. i am constantly searching the internet for expert lessons like that and they are rare. i have a question if you dont mind.  what is collections, defaultdict [lambda:0]? i am trying to make a trail stop but running into trouble when i try to do it for each stock i use.<br>
Thanks,<br>
Tyler  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='573adcea89bb64093f0007a2' id='573adcea89bb64093f0007a2'>
<a href='#573adcea89bb64093f0007a2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1463475438000' class='quanto-date posted-at response-posted-at' href='#573adcea89bb64093f0007a2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>In my opinion you need to learn Python and Pandas  from the bottom up. There is no shortcut. I am still in that process myself.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='573ae40631738e689200041e' id='573ae40631738e689200041e'>
<a href='#573ae40631738e689200041e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56d233d9e408a6d654000284'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5028e3e4d8db7ddddd91988bda86194a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56d233d9e408a6d654000284'>toan tran</a>
</div>
<a UTCms='1463477258000' class='quanto-date posted-at response-posted-at' href='#573ae40631738e689200041e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anthony, you mentioned earlier why you do not think these results would hold up in real money trading. I will read that part again but can you elaborate on this as to why?<br>
Can anyone else who can chime in? i&#39;d really like to know.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='573b3957374bb23c90000196' id='573b3957374bb23c90000196'>
<a href='#573b3957374bb23c90000196'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1463499109000' class='quanto-date posted-at response-posted-at' href='#573b3957374bb23c90000196'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I do not believe one should trade a model such as this by rotating into a small number of stocks, especially if the universe is large.   The concept &quot;works&quot; - take the actual trading history of the Guggenheim S&amp;P 500® Equal Weight ETF by example and compare it to the SPY. </p>

<p>But my belief/preference is that one probably wants to rotate into at least 50 stocks and choose a relative small universe - perhaps the top 1000 by market cap rather than 5000 for instance.</p>

<p>You will see what I mean if you back test this system on a mere 5 or 10 stocks out of a relatively large universe on different days of the month.   The results will differ hugely. As you increase the number of stocks you rotate into and/or decrease the size of the universe somewhat a measure of stability returns and it begins not to matter which day of the month you choose for your allocations.</p>

<p>In my own trading I divide my trading into 4 subsystems each reallocating on an equally spaced different monthly date.  Currently I trade ETFs not stocks and can therefore afford to rotate into a small number (10).  But I would not use 10 for individual stocks, personally speaking.</p>

<p>I&#39;m sorry I can&#39;t be of more help on this actual Q version....I have lost track. And am concentrating on my own version in my own back test engine.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='573b496c0fa8ba401a0000a3' id='573b496c0fa8ba401a0000a3'>
<a href='#573b496c0fa8ba401a0000a3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/562545816f0077be2a000054'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/65eed7bd690af7911cb4e82f70d3a8f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/562545816f0077be2a000054'>Shawn Emhe II</a>
</div>
<a UTCms='1463503222000' class='quanto-date posted-at response-posted-at' href='#573b496c0fa8ba401a0000a3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I wrote the custom factor below to calculate the efficiency ratio in pipeline for some research I was doing. It requires a window_length input for which the ratio is to be calculated over. There is no null value handling, so whoever decides to work it into the algorithm may need to do some debugging.  </p>

<pre><code>class Efficiency_Ratio(CustomFactor):  
    inputs = [USEquityPricing.close]  
    def compute(self, today, assets, out, close):  
        direction = np.absolute(close[-1] - close[0])  
        volatility = np.sum(np.absolute(np.diff(close, axis=0)), axis=0)  
        out[:] = direction / volatility  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='573b71068e3a9577b8000226' id='573b71068e3a9577b8000226'>
<a href='#573b71068e3a9577b8000226'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5501f65c1417ee47b4000053'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4e1f11275965a4ecbc9abef70305008a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5501f65c1417ee47b4000053'>Geert Nijs</a>
</div>
<a UTCms='1463513355000' class='quanto-date posted-at response-posted-at' href='#573b71068e3a9577b8000226'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I modified the code to look more like Anthony&#39;s original ETF trading idea:</p>

<ul>
<li>You can now run the test on a limited number of specific stock or ETFs, in this case around 60 ETFs<br></li>
<li>I removed the market cap filter factor since it is irrelevant for ETFs<br></li>
<li>I also moved the Efficiency Factor filter from the pipeline to the ordering process. In previous algos, stocks with bad ER were filtered even if their return would be very good (ie TOP10). This algoritme orders and selects only based on average momentum rank.  It then orders only when the ER is high enough. So it allows a high momentum quote with bad ER to take a place in the TOP10, while previously this quote would never get into the TOP10 because it would already be filtered by ER<br></li>
<li>Efficiency Factor used in the real KER (Kaufman), based on code above<br></li>
<li>Because Quantopian can&#39;t backtest 4 portfolios in one time, i increased the rebalancing of this single portfolio to once every 5 days.<br></li>
<li>ER is calculated with 20day window_length instead of 252. NOTE: when you change the window_length of ER, you should also adjust the ER threshold. Threshold was 0.031 for 252 backwindows, for 20 backwindows i choose 0.31<br></li>
<li>There is also some more advanced zero and NA handling in the ER and combo_rank columns. Sometimes i saw a combo_rank of 0, which catapulted it directly to the top of any TOP10 list :-)<br></li>
<li>Some more parameter tuning:<br>

<ul>
<li>buying is only done when in TOP10, short term (20d) <strong>and</strong>  longer (3month) momentum are &gt; 1 and high ER<br></li>
<li>increase the stoploss limit to 0.9 for ETFs instead of 0.5 for stocks</li>
</ul></li>
</ul>

<p>Now for the results:<br>
- They are not so good.<br>
- The system does avoid nicely the 2008 crash.<br>
- The system does go to cash when no uptrend in the market<br>
- However, it fails badly the last 3 years. I don&#39;t yet understand why. It selects ETFs with higher performance than SPY, yet fails to make a profit with it. Very strange.</p>

<p>Improvements:<br>
- I still need to look at the ER code. It returns often zero for some reason on a number of ETFs. This should only be possible if the close of the lookback is exactly the close of yesterday<br>
- I am looking to improve the profit taking procedure. Instead of a fixed percentage, i want to calculate the target based on average true range, like Anthony describes on his system.<br>
- I also feel that simple momentum is not a good indicator to buy or dump stocks. The fact that it depends only on 1 price in the past makes it jumpy. For example, take a quote that has been flat forever, only 30 days ago it dropped 10% and the next day it recovered. The 30day momentum will show that it is a &quot;good&quot; stock. The same on the opposite side: one 10% jump up 30 days ago (even intraday), can give a -10% momentum on the rebalancing day and cause the system to sell the stock. Therefore i try to take long term momentum also into account during buying.<br>
 But in the end, I feel that calculating the slope of a 20day linear regression line is much better to indicate &quot;trend&quot; compared to 20day momentum  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='573b9c878b27654d9e000092' id='573b9c878b27654d9e000092'>
<a href='#573b9c878b27654d9e000092'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1463524492000' class='quanto-date posted-at response-posted-at' href='#573b9c878b27654d9e000092'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>One outstandingly good opportunity to curve fit is in portfolio choice. I tried to avoid this.  It is  often  trivially easy to cook up good back tests by careful choice of rules, parameters and portfolio. The choices on my website for TAA1 for my own trading attempt to avoid hindsight bias and perhaps should be simified further. I would be alarmed if my back test s had shown brilliant recent results since last August looking back over the last few years the US had been the only game in town. My object was to diversify very widely without taking too much heed of backtest results. A better benchmark is the MSCI World but even then it is of course very hea ily weighted to the US.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='573b9e45bc6e477a1e0000a3' id='573b9e45bc6e477a1e0000a3'>
<a href='#573b9e45bc6e477a1e0000a3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1463524944000' class='quanto-date posted-at response-posted-at' href='#573b9e45bc6e477a1e0000a3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>There is no guarantee that my objects have been achieved and only time will tell.  This month for instance I am heavily into emerging markets and down twice the decline of the benchmark. We&#39;ll see.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='573ba892f8f4dccdb70000ed' id='573ba892f8f4dccdb70000ed'>
<a href='#573ba892f8f4dccdb70000ed'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56d233d9e408a6d654000284'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5028e3e4d8db7ddddd91988bda86194a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56d233d9e408a6d654000284'>toan tran</a>
</div>
<a UTCms='1463527574000' class='quanto-date posted-at response-posted-at' href='#573ba892f8f4dccdb70000ed'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anthony, you&#39;ve been extremely helpful and I appreciate it. Thank you. I plan on spending today looking over your code.</p>

<p>cheers!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='573c2bd4f8f4dccdb700057a' id='573c2bd4f8f4dccdb700057a'>
<a href='#573c2bd4f8f4dccdb700057a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1463561177000' class='quanto-date posted-at response-posted-at' href='#573c2bd4f8f4dccdb700057a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I think I have been honest. Whether anyone finds that helpful or not...is another matter.   On the various videos and dull postings on my website I try to make it clear that I have no idea what the future holds and that my approach is therefore to allocate to as wide a group of asset classes as possible. And then let the matter simply float on the waves and hope the result is positive.</p>

<p>I make the point that overweighting could be a great mistake.  Hence my preference for more equally weighted schemes rather than market cap approaches adopted by most index providers. Japan represented a 40% market cap weighting in the MSCI World back in the 1980s. Was this sensible? The US represents 50% of the MSCI World today. Do you want 50% of your assets tied to one nation, one economy?</p>

<p>Would you have been happy had you allocated 50% to Germany, Russia or Argentine back in 1900? I suspect not.</p>

<p>If people want to gamble heavily in the short term on a scheme for trading which happens to rake in good returns for a period of time, then fine. But that sort of approach so often ends in disaster. </p>

<p>The long view is perhaps a better approach.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='573c70a91c3cb5122f000802' id='573c70a91c3cb5122f000802'>
<a href='#573c70a91c3cb5122f000802'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5501f65c1417ee47b4000053'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4e1f11275965a4ecbc9abef70305008a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5501f65c1417ee47b4000053'>Geert Nijs</a>
</div>
<a UTCms='1463578802000' class='quanto-date posted-at response-posted-at' href='#573c70a91c3cb5122f000802'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anthony, you are right. It is not fair to compare the performance of a system that trades worldwide with an index of one country.<br>
I tried to use the MSCI World index as a benchmark, however i don&#39;t seems to find a ticker that goes back to 2003, the start of the backtest. Maybe someone of Q can help ?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57921f52432bd243c10008d6' id='57921f52432bd243c10008d6'>
<a href='#57921f52432bd243c10008d6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/573f9e1e72c917eb930001b2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ed9a9aae7b39249213e4245240c6e112?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/573f9e1e72c917eb930001b2'>Santiago Bedoya</a>
</div>
<a UTCms='1469194073000' class='quanto-date posted-at response-posted-at' href='#57921f52432bd243c10008d6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Has anyone edited this code for live trading?? Thanks!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='579227bef30759de0b000520' id='579227bef30759de0b000520'>
<a href='#579227bef30759de0b000520'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/573f9e1e72c917eb930001b2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ed9a9aae7b39249213e4245240c6e112?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/573f9e1e72c917eb930001b2'>Santiago Bedoya</a>
</div>
<a UTCms='1469196233000' class='quanto-date posted-at response-posted-at' href='#579227bef30759de0b000520'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I gave it a go at editing for live trading but not sure if I got it right. Could someone please double check?? Im still in the learning phase and just experimenting with different things.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a837e28e9705733100007a' id='57a837e28e9705733100007a'>
<a href='#57a837e28e9705733100007a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/562a1289674f851bcb0004e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d5bd698ff611c488050f57c663ac725a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/562a1289674f851bcb0004e2'>Lake Austin</a>
</div>
<a UTCms='1470642155000' class='quanto-date posted-at response-posted-at' href='#57a837e28e9705733100007a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>thanks for  Anthony sharing this great algo. Indeed impressive.</p>

<p>I backed tested the version Karen edited in 2003-now and 2011-now period (or look at alpha table in the backtest). In recently years, the alpha is much smaller than it was for early 2000s. I guess many investors adopt momentum strat, market became more efficient and thus alpha became narrowed.</p>

<p>Any another possible reasons/explanations and outlook for performance of momentum strat in future 5 - 10 years?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a883ae85fc8783600003a5' id='57a883ae85fc8783600003a5'>
<a href='#57a883ae85fc8783600003a5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1470661557000' class='quanto-date posted-at response-posted-at' href='#57a883ae85fc8783600003a5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Lake, I&#39;ve been at it a long time but still have a way to go. I&#39;m not too worried about momentum in the long term, especially after the very long term momentum tests I outline on my website. These go back to 1700-ish in the UK and the mid 19th Century in the US thanks to data from the Bank of England and the NBER in the US.</p>

<p>I think the difficulty is in the middle ground and for those trying to shoot the lights out. I&#39;m always looking at promising ways to shoot the lights out but they mostly turn out to be moonshine. Such as the recent algo here on Q looking at profiting from bounces in low liquidity stocks. Great idea, but when you start adding more realistic constraints, the unicorn vanishes to be replaced by a more commonplace beast.</p>

<p>My latest obsession is AI and machine learning and one academic paper referenced on my website and here on Q talks of a back tested 45% cagr momentum strategy.</p>

<p>My suspicion is that it will turn out to be just that: &quot;academic&quot;.</p>

<p>I do believe that one can better buy and hold of index funds but that the more return you seek, the greater the dangers of disappointment.  And those who use leverage will probably die by it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a894d385fc87714d000037' id='57a894d385fc87714d000037'>
<a href='#57a894d385fc87714d000037'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/562a1289674f851bcb0004e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d5bd698ff611c488050f57c663ac725a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/562a1289674f851bcb0004e2'>Lake Austin</a>
</div>
<a UTCms='1470665946000' class='quanto-date posted-at response-posted-at' href='#57a894d385fc87714d000037'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>thanks for the comments. I see your points. However, with computer, internet, and greate platform like Q , the speed of information /knowledge spread may exceed what we think. and thus premiums like momentum may become narrow  in future. just gut feeling no hard data/evidence to back it up. </p>

<p>saw your share about the AI paper, will take a closer look :)   thanks for sharing.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a89696552ae6a87400000e' id='57a89696552ae6a87400000e'>
<a href='#57a89696552ae6a87400000e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/562a1289674f851bcb0004e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d5bd698ff611c488050f57c663ac725a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/562a1289674f851bcb0004e2'>Lake Austin</a>
</div>
<a UTCms='1470666400000' class='quanto-date posted-at response-posted-at' href='#57a89696552ae6a87400000e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<blockquote>
<p>at profiting from bounces in low liquidity stocks.<br>
well, I agree with you.<br>
 i also think it depends on size of found the algo is going to manage. in general , i tend to think traditional analysis is required for investing in very small cap (e.g. &lt; 400M market cap) and low liquidity stocks.  </p>
</blockquote>
</blockquote>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a953548201f4438a0002db' id='57a953548201f4438a0002db'>
<a href='#57a953548201f4438a0002db'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56b00aea4339666f650001cb'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5d8f88a1960d4cd79d20b17a2631df1e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56b00aea4339666f650001cb'>Peter Falter</a>
</div>
<a UTCms='1470714716000' class='quanto-date posted-at response-posted-at' href='#57a953548201f4438a0002db'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I got some free time to look at this algorithm again and to clean up a few features that were affecting my ability to understand how this was to work. </p>

<p>In particular<br>
1) the problem of short sales in a long algo is resolved by changing the sequence in which orders are placed<br>
2) liquicity problems are greatly reduced by three changes. They are small enough that leverage is very near 1.0 except when the algo sells during the month and leverage drops &lt; 1.0 as expected<br>
3) max drawdown is reduced by a simply entry/exit model that puts the portfolio into bonds during indicated downturns in the SP500<br>
4)  the effect of the efficiency test may be had by requiring that the one year return be &gt; 0.0 (factor_4&gt;1.0)</p>

<p>Other notes are in the attached file.</p>

<p>The result is what I think the asset allocation promoters like Faber want us to find: Long term growth &gt; SP500, max drawdown &lt; SP500, slower pace of trading (monthly) keeps transaction costs down.</p>

<p>[edit: corrected the statement 4 to read&quot;(factor_4&gt;1.0)&quot; vs &quot;(factor_4&gt;0.0)&quot;]</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a97308b84f61ca790008b7' id='57a97308b84f61ca790008b7'>
<a href='#57a97308b84f61ca790008b7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1470722833000' class='quanto-date posted-at response-posted-at' href='#57a97308b84f61ca790008b7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Peter<br>
Wonderful improvements and detailed explanation. Wholeheartedly agree. Had meant to get round to putting in the S&amp;P on / off switch but got diverted and never got round to it. My research elsewhere suggests the S&amp;P switch and the like will usually help greatly but be no means always.  The Efficiency Ratio is merely an attempt to filter out noisy stocks which wander too far on and off track in their journey to any specific price point.</p>

<p>Run a few tests to see what effect re-balancing on different days of the month has. It can be very alarming.</p>

<p>I am currently working on deep learning - will this improve momentum? Can a deep learning algo spot patterns in momentum that a simple lookback can not. I love your notes - my lack of notes is a disgrace. Many thanks for all this work - much appreciated.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a97915b84f61e0fe0009ef' id='57a97915b84f61e0fe0009ef'>
<a href='#57a97915b84f61e0fe0009ef'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1470724379000' class='quanto-date posted-at response-posted-at' href='#57a97915b84f61e0fe0009ef'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Take a look at the back tests of the system (as so admirably re-drafted by Peter Falter) and note that the only difference is the date on which the monthly re-balancing occurs. OMG! How do you begin to explain it?  This one uses &quot;22&quot; which I think is probably explicable in that it is a nonsense day many months. But the other tests below are sufficiently worrying to make this first nonsense test irrelevant.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a9797fb84f61ca790008ef' id='57a9797fb84f61ca790008ef'>
<a href='#57a9797fb84f61ca790008ef'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1470724486000' class='quanto-date posted-at response-posted-at' href='#57a9797fb84f61ca790008ef'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>And this.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a979b1b84f61ca790008f2' id='57a979b1b84f61ca790008f2'>
<a href='#57a979b1b84f61ca790008f2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1470724536000' class='quanto-date posted-at response-posted-at' href='#57a979b1b84f61ca790008f2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>And this.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a979e54859fa3bac00005d' id='57a979e54859fa3bac00005d'>
<a href='#57a979e54859fa3bac00005d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1470724588000' class='quanto-date posted-at response-posted-at' href='#57a979e54859fa3bac00005d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>And this  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a97a3db84f61e0fe0009fa' id='57a97a3db84f61e0fe0009fa'>
<a href='#57a97a3db84f61e0fe0009fa'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1470724675000' class='quanto-date posted-at response-posted-at' href='#57a97a3db84f61e0fe0009fa'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>And this!</p>

<p>Not very amusing is it?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a981f991ab53359a00004b' id='57a981f991ab53359a00004b'>
<a href='#57a981f991ab53359a00004b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/562545816f0077be2a000054'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/65eed7bd690af7911cb4e82f70d3a8f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/562545816f0077be2a000054'>Shawn Emhe II</a>
</div>
<a UTCms='1470726659000' class='quanto-date posted-at response-posted-at' href='#57a981f991ab53359a00004b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>This one uses &quot;22&quot;</p>
</blockquote>

<p>I believe the date offset is measured in business days, so it&#39;s also possible test would somehow be affected  by months with less than 22 business days.</p>

<p>Edit: Sorry, I just reread your post and noticed that you were already pointing that out. It would be interesting to dig into the results and figure out how quantopian handles those months.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a991816b792ae3680000d5' id='57a991816b792ae3680000d5'>
<a href='#57a991816b792ae3680000d5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1470730633000' class='quanto-date posted-at response-posted-at' href='#57a991816b792ae3680000d5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks for  Anthony&#39;s great work and Peter&#39;s improvement. I&#39;ve made some code optimation based on Peter&#39;s code. So one can use the built-in factor Returns instead of self-made factor. And the calculation of the momentum ranking can also be done in a self-made-factor. The returns of the back testing is almost the same. </p>

<p>Cheers</p>

<p>Thomas  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a9ab4efeb08790430001d5' id='57a9ab4efeb08790430001d5'>
<a href='#57a9ab4efeb08790430001d5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5103fb5f05e76f5d3a000114'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/26758cf12bcb1e1c124dfd950eaaac96?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5103fb5f05e76f5d3a000114'>Ricardo Hanesy</a>
</div>
<a UTCms='1470737237000' class='quanto-date posted-at response-posted-at' href='#57a9ab4efeb08790430001d5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>&quot;The unmodified performance of this algorithm is remarkable from 1/4/2003 to 11/30/2015
Total Returns 1287%    Benchmark 192.5%    Max Drawdown    50.4%&quot;</p>

<p>I admit I struggle with quantopian and python I guess due to older age and not having programmed in long time.  I don&#39;t understand what is remarkable about a 50.4% drawdown.  In real trading this will be probably 65% drawdown. With so high drawdown ruin is almost certain. If this is just an exercise in programming it&#39;s fine but this has little to do with profitable trading. BTW modified algo ytd DD is 37.4%, still too high by any standards.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a9b7116b792ae3680002e7' id='57a9b7116b792ae3680002e7'>
<a href='#57a9b7116b792ae3680002e7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/562a1289674f851bcb0004e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d5bd698ff611c488050f57c663ac725a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/562a1289674f851bcb0004e2'>Lake Austin</a>
</div>
<a UTCms='1470740249000' class='quanto-date posted-at response-posted-at' href='#57a9b7116b792ae3680002e7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Awesome improvements James. I was thinking about combine those mom factors  into one. you moved ahead. also observed better alpha in recent years not sure the source but your min num of stocks, safe asset  may both contributes.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a9ba3965262e298c0002e2' id='57a9ba3965262e298c0002e2'>
<a href='#57a9ba3965262e298c0002e2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56b00aea4339666f650001cb'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5d8f88a1960d4cd79d20b17a2631df1e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56b00aea4339666f650001cb'>Peter Falter</a>
</div>
<a UTCms='1470741054000' class='quanto-date posted-at response-posted-at' href='#57a9ba3965262e298c0002e2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anthony, Day-of-month sensitivity was one of the next features that I was going to evaluate. The other asset rotation models that I&#39;ve done quick looks on have shown significant day-of month sensitivity. Several posts on Quantopian have shown this behavior for various algos. What you show above is worse that I expected.</p>

<p>Community: what is the most convenient was to do a parametric study of sensitivity to a parameter?</p>

<p>Thomas, I like that more compact implementation of the momentum filters.</p>

<p>Ricardo, I agree with your dislike of an SP500-like 50% drawdown. Within the file I posted you&#39;ll see that drawdown reduction was an objective of mine and that typical values achieved were around 20%. Given the aggressive investing style, high returns and simple entry/exit rule I think 20% is a respectable result.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a9bce965262e317e0002e7' id='57a9bce965262e317e0002e7'>
<a href='#57a9bce965262e317e0002e7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1470741747000' class='quanto-date posted-at response-posted-at' href='#57a9bce965262e317e0002e7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>Ricardo, I agree with your dislike of an SP500-like 50% drawdown. </p>
</blockquote>

<p>As do we all. However the ideal of high return and low draw down  is, over the long term, an unachievable fantasy.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a9c0e1345dce5ed2000063' id='57a9c0e1345dce5ed2000063'>
<a href='#57a9c0e1345dce5ed2000063'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1470742759000' class='quanto-date posted-at response-posted-at' href='#57a9c0e1345dce5ed2000063'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>By the way here is what I do in my own trading to combat day of the month sensitivity: I divided the portfolio into 4 and trade each so that it rolls on a different day of the month - IE one re-allocates each week.</p>

<p>In US stocks, you can reduce sensitivity and increase stability while reducing returns by trading 50 to 100 stocks not ten. I would not trade 10. I am not currently trading a momentum model on US stocks but will get around to it sooner or later.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a9c3b4345dcecbb100008a' id='57a9c3b4345dcecbb100008a'>
<a href='#57a9c3b4345dcecbb100008a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1470743484000' class='quanto-date posted-at response-posted-at' href='#57a9c3b4345dcecbb100008a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here I am using Thomas Chang&#39;s most welcome further clean up with 50 stocks using 10, 15 and 20 days.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a9c5e865262e317e00036e' id='57a9c5e865262e317e00036e'>
<a href='#57a9c5e865262e317e00036e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1470744053000' class='quanto-date posted-at response-posted-at' href='#57a9c5e865262e317e00036e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Next......  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57a9c6536b792a01d9000356' id='57a9c6536b792a01d9000356'>
<a href='#57a9c6536b792a01d9000356'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1470744156000' class='quanto-date posted-at response-posted-at' href='#57a9c6536b792a01d9000356'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Next....  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57aae2855c474fa2eb0002ae' id='57aae2855c474fa2eb0002ae'>
<a href='#57aae2855c474fa2eb0002ae'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1470816907000' class='quanto-date posted-at response-posted-at' href='#57aae2855c474fa2eb0002ae'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Anthony and Peter,</p>

<p>I see the line as follow:<br>
   current_year = get_datetime(&#39;US/Eastern&#39;).year</p>

<p>But the &#39;current_year&#39; is not used anywhere. Why?</p>

<p>And I see a commond as follow:<br>
   #        if current_year &gt; 2003:</p>

<p>What does this mean?</p>

<p>Cheers  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57ab125092d07810110006ae' id='57ab125092d07810110006ae'>
<a href='#57ab125092d07810110006ae'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56b00aea4339666f650001cb'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5d8f88a1960d4cd79d20b17a2631df1e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56b00aea4339666f650001cb'>Peter Falter</a>
</div>
<a UTCms='1470829144000' class='quanto-date posted-at response-posted-at' href='#57ab125092d07810110006ae'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thomas, that has no effect in the published model. I missed that code fragment when I cleaned up my working file for posting one this site.</p>

<p>The code and comment are remnants of a trade study in which I changed the starting date to be earlier than the date at which the bond funds were available/liquid. I had placed a date test to allow for different safe set before/after 1/1/2003.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57ab13f6b0370df0a9000a51' id='57ab13f6b0370df0a9000a51'>
<a href='#57ab13f6b0370df0a9000a51'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56b00aea4339666f650001cb'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5d8f88a1960d4cd79d20b17a2631df1e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56b00aea4339666f650001cb'>Peter Falter</a>
</div>
<a UTCms='1470829564000' class='quanto-date posted-at response-posted-at' href='#57ab13f6b0370df0a9000a51'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anthony, I did some reading last night and found several articles about starting day sensitivity in rotation strategies or futures rolling strategies. The effect is well known by researchers and significant. The authors note very large performance variations especially for non-averaged measures (like max drawdown) and the returns of individual commodity futures (frozen orange juice was particularly sensitive). I won&#39;t have time to write a summary or try a mitigation strategy for several days.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57ab1afb92d078101100071c' id='57ab1afb92d078101100071c'>
<a href='#57ab1afb92d078101100071c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1470831365000' class='quanto-date posted-at response-posted-at' href='#57ab1afb92d078101100071c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Peter<br>
I have done a lot of work in the past on rolling strategies for futures. In particular for Crude Oil to try to take maximum advantage of the backwardation effect common in Crude&#39;s history.   Also on short term interest rates like the Eurodollar where you can increase bang for buck by rolling a little further out than the nearest contracts. </p>

<p>On rotation strategies fro stocks I have also played a lot with rolling dates. My TAA1 strategy uses 4 roling dates (as a opposed to fixed weekly dates, evenly spaced).</p>

<p>I&#39;m afraid at the end of the day this is probably about the best you can do. If you are a very big fund you could spilt the portfolio into 20 and roll 1/20th of the portfolio on each business day.</p>

<p>Do also take  a look at increasing the number of stocks to 50 to 100. It makes for a much more stable performance.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57ab722e3f03117d9f00031d' id='57ab722e3f03117d9f00031d'>
<a href='#57ab722e3f03117d9f00031d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/576a9723c71aac1b0800090c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d79ce8956124b4f7069e603d7b0a1a85?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/576a9723c71aac1b0800090c'>Kusina Spada</a>
</div>
<a UTCms='1470853686000' class='quanto-date posted-at response-posted-at' href='#57ab722e3f03117d9f00031d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Anthony, thanks for sharing, I just change the backtest period from 2015/01/01 to today and get a bad result<br>
Total Returns<br>
-6.4%  </p>

<p>Benchmark Returns<br>
9.5%  </p>

<p>Alpha<br>
-0.09  </p>

<p>Beta<br>
0.69  </p>

<p>Sharpe<br>
-0.19  </p>

<p>Sortino<br>
-0.26  </p>

<p>Information Ratio<br>
-0.34  </p>

<p>Volatility<br>
0.29  </p>

<p>Max Drawdown<br>
34.2%</p>

<p>Even I change the test period start date back to 2012/01/01, the strategy is weaker than SPY  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57abc9a9530583fd6f000454' id='57abc9a9530583fd6f000454'>
<a href='#57abc9a9530583fd6f000454'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1470876079000' class='quanto-date posted-at response-posted-at' href='#57abc9a9530583fd6f000454'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Quite interesting thread. Thanks Anthony. </p>

<p>Thomas, great analysis and impressive results. Thanks. I will have to study the strategy as I get reacquainted with Q.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57ac26698fe13172160000ef' id='57ac26698fe13172160000ef'>
<a href='#57ac26698fe13172160000ef'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1470899824000' class='quanto-date posted-at response-posted-at' href='#57ac26698fe13172160000ef'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Kusina any everybody,</p>

<p>Anthony&#39;s algo is just a starting point how to use the momentum stratergy. One can&#39;t simply use this by live trading. One has to do many fine tunings and this is realy not easy. </p>

<p>To create a money printer is a hard work. :-)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57ac851dd11bb78c3400001c' id='57ac851dd11bb78c3400001c'>
<a href='#57ac851dd11bb78c3400001c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1470924069000' class='quanto-date posted-at response-posted-at' href='#57ac851dd11bb78c3400001c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thomas, yes, I agree.</p>

<p>What I look for in a trading strategy is replicability. Will this trading strategy behave the same going forward, and is its trading concept sound?</p>

<p>The concept, in this case, of sorting by highest past momentum has some basis. It makes the assumption that this momentum might continue. A reasonable backtest for a sufficiently long time interval generating a sufficient number of trades should show this. </p>

<p>Your modifications, as well as Peter&#39;s, over Anthony&#39;s trading script show that there is positive alpha there. There is something that can be used going forward. </p>

<p>As you said, and again I agree. There are some weaknesses in this trading script but I think they can be addressed. Removing them should only enhance the strategy&#39;s performance level. </p>

<p>What I am more interested in, in a preliminary overview, are the underlying strengths of a concept and why it should work going forward. I can always address the weaknesses later.</p>

<p>One key concept you&#39;ve added to this strategy is the increase in the number of trades as the strategy progresses. For me, it says this: expressed in a single payoff matrix equation: A(t) = A(0) + Σ(H(1+at).*ΔP) which I expect to outperform.  </p>

<p>What I want is: Σ(H(strat_A)(1+at).*ΔP) &gt; Σ(H(strat_B).*ΔP) &gt; Σ(H(strat_S&amp;P500).*ΔP). And this strategy (stratA) does it.</p>

<p>Also, as you surmised, ER has no positive impact, therefore it does not matter, it is not what is driving this strategy. It could be removed or put to 0.0 as you suggested, since there is no value there.</p>

<p>If you reverse the momentum sorting, you will see all the performance disappear to the point that: Σ(H(strat_S&amp;P500).*ΔP) &gt; Σ(H(strat_B).*ΔP), it will not even outperform the index. Therefore, I say, there is some value in playing the momentum continuation gambit.</p>

<p>It&#39;s an interesting script and worth investigating.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57acbb7eb2582ac5f70004c3' id='57acbb7eb2582ac5f70004c3'>
<a href='#57acbb7eb2582ac5f70004c3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55ed0ebaf7eced2820000138'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/192fde5a5de866362a9e34c096cb8a9b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55ed0ebaf7eced2820000138'>Minh</a>
</div>
<a UTCms='1470937991000' class='quanto-date posted-at response-posted-at' href='#57acbb7eb2582ac5f70004c3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Interesting interpretation of momentum. The instability due to the time period of backtesting is a bit worrying.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57aced43448ca1d1ca000122' id='57aced43448ca1d1ca000122'>
<a href='#57aced43448ca1d1ca000122'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1470950732000' class='quanto-date posted-at response-posted-at' href='#57aced43448ca1d1ca000122'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>What interests me in Thomas&#39; version is the increasing position size as the portfolio grows. </p>

<p>There is more power in there than meets the eye. In fact, I see it as the way to open up to higher alphas.</p>

<p>But first, some of the funny stuff. Say you reduce the stock universe to be treated. It will also reduce overall performance. Anyone could test this simply by replacing the 3,000 stock universe used in the strategy to 2,000, 1,000 or even lower. The impact will be to reduce performance. The reason is simple, one is taking out “potential” trade candidates and thereby reducing the center of mass of the selectable ones. One could increase the average daily volume value as selection criterion which would also reduce potential trade candidates with a direct impact on the bottom line. Try it, this is also done by changing only one number (0.5e6). If you reduce the number, you will get more illiquid stocks being able to pass through on momentum alone. Not so good, you also want an exit.</p>

<p>Once you have accepted that there is merit in this momentum concept, and that in the future, the strategy should behave somewhat the same as in its past, it could be used going forward. Naturally, after you would have corrected its weaknesses, and there are some.</p>

<p>Here are tests I&#39;ve made. </p>

<p>I generally use leverage. Some trading strategies don&#39;t support leverage very well, however, this one is quite suited for it. It will add a little bit more in drawdown, but nothing scary.</p>

<p>Change one number in the program from 1.0 to 1.5 to use at most 50% leverage. The test gave the following result:</p>

<h1>1  SMRS  50% Leverage</h1>

<p><a href="http://alphapowertrading.com/images/divers/Momentum_Rotation_System_by_Thomas_Chang_50pct_leverage.png">http://alphapowertrading.com/images/divers/Momentum_Rotation_System_by_Thomas_Chang_50pct_leverage.png</a></p>

<p>Pushing the leverage to 85% generated:</p>

<h1>2  SMRS  85% Leverage</h1>

<p><a href="http://alphapowertrading.com/images/divers/Momentum_Rotation_System_by_Thomas_Chang_85pct_leverage.png">http://alphapowertrading.com/images/divers/Momentum_Rotation_System_by_Thomas_Chang_85pct_leverage.png</a></p>

<p>From the above charts, putting leverage at 1.50 produced: 4,289.4%; while at 1.85 generated: 6,491.9%. Their respective drawdowns were: 28,39% vs 31.6%. This meant putting $3,200 more at risk, or 3.2% more, which I find more than acceptable.</p>

<p>Another test that was done was a walk forward. </p>

<p>All presenters stopped the strategy on 2015-11-30, just as the two tests above using leverage. Doing a walk forward would add 9 months of unseen data to that program. It is a perfect way to show if the trading strategy would have behaved the same going forward as it did in the past. The test was easy to make, change the test&#39;s end date. Here are the results:</p>

<h1>3  SMRS  85% Leverage + 9 months walk forward</h1>

<p><a href="http://alphapowertrading.com/images/divers/Momentum_Rotation_System_by_Thomas_Chang_85pct_leverage_wf_9m.png">http://alphapowertrading.com/images/divers/Momentum_Rotation_System_by_Thomas_Chang_85pct_leverage_wf_9m.png</a></p>

<p>What can be seen is that most metrics improved: alpha, beta, Sharpe, Sortino and the information ratio. The volatility and the max drawdown remained the same. So, we can&#39;t say that the risk increased, but the overall return surely did. </p>

<p>Overall, that is about a 23.7% CAGR and that is a pretty good number to have.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57adaf20a01be6e1a00002a3' id='57adaf20a01be6e1a00002a3'>
<a href='#57adaf20a01be6e1a00002a3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57a5bd96b66991fb370006d4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/171f68ec61b79a956be64f4644b0332e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57a5bd96b66991fb370006d4'>Dan Temkin</a>
</div>
<a UTCms='1471000360000' class='quanto-date posted-at response-posted-at' href='#57adaf20a01be6e1a00002a3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I could be wrong but when calculating the out put of each momentum factor shouldnt it be 
<code>close[-2]/close[-1]</code> just because otherwise it is considering information at time 0 that hasn&#39;t happened yet.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57adc509eab1831f0b00000e' id='57adc509eab1831f0b00000e'>
<a href='#57adc509eab1831f0b00000e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1471005968000' class='quanto-date posted-at response-posted-at' href='#57adc509eab1831f0b00000e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Dan, most interesting. Can anyone clarify Dan&#39;s observation? And what would be the modification to the code since Close[0] appears more than once.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57adcb30086b884f4500005f' id='57adcb30086b884f4500005f'>
<a href='#57adcb30086b884f4500005f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57a5bd96b66991fb370006d4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/171f68ec61b79a956be64f4644b0332e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57a5bd96b66991fb370006d4'>Dan Temkin</a>
</div>
<a UTCms='1471007542000' class='quanto-date posted-at response-posted-at' href='#57adcb30086b884f4500005f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Guy,</p>

<p>Since I am the first one to see your post I guess I will clarify what I can. My certainty before is only from a lack of knowing the inner workings of Quantopian  ie how they treat their data index and while it can be dangerous to lag a variable that is already lagged especially with one like this that reweights on a periodic basis given changing factor values but for 90 percent of the strategies I have seen on here it would not matter much.</p>

<p>In actuality, if you were to employ this strategy using real funds and an ETP  chances are your algorithm would take longer than a minute to run so lagging a period  or even two to be safe, is probably not a bad practice in general.</p>

<p>But as I said it all depends on how they handle their data index and that is the part I really don&#39;t know. I guess the question I have is, when an order is executed is it done so with the price at close[0] or c lose[1]?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57add0b1435e2a675300009b' id='57add0b1435e2a675300009b'>
<a href='#57add0b1435e2a675300009b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1471008958000' class='quanto-date posted-at response-posted-at' href='#57add0b1435e2a675300009b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Dan, yes. What you raised has a major impact. I too am not familiar enough with Q&#39;s series indexing. Just getting back after 3 years of non-use. </p>

<p>Under no circumstances should a trading strategy look at anything that is in its future. All it should be allowed to do is make any kind of projection it wants, but never use what would be actual future unknown data in its calculations.</p>

<p>Someone needs to answer the your question.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57add600c6133d588b000148' id='57add600c6133d588b000148'>
<a href='#57add600c6133d588b000148'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/562545816f0077be2a000054'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/65eed7bd690af7911cb4e82f70d3a8f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/562545816f0077be2a000054'>Shawn Emhe II</a>
</div>
<a UTCms='1471010317000' class='quanto-date posted-at response-posted-at' href='#57add600c6133d588b000148'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The backtesting environment does not allow access to future data. Depending on the context the most recent close refers to either the current price or the close of the previous day (the previous day would be within pipeline, which runs before the market open).</p>

<p>You&#39;re also confusing the indexing in python with the indexes used in many other trading environments. Close[0] refers to the oldest price stored in the series. Close[-1] refers to the last price. Positive numbers index from the beginning and negative numbers work their way back.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57aec980cabdfbcc66000371' id='57aec980cabdfbcc66000371'>
<a href='#57aec980cabdfbcc66000371'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5757428b3a01689869000509'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/38bce77544d2dc2118aad8bbdac8587b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5757428b3a01689869000509'>Allan Rasmussen</a>
</div>
<a UTCms='1471072652000' class='quanto-date posted-at response-posted-at' href='#57aec980cabdfbcc66000371'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>How can i modify the last version added by Thomas Chang to show what stocks are bought and sold each month? Thanks  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57af6f0ca16c19bd12000115' id='57af6f0ca16c19bd12000115'>
<a href='#57af6f0ca16c19bd12000115'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1471115035000' class='quanto-date posted-at response-posted-at' href='#57af6f0ca16c19bd12000115'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Shawn, thanks for the explanation.</p>

<p>The original program is aiming for a 25% profit target on its trades. Now, if you reduce this target, the impact will be to also reduced profitability. But what about increasing it?</p>

<p>You are with a trading strategy that is amplifying its trading volume as you progress in time. Reducing its profit target should allow for more trades to be closed, returning cash into the account that could then be reused down the line since you are still trying to leverage up to 1.85 of equity. Nevertheless, you make less because you are also curtailing the program&#39;s ability to increase volume by providing it less ongoing equity, therefore reducing the general volume of trades as the program evolves. Not by much, but enough to significantly reduce its potential. In a way, you&#39;ve reducing trade volatility excursions, reaching earlier stopping times.  </p>

<h1>4  SMRS  85% Leverage : 20% profit target (was 25%)</h1>

<p><a href="http://alphapowertrading.com/images/divers/Momentum_Rotation_System_by_Thomas_Chang_85pct_leverage_wf_9m_20pctp.png">http://alphapowertrading.com/images/divers/Momentum_Rotation_System_by_Thomas_Chang_85pct_leverage_wf_9m_20pctp.png</a></p>

<p>When you look at the metrics, the 20% profit target compared to the original 25% produced about $1.2M less for what amounts to about the same level of risk: look at the volatility and max drawdown numbers. So, the idea of hoping that reducing the profit target might put more money back into the account earlier also reduced the strategy&#39;s future buying power resulting in an overall less desirable scenario.</p>

<p>Based on the above, requesting more profits by pushing the profit target higher, one should expect this to result in higher overall profitability. But, not necessarily so. That too is easy to test, just change a few numbers since they do control the strategy&#39;s general behavior.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57afcb90d3995973680003f8' id='57afcb90d3995973680003f8'>
<a href='#57afcb90d3995973680003f8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1471138712000' class='quanto-date posted-at response-posted-at' href='#57afcb90d3995973680003f8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;ve read that some think this trading strategy is almost worthless. Even the original author thinks so. Now, that is not a high five recommendation. But...</p>

<p>It should be noted that Thomas&#39; addition to the code changed the underlying trade mechanics. I&#39;ve studied this phenomenon a lot over the years, and have been using it in my programs as well (not Q). Sure, you will probably be taking incremental risk, which often will turn out to be about almost the same as everyone else, but you could also generate higher alpha, be more profitable. </p>

<p>The reason would be simple as well: you would be reinvesting more of the generated profits. Providing a positive feedback to your trading strategy. I have applied this to stocks as I think it is one of the places where such procedures can prevail. I have not tested other environments, and don&#39;t intend to do so in the near future. So, view all I say as being related to US stocks only.  </p>

<p>We have Kelly numbers, fix-fraction, optimal-f, and a lot of other portfolio weighting schemes. I see this one more like expectation opportunity weighting. You are allocating your equity to the highest ranking slopes (highest upward momentum) of a group of stocks on the premise that their relative trends will continue up in the near future. </p>

<p>The trade selection process should work in the future as it did in the past. You will always be able to rank stuff, past data, it is part of the information available to activate your decision surrogates.</p>

<p>If the premise is valid, a backtest of a sufficiently long duration should reveal this. And, I think, that is what Thomas&#39; modifications show: higher profits. One can fiddle with the other parameters controlling this strategy, but I would find it more appropriate at this time to tackle some of its deficiencies and undesirable traits. </p>

<p>For me, even as it is, that strategy has merit. </p>

<p>The strategy is nonetheless partially shooting itself in the foot which tends to curtail its potential. Here are some other tests I&#39;ve done. </p>

<p>Raising the profit target from 25% to 80%, and then 150%: </p>

<h1>5  SMRS  85% Leverage : 80% profit target (was 25%)</h1>

<p><a href="http://alphapowertrading.com/images/divers/Momentum_Rotation_System_by_Thomas_Chang_85pct_leverage_wf_9m_80pctp.png">http://alphapowertrading.com/images/divers/Momentum_Rotation_System_by_Thomas_Chang_85pct_leverage_wf_9m_80pctp.png</a></p>

<h1>6  SMRS  85% Leverage : 150% profit target (was 25%)</h1>

<p><a href="http://alphapowertrading.com/images/divers/Momentum_Rotation_System_by_Thomas_Chang_85pct_leverage_wf_9m_150pctp.png">http://alphapowertrading.com/images/divers/Momentum_Rotation_System_by_Thomas_Chang_85pct_leverage_wf_9m_150pctp.png</a></p>

<p>The scenario didn&#39;t change much, but still, as the profit target increased, this trading strategy starts to slow down. The slowdown is distributed over the entire time series.</p>

<p>On the other hand, increasing relative weights, does have an impact:</p>

<h1>7  SMRS  85% Leverage : 150% profit target : increase relative weights</h1>

<p><a href="http://alphapowertrading.com/images/divers/Momentum_Rotation_System_by_Thomas_Chang_85pct_leverage_wf_9m_185pctp_SL75_49k.png">http://alphapowertrading.com/images/divers/Momentum_Rotation_System_by_Thomas_Chang_85pct_leverage_wf_9m_185pctp_SL75_49k.png</a></p>

<p>For all these charts, you don&#39;t see a major increase in volatility or drawdown. Anyone could bear a 2 to 3% additional points in drawdown for the added reward. Chart #7 says that you get $8.3M on a $100k stake over a 13.6 year period, just by changing the parameters, not the code. Bottom line, it is a 38% CAGR over the period.</p>

<p>This is still Thomas&#39; trading logic at play. All I&#39;ve changed are underlying assumptions, some of the numbers controlling the strategy. None of the code was changed. Not a single line of code was added. So, I&#39;m not of the opinion the strategy is worthless, one just needs to look at it differently and really see what Thomas&#39; addition does.</p>

<p>The program does have weaknesses that should be addressed. It would make it a much better program. I&#39;m not familiar enough with Q at this time to make those changes. But that will change.</p>

<p>One of the weaknesses is that the program is hardly scalable in its present state. For instance, giving it $1M in capital resulted in:</p>

<h1>8  SMRS  85% Leverage : 125% profit target</h1>

<p><a href="http://alphapowertrading.com/images/divers/MRSystem_Thomas_Chang_85pct_leverage_wf_9m_125pctp_SL75_55k_1M.png">http://alphapowertrading.com/images/divers/MRSystem_Thomas_Chang_85pct_leverage_wf_9m_125pctp_SL75_55k_1M.png</a></p>

<p>You still beat the index, but, one could do better... Just doing 10 #7 would already provide 4 times more performance than #8 with the same initial capital, with little more effort, since a machine would be doing the job.</p>

<p>Of note, such a trading method can not know in advance what stocks will be treated, that it be past or future. But it can always sort its past.</p>

<p>A better mix. The same variables, but pushing each in the right direction. </p>

<h1>9  SMRS  85% Leverage : 125% profit target : faster response : $100k</h1>

<p><a href="http://alphapowertrading.com/images/divers/MRSystem_Thomas_Chang_85pct_leverage_wf_9m_125pctp_SL75_100k_sp60_15.png">http://alphapowertrading.com/images/divers/MRSystem_Thomas_Chang_85pct_leverage_wf_9m_125pctp_SL75_100k_sp60_15.png</a></p>

<p>Hope it&#39;s helpful.</p>

<p>Just to push it a little bit more... </p>

<h1>10  SMRS  85% Leverage : 125% profit target : faster response : $100k + residual</h1>

<p><a href="http://alphapowertrading.com/images/divers/MRSystem_Thomas_Chang_85pct_leverage_wf_9m_125pctp_SL75_100k_sp60_15_resid.png">http://alphapowertrading.com/images/divers/MRSystem_Thomas_Chang_85pct_leverage_wf_9m_125pctp_SL75_100k_sp60_15_resid.png</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57aff5e82a8eda292b00064c' id='57aff5e82a8eda292b00064c'>
<a href='#57aff5e82a8eda292b00064c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57927e3d265338dc0c000737'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8fa9594c1964e61f39d542a926c83ebe?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57927e3d265338dc0c000737'>Adam</a>
</div>
<a UTCms='1471149548000' class='quanto-date posted-at response-posted-at' href='#57aff5e82a8eda292b00064c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Guy, you can share the underlying code &amp; the backtest results natively, by using the Attach button on the top-right hand side of the commenting box. (<a href="https://www.dropbox.com/s/l8sr0tlxnzjfi17/Screenshot%202016-08-13%2022.38.10.png?dl=0">Screenshot</a>)</p>

<p>That way, we can see exactly which parts of the code you modify in each backtest. It makes it easier to follow along in your thought processes.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57b07d84a16c19bd12000a37' id='57b07d84a16c19bd12000a37'>
<a href='#57b07d84a16c19bd12000a37'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1471184266000' class='quanto-date posted-at response-posted-at' href='#57b07d84a16c19bd12000a37'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Adam, most of what you request is already there. Clone the last version done by Thomas Chang. I haven&#39;t changed a single line of code. </p>

<p>As for the parameter changes, they are given in the posts, except for a few that I would like to keep private at the moment. The script is getting more and more valuable, except, naturally, if the results presented are too low, or are just common place on Q.</p>

<p>Following Thomas&#39; suggestion, and he is right, e_r was set to zero since it does not bring anything to improve performance. Leverage was set to 1.85 since I don&#39;t mind using leveraged as long as it can be worthwhile. It was set to 1.85 to keep a safety margin since at times it is slightly exceeded. I also requested a higher profit_target. Experiment with these. You will need to understand the “why” it was done that way, not just as here are the mods. You need to have confidence in your trading strategy, otherwise it will never be applied. </p>

<p>Note that even the original author of the script, Anthony, thinks that his trading script has little value due to timing rebalancing issues. I think his concerns can be addressed too.</p>

<p>I work from the payoff matrix of a given strategy: Σ(H.*ΔP), so I look for ways in increase the average ΔP, increase the number of shares in inventory H, and increase the number of columns (read stocks) in the matrices. The edge will come from an increase in average ΔP, an increase in the inventory function H(1+at), and an attempt to increase not only m but n as well in this m x n matrix: H.*ΔP.</p>

<p>I do have a “novice” question: how do I remove a stock from being tradable. For instance, I got the following error messages when running my latest modifications:</p>

<h1>12  PYPL error message:</h1>

<p><a href="http://alphapowertrading.com/images/divers/MRSystem_Thomas_Chang_85pct_leverage_wf_9m_125pctp_SL75_100k_sp60_15_resid_plus_err.png">http://alphapowertrading.com/images/divers/MRSystem_Thomas_Chang_85pct_leverage_wf_9m_125pctp_SL75_100k_sp60_15_resid_plus_err.png</a></p>

<h1>13 GOOG error message:</h1>

<p><a href="http://alphapowertrading.com/images/divers/MRSystem_Thomas_85pct_lev_wf_9m_125pctp_SL75_100k_sp60_15_resid_plus_gool_key_err.png">http://alphapowertrading.com/images/divers/MRSystem_Thomas_85pct_lev_wf_9m_125pctp_SL75_100k_sp60_15_resid_plus_gool_key_err.png</a></p>

<p>My solution, for the moment, is simply to not have them in the tradable list. Since, I would like each strategy to go to completion. Here is where the strategies crashed:</p>

<h1>14  SMRS  85% Leverage : 125% profit target : faster response : $100k + residual+plus</h1>

<p><a href="http://alphapowertrading.com/images/divers/MRSystem_Thomas_Chang_85pct_leverage_wf_9m_125pctp_SL75_100k_sp60_15_resid_plus.png">http://alphapowertrading.com/images/divers/MRSystem_Thomas_Chang_85pct_leverage_wf_9m_125pctp_SL75_100k_sp60_15_resid_plus.png</a></p>

<h1>15 SMRS  85% Leverage : 125% profit target : faster response : $100k + residual+plus+</h1>

<p><a href="http://alphapowertrading.com/images/divers/MRSystem_Thomas_85pct_lev_wf_9m_125pctp_SL75_100k_sp60_15_resid_plus_gool_err.png">http://alphapowertrading.com/images/divers/MRSystem_Thomas_85pct_lev_wf_9m_125pctp_SL75_100k_sp60_15_resid_plus_gool_err.png</a></p>

<p>I would like #15 to go to completion, since what is in store is an even higher performance level. Where it was interrupted is not the strategy&#39;s fault. Still, it would represent a 63% CAGR over the entire 13.6 years duration of the test.</p>

<p>I&#39;m still in the process of studying what is under the hood. I am of the opinion that there is more than just something there. This thing can outperform.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57b0ab62afedb0103c000c1c' id='57b0ab62afedb0103c000c1c'>
<a href='#57b0ab62afedb0103c000c1c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1471196008000' class='quanto-date posted-at response-posted-at' href='#57b0ab62afedb0103c000c1c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Anthony, the solution you seek is already there. </p>

<p>That is what Thomas&#39; modifications are all about. His version of your program enables the increase in the number of stocks to be traded as equity increases. This in turn increases the trading activity which in turn increases profits which in turn enables buying more and more shares of more and more stocks. And, if you remember, it is also all you see in my own trading strategies. It is why I find it easy to detect this king of thing in somebody else&#39;s program.</p>

<p>What Thomas presented was a solution to your original question. What I see in it is kind of a bit more as chart #15 could attest, if it could be completed.</p>

<p>As mentioned before, that strategy is not that scalable in its current design, in the sense that if you put in more capital it will produce more. A 10 times increase in initial capital does not translate into 10 times more in generated profits as it should (see a previous post which makes that point). And this even when the number of stocks increases over time as it does presently. Scalability is reachable, but should be reached by other means.</p>

<p>You might be interested to know that your monthly rebalancing is very expensive and often times not even necessary. But I will have to look closer to see how expensive it is, all I see for now is that it is very expensive. There might be some other benefit to it... I can say that in chart #15 there is a tremendous amount of trading going on. How else could it reach those levels?</p>

<p>Hope it can help.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57b0f63886fa6cb03c000276' id='57b0f63886fa6cb03c000276'>
<a href='#57b0f63886fa6cb03c000276'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1471215165000' class='quanto-date posted-at response-posted-at' href='#57b0f63886fa6cb03c000276'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anthony, you think that the market is going to go down, to be of consequence, and I would say at a minimum, there would be no reason to buy or hold any long positions, even for a machine. And having designed a long only machine, you might not have designed the right one for the job, considering your views. I guess you would be mostly in cash equivalents all the time in continual fear of a market crash that would always be coming.</p>

<p>The asset switcheroo thingy you designed was to protect you from such catastrophic declines. You technically went to bearing interest instead of seeing your whole stock inventory decline in price (be it 10, 50, or 100 stocks). That&#39;s okay. You went as far as repeatedly paying in and out commissions, slippage, and opportunity costs as an insurance policy against those losses without any demonstration that that was the thing to do. </p>

<p>You are hedging you could be wrong being long, so you delegate a decision that you can not take by yourself to a moving average crossover system. To me, that&#39;s not good. When ever I see a system like take, I don&#39;t even give it a second look, which was my assessment when I first looked at your code. There was simply nothing there and unfortunately your simulation showed that too. The only salvage value I saw was as a coding example to refamiliarize myself with Q. I cloned again your initial program this afternoon, redid a simulation and got a 4.45% CAGR. All I could say was: it is positive...</p>

<p>It is only with the modification brought on by Peter, and especially Thomas, that the strategy gained some value. But I don&#39;t think Peter or Thomas saw what I saw in their code. Otherwise, they might have displayed the same kind of charts I did.</p>

<p>You start with 10 stocks just because you really can&#39;t afford to play more. Do the math. $100k to start with, 50 stocks that&#39;s $2k allocated per trade. Now, estimate the number of shares per trade. So, your point seems trivial. You want to trade more stocks, increase your initial capital, or let your system grow the cash. Thomas&#39; solution is a better choice. It is such a better solution that I could take his version and push its performance to what I consider high CAGR levels. You have several charts that show that. </p>

<p>Whereas, I could not do that with your code, especially starting with 100 stocks. Try it, you only need to change one number in your code. That&#39;s the difference. With Thomas&#39; code, the inventory could start with 10 stocks to eventually reach over 900 stocks traded in a single day on the condition that there were sufficient funds. Your code did not allow this, and to reach the performance level showed in chart #15, it is almost required.</p>

<p>Note that at every sign of a possible decline, the strategy reverts almost to cash, that is its mission. So, why the fear a of depression? See how it behaved during the financial crisis. It went through it with flying colors. If at anytime you feel the market is going to collapse, the solution is simple: get out of the way. Your program will never feel that..., so you take charge.</p>

<p>When designing trading strategies, we should be consequent with what we are trying to do, and where it leads to. A long term simulation will show this, just as a simulation on your own program showed it was not enough, one needed more.</p>

<p>I showed several tests made using modified versions of your program. They were ran under the same conditions, the same software, the same cloud environment, the same data provider over the same trading interval. I did not change any of the functions, not a single line of code. But changing the default values has, I would say, totally changed it mission, it gained some long term vision.</p>

<p>Don&#39;t you see a methodology choosing its own compromise between risk and return? But, still wanting higher returns, considering that to gain a profit, one has to participate and take a position or multiple ones, and not hide underneath a blanket with the cash under the mattress.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57b10397dfbc7cd021000331' id='57b10397dfbc7cd021000331'>
<a href='#57b10397dfbc7cd021000331'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56b00aea4339666f650001cb'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5d8f88a1960d4cd79d20b17a2631df1e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56b00aea4339666f650001cb'>Peter Falter</a>
</div>
<a UTCms='1471218596000' class='quanto-date posted-at response-posted-at' href='#57b10397dfbc7cd021000331'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Guy,<br>
I added the feature of adjusting the number of assets based on portfolio size to combat liquidity problems that eventually get quite bad when the base strategy is effective.<br>
Glad you like it.</p>

<p>As for displaying charts, I&#39;m not sure I have tools to do this well and realize that I am just a quant dilletante.</p>

<p>If the backtests ever finish I&#39;ll post some results for weekly rebalancing and days_offset of 0, 1, 2, 3, and 4.<br>
I think I&#39;ll start a separate thread for that since the weekly strategy is much modified different from Anthony Garner&#39;s original.<br>
Also, my PC lags so badly when I load this thread that I have trouble scrolling or editing and my tablet can&#39;t load it at all.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57b108bfdfbc7c4923000392' id='57b108bfdfbc7c4923000392'>
<a href='#57b108bfdfbc7c4923000392'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1471219912000' class='quanto-date posted-at response-posted-at' href='#57b108bfdfbc7c4923000392'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Peter, sorry about that, my mistake. I mostly studied Thomas&#39; version, not tracing back its history. </p>

<p>Thanks a lot, it is a great feature. It enables one to be fully invested at all times if desired. Have the stock inventory fluctuate at will, go in liquidation or acquisition mode in no time. It indirectly becomes an equity controller since you can at most put all available funds to work.</p>

<p>Thanks again, much appreciated.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57b11a486ac2f3a785000424' id='57b11a486ac2f3a785000424'>
<a href='#57b11a486ac2f3a785000424'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5628c5b567e391cc810004b5'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/782769ba8fd76fc1db327ed36223a655?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5628c5b567e391cc810004b5'>Andrew Martin</a>
</div>
<a UTCms='1471224402000' class='quanto-date posted-at response-posted-at' href='#57b11a486ac2f3a785000424'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I ran this strategy through the new Alphalens tool.  It&#39;s currently set to look at 2003.  As expected by looking at everyone&#39;s back tests, the early years show high alpha in the 5th quintile... Not so much in recent years.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57b11dadca92cca97a0003ae' id='57b11dadca92cca97a0003ae'>
<a href='#57b11dadca92cca97a0003ae'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5628c5b567e391cc810004b5'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/782769ba8fd76fc1db327ed36223a655?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5628c5b567e391cc810004b5'>Andrew Martin</a>
</div>
<a UTCms='1471225267000' class='quanto-date posted-at response-posted-at' href='#57b11dadca92cca97a0003ae'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Peter - This thread lags like hell for me too.  I doubt it&#39;s my computer, or yours.  Large threads like this would benefit from being parsed into pages and not having all the content on one URL.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57b1a7c986fa6cf3fb000109' id='57b1a7c986fa6cf3fb000109'>
<a href='#57b1a7c986fa6cf3fb000109'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56b00aea4339666f650001cb'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5d8f88a1960d4cd79d20b17a2631df1e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56b00aea4339666f650001cb'>Peter Falter</a>
</div>
<a UTCms='1471260626000' class='quanto-date posted-at response-posted-at' href='#57b1a7c986fa6cf3fb000109'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Andrew, thanks for posting the Alphalens output. I need to read about that tool before commenting on the result.</p>

<p>The weekly rebalancing thread is <a href="https://www.quantopian.com/posts/a-weekly-view-of-a-simple-momentum-rotation-system-for-stocks">here</a></p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5815a7cddffab8cf55000537' id='5815a7cddffab8cf55000537'>
<a href='#5815a7cddffab8cf55000537'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5811645899c929438500061e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2977e79da38425970f21aa038e1223cb?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5811645899c929438500061e'>Volker Knapp</a>
</div>
<a UTCms='1477814232000' class='quanto-date posted-at response-posted-at' href='#5815a7cddffab8cf55000537'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ok, can some kind soul tell me the logic of this strategy. It seems &quot;to good to be true&quot;. And that is usually the time when I get curious. Reading Python is a PITA. I would like to reproduce the code in Wealth-Lab and test it with real data.<br>
Any help is much appreciated. Thanks.<br>
VK  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58165fd3bd9a3f9ee7000031' id='58165fd3bd9a3f9ee7000031'>
<a href='#58165fd3bd9a3f9ee7000031'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1477861342000' class='quanto-date posted-at response-posted-at' href='#58165fd3bd9a3f9ee7000031'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Volker, nice to see you here. Having used Wealth-Lab since 2004, may I offer to bridge the gap. </p>

<p>But first, I suggest, like Peter, to switch to the weekly view of this strategy, as it loads a lot faster than this thread. And, it provides added information that could help answer your question.</p>

<p><a href="https://www.quantopian.com/posts/a-weekly-view-of-a-simple-momentum-rotation-system-for-stocks">https://www.quantopian.com/posts/a-weekly-view-of-a-simple-momentum-rotation-system-for-stocks</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58166807d1972957610000a5' id='58166807d1972957610000a5'>
<a href='#58166807d1972957610000a5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5811645899c929438500061e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2977e79da38425970f21aa038e1223cb?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5811645899c929438500061e'>Volker Knapp</a>
</div>
<a UTCms='1477863438000' class='quanto-date posted-at response-posted-at' href='#58166807d1972957610000a5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks. I will ask the other 10 questions there then. You might be able to help coding it, if you haven&#39;t don&#39;t it already. Hardly anyone programs better in Wealth-Lab than you. ;)  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/a-simple-momentum-rotation-system-for-stocks'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/a-simple-momentum-rotation-system-for-stocks'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#583e3d3d3c3a393b3318292d39362c3728313936763b3735">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

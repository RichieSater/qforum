<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
Momentum, Value, and a little bit of mean reverting
</title>
<meta content='Hi everyone, I think it would be nice to share and maybe improve together this idea. My goal is make a portfolio rebalanced monthly that I can trade with real money. I have tried for quite some time to make momentum strategy but they all have serious problems in some years even if timed with moving averages.  So my idea is this: Identify with phase the market is by counting sectors that trade above the 240 moving average, and allocate more money to equity by trading these sectors. For example...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="ytBt1zJIyHU4J97ws8cqAKOdEuySPNfP23OEB4aamqe2thuakL4aloE6h8H8KIJ0mxMxhejwwtRZfF9tLN/4HA==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/momentum-value-and-a-little-bit-of-mean-reverting' property='og:url'>
<meta content='Momentum, Value, and a little bit of mean reverting' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/momentum-value-and-a-little-bit-of-mean-reverting' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='Momentum, Value, and a little bit of mean reverting' property='og:title'>
<meta content='Hi everyone, I think it would be nice to share and maybe improve together this idea. My goal is make a portfolio rebalanced monthly that I can trade with real money. I have tried for quite some time to make momentum strategy but they all have serious problems in some years even if timed with moving averages.  So my idea is this: Identify with phase the market is by counting sectors that trade above the 240 moving average, and allocate more money to equity by trading these sectors. For example...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/momentum-value-and-a-little-bit-of-mean-reverting">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='5db3fbad609e6a003d1699f1'>
<div class='post-container' data-post-id='5db3fbad609e6a003d1699f1' id='5db3fbad609e6a003d1699f1'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>Momentum, Value, and a little bit of mean reverting</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5673f0630a6bfa534b00000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/147dbb7c6d5789fd351a368486558c2a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5673f0630a6bfa534b00000d'>Giuseppe Moriconi</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1572076461000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=Momentum, Value, and a little bit of mean reverting&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fmomentum-value-and-a-little-bit-of-mean-reverting%3Futm_source%3Dwebsite_share%26utm_campaign%3Dmomentum-value-and-a-little-bit-of-mean-reverting%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fmomentum-value-and-a-little-bit-of-mean-reverting%3Futm_source%3Dwebsite_share%26utm_campaign%3Dmomentum-value-and-a-little-bit-of-mean-reverting%26utm_medium%3Dlinkedin&amp;title=Momentum%2C+Value%2C+and+a+little+bit+of+mean+reverting+%28Giuseppe+Moriconi%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class='tags tag-row'>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Momentum' data-tag-id='55c50e7d8d4710ec6e00000c' href='/posts/tag/Momentum/newest'>Momentum</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Mean Reversion' data-tag-id='55c50e7d8d4710ec6e00000d' href='/posts/tag/Mean-Reversion/newest'>Mean Reversion</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Value' data-tag-id='55d33f023f6ba10065000000' href='/posts/tag/Value/newest'>Value</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Asset Allocation' data-tag-id='55d33f4f3f6ba10061000001' href='/posts/tag/Asset-Allocation/newest'>Asset Allocation</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Fundamentals' data-tag-id='5bbf6123cb181d749727e7fc' href='/posts/tag/Fundamentals/newest'>Fundamentals</a>
</div>
<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/momentum-value-and-a-little-bit-of-mean-reverting?utm_source=website_share&amp;utm_campaign=momentum-value-and-a-little-bit-of-mean-reverting&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Giuseppe Moriconi" />
<div class='body-text'>
<div class='body-text-container post-body'><p>Hi everyone, I think it would be nice to share and maybe improve together this idea.<br>
My goal is make a portfolio rebalanced monthly that I can trade with real money.<br>
I have tried for quite some time to make momentum strategy but they all have serious problems in some years even if timed with moving averages. </p>

<p>So my idea is this:<br>
Identify with phase the market is by counting sectors that trade above the 240 moving average, and allocate more money to equity by trading these sectors.<br>
For example if uptrending sectors are more than 8  i say that market stregth is high so i allocate a lot in equity and i buy sectors, BUT not all of them , just the 2 worst performing in the short period, so to have a kind of long term momentum and short term mean reverting.<br>
If there are less than 5 sectors up trending it means that the market is not strong so I buy the 2 best performing in the short term, because it’s like they are ‘leading the market in times of uncertainty.<br>
And so on, going to a phase where no sectors are uptrending so all money are on bonds<br>
Actually Money that are not allocated in equity are always allocated in bonds.<br>
Then once I have the sectors that I want to trade (long term trending and short term counter trending most of the time) I select for each of them the best stocks based on piotroski score and volatility.</p>

<p>I had to use single stocks instead of entire sectors because in Italy a retail investor cannot have access to all major ETFs like SPY or XLP, XLU etc.. and the alternatives are expansive and illiquid.</p>

<p>My goals are basically to stay under 20% drawdown, be approximately at 1 for Sharpe ratio,  beat the SPY for performance , don’t fall down completely in 2008, 2015 and 2017/18 and I do not really care about alpha and beta as long as the strategy criteria makes sense in my head.</p>

<p>Another thing is that backtesting this code is very slow compared to other backtest I have done and I cannot figure out why.  </p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>41 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='5db4726a609e6a265316988b' id='5db4726a609e6a265316988b'>
<a href='#5db4726a609e6a265316988b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5a4ae56a28d3c60010e1f6c2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a19b015e43b318b1c735847ab21e7120?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5a4ae56a28d3c60010e1f6c2'>frank giardina</a>
</div>
<a UTCms='1572106858000' class='quanto-date posted-at response-posted-at' href='#5db4726a609e6a265316988b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Just a thought instead of using the   rolling mean logic could you  put the simple20MA and simple240MA into the pipeline.  Not sure if it would speed things up but i would look at that logic for slow down  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5db5857721b6fa661f693f27' id='5db5857721b6fa661f693f27'>
<a href='#5db5857721b6fa661f693f27'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5673f0630a6bfa534b00000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/147dbb7c6d5789fd351a368486558c2a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5673f0630a6bfa534b00000d'>Giuseppe Moriconi</a>
</div>
<a UTCms='1572177271000' class='quanto-date posted-at response-posted-at' href='#5db5857721b6fa661f693f27'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>i don&#39;t know, in the original idea MAVGs are used to select sectors and obtain the market strength based on the number of uptrending sectors, and only then i use this selection to do she stock picking into the pipeline.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5db8d3060a59e7004a16b745' id='5db8d3060a59e7004a16b745'>
<a href='#5db8d3060a59e7004a16b745'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5a4ae56a28d3c60010e1f6c2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a19b015e43b318b1c735847ab21e7120?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5a4ae56a28d3c60010e1f6c2'>frank giardina</a>
</div>
<a UTCms='1572393734000' class='quanto-date posted-at response-posted-at' href='#5db8d3060a59e7004a16b745'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Guiseppe</p>

<p>Instead of equal weight for your total_rank i weighted the score giving more weight to the returns<br>
 group[&#39;total_rank&#39;] = (group[&#39;ranked_vol&#39;] * .2) + (group[&#39;ranked_returns&#39;] * .5) + (group[&#39;ranked_pio&#39;] * .3)</p>

<p>i used a small time frame 01/01/2017 - 10/28/2019 only because it is taking so long to run needs more testing but  and results improved</p>

<p>unweighted   01/01/2017-10/28/19   ret: 57.42   alpha .11     beta   .41    sharp  1.46   draw   -9.44<br>
weighted        01/01/2017-10/28/19   ret:79.98    alpha.16      beta   .46    sharp  1.56   draw   -11.12  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5db93eaa0a59e721b216b9c9' id='5db93eaa0a59e721b216b9c9'>
<a href='#5db93eaa0a59e721b216b9c9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5673f0630a6bfa534b00000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/147dbb7c6d5789fd351a368486558c2a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5673f0630a6bfa534b00000d'>Giuseppe Moriconi</a>
</div>
<a UTCms='1572421290000' class='quanto-date posted-at response-posted-at' href='#5db93eaa0a59e721b216b9c9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>thank you Frank, happy to see some feedback.<br>
the fact that weights are hard coded worries me because there are years where the market insist on best performing stocks and other years where it does not, but your idea of calibrating the weights makes absolutely sense.</p>

<p>I am still tying to uderstando this warning beacuse maybe it&#39;s the reason why backtest is so slow:<br>
&#39;A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead&#39;  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dbf2b801f7b5f004033a500' id='5dbf2b801f7b5f004033a500'>
<a href='#5dbf2b801f7b5f004033a500'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58716609d4f07d72e0ba8fb9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/12f15b55bf11be19915c9c0dd073850c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58716609d4f07d72e0ba8fb9'>ak</a>
</div>
<a UTCms='1572809600000' class='quanto-date posted-at response-posted-at' href='#5dbf2b801f7b5f004033a500'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>interesting strategy, were you able to see why the backtest is slow?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dbfe45894526c0043c9553c' id='5dbfe45894526c0043c9553c'>
<a href='#5dbfe45894526c0043c9553c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1572856920000' class='quanto-date posted-at response-posted-at' href='#5dbfe45894526c0043c9553c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Giuseppe,</p>

<p>This algo is one of the old-fashioned gems on Quantopian forum.<br>
To run it faster I just move, what you are doing in  <em>before_trading_start()</em>, to <em>rebalance()</em>.<br>
I also change leverage to 1.0.<br>
Thank you for sharing.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dc053c894526c55f7c95209' id='5dc053c894526c55f7c95209'>
<a href='#5dc053c894526c55f7c95209'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1572885448000' class='quanto-date posted-at response-posted-at' href='#5dc053c894526c55f7c95209'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The algo has a lot of space for improvement.<br>
In this backtest I have changed just one parameter: number of stocks in sector from 2 to 3.<br>
<a href="https://www.quantopian.com/users/51318528831378d42a0001ad" rel="nofollow">Guy Fleury</a> can send it to the sky.<br>
Here is backtest results.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dc0bd2ead8843004458f623' id='5dc0bd2ead8843004458f623'>
<a href='#5dc0bd2ead8843004458f623'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5a4ae56a28d3c60010e1f6c2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a19b015e43b318b1c735847ab21e7120?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5a4ae56a28d3c60010e1f6c2'>frank giardina</a>
</div>
<a UTCms='1572912430000' class='quanto-date posted-at response-posted-at' href='#5dc0bd2ead8843004458f623'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>You guys are far ahead of me. Vladmir would you mind (and Giuseppe doesn&#39;t mind either)  posting the new code with the before trading to rebalance. I made a few changes, very basic the weighting that as Giuseppe points out is not dynamic but could be based on market trend and I added one additional filter to only select issues where fcf_yield is &gt; zero. This seems to be a good filter. the results for a 500k portfolio granted only for a short period of time went to</p>

<p>fcf_yield_filter and  weighted 500k  start: 01/01/2017- end:10/31/2019  ret:86.51%  alpha: .17  beta:.43  sharpe: 1.74  draw: -9.32  </p>

<p>thanks for sharing  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dc0e166fd9bff1c50a5df2f' id='5dc0e166fd9bff1c50a5df2f'>
<a href='#5dc0e166fd9bff1c50a5df2f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1572921702000' class='quanto-date posted-at response-posted-at' href='#5dc0e166fd9bff1c50a5df2f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>frank,</p>

<p>For some reason, known only to Quantopian staff, I could not attach my backtests.<br>
Here is  my code.</p>

<pre><code># Momentum, Value, and a little bit of mean reverting by Giuseppe Moriconi, modified by Vladimir  
# https://www.quantopian.com/posts/momentum-value-and-a-little-bit-of-mean-reverting  
from quantopian.pipeline.factors import SimpleMovingAverage, Returns  
from quantopian.algorithm import attach_pipeline, pipeline_output  
from quantopian.pipeline.classifiers.morningstar import Sector  
from quantopian.pipeline.data.builtin import USEquityPricing  
from quantopian.pipeline.filters import QTradableStocksUS  
from quantopian.pipeline.data import Fundamentals  
from quantopian.pipeline import CustomFactor  
from quantopian.pipeline import Pipeline  
import pandas as pd  
import numpy as np  
import math

def initialize(context):  
    context.equity_allocation = 0  
    context.hedge_allocation = 0  
    context.sectors_weigth = {}  
    context.market_trend = 0  
    context.sectors_to_buy = []  
    context.sectors_weight = {}  
    context.sectors_number_to_buy = []  
    context.sectors_dict = {  
                        symbol(&#39;XLB&#39;): 101,      # XLB Materials  
                        symbol(&#39;XLY&#39;): 102,      # XLY Consumer Cyclical  
                        # symbol(&#39;XLF&#39;): 103,    # XLF Financials  
                        symbol(&#39;XLP&#39;): 205,      # XLP Consumer Defensive  
                        symbol(&#39;XLV&#39;): 206,      # XLV Healthcare  
                        symbol(&#39;XLU&#39;): 207,      # XLU Utilities  
                        symbol(&#39;XLE&#39;): 309,      # XLE Energy  
                        symbol(&#39;XLI&#39;): 310,      # XLI Industrials  
                        symbol(&#39;XLK&#39;): 311,      # XLK Tech  
                        }  
    context.sectors_list = context.sectors_dict.keys()  
    context.bonds = [symbol(&#39;TLT&#39;),              # TLT  
                     symbol(&#39;TIP&#39;),              # TIP, IEF  
                     ]  
    schedule_function(rebalance, date_rules.month_start(), time_rules.market_open(hours=1),)  
    schedule_function(record_vars, date_rules.month_start(), time_rules.market_open(hours=1),)

    base_universe = QTradableStocksUS()  
    sector = Sector()                                            # sector code  
    ev_to_ebitda = Fundamentals.ev_to_ebitda.latest              # ev_ebitda  
    returns = Returns(window_length = 120, mask=base_universe)   # returns  
    volatility = Volatility_Daily_Annual()                       # std  
    market_cap = Fundamentals.market_cap.latest                  # market_cap  
    ev_screen = 0.0 &lt; ev_to_ebitda &lt; 10.0                        # fundamental_screen  
    # ev_screen = (0.0 &lt; ev_to_ebitda) &amp; (ev_to_ebitda &lt; 10.0)   # fundamental_screen  
    profit = ROA() + ROAChange() + CashFlow() + CashFlowFromOps()  
    leverage = LongTermDebtRatioChange() + CurrentDebtRatioChange() + SharesOutstandingChange()  
    operating = GrossMarginChange() + AssetsTurnoverChange()  
    piotroski = profit + leverage + operating  
    piotroski_screen = ((piotroski &gt;= 7) | (piotroski &lt;= 3))  
    market_cap_screen = market_cap &gt; 1e9  
    columns = {&#39;sector&#39;: sector, &#39;piotroski&#39;: piotroski, &#39;ret&#39;: returns, &#39;vol&#39; : volatility}  
    screen = (base_universe &amp; ev_screen &amp; piotroski_screen &amp; market_cap_screen)  
    pipe = Pipeline(columns, screen)  
    attach_pipeline(pipe, &#39;pipeline&#39;)

def rebalance(context, data):  
    stocks_to_buy = []  
    sectors_to_buy = []  
    sectors_number_to_buy = []  
    ########## ETF SELECTION #############  
    p = data.history(context.sectors_list, &#39;close&#39;, 252,&#39;1d&#39;)  
    mean_20= p.rolling(20).mean().iloc[-1]  
    mean_240 =  p.rolling(240).mean().iloc[-1]  
    ratio = mean_20/mean_240  
    uptrending_sectors = ratio.where(ratio &gt; 1.0).dropna()  
    last_month_performance = p.pct_change(periods= 30).iloc[-1]  
    #ascending = false significa in alto i maggiori valori  
    last_month_sorted = last_month_performance.sort_values(ascending = False)  
    last_month_sorted = last_month_sorted[last_month_sorted.index.isin(uptrending_sectors.index)]  
    uptrending_sectors_list = uptrending_sectors.index.tolist()  
    ######### EQUITY ALLOCATION BASED ON TREND ################  
    n = len(uptrending_sectors_list)  
    # -----------  MOST OF THE SECTORS ARE UPTRENDING ------------- #  
    if n &gt;= 8:  
        market_trend = 2  
        equity_allocation = 0.8  
        #peggiori rendimenti ultimo mese  
        sectors_to_buy = last_month_sorted[-2:].index.tolist() 

    # -----------  MORE THAN HALF OF THE SECTORS ARE UPTRENDING ------------- #  
    elif 5 &lt; n &lt;  8:  
        market_trend = 1  
        equity_allocation = 0.6  
        sectors_to_buy = last_month_sorted[-2:].index.tolist()  
    # -----------  LESS THAN HALF OF THE SECTORS ARE UPTRENDING ------------- #  
    elif 2 &lt; n &lt;= 5:  
        market_trend = 0  
        equity_allocation = 0.4  
        sectors_to_buy = last_month_sorted[:2].index.tolist()  
    # -----------  FEW OF THE SECTORS ARE UPTRENDING ------------- #  
    elif 1 &lt; n &lt;= 2:  
        market_trend = -1  
        equity_allocation = 0.2  
        sectors_to_buy = last_month_sorted.index.tolist()  
    # -----------  NO SECTOR UPTREND  ------------- #  
    elif n &lt;= 1:  
        market_trend = -2  
        equity_allocation = 0  
        sectors_to_buy = []  
    hedge_allocation = 1.0 - equity_allocation  
    for k, v in context.sectors_dict.iteritems():  
        if k in sectors_to_buy:  
            sectors_number_to_buy.append(v)  
    ########## PIPELINE FILTER BASED ON PREVIOUSLY SELECTED SECTORS #########  
    pipe = pipeline_output(&#39;pipeline&#39;)  
    grouped = pipe.groupby(&#39;sector&#39;)  
    for sector, group in grouped:  
        if sector in sectors_number_to_buy:  
            group[&#39;ranked_vol&#39;] = group[&#39;vol&#39;].rank(ascending = False) #low volatility  
            group[&#39;ranked_returns&#39;] = group[&#39;ret&#39;].rank(ascending = True) # high returns  
            group[&#39;ranked_pio&#39;] = group[&#39;piotroski&#39;].rank(ascending = True) #high piotroski score  
            group[&#39;total_rank&#39;] = group[&#39;ranked_vol&#39;] + group[&#39;ranked_returns&#39;] + group[&#39;ranked_pio&#39;]  
            stocks_to_buy_for_this_sector =group[&#39;total_rank&#39;].dropna().nlargest(3).index.tolist()  
            stocks_to_buy = stocks_to_buy + stocks_to_buy_for_this_sector  
    # Make global variables to plot lines etc  
    context.stocks_to_buy = stocks_to_buy  
    context.hedge_allocation = hedge_allocation  
    context.market_trend = market_trend  
    context.equity_allocation = equity_allocation  
    context.sectors_to_buy = sectors_to_buy  


    &#39;&#39;&#39;  
    print &#39;-------------REBALANCE-------------&#39;  
    print &#39;equity allocation %s&#39; %(context.equity_allocation)  
    print &#39;bonds allocation %s&#39; %(context.hedge_allocation)  
    print &#39;sectors to buy %s&#39; %( context.sectors_to_buy)  
    print &#39;portfolio positions %s&#39; %(context.portfolio.positions.keys())  
    print &#39;stocks to buy: %s&#39; %(context.stocks_to_buy)  
    &#39;&#39;&#39;  
    for bond in context.bonds:  
        order_target_percent(bond, context.hedge_allocation/len(context.bonds))

    for stock in context.portfolio.positions :  
        if stock not in context.stocks_to_buy and stock not in context.bonds:  
             order_target_percent(stock, 0)  
    for stock in context.stocks_to_buy :  
        if get_open_orders(stock): continue  
        else:  
           order_target_percent(stock, context.equity_allocation / len(context.stocks_to_buy))  
def record_vars(context, data):  
    record(leverage=context.account.leverage, trend = context.market_trend, equity_allocation = context.equity_allocation, n_sectors = len(context.sectors_to_buy))  

class Piotroski(CustomFactor):  
    inputs = [  
        Fundamentals.roa,  
        Fundamentals.operating_cash_flow,  
        Fundamentals.cash_flow_from_continuing_operating_activities,  
        Fundamentals.long_term_debt_equity_ratio,  
        Fundamentals.current_ratio,  
        Fundamentals.shares_outstanding,  
        Fundamentals.gross_margin,  
        Fundamentals.assets_turnover,  
    ]  
    window_length = 22  
    def compute(self, today, assets, out,  
                roa, cash_flow, cash_flow_from_ops,  
                long_term_debt_ratio, current_ratio, shares_outstanding,  
                gross_margin, assets_turnover):  
        profit = (  
            (roa[-1] &gt; 0).astype(int) +  
            (cash_flow[-1] &gt; 0).astype(int) +  
            (roa[-1] &gt; roa[0]).astype(int) +  
            (cash_flow_from_ops[-1] &gt; roa[-1]).astype(int)  
        )  
        leverage = (  
            (long_term_debt_ratio[-1] &lt; long_term_debt_ratio[0]).astype(int) +  
            (current_ratio[-1] &gt; current_ratio[0]).astype(int) +  
            (shares_outstanding[-1] &lt;= shares_outstanding[0]).astype(int)  
        )  
        operating = (  
            (gross_margin[-1] &gt; gross_margin[0]).astype(int) +  
            (assets_turnover[-1] &gt; assets_turnover[0]).astype(int)  
        )  
        out[:] = profit + leverage + operating  
class ROA(CustomFactor):  
    window_length = 1  
    inputs = [Fundamentals.roa]  
    def compute(self, today, assets, out, roa):  
        out[:] = (roa[-1] &gt; 0).astype(int)  
class ROAChange(CustomFactor):  
    window_length = 22  
    inputs = [Fundamentals.roa]  
    def compute(self, today, assets, out, roa):  
        out[:] = (roa[-1] &gt; roa[0]).astype(int)  
class CashFlow(CustomFactor):  
    window_length = 1  
    inputs = [Fundamentals.operating_cash_flow]  
    def compute(self, today, assets, out, cash_flow):  
        out[:] = (cash_flow[-1] &gt; 0).astype(int)  
class CashFlowFromOps(CustomFactor):  
    window_length = 1  
    inputs = [Fundamentals.cash_flow_from_continuing_operating_activities, Fundamentals.roa]  
    def compute(self, today, assets, out, cash_flow_from_ops, roa):  
        out[:] = (cash_flow_from_ops[-1] &gt; roa[-1]).astype(int)  
class LongTermDebtRatioChange(CustomFactor):  
    window_length = 22  
    inputs = [Fundamentals.long_term_debt_equity_ratio]  
    def compute(self, today, assets, out, long_term_debt_ratio):  
        out[:] = (long_term_debt_ratio[-1] &lt; long_term_debt_ratio[0]).astype(int)  
class CurrentDebtRatioChange(CustomFactor):  
    window_length = 22  
    inputs = [Fundamentals.current_ratio]  
    def compute(self, today, assets, out, current_ratio):  
        out[:] = (current_ratio[-1] &gt; current_ratio[0]).astype(int)  
class SharesOutstandingChange(CustomFactor):  
    window_length = 22  
    inputs = [Fundamentals.shares_outstanding]  
    def compute(self, today, assets, out, shares_outstanding):  
        out[:] = (shares_outstanding[-1] &lt;= shares_outstanding[0]).astype(int)  
class GrossMarginChange(CustomFactor):  
    window_length = 22  
    inputs = [Fundamentals.gross_margin]  
    def compute(self, today, assets, out, gross_margin):  
        out[:] = (gross_margin[-1] &gt; gross_margin[0]).astype(int)  
class AssetsTurnoverChange(CustomFactor):  
    window_length = 22  
    inputs = [Fundamentals.assets_turnover]  
    def compute(self, today, assets, out, assets_turnover):  
        out[:] = (assets_turnover[-1] &gt; assets_turnover[0]).astype(int)  
class Volatility_Daily_Annual(CustomFactor):  
    inputs = [USEquityPricing.close]  
    window_length = 120  
    def compute(self, today, assets, out, close):  
        # [0:-1] is needed to remove last close since diff is one element shorter  
        daily_returns = np.diff(close, axis = 0) / close[0:-1]  
        out[:] = daily_returns.std(axis = 0) * math.sqrt(252)  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dc14436fd9bff1331a5e031' id='5dc14436fd9bff1331a5e031'>
<a href='#5dc14436fd9bff1331a5e031'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5673f0630a6bfa534b00000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/147dbb7c6d5789fd351a368486558c2a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5673f0630a6bfa534b00000d'>Giuseppe Moriconi</a>
</div>
<a UTCms='1572946998000' class='quanto-date posted-at response-posted-at' href='#5dc14436fd9bff1331a5e031'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thank you Vladimir and Frank!<br>
Frank, the fcf_yield filter makes a lot of sense, i will add it for shure.</p>

<p>Vladimir, the method i used was to work with ETFs only and then, once the ETF part was tradable,  i added stocks with pipeline, so the parameters &#39;optimization&#39; was done with ETF only, however having not so many stocks in portfolio increases very much his volatility maybe just because one of these stocks moves a lot, and that is what happend yesterday for example   :(<br>
So what i am considering is to follow your suggestion to increase to 3 the number of sectors to have more &#39;fundamental diversification&#39; or to introduce a minimum variance optimization on the stocks in porfolio in order to allocate less money on more volatile stocks.<br>
Adding secotrs makes much more sense (in my head)  because after all volatility is kind of cyclical so less volatile portfolios  today can be more volatile afer 2 weeks, and also like every optimization is very dependent on the lenght of the lookback window.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dc1867ff47a8e11eb37f5f0' id='5dc1867ff47a8e11eb37f5f0'>
<a href='#5dc1867ff47a8e11eb37f5f0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5673f0630a6bfa534b00000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/147dbb7c6d5789fd351a368486558c2a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5673f0630a6bfa534b00000d'>Giuseppe Moriconi</a>
</div>
<a UTCms='1572963967000' class='quanto-date posted-at response-posted-at' href='#5dc1867ff47a8e11eb37f5f0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>This is an updated version with the fcf_yield filter , num sectors up to 3 (with acceptable testing speed)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dc19115ad88430d8058f7c9' id='5dc19115ad88430d8058f7c9'>
<a href='#5dc19115ad88430d8058f7c9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5a4ae56a28d3c60010e1f6c2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a19b015e43b318b1c735847ab21e7120?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5a4ae56a28d3c60010e1f6c2'>frank giardina</a>
</div>
<a UTCms='1572966677000' class='quanto-date posted-at response-posted-at' href='#5dc19115ad88430d8058f7c9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>looks good thanks for sharing  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dc1fddd979ced004a1ec2f9' id='5dc1fddd979ced004a1ec2f9'>
<a href='#5dc1fddd979ced004a1ec2f9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1572994525000' class='quanto-date posted-at response-posted-at' href='#5dc1fddd979ced004a1ec2f9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Giuseppe,</p>

<p>My recommendation was 3 stocks in 2 sectors without  fcf_yield filter.<br>
Try to backtest the code I posted above without any changes.<br>
It will perform  1.5 times better.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dc2069d5f60ba20f6d0b531' id='5dc2069d5f60ba20f6d0b531'>
<a href='#5dc2069d5f60ba20f6d0b531'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5673f0630a6bfa534b00000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/147dbb7c6d5789fd351a368486558c2a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5673f0630a6bfa534b00000d'>Giuseppe Moriconi</a>
</div>
<a UTCms='1572996765000' class='quanto-date posted-at response-posted-at' href='#5dc2069d5f60ba20f6d0b531'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>my fault!<br>
 i have backtested your version right now and it&#39;s really impressive  for me thank you!<br>
(i attached your version)</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dc21b78cf14a2004c52a7af' id='5dc21b78cf14a2004c52a7af'>
<a href='#5dc21b78cf14a2004c52a7af'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1573002104000' class='quanto-date posted-at response-posted-at' href='#5dc21b78cf14a2004c52a7af'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thank you, Giuseppe.</p>

<p>Here is its performance tear-sheet.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df3f8beb1e63240460b38f4' id='5df3f8beb1e63240460b38f4'>
<a href='#5df3f8beb1e63240460b38f4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1576270014000' class='quanto-date posted-at response-posted-at' href='#5df3f8beb1e63240460b38f4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Giuseppe</p>

<p>Just a question, why you are including the small and big P-Score numbers?</p>

<p>I was playing a little bit with the code and if you include only the &gt;= 7 it will give almost the same result as including &lt;=3 too.<br>
Theoretically the &lt;3 are the more unstable company’s...but as well strongly leveraged which could result in better short earnings and prices increase - interesting ideas<br>
Could you please comment on your thinking about that.</p>

<p>Thanks<br>
Carsten  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df4b43b4fcfe551a4b0de0c' id='5df4b43b4fcfe551a4b0de0c'>
<a href='#5df4b43b4fcfe551a4b0de0c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5469bca83ab3de7bff000334'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4c4ecac20f2ccee61491516e54b67f72?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5469bca83ab3de7bff000334'>Tony Morland</a>
</div>
<a UTCms='1576318011000' class='quanto-date posted-at response-posted-at' href='#5df4b43b4fcfe551a4b0de0c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi @Giuseppe &amp; @Vladimir, nice work and of interest to me for my personal trading. Here in Q i always work with Equity Long-Short models. I will convert what you have done to that sort of algo and let you know what i find, if you are interested.  Best wishes, ciao, TonyM.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df4ca4aaa6cc4003e3997bd' id='5df4ca4aaa6cc4003e3997bd'>
<a href='#5df4ca4aaa6cc4003e3997bd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5469bca83ab3de7bff000334'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4c4ecac20f2ccee61491516e54b67f72?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5469bca83ab3de7bff000334'>Tony Morland</a>
</div>
<a UTCms='1576323658000' class='quanto-date posted-at response-posted-at' href='#5df4ca4aaa6cc4003e3997bd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Giuseppe, as i&#39;m going through your code, trying to work out exactly what you are doing and why, i have some questions for clarification, for example:</p>

<p>You define profit = ROA() + ROAChange() + CashFlow() + CashFlowFromOps(), with 0/1 output for each individual  term, as i understand it, and therefore integer result between 0 and 4.<br>
ROA comes from class ROA(CustomFactor) and this has an output 1 or 0 depending on whether ROA is &gt; 0 or not. OK so far.<br>
Now you have  ROAChange, with window length 22. As i understand it, you are comparing current ROA with the ROA from 1 trading month (21 days) earlier, is that correct? It seems a plausible enough thing to do, but ROA is not a price-dependent variable and will only change whenever either the reported earnings (the &quot;RO&quot; part) changes or else the corporate assets (the &quot;A&quot; part) changes, neither of which will happen until the next corporate reporting period, presumably every 3 months, and then when it  does happen you will have introduced a lag of another month due to the window length.<br>
So most of the time, for periods of 3 months at a time, the ROA value will not vary and neither will the ROAchange vary either. Maybe that&#39;s OK for you, but why the 22d window length for the ROAchange? Please correct me if i&#39;m wrong, but as i see it, all you are doing with that is introducing a completely unnecessary additional 1 month lag in your calculations.  </p>

<p>In the &quot;CashFlow&quot; part, you are checking for positive CF, which is OK<br>
In the &quot;CashFlowFromOps&quot; part, you are comparing &quot;cash_flow_from_ops&quot; data, which is a $ number vs &quot;roa&quot; which is a % or a ratio of return (i.e Earnings) vs Assets. Please correct me if i&#39;m wrong here, but this does not seem to make sense because it is an &quot;apples vs oranges&quot; type calculation. Preferably you need to convert both to $ terms first, or else use Earnings instead of ROA. </p>

<p>The LongTerm Debt to Equity and short term CR calculations make sense. Either LTDebt going down or CR going up are indicative of financial strength and give you positive score contributions. OK, although again the issue of window length causing a lag so that  you will not get to see any change until a month after it is reported. </p>

<p>Your Piotroski screen concept looks OK, and i use something similar myself, but i think your results might possibly be suffering because of the time lag in some of the individual terms, as described above.</p>

<p>All of the fundamental items like ROA, CFops, Debt ratios, and so on are all basically measures of Financial or Operational Strength, and therefore essentially they are measures of QUALITY of the company, as is the resultant Piotroski score. That&#39;s excellent, but none of these items are actually measures of VALUE as such, which requires a comparison or ratio between share price $ and something else such as earnings or whatever that is also expressed in $. So, what i think you are doing is a very nice job with looking at individual stock and the Sector price changes, and at the underlying quality or financial health of each company share, but that does not actually tell you whether the shares are currently under-priced or over-priced compared to some independent measures of value (such as PE or P-to-Book, or PEG ratio, or any other price ratios).  I think you could potentially improve your algo  results further by adding some more direct value measures. </p>

<p>I hope these comments might be helpful, and i look forward to more discussion with you. Best regards. Ciao.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df5669464b6830957c1b2f9' id='5df5669464b6830957c1b2f9'>
<a href='#5df5669464b6830957c1b2f9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5673f0630a6bfa534b00000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/147dbb7c6d5789fd351a368486558c2a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5673f0630a6bfa534b00000d'>Giuseppe Moriconi</a>
</div>
<a UTCms='1576363668000' class='quanto-date posted-at response-posted-at' href='#5df5669464b6830957c1b2f9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thank you very much Carsten and Tony! first of all i have made a test to check that the piotrosky score rank provides an actual value to the strategy before starting to test your indications, right now i have checked the CashFlowFromOps &quot;dollars/percent&quot; and i think it is actually an error thank you.<br>
I also think that in this strategy the fundamental part is weak because it tells nothing about value, and i will try to substitute it with some meore direct factors like the ones described <a href="https://www.quantopian.com/posts/new-strategy-presenting-the-quality-companies-in-an-uptrend-model-1" rel="nofollow">here</a> but keeping the sectors logic as it is.<br>
So if the original code is  </p>

<pre><code>group[&#39;total_rank&#39;] = group[&#39;ranked_vol&#39;] + group[&#39;ranked_returns&#39;] + group[&#39;ranked_pio&#39;]  
</code></pre>

<p>this means that (after the sectors selection) i rank my universe on <strong>Low Volatility</strong>, <strong>High Returns</strong>, and <strong>High Piotrosky Score</strong></p>

<ul>
<li>and this (the vladimir version wich is the best one) gives<br>
Returns:  10.22<br>
Sharpe: 1.34<br>
Drawdown: -0.14<br></li>
<li>then i commented out the piotrosky score contibution to the rank and i got this </li>
</ul>

<pre><code>group[&#39;total_rank&#39;] = group[&#39;ranked_vol&#39;] + group[&#39;ranked_returns&#39;] #+ group[&#39;ranked_pio&#39;]  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df5670164b6830957c1b2fb' id='5df5670164b6830957c1b2fb'>
<a href='#5df5670164b6830957c1b2fb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5673f0630a6bfa534b00000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/147dbb7c6d5789fd351a368486558c2a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5673f0630a6bfa534b00000d'>Giuseppe Moriconi</a>
</div>
<a UTCms='1576363777000' class='quanto-date posted-at response-posted-at' href='#5df5670164b6830957c1b2fb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>and if i leave the piotrosky ranking logic as the only one i have this  </p>

<pre><code>group[&#39;total_rank&#39;] =  group[&#39;ranked_pio&#39;]  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df56bd3999cef003f997ed3' id='5df56bd3999cef003f997ed3'>
<a href='#5df56bd3999cef003f997ed3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5673f0630a6bfa534b00000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/147dbb7c6d5789fd351a368486558c2a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5673f0630a6bfa534b00000d'>Giuseppe Moriconi</a>
</div>
<a UTCms='1576365011000' class='quanto-date posted-at response-posted-at' href='#5df56bd3999cef003f997ed3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Tony of course i am very interested to see if the logic is good for long/short also, i have made quite some tests on this strategy  just working on sectors and i have spent most of the time on that (no stocks) to see if that sort of short term mean reversion on a long term momentum makes some sense and actually it does consistently.<br>
So i think that flipping that logic upside down is useful to have a first approach to the long/short strategy  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df57e06999cef3eb8997028' id='5df57e06999cef3eb8997028'>
<a href='#5df57e06999cef3eb8997028'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1576369670000' class='quanto-date posted-at response-posted-at' href='#5df57e06999cef3eb8997028'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Giuseppe </p>

<p>Sorry, I was not saying that you should delete the small p-score... :) no, that was not my intention!<br>
I’m just saying I’m not understanding why you are doing that!</p>

<p>Ok, I was playing a little around with you code. It seems to me that there was a very small difference if you leave the &lt;3 company’s out...but maybe it’s a smart idea to leave them in??? Maybe we get a little bit smoother ride. But I would like to understand the reason.</p>

<p>I was trying to run simulations on the quantopian platform, but it took very long...so I stopped.<br>
I’m trying to install now everything on my Mac after the holidays. Do you think that’s faster? (The last months I was using MATLAB)</p>

<p>I initially started with factor investing as my target/holly grail after reading “what works on Wallstreet” from O’Shaughnessy.<br>
He as well runs a Factor based fond. The book and the website from his company  will give you a ton ideas about the value concept in different shades...<br>
But probably you already know.<br>
Especially if you search his recent presentations in the Internet you find new definitions about his composite factors value, quality and the other he uses.<br>
The only bad news is, actually value does not work well during the last...at least 5 years.</p>

<p>If one wants to do factors investing, there is still one idea which worked quite nice:<br>
GARP - growth at a reasonable price.<br>
If you check for Liam Flavelle on seeking alpha you find some ideas which worked nicely.<br>
Around 30% in backtest and I still saw them running paper trading in the beginning of 19 with around that amount.<br>
(Unfortunately his Plattform investors edge does not exist anymore)</p>

<p>What I understand, after the big crash you have the first years value outperforming and the last years growth...and than the blow of and repeat... :)<br>
Unfortunately during 2013, 2015/16 Value was a nice option.<br>
That means you either can predict what you should select or run 2 strategies or a kind of hybrid.</p>

<p>Now coming back to the p-scores, and how you combined it, maybe that is a solution. Going for the &gt;7 to get the value and &lt;3 to get some growth stocks. Maybe....</p>

<p>Than I like very much the idea with the sectors...<br>
I read the book from William O’Neil and tried the concept of buying momentum and growth.<br>
There were moments were you could make a ton of money...April 18 to Sep 18 and Jan 19 to mid 19. In 2018 started to read a ton of books, so I just started that time and in Jan 19 I was to unsure if I should go in, and in April I was basically a bit late.(with money management I need alt least 2 month to get to 100%)<br>
BUT if I would have followed that approach 100% would be possible, each year.<br>
The only problem is to know if the boundary conditions are ok. If you are in a sideward market you will heavily loose.<br>
If the S&amp;P and the Russel 2000 go up in parallel you just need to check which sub sector goes up an buy the best performing stocks. 2018 it was mainly medical and 2019 it was software/security stocks.<br>
It’s quite close what you are doing - if you skip the value and quality.<br>
O’Neil use a momentum und a lot of other stuff, but I think the main driver are earnings acceleration and sales acceleration.</p>

<p>An other ideas would be, to decide on macro level in which market condition we are in and than allocate to different strategies, value, growth and so on and not to do everything in one strategy.</p>

<p>Complicated stuff...I still need to learn a lot...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df580ee64b6834516c1b2c6' id='5df580ee64b6834516c1b2c6'>
<a href='#5df580ee64b6834516c1b2c6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1576370414000' class='quanto-date posted-at response-posted-at' href='#5df580ee64b6834516c1b2c6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Giuseppe</p>

<p>...and you might check <a href="https://alphaarchitect.com/" rel="nofollow">https://alphaarchitect.com/</a></p>

<p>They show a method how you can evaluate which of the five factors had contributed to the market return.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df60c5f5d268f2c0ce775b0' id='5df60c5f5d268f2c0ce775b0'>
<a href='#5df60c5f5d268f2c0ce775b0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5469bca83ab3de7bff000334'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4c4ecac20f2ccee61491516e54b67f72?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5469bca83ab3de7bff000334'>Tony Morland</a>
</div>
<a UTCms='1576406111000' class='quanto-date posted-at response-posted-at' href='#5df60c5f5d268f2c0ce775b0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi @ Giuseppe &amp; Carsten &amp; friends,</p>

<p>I have been working for several years with EquityLS models in Q using some concepts that are fairly similar to what you have here. Occasionally i make a few $ in the Contests, so i can assure you that the sort of ideas that you are using here do work well in EquityLS.  Yes, you are on the right track :-)</p>

<p>As Carsten says, O’Shaughnessy&#39;s &quot;What Works on Wallstreet&quot; is a good book and i used various versions of it for many years. There are several other recent good easy reading books on the fundamentals side, as well as Aswath Damodaran&#39;s excellent books on valuation and some good free material on his website that is well worth looking at. </p>

<p>Carsten&#39;s comment : &quot; <em>... actually value does not work well during the last...at least 5 years</em>&quot;. is worth thinking a bit more about.......<br>
Basically everyone in the market is looking for alpha, from whatever sources or factors they can find it.  Some sources &quot;wear out&quot; as inefficiencies get arbitraged away and never reappear, but others come back again as different types of investing move in and  out of fashion with the big funds. For example, sometimes Momentum stocks are most popular, at other times it is Big Caps, or Growth, or Value, or sometimes specific Sectors or other investing styles, and generally these tend to persist for a while, before gradually changing to the next fad or fashion. </p>

<p>So, as i see it, there are really 3 different components to successful investing or trading. The first component is Price Action, obviously, because this is what we profit directly from. The second  component is Fundamentals and other non-price data and all the different associated Factors that can be related to alpha. The third component, as i see it, is what i call for want of a better name &quot;Current Market Fashion&quot; or what is  currently  the hottest investing style or sector or whatever else it is that is popular now. All other things equal, stocks that are in the current &quot;Fashion&quot; group will tend to do better than stocks that are not. And within that group of what is hot, &quot;the rising tide tends to lift all boats&quot;, as they say.</p>

<p>So, what i believe is worth doing (and what i am working on myself at the moment) in addition to the price &amp; fundamentals aspects that Giuseppe has already here in this algo, is ALSO to identify the current market fashion (e.g.  the leading Investment Style), then Buy stocks in that group and Sell stocks that are not in that group, as part of an EquityLS strategy.  Does this make sense to you? Anyone interested in picking up on this and continuing our discussion further with some experimental algos that involve other potential &quot;Fashion&quot; components in addition to just Sectors?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df63d40a8c9d8004338a830' id='5df63d40a8c9d8004338a830'>
<a href='#5df63d40a8c9d8004338a830'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1576418624000' class='quanto-date posted-at response-posted-at' href='#5df63d40a8c9d8004338a830'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Tony</p>

<p>that was as well my finding after understanding the factor investing.  One either has to wait and hope or try to find out what is the actual “fashion”.<br>
The first ideas was to run the pure 5 factors, see if they were trending and than allocate accordingly.<br>
I did this on the investors edge platform just for value long/short (similar to portfolio 123)  and the first results were very noisy. Unfortunately the platform closed and I could not continue (the data vendor doubled price and there were to few users as it was new)<br>
But maybe on could have picked up a trend an allocate monthly. But I could never test this.<br>
An other option is to detect the main economic conditions and let’s say if purchase manager index below 50 one goes value + sometimes and above 50 we go for growth.<br>
Or looking at the VIX and below it’s x days moving average go to momentum growth and above doing a mean reversal algo...</p>

<p>At the moment I’m a bit non productive as the platform I used stopped and than I moved to MATLAB (which is great but few private people using it) but due to the much higher popularity of Python it looks the way to go. I’m just figuring out what and how to set up. I narrowed down to Zipline or backtrader. I believe that I need to run everything locally as the platforms I tested are way to slow.(yes and in need to purchase my on data...)<br>
For example, running a value momentum algo with first ranking 3 composite factors(with each 3-4 single factors) as filter for the universe than running either the momentum or the composite value and than as last step the selection ranking took around 5 minutes for the whole 20 years.<br>
That’s what I’m looking for regarding speed.<br>
All the free platforms are obviously slower, you get what you pay,  but I would prefer to pay a bit and move faster :)<br>
Do you have some suggestions?</p>

<p>...and I’m definitely interested in your offer!</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df63e92a8c9d8004638a80a' id='5df63e92a8c9d8004638a80a'>
<a href='#5df63e92a8c9d8004638a80a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5469bca83ab3de7bff000334'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4c4ecac20f2ccee61491516e54b67f72?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5469bca83ab3de7bff000334'>Tony Morland</a>
</div>
<a UTCms='1576418962000' class='quanto-date posted-at response-posted-at' href='#5df63e92a8c9d8004638a80a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Sometimes the fundamentals (e.g. ROA, PE, etc) are very different for different Sectors, and so instead of just taking the individual stock fundamental values on their own, a few years ago i tried comparing the stocks&#39; values with the average for the relevant sector, either normalizing by taking ratios, or else by taking differences. This was partially successful, but i did not get around to completing the work. I think this comparative approach is worth coming back to again, not just for Sectors but also for Investment Styles or other ways of grouping stocks too. Anyone interested?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df6433e8199e900491f0006' id='5df6433e8199e900491f0006'>
<a href='#5df6433e8199e900491f0006'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5469bca83ab3de7bff000334'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4c4ecac20f2ccee61491516e54b67f72?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5469bca83ab3de7bff000334'>Tony Morland</a>
</div>
<a UTCms='1576420158000' class='quanto-date posted-at response-posted-at' href='#5df6433e8199e900491f0006'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Carsten, i wrote the post above before i saw yours. For my own personal trading outside of Q i use AmiBroker with its AFL language which is very good for price analysis work but weak on the fundamentals side.  What i have done is enough Markov Chain / Transition Probability work with different Market Regimes to convince myself that finding whatever is hot and riding for as long as one can is generally a good way to go. I think this goes for &quot;investment fashions&quot; as well as for purely price action behavior.  Therefore i consider that finding out what investment fashion (sector, factor, style or whatever) is currently the best is very much a worthwhile endeavor, and so it sounds like your ideas and mine are well aligned. As to what platform is best to use, i can&#39;t really comment. I will be working on this here on Q, even though my python skills are not particularly good.  Do you have anything currently working (even if slow) here on Q along the lines you mentioned that we could perhaps look at together and share ideas for improving?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df789c590f8730046759668' id='5df789c590f8730046759668'>
<a href='#5df789c590f8730046759668'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5673f0630a6bfa534b00000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/147dbb7c6d5789fd351a368486558c2a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5673f0630a6bfa534b00000d'>Giuseppe Moriconi</a>
</div>
<a UTCms='1576503749000' class='quanto-date posted-at response-posted-at' href='#5df789c590f8730046759668'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>By using this algo i have found that the number of stocks is too small, and just one stock can bring down the entire portfolio very quickly  wich is hard to withstand psicologically. So basically some improvements culd be putting stop losses or weight stocks on volatility or have a larger set of stocks in portfolio.</p>

<p>The idea of finding investment fashions is very interesting. @Tony but i cannot think of anything else but sectors, or fundamental fatcors can you make some  examples?</p>

<p>i have given up un the idea of installig zipline locally because organizing data is too time consuming and also because just installing it is very difficoult  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df8b39266b184004aec9fb0' id='5df8b39266b184004aec9fb0'>
<a href='#5df8b39266b184004aec9fb0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5673f0630a6bfa534b00000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/147dbb7c6d5789fd351a368486558c2a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5673f0630a6bfa534b00000d'>Giuseppe Moriconi</a>
</div>
<a UTCms='1576579986000' class='quanto-date posted-at response-posted-at' href='#5df8b39266b184004aec9fb0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Carsten are you shure that if you delete the 
<code>p &lt;= 3</code>part of the filter you will get the same resoults?<br>
As far as i can see basically all the stocks are chosen within the p &lt;= 3 group infact if you delete the p &gt; 7 part the algo makes nothing, so that is not really what i was looking for but if i have to learn something from that it would be that i will have to buy weak fundamendals with strong price action.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df8b8909e307700436e8552' id='5df8b8909e307700436e8552'>
<a href='#5df8b8909e307700436e8552'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5469bca83ab3de7bff000334'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4c4ecac20f2ccee61491516e54b67f72?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5469bca83ab3de7bff000334'>Tony Morland</a>
</div>
<a UTCms='1576581264000' class='quanto-date posted-at response-posted-at' href='#5df8b8909e307700436e8552'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Giuseppe,</p>

<p>I agree, the number of stocks you are using is too small. Especially if you go to Equity LS algos then try 100 or more.</p>

<p>&quot;Investment Fashions&quot;</p>

<ul>
<li>Sectors,<br></li>
<li>Macro Economic factors, including interest rate regimes (High / Low, Rising / Falling, etc).<br></li>
<li>Fundamentals as in Big vs Small Caps, Growth vs Value, Regular dividend payers, Low debt during recessions vs highly geared during periods of strong economic growth, etc.<br></li>
<li>Commodity-related (e.g. precious metals, other futures data correlations, etc).<br></li>
<li>Price patterns &amp; volatility effects,<br>
etc.<br></li>
</ul>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df92baee54b02740c74a467' id='5df92baee54b02740c74a467'>
<a href='#5df92baee54b02740c74a467'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1576610734000' class='quanto-date posted-at response-posted-at' href='#5df92baee54b02740c74a467'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Giuseppe<br>
I believe it was the &lt;3 part... I played around with changing the numbers, deleting one part, than the other...it took always very long to run the code...<br>
I definitely believe if you buy very over leveraged companies (&lt;3) together with price action, the will definitely perform in the short run - but that’s not value (which did not work great in the last year’s anyway)<br>
But if you would like to buy &lt;3, a PE 0 &lt; x &lt; 20 does not make sense. That’s why I assume the strategy should not catch any stock &lt;3 Z-score - theoretically.<br>
Probably you z-score has a small error?<br>
When I programed these multifactors I got huge amount of errors in the first place.<br>
If you devide the  numbers, be carful how you do it. if they get a negative sign, they might jump to the other side off the ranking. Took me a little bit. The best way to do it, just use every single factor, run it for long as possible and check that the gain vs percentages are looking smooth, no sudden spike or jumps or empty spaces - and best compare them how they should look like with other literature . If your sure there ok, combine them and check the combination again.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df92c2666b18416e2eca175' id='5df92c2666b18416e2eca175'>
<a href='#5df92c2666b18416e2eca175'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1576610854000' class='quanto-date posted-at response-posted-at' href='#5df92c2666b18416e2eca175'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Tony<br>
I send you a PM  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5df9e1e29e30773ab26e8972' id='5df9e1e29e30773ab26e8972'>
<a href='#5df9e1e29e30773ab26e8972'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5673f0630a6bfa534b00000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/147dbb7c6d5789fd351a368486558c2a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5673f0630a6bfa534b00000d'>Giuseppe Moriconi</a>
</div>
<a UTCms='1576657378000' class='quanto-date posted-at response-posted-at' href='#5df9e1e29e30773ab26e8972'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thank you very much Carsten, that totally make sense, i think i will gradually start to reconstruct the fundamentals part of the algo  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dfa0b61dc10cc004a4c27e7' id='5dfa0b61dc10cc004a4c27e7'>
<a href='#5dfa0b61dc10cc004a4c27e7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1576668001000' class='quanto-date posted-at response-posted-at' href='#5dfa0b61dc10cc004a4c27e7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Giuseppe </p>

<p>I was thinking a bit using z-score to select growth, meaning z&lt;3...<br>
I think this was not the idear behind the score. As I understand it should be only used in one direction, at least for the long side.<br>
For shorting z&lt;3 might be ok.</p>

<p>If you plan to select growth stocks and price action it might be not the best idear to use the z-score.<br>
Other factors might be better.</p>

<p>I would recommend reading<br>
QUANTITATIVE STRATEGIES FOR ACHIEVING ALPHA RICHARD TORTORIELLO<br>
and/or<br>
WHAT WORKS ON WALL STREET The Classic Guide to the Best-Performing Investment Strategies of All Time JAMES P. O’SHAUGHNESSY<br>
 - 4.th edition<br>
 and<br>
<a href="https://www.osam.com/Commentary" rel="nofollow">https://www.osam.com/Commentary</a></p>

<p>Second book advocates value and the first book as well suggests some growth factors.<br>
( both are a library for factors)
For somebody new to all this, the second book was great for me to start. After reading a lot of things about factors investing I believe the first one has more information. I did not find any other book which is close to these two.</p>

<p>The home page of OSAM has some very good ideas for specific strategies.<br>
(Unfortunately most is value)</p>

<p>“I believe in the discipline of mastering the best that other people have ever figured out. I don’t believe in just sitting there and trying to dream it up all yourself. Nobody’s that smart.”—Charlie Munger</p>

<p>:)</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dfa178098f3a4003e73b94c' id='5dfa178098f3a4003e73b94c'>
<a href='#5dfa178098f3a4003e73b94c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1576671104000' class='quanto-date posted-at response-posted-at' href='#5dfa178098f3a4003e73b94c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>...and the blog from theses guys, as well some interesting articles...</p>

<p><a href="https://alphaarchitect.com/research-category-list/" rel="nofollow">https://alphaarchitect.com/research-category-list/</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dfbf40af29e37004c4e23ce' id='5dfbf40af29e37004c4e23ce'>
<a href='#5dfbf40af29e37004c4e23ce'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5673f0630a6bfa534b00000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/147dbb7c6d5789fd351a368486558c2a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5673f0630a6bfa534b00000d'>Giuseppe Moriconi</a>
</div>
<a UTCms='1576793098000' class='quanto-date posted-at response-posted-at' href='#5dfbf40af29e37004c4e23ce'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>i have completely changed the fundamental part and i added a criteria to weight stocks wich is in the function &#39;m_v_p&#39;<br>
i am kind of annoyed by the behaviour in 2017 and i don&#39;t really understand where all that volatility came from, but i think the algo overall makes sense and hase space for improvements  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5dfebb7072f6e100413f6fdb' id='5dfebb7072f6e100413f6fdb'>
<a href='#5dfebb7072f6e100413f6fdb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5de908dcc3cbe166a89cafe9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/124cace28940adb96fc17a8739a928fa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5de908dcc3cbe166a89cafe9'>Carsten</a>
</div>
<a UTCms='1576975216000' class='quanto-date posted-at response-posted-at' href='#5dfebb7072f6e100413f6fdb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guiseppe<br>
Just an additional idea, you could try to use earnings and sales growth with price momentum.<br>
To determine the growth you would always calculate n quarter / n - 4 quarter ago.<br>
To get the growth for 1 year, you could than build the sum of all 4 and rank them accordingly (or 8 for 2 years)<br>
Doing the same with the second element.<br>
Than you add both ranks and rank the result again.<br>
Or you could add the ranks of earnings, sales and momentum and rank the results to find your top stocks.<br>
This is how IBD roughly is doing it. They use more than earnings, sales and momentum, but I believe the three items are the main driver.<br>
You could as well use more than 1 year for earnings and sales and one could filter out stocks were the earnings and sales fluctuate to much.<br>
Minimum yearly growth for the last year should be 20-30% each.<br>
And one should only buy if the S&amp;P 500 is above its 200 moving average.<br>
For reverence you could google William O&#39;Neil screen or CAN-Slim.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e210b0a366aa3003e23df6e' id='5e210b0a366aa3003e23df6e'>
<a href='#5e210b0a366aa3003e23df6e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5a4074b6e29df6513fbc85ba'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/eed3d7f0785d0c51137af0f2d7af2c19?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5a4074b6e29df6513fbc85ba'>Matt Levins</a>
</div>
<a UTCms='1579223818000' class='quanto-date posted-at response-posted-at' href='#5e210b0a366aa3003e23df6e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guiseppe </p>

<p>I have tried to clone the algorithm and get an error on line 88. It is an error with the dict_keys. Do you know if what might be the reason for this? I would love to get the algorithm running to try and make improvements.</p>

<p>Thanks,<br>
Matt  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e21a8c5366aa3004123e3c1' id='5e21a8c5366aa3004123e3c1'>
<a href='#5e21a8c5366aa3004123e3c1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5673f0630a6bfa534b00000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/147dbb7c6d5789fd351a368486558c2a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5673f0630a6bfa534b00000d'>Giuseppe Moriconi</a>
</div>
<a UTCms='1579264197000' class='quanto-date posted-at response-posted-at' href='#5e21a8c5366aa3004123e3c1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Matt, it&#39;s a problem related to python 3.5, if you compile with python 2 there are no error, by the way<br>
replaxe line 35 with  </p>

<pre><code>context.sectors_list = list(context.sectors_dict.keys()  )  
</code></pre>

<p>and replace line 132 with<br>
<code>
for k, v in context.sectors_dict.items():  
</code></p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e61e7d3ab65ec0044997254' id='5e61e7d3ab65ec0044997254'>
<a href='#5e61e7d3ab65ec0044997254'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5aada5f093ed5900105f045e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e1927a513875cef7a1c2877fdb6b45ae?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5aada5f093ed5900105f045e'>Lu Niu</a>
</div>
<a UTCms='1583474643000' class='quanto-date posted-at response-posted-at' href='#5e61e7d3ab65ec0044997254'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guiseppe</p>

<p>Thanks for sharing! I tried to understand this part:  </p>

<pre><code> if n &gt;= 8:  
        market_trend = 2  
        equity_allocation = 0.8  
        #peggiori rendimenti ultimo mese  
        sectors_to_buy = last_month_sorted[-2:].index.tolist() 

    # -----------  MORE THAN HALF OF THE SECTORS ARE UPTRENDING ------------- #  
    elif 5 &lt; n &lt;  8:  
        market_trend = 1  
        equity_allocation = 0.6  
        sectors_to_buy = last_month_sorted[-2:].index.tolist()  
    # -----------  LESS THAN HALF OF THE SECTORS ARE UPTRENDING ------------- #  
    elif 2 &lt; n &lt;= 5:  
        market_trend = 0  
        equity_allocation = 0.4  
        sectors_to_buy = last_month_sorted[:2].index.tolist()  
</code></pre>

<p>Shall we always use <code>last_month_sorted[:2]</code>, meaning pick top 2 in the sorted list? Why <code>last_month_sorted[-2:]</code>?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e8c3b9108d6c7190455a87b' id='5e8c3b9108d6c7190455a87b'>
<a href='#5e8c3b9108d6c7190455a87b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5673f0630a6bfa534b00000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/147dbb7c6d5789fd351a368486558c2a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5673f0630a6bfa534b00000d'>Giuseppe Moriconi</a>
</div>
<a UTCms='1586248593000' class='quanto-date posted-at response-posted-at' href='#5e8c3b9108d6c7190455a87b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>hi Lu, this is the mean reverting part: i choose the worst performing sectors among the best ones. The logic behind this choice is that basically they have more upside potential in a bull market because they are not still gone so far like the best ones.  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/momentum-value-and-a-little-bit-of-mean-reverting'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/momentum-value-and-a-little-bit-of-mean-reverting'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#d1b7b4b4b5b3b0b2ba91a0a4b0bfa5bea1b8b0bfffb2bebc">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
CSSAnalytics - A Simple Tactical Asset Allocation Portfolio with Percentile Channels
</title>
<meta content='[EDIT: see bottom of thread for most recent versions] Hey everyone, I just secured my Quantcon ticket, so I&#39;ll take the opportunity to say &#39;Hi!&#39; to the community and give back a little with an implementation from the quant blogosphere. The attached algorithm is an adaptation of a recent tactical asset allocation portfolio from David Varadi @ CSSAnalytics:  &quot;A Simple Tactical Asset Allocation Portfolio with Percentile Channels&quot; . I took the freedom to modify it slightly from the original, as...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="gBBYySl7iIiXEJUV5wgq0G8W0KWUW29cgV0mwYfd7+D8di6Ei41aay4NzCSo54KkV5jzzO6XekcDUv2rLZiNWw==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/cssanalytics-a-simple-tactical-asset-allocation-portfolio-with-percentile-channels' property='og:url'>
<meta content='CSSAnalytics - A Simple Tactical Asset Allocation Portfolio with Percentile Channels' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/cssanalytics-a-simple-tactical-asset-allocation-portfolio-with-percentile-channels' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='CSSAnalytics - A Simple Tactical Asset Allocation Portfolio with Percentile Channels' property='og:title'>
<meta content='[EDIT: see bottom of thread for most recent versions] Hey everyone, I just secured my Quantcon ticket, so I&#39;ll take the opportunity to say &#39;Hi!&#39; to the community and give back a little with an implementation from the quant blogosphere. The attached algorithm is an adaptation of a recent tactical asset allocation portfolio from David Varadi @ CSSAnalytics:  &quot;A Simple Tactical Asset Allocation Portfolio with Percentile Channels&quot; . I took the freedom to modify it slightly from the original, as...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/cssanalytics-a-simple-tactical-asset-allocation-portfolio-with-percentile-channels">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='54f02d10051b7f6ca40002cc'>
<div class='post-container' data-post-id='54f02d10051b7f6ca40002cc' id='54f02d10051b7f6ca40002cc'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>CSSAnalytics - A Simple Tactical Asset Allocation Portfolio with Percentile Channels</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54190a3694339e5d3a0000af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0ce35c636f83b2ccc10b4234b9e6748d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54190a3694339e5d3a0000af'>Alex</a>
</div>
<span class='posted-at'>edited </span>
<span UTCms='1425973758000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=CSSAnalytics - A Simple Tactical Asset Allocation Portfolio with Percentile Channels&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fcssanalytics-a-simple-tactical-asset-allocation-portfolio-with-percentile-channels%3Futm_source%3Dwebsite_share%26utm_campaign%3Dcssanalytics-a-simple-tactical-asset-allocation-portfolio-with-percentile-channels%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fcssanalytics-a-simple-tactical-asset-allocation-portfolio-with-percentile-channels%3Futm_source%3Dwebsite_share%26utm_campaign%3Dcssanalytics-a-simple-tactical-asset-allocation-portfolio-with-percentile-channels%26utm_medium%3Dlinkedin&amp;title=CSSAnalytics+-+A+Simple+Tactical+Asset+Allocation+Portfolio+with+Percentile+Channels+%28Alex%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/cssanalytics-a-simple-tactical-asset-allocation-portfolio-with-percentile-channels?utm_source=website_share&amp;utm_campaign=cssanalytics-a-simple-tactical-asset-allocation-portfolio-with-percentile-channels&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Alex" />
<div class='body-text'>
<div class='body-text-container post-body'><p>[EDIT: see bottom of thread for most recent versions]</p>

<p>Hey everyone,</p>

<p>I just secured my Quantcon ticket, so I&#39;ll take the opportunity to say &#39;Hi!&#39; to the community and give back a little with an implementation from the quant blogosphere.</p>

<p>The attached algorithm is an adaptation of a recent tactical asset allocation portfolio from David Varadi @ CSSAnalytics: <a href="https://cssanalytics.wordpress.com/2015/01/26/a-simple-tactical-asset-allocation-portfolio-with-percentile-channels/">&quot;A Simple Tactical Asset Allocation Portfolio with Percentile Channels&quot;</a>. I took the freedom to modify it slightly from the original, as noted in the code.</p>

<ul>
<li><strong>ASSETS</strong>: US stocks, EAFE stocks, US REIT, US Corporate Bonds, US Government Bonds (= cash)<br></li>
<li><strong>BUY RULE</strong>: Long position if current price &gt;= 0.75 percentile of [60, 120, 180, 252] days channel<br></li>
<li><strong>SELL RULE</strong>: Sell position and move to cash if current price &lt;= 0.25 percentile of [60, 120, 180, 252] days channel<br></li>
<li><strong>ACTIVATION</strong>: Once a month, 5min before the close of the last trading day.<br></li>
<li><strong>SIZING</strong>: proportional to channel count and inverse share in 20-day universe volatility</li>
</ul>

<p>The strategy is simple and consistent and I like it for its use of percentile channels. Of course, it isn&#39;t optimized, but for a monthly approach it has fairly low volatility and draw down (less than 10 percent). Notably, when back testing with our Quantopian data, there isn&#39;t a single down-year and it still provides the performance of a balanced 60/40 portfolio. As a caveat, I&#39;ll point out that it often relies on corporate and government bonds and I wonder whether it will keep performing in an environment of rising interest rates.</p>

<p>I hope you&#39;ll find this implementation useful or, at least, fun to play with. I&#39;ve certainly learned an interesting spin on percentile channels from it. In the same vein of learning, I&#39;d appreciate your feedback on my implementation as I&#39;m just getting warmed up with the Quantopian platform.</p>

<p>See you at Quantcon. Cheers!</p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>35 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='54f0b61934af4be2060004f8' id='54f0b61934af4be2060004f8'>
<a href='#54f0b61934af4be2060004f8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52cc3c215d745f4278000011'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f14b97f665a779c21ab55f2d9381826b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52cc3c215d745f4278000011'>Tartarus Group</a>
</div>
<a UTCms='1425061403000' class='quanto-date posted-at response-posted-at' href='#54f0b61934af4be2060004f8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I actually did this yesterday as well, although still working out some of the bugs. Shamelessly borrowed your code and plugged in the securities I was working with:  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f0c8a7a544aa242400050a' id='54f0c8a7a544aa242400050a'>
<a href='#54f0c8a7a544aa242400050a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5306900f029baa5003000066'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/31823504e43d352d1aa5cb5999973420?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5306900f029baa5003000066'>Ilya Kipnis</a>
</div>
<a UTCms='1425066153000' class='quanto-date posted-at response-posted-at' href='#54f0c8a7a544aa242400050a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Replicated and functionalized here (albeit in R): </p>

<p><a href="https://quantstrattrader.wordpress.com/2015/02/20/a-closer-update-to-david-varadis-percentile-channels-strategy/">https://quantstrattrader.wordpress.com/2015/02/20/a-closer-update-to-david-varadis-percentile-channels-strategy/</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f0e198051b7fae660004f5' id='54f0e198051b7fae660004f5'>
<a href='#54f0e198051b7fae660004f5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/531a7ad9f7959609d10001a1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9f693e5aa9a2f5b71910425fbf1813e1?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/531a7ad9f7959609d10001a1'>Florent Chandelier</a>
</div>
<a UTCms='1425072538000' class='quanto-date posted-at response-posted-at' href='#54f0e198051b7fae660004f5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Ilya, it&#39;s good to see you in a pythonic forum ;-)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f0e22ad20d2b2793000502' id='54f0e22ad20d2b2793000502'>
<a href='#54f0e22ad20d2b2793000502'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5306900f029baa5003000066'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/31823504e43d352d1aa5cb5999973420?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5306900f029baa5003000066'>Ilya Kipnis</a>
</div>
<a UTCms='1425072685000' class='quanto-date posted-at response-posted-at' href='#54f0e22ad20d2b2793000502'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Oh, hey. Yeah, well, I can&#39;t write a line of this zipline stuff. Would love to learn <em>someday</em>, but doing my own thing at the moment &gt;_&lt;. Wish there was a MOOC on it instead of just a tiny bit of documentation. Maybe I can barter some R consulting for help getting this thing off the ground one day &gt;_&lt;  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f0e6b1051b7fae66000504' id='54f0e6b1051b7fae66000504'>
<a href='#54f0e6b1051b7fae66000504'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54190a3694339e5d3a0000af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0ce35c636f83b2ccc10b4234b9e6748d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54190a3694339e5d3a0000af'>Alex</a>
</div>
<a UTCms='1425073843000' class='quanto-date posted-at response-posted-at' href='#54f0e6b1051b7fae66000504'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey Ilya, thanks for the link. Your evaluation convinced me to give the strategy a shot in the first place. Blog&#39;s awesome, keep it going. Also, I&#39;d be glad to barter some pythonic zipline for R one day. ;-)</p>

<p>Tartarus, let me know you complete your implementation. I&#39;d be glad to see some of your results for cross-validation.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f1587b7940d67d20000172' id='54f1587b7940d67d20000172'>
<a href='#54f1587b7940d67d20000172'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54ed3659b4a20910470000f3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/427361ba1763aad9e3145ba86f96f5b9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54ed3659b4a20910470000f3'>Nick Villano</a>
</div>
<a UTCms='1425102974000' class='quanto-date posted-at response-posted-at' href='#54f1587b7940d67d20000172'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello,<br>
What is context.cash (Line 24)?<br>
Also, can you change the codes under context.stocks to change what the algorithm it buying?<br>
Thanks.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f1659c9966974d270001dd' id='54f1659c9966974d270001dd'>
<a href='#54f1659c9966974d270001dd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54190a3694339e5d3a0000af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0ce35c636f83b2ccc10b4234b9e6748d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54190a3694339e5d3a0000af'>Alex</a>
</div>
<a UTCms='1425106335000' class='quanto-date posted-at response-posted-at' href='#54f1659c9966974d270001dd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Nick, cash is IEF (7-10 yr US Govt bonds ETF). You you can clone the algorithm and switch out stocks. This is what it looks like with a bunch of high-flying tech companies:  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f169c64600c108a1000175' id='54f169c64600c108a1000175'>
<a href='#54f169c64600c108a1000175'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54ed3659b4a20910470000f3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/427361ba1763aad9e3145ba86f96f5b9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54ed3659b4a20910470000f3'>Nick Villano</a>
</div>
<a UTCms='1425107400000' class='quanto-date posted-at response-posted-at' href='#54f169c64600c108a1000175'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks so much, Alex!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f1e15c8b3fa886e3000014' id='54f1e15c8b3fa886e3000014'>
<a href='#54f1e15c8b3fa886e3000014'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54ed3659b4a20910470000f3'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/427361ba1763aad9e3145ba86f96f5b9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54ed3659b4a20910470000f3'>Nick Villano</a>
</div>
<a UTCms='1425138014000' class='quanto-date posted-at response-posted-at' href='#54f1e15c8b3fa886e3000014'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Why do I get an error when I run the code from your last reply, Alex?</p>

<pre><code># CSSAnalytics - Tactical Percentile Channels  
#  
# Source:  
#   David Varadi  
#   &quot;A Simple Tactical Asset Allocation Portfolio with Percentile Channels&quot;  
#   (https://cssanalytics.wordpress.com/2015/01/26/a-simple-tactical-asset-allocation-portfolio-with-percentile-channels/)  
#  
# Implementation notes:  
#   - Removed commodity asset  
#   - Added Intl. Equity asset  
#   - Cash asset is 10 year US Govt Bond  
#

import pandas as pd  
import numpy as np

def initialize(context):  
    # original active: VTI, IYR, LQD, DBC  
    # original cash:   SHY  
    # active: VTI, EFA, ICF, LQD  
    # cash:   IEF  
    context.active = [sid(24), sid(39840), sid(16841), sid(26578), sid(3951), sid(5061), sid(42950)]  
    context.cash = sid(23911)  
    context.assets = set(context.active + [context.cash])  
    context.channels = [60, 120, 180, 252]  
    context.entry = 0.75  
    context.exit = 0.25  
    context.leverage = 1.00  
    context.alloc = pd.Series([0.0] * len(context.assets), index=context.assets)  
    context.modes = {}  
    for s in context.active:  
        for l in context.channels:  
            context.modes[(s, l)] = 0

    schedule_function(  
        reallocate,  
        date_rules.month_end(days_offset=0),  
        time_rules.market_close(minutes=6)  
    )  
    schedule_function(  
        rebalance,  
        date_rules.month_end(days_offset=0),  
        time_rules.market_close(minutes=5)  
    )

def handle_data(context, data):  
    pass

def rebalance(context, data):  
    for s in context.alloc.index:  
        if s in data:  
            order_target_percent(s, context.alloc[s] * context.leverage)  
def reallocate(context, data):  
    h = history(300, &#39;1d&#39;, &#39;price&#39;)[context.active]  
    hs = h.ix[-20:]  
    p = h.ix[-1]

    hvol = 1.0 / (hs / hs.shift(1)).apply(np.log).std()  
    hvol_all = hvol.sum()  
    r = (hvol / hvol_all) * 1.0 / len(context.channels)  
    alloc = pd.Series([0.0] * len(context.assets), index=context.assets)  
    for l in context.channels:  
        values = h.ix[-l:]  
        entry = values.quantile(context.entry)  
        exit = values.quantile(context.exit)  
        for s in context.active:  
            m = (s, l)  
            if context.modes[m] == 0 and p[s] &gt;= entry[s]:  
                print &quot;entry: %s/%d&quot; % (s.symbol, l)  
                context.modes[m] = 1  
            elif context.modes[m] == 1 and p[s] &lt;= exit[s]:  
                print &quot;exit: %s/%d&quot; % (s.symbol, l)  
                context.modes[m] = 0  
            if context.modes[m] == 0:  
                alloc[context.cash] += r[s]  
            elif context.modes[m] == 1:  
                alloc[s] += r[s]  
    context.alloc = alloc  
    print &quot;Allocation:\n%s&quot; % context.alloc  
</code></pre>

<p>Thanks,<br>
Nick  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f2035e49e0c720e400009b' id='54f2035e49e0c720e400009b'>
<a href='#54f2035e49e0c720e400009b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52cc3c215d745f4278000011'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f14b97f665a779c21ab55f2d9381826b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52cc3c215d745f4278000011'>Tartarus Group</a>
</div>
<a UTCms='1425146719000' class='quanto-date posted-at response-posted-at' href='#54f2035e49e0c720e400009b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m not exactly 100% sure on why it&#39;s getting a NaN, but it can be effectively treated as wanting to invest 0% because the other allocations still add up to 100%.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f4eda7f3f6dc08c10001e8' id='54f4eda7f3f6dc08c10001e8'>
<a href='#54f4eda7f3f6dc08c10001e8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e3ca9721b31908a5000056'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a839509d8de958403d71c3459198fa2b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e3ca9721b31908a5000056'>Stephen Harlin, MD</a>
</div>
<a UTCms='1425337769000' class='quanto-date posted-at response-posted-at' href='#54f4eda7f3f6dc08c10001e8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Alex, I broke it ...and can&#39;t figure out how.</p>

<p>Just tweaked David&#39;s default assets with my own picks.  Keep getting, &quot;ValueError: cannot float NaN to integer. There was a runtime error on line 57.&quot; (Never got close to line 57.</p>

<p>Here&#39;s the only mod I made (just the symbol lists):</p>

<p>def initialize(context):<br>
    # original active: VTI, IYR, LQD, DBC<br>
    # original cash:   SHY  </p>

<pre><code># active: VTI, EFA, ICF, LQD  
# cash:   IEF  
context.active = [symbol(&#39;GOOG&#39;),symbol(&#39;AAPL&#39;),symbol(&#39;HASI&#39;),symbol(&#39;XLP&#39;),symbol(&#39;XLU&#39;),symbol(&#39;SNH&#39;),symbol(&#39;FBT&#39;)]  
context.cash = symbol(&#39;IEF&#39;)
</code></pre>

<p>Anyone see the source of the error? </p>

<p>(Suspect this would make a nice portfolio ...in the intermediate-term.)</p>

<p>Thanks...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f4f5fef3f6dc08c1000210' id='54f4f5fef3f6dc08c1000210'>
<a href='#54f4f5fef3f6dc08c1000210'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/518adef0ac9d8e67a000000a'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2114608fe0c1969868c3db6b76e511d1?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/518adef0ac9d8e67a000000a'>Michael Van Kleeck</a>
</div>
<a UTCms='1425339904000' class='quanto-date posted-at response-posted-at' href='#54f4f5fef3f6dc08c1000210'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>NaNs from missing data for your particular stocks are probably getting into r.  To verify that, import isnan:</p>

<pre><code>from math import isnan  
</code></pre>

<p>and then test for NaN when looping over s:</p>

<pre><code>        for s in context.active:  
            if isnan(r[s]):  
                log.info(&#39;{s}: found NaN in r&#39;.format(s=s))  
</code></pre>

<p>If you set a breakpoint on the log line, you can examine things in more detail.</p>

<p>If the problem is indeed in r, you could try replacing the NaNs with a default right after calculating r, something like this:</p>

<pre><code>    channel_weight = 1.0 / len(context.channels)  
    r = (hvol / hvol_all) * channel_weight  
    active_asset_channel_weight = (1.0 / len(context.active)) * channel_weight  
    r.fillna(value=active_asset_channel_weight, inplace=True)  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f4faf0322e3735e8000205' id='54f4faf0322e3735e8000205'>
<a href='#54f4faf0322e3735e8000205'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e3ca9721b31908a5000056'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a839509d8de958403d71c3459198fa2b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e3ca9721b31908a5000056'>Stephen Harlin, MD</a>
</div>
<a UTCms='1425341171000' class='quanto-date posted-at response-posted-at' href='#54f4faf0322e3735e8000205'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Michael,</p>

<p>I really appreciate your reply.  However, I&#39;m a Q newb and you sound like a python-meister.  (Spent this morning watching youtube tutorials!)  Is there any way you could integrate those thoughts into the original code with my tickers ...whereby I would then find the changes that corrected the error ...and connect the dots above?  (If not, I understand.)</p>

<p>Again  ...grateful for any help.<br>
Stephen  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f50248585b0e6aac0001de' id='54f50248585b0e6aac0001de'>
<a href='#54f50248585b0e6aac0001de'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/518adef0ac9d8e67a000000a'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2114608fe0c1969868c3db6b76e511d1?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/518adef0ac9d8e67a000000a'>Michael Van Kleeck</a>
</div>
<a UTCms='1425343050000' class='quanto-date posted-at response-posted-at' href='#54f50248585b0e6aac0001de'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here it is with your symbols and the NaN replacement but without the extra debugging code.  I tried it with daily data from 1/1/2013 to 6/1/2013, and there were no errors.</p>

<pre><code># CSSAnalytics - Momentum Channels  
#  
# Source:  
#   David Varadi  
#   &quot;A Simple Tactical Asset Allocation Portfolio with Percentile Channels&quot;  
#   (https://cssanalytics.wordpress.com/2015/01/26/a-simple-tactical-asset-allocation-portfolio-with-percentile-channels/)  
#  
# Implementation notes:  
#   - Removed commodity asset  
#   - Added Intl. Equity asset  
#   - Cash asset is 10 year US Govt Bond  
#

import pandas as pd  
import numpy as np

def initialize(context):  
    # original active: VTI, IYR, LQD, DBC  
    # original cash:   SHY  
    context.active = [symbol(&#39;GOOG&#39;), symbol(&#39;AAPL&#39;), symbol(&#39;HASI&#39;),  
                      symbol(&#39;XLP&#39;), symbol(&#39;XLU&#39;), symbol(&#39;SNH&#39;), symbol(&#39;FBT&#39;)]  
    context.cash = symbol(&#39;IEF&#39;)  
    context.assets = set(context.active + [context.cash])  
    context.channels = [60, 120, 180, 252]  
    context.entry = 0.75  
    context.exit = 0.25  
    context.leverage = 1.00  
    context.alloc = pd.Series([0.0] * len(context.assets), index=context.assets)  
    context.modes = {}  
    for s in context.active:  
        for l in context.channels:  
            context.modes[(s, l)] = 0

    schedule_function(  
        reallocate,  
        date_rules.month_end(days_offset=0),  
        time_rules.market_close(minutes=6)  
    )  
    schedule_function(  
        rebalance,  
        date_rules.month_end(days_offset=0),  
        time_rules.market_close(minutes=5)  
    )


def handle_data(context, data):  
    pass

def rebalance(context, data):  
    for s in context.alloc.index:  
        if s in data:  
            order_target_percent(s, context.alloc[s] * context.leverage)  
def reallocate(context, data):  
    h = history(300, &#39;1d&#39;, &#39;price&#39;)[context.active]  
    hs = h.ix[-20:]  
    p = h.ix[-1]

    hvol = 1.0 / hs.pct_change().std()  
    hvol_all = hvol.sum()  
    channel_weight = 1.0 / len(context.channels)  
    r = (hvol / hvol_all) * channel_weight  
    active_asset_channel_weight = (1.0 / len(context.active)) * channel_weight  
    r.fillna(value=active_asset_channel_weight, inplace=True)  
    alloc = pd.Series([0.0] * len(context.assets), index=context.assets)  
    for l in context.channels:  
        values = h.ix[-l:]  
        entry = values.quantile(context.entry)  
        exit = values.quantile(context.exit)  
        for s in context.active:  
            m = (s, l)  
            if context.modes[m] == 0 and p[s] &gt;= entry[s]:  
                print &quot;entry: %s/%d&quot; % (s.symbol, l)  
                context.modes[m] = 1  
            elif context.modes[m] == 1 and p[s] &lt;= exit[s]:  
                print &quot;exit: %s/%d&quot; % (s.symbol, l)  
                context.modes[m] = 0  
            if context.modes[m] == 0:  
                alloc[context.cash] += r[s]  
            elif context.modes[m] == 1:  
                alloc[s] += r[s]  
    context.alloc = alloc  
    print &quot;Allocation:\n%s&quot; % context.alloc  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f50549322e3735e800022f' id='54f50549322e3735e800022f'>
<a href='#54f50549322e3735e800022f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e3ca9721b31908a5000056'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a839509d8de958403d71c3459198fa2b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e3ca9721b31908a5000056'>Stephen Harlin, MD</a>
</div>
<a UTCms='1425343819000' class='quanto-date posted-at response-posted-at' href='#54f50549322e3735e800022f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Runs like a charm.  </p>

<p>Michael, I really appreciate your help on this and the quick reply.  I&#39;ll look into what you did to fix it.  (No need to reply.)</p>

<p>Owe ya!<br>
Stephen  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f60d63ed786c1e22000087' id='54f60d63ed786c1e22000087'>
<a href='#54f60d63ed786c1e22000087'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e3ca9721b31908a5000056'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a839509d8de958403d71c3459198fa2b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e3ca9721b31908a5000056'>Stephen Harlin, MD</a>
</div>
<a UTCms='1425411430000' class='quanto-date posted-at response-posted-at' href='#54f60d63ed786c1e22000087'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I’d like to make one change in a clone of the algorithm.  The original version (above) would serve to backtest different mixes of instruments …for in-sample testing, e.g.  The new modified copy would serve solely to provide me with rebalancing weights - but only on the day I wish to rebalance …i.e. not automatically the end of every month.</p>

<p>The ability to run it “on demand” would allow it to act as a decision support tool for live trading in a real-money account.</p>

<p>Could someone tell me what change I make to the code?  I’m guessing the change is in this segment:</p>

<pre><code>)  
schedule_function(  
    rebalance,  
    date_rules.month_end(days_offset=0),  
    time_rules.market_close(minutes=5)  
)
</code></pre>

<p>I’m perfectly happy to go into the IDE, on the day I want to rebalance, and manually put a date in a line of code.</p>

<p>Thanks everyone,</p>

<p>Stephen  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f638106840475638000009' id='54f638106840475638000009'>
<a href='#54f638106840475638000009'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51cbb24ab03fe0bc5500000e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/12b8399e99c8eab21b6bf2ac1d1da84a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51cbb24ab03fe0bc5500000e'>Seong Lee</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1425422355000' class='quanto-date posted-at response-posted-at' href='#54f638106840475638000009'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Stephen,</p>

<p>Although I&#39;d recommend against this, one way to go about implementing this would be to:</p>

<p>1) Move all your code from def rebalance() into def handle_data():  </p>

<pre><code>def handle_data(context, data):  
    for s in context.alloc.index:  
        if s in data:  
            order_target_percent(s, context.alloc[s] * context.leverage)  
</code></pre>

<p>2) Setup a Fetcher file - <a href="https://www.quantopian.com/posts/quantopian-tutorial-with-portfolio-rebalance-algorithm-lesson-2-universe-fetcher-and-schedule-function">Tutorial here</a> - that contains the dates you want to rebalance and a signal that tells handle_data() to say something like &#39;order_now&#39;<br>
CSV file format:<br>
Date | Only_order_on</p>

<p>1/27/2014 |  1/27/2014<br>
2/29/2014 | 2/29/2014</p>

<pre><code>
#fetch the CSV  
fetch_csv(file, symbol_column=&#39;order_date&#39;, &#39;date_column&#39;=&#39;Date&#39;)

#in handle_data  
if get_datetime() == data[&#39;order_date&#39;][&#39;order_on&#39;]:  
    # rebalance here  
</code></pre>

<p>3) Update the Fetcher file daily =&gt; E.g. keep historical rows but append new ones on top of it - This would be done outside of Quantopian on your own</p>

<p>If you were to take the other route and manually choose which day to rebalance by entering in some variable in the environment e.g. context.order_date=&#39;1/2/2015&#39;, you&#39;d have to stop and start your algorithm every time you make a change. </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='54f7067366aea6968b000224' id='54f7067366aea6968b000224'>
<a href='#54f7067366aea6968b000224'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e3ca9721b31908a5000056'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a839509d8de958403d71c3459198fa2b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e3ca9721b31908a5000056'>Stephen Harlin, MD</a>
</div>
<a UTCms='1425475188000' class='quanto-date posted-at response-posted-at' href='#54f7067366aea6968b000224'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Seong.  Although not recommended, three good options to choose from.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54f71cbac80f19b0730002b2' id='54f71cbac80f19b0730002b2'>
<a href='#54f71cbac80f19b0730002b2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54f47915d14c3c95ce000004'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/092d0debf380ac287b5527ed7e0e7e92?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54f47915d14c3c95ce000004'>ding wang</a>
</div>
<a UTCms='1425480892000' class='quanto-date posted-at response-posted-at' href='#54f71cbac80f19b0730002b2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>pretty good!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54fc88afdb314c094f00009d' id='54fc88afdb314c094f00009d'>
<a href='#54fc88afdb314c094f00009d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/537400743fcd41da07000056'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/566071c42a032f096a4b6925585231da?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/537400743fcd41da07000056'>Matt Clark</a>
</div>
<a UTCms='1425836209000' class='quanto-date posted-at response-posted-at' href='#54fc88afdb314c094f00009d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Couple of things</p>

<p>1) I believe the intent of the model is to check price against the percentile channels every day, not just on the rebalance day, and then to trade based on those continuous checks every month.  Meaning that if the price dipped down below the 25% mark a few days ago, then moved back up to somewhere around the 50% mark by the rebalance day, that would still be a &quot;sell&quot; signal.  At least that is what I get from reading the follow up posts by Varadi, Kipnis, and others.</p>

<p>2) I also think that the volatility-weighting is supposed to be done absent of the cash asset and then the cash asset gets whatever is left over.  Again just based on what I&#39;ve read on Varadi&#39;s blog.</p>

<p>3) The results of the model appear less robust than one might like to choice of rebalance date.  Try offsetting the monthly rebalance by 5, 10 or 15 trading days.  You will notice significant differences in CAGR and MDD, which suggests that some portion of the return/risk element here is due to lucky choice of optimal start date.  That suggests one of two tactics - a) run this as 4 concurrent portfolios trading each a week apart to average out the effect or b) try running it weekly (which as it turns out seems to work well with portfolio size &gt;= $10K since transaction costs here are minimal).</p>

<p>Attached is my own rework of Alex&#39;s algorithm with the changes above implemented (I think - I&#39;m still a Python novice).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54fcf76f50d1e1bcca0001ca' id='54fcf76f50d1e1bcca0001ca'>
<a href='#54fcf76f50d1e1bcca0001ca'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e3ca9721b31908a5000056'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a839509d8de958403d71c3459198fa2b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e3ca9721b31908a5000056'>Stephen Harlin, MD</a>
</div>
<a UTCms='1425864561000' class='quanto-date posted-at response-posted-at' href='#54fcf76f50d1e1bcca0001ca'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Agree on all three points.</p>

<p>In a paper titled “Adaptive Asset Allocation: A Primer,” David Varadi and colleagues (Butler, Philbrick, and Wolter) concluded a series of models  rebalancing <strong>weekly</strong>.  The return plot got very close to a straight line with a worst monthly loss of just 8%. </p>

<p>Reference:  <a href="http://papers.ssrn.com/sol3/papers.cfm?abstract_id=2328254">http://papers.ssrn.com/sol3/papers.cfm?abstract_id=2328254</a></p>

<p>In contrast, Walter Sun, et al. (Massachusetts Institute of Technology) examined optimal rebalancing schedules and concluded:</p>

<p>(1) Ad hoc methods of periodic rebalancing are simple but suboptimal.
(2) Optimal rebalancing is achieved when rebalancing is employed solely to handle adverse moves.  In their paper, dynamic policy minimized transaction costs, improved returns, and improved utility functions (quadratic, log wealth, and power utility).</p>

<p>Reference: <a href="http://papers.ssrn.com/sol3/papers.cfm?abstract_id=639284">http://papers.ssrn.com/sol3/papers.cfm?abstract_id=639284</a></p>

<p>Two final considerations:</p>

<p>(1) Rebalancing beyond a 30-day period avoids the wash-sale rule.
(2) Holding commission-free ETFs longer than 30 days avoids short-term trading fees (some brokers).</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54fd108c50d1e11e43000213' id='54fd108c50d1e11e43000213'>
<a href='#54fd108c50d1e11e43000213'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54190a3694339e5d3a0000af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0ce35c636f83b2ccc10b4234b9e6748d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54190a3694339e5d3a0000af'>Alex</a>
</div>
<a UTCms='1425870990000' class='quanto-date posted-at response-posted-at' href='#54fd108c50d1e11e43000213'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Matt and Stephen, Very good. Thanks for checking the algorithm. I&#39;ve incorporated the changes and cleaned up the original code.</p>

<p>There&#39;s two things I&#39;m wondering about:<br>
(1) My original code allocates to 4 separate systems/channels whereas the proposed one has cross-talk, i.e. one to-cash channel cancels out one to-asset channel. Is this on purpose?
(2) I&#39;ve swapped out the assets to include the exact ones from the CSSA blog. It seems the performance does not quite hold up. Do we need to use adjusted close prices as proposed by Florent <a href="https://www.quantopian.com/posts/yahoo-slash-quantopian-using-y-adj-as-signal-for-swtich">here</a>?</p>

<p>Optimal rebalancing and tax-loss harvesting is another interesting aspect. Given the algorithm is fairly simple, we should be able to improve that as well.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54fd11071dadc9111f00035a' id='54fd11071dadc9111f00035a'>
<a href='#54fd11071dadc9111f00035a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5306900f029baa5003000066'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/31823504e43d352d1aa5cb5999973420?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5306900f029baa5003000066'>Ilya Kipnis</a>
</div>
<a UTCms='1425871113000' class='quanto-date posted-at response-posted-at' href='#54fd11071dadc9111f00035a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>So for those that don&#39;t read my blog:</p>

<p>Yes, the channels cross-talk. That&#39;s the entire <em>point</em>. Also, the signal is looked at every single day, not just on rebalancing periods.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54fd141adb314c094f00035d' id='54fd141adb314c094f00035d'>
<a href='#54fd141adb314c094f00035d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54190a3694339e5d3a0000af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0ce35c636f83b2ccc10b4234b9e6748d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54190a3694339e5d3a0000af'>Alex</a>
</div>
<a UTCms='1425871900000' class='quanto-date posted-at response-posted-at' href='#54fd141adb314c094f00035d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I see. And <a href="https://systematicinvestor.github.io/Channel-Breakout2/">M. Kapler&#39;s implementation</a> answers any remaining questions.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54fd14ad53dc2418a500039d' id='54fd14ad53dc2418a500039d'>
<a href='#54fd14ad53dc2418a500039d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5306900f029baa5003000066'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/31823504e43d352d1aa5cb5999973420?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5306900f029baa5003000066'>Ilya Kipnis</a>
</div>
<a UTCms='1425872048000' class='quanto-date posted-at response-posted-at' href='#54fd14ad53dc2418a500039d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>That&#39;s where I improved my implementation from.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54fda02a1dadc947c7000614' id='54fda02a1dadc947c7000614'>
<a href='#54fda02a1dadc947c7000614'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e3ca9721b31908a5000056'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a839509d8de958403d71c3459198fa2b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e3ca9721b31908a5000056'>Stephen Harlin, MD</a>
</div>
<a UTCms='1425907756000' class='quanto-date posted-at response-posted-at' href='#54fda02a1dadc947c7000614'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Alex,</p>

<p>Deconstruct the algorithm into three parts: (1)selection, (2) timing, (3) position sizing.  With all due respect, a “simple” tactical asset allocation procedure - elegant by nature - selects from a universe whose performance is affected by far more than channel habitat. Take, e.g., the inclusion of IYR.  Real estate investments do well when rates are low and equity markets are surging.  But there’s no python code that pulls IYR out of the mix when those conditions are absent.  </p>

<p>Or take a “top-down” approach.  When market stress is rising (e.g. geopolitical events occurring or tension within banks’ intermarket funding), correlations will be increasing, volatility will be increasing - so fixed income and volatility assets should outperform equities and commodities.  No code for that.  And there’s one more macro layer:  “defense.”  Recently utilities, healthcare, and consumer staples were getting large institutional money flows, within a defensive context.  No code for real money flows.</p>

<p>In a slightly broader paradigm, you’d pull assets from a universe whose constituents might look like this:</p>

<p><strong>Stress Falling</strong></p>

<p>Equities (VTI)<br>
Commodities (DBC)</p>

<p><strong>Stress Rising</strong></p>

<p>Fixed Income (TLT or IEF based on what’s happening with rates)<br>
Volatility (UVXY)</p>

<p><strong>Defensive</strong></p>

<p>Utilities (XLU)<br>
Healthcare (XLV)<br>
Consumer Staples (XLP)</p>

<p>Then the top-down questions become, “Where are stress levels at?  Are imbalances in the financial system sufficient to move me into fixed income …get long volatility?  Is it the season to minimize correlation or position size on risk?  Should I get defensive? Stress is rising; is the 10-year outperforming the 30-year?”</p>

<p>Alex, I think the interplay of <strong>these</strong> forces account for the underperformance, that is - using a small universe …that simply selects by channel position. Feeling strong?  Could we write an algorithm - call it  “Complex Tactical Risk Allocation”?  And then for version 2.0, how about <strong>forecasting</strong>, rather than <strong>following</strong>, based upon metrics with statistically valid predictive value - e.g. implied correlation, implied volatility, and non-block institutional money flows? </p>

<p>The overarching question for me, as I try and answer these questions …while managing my own life savings …is, “How valuable is an algorithm as a decision support tool?”  Despite my greatest respect for simplicity and the empirical advantage to algorithmic trading, I am undecided.</p>

<p>Thought for the day!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54fdaa2a1dadc947c7000659' id='54fdaa2a1dadc947c7000659'>
<a href='#54fdaa2a1dadc947c7000659'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/537400743fcd41da07000056'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/566071c42a032f096a4b6925585231da?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/537400743fcd41da07000056'>Matt Clark</a>
</div>
<a UTCms='1425910316000' class='quanto-date posted-at response-posted-at' href='#54fdaa2a1dadc947c7000659'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Well, this thread is going to get philosophical quickly.  Perhaps I need something stronger than coffee to continue.</p>

<p>Stephen - I think you may find a number of people here who are looking to algorithms precisely because they doubt (on a relative basis when compared to an algorithm) their own ability to make the sorts of subjective decisions you&#39;re referencing more consistently and correctly than an algorithm can.  I certainly count myself as a member of that group.  O&#39;Shaughnessy&#39;s &quot;What Works On Wall Street&quot; has a great summary of some literature on this topic (Chapter 2).  He references a number of examples in scientific literature that suggest rules-based statistical models represent an upper bound on what humans can accomplish and that the addition of subjective reasoning to the models worsens performance consistently.  That said, I&#39;m sure there are thousands of examples of where the opposite is true.</p>

<p>Alex - seems to me that the only asset allocation algorithms which have not underperformed in the last 2 years are the ones which somehow decided to go 100% long SPY at just the right moment.  I haven&#39;t seen one of those which doesn&#39;t also have max drawdowns in the 20s or more.  I wonder what we will say about today&#39;s &quot;underperformers&quot; after the next market correction.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54fdbc0aa2d6f15778000579' id='54fdbc0aa2d6f15778000579'>
<a href='#54fdbc0aa2d6f15778000579'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e3ca9721b31908a5000056'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a839509d8de958403d71c3459198fa2b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e3ca9721b31908a5000056'>Stephen Harlin, MD</a>
</div>
<a UTCms='1425914893000' class='quanto-date posted-at response-posted-at' href='#54fdbc0aa2d6f15778000579'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Matt,</p>

<p>Oh, for sure.  Understand.  (Try Red Bull?)  </p>

<p>Algorithmic trading systems have been shown to significantly outperform common forecasting methods.  Algorithms tend not to hold onto losing trades nor hold winning trades until they move adversely.  My sense, however, is that measures such as non-block institutional money flows, implied correlation, and implied volatility provide objective (not subjective) support to decision-making.  My read on the financial academic literature leaves me thinking that intelligent human decision-making <strong>plus</strong> machine decision support holds the key to superior returns.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54fdc471d2afa5f69d000005' id='54fdc471d2afa5f69d000005'>
<a href='#54fdc471d2afa5f69d000005'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/53d46cdb75f57a2832005a6b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/62b39881ee19f936224017339779d9d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/53d46cdb75f57a2832005a6b'>Market Tech</a>
</div>
<a UTCms='1425917045000' class='quanto-date posted-at response-posted-at' href='#54fdc471d2afa5f69d000005'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>All, I&#39;ve stumbled through the myriad blog posts on this topic and have yet to find a comprehensive strategy definition outlined in either english or pseudo code. Does one exist? It seems that the logic is stretched over half a dozen posts yet none are fully explanatory.</p>

<blockquote>
<p>BUY RULE: Long position if current price &gt;= 0.75 percentile of [60, 120, 180, 252] days channel</p>
</blockquote>

<p>What exactly is the formula for a &quot;channel&quot;? A Donchian channel is assumed, what is the english representation of the formula for said channel?</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54fdd083d2afa5813900004a' id='54fdd083d2afa5813900004a'>
<a href='#54fdd083d2afa5813900004a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/531a7ad9f7959609d10001a1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9f693e5aa9a2f5b71910425fbf1813e1?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/531a7ad9f7959609d10001a1'>Florent Chandelier</a>
</div>
<a UTCms='1425920134000' class='quanto-date posted-at response-posted-at' href='#54fdd083d2afa5813900004a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Well, the objective of this post was: <strong>The attached algorithm is an adaptation of a recent tactical asset allocation portfolio from David Varadi @ CSSAnalytics</strong><br>
And I believe Alex is doing a wonderful job at it, sharing his code and updating it accordingly.</p>

<p>The rest should be in a different post to keep things tight and focused .. and most specifically with clearly defined rules to follow and implement. No magic, only hard boring and systematic rules.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54fdd4f74c8cbbe188000085' id='54fdd4f74c8cbbe188000085'>
<a href='#54fdd4f74c8cbbe188000085'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e3ca9721b31908a5000056'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a839509d8de958403d71c3459198fa2b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e3ca9721b31908a5000056'>Stephen Harlin, MD</a>
</div>
<a UTCms='1425921273000' class='quanto-date posted-at response-posted-at' href='#54fdd4f74c8cbbe188000085'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Touche!  I&#39;ll shut up.  Agree Alex is doing an awesome job on the algo.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54fe9e8ac46d17cae80004ec' id='54fe9e8ac46d17cae80004ec'>
<a href='#54fe9e8ac46d17cae80004ec'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54190a3694339e5d3a0000af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0ce35c636f83b2ccc10b4234b9e6748d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54190a3694339e5d3a0000af'>Alex</a>
</div>
<a UTCms='1425972876000' class='quanto-date posted-at response-posted-at' href='#54fe9e8ac46d17cae80004ec'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>This thread sparked some great discussion indeed. I&#39;m glad it&#39;s inspiring. I hope The Q reworks their &quot;forum&quot; soon to accommodate algos and these sorts of related threads.</p>

<p>@Stephen, Swapping out assets is straight forward. I&#39;d be glad to see a backtest with these kinds of systematically chosen asset classes.</p>

<p>@Market Tech, the &quot;channels&quot; are the X past closing prices of an asset for X = [60, 120, 180, 252] days. Take the 0.25 and 0.75 quantiles of these prices and compare them to today&#39;s close.</p>

<p>Here&#39;s the current state of the implementation. Except for adjusted close prices, everything is there. Happy hacking.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54fed6370b113cf5c80004d4' id='54fed6370b113cf5c80004d4'>
<a href='#54fed6370b113cf5c80004d4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/531a7ad9f7959609d10001a1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9f693e5aa9a2f5b71910425fbf1813e1?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/531a7ad9f7959609d10001a1'>Florent Chandelier</a>
</div>
<a UTCms='1425987130000' class='quanto-date posted-at response-posted-at' href='#54fed6370b113cf5c80004d4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Alex,<br>
I&#39;m just getting warmed up with this strategy, checking here and there if it&#39;s worth incorporating into my portfolio. I did not check your code yet.<br>
Nonetheless, I believe the current code does not represent the original strategy, neither in terms of returns, nor in terms of drawdown - and the interest in this strategy for me is a CAGR &gt;10 for a max DD &lt; 6 over 20yrs.</p>

<p>Using: VTI, ICF, LQD, DBC, cash = SHY</p>

<p>___original | current<br>
Max DD    |       6            |              18</p>

<p>Annual Returns<br>
2006    |     12        |               13<br>
2007    |     5          |               11<br>
2008    |     10           |              17<br>
2009   |      13          |              31<br>
2010   |     14          |                 20<br>
2011    |     12         |               7<br>
2012    |     8          |                0<br>
2013   |      7          |              14<br>
2014    |      7         |             11</p>

<p>What led me to look at this was the fact that the current implementation has flat periods, that are not reflected in the original strategy.</p>

<p>I will probably get back to this as I&#39;d like to see the impact on the CAGR/MaxxDD pair if using a leverage of 2, and hedging on SPY by shorting TMV (or shorting SPXS instead of being long SPY)</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54fefab71107067d2a00021c' id='54fefab71107067d2a00021c'>
<a href='#54fefab71107067d2a00021c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e3ca9721b31908a5000056'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a839509d8de958403d71c3459198fa2b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e3ca9721b31908a5000056'>Stephen Harlin, MD</a>
</div>
<a UTCms='1425996473000' class='quanto-date posted-at response-posted-at' href='#54fefab71107067d2a00021c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Alex  Greatly appreciated.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58c941b625ba567ecaf47675' id='58c941b625ba567ecaf47675'>
<a href='#58c941b625ba567ecaf47675'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51dda99861406be3ed000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f8b2bd25cb49c26ebb20282e16df66eb?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51dda99861406be3ed000001'>Martin Clasen</a>
</div>
<a UTCms='1489584566000' class='quanto-date posted-at response-posted-at' href='#58c941b625ba567ecaf47675'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I think that this algorithm is great!</p>

<p>It would be interesting to see how you can use the same criteria as filters in Pipeline.<br>
Updated version attached.</p>

<p>Best,  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/cssanalytics-a-simple-tactical-asset-allocation-portfolio-with-percentile-channels'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/cssanalytics-a-simple-tactical-asset-allocation-portfolio-with-percentile-channels'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#d9bfbcbcbdbbb8bab299a8acb8b7adb6a9b0b8b7f7bab6b4">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
Ernie Chan&#39;s EWA/EWC pair trade with Kalman filter
</title>
<meta content='This strategy is taken from Example 3.3 in Ernie Chan&#39;s book,  Algorithmic Trading: Winning Strategies and Their Rationale . It&#39;s been posted  here  previously but that used constants for the linear regression coefficients. In this case, a Kalman filter is used to dynamically update the linear regression coefficients between the EWA and EWC ETFs. It performs well up to 2009 but after that the performance degrades.' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="mvfPiZpfFgi5i0lAi5ViHIftTFPLQAcEKz6Hy6ek/6vmkbnEOKnE6wCWEHHEespov2NvOrGMEh+pMVyhDeGdEA==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/ernie-chans-ewa-slash-ewc-pair-trade-with-kalman-filter' property='og:url'>
<meta content='Ernie Chan&#39;s EWA/EWC pair trade with Kalman filter' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/ernie-chans-ewa-slash-ewc-pair-trade-with-kalman-filter' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='Ernie Chan&#39;s EWA/EWC pair trade with Kalman filter' property='og:title'>
<meta content='This strategy is taken from Example 3.3 in Ernie Chan&#39;s book,  Algorithmic Trading: Winning Strategies and Their Rationale . It&#39;s been posted  here  previously but that used constants for the linear regression coefficients. In this case, a Kalman filter is used to dynamically update the linear regression coefficients between the EWA and EWC ETFs. It performs well up to 2009 but after that the performance degrades.' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/ernie-chans-ewa-slash-ewc-pair-trade-with-kalman-filter">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='53116887e437e855040000aa'>
<div class='post-container' data-post-id='53116887e437e855040000aa' id='53116887e437e855040000aa'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>Ernie Chan&#39;s EWA/EWC pair trade with Kalman filter</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9283fb2eb000200015b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fd495584fba0d660ede58a26a676f2d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9283fb2eb000200015b'>Aidan O&#39;Mahony</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1393649799000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=Ernie Chan&#39;s EWA/EWC pair trade with Kalman filter&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fernie-chans-ewa-slash-ewc-pair-trade-with-kalman-filter%3Futm_source%3Dwebsite_share%26utm_campaign%3Dernie-chans-ewa-slash-ewc-pair-trade-with-kalman-filter%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fernie-chans-ewa-slash-ewc-pair-trade-with-kalman-filter%3Futm_source%3Dwebsite_share%26utm_campaign%3Dernie-chans-ewa-slash-ewc-pair-trade-with-kalman-filter%26utm_medium%3Dlinkedin&amp;title=Ernie+Chan%27s+EWA%2FEWC+pair+trade+with+Kalman+filter+%28Aidan+O%27Mahony%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class='tags tag-row'>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Finance Theory' data-tag-id='55c50e7d8d4710ec6e000002' href='/posts/tag/Finance-Theory/newest'>Finance Theory</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Papers' data-tag-id='55c50e7d8d4710ec6e000007' href='/posts/tag/Papers/newest'>Papers</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Show Q' data-tag-id='55c50e7d8d4710ec6e000010' href='/posts/tag/Show-Q/newest'>Show Q</a>
</div>
<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/ernie-chans-ewa-slash-ewc-pair-trade-with-kalman-filter?utm_source=website_share&amp;utm_campaign=ernie-chans-ewa-slash-ewc-pair-trade-with-kalman-filter&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Aidan O&#39;Mahony" />
<div class='body-text'>
<div class='body-text-container post-body'><p>This strategy is taken from Example 3.3 in Ernie Chan&#39;s book, <a href="http://www.amazon.com/Algorithmic-Trading-Winning-Strategies-Rationale/dp/1118460146">Algorithmic Trading: Winning Strategies and Their Rationale</a>. It&#39;s been posted <a href="https://www.quantopian.com/posts/ernie-chans-ewa-slash-ewc-pair-trading">here</a> previously but that used constants for the linear regression coefficients.</p>

<p>In this case, a Kalman filter is used to dynamically update the linear regression coefficients between the EWA and EWC ETFs. It performs well up to 2009 but after that the performance degrades.</p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>40 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='5311bdccbce3c49d45000127' id='5311bdccbce3c49d45000127'>
<a href='#5311bdccbce3c49d45000127'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530db036ff0da19ab9000253'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4b4da70bef68f9e309c46e2661d4eeb8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530db036ff0da19ab9000253'>Jason Swearingen</a>
</div>
<a UTCms='1393671629000' class='quanto-date posted-at response-posted-at' href='#5311bdccbce3c49d45000127'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>cool, thanks for this example.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5312fea4ff40ec7caa00011c' id='5312fea4ff40ec7caa00011c'>
<a href='#5312fea4ff40ec7caa00011c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9283fb2eb000200015b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fd495584fba0d660ede58a26a676f2d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9283fb2eb000200015b'>Aidan O&#39;Mahony</a>
</div>
<a UTCms='1393753766000' class='quanto-date posted-at response-posted-at' href='#5312fea4ff40ec7caa00011c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The Kalman filter is very powerful once you grasp how it works. If you&#39;re doing offline work, check out the <a href="http://pykalman.github.io/">pykalman</a> module. The order weighting idea is nice, I hadn&#39;t thought of that.</p>

<p>Is there a reason you only rebalance weekly? You can reduce the trading frequency by reducing the transition covariance (delta) and increasing the observation covariance (Ve). This has the effect of slowing down the rate at which the regression coefficients change.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5313d995b4fd171960000198' id='5313d995b4fd171960000198'>
<a href='#5313d995b4fd171960000198'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1393809815000' class='quanto-date posted-at response-posted-at' href='#5313d995b4fd171960000198'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Anyone know if the kalman filter can be extended to more than two securities where the dependent and independent variables are no so clear?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5313e796bc4badbde2000078' id='5313e796bc4badbde2000078'>
<a href='#5313e796bc4badbde2000078'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9283fb2eb000200015b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fd495584fba0d660ede58a26a676f2d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9283fb2eb000200015b'>Aidan O&#39;Mahony</a>
</div>
<a UTCms='1393813400000' class='quanto-date posted-at response-posted-at' href='#5313e796bc4badbde2000078'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Simon, it&#39;s easy to extend to n-dimensional linear regression by increasing the dimensions of the observation matrix for the Kalman filter (variable x in the algo). This backtest does a regression between SPY and the sector ETF&#39;s XLE,  XLF and XLI.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53140888a2bfbdbd610000b9' id='53140888a2bfbdbd610000b9'>
<a href='#53140888a2bfbdbd610000b9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/524c5c27f12db56c5e00004e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ad9fd24211bfdde17bbb79907e6dcbb2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/524c5c27f12db56c5e00004e'>Kyu P</a>
</div>
<a UTCms='1393821834000' class='quanto-date posted-at response-posted-at' href='#53140888a2bfbdbd610000b9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Aidan,</p>

<p>First, thank you for your great work. I was going to explore this Kalman Filter algorithm before you posted. You helped me and many people here. </p>

<p>Second, for most pair trading algos, we need to test cointegration of the pair by using mostly either ADF or Johansen test. In this example, EWA-EWC pair is tested with Johansen test and it showed that the pair has good eigenvector. Is there any way that a pair trading algo includes one of these tests and gives us a confirmation if the pair is good or not before it runs? </p>

<p>Third, going a little bit further, is there any way for an algo to search the best pair by using those tests, pick right pair(s) and run with Kalman Filter algo?</p>

<p>Lastly, I&#39;m wondering why EWA-EWC pair model orders same shares for long and short. Does it already include <strong><em>risk adjusted</em></strong> factors? What if I set a pair that has very best eigenvectors but the price ratio and beta is too high? In this case, ordering same shares for long/short does not make any sense. How does Kalman Filter pair model work regarding <strong><em>risk adjustment</em></strong>?</p>

<p>Thank you.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53140ff7bde18b94770000db' id='53140ff7bde18b94770000db'>
<a href='#53140ff7bde18b94770000db'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9283fb2eb000200015b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fd495584fba0d660ede58a26a676f2d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9283fb2eb000200015b'>Aidan O&#39;Mahony</a>
</div>
<a UTCms='1393823737000' class='quanto-date posted-at response-posted-at' href='#53140ff7bde18b94770000db'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>Is there any way that a pair trading algo includes one of these tests and gives us a confirmation if the pair is good or not before it runs?</p>
</blockquote>

<p>You could use the <a href="http://statsmodels.sourceforge.net/stable/generated/statsmodels.tsa.stattools.adfuller.html#statsmodels.tsa.stattools.adfuller">adfuller</a> function in the statsmodels package to test for cointegration. In my experience, a good Dickey-Fuller test statistic does not necessarily imply a profitable pair for trading. AFAIK, the Johansen test is not available in any public python library but there is an <a href="https://github.com/statsmodels/statsmodels/issues/448">open issue</a> to include it in statsmodels.</p>

<blockquote>
<p>is there any way for an algo to search the best pair by using those tests, pick right pair(s) and run with Kalman Filter algo?</p>
</blockquote>

<p>Finding good pairs for trading is a difficult and computationally expensive problem. Have a look at Simon&#39;s thread, <a href="https://www.quantopian.com/posts/grid-searching-for-profitable-cointegrating-portfolios">Grid-searching for profitable cointegrating portfolios</a>, for a good discussion on this.</p>

<blockquote>
<p>I&#39;m wondering why EWA-EWC pair model orders same shares for long and short</p>
</blockquote>

<p>It doesn&#39;t order the same number of shares for long and short. If we are going &quot;long&quot; on the EWA/EWC spread, we buy X amount of shares in EWC and we sell beta * X of shares in EWA. This is a hedged position and we are never long and short on the spread at the same time.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53141358bde18beba00000cf' id='53141358bde18beba00000cf'>
<a href='#53141358bde18beba00000cf'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/524c5c27f12db56c5e00004e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ad9fd24211bfdde17bbb79907e6dcbb2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/524c5c27f12db56c5e00004e'>Kyu P</a>
</div>
<a UTCms='1393824602000' class='quanto-date posted-at response-posted-at' href='#53141358bde18beba00000cf'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Aidan, </p>

<p>Oooops...Right, it was not same shares. </p>

<p>Thank you. I will look up adfuller function and Simon&#39;s thread.</p>

<p>Yes, finding right pairs is very difficult. Even this Kalman filter algo does not work with some other pairs. I guess we need to work more and harder. </p>

<p>Again,thank you for the great work.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='531645949b8fb7c1d4000196' id='531645949b8fb7c1d4000196'>
<a href='#531645949b8fb7c1d4000196'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1393968534000' class='quanto-date posted-at response-posted-at' href='#531645949b8fb7c1d4000196'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Aidan - my point was that even with a Kalman filter, one must decide a priori which variable is the dependent variable and which are independent regressors.  In a basket situation, this seems nonsensical?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5317cdb334f55f101f000156' id='5317cdb334f55f101f000156'>
<a href='#5317cdb334f55f101f000156'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530d253c6ce7f6278b0001fe'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/623e4f44f3310cad6e47ac3415c57a3d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530d253c6ce7f6278b0001fe'>Eric Laspe</a>
</div>
<a UTCms='1394068916000' class='quanto-date posted-at response-posted-at' href='#5317cdb334f55f101f000156'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The Kalman filter works under the assumptions that you have a prediction function good at approximating the behavior of the phenomenon you&#39;re trying to track and that the error in the output of that function is normally distributed.  In simulations of physical phenomena this works out well, because you know that a missile you&#39;re trying to shoot with a laser, for example, will not suddenly turn left 90 degrees.  Physical laws limit the possible next states of that missile to a pretty small range of values.</p>

<p>Markets on the other hand, can turn 180 degrees without notice and there is no physical momentum to make tracking them tractable.  Maybe I&#39;m missing something, but I don&#39;t see why a Kalman filter should do well.</p>

<p>A particle filter would at least improve the situation by removing the assumption about linear behavior.  Thoughts?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5317d76e83b6502e4400015c' id='5317d76e83b6502e4400015c'>
<a href='#5317d76e83b6502e4400015c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530db036ff0da19ab9000253'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4b4da70bef68f9e309c46e2661d4eeb8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530db036ff0da19ab9000253'>Jason Swearingen</a>
</div>
<a UTCms='1394071408000' class='quanto-date posted-at response-posted-at' href='#5317d76e83b6502e4400015c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>i read through the description on wikipedia:   <a href="http://en.wikipedia.org/wiki/Kalman_filter">http://en.wikipedia.org/wiki/Kalman_filter</a></p>

<p>While I don&#39;t consider myself a data scientist, I have done the modeling (programming) for some.  Regarding it&#39;s apparent success for this example, to me this looks to just be a &quot;black box&quot; who&#39;s end result is to average the trends, and give you a predictor of the next timestep.   I&#39;m not saying that&#39;s all it is, but for those (like me) who don&#39;t fully understand the math behind the algorithm, that&#39;s what it is.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5317d7d2289d344f25000142' id='5317d7d2289d344f25000142'>
<a href='#5317d7d2289d344f25000142'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530db036ff0da19ab9000253'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4b4da70bef68f9e309c46e2661d4eeb8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530db036ff0da19ab9000253'>Jason Swearingen</a>
</div>
<a UTCms='1394071508000' class='quanto-date posted-at response-posted-at' href='#5317d7d2289d344f25000142'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>oh also,  you don&#39;t need a separate &quot;dependent&quot; variable.   just one input stream, that&#39;s predicting the next value of itself.</p>

<p>edit: at least that&#39;s what the kalman filter as described on wikipedia is about.   I didn&#39;t look at the implementation that Aidan gave.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5317d82d34f55f4150000130' id='5317d82d34f55f4150000130'>
<a href='#5317d82d34f55f4150000130'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9283fb2eb000200015b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fd495584fba0d660ede58a26a676f2d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9283fb2eb000200015b'>Aidan O&#39;Mahony</a>
</div>
<a UTCms='1394071599000' class='quanto-date posted-at response-posted-at' href='#5317d82d34f55f4150000130'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Simon, you&#39;re right, this isn&#39;t a scientific experiment and it&#39;s not obvious which asset to use as the dependent variable. The important question is does it really matter which asset we choose to be dependent? In my own tests, I&#39;ve found it doesn&#39;t make a lot of difference to the end result. As a rule of thumb, I choose the dependent variable that gives the largest value of the cointegration coefficient, which implies the asset with the lower volatility is independent.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5317ebeb755b2bdaca0001bf' id='5317ebeb755b2bdaca0001bf'>
<a href='#5317ebeb755b2bdaca0001bf'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9283fb2eb000200015b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fd495584fba0d660ede58a26a676f2d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9283fb2eb000200015b'>Aidan O&#39;Mahony</a>
</div>
<a UTCms='1394076652000' class='quanto-date posted-at response-posted-at' href='#5317ebeb755b2bdaca0001bf'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Eric and @Jason, there is reasoning behind using a Kalman filter for this application!</p>

<p>First, let&#39;s look at what we are trying to achieve. We want to construct a stationary time-series (spread) from two individually non-stationary time-series (EWA and EWC). Let&#39;s assume there exists a parameter (beta or cointegration coefficient) such that the residual from the linear combination of the non-stationary time-series is stationary and we can use the resulting stationary series to generate trading signals. In a perfect world, beta would be constant and our job would be done. </p>

<p>Our problem now is that beta is not constant and changes gradually (assuming the series stay cointegrated) over time. To use a Kalman filter, we need to formulate an observation and transition equation. The observation equation is the linear combination of the non-stationary time-series plus Gaussian white noise. This is really just a linear regression of EWA and EWC. The transition equation assumes that beta is equal the previous beta plus Gaussian white noise.  This is a random walk.</p>

<p>Using more complex non-linear models probably won&#39;t improve things, as Ernie Chan <a href="http://epchan.blogspot.com.au/2011/04/many-facets-of-linear-regression.html">said</a> on non-linear models &quot;experiences showed me that nonlinear models have mostly been unmitigated disasters in terms of trading profits&quot; and &quot;One is almost certain to overfit a nonlinear model to non-recurring noise&quot;.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5317fc0b34f55f415000016b' id='5317fc0b34f55f415000016b'>
<a href='#5317fc0b34f55f415000016b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9283fb2eb000200015b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fd495584fba0d660ede58a26a676f2d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9283fb2eb000200015b'>Aidan O&#39;Mahony</a>
</div>
<a UTCms='1394080781000' class='quanto-date posted-at response-posted-at' href='#5317fc0b34f55f415000016b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>haha, thanks mate :)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53338c6cc18291076c0002e8' id='53338c6cc18291076c0002e8'>
<a href='#53338c6cc18291076c0002e8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530db036ff0da19ab9000253'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4b4da70bef68f9e309c46e2661d4eeb8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530db036ff0da19ab9000253'>Jason Swearingen</a>
</div>
<a UTCms='1395887214000' class='quanto-date posted-at response-posted-at' href='#53338c6cc18291076c0002e8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>i just got a copy of Ernie Chan&#39;s book, so looking forward to reading about this in detail :)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='534a7b84b39937227e007f19' id='534a7b84b39937227e007f19'>
<a href='#534a7b84b39937227e007f19'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5100ebb31a05d29c11000401'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ac26ad1b04385fb339c6e8f643924b33?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5100ebb31a05d29c11000401'>Chris Faulkner</a>
</div>
<a UTCms='1397390214000' class='quanto-date posted-at response-posted-at' href='#534a7b84b39937227e007f19'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks for posting this.  I haven&#39;t made it through Ernie&#39;s second book yet, but I&#39;m curious why anyone would use this strategy given that it does horribly as soon as you factor in slippage and commissions.  Even with 10 times as much capital it still loses money.</p>

<p>I&#39;m new to trading, so it&#39;s likely I&#39;m misunderstanding something here.  Can someone explain when this strategy (or similar pair trading strategies) would make sense?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='534c89971494508a33000071' id='534c89971494508a33000071'>
<a href='#534c89971494508a33000071'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9283fb2eb000200015b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fd495584fba0d660ede58a26a676f2d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9283fb2eb000200015b'>Aidan O&#39;Mahony</a>
</div>
<a UTCms='1397524889000' class='quanto-date posted-at response-posted-at' href='#534c89971494508a33000071'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Using the current setup of the algo, it trades frequently, almost every day, and the profit from each trade is not sufficient to cover transaction costs. It trades frequently because the Kalman filter responds quickly to changes in the EWA/EWC spread. Reducing the sensitivity of the Kalman filter will decrease trading frequency and only trade larger deviations in the spread, which will increase the expected payoff. To answer your question, it only makes sense to use this strategy, or any other strategy, when the expected payoff of a trade is greater than transaction costs.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53a4171b7daba44b2b0001d2' id='53a4171b7daba44b2b0001d2'>
<a href='#53a4171b7daba44b2b0001d2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5369480afece9e06440000f6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/dcd0b541f001f31682943040158f7c7a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5369480afece9e06440000f6'>Bob Schmidt</a>
</div>
<a UTCms='1403262749000' class='quanto-date posted-at response-posted-at' href='#53a4171b7daba44b2b0001d2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Paul,</p>

<p>Here is a complete stab in the dark:</p>

<p>ewashares=context.portfolio.positions[context.ewa].amount  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='546ca0a7970c2467a000032e' id='546ca0a7970c2467a000032e'>
<a href='#546ca0a7970c2467a000032e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/545f82dd74b08e2cb8006aeb'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7af439423a0e7349b7362305e21d8ae7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/545f82dd74b08e2cb8006aeb'>Karel Vavra</a>
</div>
<a UTCms='1416405161000' class='quanto-date posted-at response-posted-at' href='#546ca0a7970c2467a000032e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello,<br>
I wanted to ask what is the meaning of this line:</p>

<pre><code>if e &lt; 5:  
            record(spread=float(e), Q_upper=float(sqrt_Q), Q_lower=float(-sqrt_Q))  
</code></pre>

<p>Why don&#39;t you want to plot values where the spread is &gt;=5?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='546e7379877aa3de8300017f' id='546e7379877aa3de8300017f'>
<a href='#546e7379877aa3de8300017f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9283fb2eb000200015b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fd495584fba0d660ede58a26a676f2d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9283fb2eb000200015b'>Aidan O&#39;Mahony</a>
</div>
<a UTCms='1416524667000' class='quanto-date posted-at response-posted-at' href='#546e7379877aa3de8300017f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Karel,</p>

<p>I can&#39;t remember exactly why I did that. It was something to do with keeping the y-scale on the record graph output small so it&#39;s easier to see. It won&#39;t have any effect on the results if you remove it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='546e7c60fbaa5bc8f8000003' id='546e7c60fbaa5bc8f8000003'>
<a href='#546e7c60fbaa5bc8f8000003'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/545f82dd74b08e2cb8006aeb'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7af439423a0e7349b7362305e21d8ae7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/545f82dd74b08e2cb8006aeb'>Karel Vavra</a>
</div>
<a UTCms='1416526947000' class='quanto-date posted-at response-posted-at' href='#546e7c60fbaa5bc8f8000003'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Yes, I have cloned the algorithm and found out already. It is only there to filter out initial extremes from the graph output. Thanks.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='547fa0e82047b0366200000f' id='547fa0e82047b0366200000f'>
<a href='#547fa0e82047b0366200000f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/545f82dd74b08e2cb8006aeb'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7af439423a0e7349b7362305e21d8ae7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/545f82dd74b08e2cb8006aeb'>Karel Vavra</a>
</div>
<a UTCms='1417650411000' class='quanto-date posted-at response-posted-at' href='#547fa0e82047b0366200000f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I can see one issue when trying to use Kalman filter for trading - the infinite memory. I just tried to include more samples preceding the backtest start date - it still affects the prediction of beta/alpha even when I use thousands of samples (no convergence). I think for trading application, the actual Kalman filter implementation should be more biased on recent data and be able to &quot;forget&quot; about data from ancient past. Of course, you can set the &quot;pre-train&quot; phase length to some arbitrary value, but to which one?</p>

<p>There are some implementations like this discussed (for instance, search for Adaptive Fading Kalman Filter). Does anyone have experiences with these modifications?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5503c34ab1e3ab923a000387' id='5503c34ab1e3ab923a000387'>
<a href='#5503c34ab1e3ab923a000387'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5496e261a078b2b47e0001ef'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7e0d72c23faf092744c7b536e18c3eae?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5496e261a078b2b47e0001ef'>Bill Wu</a>
</div>
<a UTCms='1426309965000' class='quanto-date posted-at response-posted-at' href='#5503c34ab1e3ab923a000387'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>How would I change the algorithm for daily trading?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5728e343fbee3c8dcf000156' id='5728e343fbee3c8dcf000156'>
<a href='#5728e343fbee3c8dcf000156'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ffdf310387751018000145'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/05361b0d9f679c541fe898c561a995ed?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ffdf310387751018000145'>Peter Ho</a>
</div>
<a UTCms='1462297417000' class='quanto-date posted-at response-posted-at' href='#5728e343fbee3c8dcf000156'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Is there a reason that orders only take place in the last 5 minutes of the trading day?</p>

<p>Also, when you run a full backtest and look at the transaction details, there are sometimes multiple orders on the same day. For example, on 5-03-06, there were the following order: -1137 EWA, -1125 EWA, +1000 EWC, and +1000 EWC. Why are there multiple orders on the same day?</p>

<p>On 4-26-06, there was only one order: -1000 EWC. Why was there only one order and no corresponding pairs trade, i.e. +EWA?</p>

<p>Thanks for sharing the algorithm and answering questions.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='572af11e92fccb2ded00068b' id='572af11e92fccb2ded00068b'>
<a href='#572af11e92fccb2ded00068b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9283fb2eb000200015b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fd495584fba0d660ede58a26a676f2d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9283fb2eb000200015b'>Aidan O&#39;Mahony</a>
</div>
<a UTCms='1462432036000' class='quanto-date posted-at response-posted-at' href='#572af11e92fccb2ded00068b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>Is there a reason that orders only take place in the last 5 minutes of the trading day?</p>
</blockquote>

<p>Ernie Chan&#39;s original algo runs on daily close data so to replicate that on Quantopian I used the close price at 3.55PM to update the Kalman filter and allow 5 minutes before market close for any orders to fill.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='573259e18420bf994c000366' id='573259e18420bf994c000366'>
<a href='#573259e18420bf994c000366'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ffdf310387751018000145'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/05361b0d9f679c541fe898c561a995ed?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ffdf310387751018000145'>Peter Ho</a>
</div>
<a UTCms='1462917605000' class='quanto-date posted-at response-posted-at' href='#573259e18420bf994c000366'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thank you very much for your response.</p>

<p>Changing the time that orders take place by 15-30 minutes can significantly change the results of a backtest (for example, changing from 3:55 pm to 3:30 pm). Why does this happen? Is there an ideal time to execute trades? Thanks.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5732779f8420bf994c00045a' id='5732779f8420bf994c00045a'>
<a href='#5732779f8420bf994c00045a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9283fb2eb000200015b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fd495584fba0d660ede58a26a676f2d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9283fb2eb000200015b'>Aidan O&#39;Mahony</a>
</div>
<a UTCms='1462925220000' class='quanto-date posted-at response-posted-at' href='#5732779f8420bf994c00045a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>Why does this happen? Is there an ideal time to execute trades?</p>
</blockquote>

<p>I&#39;m not certain of the reason but if I had to guess I would say that arbitrage algo&#39;s perform better with increasing volatility and, in general, volatility is higher around market open and market close. I&#39;m not sure if there is an &quot;ideal time&quot; to execute trades, it really depends on what you&#39;re trying to exploit.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='574c3c985325277b26000871' id='574c3c985325277b26000871'>
<a href='#574c3c985325277b26000871'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55ae55e7a366c9797200051b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a3207230c58d6fd1c4c484219ea4bf89?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55ae55e7a366c9797200051b'>paultant</a>
</div>
<a UTCms='1464614045000' class='quanto-date posted-at response-posted-at' href='#574c3c985325277b26000871'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>How is the entry and exit points chosen? A short position is opened when e&gt;sqrt(Q). Then we should wait for e to decrease. But the we just exit when e revert to sqrt(Q) again. Why is it?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a57ee6619ddd74cd8ffef9' id='58a57ee6619ddd74cd8ffef9'>
<a href='#58a57ee6619ddd74cd8ffef9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/552bc2f4e1fc73d2220003cd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ec94c6ecd68dcc3233cf80922917b88a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/552bc2f4e1fc73d2220003cd'>Irving  Lo</a>
</div>
<a UTCms='1487240934000' class='quanto-date posted-at response-posted-at' href='#58a57ee6619ddd74cd8ffef9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>How come the transaction always start with one leg instead of two legs?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a6cf05ebeb746307dc3ab6' id='58a6cf05ebeb746307dc3ab6'>
<a href='#58a6cf05ebeb746307dc3ab6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57f62b7bdbf17e2f0100025c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/cce33dd40734ebedffadbaed6eb3c77e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57f62b7bdbf17e2f0100025c'>Nikhil Sehgal</a>
</div>
<a UTCms='1487326981000' class='quanto-date posted-at response-posted-at' href='#58a6cf05ebeb746307dc3ab6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Why does this happen? Is there an ideal time to execute trades?</p>

<p>There is no specific ideal time to execute trades, however your thesis/analysis is based on daily close price data. Therefore, you should aim to minimise slippage against the forthcoming close price on each given day. Executing trades 15 mins before market close still subjects you to the probability of slippage against the close price on that day, but how do you decide the optimal time...maybe 5 mins before the close?..or 2 mins? Setting the execution/order as close as possible towards the close increases the probability that your order may not be filled so you will need to assess the trade off between close price-slippage/probability of execution.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58b63d4a6ed0870918d24035' id='58b63d4a6ed0870918d24035'>
<a href='#58b63d4a6ed0870918d24035'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56c0d8659be4721d560006e5'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/18fc19523910bdb5a74f560110e08801?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56c0d8659be4721d560006e5'>Sunny L</a>
</div>
<a UTCms='1488338250000' class='quanto-date posted-at response-posted-at' href='#58b63d4a6ed0870918d24035'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks for sharing Aidan. This has been so helpful along with your Kalman Filter notebook.</p>

<p>I have a question though about the initialization setup you have here. In the notebook, you assumed the measurement error to be 10, or Ve to be 100, but here you set Ve to something dramatically smaller, 0.001.  Is there a reason behind such huge discrepancy? This number can obviously change the results dramatically.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58cd7ca0e4d74c7d89dcbcc4' id='58cd7ca0e4d74c7d89dcbcc4'>
<a href='#58cd7ca0e4d74c7d89dcbcc4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5235bb05d47c3806730000d9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d3848e4bc51d6da182a3bad47189bbd4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5235bb05d47c3806730000d9'>Patzoul</a>
</div>
<a UTCms='1489861792000' class='quanto-date posted-at response-posted-at' href='#58cd7ca0e4d74c7d89dcbcc4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>When I rerun the numbers, I can get negative value for Q which result in errors when I calculate sqrt(Q). How do you manage negative Qs?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58dd88e71f0dea1c5d32d58f' id='58dd88e71f0dea1c5d32d58f'>
<a href='#58dd88e71f0dea1c5d32d58f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/552bc2f4e1fc73d2220003cd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ec94c6ecd68dcc3233cf80922917b88a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/552bc2f4e1fc73d2220003cd'>Irving  Lo</a>
</div>
<a UTCms='1490913511000' class='quanto-date posted-at response-posted-at' href='#58dd88e71f0dea1c5d32d58f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>problem solved for only one leg in the beginning.</p>

<p>However, mean reversion quality for bond product is very bad.</p>

<p>Better try on other equity or FX spreads.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='590ab88170631102a3ae5411' id='590ab88170631102a3ae5411'>
<a href='#590ab88170631102a3ae5411'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57f04e5e10b84256a3000667'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/509d406ed5ee6c618afe9c943c2f156e?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57f04e5e10b84256a3000667'>Vincent Wen</a>
</div>
<a UTCms='1493874817000' class='quanto-date posted-at response-posted-at' href='#590ab88170631102a3ae5411'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>If we are using a Kalman filter as in the the example above, would we still need to reblanace any open positions periodically to reflect the position in the latest spread as it is getting updated by the Kalman Filter?</p>

<p>(sorry but i dont seem to be able to see any rebalancing in the algorithm?)</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59420a30039a77001054a77b' id='59420a30039a77001054a77b'>
<a href='#59420a30039a77001054a77b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59035d7302c0c9000daf0e56'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f58ccfc5edcd010bf713f2577fb92afa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59035d7302c0c9000daf0e56'>Ridwan Kurniawan</a>
</div>
<a UTCms='1497500208000' class='quanto-date posted-at response-posted-at' href='#59420a30039a77001054a77b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>hi thx aidan for the nice post. It certainly helps to enlightened more about Kalman filter application. Just wonder what will be the best practice in using this Kalman filter to find the cointegrated pairs. Will following two approaches both reasonable?</p>

<ol>
<li>Testing cointegration based on simple OLS residual (spread) analysis<br></li>
<li>Testing cointegration based on new residual derived from adaptive beta state from Kalman process</li>
</ol>

<p>I&#39;ve found option 2 wasn&#39;t really appropriate since it makes an assumption on evolving state of beta which might impact the regression residual of the actual price measurement. Let me know what others think as well. Thanks  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5944af319188fe3d48a89f07' id='5944af319188fe3d48a89f07'>
<a href='#5944af319188fe3d48a89f07'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9283fb2eb000200015b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fd495584fba0d660ede58a26a676f2d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9283fb2eb000200015b'>Aidan O&#39;Mahony</a>
</div>
<a UTCms='1497673521000' class='quanto-date posted-at response-posted-at' href='#5944af319188fe3d48a89f07'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>HI Ridwan,</p>

<p>Agree with your analysis. Approach 1 is reasonable but you&#39;ll find most of the time the conitegration relationship will break down and will never revert to the mean. Approach 2 doesn&#39;t make a lot of sense as the relationship is constantly evolving.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5947775cae5fe9000dbc8f57' id='5947775cae5fe9000dbc8f57'>
<a href='#5947775cae5fe9000dbc8f57'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/59035d7302c0c9000daf0e56'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f58ccfc5edcd010bf713f2577fb92afa?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/59035d7302c0c9000daf0e56'>Ridwan Kurniawan</a>
</div>
<a UTCms='1497855836000' class='quanto-date posted-at response-posted-at' href='#5947775cae5fe9000dbc8f57'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>thx aidan. Guess i will try to combine both analysis (i.e. in sample cointegration analysis based on simple OLS to find the pairs and out sample forecast based on Kalman filter for trading signal). Do you think this approach makes sense?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='595c666c2a8d4d0010e22ab2' id='595c666c2a8d4d0010e22ab2'>
<a href='#595c666c2a8d4d0010e22ab2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57ed8f6348f895f746000361'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/229bc19890510c139544f75cf2de4279?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57ed8f6348f895f746000361'>Zhixin Zhou</a>
</div>
<a UTCms='1499227756000' class='quanto-date posted-at response-posted-at' href='#595c666c2a8d4d0010e22ab2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Are there any leverage used in this algo?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a11ed94f8d24800137cc5db' id='5a11ed94f8d24800137cc5db'>
<a href='#5a11ed94f8d24800137cc5db'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5a11ec0cf8d24800107cc5d8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d1af92f99455a2e94b6ccf8d5b6ef5fe?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5a11ec0cf8d24800107cc5d8'>Matt Sun</a>
</div>
<a UTCms='1511124372000' class='quanto-date posted-at response-posted-at' href='#5a11ed94f8d24800137cc5db'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi, I&#39;m seeking help here. While I&#39;m understanding Kalman Filter and trying to apply this algorithm in real trades, there are something I don&#39;t quite understand.</p>

<p>In the sample algorithm, the kalman filter takes one price for each symbol, and get hedge ratio, mean, standard deviation etc. So that it further decides if we can enter long/short at a moment. However, in real trades, for every tick/bar, there are bid price and short price for every symbol, so they are two values of each symbol, four values for pair trading. Then how should we use the four values to calculate trading signal?</p>

<p>Actually this question is not only about Kalman Filter, but general to any backtest program. Back test data has only one value for each time (which might be OPEN or CLOSE), but in real trades, there are lowest ask, highest bid and other order prices. Which values should we use to decide trading signal?</p>

<p>Appreciate any help!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c8f23080e028d71708c5802' id='5c8f23080e028d71708c5802'>
<a href='#5c8f23080e028d71708c5802'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5c0a3d32e4fdc72a3fea6fe6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b91581bc0630a68bf64ad7bd2e4522f1?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5c0a3d32e4fdc72a3fea6fe6'>Zheng Zuo</a>
</div>
<a UTCms='1552884488000' class='quanto-date posted-at response-posted-at' href='#5c8f23080e028d71708c5802'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Matt Sun<br>
&quot;but in real trades, there are lowest ask, highest bid and other order prices. Which values should we use to decide trading signal?&quot;</p>

<p>You can use the last traded price  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/ernie-chans-ewa-slash-ewc-pair-trade-with-kalman-filter'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/ernie-chans-ewa-slash-ewc-pair-trade-with-kalman-filter'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#6a0c0f0f0e080b09012a1b1f0b041e051a030b0444090507">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

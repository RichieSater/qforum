<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
MA cross-over w/ RSI
</title>
<meta content='I&#39;m planning to build up this algorithm, bit-by-bit here.  This is the first piece.  More details to come.  --Grant' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="gFbQ01/zQqJN7vAjIuk1jP7QiRNWAAeqA/V/xeEQjJn8MKae/QWQQfTzqRJtBp34xl6qeizMErGB+qSvS1XuIg==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/ma-cross-over-w-slash-rsi' property='og:url'>
<meta content='MA cross-over w/ RSI' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/ma-cross-over-w-slash-rsi' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='MA cross-over w/ RSI' property='og:title'>
<meta content='I&#39;m planning to build up this algorithm, bit-by-bit here.  This is the first piece.  More details to come.  --Grant' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/ma-cross-over-w-slash-rsi">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='5234a5a1dba5f899d900015f'>
<div class='post-container' data-post-id='5234a5a1dba5f899d900015f' id='5234a5a1dba5f899d900015f'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>MA cross-over w/ RSI</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1379181985000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=MA cross-over w/ RSI&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fma-cross-over-w-slash-rsi%3Futm_source%3Dwebsite_share%26utm_campaign%3Dma-cross-over-w-slash-rsi%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fma-cross-over-w-slash-rsi%3Futm_source%3Dwebsite_share%26utm_campaign%3Dma-cross-over-w-slash-rsi%26utm_medium%3Dlinkedin&amp;title=MA+cross-over+w%2F+RSI+%28Grant+Kiehne%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/ma-cross-over-w-slash-rsi?utm_source=website_share&amp;utm_campaign=ma-cross-over-w-slash-rsi&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Grant Kiehne" />
<div class='body-text'>
<div class='body-text-container post-body'><p>I&#39;m planning to build up this algorithm, bit-by-bit here.  This is the first piece.  More details to come.  --Grant  </p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>49 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='5234d257dfe89af7c7000001' id='5234d257dfe89af7c7000001'>
<a href='#5234d257dfe89af7c7000001'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1379193432000' class='quanto-date posted-at response-posted-at' href='#5234d257dfe89af7c7000001'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Grant,</p>

<p>I don&#39;t know enough numpy to interpret what you are doing. Could you explain it, please?</p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5234d5a7dfe89adb60000002' id='5234d5a7dfe89adb60000002'>
<a href='#5234d5a7dfe89adb60000002'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379194279000' class='quanto-date posted-at response-posted-at' href='#5234d5a7dfe89adb60000002'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Peter,</p>

<p>Sure.</p>

<pre><code>@batch_transform(refresh_period=R_P, window_length=W_L) # set globals R_P &amp; W_L above  
def get_avg(datapanel,sids):  
    p = np.flipud(datapanel[&#39;price&#39;].as_matrix(sids))  
    p_cumsum = np.cumsum(p,axis=0)  
    n = np.cumsum(np.ones(p_cumsum.shape),axis=0)  
    avg = np.divide(p_cumsum,n)  
    return avg  
</code></pre>

<p>The first line, p = np.flipud(datapanel[&#39;price&#39;].as_matrix(sids)), creates a numpy ndarray of prices, and flips it about a horizontal axis (&quot;up down&quot;) so that the most recent prices come first.  Then, the next line, p_cumsum = np.cumsum(p,axis=0), performs a cumulative sum over the columns.  The next line, n = np.cumsum(np.ones(p_cumsum.shape),axis=0), creates an ndarray of the denominators, required to compute the averages of each element of p_cumsum.  Finally, an elementwise division is performed to compute the averages, with avg = np.divide(p_cumsum,n).  So, what is returned is an ndarray of moving averages--columns correspond to sid, and rows correspond to the trailing window length of the average.  So, by picking row and column, as I do in handle_data, the moving averages for each sid can be compared to those computed with mavg.  In the example code, they agree, so I declare victory.</p>

<p>Just let me know if this doesn&#39;t make sense, and I&#39;ll work up a better example, with comments in the code.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5234dd5bb6b5525f6700000a' id='5234dd5bb6b5525f6700000a'>
<a href='#5234dd5bb6b5525f6700000a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1379196251000' class='quanto-date posted-at response-posted-at' href='#5234dd5bb6b5525f6700000a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Grant,</p>

<p>Thanks. I probably need to get this into iPython console to see what it&#39;s doing. So it&#39;s a minutely moving average that has the same output as mavg? Later you will apply this to other timeframes?</p>

<p>Why not use ta.MA() instead? You can&#39;t recreate all the indicators. Well...you could....but TA-Lib took Mario Fortier and his co-collaborators quite a few man-years.</p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5234e4907538474a26000016' id='5234e4907538474a26000016'>
<a href='#5234e4907538474a26000016'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379198097000' class='quanto-date posted-at response-posted-at' href='#5234e4907538474a26000016'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Peter,</p>

<p>With one call to the batch transform, I get, for each sid, a vector of moving averages, up to the window length of the batch transform.  So, for example, if I need a 15 day and a 5 day moving average, I can just select them from corresponding rows of the column vector.  ta.MA() or mavg could be used, but I like the idea of the single call to the batch transform to get the entire set of moving averages, up to a maximum window length.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='523589b8dfe89adb600000ce' id='523589b8dfe89adb600000ce'>
<a href='#523589b8dfe89adb600000ce'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379240377000' class='quanto-date posted-at response-posted-at' href='#523589b8dfe89adb600000ce'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Peter,</p>

<p>Now that I&#39;ve thought about it, it would be better to use a more flexible approach than I&#39;ve shown above to compute the moving average.  I&#39;ve started to look at <a href="http://pandas.pydata.org/pandas-docs/dev/computation.html">http://pandas.pydata.org/pandas-docs/dev/computation.html</a>, which has lots of &quot;bells and whistles&quot; including a variety of statistics, and an exponentially weighted moving average.  I&#39;ll work something up as an example and post it here.</p>

<p>I&#39;m kinda leery of using TA-Lib, since I&#39;ve yet to find any good technical documentation.  </p>

<p>Grant</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52359addb6b55218780000c4' id='52359addb6b55218780000c4'>
<a href='#52359addb6b55218780000c4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379244766000' class='quanto-date posted-at response-posted-at' href='#52359addb6b55218780000c4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s a version that uses the pandas rolling_mean to compute the averages needed for a cross-over (across multiple securities, if desired).  The code executes very slowly, despite the fact that I make only one call to the batch transform, per call to handle_data.  When I get the chance, I&#39;ll try to figure out the source of the sluggishness.  --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5235a3d97538474a2600010b' id='5235a3d97538474a2600010b'>
<a href='#5235a3d97538474a2600010b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379247071000' class='quanto-date posted-at response-posted-at' href='#5235a3d97538474a2600010b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s the pandas-based moving average w/ Apple as an example security.</p>

<p>For the RSI computation, it is not clear to me why using daily closing prices would be the best.  Wouldn&#39;t it be better to have a rolling computation, that gets updated every minute, for minutely trading?</p>

<p>I took a look at <a href="http://en.wikipedia.org/wiki/Relative_strength_index">http://en.wikipedia.org/wiki/Relative_strength_index</a> and it is not clear why the RSI couldn&#39;t be computed every minute using TA-Lib, with an appropriately chosen value of n for the exponentially weighted moving average.  In other words, the whole &quot;timeframe&quot; issue is handled by the exponential weighting, rather than by using daily closing prices.  From a practical standpoint, as Jess has pointed out, the finite memory limitation can become a problem, but if we are only talking about a handful of securities, it should be manageable.</p>

<p>Grant</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52360a157538474a2600017a' id='52360a157538474a2600017a'>
<a href='#52360a157538474a2600017a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379273241000' class='quanto-date posted-at response-posted-at' href='#52360a157538474a2600017a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s the latest installment.  I added the RSI, per the example on the help page.  I still need to code the RSI for multiple securities.</p>

<p>What would be typical buy/sell logic for such an algorithm, based on the moving averages and the RSI?  Also, would it be better to use exponentially weighted moving averages?</p>

<p>Thanks,</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5237965566561caa6a00002a' id='5237965566561caa6a00002a'>
<a href='#5237965566561caa6a00002a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379374678000' class='quanto-date posted-at response-posted-at' href='#5237965566561caa6a00002a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m trying to sort out how to get the TA-Lib RSI to return a value running on minute data, with a time period of 14 days.  The first part of the code is:</p>

<pre><code>import numpy as np  
import pandas as pd

W_L = 15  # batch transform window length, days  
windows = [5,15] # moving average windows, days

rsi = ta.RSI(timeperiod=5460) 

def initialize(context):  
    context.stocks = [sid(24)]  
def handle_data(context, data):  
    # get RSI  
    rsi_data = rsi(data)  
    rsi_0 = rsi_data[context.stocks[0]]  
</code></pre>

<p>But I get rsi_0 = 0 for the entire backtest.</p>

<p>Any idea what&#39;s going on?</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5237a09e66561c28db000033' id='5237a09e66561c28db000033'>
<a href='#5237a09e66561c28db000033'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379377311000' class='quanto-date posted-at response-posted-at' href='#5237a09e66561c28db000033'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s a more direct test.  It appears that TA-Lib RSI can&#39;t handle too much data.  If I change from timeperiod = 10 to timeperiod = 390 (1 day), I just get:</p>

<blockquote>
<p>Waiting for logs...<br>
This backtest didn&#39;t generate any logs.</p>
</blockquote>

<p>Grant</p>

<pre><code>import numpy as np  
rsi = ta.RSI(timeperiod=10)

def initialize(context):  
    context.sid = sid(8554)  
def handle_data(context, data):

    rsi_result = rsi(data)[context.sid]  
    if not np.isnan(rsi_result):  
        log.info(get_datetime())  
        log.info(rsi_result)  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5237c9922fb45683a9000087' id='5237c9922fb45683a9000087'>
<a href='#5237c9922fb45683a9000087'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1379387795000' class='quanto-date posted-at response-posted-at' href='#5237c9922fb45683a9000087'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Grant,</p>

<p>Brief inspection suggests that the timeperiod limit is 389. Using timeperiod = 5460 would be computationally very expensive anyway so I converted the minutes to days.</p>

<p>You seem to be taking each 390 minutes and computing the rolling mean for that day. I thought the The MA for those days should be computed from the closing price of the day i.e. we are not interested in the other 389 prices?</p>

<p>(EDIT: I know that&#39;s not what you are doing as it involves minutes 1950 and 5850 i.e. days 5 and 15.)</p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52382ed8bcafe060bf0000ec' id='52382ed8bcafe060bf0000ec'>
<a href='#52382ed8bcafe060bf0000ec'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379413721000' class='quanto-date posted-at response-posted-at' href='#52382ed8bcafe060bf0000ec'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Peter,</p>

<p>It turns out that there may be a problem with feeding TA-Lib RSI multiples of 390.  I just tried timeperiod=5461 and it works.  Quantopian is aware of the problem.</p>

<p>I attached my code, with timeperiod=5461.  Some form of re-sampling may be required, but my sense is that it should incorporate the full 390 minutes out of every day in a summary form (e.g. mean), rather than just the closing price.  More on that topic later...</p>

<p>Cheers,</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5238580a66561c28db000134' id='5238580a66561c28db000134'>
<a href='#5238580a66561c28db000134'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1379424268000' class='quanto-date posted-at response-posted-at' href='#5238580a66561c28db000134'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Grant,</p>

<p>I would say it&#39;s universal - and has been for many decades - that calculations on OHLC bars of any duration use the first open/last close. My TA-Lib version of your algo completes in 7 minutes 26 seconds. Your&#39;s was around 8 minutes 9 seconds without any RSI calculation. It&#39;s now around 20 minutes.</p>

<p>What happens when you want a monthly MA in a back test? There are 31,200 minutes in 4-weeks! And MA is about the simplest indicator there is in terms of computations.</p>

<p>I&#39;ve also just noticed that your RSI is very approximately in a range of 47 - 52 which is odd. Mine is around 4 to 94.</p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5238c91a2fb4561a690001e4' id='5238c91a2fb4561a690001e4'>
<a href='#5238c91a2fb4561a690001e4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379453211000' class='quanto-date posted-at response-posted-at' href='#5238c91a2fb4561a690001e4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Peter,</p>

<p>I&#39;ll have to think about what the RSI is doing (<a href="http://en.wikipedia.org/wiki/Relative_strength_index">http://en.wikipedia.org/wiki/Relative_strength_index</a>).  It appears that there is just an overall scale factor for the peak-to-peak amplitude, which depends on the number of time series data points.  However, I don&#39;t see the smoothing effect I&#39;d expect from using a lot more data.  So, perhaps using daily closing prices would work just as well...hmm...not intuitive.</p>

<p>Grant </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5238de009748ce79b2000011' id='5238de009748ce79b2000011'>
<a href='#5238de009748ce79b2000011'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379458563000' class='quanto-date posted-at response-posted-at' href='#5238de009748ce79b2000011'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Peter,</p>

<p>Here&#39;s your backtest from above, but using minute data rather than daily closings.  Interestingly, it ran just fine, even though I used whole multiples of 390 minutes for the timeperiods.  The RSI suffers from the same peak-to-peak range problem as my earlier algo.</p>

<p>Any idea how to set up the buy/sell criteria for this MA cross-over w/ RSI?  Is there a standard recipe?</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5239982d9748ce79b20000ed' id='5239982d9748ce79b20000ed'>
<a href='#5239982d9748ce79b20000ed'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1379506224000' class='quanto-date posted-at response-posted-at' href='#5239982d9748ce79b20000ed'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Grant,</p>

<p>Did you mean to attach a backtest?</p>

<p>As far as a strategy I suppose use MA to confirm an RSI signal. When RSI goes below 30 this suggests over-sold, when crossing back above 30 from below this suggests leaving over-sold area but look for confimation from the MA. Vice versa for RSI 70.</p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='523a3eb01af67024ce00004d' id='523a3eb01af67024ce00004d'>
<a href='#523a3eb01af67024ce00004d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379548851000' class='quanto-date posted-at response-posted-at' href='#523a3eb01af67024ce00004d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s the backtest that should have been attached.  Thanks for the feedback.  --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='523a47da83c4e3ef8800004d' id='523a47da83c4e3ef8800004d'>
<a href='#523a47da83c4e3ef8800004d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379551195000' class='quanto-date posted-at response-posted-at' href='#523a47da83c4e3ef8800004d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Peter,</p>

<p>Here&#39;s an approach that uses multiple timeframes--minutely closings for the moving averages and daily closings for the RSI.  I haven&#39;t yet fully sorted out and tested your pandas re-sampling line:</p>

<pre><code>daily = minutely.resample(&#39;D&#39;, closed=&#39;right&#39;, label=&#39;left&#39;).dropna()  
</code></pre>

<p>Would you mind explaining what it does?  I looked at <a href="http://pandas.pydata.org/pandas-docs/dev/generated/pandas.DataFrame.resample.html">http://pandas.pydata.org/pandas-docs/dev/generated/pandas.DataFrame.resample.html</a> and it&#39;s kinda cryptic without examples.</p>

<p>Thanks,</p>

<p>Grant</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='523a51ce83c4e3ef88000076' id='523a51ce83c4e3ef88000076'>
<a href='#523a51ce83c4e3ef88000076'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1379553746000' class='quanto-date posted-at response-posted-at' href='#523a51ce83c4e3ef88000076'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Resample is used to convert time-series data from one periodicity to another -- in this case, it looks like it&#39;s converting time-series data of around a minute per bar into daily bars.  It does this by the time/date stamps in the index, there&#39;s nothing fancy about it, but it&#39;s a tricky thing to get right in the presence of missing data, bar start/end alignments and so forth.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='523a524a44c9cb9f0800006a' id='523a524a44c9cb9f0800006a'>
<a href='#523a524a44c9cb9f0800006a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1379553867000' class='quanto-date posted-at response-posted-at' href='#523a524a44c9cb9f0800006a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Grant,</p>

<p>I&#39;m no expert! This is in iPython console:</p>

<pre><code>rng = pd.date_range(&#39;18/09/2013&#39;, periods=1440, freq=&#39;1Min&#39;)

ts = pd.Series(np.random.randn(len(rng)), index=rng)

ts  
Out[144]:  
2013-09-18 00:00:00    0.327609  
2013-09-18 00:01:00   -1.822197  
2013-09-18 00:02:00    0.171317  
2013-09-18 00:03:00    0.691429  
2013-09-18 00:04:00    0.258827  
2013-09-18 00:05:00   -0.390128  
2013-09-18 00:06:00   -0.006088  
2013-09-18 00:07:00    0.712166  
2013-09-18 00:08:00    1.270415  
2013-09-18 00:09:00   -1.599647  
2013-09-18 00:10:00    1.393080  
2013-09-18 00:11:00   -0.080025  
2013-09-18 00:12:00    0.036839  
2013-09-18 00:13:00    0.659311  
2013-09-18 00:14:00   -0.002810  
...
2013-09-18 23:45:00   -0.334146  
2013-09-18 23:46:00    0.754013  
2013-09-18 23:47:00    1.269064  
2013-09-18 23:48:00   -0.217482  
2013-09-18 23:49:00    0.626549  
2013-09-18 23:50:00    0.262481  
2013-09-18 23:51:00    0.437834  
2013-09-18 23:52:00    1.093870  
2013-09-18 23:53:00    0.899267  
2013-09-18 23:54:00    1.471195  
2013-09-18 23:55:00    0.192442  
2013-09-18 23:56:00    0.530187  
2013-09-18 23:57:00   -0.748267  
2013-09-18 23:58:00   -1.281159  
2013-09-18 23:59:00    1.114334  
Freq: T, Length: 1440, dtype: float64

ts.resample(&#39;60Min&#39;, label=&#39;left&#39;)  
Out[145]:  
2013-09-18 00:00:00    0.113956  
2013-09-18 01:00:00   -0.014518  
2013-09-18 02:00:00   -0.307613  
2013-09-18 03:00:00   -0.113483  
2013-09-18 04:00:00    0.066969  
2013-09-18 05:00:00   -0.072938  
2013-09-18 06:00:00   -0.116590  
2013-09-18 07:00:00    0.019375  
2013-09-18 08:00:00   -0.132091  
2013-09-18 09:00:00    0.008221  
2013-09-18 10:00:00    0.068405  
2013-09-18 11:00:00    0.106199  
2013-09-18 12:00:00    0.165218  
2013-09-18 13:00:00   -0.001297  
2013-09-18 14:00:00    0.025111  
2013-09-18 15:00:00   -0.120673  
2013-09-18 16:00:00   -0.002947  
2013-09-18 17:00:00    0.172615  
2013-09-18 18:00:00   -0.045660  
2013-09-18 19:00:00    0.107736  
2013-09-18 20:00:00   -0.099588  
2013-09-18 21:00:00   -0.120418  
2013-09-18 22:00:00   -0.052315  
2013-09-18 23:00:00    0.189029  
Freq: 60T, dtype: float64

ts.resample(&#39;60Min&#39;, label=&#39;right&#39;)  
Out[146]:  
2013-09-18 01:00:00    0.113956  
2013-09-18 02:00:00   -0.014518  
2013-09-18 03:00:00   -0.307613  
2013-09-18 04:00:00   -0.113483  
2013-09-18 05:00:00    0.066969  
2013-09-18 06:00:00   -0.072938  
2013-09-18 07:00:00   -0.116590  
2013-09-18 08:00:00    0.019375  
2013-09-18 09:00:00   -0.132091  
2013-09-18 10:00:00    0.008221  
2013-09-18 11:00:00    0.068405  
2013-09-18 12:00:00    0.106199  
2013-09-18 13:00:00    0.165218  
2013-09-18 14:00:00   -0.001297  
2013-09-18 15:00:00    0.025111  
2013-09-18 16:00:00   -0.120673  
2013-09-18 17:00:00   -0.002947  
2013-09-18 18:00:00    0.172615  
2013-09-18 19:00:00   -0.045660  
2013-09-18 20:00:00    0.107736  
2013-09-18 21:00:00   -0.099588  
2013-09-18 22:00:00   -0.120418  
2013-09-18 23:00:00   -0.052315  
2013-09-19 00:00:00    0.189029  
Freq: 60T, dtype: float64  
</code></pre>

<p>The first parameter is the size of the resample i.e. &#39;30Min&#39;, &#39;H&#39;, &#39;2H&#39;, &#39;D&#39;, where &#39;2H&#39; == &#39;120Min&#39;. I think upsampling is possible but I have not tried it. The &#39;closed&#39; argument works like &#39;label&#39; and specifies in which sample the boundary values are included but I&#39;m not qualified to discuss it&#39;s subleties.</p>

<p>The second example is confusing since &#39;2013-09-19 00:00:00&#39; is not strictly in the original time series but it makes sense for display purposes. It doesn&#39;t really help that &#39;60Min&#39; as an input results in &#39;60T&#39; in the output.</p>

<p>The &#39;dropna&#39; was included in case the resample decided to create periods that weren&#39;t in the Quantopian data as I was worried that minute data resampled to hourly would result in overnight hours populated with NaNs. That behaviour is very much TBC. </p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='523acea4c3cf5156640000dd' id='523acea4c3cf5156640000dd'>
<a href='#523acea4c3cf5156640000dd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379585702000' class='quanto-date posted-at response-posted-at' href='#523acea4c3cf5156640000dd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Peter,</p>

<p>I&#39;ve attempted to verify that your resampling code actually captures daily closing prices.  I added some code to record the daily closing prices, and unless I&#39;ve made a mistake, the values don&#39;t match (see the log output).  I kinda rushed though the coding, so it is possible that I made a mistake.  Any ideas?</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='523ad0791af67024ce0000f6' id='523ad0791af67024ce0000f6'>
<a href='#523ad0791af67024ce0000f6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1379586171000' class='quanto-date posted-at response-posted-at' href='#523ad0791af67024ce0000f6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Grant,</p>

<p>Thanks - I&#39;ll have a look. My first thoughts are that if you pick a day on your backtest with &#39;calculated&#39; MAs you get the same values for the MAs on that day in my backtest with the resampled data used by TA-Lib.</p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='523ad5721af670e2ee000111' id='523ad5721af670e2ee000111'>
<a href='#523ad5721af670e2ee000111'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1379587443000' class='quanto-date posted-at response-posted-at' href='#523ad5721af670e2ee000111'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Grant,</p>

<p>Also consider that batch_transform in a minutely algo has some problems. I have raised issues publicly and privately concerning this but I get little feedback.</p>

<p>Firstly, move the start date of this backtest away from 2013-01-01. On this day &quot;missing&quot; data results in a variable length DataFrame being returned by batch_transform until it catches up with the &quot;missing&quot; minutes.</p>

<p>Secondly, batch_transform initially returns one price for the first day and it then returns 390 minutely prices for each subsequent day. Until your algo addresses both of these issues your results, as well as mine, are of questionable veracity.</p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='523b06c844c9cba30c000160' id='523b06c844c9cba30c000160'>
<a href='#523b06c844c9cba30c000160'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1379600073000' class='quanto-date posted-at response-posted-at' href='#523b06c844c9cba30c000160'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Without knowing exactly how quantopian generates the minute bars and daily bars, it&#39;s unlikely that you&#39;ll ever get them to match using resample.  Arguably, if your strategy performance is materially different depending on precisely how bars are built, it&#39;s probably too fragile for actual trading anyway.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='523b1e3dac9ecf77bf000166' id='523b1e3dac9ecf77bf000166'>
<a href='#523b1e3dac9ecf77bf000166'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1379606078000' class='quanto-date posted-at response-posted-at' href='#523b1e3dac9ecf77bf000166'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Simon/Grant,</p>

<p>One issue is that DataFrame.resample() defaults to how=&#39;mean&#39; but it needs to be specified as how=&#39;last&#39; for my purposes here i.e.</p>

<pre><code>daily = minutely.resample(&#39;D&#39;, closed=&#39;right&#39;, label=&#39;left&#39;, how=&#39;last&#39;).dropna()  
</code></pre>

<p>Beyond that I&#39;m still investigating if only to enhance my limted knowledge of pandas. For example it seems how can be &#39;first&#39;, &#39;last&#39;, &#39;min&#39;, &#39;max&#39;, &#39;mean&#39; or &#39;sum&#39; but that list may not be exhaustive.</p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='523b31ab83c4e3ef880001e7' id='523b31ab83c4e3ef880001e7'>
<a href='#523b31ab83c4e3ef880001e7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/522b34d1aaaff3bcdd0000ec'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5141db3d49c417997bc084e64011a100?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/522b34d1aaaff3bcdd0000ec'>Richard Diehl</a>
</div>
<a UTCms='1379611052000' class='quanto-date posted-at response-posted-at' href='#523b31ab83c4e3ef880001e7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>For the programmers, perhaps there needs to be a rethink of how Quantopian passes data. Here is a suggestion:<br>
1. Move support from two time periods, daily and minute, to three, daily, minute, and 15minute periods These reduces the factor between periods from 390, to just over 26.<br>
2. Pass all three data frames into the algorithm, so that the user can choose which to pass. Something like CalcSMA(dailydata,20) for a 20 day moving average, or CalcSMA(minutedata,20) for a 20 minute moving average. This whole concept of choosing the timeframe of an algorithm externally is a poor design which doesn&#39;t reflect how people design trading systems.<br>
3. Update the current period of both the 15 minute and daily time frames with the current market values each minute. This allows a user to calculate exactly what stochcharts.com does, which is give the up to the minute values of larger timeframes. If you had to wait for the end of the day, no one would use stockcharts.<br>
4.Eventually, I think having your own basic indicator libraries makes sense, because you can find out  what people really use, and then optimize them. For example, if you precalculate a summary of the running totals of the closes for a stock, then an sma because a single subtraction and division, rather than a long series of additions. In this way, you can find out the time intensive ares which suck cpus, reduce server cost, and speed up the run time, which is a win for you and your customers.</p>

<p>Rich  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='523b37f944c9cba30c0001cd' id='523b37f944c9cba30c0001cd'>
<a href='#523b37f944c9cba30c0001cd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1379612667000' class='quanto-date posted-at response-posted-at' href='#523b37f944c9cba30c0001cd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Grant,</p>

<p>With my addition of how=&#39;last&#39; we do have the same daily values although your code doesn&#39;t agree!</p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='523b6bb9486d6d81c9000031' id='523b6bb9486d6d81c9000031'>
<a href='#523b6bb9486d6d81c9000031'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1379625916000' class='quanto-date posted-at response-posted-at' href='#523b6bb9486d6d81c9000031'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Rich,</p>

<p>This has the three timeframes. It looks like the indicators do update each minute - for example this is the 1D MA:</p>

<pre><code>2012-01-24 PRINT 2012-01-24 21:00:00+00:00 423.66  
2012-01-25 PRINT 2012-01-25 14:31:00+00:00 426.583  
2012-01-25 PRINT 2012-01-25 14:32:00+00:00 426.41  
2012-01-25 PRINT 2012-01-25 14:33:00+00:00 426.215  
2012-01-25 PRINT 2012-01-25 14:34:00+00:00 426.37  
2012-01-25 PRINT 2012-01-25 14:35:00+00:00 426.208  
2012-01-25 PRINT 2012-01-25 14:36:00+00:00 426.261  
2012-01-25 PRINT 2012-01-25 14:37:00+00:00 426.274  
</code></pre>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='523b93ba486d6d81c90000a0' id='523b93ba486d6d81c90000a0'>
<a href='#523b93ba486d6d81c90000a0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379636155000' class='quanto-date posted-at response-posted-at' href='#523b93ba486d6d81c90000a0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Peter,</p>

<p>I added a line to your code posted above (associated with your comment &quot;With my addition of how=&#39;last&#39; we do have the same daily values although your code doesn&#39;t agree!&quot;):</p>

<pre><code>if day != context.day_prior:  
        print &quot;Recorded: &quot;+str(context.price_prior)  
        print &quot;Resampled: &quot;+str(daily[context.stocks[0]][-1])  
        print minutely.tail(3)  
</code></pre>

<p>By inspecting the last three values of the minutely data (for the trailing window at the new day opening), I see that I capture the prior day&#39;s closing price in context.price_piror.  However, it seems that your resampling does not return the closing price from the prior day.  If I am understanding correctly, it should be daily[context.stocks[0]][-1], right?  I don&#39;t know how to fix it, but presumably whatever the Quantopian guys are working on will make it really easy to accumulate daily closing prices in a minutely backtest.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='523bc7f208146d2b9c0000b7' id='523bc7f208146d2b9c0000b7'>
<a href='#523bc7f208146d2b9c0000b7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1379649524000' class='quanto-date posted-at response-posted-at' href='#523bc7f208146d2b9c0000b7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Grant,</p>

<p>When I was playing with three timeframes above I realised that</p>

<pre><code>daily[context.stocks[0]][-1]  
</code></pre>

<p>is the last minutely price i.e.</p>

<pre><code>ts  
Out[203]:  
2013-09-18 14:31:00    1.425262  
2013-09-18 14:32:00   -0.598867  
2013-09-18 14:33:00    1.774188  
2013-09-18 14:34:00    0.164616  
2013-09-18 14:35:00    0.479529  
2013-09-18 14:36:00    1.116959  
2013-09-18 14:37:00    1.330623  
2013-09-18 14:38:00   -0.464643  
2013-09-18 14:39:00    1.307154  
2013-09-18 14:40:00    1.603750  
2013-09-18 14:41:00   -0.447813  
2013-09-18 14:42:00    0.677137  
2013-09-18 14:43:00   -0.451986  
Freq: T, dtype: float64

ts.resample(&#39;5Min&#39;, label=&#39;right&#39;, closed=&#39;left&#39;,how=&#39;last&#39;)  
Out[204]:  
2013-09-18 14:35:00    0.164616  
2013-09-18 14:40:00    1.307154  
2013-09-18 14:45:00   -0.451986  
Freq: 5T, dtype: float64  
</code></pre>

<p>I can imagine that in some cases this would be a good thing but also that at other times it would be better to have just daily closes in the DataFrame.</p>

<p>I hope the &#39;refactoring&#39; of batch_transform happens soon.</p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='523c20062eaae1e513000132' id='523c20062eaae1e513000132'>
<a href='#523c20062eaae1e513000132'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379672071000' class='quanto-date posted-at response-posted-at' href='#523c20062eaae1e513000132'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Peter,</p>

<p>It seems that the sure-fire way to accumulate daily closing prices is to store a trailing minutely price.  Then, when a daily market open is indicated, the stored price will be the prior day&#39;s closing price.  In the example above, I just store the prices, but I think one could append a pandas timeseries, as well, to build up the trailing window of closing prices while running a minutely backtest.</p>

<p>For 15-minute, 5-minute, etc. bars, it&#39;s perhaps more tricky, since one has to deal with missing data, etc.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5240d4b217c49c415900001e' id='5240d4b217c49c415900001e'>
<a href='#5240d4b217c49c415900001e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379980467000' class='quanto-date posted-at response-posted-at' href='#5240d4b217c49c415900001e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Peter,</p>

<p>Here&#39;s my latest effort.  The batch transform is now:</p>

<pre><code>@batch_transform(refresh_period=0, window_length=W_L) # set globals R_P &amp; W_L above  
def get_data(data,sids):  
    minutely = data.price[sids]  
    daily = pd.rolling_mean(minutely,390)[389:][::390]  
    return (minutely,daily)  
</code></pre>

<p>The idea is to use a rolling mean to generate a trailing window of rolling means, that can be fed to the TA-Lib RSI.  This way, if a trading decision is to be made every minute, all of the data up to that point are used.  This makes more sense to me than using daily closing prices, since all of the data are not incorporated into the decision--just one point each day.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5240dab2aedd102d4c00001d' id='5240dab2aedd102d4c00001d'>
<a href='#5240dab2aedd102d4c00001d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1379982003000' class='quanto-date posted-at response-posted-at' href='#5240dab2aedd102d4c00001d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s the updated code, with the MA &amp; RSI plots.  --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5242219c695744e7ba000013' id='5242219c695744e7ba000013'>
<a href='#5242219c695744e7ba000013'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1380065693000' class='quanto-date posted-at response-posted-at' href='#5242219c695744e7ba000013'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s the algorithm with trading rules:</p>

<pre><code>if ma_5 &gt; ma_15 and rsi &gt; 70 and notional &lt; context.max_notional:  
        order(context.stocks[0],100)  
elif ma_5 &lt; ma_15 and rsi &lt; 30 and notional &gt; context.min_notional:  
        order(context.stocks[0],-100)  
</code></pre>

<p>It&#39;s cheating to use Apple, but might as well pick a winner for testing!</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='565d4b5f4db4fbbf00000210' id='565d4b5f4db4fbbf00000210'>
<a href='#565d4b5f4db4fbbf00000210'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/511df64ede77e59d7f000061'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9a0d5d04b194fc2c6be1c90d6a08d69a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/511df64ede77e59d7f000061'>Andrew Antar</a>
</div>
<a UTCms='1448954725000' class='quanto-date posted-at response-posted-at' href='#565d4b5f4db4fbbf00000210'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant or anyone,</p>

<p>I am trying to run this algo and get this error:</p>

<p>There was a runtime error.<br>
TypeError: Argument &#39;real&#39; has incorrect type (expected numpy.ndarray, got Series)<br>
...
USER ALGORITHM:28, in handle_data<br>
rsi = float(ztt.talib.RSI(daily[context.stocks[0]], timeperiod=14)[-1:])</p>

<p>Any help debugging? I really want to use this algo since it is daily  MACD and RSI using minute data! What I&#39;ve been looking for!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='565d4e374db4fbaddf000206' id='565d4e374db4fbaddf000206'>
<a href='#565d4e374db4fbaddf000206'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/511df64ede77e59d7f000061'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9a0d5d04b194fc2c6be1c90d6a08d69a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/511df64ede77e59d7f000061'>Andrew Antar</a>
</div>
<a UTCms='1448955454000' class='quanto-date posted-at response-posted-at' href='#565d4e374db4fbaddf000206'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I believe this is not running since it is not using &#39;history&#39; and &#39;batch transform&#39; is depreciated. Can someone update this a bit to get it working again? I really want to work on it, but don&#39;t know enough about how to get updated data feeds or debugging this yet to be able to fix it properly. </p>

<p>thanks,<br>
Andrew  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='565d793aea6850036900008e' id='565d793aea6850036900008e'>
<a href='#565d793aea6850036900008e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1448966462000' class='quanto-date posted-at response-posted-at' href='#565d793aea6850036900008e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Andrew,</p>

<p>I&#39;d definitely move away from the 
<code>batch_transform</code> in favor of <code>history</code>.  Also, you shouldn&#39;t need to do the zipline import to use TA-LIB.</p>

<p>I don&#39;t have time now to dig into it, but have a look at the help page, <a href="https://www.quantopian.com/help#ide-history">https://www.quantopian.com/help#ide-history</a>.  You could do:</p>

<pre><code>minutely = history(15*390, &#39;1m&#39;, &#39;price&#39;)  
</code></pre>

<p>I need to check it, but I think you can just copy the code for smoothed &quot;daily&quot; prices:</p>

<pre><code>daily = pd.rolling_mean(minutely,390)[389:][::390]  
</code></pre>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='565e81f2734f1d3a0b0002b1' id='565e81f2734f1d3a0b0002b1'>
<a href='#565e81f2734f1d3a0b0002b1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/511df64ede77e59d7f000061'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9a0d5d04b194fc2c6be1c90d6a08d69a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/511df64ede77e59d7f000061'>Andrew Antar</a>
</div>
<a UTCms='1449034235000' class='quanto-date posted-at response-posted-at' href='#565e81f2734f1d3a0b0002b1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I did all of your suggestions and got it to run without errors, but for some reason no trades are being initiated. i made some edits to make sure there are no undefined variables, but since I&#39;m new to this, I might be doing something stupid, perhaps you could take a peak and see if anything glaring is wrong?</p>

<p>Thanks,<br>
Andrew</p>

<p><a href="https://www.quantopian.com/algorithms/565e79bc17354449900000c6">https://www.quantopian.com/algorithms/565e79bc17354449900000c6</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='565ecb15173544cdd900027f' id='565ecb15173544cdd900027f'>
<a href='#565ecb15173544cdd900027f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1449052961000' class='quanto-date posted-at response-posted-at' href='#565ecb15173544cdd900027f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I suggest posting the code to this discussion thread, since I can&#39;t access the link you shared.  --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='565fa37bb5c146838e00017a' id='565fa37bb5c146838e00017a'>
<a href='#565fa37bb5c146838e00017a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/511df64ede77e59d7f000061'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9a0d5d04b194fc2c6be1c90d6a08d69a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/511df64ede77e59d7f000061'>Andrew Antar</a>
</div>
<a UTCms='1449108351000' class='quanto-date posted-at response-posted-at' href='#565fa37bb5c146838e00017a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Sorry I thought those links were public. Here&#39;s the code:  </p>

<pre><code>
import pandas as pd  
import talib

def initialize(context):  
     context.stocks = [sid(24),sid(8554)]

def handle_data(context, data):  
    minutely = history(15*390, &#39;1m&#39;, &#39;price&#39;)  
    daily = pd.rolling_mean(minutely,390)[389:][::390]  
    return (minutely,daily)  
    # get data  
    data_minutely_daily = handle_data(data,context.stocks)  
    if data_minutely_daily is None:  
        return  
    price = data[context.stocks[0]].price  
    minutely = data_minutely_daily[0]  
    daily = data_minutely_daily[1]  
    # print minutely  
    # print daily  
    # get RSI &amp; MAs  
    rsi   =  float(talib.RSI(daily[context.stocks[0]], timeperiod=14)[-1:])  
    ma_5  =  float(talib.MA(minutely[context.stocks[0]], timeperiod=5*390)[-1:])  
    ma_15 =  float(talib.MA(minutely[context.stocks[0]], timeperiod=15*390)[-1:])  
    record(rsi = rsi)  
    record(ma_5=ma_5)  
    record(ma_15=ma_15)  
    record(price = price)  

    if ma_5 &gt; ma_15 and rsi &gt; 70:  
    order(context.stocks[0],100)  
    elif ma_5 &lt; ma_15 and rsi &lt; 30:  
        order(context.stocks[0],-100)  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='566021d0fde3618904000140' id='566021d0fde3618904000140'>
<a href='#566021d0fde3618904000140'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1449140692000' class='quanto-date posted-at response-posted-at' href='#566021d0fde3618904000140'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s some code that runs.  No guarantee that it is correct, but it is a start.   --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5660bf2bbe02c81b5100029d' id='5660bf2bbe02c81b5100029d'>
<a href='#5660bf2bbe02c81b5100029d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/511df64ede77e59d7f000061'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9a0d5d04b194fc2c6be1c90d6a08d69a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/511df64ede77e59d7f000061'>Andrew Antar</a>
</div>
<a UTCms='1449180976000' class='quanto-date posted-at response-posted-at' href='#5660bf2bbe02c81b5100029d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Awesome thanks!! this seems a lot simpler. </p>

<p>A  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='566183d79a641ffe5d000180' id='566183d79a641ffe5d000180'>
<a href='#566183d79a641ffe5d000180'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1449231322000' class='quanto-date posted-at response-posted-at' href='#566183d79a641ffe5d000180'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Have a look at 
<code>schedule_function()</code> on the help page.  Rather than making a trading decision minutely, you could consider picking a fixed time every day.  --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5661ba87bbc2725ebf0000c7' id='5661ba87bbc2725ebf0000c7'>
<a href='#5661ba87bbc2725ebf0000c7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/511df64ede77e59d7f000061'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9a0d5d04b194fc2c6be1c90d6a08d69a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/511df64ede77e59d7f000061'>Andrew Antar</a>
</div>
<a UTCms='1449245326000' class='quanto-date posted-at response-posted-at' href='#5661ba87bbc2725ebf0000c7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I was able to tweak the MAs and RSI thresholds a bit and generate 80-100% yearly returns, even in downmarket environments!</p>

<p>Why would a fixed time be more accurate? A trade being made at 10:32AM versus 2:42PM could mean a massive price difference. The reason I find this so important is because I used to design trading algorithms on a desktop program called Prodigio RTS. They are still around, but my main issue was the lack of minutely data, and the lack of more than 3 years of daily data. I found that 2 things killed any seemingly good momentum quant strategy, the main culprit was Daily data. Thus if a trigger was created by MAs crossing in the morning, the trade for that movement would go in the next trading day, thus eliminating the majority of the profit from the trade, sometimes all the profit, or loss of capital, since the delayed timing killed the trade, where it would have been profitable if the trades were executed on the exact minutes the triggers were pulled. Though it is super computer intensive to calculate daily MAs with minutely data and slower to test, it is the only way to achieve good timing, and with trading, timing is everything.</p>

<p>The second culprit I alluded to is commissions, which can be solved using Quantopian&#39;s integration with Robinhood!</p>

<p>I will check out the schedule_function()</p>

<p>Is is possible to write an algorithm in Quantopian that optimizes over time using a feed of updated historical data? Is it possible to calculate values based on backtests made on quantopian? While this seems programatically hard, I believe self-optimizing algos which keep current and leverage results of other algo backtests could be super cool and actually work a lot better. For example an algo in live trading could rebalance MA period values every week based on running new backtests to determine which periods where the best fit for the stock or sector.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5661df69d549ddec08000003' id='5661df69d549ddec08000003'>
<a href='#5661df69d549ddec08000003'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1449254773000' class='quanto-date posted-at response-posted-at' href='#5661df69d549ddec08000003'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>Why would a fixed time be more accurate?</p>
</blockquote>

<p>It is a crude way of limiting the amount of trading.  As it stands, there&#39;s nothing to prevent going in and out of the stock multiple times a day, since the trailing window from 
<code>minutely = history(15*390, &#39;1m&#39;, &#39;price&#39;)[context.stock]</code> gets updated every minute.  You might look through the backtest results to see if there is much &quot;churn&quot; in the trading.</p>

<blockquote>
<p>Is is possible to write an algorithm in Quantopian that optimizes over time using a feed of updated historical data?</p>
</blockquote>

<p>I&#39;m not sure what you mean.  The data feed is minutely, and you can do computations every minute.</p>

<blockquote>
<p>Is it possible to calculate values based on backtests made on quantopian?</p>
</blockquote>

<p>I&#39;m not aware of a way to do this sort of thing in the trading platform without doing it manually (e.g. there&#39;s no way to call a backtest function from within the backtester itself), but in the Quantopian research platform, you might be able to simulate it.  You could do it manually, though.  For example, every week/month/quarter, re-optimize and tweak your algo parameters and then re-start the algo (or figure out how to feed them in using fetcher).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5661e34441856c911b000134' id='5661e34441856c911b000134'>
<a href='#5661e34441856c911b000134'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/511df64ede77e59d7f000061'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9a0d5d04b194fc2c6be1c90d6a08d69a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/511df64ede77e59d7f000061'>Andrew Antar</a>
</div>
<a UTCms='1449255753000' class='quanto-date posted-at response-posted-at' href='#5661e34441856c911b000134'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Cool. So rebalancing has to be done externally and re-applied. </p>

<p>I meant an algo that can self-optimize over time by recalculating and comparing different parameters based on newer history (ie current real time data) since the last calculation. Basically, while a 5 day MA is calculated every minute for trades, what if the fast MA was a range from 3-15 and slow MA was a range of 20-200, and you had something that automatically calculated the best performing MA crossover combination  (IE 5/50, 3/10, 9/26, 14/100, etc) based on historical data, and redid that calculation every week or so based on new historical data. </p>

<p>I did not see any churn or intraday trading in the backtest. Most positions were held for a few days, few weeks, or few months before being sold. This is ideal for commissions and having a &#39;low frequency&#39; quant algo.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5662d7857616ccf07d0002a3' id='5662d7857616ccf07d0002a3'>
<a href='#5662d7857616ccf07d0002a3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1449318280000' class='quanto-date posted-at response-posted-at' href='#5662d7857616ccf07d0002a3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m not aware of any way to do the automatic optimization you describe, but it might be possible if you wrote your own mini efficient backtester function.  The Quantopian backtester is event-driven, however if your algo could be vectorized (without introducing bias), then you might be able to pull it off.  The time-out for 
<code>handle_data</code> plus any scheduled functions is about 50 seconds.  For <code>before_trading_start</code> the time-out is 5 minutes (for example, run the code I posted on <a href="https://www.quantopian.com/posts/test-of-before-trading-start-time-out">https://www.quantopian.com/posts/test-of-before-trading-start-time-out</a> ).</p>

<p>Your best bet, I think, would be to get up the learning curve for the Quantopian research platform, if you want to explore the parameter space.  It used to be that you&#39;d need to request access.  I&#39;m not sure if that is still the case.  Note that you can manually launch as many backtests as you want (they run in parallel), and then pull the results into the research platform for analyses.  Doing your study (&quot;fast MA was a range from 3-15 and slow MA was a range of 20-200&quot;) would be tedious, but possible.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57ad142d39d783a3f7000204' id='57ad142d39d783a3f7000204'>
<a href='#57ad142d39d783a3f7000204'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/511df64ede77e59d7f000061'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9a0d5d04b194fc2c6be1c90d6a08d69a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/511df64ede77e59d7f000061'>Andrew Antar</a>
</div>
<a UTCms='1470960691000' class='quanto-date posted-at response-posted-at' href='#57ad142d39d783a3f7000204'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Finally back on the algo after a hiatus. How would one vectorize an algo and what would that do? Your post about before_trading_start mentioned being able to run things 5 mins before the trading day starts. Could that theoretically contain a whole mini backtester rebalancing function? Is the research platform you refer to a separate platform from the quantopian community like docs or a wiki? I didn&#39;t realize I could run multiple backtests concurrently. So basically I could clone it a bunch of times and put different numbers in each and have them run them all at the same time? Is there a rate limit on how many backtests you can run simultaneously? The next thing I want to test is swapping out the fast/slow daily MA for a daily MACD with minute data.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='57ad87d639d783563000066e' id='57ad87d639d783563000066e'>
<a href='#57ad87d639d783563000066e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1470990303000' class='quanto-date posted-at response-posted-at' href='#57ad87d639d783563000066e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>How would one vectorize an algo and what would that do?</p>
</blockquote>

<p>Certain operations can be done very quickly in numpy (similar to MATLAB).  Pandas supports this sort of thing, too.  Rather than looping over computations, everything is done at once, essentially.  If you do a search on &quot;vectorized backtesting&quot; it should give you an idea of how this might apply.  As an example, say you wanted to simulate buying and holding SPY &amp; TLT in various ratios over a 20 day trailing window of OHLCV minute bars, computing performance statistics of hypothetical portfolios.  This should be doable in a vectorized fashion, so that computations would be highly efficient. </p>

<blockquote>
<p>Is the research platform you refer to a separate platform from the quantopian community like docs or a wiki?</p>
</blockquote>

<p>It is a separate platform, but backtest results can be imported (see the help docs).  Also, just try My Code --> Notebooks, which should take you to the research platform.</p>

<blockquote>
<p>I didn&#39;t realize I could run multiple backtests concurrently.</p>
</blockquote>

<p>Yes, but really only from the backtester.  In the research platform, I think you can have multiple notebooks running simultaneously, but there is an overall memory limit, which I don&#39;t think exists for the backtester.  Also in the research platform, I&#39;m not sure that one notebook can &quot;talk&quot; to another one, so comparing backtests might not be feasible.  In any case, if you are interested in running a whole bunch of backtests, just fire them off.  You can pull the results into the research platform, once they finish.  I don&#39;t think there is any limit to the number you can run simultaneously.  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/ma-cross-over-w-slash-rsi'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/ma-cross-over-w-slash-rsi'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#3f595a5a5b5d5e5c547f4e4a5e514b504f565e51115c5052">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

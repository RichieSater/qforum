<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
SPY &amp; SH, minute data
</title>
<meta content='This is a continuation of the thread  https://www.quantopian.com/posts/spy-and-sh-algorithm-please-review , except the algo was run on minute data.  It&#39;s kinda cobbled together; I need to do some refactoring and commenting.  In any case, the results appear to be valid. The basic idea is to maintain matching long (short) and short (long) positions in SPY &amp; SH.  Rebalancing is based on a z-score difference test.  In this example, trading is limited to noon only (i.e. one rebalancing per day).  ...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="tUlOecgNdTwG1NSjkcaMnpNrPenzGKCci4esdPvR7WXJLzg0avun37/JjZLeKSTqq+UegInUtYcJiHceUZSP3g==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/spy-and-sh-minute-data' property='og:url'>
<meta content='SPY &amp; SH, minute data' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/spy-and-sh-minute-data' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='SPY &amp; SH, minute data' property='og:title'>
<meta content='This is a continuation of the thread  https://www.quantopian.com/posts/spy-and-sh-algorithm-please-review , except the algo was run on minute data.  It&#39;s kinda cobbled together; I need to do some refactoring and commenting.  In any case, the results appear to be valid. The basic idea is to maintain matching long (short) and short (long) positions in SPY &amp; SH.  Rebalancing is based on a z-score difference test.  In this example, trading is limited to noon only (i.e. one rebalancing per day).  ...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/spy-and-sh-minute-data">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='52924c9e10055a091d00046b'>
<div class='post-container' data-post-id='52924c9e10055a091d00046b' id='52924c9e10055a091d00046b'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>SPY &amp; SH, minute data</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1385319582000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=SPY &amp; SH, minute data&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fspy-and-sh-minute-data%3Futm_source%3Dwebsite_share%26utm_campaign%3Dspy-and-sh-minute-data%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fspy-and-sh-minute-data%3Futm_source%3Dwebsite_share%26utm_campaign%3Dspy-and-sh-minute-data%26utm_medium%3Dlinkedin&amp;title=SPY+%26+SH%2C+minute+data+%28Grant+Kiehne%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/spy-and-sh-minute-data?utm_source=website_share&amp;utm_campaign=spy-and-sh-minute-data&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Grant Kiehne" />
<div class='body-text'>
<div class='body-text-container post-body'><p>This is a continuation of the thread <a href="https://www.quantopian.com/posts/spy-and-sh-algorithm-please-review">https://www.quantopian.com/posts/spy-and-sh-algorithm-please-review</a>, except the algo was run on minute data.  It&#39;s kinda cobbled together; I need to do some refactoring and commenting.  In any case, the results appear to be valid.</p>

<p>The basic idea is to maintain matching long (short) and short (long) positions in SPY &amp; SH.  Rebalancing is based on a z-score difference test.  In this example, trading is limited to noon only (i.e. one rebalancing per day).  </p>

<p>Grant</p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>80 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='5292504da5215fa5e2000492' id='5292504da5215fa5e2000492'>
<a href='#5292504da5215fa5e2000492'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1385320526000' class='quanto-date posted-at response-posted-at' href='#5292504da5215fa5e2000492'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s the result with margin.  Seems too good to be true.  Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52929fe7077110af9600002e' id='52929fe7077110af9600002e'>
<a href='#52929fe7077110af9600002e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1385340905000' class='quanto-date posted-at response-posted-at' href='#52929fe7077110af9600002e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I am not sure how easy it is to short these inverse/leveraged ETFs.  Good avenue of research though!</p>

<p>EDIT: I should add, the reason the SH has a persistent downward trend is due to the geometric return penalty of rebalancing the ETF&#39;s position, which worsens linearly with the variance of the asset and the square of the leverage (if I remember correctly).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5292a07a67a387debf00003f' id='5292a07a67a387debf00003f'>
<a href='#5292a07a67a387debf00003f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1385341051000' class='quanto-date posted-at response-posted-at' href='#5292a07a67a387debf00003f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m curious - why did you bring dollar-volume into the equation as part of your mean reversion scores?</p>

<p>EDIT: also, it&#39;s so hard to tell with this IDE, but it looks like what it&#39;s doing is calculating the z-score of price*volume, using only that of the second stock (SH), and when that is higher than normal, it goes long SPY and short SH.  I&#39;m not entirely sure what you are aiming for here (I mean no disrespect!), but it looks like this strategy boils down to buying the dips (and shorting the equivalent SH pops) in what has been essentially a low-vol bull market for the last few years?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5292abe5077110d25400003d' id='5292abe5077110d25400003d'>
<a href='#5292abe5077110d25400003d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1385343974000' class='quanto-date posted-at response-posted-at' href='#5292abe5077110d25400003d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Simon,</p>

<p>Good point on shorting SH; I&#39;ve wondered how a broker would treat it.</p>

<p>Regarding the dollar-volume, I started playing around with just prices, but it wasn&#39;t productive.  I did some work with a cointegration test to understand what might be going on (<a href="https://www.quantopian.com/posts/augmented-dickey-fuller-adf-test-spy-and-sh-dollar-volume">https://www.quantopian.com/posts/augmented-dickey-fuller-adf-test-spy-and-sh-dollar-volume</a>).  I can&#39;t say I have a good feel for the fundamentals yet (and Quantopian isn&#39;t really a platform for data exploration).</p>

<p>I&#39;ll have a look at the code again.  The algorithm should compute z-scores of the dollar-volumes of both SPY and SH.  Then, it should compute the difference in the z-scores and use the difference to determine if they are &quot;out of whack.&quot;</p>

<p>Grant</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52937f6d36ac9580930001bd' id='52937f6d36ac9580930001bd'>
<a href='#52937f6d36ac9580930001bd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1385398128000' class='quanto-date posted-at response-posted-at' href='#52937f6d36ac9580930001bd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Agreed re: data exploration.  What is the rationale for dollar-volume though, is it a mean-reverting process, and if so, does it revert via price or via volume?  </p>

<p>I recall reading a paper which mentioned that the shorting/borrow costs for leveraged ETFs was in the neighborhood of 50%/year.  I thought it was <a href="http://papers.ssrn.com/sol3/papers.cfm?abstract_id=2211387&amp;download=yes">http://papers.ssrn.com/sol3/papers.cfm?abstract_id=2211387&amp;download=yes</a> but it doesn&#39;t seem to be in that one.</p>

<p>Also:</p>

<p><a href="http://falkenblog.blogspot.com/2011/10/shorting-leveraged-etf-pairs.html">http://falkenblog.blogspot.com/2011/10/shorting-leveraged-etf-pairs.html</a><br>
<a href="http://www.math.nyu.edu/faculty/avellane/LETF_Dobi_Avellaneda_Sept2012.pdf">http://www.math.nyu.edu/faculty/avellane/LETF_Dobi_Avellaneda_Sept2012.pdf</a><br>
<a href="http://blog.quantumfading.com/2009/08/17/leveraged-etf-myths-1-shorting-both-bull-and-bear/">http://blog.quantumfading.com/2009/08/17/leveraged-etf-myths-1-shorting-both-bull-and-bear/</a></p>

<p>Lots of information out there about this strategy, in general!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5293c903e1d31c6e7d000267' id='5293c903e1d31c6e7d000267'>
<a href='#5293c903e1d31c6e7d000267'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1385416963000' class='quanto-date posted-at response-posted-at' href='#5293c903e1d31c6e7d000267'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Simon,</p>

<p>At this point, I don&#39;t have a rationale for the dollar-volume, other than a guess.  My intuition is that the volume provides a weighting, so that only significant departures from the norm are used as a trading signal.  But I haven&#39;t dug into the details yet.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5293efdfefb7d8030800001e' id='5293efdfefb7d8030800001e'>
<a href='#5293efdfefb7d8030800001e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1385426912000' class='quanto-date posted-at response-posted-at' href='#5293efdfefb7d8030800001e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Simon,</p>

<p>Here&#39;s the backtest using volumes only--appears to be the dominant factor.  I&#39;ll try prices next and post the result.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5293f3fa3e837f2ee4000014' id='5293f3fa3e837f2ee4000014'>
<a href='#5293f3fa3e837f2ee4000014'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1385427963000' class='quanto-date posted-at response-posted-at' href='#5293f3fa3e837f2ee4000014'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s the result run on prices (I changed the threshold to 5 to get a decent return).  --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5295e21c491ea7a9ec0000d2' id='5295e21c491ea7a9ec0000d2'>
<a href='#5295e21c491ea7a9ec0000d2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1385554461000' class='quanto-date posted-at response-posted-at' href='#5295e21c491ea7a9ec0000d2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s a long-only version with no margin that goes in and out of SPY.  --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5295ef95491ea7a5c6000100' id='5295ef95491ea7a5c6000100'>
<a href='#5295ef95491ea7a5c6000100'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1385557911000' class='quanto-date posted-at response-posted-at' href='#5295ef95491ea7a5c6000100'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s the same algorithm as immediately above, but with both long and short SPY positions allowed.  --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5295f25c617a4316f4000137' id='5295f25c617a4316f4000137'>
<a href='#5295f25c617a4316f4000137'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1385558622000' class='quanto-date posted-at response-posted-at' href='#5295f25c617a4316f4000137'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Interesting, I&#39;ll have to look more closely at this, definitely seems to be be something there...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5295f33c491ea7b2d50000ee' id='5295f33c491ea7b2d50000ee'>
<a href='#5295f33c491ea7b2d50000ee'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1385558845000' class='quanto-date posted-at response-posted-at' href='#5295f33c491ea7b2d50000ee'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Are you sure which stock&#39;s dollar volume you are using for the zscore? Eyeballing it looks like it&#39;s using SH. If so, then a rise in the volume of a short ETF might be a plausible indicator of market bottoms/turning points.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5295f418617a43bafc00012c' id='5295f418617a43bafc00012c'>
<a href='#5295f418617a43bafc00012c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1385559065000' class='quanto-date posted-at response-posted-at' href='#5295f418617a43bafc00012c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Simon,</p>

<p>I appreciate your input.  I&#39;ve gotta put it aside for now, but hope to get back to it shortly.  My intent is to compute the SPY-SH z-score difference as an indicator, but it is possible that I botched the code.  I&#39;ll have a look.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52961e725c23e73695000180' id='52961e725c23e73695000180'>
<a href='#52961e725c23e73695000180'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1385569907000' class='quanto-date posted-at response-posted-at' href='#52961e725c23e73695000180'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Simon,</p>

<p>This code looks correct:</p>

<pre><code>    # normalize dollar volume with z-score  
    dv_z = stats.zscore(dv, axis=0, ddof=1)  
    # compute z-score difference  
    end = dv_z.shape[0]-1  
    delta_z = dv_z[end,1] - dv_z[end,0]  
</code></pre>

<p>Why do you think otherwise?</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='529625815c23e73695000195' id='529625815c23e73695000195'>
<a href='#529625815c23e73695000195'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1385571715000' class='quanto-date posted-at response-posted-at' href='#529625815c23e73695000195'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I must simply not understand what you are trying to do, you&#39;re multiplying the mean of the price with the the sum of volume of each, so you end up with a matrix of P-V x stock, which you z-score for each stock.  Then delta_z is supposed to be the difference between the P-V z-score of SPY vs the z-score of SH?  So, if the P-V of one is an outlier but the other is not, you enter?  Or is delta_z supposed to be the difference between z-scores of now vs last period for SH?  (it&#39;s not clear to me what the dimensions of these axes are and I haven&#39;t had time to look into it).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5296298c491ea7b2d5000144' id='5296298c491ea7b2d5000144'>
<a href='#5296298c491ea7b2d5000144'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1385572749000' class='quanto-date posted-at response-posted-at' href='#5296298c491ea7b2d5000144'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The delta_z is supposed to be the current SPY-SH dollar-volume z-score difference (using the pandas rolling stats to reduce the data, prior to computing the z-score).  My thinking is that the z-score difference should stay within a fairly tight range, unless something is amiss.  So when the z-score difference is large, I treat it as a signal to trade.  Unfortunately, the whole approach is murky at this point, since Quantopian doesn&#39;t allow free-form analysis of their proprietary data.  I&#39;ll think about how we could get a more fundamental understanding of the mechanism.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='529629fe5c23e70a9c00017e' id='529629fe5c23e70a9c00017e'>
<a href='#529629fe5c23e70a9c00017e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1385572864000' class='quanto-date posted-at response-posted-at' href='#529629fe5c23e70a9c00017e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Yeah, there definitely seems to be something there, I&#39;ll play around in matlab when I have some time, but swamped with work and studies at the moment.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5296767bdfda0d5b7c000072' id='5296767bdfda0d5b7c000072'>
<a href='#5296767bdfda0d5b7c000072'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1385592444000' class='quanto-date posted-at response-posted-at' href='#5296767bdfda0d5b7c000072'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Simon,</p>

<p>Here&#39;s a first attempt to get a feel for what&#39;s going on.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52a84e55b284962da6000218' id='52a84e55b284962da6000218'>
<a href='#52a84e55b284962da6000218'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52714d0bbedfd124ce000152'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7ffc01f6b391d83bc9e3d799d2864771?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52714d0bbedfd124ce000152'>Ilya A</a>
</div>
<a UTCms='1386761815000' class='quanto-date posted-at response-posted-at' href='#52a84e55b284962da6000218'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Grant,</p>

<p>I checked this idea in my own system and discovered a significant difference between quantopian and original (from bloomberg, yahoo) <a href="https://www.quantopian.com/posts/what-data-does-quantopian-use-spy-sh">data</a>. The difference in traded volumes significantly decreases performance of strategy. Probably quantopian uses some adjustments for data, do you know about it?</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52a9073768d7ad917700001d' id='52a9073768d7ad917700001d'>
<a href='#52a9073768d7ad917700001d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1386809144000' class='quanto-date posted-at response-posted-at' href='#52a9073768d7ad917700001d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Ilya,</p>

<p>I am unaware of adjustments, but the Quantopian folks tend to be pretty responsive, so hopefully they&#39;ll have a look at your other post and help sort it out.  Kinda strange that the difference would be so large.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52b0e4dec46986a495000055' id='52b0e4dec46986a495000055'>
<a href='#52b0e4dec46986a495000055'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/524c5c27f12db56c5e00004e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ad9fd24211bfdde17bbb79907e6dcbb2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/524c5c27f12db56c5e00004e'>Kyu P</a>
</div>
<a UTCms='1387324641000' class='quanto-date posted-at response-posted-at' href='#52b0e4dec46986a495000055'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant,<br>
Sorry, I&#39;m new here and do not have some knowledge of the codes written in Python. (I rather understand things in C++ better...)<br>
Can you briefly explain your strategy on this SPY &amp; SH pair trading?<br>
What time frame is this based on? 1 min.? 5 min.? and Intraday only?</p>

<p>Thanks.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52b0eabfc4698673fe00005e' id='52b0eabfc4698673fe00005e'>
<a href='#52b0eabfc4698673fe00005e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1387326144000' class='quanto-date posted-at response-posted-at' href='#52b0eabfc4698673fe00005e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Kyu,</p>

<p>The basic idea is to normalize the dollar-volumes of both SPY &amp; SH with a z-score.  The z-score difference is used as an indicator.</p>

<pre><code>if delta_z &gt; threshold:  
        desired_amount = positions_value/data[context.stocks[0]].price  
        diff_amount = desired_amount - current_amount  
        order(context.stocks[0],diff_amount)  
        context.new_day = False  

    elif delta_z  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52b0eb20623bac2a9200005f' id='52b0eb20623bac2a9200005f'>
<a href='#52b0eb20623bac2a9200005f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1387326241000' class='quanto-date posted-at response-posted-at' href='#52b0eb20623bac2a9200005f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Kyu,</p>

<p>Sorry, part of my post got chopped off...I&#39;ll fill you in later.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52b0ee09f49f5d669400004f' id='52b0ee09f49f5d669400004f'>
<a href='#52b0ee09f49f5d669400004f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1387326987000' class='quanto-date posted-at response-posted-at' href='#52b0ee09f49f5d669400004f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Kyu,</p>

<p>When the z-score difference is above a threshold, SPY is bought, and when the z-score difference is below the threshold, SPY is shorted.</p>

<p>Trading is limited to once per day.</p>

<p>Hope this helps.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52b0f07ec46986a495000069' id='52b0f07ec46986a495000069'>
<a href='#52b0f07ec46986a495000069'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/524c5c27f12db56c5e00004e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ad9fd24211bfdde17bbb79907e6dcbb2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/524c5c27f12db56c5e00004e'>Kyu P</a>
</div>
<a UTCms='1387327616000' class='quanto-date posted-at response-posted-at' href='#52b0f07ec46986a495000069'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant,<br>
So do you actually trade SPY only? But you are using SH with a z-score as an indicator?<br>
What time frame is this based on?<br>
Does this include transaction costs?<br>
Have you tried this strategy with other pairs? If so, how did it go?</p>

<p>Thanks.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52b0f76ac4698646bb000056' id='52b0f76ac4698646bb000056'>
<a href='#52b0f76ac4698646bb000056'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1387329387000' class='quanto-date posted-at response-posted-at' href='#52b0f76ac4698646bb000056'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Kyu,</p>

<p>I can&#39;t say that I have anything spectacular here.  The trading is very infrequent, and for more recent timeframes, I haven&#39;t had much luck.  I have tried other pairs (e.g. SPY &amp; BND) but with the same mixed results.  If you have any insights, please post them.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52b1bc1a60f2a66e010000f7' id='52b1bc1a60f2a66e010000f7'>
<a href='#52b1bc1a60f2a66e010000f7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52553e62d0905f7a3c00010e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/38dff3d7166fc75fac48192d6267def8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52553e62d0905f7a3c00010e'>qingwei li</a>
</div>
<a UTCms='1387379740000' class='quanto-date posted-at response-posted-at' href='#52b1bc1a60f2a66e010000f7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant,</p>

<p>I&#39;ve got one question here, why would you &quot;skip tic if any orders are open or any stocks did not trade&quot; ? (line 49)</p>

<p>Qingwei  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52b2160df49f5d75660001fa' id='52b2160df49f5d75660001fa'>
<a href='#52b2160df49f5d75660001fa'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51bcf829bec6b8e51a000030'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8d1b221fac661f81937d2a2ecf671b20?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51bcf829bec6b8e51a000030'>Peter Poon</a>
</div>
<a UTCms='1387402766000' class='quanto-date posted-at response-posted-at' href='#52b2160df49f5d75660001fa'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Qingwei,</p>

<p>That is just a sanity check. If you have an open order, you can&#39;t place another order. If a stock does not trade, you can&#39;t trade anyway.</p>

<p>-Huapu  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52b216464cbecf18f4000192' id='52b216464cbecf18f4000192'>
<a href='#52b216464cbecf18f4000192'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1387402824000' class='quanto-date posted-at response-posted-at' href='#52b216464cbecf18f4000192'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p><a href="http://papers.ssrn.com/sol3/papers.cfm?abstract_id=2362971">http://papers.ssrn.com/sol3/papers.cfm?abstract_id=2362971</a></p>

<p>wrt short selling strategies and borrow costs  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52b24a838cd8783bd000003d' id='52b24a838cd8783bd000003d'>
<a href='#52b24a838cd8783bd000003d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1387416197000' class='quanto-date posted-at response-posted-at' href='#52b24a838cd8783bd000003d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Qingwei,</p>

<p>Regarding your question, as Huapu said, the idea is to avoid placing new orders if submitted ones have not been filled.  The check to see if actual trade data exists is a bit more subtle.  Quantopian forward-fills missing bars (see the discussion <a href="https://www.quantopian.com/posts/thinly-traded-stocks-why-no-gaps">https://www.quantopian.com/posts/thinly-traded-stocks-why-no-gaps</a>), so the check ensures that only historical trade data are used; if any filling occurred, the tic is skipped.</p>

<p>Grant</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52b24d214cbecf06bc0001bb' id='52b24d214cbecf06bc0001bb'>
<a href='#52b24d214cbecf06bc0001bb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51bcf829bec6b8e51a000030'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8d1b221fac661f81937d2a2ecf671b20?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51bcf829bec6b8e51a000030'>Peter Poon</a>
</div>
<a UTCms='1387416867000' class='quanto-date posted-at response-posted-at' href='#52b24d214cbecf06bc0001bb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant,</p>

<p>I still didn&#39;t completely understand the logic of your algorithm. You will buy SPY and short SH if the z-score of SH&#39;s price-volume product is larger than that of SPY by 1.5, right? As you mentioned before the dominant factor is volume and price doesn&#39;t matter much. Then your algo basically is saying that if the volume of SH has a much larger increase than that of SPY, you should buy SPY and short SH? Logically it doesn&#39;t make much sense. If it is price rather than volume, it actually make more sense logically. </p>

<p>Also buy SPY and short SH may double your risk. If you buy SPY and SH at the same time, it is kind of like pair trading and it should reduce your risk. But if you always buy SPY and short SH, or the other way round, aren&#39;t you basically doubling your earnings/risk? Why you didn&#39;t try to pair trade SPY and SH, but the other way round?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52b24e0c56c0cbab6b00003e' id='52b24e0c56c0cbab6b00003e'>
<a href='#52b24e0c56c0cbab6b00003e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52553e62d0905f7a3c00010e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/38dff3d7166fc75fac48192d6267def8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52553e62d0905f7a3c00010e'>qingwei li</a>
</div>
<a UTCms='1387417102000' class='quanto-date posted-at response-posted-at' href='#52b24e0c56c0cbab6b00003e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant, Simon &amp; Huapu</p>

<p>Thanks you guys! I&#39;ve got it! I never take it into account when writing my algo.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='52b2c8f28056cea69d000083' id='52b2c8f28056cea69d000083'>
<a href='#52b2c8f28056cea69d000083'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1387448564000' class='quanto-date posted-at response-posted-at' href='#52b2c8f28056cea69d000083'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Huapu,</p>

<p>Thanks for your comments.  You are likely correct regarding shorting SH, and I abandoned the idea awhile back (above, you&#39;ll see algorithms that are long only or long/short SPY, with no trading in SH).  One approach that might be viable would be to go long in either SPY or SH, for a long-only portfolio (rather than shorting SPY, for example).</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5382a2bc3efb0d383200008f' id='5382a2bc3efb0d383200008f'>
<a href='#5382a2bc3efb0d383200008f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/537cd94deb6589e6d8000011'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e2b10b8e915360826a9ee96e74f8279f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/537cd94deb6589e6d8000011'>Nihar Sheth</a>
</div>
<a UTCms='1401070271000' class='quanto-date posted-at response-posted-at' href='#5382a2bc3efb0d383200008f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Does this work well with other ETF pairs (i.e. SPDR Sector ETFs, country ETFS, etc.)?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5383274c3efb0dedee00019b' id='5383274c3efb0dedee00019b'>
<a href='#5383274c3efb0dedee00019b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1401104207000' class='quanto-date posted-at response-posted-at' href='#5383274c3efb0dedee00019b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Nihar,</p>

<p>It&#39;s been awhile since I played around with this, but I do recall trying other pairs.  In the end, I concluded that backtesting probably isn&#39;t the best approach to gain insight.  An offline statistical analysis would be nice (which I have not done).  Nevertheless, you could clone the algo and try alternative securities and settings.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53834e78cc35b296400001c7' id='53834e78cc35b296400001c7'>
<a href='#53834e78cc35b296400001c7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530db036ff0da19ab9000253'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4b4da70bef68f9e309c46e2661d4eeb8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530db036ff0da19ab9000253'>Jason Swearingen</a>
</div>
<a UTCms='1401114234000' class='quanto-date posted-at response-posted-at' href='#53834e78cc35b296400001c7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>unfortunatly i&#39;ve needed to start using multicharts because of this exact reason.  quantopian doesn&#39;t provide me enough detail on what&#39;s going at minute level.   Seems like this should be trivial to add to quantopian.  :(  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='539b08fc09fbc889f5000188' id='539b08fc09fbc889f5000188'>
<a href='#539b08fc09fbc889f5000188'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/537400743fcd41da07000056'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/566071c42a032f096a4b6925585231da?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/537400743fcd41da07000056'>Matt Clark</a>
</div>
<a UTCms='1402669310000' class='quanto-date posted-at response-posted-at' href='#539b08fc09fbc889f5000188'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;ve been playing around with variants of this algorithm and noticed that the results vary widely depending on what rebalancing point you pick throughout the day.  For example, rebalancing at 10am or 3pm produces wildly different returns (both short term and long term) than rebalancing at noon.  Was there some logic to the choice of 12pm ET as the rebalance trigger?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='539b939f42595df22a000054' id='539b939f42595df22a000054'>
<a href='#539b939f42595df22a000054'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1402704802000' class='quanto-date posted-at response-posted-at' href='#539b939f42595df22a000054'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Matt,</p>

<p>I don&#39;t recall any logic, other than noon ensures that if the market closes early, a trade can still be executed.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='539d2024cceab1748b0051f7' id='539d2024cceab1748b0051f7'>
<a href='#539d2024cceab1748b0051f7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/539cec95e84d809efa000fc8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/11c05f44e86daf081bdb7f24b4a23f19?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/539cec95e84d809efa000fc8'>Will Gartner</a>
</div>
<a UTCms='1402806310000' class='quanto-date posted-at response-posted-at' href='#539d2024cceab1748b0051f7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant,<br>
Are you trading live with this strategy?</p>

<p>Will  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='539d89ef1ff14403c6005740' id='539d89ef1ff14403c6005740'>
<a href='#539d89ef1ff14403c6005740'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1402833392000' class='quanto-date posted-at response-posted-at' href='#539d89ef1ff14403c6005740'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Nope.  --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54444a6b21d58319f2000401' id='54444a6b21d58319f2000401'>
<a href='#54444a6b21d58319f2000401'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/520973a4b66ca8aed2000010'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/97e34ff1e8447e39ce3a2a9ceca7c0a6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/520973a4b66ca8aed2000010'>dank memes</a>
</div>
<a UTCms='1413761645000' class='quanto-date posted-at response-posted-at' href='#54444a6b21d58319f2000401'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey guys!</p>

<p>I tried backtesting Grant&#39;s original strategy with margin, except I used UPRO and SPXU for the etf&#39;s. This should have the effect of tripling returns, right?<br>
I still used the volume and price data from SPY and SH, however, because they work better for the signals.</p>

<p>How does this look?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54455bc47bfbe53bbb00002c' id='54455bc47bfbe53bbb00002c'>
<a href='#54455bc47bfbe53bbb00002c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1413831624000' class='quanto-date posted-at response-posted-at' href='#54455bc47bfbe53bbb00002c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I ran a clone of this on some other time-frames, and its performance was dubious.  Caveat emptor.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5445d46fd718f30a38000280' id='5445d46fd718f30a38000280'>
<a href='#5445d46fd718f30a38000280'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/520973a4b66ca8aed2000010'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/97e34ff1e8447e39ce3a2a9ceca7c0a6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/520973a4b66ca8aed2000010'>dank memes</a>
</div>
<a UTCms='1413862515000' class='quanto-date posted-at response-posted-at' href='#5445d46fd718f30a38000280'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>This backtest uses all the available data for UPRO and SPXU.<br>
The 66.8% drawdown is pretty scary.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5446dc2948b09dd13f0000df' id='5446dc2948b09dd13f0000df'>
<a href='#5446dc2948b09dd13f0000df'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1413930027000' class='quanto-date posted-at response-posted-at' href='#5446dc2948b09dd13f0000df'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>This is what I got...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5447303e0fe284b95100009e' id='5447303e0fe284b95100009e'>
<a href='#5447303e0fe284b95100009e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/520973a4b66ca8aed2000010'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/97e34ff1e8447e39ce3a2a9ceca7c0a6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/520973a4b66ca8aed2000010'>dank memes</a>
</div>
<a UTCms='1413951552000' class='quanto-date posted-at response-posted-at' href='#5447303e0fe284b95100009e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Your backtest is different because you changed the time of executions to 3:45 instead of noon. I also get these terrible results when executing at that time. Noon appears to work best, though I have not thoroughly optimized it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54473b5450d6f21b000000c9' id='54473b5450d6f21b000000c9'>
<a href='#54473b5450d6f21b000000c9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1413954392000' class='quanto-date posted-at response-posted-at' href='#54473b5450d6f21b000000c9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Now <strong>that</strong> is interesting.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='544787940fe2842303000200' id='544787940fe2842303000200'>
<a href='#544787940fe2842303000200'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4ec777fc345f20000e000008'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d1c340e13d187142fc34a5cff3a5eed5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4ec777fc345f20000e000008'>James Jack</a>
</div>
<a UTCms='1413973909000' class='quanto-date posted-at response-posted-at' href='#544787940fe2842303000200'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m not sure exactly what influence it would have, but the volumes stocks trade is quite different through the day (even ignoring the first 5 minutes of the trading day). </p>

<p>EDIT: I got it wrong - most stocks have the least volume midday. SPY has least volume from 12:45 to 13:15  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54a801d946e6a5146600023b' id='54a801d946e6a5146600023b'>
<a href='#54a801d946e6a5146600023b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549f17b4a124f8e3f800008a'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3b0daf572ffa10793bffa98967708558?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549f17b4a124f8e3f800008a'>Javier Rivaya Martos</a>
</div>
<a UTCms='1420296667000' class='quanto-date posted-at response-posted-at' href='#54a801d946e6a5146600023b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Has somebody traded this system in live trading successfully?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54a82d5b852309c3de0000b3' id='54a82d5b852309c3de0000b3'>
<a href='#54a82d5b852309c3de0000b3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1420307806000' class='quanto-date posted-at response-posted-at' href='#54a82d5b852309c3de0000b3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Javier,</p>

<p>I have not traded this live, and I haven&#39;t heard of anyone else doing so.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54a8440c8523091fa1000106' id='54a8440c8523091fa1000106'>
<a href='#54a8440c8523091fa1000106'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549cf0135ed2413b280001b5'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/97aa436744edd58f961990ea084bbdf3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549cf0135ed2413b280001b5'>Adam Roder</a>
</div>
<a UTCms='1420313614000' class='quanto-date posted-at response-posted-at' href='#54a8440c8523091fa1000106'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Interactive Brokers lists 750,000 shares of SH are available to short, any security can be looked up on their list here:</p>

<p><a href="https://www.interactivebrokers.com/en/index.php?f=shortableStocks&amp;p=shortable">https://www.interactivebrokers.com/en/index.php?f=shortableStocks&amp;p=shortable</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54a8576f46e6a5146600037b' id='54a8576f46e6a5146600037b'>
<a href='#54a8576f46e6a5146600037b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1420318577000' class='quanto-date posted-at response-posted-at' href='#54a8576f46e6a5146600037b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>[Edited] Could be helpful for someone to cover how any shorting limits could be addressed in code? At some point in buying them back, do margin limits apply?</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54a85af3852309c3de000195' id='54a85af3852309c3de000195'>
<a href='#54a85af3852309c3de000195'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1420319478000' class='quanto-date posted-at response-posted-at' href='#54a85af3852309c3de000195'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I am not sure I follow, what are you talking about?  To short shares, you need to have shortable shares from the broker, you need to abide by the current uptick rules (not even sure what they are right now), pay the short interest rate and pay any dividends.  To cover, you just buy them back?  Is there any more to it than that?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54a866f78ba3c54b4e00005a' id='54a866f78ba3c54b4e00005a'>
<a href='#54a866f78ba3c54b4e00005a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549cf0135ed2413b280001b5'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/97aa436744edd58f961990ea084bbdf3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549cf0135ed2413b280001b5'>Adam Roder</a>
</div>
<a UTCms='1420322554000' class='quanto-date posted-at response-posted-at' href='#54a866f78ba3c54b4e00005a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thats is all there is.</p>

<p>If you&#39;re shorting in Q, you have to monitor your own margin intraday, they don&#39;t do it for you.  I also don&#39;t see a way to model margin interest yet, but IB only charges 1.56% APY, which from an engineering perspective is essentially zero, so I&#39;d be comfortable ignoring it a model and just focus on proof of concept.</p>

<p>Also, Q will not tell you that you do not have sufficient initial margin available to initiate a short sale of a particular size, you have to track that on your own.</p>

<p>Keep in mind as well that the proceeds from the short sale show up in &quot;cash&quot; in the Q model, which my be reinvested, as long as maintenance margin requirements are still satisfied, which, once again, you have to monitor on your own.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54a8b60cb2f630afc200019f' id='54a8b60cb2f630afc200019f'>
<a href='#54a8b60cb2f630afc200019f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549f17b4a124f8e3f800008a'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3b0daf572ffa10793bffa98967708558?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549f17b4a124f8e3f800008a'>Javier Rivaya Martos</a>
</div>
<a UTCms='1420342799000' class='quanto-date posted-at response-posted-at' href='#54a8b60cb2f630afc200019f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi everyone,</p>

<p>Shorting is nothing more than what Simon talks about (more or less), the only drawback could be that a)there are not enought shares to short (which is not the case because we have more than 15 USD million in IB from SH)  or b) big interest charged (this will depend on Fed funds rates and also is dependent on leverage, making leveraged ETFs more expensive to short, which is not the case because SH is not leveraged but inverse). Finally regarding margin requirements, if you leverage your account proportionally to the drawdown of the algo, you shouldnt have to suffer much thinking in potential margin calls.</p>

<p>Taking this into account, is there any reason for not trading this algo live? I can&#39;t see any at the moment (even including commissions and slippage).</p>

<p>Thanks.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54a8c0b9be5fb8bf89000379' id='54a8c0b9be5fb8bf89000379'>
<a href='#54a8c0b9be5fb8bf89000379'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1420345531000' class='quanto-date posted-at response-posted-at' href='#54a8c0b9be5fb8bf89000379'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here would be my top reason:</p>

<p>We don&#39;t know why this algo is successful. It is using the volume of ETFs, which doesn&#39;t seem like it ought to have a lot of explanatory power on the face of it. So, that fact needs to be isolated.  Furthermore, it&#39;s very sensitive to the time of day the trade is placed at, which again is a mystery - is it exploiting some intraday seasonality? Is there some sort of late-day reaction to volume in the past 24 hours?  Is this related to the effects of leveraged ETFs rebalancing?</p>

<p>Without knowing why an algo works, it&#39;s impossible to know when it has stopped working, which won&#39;t inspire confidence when it&#39;s in an expected drawdown or might incite hope when it&#39;s broken for good...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54a92e5a8523091fa1000530' id='54a92e5a8523091fa1000530'>
<a href='#54a92e5a8523091fa1000530'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549f17b4a124f8e3f800008a'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3b0daf572ffa10793bffa98967708558?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549f17b4a124f8e3f800008a'>Javier Rivaya Martos</a>
</div>
<a UTCms='1420373597000' class='quanto-date posted-at response-posted-at' href='#54a92e5a8523091fa1000530'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Well, I think that most patterns in financial markets (specially intraday patterns in price and volume) dont obey to a fundamental reason, but just to the strategy that big players are using to make money. One example is the Gold Silo strategy (short intraday long overnight), the strategy had amusing returns for about 10 years until the author of zerohedge made the strategy public and suddenly it became unprofitable (the reason is that Deutsch Bank among others retired from the strategy when it bacame public). Is there a fundamental reason to justify Gold´s higher price during the overnight session? Not at all, its just market manipulation, banks observed that lots of retail traders bought gold during the day session to sell it at the end, so banks decided to play the opposite game, move the price down intraday (when theres lots of retail volume) and make the money overnight (when there is no retail volume), this implies that banks would keep most profit from gold momentum for them. </p>

<p>So basically in my opinion, the fact that I dont find the fundamental logic behind the process doesnt let me down because the strategy seems to be robust. The strategy is robust simply because the out sample performance seems to be like the in sample one, therefore I believe the strategy is profitable (taking into account we have more than one year of out sample performance). </p>

<p>Agree?Disagree?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54a937628ba3c54b4e0003ed' id='54a937628ba3c54b4e0003ed'>
<a href='#54a937628ba3c54b4e0003ed'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1420375908000' class='quanto-date posted-at response-posted-at' href='#54a937628ba3c54b4e0003ed'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I have to agree with Simon that this algo would benefit from more development, including establishing some sort of working model that explains the performance.  This way, one can apply the scientific method of collecting evidence and either confirming the model, modifying it, or scrapping it for a new one.  In my mind, the algo results above are more of a clue that it might be worth doing a thorough study.  My suggestion is that if anyone has time on your hands, give it a go and publish your results here for review.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54a964d3b2f630afc20003b4' id='54a964d3b2f630afc20003b4'>
<a href='#54a964d3b2f630afc20003b4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4ec777fc345f20000e000008'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d1c340e13d187142fc34a5cff3a5eed5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4ec777fc345f20000e000008'>James Jack</a>
</div>
<a UTCms='1420387542000' class='quanto-date posted-at response-posted-at' href='#54a964d3b2f630afc20003b4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>My 2 cents:<br>
The market price is determined by millions of humans. Some of them think the market should rise for reason X, others think it will fall for reason Y, and some don&#39;t care which way it goes so long as you can make money from it. I don&#39;t think there is anything wrong with having a trading system which works for unknown reasons so long as the risk can be capped. One day the system will stop working, but that is probably true of most systems. So rather than let your brain demand the satisfaction of a supposedly logical answer, just trade it and realise the clock is ticking (It has been posted publicly, after all). Even if you get an answer to why you think it works, there&#39;s no way of knowing for sure.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54a99c8e11f4bc347b00012b' id='54a99c8e11f4bc347b00012b'>
<a href='#54a99c8e11f4bc347b00012b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549f17b4a124f8e3f800008a'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3b0daf572ffa10793bffa98967708558?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549f17b4a124f8e3f800008a'>Javier Rivaya Martos</a>
</div>
<a UTCms='1420401808000' class='quanto-date posted-at response-posted-at' href='#54a99c8e11f4bc347b00012b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I agree with you James. I believe this system has proven enough to give it a chance, of course limiting the risk you take based on how the system performs up to date. Also, most systems before they die they show some symptoms which can give us a clue that some unusual bahaviour is going on which should trigger our alarms, at that point I would stop trading the system without waiting for it to fail completly. The problem is some systems use such a high leverage that, when one of those negative symptoms show (eg.a drawdown never seen before or an unsual increase in volatility), the account is already blown up. Managing the risk you take (eg, using margin as a function of volatility) is always crucial when trading whatever system.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54aaf8c656c9f8e77e000472' id='54aaf8c656c9f8e77e000472'>
<a href='#54aaf8c656c9f8e77e000472'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54a2e7e31fdec861af000013'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/690e8194f1ddb4fe8cb5812619d9ff40?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54a2e7e31fdec861af000013'>Daniel Epperson</a>
</div>
<a UTCms='1420490953000' class='quanto-date posted-at response-posted-at' href='#54aaf8c656c9f8e77e000472'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>When I run this backtest, the first transaction (2014-02-03) is selling 143 shares of SPXU that are not held. The market wouldn&#39;t allow this. Why does quantopian? Maybe that is an API bug. Anyway on to the problem. </p>

<p>In your order command, it seems as though the &quot;position&quot; value even when 0 causes some shares to be sellable.  </p>

<pre><code>order(etf,(-long_short*shares)-position)  
</code></pre>

<p>Am I reading that correctly?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54aafb76828e68cfd900020e' id='54aafb76828e68cfd900020e'>
<a href='#54aafb76828e68cfd900020e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1420491642000' class='quanto-date posted-at response-posted-at' href='#54aafb76828e68cfd900020e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Daniel - presumably it is short-selling?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54ab365982de2a8ced000013' id='54ab365982de2a8ced000013'>
<a href='#54ab365982de2a8ced000013'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51d125a71144e60865000044'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b7dd86784deedc047d5ad0fb30378bdd?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51d125a71144e60865000044'>Peter Bakker</a>
</div>
<a UTCms='1420506715000' class='quanto-date posted-at response-posted-at' href='#54ab365982de2a8ced000013'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>SPXU is an ultrashort etf.... would be strange to sell the ultrashort instead of buying the SPXL. Shorting leverages etfs is very expensive. if you set set_long_only() it wont short  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54ab3d551c547ca2b6000035' id='54ab3d551c547ca2b6000035'>
<a href='#54ab3d551c547ca2b6000035'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549cf0135ed2413b280001b5'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/97aa436744edd58f961990ea084bbdf3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549cf0135ed2413b280001b5'>Adam Roder</a>
</div>
<a UTCms='1420508504000' class='quanto-date posted-at response-posted-at' href='#54ab3d551c547ca2b6000035'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>There is no API bug. Just like in real life, you are responsible for verifying that you are able to short the shares.  Checking and monitoring your own initial margin available is simple enough.</p>

<p>80k shares of SPXU are shown as available on IB, It&#39;s possible, but limited.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54ab514182de2a8ced000078' id='54ab514182de2a8ced000078'>
<a href='#54ab514182de2a8ced000078'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51d125a71144e60865000044'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b7dd86784deedc047d5ad0fb30378bdd?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51d125a71144e60865000044'>Peter Bakker</a>
</div>
<a UTCms='1420513604000' class='quanto-date posted-at response-posted-at' href='#54ab514182de2a8ced000078'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Daniel,</p>

<p>I have hacked the algo such that is does not sell short but buys the opposite. still decent performance but the code is really a hack so <em>caveat emperor</em>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54aeea71df3a1534c5000051' id='54aeea71df3a1534c5000051'>
<a href='#54aeea71df3a1534c5000051'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/546e58d3105e3cb19100012d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fd1e63e1d740c3ca9e49562c56e9616a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/546e58d3105e3cb19100012d'>Travis H</a>
</div>
<a UTCms='1420749430000' class='quanto-date posted-at response-posted-at' href='#54aeea71df3a1534c5000051'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Peter, it looks like your algo is functioning correctly for the +1.5 z-score threshold; albeit strangely in that is executes two UPRO orders individually (i.e., in the enclosed interval, 2014-02-03 two orders are placed for 59 shares instead of one, 118 share order).</p>

<p>However, at the -1.5 threshold the algo sells UPRO, again in two orders, but does not buy the short, SPXU. Instead it holds cash until the next +1.5 event. Just an FYI.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5854b85194b8d4001200061a' id='5854b85194b8d4001200061a'>
<a href='#5854b85194b8d4001200061a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57893ee5cc53bfa2d2000043'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d9253eb2a2c5c0118a7c479af42dc42f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57893ee5cc53bfa2d2000043'>ryan clous</a>
</div>
<a UTCms='1481947224000' class='quanto-date posted-at response-posted-at' href='#5854b85194b8d4001200061a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey guys I know this in an old thread, but I had some crazy results with dank meme&#39;s original leveraged etf post when I switched to SPXS, SPXL. Can someone help me update this to the most recent API. I want to integrate this strategy into robinhood after I limit the margin account  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58555a9bf840790012000bc7' id='58555a9bf840790012000bc7'>
<a href='#58555a9bf840790012000bc7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1481988768000' class='quanto-date posted-at response-posted-at' href='#58555a9bf840790012000bc7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ryan,</p>

<p>The algo is pretty dated.  I&#39;d recommend starting with a fresh sheet of paper and doing some major re-factoring (I have some other stuff to do).  You might take a more fundamental approach to understand what might be going on in the first place, by using the research platform to understand if there is actually any information to trade off of.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58556c61e272e1571d000221' id='58556c61e272e1571d000221'>
<a href='#58556c61e272e1571d000221'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57893ee5cc53bfa2d2000043'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d9253eb2a2c5c0118a7c479af42dc42f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57893ee5cc53bfa2d2000043'>ryan clous</a>
</div>
<a UTCms='1481993321000' class='quanto-date posted-at response-posted-at' href='#58556c61e272e1571d000221'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Grant, I just started writing this weekend, so I&#39;m having hard time understanding what is the theory for the original quant. To my best understanding, it buys/sells based off minutely data with portfolio%= (price-mean/std)/1.5 for long and short positions respectively? And then normalizing the z score (price-mean/std) with dollar volume?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='585599341269a4001200002e' id='585599341269a4001200002e'>
<a href='#585599341269a4001200002e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1482004794000' class='quanto-date posted-at response-posted-at' href='#585599341269a4001200002e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ryan -</p>

<p>There was no &quot;theory&quot; behind my hack.  I just decided to try something.  The basic idea was that since SPY &amp; SH are trading off of the same underlying S&amp;P 500, they should track closely on a dollar-volume basis, and when they do not, maybe there is some useful information.  If you are just trying to get a feel for the platform, it is as good a starting place as any, but there was no deep thinking or careful analysis involved in the original formulation.  And as other posters point out, in practice, it may not work at all.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5855dc3c1269a40012000399' id='5855dc3c1269a40012000399'>
<a href='#5855dc3c1269a40012000399'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57893ee5cc53bfa2d2000043'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d9253eb2a2c5c0118a7c479af42dc42f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57893ee5cc53bfa2d2000043'>ryan clous</a>
</div>
<a UTCms='1482021954000' class='quanto-date posted-at response-posted-at' href='#5855dc3c1269a40012000399'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Greg,</p>

<p>This is a pretty old thread, or I wouldn&#39;t change the subject, but I think I have stumbled onto a useful indicator formula.<br>
Check it out and see if you can find it useful, but it kind of goes like this:<br>
Dma= day moving average<br>
std = 50dma standard deviation<br>
<strong>(20dma -  50dma)/(2*std ) = x</strong>  </p>

<p>2*std is the bollinger band, by dividing it I can detect squeezes. For SPY,  a large value above around 1.9 seems to detect large random drops, but has to take a while to reset and find the next drop. Buying below zero seems to fair well as it is below the 50dma.  Shorting with SPXL  and closing after 5 days on those drops really seemed to boost returns significantly.  It did detect one instance when it wasn&#39;t supposed to, but if you set a timer with that counts days holding cash/60 that increases the buy threshold to a max 0.5 it will buy back in accordingly.</p>

<p>Just what my project has been for the last couple of days. Had bugs in my minutely versions and might scratch it for a new one. Just thought I&#39;d share.</p>

<p>Best,<br>
RC  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5855dcf24df32800150003d0' id='5855dcf24df32800150003d0'>
<a href='#5855dcf24df32800150003d0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57893ee5cc53bfa2d2000043'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d9253eb2a2c5c0118a7c479af42dc42f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57893ee5cc53bfa2d2000043'>ryan clous</a>
</div>
<a UTCms='1482022135000' class='quanto-date posted-at response-posted-at' href='#5855dcf24df32800150003d0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>ha just realized I made a z-score  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='585669e54df3280015000a69' id='585669e54df3280015000a69'>
<a href='#585669e54df3280015000a69'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1482058222000' class='quanto-date posted-at response-posted-at' href='#585669e54df3280015000a69'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I think this falls into the general category of &quot;ETF arbitrage&quot; (e.g. <a href="http://www.investopedia.com/articles/investing/032615/how-etf-arbitrage-works.asp?lgl=bt1tn-above-textnote">http://www.investopedia.com/articles/investing/032615/how-etf-arbitrage-works.asp?lgl=bt1tn-above-textnote</a> ), in case you are wanting to dig into it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58568ba41269a40012000bb8' id='58568ba41269a40012000bb8'>
<a href='#58568ba41269a40012000bb8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1482066861000' class='quanto-date posted-at response-posted-at' href='#58568ba41269a40012000bb8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ryan -</p>

<p>FYI -</p>

<p><a href="https://www.quantopian.com/posts/analysis-of-minute-bar-trading-volumes-of-the-etfs-spy-and-sh">https://www.quantopian.com/posts/analysis-of-minute-bar-trading-volumes-of-the-etfs-spy-and-sh</a></p>

<p>There&#39;s probably some way to apply the Quantopian alphalens thingy here, as well, if you formulate the &quot;alpha factor&quot; appropriately:</p>

<p><a href="https://www.quantopian.com/posts/alphalens-a-new-tool-for-analyzing-alpha-factors">https://www.quantopian.com/posts/alphalens-a-new-tool-for-analyzing-alpha-factors</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5856b7154ac03e678b000a53' id='5856b7154ac03e678b000a53'>
<a href='#5856b7154ac03e678b000a53'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/571d1bab2616ef09ce0002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a69e9457dd2832a76875bcae334d5baf?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/571d1bab2616ef09ce0002b6'>Dan Whitnable</a>
</div>
<a UTCms='1482077981000' class='quanto-date posted-at response-posted-at' href='#5856b7154ac03e678b000a53'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I also don&#39;t want to change the thread topic here too much. One theme however, throughout, is why dollar-volume would have any predictive ability with ETFs? Grant found an interesting correlation.</p>

<p>One way to look at index ETFs is that their price is simply a convenient way to track an index. The market makers for an ETF do their best to keep the price tracking pretty close to the underlying index or basket of stocks. One could create a factor to calculate this same thing directly from the stocks (in theory). Does the the price of an ETF therefore have any &#39;new&#39; informational value? No.  Also, the price is completely historical. For the technical traders out there, that is all that matters and past prices DO predict the future. As for me, I&#39;m a little skeptical. </p>

<p>Note therefore, that index ETFs don&#39;t follow the same rules of supply and demand as regular securities. If there was a huge demand for a security it&#39;s price would go up. Conversely, if there was little demand, the price would go down. Index ETFs, however, have their price set &#39;artificially&#39; to an external index. Index ETF volume is independent of price. If more people buy into an index ETF it&#39;s price doesn&#39;t necessarily go up (and vice-versa). There is no &#39;feedback&#39; to influence the volume. Volume becomes almost a true &#39;independent&#39; variable. Index ETF volume IS new information.</p>

<p>If a lot of people think a stock will go up (or a group of stocks like the S&amp;P500), then they would all buy in hopes of making a profit. However, that profit is put in check by the Adam Smiths supply-demand  rules. As they buy the price goes up. As the price goes up their returns go down. </p>

<p>Now, think of the case of an index ETF. A lot of people think the S&amp;P500 will go up and buy SPY. As they buy there is no impact on SPY, or for that matter, no impact on the S&amp;P500. The returns on their bet the S&amp;P500 will go up aren&#39;t impacted by this volume.</p>

<p>I conjecture that index ETF volume is a good predictor of market sentiment and could be a future indicator. </p>

<p>As an aside, volume seems to be an under-utilized metric in general. Looking over the algorithms posted on the forums here virtually none use volume to derive factors other than in conjunction with price to get dollar-volume. I randomly took some of my algorithms and globally replaced &#39;close_price&#39;  with &#39;volume&#39; - even for a factors like returns or volatility. The results were never too dissimilar and, in many cases, actually better. Go figure.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5856c5308c23800012000d1a' id='5856c5308c23800012000d1a'>
<a href='#5856c5308c23800012000d1a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1482081589000' class='quanto-date posted-at response-posted-at' href='#5856c5308c23800012000d1a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Dan -</p>

<blockquote>
<p>I also don&#39;t want to change the thread topic here too much.</p>
</blockquote>

<p>As the originator of the thread, I&#39;d say your comments are right on the mark!  For example, in the limit that SPY volume goes to zero, or captures all of the market volume, there would be some information, I&#39;d think.  So, more modest changes in SPY volume (perhaps relative some other indicator) might carry information, as well.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a50da439ce3d000d912571' id='58a50da439ce3d000d912571'>
<a href='#58a50da439ce3d000d912571'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5866cd23ff2002001200016c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2116e4ddae90ff54a84bb81f2bbbce11?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5866cd23ff2002001200016c'>tony hussey</a>
</div>
<a UTCms='1487211940000' class='quanto-date posted-at response-posted-at' href='#58a50da439ce3d000d912571'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant, do you know why there are so many unfilled orders eod in the backtest?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a56ed739ce3d2d9f912352' id='58a56ed739ce3d2d9f912352'>
<a href='#58a56ed739ce3d2d9f912352'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1487236823000' class='quanto-date posted-at response-posted-at' href='#58a56ed739ce3d2d9f912352'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Tony,</p>

<p>No, not sure why there are unfilled orders.  You might try turning off the slippage.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a5c709816d11000d47c72c' id='58a5c709816d11000d47c72c'>
<a href='#58a5c709816d11000d47c72c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1487259401000' class='quanto-date posted-at response-posted-at' href='#58a5c709816d11000d47c72c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Some tools added to the original code. Partial fills are visible in the logging window.<br>
Move trading earlier toward market open to reduce those.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a5c76cba534451e9cc644c' id='58a5c76cba534451e9cc644c'>
<a href='#58a5c76cba534451e9cc644c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1487259500000' class='quanto-date posted-at response-posted-at' href='#58a5c76cba534451e9cc644c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ryan, some fixes you requested plus scheduling. A start to simplify zscore normalization.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a5cc3eba534451e9cc64a5' id='58a5cc3eba534451e9cc64a5'>
<a href='#58a5cc3eba534451e9cc64a5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56a003d3eb9a502cc40000d7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3d1e920b94af6976544310a8f9432e34?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56a003d3eb9a502cc40000d7'>Tyler Wilson</a>
</div>
<a UTCms='1487260734000' class='quanto-date posted-at response-posted-at' href='#58a5cc3eba534451e9cc64a5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>p = pd.rolling_mean(context.prices,window_roll)[window_roll-1:]<br>
 v = pd.rolling_sum(context.volumes,window_roll)[window_roll-1:]</p>

<p>are going away - how do we replace these?  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/spy-and-sh-minute-data'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/spy-and-sh-minute-data'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#dcbab9b9b8bebdbfb79cada9bdb2a8b3acb5bdb2f2bfb3b1">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

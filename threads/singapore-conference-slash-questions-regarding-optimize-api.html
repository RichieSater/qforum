<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
Singapore Conference / Questions Regarding Optimize API
</title>
<meta content='Dear All, A big thank you to the entire Quantopian team for a very well organized conference.  I gained valuable insights every day, and I look forward to being able to read the presentation decks of the many speakers that I missed (with 4 presentation streams to choose from every hour on Friday, I had to make some very difficult choices). While I had only half the time for the hackathon (I had to leave at 1:30pm to catch my flight back to Hong Kong), I really appreciated being &quot;forced&quot; to...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="MyEtaHY8/HuwNhLp31Vx1ytTmJWZCpJ0yvzUz+bq7uNPR1sl1MoumAkrS9iQutmjE927/OPGh29I8w+lTK+MWA==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/singapore-conference-slash-questions-regarding-optimize-api' property='og:url'>
<meta content='Singapore Conference / Questions Regarding Optimize API' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/singapore-conference-slash-questions-regarding-optimize-api' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='Singapore Conference / Questions Regarding Optimize API' property='og:title'>
<meta content='Dear All, A big thank you to the entire Quantopian team for a very well organized conference.  I gained valuable insights every day, and I look forward to being able to read the presentation decks of the many speakers that I missed (with 4 presentation streams to choose from every hour on Friday, I had to make some very difficult choices). While I had only half the time for the hackathon (I had to leave at 1:30pm to catch my flight back to Hong Kong), I really appreciated being &quot;forced&quot; to...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/singapore-conference-slash-questions-regarding-optimize-api">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='59d0524dae9c6b000df01ef8'>
<div class='post-container' data-post-id='59d0524dae9c6b000df01ef8' id='59d0524dae9c6b000df01ef8'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>Singapore Conference / Questions Regarding Optimize API</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58bcd705e57c67000a346680'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6ddd8fcec7899e4882e1c60af5211972?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58bcd705e57c67000a346680'>Mattias Lamotte</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1506824781000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=Singapore Conference / Questions Regarding Optimize API&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fsingapore-conference-slash-questions-regarding-optimize-api%3Futm_source%3Dwebsite_share%26utm_campaign%3Dsingapore-conference-slash-questions-regarding-optimize-api%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fsingapore-conference-slash-questions-regarding-optimize-api%3Futm_source%3Dwebsite_share%26utm_campaign%3Dsingapore-conference-slash-questions-regarding-optimize-api%26utm_medium%3Dlinkedin&amp;title=Singapore+Conference+%2F+Questions+Regarding+Optimize+API+%28Mattias+Lamotte%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class='tags tag-row'>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Stat Arb' data-tag-id='55d33f863f6ba10065000003' href='/posts/tag/Stat-Arb/newest'>Stat Arb</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Visualization' data-tag-id='56d0b532f8f0e57992000001' href='/posts/tag/Visualization/newest'>Visualization</a>
</div>
<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/singapore-conference-slash-questions-regarding-optimize-api?utm_source=website_share&amp;utm_campaign=singapore-conference-slash-questions-regarding-optimize-api&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Mattias Lamotte" />
<div class='body-text'>
<div class='body-text-container post-body'><p>Dear All,</p>

<p>A big thank you to the entire Quantopian team for a very well organized conference.  I gained valuable insights every day, and I look forward to being able to read the presentation decks of the many speakers that I missed (with 4 presentation streams to choose from every hour on Friday, I had to make some very difficult choices).</p>

<p>While I had only half the time for the hackathon (I had to leave at 1:30pm to catch my flight back to Hong Kong), I really appreciated being &quot;forced&quot; to use some of the key zipline APIs in an environment where I had all these experts ready to answer my questions. I definitely feel that I significantly improved my understanding of pipeline custom factors and the optimize API thanks to the Hackathon.</p>

<p>As I knew I had a very short amount of time for the hackathon (I only had 2.5hours), I decided that it made a lot more sense to start from something that was already satisfying competition criteria and was already working. I therefore just cloned the long/short example from Delaney&#39;s lectures as a starting point. I just replaced the value factor with a custom factor for earnings growth. I then made minor adjustments to the momentum factor and I transformed the momentum factor ranking using a quadratic manipulation (to lower the ranking score of the top ranked scores - Alpha lens analysis showed me that 1yr momentum is a reliable and persistent factor, but it&#39;s not linear as the top quintile of momentum ranked stocks are all over the place depending on different time periods. Momentum leadership downwards persists a lot more than leadership upwards...).</p>

<p>While I&#39;m sure that my very minor changes caused a weird bug, I was stunned that backtested returns were so volatile with more than 300 positions at all times, and a net exposure close to 0. How can a very diversified market neutral portfolio with a gross exposure close to 100% lose around 14% between December 28 and December 29 2016. Something is really weird! If only I could understand the magic done by the Optimize API, it would be a lot easier to debug this type of algo. I guess the first step would be to look at all the individual positions held when this big drawdown occured, but that seems quite time consuming with close to 400 positions...</p>

<p>Any advice on this would be greatly appreciated.</p>

<p>Best,</p>

<p>Mattias  </p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>29 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='59d26c350550e4611886f532' id='59d26c350550e4611886f532'>
<a href='#59d26c350550e4611886f532'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1506962485000' class='quanto-date posted-at response-posted-at' href='#59d26c350550e4611886f532'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>With a monthly snapshot I&#39;m seeing HERO as an outlier in pnl as of 12-2015 at -40k (with next nearest CONN at -3.3k). It delisted 6-2016.<br>
At the dip toward the end, PVAC shows up at -152k when CONN is -5.4k. PVAC is short while the price goes from 5 to 49.<br>
Maybe verify data with any splits are ok on both of those and then experiment with modifying the factors and try other factors.<br>
If factors for example had PVAC going long instead of short, that would have been great.<br>
Stocks on both ends of the pnl win/loss spectrum tend to be short more than long.</p>

<p>As a <strong>temporary</strong> diagnostic <strong>test</strong> just to see the difference it would make you can tell optimize to ignore those two stocks:</p>

<pre><code>constraints.append(opt.CannotHold([symbol(&#39;HERO&#39;), symbol(&#39;PVAC&#39;)]))  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59d278d20550e45a7d86f6df' id='59d278d20550e45a7d86f6df'>
<a href='#59d278d20550e45a7d86f6df'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58bcd705e57c67000a346680'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6ddd8fcec7899e4882e1c60af5211972?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58bcd705e57c67000a346680'>Mattias Lamotte</a>
</div>
<a UTCms='1506965714000' class='quanto-date posted-at response-posted-at' href='#59d278d20550e45a7d86f6df'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks for taking the time to take a look at this crazy backtest. </p>

<p>I definitely need to play around with the constraints. Also, probably having some kind of stop loss on the shorts would make sense as right now the model just picks stocks once per month and does nothing until a month later.</p>

<p>Shorts inherently will have bigger negative tail risks and lower positive tail outcomes than longs (unlimited loss, limited gain vs unlimited gain, limited loss for longs). Risk control methods to limit large losses on shorts usually pay off over time...</p>

<p>Right now, I have to say that I&#39;m not yet that comfortable with the optimize() API. I&#39;d prefer to first develop an equal weighted strategy that works with order_percent(), and only after I can see that it works try to get it working with optimize().  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59d3b8bf004d671354f4dbdd' id='59d3b8bf004d671354f4dbdd'>
<a href='#59d3b8bf004d671354f4dbdd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1507047615000' class='quanto-date posted-at response-posted-at' href='#59d3b8bf004d671354f4dbdd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Mattias,</p>

<p>You&#39;re running into a few interesting problems simultaneously.</p>

<p>As others have noted in the thread, your two big drawdowns are caused by short positions in penny stocks (HERO and PVAC), that experienced major spikes upward while your algo held a short position.  That should be surprising, however, because your algorithm is trying to filter down to stocks with prices greater than 5 dollars during its universe construction, so your algorithm probably wasn&#39;t meant to be holding those positions in the first place.</p>

<p>Your algorithm ends up holding shorts in those penny stocks because of how the optimizer handles positions that are in your portfolio but not in the vector of alphas you passed to <code>MaximizeAlpha</code>. The optimizer needs to assume some alpha value for the assets that dropped out of your universe, because we need to calculate a new target portfolio, which might have to include those assets (we can&#39;t simply exit those positions because you might have, say, a <code>MaxTurnover</code> constraint).  The current implementation assumes an alpha value of zero for assets that weren&#39;t provided to <code>MaximizeAlpha</code>.  That assumption works out poorly for your algorithm, because all of your alpha values are positive (as a side note, generally speaking you want negative alpha values for your expected shorts and positive alphas for your expected longs), so the optimizer ends up using the assets that have dropped out of your portfolio as hedges against your other positions.  Needless to say, this isn&#39;t the behavior anyone wants or expects.  We&#39;re currently investigating ways of making <code>MaximizeAlpha</code> handle these cases better.</p>

<p>The other problem you&#39;re running into is that <code>PVAC</code> was actually delisted for about a year during the period where your algorithm held it.  Normally the backtester would automatically liquidate the delisted position, but we don&#39;t currently model the case where an asset is listed, gets delisted, and then subsequently gets <strong>re-</strong>listed (the backtester just sees this as a long period of zero volume and no price changes).  When <code>PVAC</code> re-lists, it does so at a totally different price, likely because the company re-capitalized and/or experienced other corporate actions that we don&#39;t have because they occurred while the company wasn&#39;t publicly traded.</p>

<p>I&#39;ve attached a notebook with a more in-depth analysis of the issues I just outlined.  The notebook also makes use of the pretty wide variety of tools available for investigating backtests in research, which hopefully makes for an interesting case study.  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='59d45bd4afdd090010c93459' id='59d45bd4afdd090010c93459'>
<a href='#59d45bd4afdd090010c93459'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58bcd705e57c67000a346680'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6ddd8fcec7899e4882e1c60af5211972?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58bcd705e57c67000a346680'>Mattias Lamotte</a>
</div>
<a UTCms='1507089364000' class='quanto-date posted-at response-posted-at' href='#59d45bd4afdd090010c93459'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Wow! Thank you Scott! You spent a lot of time on this!</p>

<p>I have never used the backtest tearsheets before, but I can immediately see their huge value in this scenario. I&#39;m going to study your notebook carefully to use it as a template in the future. In addition to the largest long and short positions of the backtest period, it would be cool to have a table that could give me individual positions responsible for largest P&amp;L moves (they are usually correlated but not exactly the same as largest positions). The rolling Fama single factors chart is unbelievably cool! Really useful to identify which factors are working and when they are working!</p>

<p>Now, I understand why things started going wrong when I removed the zscore() in order to make my quadratic manipulation. In the workshop last week, one of the people in my table commented to Delaney that Rank and Zscore were serving the same purpose in terms of normalizing the values and were not both really necessary in this case. In reality, the Zscore() call was used as a quick way to transform half the rankings around a 0 mean with half the population with negative values...</p>

<p>While I understand that optimize() needs to keep track of old universe values to effectively get rid of them after they are no longer part of the universe, I think it would make a lot of sense to have a constraint that can force optimize() to only have active positions in stocks that do not have an absolute 0 vector passed into MaximizeAlpha().</p>

<p>Thanks again for spending so much time to respond to my query.</p>

<p>Best,</p>

<p>Mattias  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59d5085ce5e8ae000de0fc55' id='59d5085ce5e8ae000de0fc55'>
<a href='#59d5085ce5e8ae000de0fc55'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1507133532000' class='quanto-date posted-at response-posted-at' href='#59d5085ce5e8ae000de0fc55'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>While I understand that optimize() needs to keep track of old universe values to effectively get rid of them after they are no longer part of the universe, I think it would make a lot of sense to have a constraint that can force optimize() to only have active positions in stocks that do not have an absolute 0 vector passed into MaximizeAlpha().</p>
</blockquote>

<p>My current thinking on this is that MaximizeAlpha needs to have a separate (much more strongly-weighted) term in its optimization to account for the desire to exit positions in assets no longer in the the trading universe.  Right now, the core of <code>MaximizeAlpha</code> builds a <a href="http://www.cvxpy.org/en/latest/">CVXPY</a> objective by doing, roughly:</p>

<pre><code>cvxpy_objective = cvx.Maximize(new_weights.T * alphas)  
</code></pre>

<p>There&#39;s really no way in this formulation to express a desire to not hold an asset.  Better would be something like:</p>

<pre><code>expected_alpha = new_weights.T * alphas  
# Penalize continuing to hold positions in assets that aren&#39;t in our alphas.  
penalty_coefficients = [0 if asset in alphas.index else LARGE_NUMBER  
                        for asset in current_weights.index]  
non_universe_penalty = cvx.abs(new_weights.T) * np.array(penalty_coefficients)  
cvxpy_objective = cvx.Maximize(expected_alpha - non_universe_penalty)  
</code></pre>

<p>The idea here is to use the <code>non_universe_penalty</code> term to penalize the magnitude of any held position for which an alpha wasn&#39;t supplied.  If <code>LARGE_NUMBER</code> is sufficiently large relative to alpha values (doing this correctly probably requires re-scaling of <code>alphas</code>, which is safe as long as you just multiply every alpha by the same constant), then in practice the penalty operates like a constraint unless incurring the penalty is necessary to satisfy a constraint.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='59d6543ffc26f4000dd95cf4' id='59d6543ffc26f4000dd95cf4'>
<a href='#59d6543ffc26f4000dd95cf4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4fe8beb792a029000200000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fe3ffe502559d05f16eb9fe41ab7e9a1?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4fe8beb792a029000200000d'>Dan Dunn</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1507218495000' class='quanto-date posted-at response-posted-at' href='#59d6543ffc26f4000dd95cf4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Holy cow.  Scott, that notebook is amazing.  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='59d66bfa778519000d6dd6cd' id='59d66bfa778519000d6dd6cd'>
<a href='#59d66bfa778519000d6dd6cd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1507224570000' class='quanto-date posted-at response-posted-at' href='#59d66bfa778519000d6dd6cd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Scott, that is really a great notebook. Thanks.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59d75e407a4fff000d189045' id='59d75e407a4fff000d189045'>
<a href='#59d75e407a4fff000d189045'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1507286592000' class='quanto-date posted-at response-posted-at' href='#59d75e407a4fff000d189045'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott -</p>

<blockquote>
<p>generally speaking you want negative alpha values for your expected shorts and positive alphas for your expected longs</p>
</blockquote>

<p>I haven&#39;t digested all of this, but I&#39;d assumed that the Optimize API could be fed normalized alphas that are not demeaned.  But I think you are saying if the input is not demeaned, then stocks that should be reduced in weight will be highly weighted (since you are setting the alpha values of stocks not in the universe to zero)?  Is this the correct interpretation?</p>

<p>Is a work-around simply to demean the input to the Optimize API?</p>

<p>Also, what does 
<code>order_optimal_portfolio</code> do?  I&#39;d expected that it would attempt to close out any positions of stocks not in the current universe, with a separate set of orders:</p>

<pre><code>for stock in context.portfolio.positions.keys():  
        if stock not in universe:  
            if data.can_trade(stock):  
                order_target_percent(stock,0)  
</code></pre>

<p>But apparently not.  I guess I&#39;m unclear how stocks get dropped from the universe without code similar to what I have above.</p>

<p>Wouldn&#39;t you simply run the optimize API on the current universe only, and then close out any positions not in the universe?  Or is the paradigm that changes in the universe shouldn&#39;t dictate changes in positions?</p>

<p>If one wanted to assure stocks dropped from the universe are actually dropped, would it mean running a separate routine, prior to the final optimize API run, to close out positions of stocks no longer in the universe?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59d7682aff4d08000d4731ba' id='59d7682aff4d08000d4731ba'>
<a href='#59d7682aff4d08000d4731ba'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1507289130000' class='quanto-date posted-at response-posted-at' href='#59d7682aff4d08000d4731ba'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Regarding the listing-de-listing-listing issue, when a stock gets listed, shouldn&#39;t it be assigned a new SID?  Wouldn&#39;t this solve the problem?  If a stock gets de-listed, then when it is re-listed, I&#39;d think a new SID would be appropriate.  Even if it subsequently trades under the same symbol, as soon as it disappears, within Quantopian, one has no visibility of it.  It is effectively a new issue when it gets re-listed, right?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59d76e532211d3000ddf76ee' id='59d76e532211d3000ddf76ee'>
<a href='#59d76e532211d3000ddf76ee'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5929c5f4a76c22000d329d92'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5ec18483d35ccb497ca800f820998851?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5929c5f4a76c22000d329d92'>Leo M</a>
<span class='badge medal'></span>
</div>
<a UTCms='1507290707000' class='quanto-date posted-at response-posted-at' href='#59d76e532211d3000ddf76ee'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Injecting stocks into the pipeline from within order_optimal_portfolio with zero alphas can have a lot of unintended and random consequences. Please fix this  issue or alternately expose a flag to only rank pipeline and not add positions to it (which should be default behavior everybody expects). </p>

<p>Not sure why in the code we are adding existing positions to optimize routine. If we do optimize on just the pipeline stocks and add a routine at the end to close out any positions that are not in pipeline, it should achieve the intuitive and expected behavior of order_optimal_portfolio.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59d77436f9e9960cd73f9f09' id='59d77436f9e9960cd73f9f09'>
<a href='#59d77436f9e9960cd73f9f09'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1507292214000' class='quanto-date posted-at response-posted-at' href='#59d77436f9e9960cd73f9f09'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>It all depends on what one wants to achieve with the Optimize API and 
<code>order_optimal_portfolio</code>.  Looking at <a href="https://blog.quantopian.com/a-professional-quant-equity-workflow/">https://blog.quantopian.com/a-professional-quant-equity-workflow/</a>, there is an element of risk management in this step, so even though the universe changes, it may be too risky to make a dramatic change all at once.  Optimization might require holding onto stocks no longer in the universe (but then how does one eventually exit them definitively?).  However, this could end up being belt-and-suspenders, since presumably Q is cobbling together the orders from various Q fund algos and applying another layer of constrained optimization, where they could apply such risk management, and also their prime broker could do it, too, depending on what functionality is included in the Execution step on <a href="https://blog.quantopian.com/a-professional-quant-equity-workflow/">https://blog.quantopian.com/a-professional-quant-equity-workflow/</a>.</p>

<p>I&#39;d say keep the backtester straightforward and intuitive, and push the business of how to close out positions no longer in the universe to the fund construction and execution steps.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59d78df0aad65c5b6c2efe4c' id='59d78df0aad65c5b6c2efe4c'>
<a href='#59d78df0aad65c5b6c2efe4c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5929c5f4a76c22000d329d92'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5ec18483d35ccb497ca800f820998851?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5929c5f4a76c22000d329d92'>Leo M</a>
<span class='badge medal'></span>
</div>
<a UTCms='1507298800000' class='quanto-date posted-at response-posted-at' href='#59d78df0aad65c5b6c2efe4c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>What everybody wants and expects should be supported in a code path via the default behavior or through a flag. </p>

<p>We rather deal with the problem of ranking stocks in the pipeline according to our algorithm and getting a resultant portfolio based solely on what we ranked, rather than have to deal with the complexity of non-pipeline stocks lingering around in the portfolio for reasons we cannot possibly comprehend or deal with in our ranking algorithms.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59d8d170702609000d493598' id='59d8d170702609000d493598'>
<a href='#59d8d170702609000d493598'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5929c5f4a76c22000d329d92'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5ec18483d35ccb497ca800f820998851?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5929c5f4a76c22000d329d92'>Leo M</a>
<span class='badge medal'></span>
</div>
<a UTCms='1507381616000' class='quanto-date posted-at response-posted-at' href='#59d8d170702609000d493598'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here is an example strategy that illustrates why it will be problematic to optimize by merging positions into pipeline using zero alpha.</p>

<p>Say your pipeline filter is for stocks &gt; 5 equity price plus some other filters<br>
Your alphas/pipeline weights are 1 day returns<br>
You enter short 10 of the smallest returns and long 10 of the largest returns<br>
If the stocks from prior day positions fall below 5 then they are filtered in the pipeline and not ranked<br>
If optimizer sets zero alphas to them (&lt;5 priced prior day stock positions) then on days when there is up market and all stocks in the rest of your universe are up we will be entering shorts on positions from prior day that are &lt; 5 and zero alpha (meaning lowest weight). That will be contrary to the algorithm strategy and no way to work around it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59d8d9cdc675c34ced33834e' id='59d8d9cdc675c34ced33834e'>
<a href='#59d8d9cdc675c34ced33834e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/598a1a0d40da7032bc27e6f6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3d7776b021cbcd0f62b56acb7de7a354?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/598a1a0d40da7032bc27e6f6'>Ivory Ant</a>
</div>
<a UTCms='1507383757000' class='quanto-date posted-at response-posted-at' href='#59d8d9cdc675c34ced33834e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hmm I always thought <code>order_optimal_portfolio()</code> would liquidate all positions not in the weights vector.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59da3c828c3e52000d4ab202' id='59da3c828c3e52000d4ab202'>
<a href='#59da3c828c3e52000d4ab202'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1507474562000' class='quanto-date posted-at response-posted-at' href='#59da3c828c3e52000d4ab202'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Scott -</p>

<p>Within CVXPY, wouldn&#39;t it simply be a matter of adding hard constraints?  For example, 
<code>x[0] == 0</code>, where <code>x[0]</code> is the weight for a stock that should not be held?  Wouldn&#39;t this force zeros where they should be, or result in an exception if a solution can&#39;t be found?  It just seems like it would be a more definite approach, unless you are seeing the need to provide users with the ability to set the <code>LARGE_NUMBER</code> you describe above?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59dd2a9454a214000d09a030' id='59dd2a9454a214000d09a030'>
<a href='#59dd2a9454a214000d09a030'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1507666580000' class='quanto-date posted-at response-posted-at' href='#59dd2a9454a214000d09a030'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant</p>

<blockquote>
<p>I haven&#39;t digested all of this, but I&#39;d assumed that the Optimize API could be fed normalized alphas that are not demeaned. But I think you are saying if the input is not demeaned, then stocks that should be reduced in weight will be highly weighted (since you are setting the alpha values of stocks not in the universe to zero)? Is this the correct interpretation?</p>
</blockquote>

<p>The answer to this question depends on what constraints are being applied.</p>

<p>In general, the behavior of <code>MaximizeAlpha</code> is that, given a vector of alpha values, <code>a[0], a[1], ..., a[N]</code>, we find a vector of new target portfolio weights, <code>w[0], w[1], ..., w[N]</code> that maximizes <code>a[0] * w[0] + a[1] * w[1], ...  a[N] * w[N]</code> while respecting any additional constraints that have been supplied.  </p>

<p>Some observations that fall out of that mathematical definition are:</p>

<ol>
<li>Without any additional constraints, <code>MaximizeAlpha</code> can&#39;t produce a portfolio at all, because there&#39;s no upper bound on the function it&#39;s trying to maximize.<br></li>
<li>With just a <code>MaxGrossLeverage</code> constraint, <code>MaximizeAlpha</code> will allocate all of its capital to the asset with the largest alpha magnitude, going short if the sign of that alpha is negative, and going long if the sign of that alpha is positive.<br></li>
<li>With just <code>MaxGrossLeverage</code> and <code>PositionConcentration</code>, <code>MaximizeAlpha</code> will proceed through the assets in order of alpha magnitude, allocating the maximum-size long or short position to each, depending on the sign of the alpha value.  One implication of this is that <strong>if you use ranks as your &quot;alphas&quot; you&#39;ll always end up with a long-only portfolio with these constraints</strong>.<br></li>
<li>With <code>MaxGrossLeverage</code>, <code>PositionConcentration</code>, and <code>DollarNeutral</code> constraints, the behavior of <code>MaximizeAlpha</code> ends up being roughly what you&#39;d get from an algorithm like: &quot;Choose the N largest and N smallest assets by alpha value and allocate the maximum-size long to the largest assets and the maximum-size short to the smallest assets.&quot;  This is where we run afoul of <code>MaximizeAlpha</code>&#39;s current behavior of assuming an alpha value of zero  for assets with no alpha provided.  If all the provided alphas are greater than zero, then the &quot;N smallest assets&quot; are all the zeros that we inserted for the assets that weren&#39;t provided, which makes them the most attractive targets for short positions.</li>
</ol>

<p>As you add in additional constraints, the behavior becomes more complex to describe succinctly.  One intuition that I find helpful is to think of each constraint as defining one or more  <strong>&quot;budgets&quot;</strong> that positions contribute to at different rates, and to think of the alpha vector you provide to <code>MaximizeAlpha</code> as defining the amount of <strong>&quot;value&quot;</strong> you get from holding a unit of each asset.  The goal of the optimizer when using <code>MaximizeAlpha</code> is to produce the portfolio with the largest amount of value that still respects all the budgets impose by the constraints.</p>

<p>One thing that&#39;s important to stress is that the sign and magnitude of <code>alphas</code> matter, because they determine how attractive <code>MaximizeAlpha</code>considers each asset as it&#39;s deciding how best to make use of its budgets.  In particular, assets with positive alpha values are attractive to hold, assets with negative alpha values are attractive to hold short.</p>

<p>The best way I&#39;ve found for building intuition about how the optimizer responds to different inputs is to set up simple test cases in a notebook (like the ones in the middle section of the notebook I posted above) and see how the result of the optimization changes as I change inputs.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='59dd2c6f54ea04000f27a18b' id='59dd2c6f54ea04000f27a18b'>
<a href='#59dd2c6f54ea04000f27a18b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1507667055000' class='quanto-date posted-at response-posted-at' href='#59dd2c6f54ea04000f27a18b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>A few people in the thread have asked why the optimizer doesn&#39;t just close out positions in any assets not provided in the alpha vector.  In general, we can&#39;t do that because there may be constraints (e.g. a user-provided <code>MaxTurnover</code> constraint) that prevent us from completely closing out an existing position.  The penalty term version I&#39;ve outlined above has the same behavior as a hard constraint in all the cases where it&#39;s possible to do so, but it also makes a best effort in cases where completely closing out the target positions would conflict with another hard constraint.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='59dde18c53a72a000d849784' id='59dde18c53a72a000d849784'>
<a href='#59dde18c53a72a000d849784'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1507713420000' class='quanto-date posted-at response-posted-at' href='#59dde18c53a72a000d849784'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Scott -</p>

<blockquote>
<p>One thing that&#39;s important to stress is that the sign and magnitude of alphas matter</p>
</blockquote>

<p>It seems like you&#39;d want a standard preprocessing step for alphas (consistent with what is done in ML).  For example:</p>

<pre><code>from sklearn import preprocessing  
import numpy as np

def preprocess(a):  
    a = np.nan_to_num(a - np.nanmean(a))  
    # return preprocessing.robust_scale(a) # security violation  
    return preprocessing.scale(a)  
</code></pre>

<p>Lots of alternatives listed here:</p>

<p><a href="http://scikit-learn.org/stable/modules/preprocessing.html">http://scikit-learn.org/stable/modules/preprocessing.html</a></p>

<p>(although perhaps not all available yet on Q)</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59ddeadb7f42e67ac5211e08' id='59ddeadb7f42e67ac5211e08'>
<a href='#59ddeadb7f42e67ac5211e08'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1507715803000' class='quanto-date posted-at response-posted-at' href='#59ddeadb7f42e67ac5211e08'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>The penalty term version I&#39;ve outlined above has the same behavior as a hard constraint in all the cases where it&#39;s possible to do so, but it also makes a best effort in cases where completely closing out the target positions would conflict with another hard constraint.</p>
</blockquote>

<p>It would seem that the scale of the penalty term would matter (e.g. for a sufficiently large penalty, I&#39;d think that the turnover constraint wouldn&#39;t work on non-universe stocks).  How would users know how to set it?</p>

<p>Seems overly complicated.  The universe shouldn&#39;t be changing that frequently anyway, so its contribution to turnover should be minimal.  It would be more intuitive simply to close positions no longer in the universe.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59ddf7f153a72a000d849aa3' id='59ddf7f153a72a000d849aa3'>
<a href='#59ddf7f153a72a000d849aa3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5929c5f4a76c22000d329d92'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5ec18483d35ccb497ca800f820998851?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5929c5f4a76c22000d329d92'>Leo M</a>
<span class='badge medal'></span>
</div>
<a UTCms='1507719153000' class='quanto-date posted-at response-posted-at' href='#59ddf7f153a72a000d849aa3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Is it possible to detect if user has set MaxTurnover in constraints and only do special case handling (of adding positions to alphas) if it is set? Is it possible to demean alphas if  adding positions to alphas with alpha=zero?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59de3173908abb000d85dd45' id='59de3173908abb000d85dd45'>
<a href='#59de3173908abb000d85dd45'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1507733875000' class='quanto-date posted-at response-posted-at' href='#59de3173908abb000d85dd45'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>I&#39;d think that the turnover constraint wouldn&#39;t work on non-universe stocks</p>
</blockquote>

<p>Constraints are unconditional requirements that <strong>must</strong> be satisfied by the new portfolio, so no change in the implementation of the objective will ever cause the optimizer to emit a portfolio that violates a constraints.  </p>

<p>What <strong>does</strong> matter in the context of a penalty term is that the scale of the alpha-maximization term in the objective is smaller than the scale of the &quot;close out alpha-less positions&quot; term.  The easiest way to achieve that is to ensure that the scale of the alpha-maximization term is fixed by re-scaling alphas to fall between -1 and 1.  There are a couple ways you could imagine doing that, but the only semantics-preserving rescaling is to divide all the alphas by the absolute value of the largest-magnitude alpha, which is safe because the <code>w</code> that maximizes <code>dot(w, a)</code> also maximizes <code>dot(w, a * N)</code> as long as N is a positive constant.</p>

<blockquote>
<p>How would users know how to set it?</p>
</blockquote>

<p>My expectation is that users shouldn&#39;t have to set it, unless they&#39;re doing something unusual.  The goals is for the behavior of <code>MaximizeAlpha</code> to be what most people in this thread already assumed, which is that positions in assets with no alphas provided are always closed out unless doing so is impossible.  The only case where scaling the penalty term would matter is if you want fine-grained control over what happens in the tiny percentage of cases where closing out the undesired positions isn&#39;t possible  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='59de34909a613124d91cbd70' id='59de34909a613124d91cbd70'>
<a href='#59de34909a613124d91cbd70'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1507734672000' class='quanto-date posted-at response-posted-at' href='#59de34909a613124d91cbd70'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>Is it possible to detect if user has set MaxTurnover in constraints and only do special case handling (of adding positions to alphas) if it is set?</p>
</blockquote>

<p>There are more cases than just <code>MaxTurnover</code> that can prevent us from closing a position.  In general, an arbitrarily complex combination of constraints can conspire to make it impossible to close an existing position, and the only robust way to find that out is to do the full optimization (or something morally equivalent to it).  To take an extreme example, you could encode a <a href="https://en.wikipedia.org/wiki/Boolean_satisfiability_problem">Boolean Satisfiability</a> problem as a set of <code>Basket</code> constraints.</p>

<blockquote>
<p>Is it possible to demean alphas if adding positions to alphas with alpha=zero?</p>
</blockquote>

<p>I don&#39;t think it would be appropriate for an objective to automatically de-mean alphas.  Consider, for example, that providing all-positive alphas will yield a long-only portfolio in the absence of a <code>DollarNeutral</code> (or similar) constraint, but the same alphas de-meaned will yield a long-short portfolio.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='59deadc0f817ea000dc944f5' id='59deadc0f817ea000dc944f5'>
<a href='#59deadc0f817ea000dc944f5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5929c5f4a76c22000d329d92'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5ec18483d35ccb497ca800f820998851?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5929c5f4a76c22000d329d92'>Leo M</a>
<span class='badge medal'></span>
</div>
<a UTCms='1507765696000' class='quanto-date posted-at response-posted-at' href='#59deadc0f817ea000dc944f5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Wouldn&#39;t the median (or mean?) alpha be a better choice for positions than an arbitrary number like zero when there is no expectation that algorithm developers demean their alphas prior to calling order_optimal_portfolio for their long short algorithms?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59df01e42bc9fe000d04f634' id='59df01e42bc9fe000d04f634'>
<a href='#59df01e42bc9fe000d04f634'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58bcd705e57c67000a346680'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6ddd8fcec7899e4882e1c60af5211972?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58bcd705e57c67000a346680'>Mattias Lamotte</a>
</div>
<a UTCms='1507787236000' class='quanto-date posted-at response-posted-at' href='#59df01e42bc9fe000d04f634'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m glad that my original post created this interesting debate, when clearly the reason my backtest created these &quot;anomalies&quot; was because my constraints were diagonally opposed to each other - &quot;Go right! No, Go Left!&quot; (my alpha vectors were all positive, and I simultaneously set constraints for a dollar neutral portfolio and a Beta between -0.1 and +0.1). It does make sense that Alpha vectors should not be &quot;a preference ranking&quot; but should instead be &quot;a real expected Alpha over a given time horizon&quot;. There should however be some optional constraint that prevents non-pipeline output from being in your portfolio - Who&#39;s in control of this algo I just wrote? Is it optimize() or is it me!?  ;) </p>

<p>I have to say that this is a completely new way of thinking about a trading system&#39;s construction and it&#39;s hard for old trading school guys like me to adapt (my current live models have big arrays to keep track of state, and they are all based on conditional triggers causing a Buy, a Sell, a Take Profit or a Stop Loss signal for each individual asset) .</p>

<p>I can immediately see the edge that optimize has over the &quot;classic signal trigger methodology&quot;: the trigger methodology is by definition focused on building a portfolio at the micro level without regard to the macro portfolio level. For example, a momentum strategy on the Q500US with moving average triggers could very well buy 30 energy energy stocks on the same day because of a big oil price move - this probably wouldn&#39;t make much sense on a risk/reward basis for the entire portfolio. Optimize() would clearly allow you to cap your risk more efficiently given certain constraints rather than creating sector position limits using &quot;classic signal trigger methodology&quot;. I&#39;m curious: is there a constraint that would allow you to combine MaximizeAlpha and &quot;MinimizePortfolioVariance&quot; so that you could combine an Alpha vector with a portfolio co-variance ranking? (i.e.: if 2 assets have a similar Alpha vector, Optimize() might as well try to overweight the asset which is more likely to act as a dampener on overall portfolio volatility).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59f0c99876978d00098046db' id='59f0c99876978d00098046db'>
<a href='#59f0c99876978d00098046db'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/578af5aada75b0075500027f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5523f972e275cb9c2cc1c3d529515df8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/578af5aada75b0075500027f'>Cheng Peng</a>
</div>
<a UTCms='1508952472000' class='quanto-date posted-at response-posted-at' href='#59f0c99876978d00098046db'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Interesting observation @Mattias. I wonder if you could just combine the alpha vector and co-variance weightings with some type of averaging? </p>

<p>You could, for example, just multiply the alpha vector by the covariance weightings for a final portfolio output that optimize could use.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59f18d33ef76ae000669bdb3' id='59f18d33ef76ae000669bdb3'>
<a href='#59f18d33ef76ae000669bdb3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58bcd705e57c67000a346680'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6ddd8fcec7899e4882e1c60af5211972?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58bcd705e57c67000a346680'>Mattias Lamotte</a>
</div>
<a UTCms='1509002547000' class='quanto-date posted-at response-posted-at' href='#59f18d33ef76ae000669bdb3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Cheng,</p>

<p>It was nice to meet you at QuantCon Singapore. You showed me during the Hackathon that you can read Python code faster than I can read English! I was very impressed how you could read code structure and debug someone else&#39;s code in the blink of an eye...</p>

<p>Since my last post, I thought a little bit about this issue and it&#39;s a really complicated problem (which I&#39;m sure many smart guys have already tried to tackle - as it would seem like a natural thing one would want to optimize). I remember Delaney briefly mentioning the complexity of a similar optimization problem during the workshop.</p>

<p>While I&#39;m sure there are various manipulations that could be done to the Alpha vector using co-variances, I don&#39;t think your suggestion would work.  An asset with close to zero covariance to all the assets in the universe and a very high expected Alpha should be a pretty sought after asset for any strategy&#39;s long book, but multiplying them together would give such an asset a middle close to 0 ranking, when it should get a very high ranking.</p>

<p>One either has to use 1/ a covariance matrix with all the other assets in the universe over a given time frame (that&#39;s a seriously big matrix to optimise a theoritical Sharpe ratio), or 2/ one has to iterate through each of the single covariances with each permutation of the portfolio minus each asset (you get a different covariance for each permutation of weights in the n-1 portfolio universe).    </p>

<p>It would appear that there are 2 different ways to approach this problem: A/ one optimises the matrix mentioned in 1/ above to find out what weights would have produced the highest Sharpe Ratio using historical co-variances and Alpha vectors instead of historical performances, or B) one uses a recursive technique to approximate a historical weight &quot;sweet spot&quot;. As Approach A is seeking to find an exact optimization of the past to make an approximation of the future, I would have thought that Approach B will be just as good at estimating what will be the best weights for the future. Depending on the number of iterations required to get a decent approximation, Approach B could also have much less computational requirements than Approach A, for a similar end result.</p>

<p>For approach B, I would probably try to use Fisher Black&#39;s &quot;combination of 2 risky assets&quot; formula (Variance_2assetportfolio = ((x1^2)<em>(s1^2)) + (2*x1*x2*r12*s1*s2) + ((x2^2)</em>(s2^2)) where x is weights, s is standard deviations and r is correlation). I would start with an equally weighed portfolio and then parse through the portfolio multiple times optimizing weights one at a time. I would suspect that even after 5 iterations of parsing through the entire portfolio, I would have a pretty good setting for my weights...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59f200e5b0d8dc3923d17fec' id='59f200e5b0d8dc3923d17fec'>
<a href='#59f200e5b0d8dc3923d17fec'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/578af5aada75b0075500027f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5523f972e275cb9c2cc1c3d529515df8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/578af5aada75b0075500027f'>Cheng Peng</a>
</div>
<a UTCms='1509032165000' class='quanto-date posted-at response-posted-at' href='#59f200e5b0d8dc3923d17fec'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Great Point. The approach I mentioned fails to account for the correlation between the alpha vector and covariance, and will likely lead to lackluster results. That said, the approach B you mentioned seems very sound since it looks at both the variances and correlation in both vectors. </p>

<p>Let me know if that works out for you! </p>

<p>In case you haven&#39;t seen this yet, this post talks a lot about portfolio diversification techniques that could be useful: <a href="https://www.quantopian.com/posts/hierarchical-risk-parity-comparing-various-portfolio-diversification-techniques">https://www.quantopian.com/posts/hierarchical-risk-parity-comparing-various-portfolio-diversification-techniques</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59f20f4aec429c6682031e1d' id='59f20f4aec429c6682031e1d'>
<a href='#59f20f4aec429c6682031e1d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58bcd705e57c67000a346680'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6ddd8fcec7899e4882e1c60af5211972?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58bcd705e57c67000a346680'>Mattias Lamotte</a>
</div>
<a UTCms='1509035850000' class='quanto-date posted-at response-posted-at' href='#59f20f4aec429c6682031e1d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks for sharing this post. I had missed it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59f74d3bd266bb00064d7b65' id='59f74d3bd266bb00064d7b65'>
<a href='#59f74d3bd266bb00064d7b65'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5929c5f4a76c22000d329d92'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5ec18483d35ccb497ca800f820998851?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5929c5f4a76c22000d329d92'>Leo M</a>
<span class='badge medal'></span>
</div>
<a UTCms='1509379387000' class='quanto-date posted-at response-posted-at' href='#59f74d3bd266bb00064d7b65'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott, </p>

<p>Regarding the non_universe_penalty term you mentioned earlier in a post, I had an idea yesterday that we could vary the non_universe_penalty in such a way that positions that have been longer in the portfolio and not in current alpha vector get higher penalty than those positions that have been added recently (and not in alpha vector). This would ensure starvation problem doesn&#39;t occur while satisfying the max turnover constraint. Similar to how some caching mechanisms work getting rid of the oldest cache item to free up space for a new item.</p>

<p>Thanks,<br>
Leo  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/singapore-conference-slash-questions-regarding-optimize-api'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/singapore-conference-slash-questions-regarding-optimize-api'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#01676464656360626a417074606f756e7168606f2f626e6c">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

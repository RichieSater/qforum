<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
example of exponential smoothing w/ Optimize API?
</title>
<meta content='I&#39;d like to try  exponential smoothing  with the Optimize API.  It would look something like this: weights_new = alpha*weights_current + (1-alpha)*context.weights_old  context.weights_old = weights_new   The portfolio vector  weights_current  would be computed using  calculate_optimal_portfolio  and  weights_new  would be used to place the order. Is there an elegant way to do this using Pandas?' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="CFxPVHySBF53YkuhUXSKQ47Vn1xg9jZfgGFnL/Uu2590OjkZ3mTWvc5/EpAemyI3tlu8NRo6I0QCbrxFX2u5JA==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/example-of-exponential-smoothing-w-slash-optimize-api' property='og:url'>
<meta content='example of exponential smoothing w/ Optimize API?' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/example-of-exponential-smoothing-w-slash-optimize-api' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='example of exponential smoothing w/ Optimize API?' property='og:title'>
<meta content='I&#39;d like to try  exponential smoothing  with the Optimize API.  It would look something like this: weights_new = alpha*weights_current + (1-alpha)*context.weights_old  context.weights_old = weights_new   The portfolio vector  weights_current  would be computed using  calculate_optimal_portfolio  and  weights_new  would be used to place the order. Is there an elegant way to do this using Pandas?' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/example-of-exponential-smoothing-w-slash-optimize-api">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='5a46426a25e036762478fa59'>
<div class='post-container' data-post-id='5a46426a25e036762478fa59' id='5a46426a25e036762478fa59'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>example of exponential smoothing w/ Optimize API?</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1514553962000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=example of exponential smoothing w/ Optimize API?&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fexample-of-exponential-smoothing-w-slash-optimize-api%3Futm_source%3Dwebsite_share%26utm_campaign%3Dexample-of-exponential-smoothing-w-slash-optimize-api%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fexample-of-exponential-smoothing-w-slash-optimize-api%3Futm_source%3Dwebsite_share%26utm_campaign%3Dexample-of-exponential-smoothing-w-slash-optimize-api%26utm_medium%3Dlinkedin&amp;title=example+of+exponential+smoothing+w%2F+Optimize+API%3F+%28Grant+Kiehne%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class='tags tag-row'>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='API' data-tag-id='55c50e7d8d4710ec6e000001' href='/posts/tag/API/newest'>API</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Seeking Help' data-tag-id='55c50e7d8d4710ec6e000003' href='/posts/tag/Seeking-Help/newest'>Seeking Help</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Tools and Tips' data-tag-id='55c50e7d8d4710ec6e000011' href='/posts/tag/Tools-and-Tips/newest'>Tools and Tips</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Feature Request' data-tag-id='55c50e7d8d4710ec6e000015' href='/posts/tag/Feature-Request/newest'>Feature Request</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Portfolio Optimization' data-tag-id='55d33f293f6ba10061000000' href='/posts/tag/Portfolio-Optimization/newest'>Portfolio Optimization</a>
</div>
<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/example-of-exponential-smoothing-w-slash-optimize-api?utm_source=website_share&amp;utm_campaign=example-of-exponential-smoothing-w-slash-optimize-api&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Grant Kiehne" />
<div class='body-text'>
<div class='body-text-container post-body'><p>I&#39;d like to try <a href="https://en.wikipedia.org/wiki/Exponential_smoothing">exponential smoothing</a> with the Optimize API.  It would look something like this:</p>

<pre><code>weights_new = alpha*weights_current + (1-alpha)*context.weights_old  
context.weights_old = weights_new  
</code></pre>

<p>The portfolio vector <code>weights_current</code> would be computed using <code>calculate_optimal_portfolio</code> and <code>weights_new</code> would be used to place the order.</p>

<p>Is there an elegant way to do this using Pandas?</p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>19 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='5a464e4f02ae4e10c489708c' id='5a464e4f02ae4e10c489708c'>
<a href='#5a464e4f02ae4e10c489708c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1514557007000' class='quanto-date posted-at response-posted-at' href='#5a464e4f02ae4e10c489708c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant, that is a great idea. It would give you the ability to provide moving and adapting targets to the Optimize API. Make its boundaries flexible and even provide it with tracking functions. Add some leeway or constrain these functions based on some market data or other sentiment functions. I would like to see that too.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a46710cc3d9fa7725305215' id='5a46710cc3d9fa7725305215'>
<a href='#5a46710cc3d9fa7725305215'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/571d1bab2616ef09ce0002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a69e9457dd2832a76875bcae334d5baf?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/571d1bab2616ef09ce0002b6'>Dan Whitnable</a>
</div>
<a UTCms='1514565900000' class='quanto-date posted-at response-posted-at' href='#5a46710cc3d9fa7725305215'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>If I understand correctly, the idea is to run <code>calculate_optimal_portfolio</code> each day and save the resulting weights. Then, calculate the exponentially weighted moving average of those weights and use that &quot;weighted&quot; weight as the actual target weight.</p>

<p>One idea is to store each days weights in a dataframe. One row for each day. One column for each security. Use the &#39;append&#39; method (it gracefully aligns columns and adds any as needed). Then simply use the &#39;ewm&#39; method to get the EWMA of that data frame. </p>

<p>May need to delete rows of the dataframe if running a long backtest. Also need to tune the ewm method to get the desired weighting. Take a look at the attached notebook for a start...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a467b6d50113a0013ebe317' id='5a467b6d50113a0013ebe317'>
<a href='#5a467b6d50113a0013ebe317'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1514568557000' class='quanto-date posted-at response-posted-at' href='#5a467b6d50113a0013ebe317'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Dan -</p>

<p>Yes, that&#39;s the basic idea.  I should be able to get something running, based on your example.</p>

<p>Note that exponential smoothing is recursive and only needs the last value.  So there&#39;s no need to store multiple days of values in a dataframe.  There&#39;s a start-up issue, however, in that the smoothing won&#39;t kick in until enough time has passed for the smoothing (filter) to do it&#39;s job.  One fix for this would be just to hold off trading for a period of time.</p>

<p>The right way to handle the start-up issue would be to get a trailing window of alpha values out of Pipeline at the start of a backtest/live trading, but last I heard, this is not possible, correct?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a4686fd50113a0016ebe33d' id='5a4686fd50113a0016ebe33d'>
<a href='#5a4686fd50113a0016ebe33d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1514571517000' class='quanto-date posted-at response-posted-at' href='#5a4686fd50113a0016ebe33d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Dan, that is a great start, impressive. Thanks. </p>

<p>How about having another EMA function to direct the output of the last_ewma_weight_series in the desired direction. As in, start with the  last_ewma_weight_series, and try to go to: last_ewma_weight_series ± ϵ, where ϵ is trying to override the objective without overshooting its boundaries. </p>

<p>The purpose being not only to adapt to the objectives, but also trying to partially provide some outside control. You still need to normalize the weights before and after otherwise you might easily overshoot the constraints, not to mention leveraging limits, beta and dollar neutrality. You want to somehow gain some control the thing and stay within the boundaries, but not necessarily on the middle mark. Kind of giving some leeway, but in the direction you want instead of having the Optimize API making the decision for you.</p>

<p>Any idea as to how CPU-intensive this could be on say 200-300 stocks with a 30-90 day lookback?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a4697c050113a0010ebe3fc' id='5a4697c050113a0010ebe3fc'>
<a href='#5a4697c050113a0010ebe3fc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1514575808000' class='quanto-date posted-at response-posted-at' href='#5a4697c050113a0010ebe3fc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Guy,</p>

<p>Nice idea. That might be another way to do the smoothing.  Basically, take the output of the optimizer (from the prior period) and combine it with the new alpha values (current period) and run it though again, in an iterative fashion.  The degree of smoothing would be controlled by the relative weights of the old optimizer output and the new alpha values (similar to the recursion relation for exponential smoothing).  In this sense, the new alpha values would be an adjustment to the existing portfolio weights, versus a whole new set of values for the optimizer to crunch on, potentially leading to unproductive turnover.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a469c2a02ae4e7e72896a78' id='5a469c2a02ae4e7e72896a78'>
<a href='#5a469c2a02ae4e7e72896a78'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1514576938000' class='quanto-date posted-at response-posted-at' href='#5a469c2a02ae4e7e72896a78'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant, yes. The Optimize API in its strict current boundary definitions is doing a lot of unnecessary churning. Providing more blurry lines to expand or contract those boundaries based on our perception of where the market is going could help reduce this excessive churning, reduce trading costs and even increase overall profitability. This leeway is needed in order to gain better control over what we want to do.</p>

<p>Because of the weighing constraints, if one weight of one stock changes from one period to the next, the consequence is that all stocks will have their respective inventories readjusted. And no one, as yet, has demonstrated to my satisfaction that it was economically justified to do so. The objective evidently being to reduce white noise trading.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a47938fc3d9fa17733058fa' id='5a47938fc3d9fa17733058fa'>
<a href='#5a47938fc3d9fa17733058fa'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1514640271000' class='quanto-date posted-at response-posted-at' href='#5a47938fc3d9fa17733058fa'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Guy -</p>

<p>Not that you don&#39;t have to use the constraints.  For example:</p>

<pre><code>objective = opt.TargetWeights(pipeline_data.combined_alpha)

order_optimal_portfolio(  
        objective=objective,  
        constraints=[],  
        )  
</code></pre>

<p>For the new contest, given that the judging is based solely on the volatility-normalized return, this might be the best choice, assuming that all of the constraints are met without engaging the fanciness of the Optimize API.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a47a842c3d9fa65de305d4e' id='5a47a842c3d9fa65de305d4e'>
<a href='#5a47a842c3d9fa65de305d4e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1514645570000' class='quanto-date posted-at response-posted-at' href='#5a47a842c3d9fa65de305d4e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant, yes, agree. Note that I have nothing against the Optimize API, nonetheless, a lot of its trades are the result of white noise. Trading white noise is unproductive, if not a waste of resources. If white noise triggers a trade, it should be considered as an allocation error, meaning that it should not have occurred for whatever its reason. We could allow this if it were exceptions that happen once in a while as part of the game, the software, or the trading environment. But, when it exceeds 30% of all trades, it should be considered too much. While we are allocating resources to white noise trades, we are not allocating it to potentially better trades.</p>

<p>Presently, I do  see the Optimize API as a “black box” which gives me the impression I have little real control. I do not have access to any of its internal functions. </p>

<p>However, based on your first post and @Dan&#39;s notebook where he proposes a way to gain some control over the API, I find it more interesting. I work a lot with objective functions, my aim has always been to maximize profits first, even use leverage if I found it applicable. This often ignoring constraints for low volatility, low beta, even low drawdowns. As long as they were within acceptable limits it was OK. However, a basic requirement was: the strategy has to last a long time, and not fizzle out right out of the gate.</p>

<p>I view this “trading game” as a CAGR game where our objective should be to reduce the doubling time as much as we possibly can. And this implies a long-term vision of things with an eye on the long-term CAGR, which I do not see in the API. Having outside controlling functions might just help to guide the API where I want it to go.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a48efe55377fd001b9d919b' id='5a48efe55377fd001b9d919b'>
<a href='#5a48efe55377fd001b9d919b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1514729445000' class='quanto-date posted-at response-posted-at' href='#5a48efe55377fd001b9d919b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s an example of one approach.  Will post with 
<code>TAU_SMOOTH=3</code> next.</p>

<pre><code>    TAU_SMOOTH = 1 # smoothing time constant (days)  
    ALPHA_SMOOTH = 1 - np.exp(-1.0/TAU_SMOOTH)

    weights = opt.calculate_optimal_portfolio(  
        objective=objective,  
        constraints=constraints,  
        )  
    # smooth weights  
    weights = ALPHA_SMOOTH*weights  
    weights = weights.add((1-ALPHA_SMOOTH)*context.weights,fill_value=0)  
    context.weights = weights  
    # order using smoothed weights  
    objective = opt.TargetWeights(weights)  
    order_optimal_portfolio(  
        objective=objective,  
        constraints=constraints,  
        )  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a48f03612a4e109cd43aaac' id='5a48f03612a4e109cd43aaac'>
<a href='#5a48f03612a4e109cd43aaac'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1514729526000' class='quanto-date posted-at response-posted-at' href='#5a48f03612a4e109cd43aaac'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Example with longer smoothing time constant, 
<code>TAU_SMOOTH=3</code>.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a4927443fd3ca001096a4d8' id='5a4927443fd3ca001096a4d8'>
<a href='#5a4927443fd3ca001096a4d8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1514743620000' class='quanto-date posted-at response-posted-at' href='#5a4927443fd3ca001096a4d8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Note that in the above example, one could replace 
<code>context.weights</code> with the current weights of the portfolio.  Is there a built-in function that will return the required Pandas Series?  Or would I need to write my own?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a4a3deb5f85cd0a6628663d' id='5a4a3deb5f85cd0a6628663d'>
<a href='#5a4a3deb5f85cd0a6628663d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1514814955000' class='quanto-date posted-at response-posted-at' href='#5a4a3deb5f85cd0a6628663d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Guy -</p>

<p>Regarding the Optimize API and churn, I think the fundamental problem is that everything is wonderful when there is no cost in transactions (commissions &amp; slippage)--optimize at will.  However, as soon as one adds a cost for managing risk, then it becomes a more complicated problem.  I&#39;m getting the sense that the Optimize API is a bit too naive, in that it assumes negligible transaction costs.  For example, the 
<code>short_term_reversal</code> risk is the 14-day RSI, so managing that risk will result in a lot of churn, since it would be expected to vary on a relatively short time frame.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a4a4e46b0cabf0015f57099' id='5a4a4e46b0cabf0015f57099'>
<a href='#5a4a4e46b0cabf0015f57099'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1514819142000' class='quanto-date posted-at response-posted-at' href='#5a4a4e46b0cabf0015f57099'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant, yes, your analysis is right on. Following your last strategy contribution, I extended the trading interval to 6 years, made no change to the code. Saw the strategy&#39;s CAGR melt down to about 2.1%. It was not surprising since: E[R(p)] = r_f + β∙(E[R(m)]  - r_f) – β∙E[R(m)] = r_f. Implicitly saying that the outcome of this type of strategy should result in something close to the risk-free rate.</p>

<p>The merit of the strategy is that it is getting a low volatility equity line (almost flat) with its corresponding low drawdowns and near zero beta. It should be considered a real plus. There are applications for that kind of behavior.</p>

<p>However, at a 2.1% CAGR, one should start considering if it is worth the effort to do all that work, even if it is a machine doing it. In terms I like to measure, this strategy has a doubling time of 33.3 years! And this is if it does not deteriorate more as you continue to increase the trading interval.</p>

<p>Note that in its tear sheet, the Cumulative Return on Logarithmic Scale graph shows no real alpha either. As a matter of fact, it has an increasing negative alpha, and will continue to deteriorate. This strategy simply underperform its peers. And, this might be viewed as, say non-constructive, but, it is nonetheless designed to do so.</p>

<p>In my last post, I was generous when saying about 30% of trades were the result of noise rebalancing. That number is much higher. Every day, all the positions are affected simply because one of the stock price moved, and this has a cascading effect over the entire portfolio over the whole trading interval.</p>

<p>I do not see how, anyone could leverage this script to 6x. It simply would not even cover its leveraging costs. One should look closer at what this strategy is really doing and why it is doing it.</p>

<p>You have this moving blob of price variances where you want to extract, by trading, something that should result in: F(0) + Σ(q∙Δp) &gt; B&amp;H. And all you get is: F(0) + Σ(q∙Δp) ≈ r_f. </p>

<p>I would say: “Houston, we have a problem”.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a4a6ac95f85cd391b286321' id='5a4a6ac95f85cd391b286321'>
<a href='#5a4a6ac95f85cd391b286321'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1514826441000' class='quanto-date posted-at response-posted-at' href='#5a4a6ac95f85cd391b286321'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Regarding another of GK&#39;s points: &quot;the sense that the Optimize API [...] assumes negligible transaction costs&quot;</p>

<p>To find out, since Optimize attempts to fill right away, only partial and unfilled orders are visible the minute after. To calculate commissions, an extra step, save the list of order id&#39;s returned by order_optimal_portfolio and add their get_order(order_id).commissions in succeeding minutes when fully filled using status.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a4a7167b0cabf000ff571ee' id='5a4a7167b0cabf000ff571ee'>
<a href='#5a4a7167b0cabf000ff571ee'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/571d1bab2616ef09ce0002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a69e9457dd2832a76875bcae334d5baf?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/571d1bab2616ef09ce0002b6'>Dan Whitnable</a>
</div>
<a UTCms='1514828136000' class='quanto-date posted-at response-posted-at' href='#5a4a7167b0cabf000ff571ee'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy you are spot on in stating <em>&quot;Every day, all the positions are affected simply because one of the stock price moved, and this has a cascading effect over the entire portfolio over the whole trading interval.&quot;</em></p>

<p>The &#39;churn&#39; this creates generates transaction costs, and turnover, which need to be considered in ones strategy. The idea of &#39;smoothing&#39; the optimize results doesn&#39;t exactly minimize this &#39;churn&#39; it simply changes it. Smoothing the results is analogous to airbrushing a picture. It does a good job for some things (eg my picture on Facebook) but perhaps isn&#39;t the best tool for others (eg that x-ray of my broken foot). In the latter case details are important.</p>

<p>@Grant is correct that the <em>&quot;Optimize API is a bit too naive&quot;</em>. We just need to make sure that we aren&#39;t similarly naive when using it. </p>

<p>So, what I do to minimize churn is to use the &#39;Frozen&#39; constraint. In general, anything that has a gain less than the transaction cost is &#39;frozen&#39;. Something like this.</p>

<pre><code>    # Create a TargetWeights object using desired weights  
    # This will become our ordering objective  
    equal_weight_objective = opt.TargetWeights(context.output.weight)  


    # Next &#39;freeze&#39; any securities that we don&#39;t want to trade  
    # Here we simply put a min and max gain limit  
    MIN_GAIN, MAX_LOSS = .005, .005  
    for security, position in context.portfolio.positions.items():  
        context.output.at[security, &#39;gain&#39;] = (position.last_sale_price / position.cost_basis) - 1  


    freeze_these = context.output.query(&#39;(gain &lt; @MIN_GAIN) &amp; (-gain &lt; @MAX_LOSS)&#39;).index.tolist()  
    freeze_constraint = opt.Frozen(freeze_these)  

    # Finally, execute the order_optimal_portfolio method  
    order_optimal_portfolio(objective = context.equal_weight_objective, constraints = [freeze_constraint])  
</code></pre>

<p>The above is pretty simplistic, and more thought should be put into accounting for short positions, but shows the basic idea. Go through whatever logic one has to open, close, and rebalance positions. Then, determine what held securities (if any) to keep &#39;as is&#39;. Then simply add those securities to a &#39;Frozen&#39; constraint. The optimize framework is elegant in that this logic can be independent of one another.</p>

<p>In a similar fashion, the &#39;CannotHold&#39; constraint could be used if one wanted to close a position entirely.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a4a76fd28d3c60010e1f209' id='5a4a76fd28d3c60010e1f209'>
<a href='#5a4a76fd28d3c60010e1f209'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1514829565000' class='quanto-date posted-at response-posted-at' href='#5a4a76fd28d3c60010e1f209'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Dan -</p>

<p>I agree regarding the smoothing (which is a recursive low-pass filter); it just puts things on the right time scale (which is handy).  What I&#39;d like to do is use the 
<code>TargetWeights</code> objective with a constraint on the forecast profit of the portfolio adjustment.  If the profit will not exceed a certain level, then no update is done (or perhaps only an adjustment for risk is made).  Is this feasible?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a4a79e3a9b68b2bfe81b77e' id='5a4a79e3a9b68b2bfe81b77e'>
<a href='#5a4a79e3a9b68b2bfe81b77e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1514830307000' class='quanto-date posted-at response-posted-at' href='#5a4a79e3a9b68b2bfe81b77e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Dan, yes. Agree. We need to gain control over what the API does. And by setting some “min and max gain limit”  as you propose, would indeed reduce the churn. It also has added benefits.</p>

<p>Your “CannotHold” constraint would also be an add-on. Like you do not want stocks that do not move, or are illiquid, that somehow might have made the list from its fringe for some reason or other. </p>

<p>A “DoHold” constraint under certain conditions could also be an add-on. It would permit to override the API settings, also reduce churn and maybe increase profits. </p>

<p>Stocks with rising prices need not have their inventory reduced because they moved or some other stock moved. We are used to protect ourselves with stop losses, but here we are putting on some stop profits instead and hoping to achieve more. Is there not a contradiction in there.</p>

<p>It is why what you and @Grant propose makes a lot of sense. Override some of the weaknesses, alleviate the turnover, reduce trading expenses. There will probably be a cost: slightly higher volatility and drawdowns, but still manageable.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a4a8d72a9b68b22a981b886' id='5a4a8d72a9b68b22a981b886'>
<a href='#5a4a8d72a9b68b22a981b886'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1514835314000' class='quanto-date posted-at response-posted-at' href='#5a4a8d72a9b68b22a981b886'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>It looks like the 
<code>FactorExposure</code> constraint might do the trick (if I understand it correctly) for setting a profit range.  It has the same form as the dot-product in Section 4.2 of <a href="https://arxiv.org/pdf/1206.4626.pdf">https://arxiv.org/pdf/1206.4626.pdf</a>, which sets a lower limit on the expected return.</p>

<p>Have to play around with it when I get the chance.  It would be an interesting exercise to formulate the classic OLMAR paper using the Optimize API.  Should be doable.</p>

<hr>

<p>class FactorExposure(loadings, min_exposures, max_exposures)</p>

<pre><code>Constraint requiring bounded net exposure to a set of risk factors.

Factor loadings are specified as a DataFrame of floats whose columns are factor labels and whose index contains Assets. Minimum and maximum factor exposures are specified as maps from factor label to min/max net exposure.

For each column in the loadings frame, we constrain:

(new_weights * loadings[column]).sum() &gt;= min_exposure[column]  
(new_weights * loadings[column]).sum() &lt;= max_exposure[column]

Parameters: 

    loadings (pd.DataFrame) -- An (assets x labels) frame of weights for each (asset, factor) pair.  
    min_exposures (dict or pd.Series) -- Minimum net exposure values for each factor.  
    max_exposures (dict or pd.Series) -- Maximum net exposure values for each factor.  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a4be3d288e41465deb61516' id='5a4be3d288e41465deb61516'>
<a href='#5a4be3d288e41465deb61516'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1514922962000' class='quanto-date posted-at response-posted-at' href='#5a4be3d288e41465deb61516'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant, the paper you mention has extraordinary numbers. Performance levels going through the roof. I remember reading that study a few years back. </p>

<p>There is only this one thing. Their next paper did add some consideration for commissions. And it was sufficient to almost totally destroy whatever alpha they thought they had “found”. </p>

<p>I think it is why we should always account for frictional costs even if they are at times just estimates of what they could be. At least, we could make them higher than they really are in order to force us to do better under adverse conditions. IMHO.  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/example-of-exponential-smoothing-w-slash-optimize-api'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/example-of-exponential-smoothing-w-slash-optimize-api'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#17717272737576747c57666276796378677e76793974787a">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

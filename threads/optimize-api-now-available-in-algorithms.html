<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
Optimize API Now Available in Algorithms
</title>
<meta content='A few weeks ago, I posted a  notebook  presenting a new  Optimize API .  Today we&#39;re announcing that  the Optimize API is available for use in algorithms , and we&#39;ve added new features to make the API easier to use in the context of a running algorithm. The basic idea of the Optimize API is that it relieves authors from the burden of having to manually size orders and positions.  Instead of calculating individual share counts and placing orders directly, authors can now specify the desired...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="n8lWw7tFhnXqZm6MJf4hMwNU4UdyIgLRZinslWIO4arjryCOGbNUllN7N71qEYlHO9rCLgjuF8rkJjf/yEuDEQ==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/optimize-api-now-available-in-algorithms' property='og:url'>
<meta content='Optimize API Now Available in Algorithms' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/optimize-api-now-available-in-algorithms' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='Optimize API Now Available in Algorithms' property='og:title'>
<meta content='A few weeks ago, I posted a  notebook  presenting a new  Optimize API .  Today we&#39;re announcing that  the Optimize API is available for use in algorithms , and we&#39;ve added new features to make the API easier to use in the context of a running algorithm. The basic idea of the Optimize API is that it relieves authors from the burden of having to manually size orders and positions.  Instead of calculating individual share counts and placing orders directly, authors can now specify the desired...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/optimize-api-now-available-in-algorithms">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='5840693a9807cc00120001dd'>
<div class='post-container' data-post-id='5840693a9807cc00120001dd' id='5840693a9807cc00120001dd'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>Optimize API Now Available in Algorithms</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<span class='posted-at'>edited </span>
<span UTCms='1480629963000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=Optimize API Now Available in Algorithms&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Foptimize-api-now-available-in-algorithms%3Futm_source%3Dwebsite_share%26utm_campaign%3Doptimize-api-now-available-in-algorithms%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Foptimize-api-now-available-in-algorithms%3Futm_source%3Dwebsite_share%26utm_campaign%3Doptimize-api-now-available-in-algorithms%26utm_medium%3Dlinkedin&amp;title=Optimize+API+Now+Available+in+Algorithms+%28Scott+Sanderson%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class='tags tag-row'>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='API' data-tag-id='55c50e7d8d4710ec6e000001' href='/posts/tag/API/newest'>API</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Q Updates' data-tag-id='55c50e7d8d4710ec6e000012' href='/posts/tag/Q-Updates/newest'>Q Updates</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Portfolio Optimization' data-tag-id='55d33f293f6ba10061000000' href='/posts/tag/Portfolio-Optimization/newest'>Portfolio Optimization</a>
</div>
<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/optimize-api-now-available-in-algorithms?utm_source=website_share&amp;utm_campaign=optimize-api-now-available-in-algorithms&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Scott Sanderson" />
<div class='body-text'>
<div class='body-text-container post-body'><p>A few weeks ago, I posted a <a href="https://www.quantopian.com/posts/request-for-feedback-portfolio-optimization-api">notebook</a> presenting a new <strong>Optimize API</strong>.  Today we&#39;re announcing that <strong>the Optimize API is available for use in algorithms</strong>, and we&#39;ve added new features to make the API easier to use in the context of a running algorithm.</p>

<p>The basic idea of the Optimize API is that it relieves authors from the burden of having to manually size orders and positions.  Instead of calculating individual share counts and placing orders directly, authors can now specify the desired state of their portfolio in terms of high-level <strong>objectives</strong> and <strong>constraints</strong>.</p>

<p>Since the original announcement, we&#39;ve made a few tweaks to the built-in Objective and Constraint classes, but the biggest change to the API is the addition of a new top-level entrypoint, <strong><code>order_optimal_portfolio</code></strong>, which is available only in algorithms. order_optimal_portfolio accepts three parameters, all of which are required:</p>

<ul>
<li><code>objective</code>, an Objective that the new portfolio should maximize or minimize.<br></li>
<li><code>constraints</code>, a list of Constraints that the new portfolio should adhere to.<br></li>
<li><code>universe</code>, an <a href="https://docs.python.org/2/glossary.html#term-iterable">iterable</a> of Equity objects to consider in the optimization.  In idiomatic usage, this will usually be the index of a Pipeline result.</li>
</ul>

<p>When called, order_optimal_portfolio calculates the set of portfolio weights that optimizes <code>objective</code> while still respecting <code>constraints</code>.  It then subtracts the target portfolio weights from the current portfolio weights and places orders to move from the current portfolio state to the new optimal state.</p>
<h3 id='examples'><a class='clickable-header-link' href='#examples'>Examples</a></h3>
<h4 id='backtest'><a class='clickable-header-link' href='#backtest'>Backtest</a></h4>

<p>The backtest attached to this post provides a complete example of how the Optimize API can be used in a realistic trading algorithm.  The outline of the algorithm is as follows:</p>

<ol>
<li>Once a month, choose a universe of 500 liquid assets.<br></li>
<li>Every day, build an alpha vector for our 500 assets.  The alpha model we use is very simple: we rank assets by <a href="https://en.wikipedia.org/wiki/Standard_score">z-score</a> of  <a href="http://www.investopedia.com/terms/f/freecashflowyield.asp?lgl=no-infinite">free cash flow yield</a>  and <a href="http://www.investopedia.com/terms/e/earningsyield.asp">earning yield</a>, both of which are fundamental value measures.<br></li>
<li>Once a week, calculate the portfolio that maximizes the alpha-weighted sum of our position sizes, subject to the following constraints:<br>

<ul>
<li>Our portfolio must have a maintain a gross leverage ratio of 1.0 or less.<br></li>
<li>Our portfolio can have no more than 1.5% in any single name.<br></li>
<li>Our portfolio must be equally exposed to long and short positions.<br></li>
<li>Within each market sector, our portfolio must be equally-exposed to long and short positions.</li>
</ul></li>
</ol>
<h4 id='notebook'><a class='clickable-header-link' href='#notebook'>Notebook</a></h4>

<p>In the first comment below this post I&#39;ve included an updated version of my original optimization notebook.  It provides a more theoretical introduction to the idea of portfolio optimization, and it includes a reference for the built-in objectives and constraints.</p>
<h3 id='next-steps'><a class='clickable-header-link' href='#next-steps'>Next Steps</a></h3>

<p>Now is a great time to try out the Optimize API and provide design feedback or ideas for improvements.  The API is still marked as experimental, which means breaking changes are possible, but based on feedback from the previous announcement, I think it&#39;s unlikely that there will be major backwards-incompatible changes.  Examples of ideas for improvements might include new objectives/constraints, a first-class notion of &quot;penalties&quot;, or options for avoiding orders if the new portfolio isn&#39;t a significant improvement over the old one.</p>

<p>If you want to get a feel for the new API but don&#39;t know where to start, I&#39;d recommend cloning the attached algorithm and tweaking some of the parameters.  Many of the constants listed above can be easily changed by editing a line or two.  How does increasing the leverage cap affect performance?  How about the position size constraint?  For a bit more of a challenge, try adding a new constraint.  The algorithm currently places a few orders that don&#39;t fill by the end of the day.  Would the algo improve if we constrained our position sizes to a fixed percentage of trailing volume?</p>

<p>If you&#39;re looking to dig deeper into the details of the Optimize API, I&#39;d recommend opening up the notebook reading through the examples.  If you have a specific idea you want to try, you can build your constraints and objectives interactively in research and copy them over to an algorithm when you&#39;re happy with them.  </p>
</div>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>98 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='584069dc1db30e00120001ff' id='584069dc1db30e00120001ff'>
<a href='#584069dc1db30e00120001ff'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1480616421000' class='quanto-date posted-at response-posted-at' href='#584069dc1db30e00120001ff'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s the updated notebook.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5840b4f7d581e74ec10004e5' id='5840b4f7d581e74ec10004e5'>
<a href='#5840b4f7d581e74ec10004e5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1480635649000' class='quanto-date posted-at response-posted-at' href='#5840b4f7d581e74ec10004e5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott,</p>

<p>Is there any way to get the order IDs for the orders that were submitted?</p>

<p>Also, how are you doing the ordering?  Are you just looping through the list of stocks, and applying their weights with 
<code>order_target_percent</code> or something else?  For example:</p>

<pre><code>for i, stock in enumerate(stocks):  
            if data.can_trade(stock):  
                order_target_percent(stock, weight[i])  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5841928b3c4284001200035b' id='5841928b3c4284001200035b'>
<a href='#5841928b3c4284001200035b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/571d1bab2616ef09ce0002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a69e9457dd2832a76875bcae334d5baf?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/571d1bab2616ef09ce0002b6'>Dan Whitnable</a>
</div>
<a UTCms='1480692381000' class='quanto-date posted-at response-posted-at' href='#5841928b3c4284001200035b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Scott,</p>

<p>Wow. This introduces a whole new paradigm to the Quantopian platform. Great work.</p>

<p>I have the same questions as Grant. It would be nice to simply return the weights or the delta weights and not do the ordering too (though both have their uses). One issue I see with doing the ordering is closing/reducing positions may not occur before opening/increasing others. The intra-day leverage may get  high. While not an issue in backtesting, in live trading those orders may be cancelled.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5841a6c6b8a46f001200004d' id='5841a6c6b8a46f001200004d'>
<a href='#5841a6c6b8a46f001200004d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1480697551000' class='quanto-date posted-at response-posted-at' href='#5841a6c6b8a46f001200004d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant/Dan,</p>

<p>Good questions!</p>

<blockquote>
<p>Is there any way to get the order IDs for the orders that were submitted?</p>
</blockquote>

<p><code>order_optimal_portfolio</code> doesn&#39;t have a return value right now, but that&#39;s probably an oversight.  I think it would be sensible to make it return a Series mapping assets to order ids.</p>

<blockquote>
<p>Also, how are you doing the ordering? Are you just looping through the list of stocks, and applying their weights with order_target_percent?</p>
</blockquote>

<p>Pretty much.  I have ideas for how this could be made smarter, but I wanted to start with the simplest possible implementation.  Things I&#39;m thinking about here:</p>

<ul>
<li>Adding some notion of a &quot;minimum ordering threshold&quot; so that an algo doesn&#39;t place orders if it won&#39;t materially change the portfolio.  This could probably be specified either in terms of the optimization objective or in terms of the change in the portfolio.  This might be unnecessary if we make it easier to penalize turnover in the optimization objective.<br></li>
<li>Allowing more control over how the target weights are quantized back to share counts.  <code>order_target_percent</code> just finds the share count such that the new position size is closest to <code>target_percent * portfolio_value</code>, but it&#39;s possible to get unlucky and have lots of orders round in the same direction, which could result in being over- or underexposed.  I don&#39;t have a great sense yet of how likely this is to be a real issue (I&#39;d love to see community research on this!), but there are fancier quantization algorithms we could use if it is.<br></li>
<li>Allowing more control over the time scale on which orders are executed.  I could imagine breaking up the delta into smaller orders and executing them throughout some specified period, for example.  This might help with the issue Dan noted about intraday leverage if some order fill faster than others.  This is probably longer-term idea, since it would probably require changes to how we model execution in the backtester.</li>
</ul>

<blockquote>
<p>It would be nice to simply return the weights or the delta weights and not do the ordering too</p>
</blockquote>

<p>FWIW, you can still call <code>calculate_optimal_portfolio</code> directly for this, though you&#39;d have to manually build the portfolio weights Series, which is a little tricky.  One idea here might be to make the third argument to <code>calculate_optimal_portfolio</code> optional in the backtester, though I have mixed feelings about adding functions that behave differently in research vs backtesting.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5842b8f101fc977589000393' id='5842b8f101fc977589000393'>
<a href='#5842b8f101fc977589000393'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1480767736000' class='quanto-date posted-at response-posted-at' href='#5842b8f101fc977589000393'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Scott -</p>

<p>Some feedback:</p>

<ul>
<li>Maybe I&#39;m confused, but there seems to be a kind of convolution of two steps on the <a href="https://blog.quantopian.com/a-professional-quant-equity-workflow/">workflow diagram</a>.  If I&#39;m following, you&#39;ve encapsulated the  <em>Portfolio Optimization</em>, and <em>Execution</em> steps into 
<code>order_optimal_portfolio</code> (unless you are thinking of execution as another step, which would include an order/execution management system (O/EMS) at Quantopian and whatever goes on at the broker, once the orders are submitted).  As I&#39;ve gathered, the initial release of the workflow (supposing you are thinking of it as a complete system) will be geared toward daily and longer trading cycles using pipeline.  So, it seems like I&#39;d want to run the optimization in <code>before_trading_start</code> and then decide how to apply my portfolio update over the trading day (or multiple days), either using your <code>order_optimal_portfolio</code> or handing off the weights to the O/EMS.  There is an optimal way of executing the portfolio update versus time (which is probably minute-by-minute), which is distinct from the daily (at most) optimal portfolio update (assuming only pipeline is used).<br></li>
<li>Above, you say &quot;you can still call calculate_optimal_portfolio directly for this, though you&#39;d have to manually build the portfolio weights Series, which is a little tricky.&quot;  I&#39;m confused by this statement.  Isn&#39;t this the whole point?  If I can&#39;t use the optimization API to get out a dictionary of weights, keyed by the stocks in my current universe, then something is missing.  What is tricky?<br></li>
<li>Generally, I would think through how the API would be used in <code>before_trading_start</code> where one has access to a 5-minute compute window, versus the 50-second one if the API is used within the trading day.  For example, what if you re-wrote your algo above to run <code>do_portfolio_construction</code> in <code>before_trading_start</code>, and then ran another optimization every minute (essentially an O/EMS) to manage executing the portfolio update over the trading day, starting at the open?<br></li>
<li>As I mentioned on <a href="https://www.quantopian.com/posts/request-for-feedback-portfolio-optimization-api">https://www.quantopian.com/posts/request-for-feedback-portfolio-optimization-api</a> , if you look at the <a href="http://icml.cc/2012/papers/168.pdf">OLMAR paper</a> as an example, there is a use case of computing the optimum portfolio over an expanding look-back window, and then combining the set of portfolios into one update (see Section 4.3).  Along the same lines, there is discussion in <a href="http://a.co/7ygDjKR">Carver&#39;s book</a> on optimization and the need for smoothing.  Doing a single run of the optimization may not be the best practice, so if you can supply the weights as an output then it will allow for iterative computations of the optimization, with combination of the results.<br></li>
<li>You say &quot;Every day, build an alpha vector for our 500 assets&quot; but then only run the optimization once per week.  Why do a daily build of the alpha vector, if you are only going to use it once per week?  Couldn&#39;t you speed up the backtesting by limiting all computations to once per week?  And for that matter, if the idea is to execute the workflow using pipeline, then why not bring back the daily mode for backtesting, since I don&#39;t see the advantage of suffering through minutely backtests just to get a feel for performance versus time.  Or am I missing something?  As I describe above, one could compute the optimal portfolio vector in <code>before_trading_start</code> and then pass it on to an API that would approximate minutely trading.<br></li>
<li>From your example above, it is not clear how one would use the optimization API with data from sources other than pipeline (and possibly in combination with pipeline data).  What are the specifications on  <code>pipeline_data</code> and <code>todays_universe</code> such that one could &quot;roll your own&quot; as inputs to the API?</li>
</ul>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='584351c0a10cd80015000108' id='584351c0a10cd80015000108'>
<a href='#584351c0a10cd80015000108'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52670e6a2763c5cfb70002c7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/da33ec858011a8fad211c7e0ae68160c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52670e6a2763c5cfb70002c7'>Alan Coppola</a>
</div>
<a UTCms='1480806854000' class='quanto-date posted-at response-posted-at' href='#584351c0a10cd80015000108'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Scott,<br>
Thanks for this work! I am just starting to use it, so will delay the technical questions,<br>
yet would like to ask if this module will be open sourced (e.g. scheduled for inclusion into Zipline),<br>
or will it remain proprietary?<br>
Again, thanks for your work on making optimization accessible!<br>
alan  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='584691b69718520012000757' id='584691b69718520012000757'>
<a href='#584691b69718520012000757'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1481019839000' class='quanto-date posted-at response-posted-at' href='#584691b69718520012000757'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott,</p>

<p>Another use case to consider is the application of a hedging instrument, versus an all-equity long-short portfolio.  My hack function for this is provided below.  I actually use a optimization routine to find context.a, which is a long-short vector of weights.  If the vector doesn&#39;t sum to zero, then I add in an appropriate ETF (either long or short), under the assumption that it will be a perfect hedge.</p>

<p>The <a href="https://blog.quantopian.com/a-professional-quant-equity-workflow/">workflow</a> doesn&#39;t explicitly discuss the use of hedging instruments.  I guess it would come into play through the risk model and the portfolio construction steps?</p>

<pre><code>def allocate(context, data):  
# TO DO: clean up function, add comments, standardize

    try:  
        desired_port = context.a  
    except:  
        return  
    stocks = context.stocks + [sid(28350)]  
    for stock in context.portfolio.positions.keys():  
        if stock not in stocks:  
            if data.can_trade(stock):  
                order_target_percent(stock,0)  
    pct_ls = np.sum(desired_port)  
    record(pct_ls = pct_ls)  
    scale = 1.0-0.5*abs(pct_ls)  
    m = len(context.stocks) + 1

    weight = np.zeros(m)  
    for i, stock in enumerate(context.stocks):  
        weight[i] = scale*context.leverage*desired_port[i]  
    weight[-1] = -0.5*context.leverage*pct_ls  
    for i, stock in enumerate(stocks):  
            if data.can_trade(stock):  
                order_target_percent(stock, weight[i])  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='584863f4ccfca400150003d0' id='584863f4ccfca400150003d0'>
<a href='#584863f4ccfca400150003d0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52670e6a2763c5cfb70002c7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/da33ec858011a8fad211c7e0ae68160c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52670e6a2763c5cfb70002c7'>Alan Coppola</a>
</div>
<a UTCms='1481139205000' class='quanto-date posted-at response-posted-at' href='#584863f4ccfca400150003d0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Scott,<br>
First, I agree that having order_optimal_portfolio  return an asset-->order_id map would be good!</p>

<p>Second, I can&#39;t find a way to use order_optimal_portfolio and constrain it to an uneven split of the gross value of the longs and shorts.<br>
The DollarNeutral() constraint only allows a 50-50 split(+/- some tolerance) of value, whereas, I want to try a 30-70 split( e.g., with  $10M, I&#39;d want to put $3M into shorts and $7M into longs).<br>
Any help appreciated!<br>
alan  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5848897599c6e37c1400018b' id='5848897599c6e37c1400018b'>
<a href='#5848897599c6e37c1400018b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1481148796000' class='quanto-date posted-at response-posted-at' href='#5848897599c6e37c1400018b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi All,</p>

<p>I&#39;m working on replies to a bunch of the questions here.  Will post an update later tonight.</p>

<ul>
<li>Scott<br></li>
</ul>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='58490d1abeff0248c4000023' id='58490d1abeff0248c4000023'>
<a href='#58490d1abeff0248c4000023'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1481182500000' class='quanto-date posted-at response-posted-at' href='#58490d1abeff0248c4000023'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>Maybe I&#39;m confused, but there seems to be a kind of convolution of two steps on the workflow diagram. If I&#39;m following, you&#39;ve encapsulated the Portfolio Optimization, and Execution steps into order_optimal_portfolio (unless you are thinking of execution as another step, which would include an order/execution management system (O/EMS) at Quantopian and whatever goes on at the broker, once the orders are submitted)</p>
</blockquote>

<p>The sentence in parentheses is more or less correct.  I see the optimize API as falling squarely in the realm of portfolio optimization.  Execution is a separate problem, downstream from the optimization process, that may eventually merit additional changes to how ordering is done on Quantopian (I could imagine, for example, allowing algos to specify a timeperiod over which an order or a rebalance should be executed).</p>

<p>re: calling <code>calculate_optimal_portfolio</code> directly, the &quot;tricky&quot; piece I was referring to is building the Series of portfolio weights.  A function for doing this from an algo would be something like this:</p>

<pre><code>import pandas as pd

def get_current_portfolio_weights(context, data, universe):  
    positions = context.portfolio.positions  
    positions_index = pd.Index(positions)  
    share_counts = pd.Series(  
        index=positions_index,  
        data=[positions[asset].amount for asset in positions]  
    )

    current_prices = data.current(positions_index, &#39;price&#39;)  
    current_weights = share_counts * current_prices / context.portfolio.portfolio_value  
    return current_weights.reindex(positions_index.union(universe), fill_value=0.0)  
</code></pre>

<p>We should probably make something like the above available as a new API method to make it easier for users who still want to manual control over what happens after an optimization runs.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='58490e2099c6e37c140008eb' id='58490e2099c6e37c140008eb'>
<a href='#58490e2099c6e37c140008eb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1481182767000' class='quanto-date posted-at response-posted-at' href='#58490e2099c6e37c140008eb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>From your example above, it is not clear how one would use the optimization API with data from sources other than pipeline (and possibly in combination with pipeline data). What are the specifications on pipeline_data and todays_universe such that one could &quot;roll your own&quot; as inputs to the API?</p>
</blockquote>

<p><code>pipeline_data</code> is just a regular pandas DataFrame whose index contains Equity objects.  Most Optimize API objects/methods take either pandas Serieses (generally mapping asset -> float) or pandas Index&#39;es (generally containing Equity objects).  The specific signatures are all pretty well documented in the notebook posted above.</p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5849100db5ef1e00150002fb' id='5849100db5ef1e00150002fb'>
<a href='#5849100db5ef1e00150002fb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1481183260000' class='quanto-date posted-at response-posted-at' href='#5849100db5ef1e00150002fb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>Second, I can&#39;t find a way to use order_optimal_portfolio and constrain it to an uneven split of the gross value of the longs and shorts.<br>
The DollarNeutral() constraint only allows a 50-50 split(+/- some tolerance) of value, whereas, I want to try a 30-70 split( e.g., with $10M, I&#39;d want to put $3M into shorts and $7M into longs).</p>
</blockquote>

<p>There are two ways I could think to do this:</p>

<ol>
<li><p>If you know what your longs/shorts should be in advance, you could use a <code>NeutralBasket</code> constraint.  <code>NeutralBasket</code> takes a set of longs, a set of shorts, and min/max net exposure to the basket.  The idea behind the name <code>NeutralBasket</code> is that <code>min_net_exposure</code> and <code>max_net_exposure</code> are expected to be centered around zero, but there&#39;s no reason you couldn&#39;t center them around some other value to produce a net-long or net-short portfolio.  I&#39;m probably going to rename <code>NeutralBasket</code> to something more generic  to make it clearer that this is a reasonable usage.</p></li>
<li><p>If you don&#39;t know what your longs/shorts should be in advance, you can use <code>NetLeverage</code> with a target net leverage.  In your case, if you want to have a 70/30 split, you&#39;d have a target net leverage of 0.4 * target_gross_leverage.  </p></li>
</ol>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='584911aaf7b10b0015000930' id='584911aaf7b10b0015000930'>
<a href='#584911aaf7b10b0015000930'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1481183679000' class='quanto-date posted-at response-posted-at' href='#584911aaf7b10b0015000930'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>You say &quot;Every day, build an alpha vector for our 500 assets&quot; but then only run the optimization once per week. Why do a daily build of the alpha vector, if you are only going to use it once per week?</p>
</blockquote>

<p>We could compute the alpha vecotr less often by throwing a call to <code>.downsample(&#39;week_start&#39;)</code> on the final alpha calculation, but doing so makes the pipeline more complex and wouldn&#39;t have a material effect on the runtime of the algorithm.  If we were doing something fancier in the alpha combination or alpha generation phases (e.g. running a machine learning model), then intelligent downsampling would be worth considering.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='58493adab5ef1e00150004e5' id='58493adab5ef1e00150004e5'>
<a href='#58493adab5ef1e00150004e5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1481194209000' class='quanto-date posted-at response-posted-at' href='#58493adab5ef1e00150004e5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Scott -</p>

<p>Any thoughts on how to do something like this:</p>

<ol>
<li>Pick a sample trailing window of data.<br></li>
<li>For the sample window, get the optimal portfolio vector and the expected return if the portfolio were changed.<br></li>
<li>Store the optimal portfolio vector and its expected return.<br></li>
<li>Loop back to step 1, picking a new sample trailing window.<br></li>
<li>After N samples, use the results in combination to find the overall optimal portfolio vector.<br></li>
<li>Tweak the overall optimal portfolio vector, with an additional set of constraints to minimize unnecessary turnover, trading costs, etc.<br></li>
<li>Submit orders.</li>
</ol>

<p>Is something like this feasible?  If you could kinda point the way, I think I&#39;d be able to work up an example of the long-only OLMAR algo, using your API (I have a long-short version, too, which I could share with you privately).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5852ff360098303dfc000593' id='5852ff360098303dfc000593'>
<a href='#5852ff360098303dfc000593'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5813bd3ae3a122200d000120'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a5cb7c2574bb8edabf8366cd30275181?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5813bd3ae3a122200d000120'>Sebastian Groß</a>
</div>
<a UTCms='1481834302000' class='quanto-date posted-at response-posted-at' href='#5852ff360098303dfc000593'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey Scott, good work! I hope you can answer my (more mathematical/technical) questions.</p>

<ol>
<li>Which kind of objective-function is feasible (basically: what algorithm is used for the optimization)?<br></li>
<li>What happens if no solution can be found (divergence, maximal iterations, etc)?<br></li>
<li>Are you planing to add optional arguments? Like a gradient-function: My experience is, that an analytical gradient outperforms any numerical scheme by far. Or the type of objective, to choose the best algorithm.<br></li>
</ol>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='585515b994b8d41e070001be' id='585515b994b8d41e070001be'>
<a href='#585515b994b8d41e070001be'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1481971135000' class='quanto-date posted-at response-posted-at' href='#585515b994b8d41e070001be'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scot -</p>

<p>I&#39;d posted some comments to <a href="https://www.quantopian.com/posts/machine-learning-on-quantopian-part-3-building-an-algorithm">https://www.quantopian.com/posts/machine-learning-on-quantopian-part-3-building-an-algorithm</a> , but I guess they weren&#39;t germane enough to the ML discussion, and got deleted by a Quantopian moderator.  Perhaps you can address them here:</p>

<blockquote>
<p>Well, the optimization has a market_neutral constraint. How does it<br>
work? Is it fancy-dancy, doing correlation analyses w.r.t. SPY, and<br>
then projecting beta, and adjusting the weights accordingly? Or is it<br>
something simplistic, like fixing the sum of the signed weights to<br>
zero?  </p>

<p>And how do the constraints interact? Will the optimization fail if a<br>
constraint can&#39;t be met exactly, or is there some wiggle room?  </p>

<p>Also, how would a hedging instrument (or instruments) be applied? It<br>
seems like this is a gap in the framework, no?  </p>
</blockquote>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5857b5817f8cad7a7e000138' id='5857b5817f8cad7a7e000138'>
<a href='#5857b5817f8cad7a7e000138'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/584ffce4aec4b3001500022e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5847ecc9bca34c9a54b0d9c5bf2d38a3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/584ffce4aec4b3001500022e'>Chon Ro</a>
</div>
<a UTCms='1482143114000' class='quanto-date posted-at response-posted-at' href='#5857b5817f8cad7a7e000138'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scot,</p>

<p>thumbs up for your work.<br>
I&#39;d like to repeat Alan Coppolas question from 3 weeks ago:<br>
Are you planning to include this module into Zipline anytime soon?</p>

<p>chonro  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5858091778638919640002ac' id='5858091778638919640002ac'>
<a href='#5858091778638919640002ac'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1482164510000' class='quanto-date posted-at response-posted-at' href='#5858091778638919640002ac'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi All,</p>

<p>Sorry for not being as responsive as I&#39;d like to be here.  A few quick replies:</p>

<p>&quot;What kinds of constraints/objectives are allowed?&quot; - Currently, most of the heavy lifting in the optimize api is done by  <a href="http://www.cvxpy.org/en/latest/">CVXPY</a>, which is a library for doing convex programming.  <a href="http://www.cvxpy.org/en/latest/tutorial/dcp/index.html#disciplined-convex-programming">This page</a> provides a nice overview of the kinds of problems solvable within this framework.  The <a href="http://www.cvxpy.org/en/latest/examples/index.html">examples</a> and <a href="http://www.cvxpy.org/en/latest/tutorial/functions/index.html">functions</a> pages are also useful here.</p>

<p>&quot;Is the optimize API being open-sourced?&quot; - We&#39;d definitely like to make the code underlying the optimize API open source.  The major issue with doing so is that most of the lower-level building blocks of the optimize code are licensed under the <a href="https://www.gnu.org/licenses/quick-guide-gplv3.html">GPL</a>, which is incompatible with the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License</a> under which we distribute Zipline and the rest of the Quantopian open source portfolio.  What that means, as a practical matter, is that we probably can&#39;t include the optimize code in Zipline itself; we&#39;d have to distribute it as a standalone library and provide some sort of optional plugin interface for it in Zipline.  That&#39;s all technically feasible, but splitting up the sources would be an extra source of friction that we don&#39;t want to add to the development process right now.</p>

<p>&quot;How do multiple constraints interact?  What happens if constraints can&#39;t be satisfied.&quot; - All constraints specified in an optimization have to be satisfied.  If they can&#39;t, the optimization will fail with an <code>InfeasibleConstraints</code> errors.  It&#39;s also possible for the optimization to fail if the constraints fail to place an upper/lower bound on the objective (imagine, for example, trying to maximize <code>f(x) = x ** 2</code> with only the constraint being <code>x &gt;= 0</code>), in which case the optimization will fail with an <code>UnboundedObjective</code> error.</p>

<p>&quot;How does a market neutral constraint work?&quot; - The built-in <code>DollarNeutral</code> constraint just enforces that the net amount of capital allocated to long and short positions is within some tolerance from zero.  You could build a beta-weighted market neutral constraint by calculating your own betas and passing those to a <code>WeightedExposure</code> constraint.  This would be a nice example post for the community if anyone is interested in trying it out.</p>

<p>Grant, w/r/t your example algo outline, I won&#39;t have time in the near future to write up a full example.  I&#39;d suggest posting your outline to the community and see if anyone is interested in trying to collaborate on the problem.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='58580fd6010169001200003e' id='58580fd6010169001200003e'>
<a href='#58580fd6010169001200003e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/514a23ed46a2329dd8000027'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f292ab7887c2e8698d013b40e1718e8b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/514a23ed46a2329dd8000027'>Suminda Dharmasena</a>
</div>
<a UTCms='1482166236000' class='quanto-date posted-at response-posted-at' href='#58580fd6010169001200003e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Wondering is there is a possibility of replacing CVXPY as any algo we write using the optimisation API will automatically become GPL and we have to open source if we were to distribute it or even share it privately.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5858fa2bc20b29236c00009c' id='5858fa2bc20b29236c00009c'>
<a href='#5858fa2bc20b29236c00009c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/518df7ef1ee7cde87a000020'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/45d953d993231950278d0f1e380d9b2f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/518df7ef1ee7cde87a000020'>Femto Trader</a>
</div>
<a UTCms='1482226227000' class='quanto-date posted-at response-posted-at' href='#5858fa2bc20b29236c00009c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi all,</p>

<p>I&#39;m not sure this thread is the best place to ask but as it deals with optimization I think it&#39;s worth to ask here...</p>

<p>A walk forward optimization framework could be a nice feature to have.</p>

<p>What is walk forward optimization ?<br>
<a href="https://en.wikipedia.org/wiki/Walk_forward_optimization">https://en.wikipedia.org/wiki/Walk_forward_optimization</a><br>
<a href="https://www.amibroker.com/guide/h_walkforward.html">https://www.amibroker.com/guide/h_walkforward.html</a></p>

<p>An other Quantopian user was looking for such a feature : see <a href="https://www.quantopian.com/posts/walk-forward-optimization-is-there-plan-in-the-work">https://www.quantopian.com/posts/walk-forward-optimization-is-there-plan-in-the-work</a></p>

<p>Several years ago, Thomas Wiecki wrote a nice article in a blog post about that<br>
<a href="https://blog.quantopian.com/parameter-optimization/">https://blog.quantopian.com/parameter-optimization/</a></p>

<p>What is current status ?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58590982505a442439000150' id='58590982505a442439000150'>
<a href='#58590982505a442439000150'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1482230152000' class='quanto-date posted-at response-posted-at' href='#58590982505a442439000150'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Scott -</p>

<p>Regarding the question of how to handle failures of the optimization routine, how are you planning to approach this?  In the case of <a href="https://docs.scipy.org/doc/scipy-0.18.1/reference/generated/scipy.optimize.minimize.html#scipy.optimize.minimize">https://docs.scipy.org/doc/scipy-0.18.1/reference/generated/scipy.optimize.minimize.html#scipy.optimize.minimize</a> , there is a 
<code>success</code> flag along with a message.   So, if for some reason the optimization does not converge (but runs) it can be handled.  How are you planning to deal with the case of no convergence?  There are errors that would cause the algo to crash, such as setting up the optimization improperly; presumably your <code>InfeasibleConstraints</code> and  <code>UnboundedObjective</code> conditions fit into this category (and could be managed with <code>try-except</code>).  What if the problem is formulated correctly, but a solution just can&#39;t be found (within N iterations, a specified time, or a specified tolerance)?  Will there be a <code>success</code> flag?  Or are you expecting <code>try-except</code> to be used?  And if the latter, will the error code be available within the algo? </p>

<blockquote>
<p>Grant, w/r/t your example algo outline, I won&#39;t have time in the near future to write up a full example. I&#39;d suggest posting your outline to the community and see if anyone is interested in trying to collaborate on the problem.</p>
</blockquote>

<p>No problem.  I&#39;m not clear yet if we will be able to get out the optimum portfolio weight vector, since it is embedded in your <code>order_optimal_portfolio</code>.  Perhaps you or someone else could show me how to use the optimization API at a lower level, to get the portfolio weight vector without placing orders.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5859632a26a9930012000010' id='5859632a26a9930012000010'>
<a href='#5859632a26a9930012000010'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52670e6a2763c5cfb70002c7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/da33ec858011a8fad211c7e0ae68160c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52670e6a2763c5cfb70002c7'>Alan Coppola</a>
</div>
<a UTCms='1482253105000' class='quanto-date posted-at response-posted-at' href='#5859632a26a9930012000010'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Scott,<br>
Fortunately, looks like the GPL issue for CVXPY won&#39;t be an issue much longer. See:<br>
<a href="https://github.com/cvxgrp/cvxpy/issues/313">https://github.com/cvxgrp/cvxpy/issues/313</a></p>

<p>While the functionality is nice, and the package works fairly well,<br>
I personally can&#39;t afford using it or looking at it anymore until it is either released open source<br>
or is a commercial product that is fully documented, categorized, and supported.<br>
It just takes too much of my time to infer things about black box code.<br>
alan  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='585a394749a3b96937000105' id='585a394749a3b96937000105'>
<a href='#585a394749a3b96937000105'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/514a23ed46a2329dd8000027'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f292ab7887c2e8698d013b40e1718e8b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/514a23ed46a2329dd8000027'>Suminda Dharmasena</a>
</div>
<a UTCms='1482307920000' class='quanto-date posted-at response-posted-at' href='#585a394749a3b96937000105'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>OK Great! Hope the switch will be fast!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='588f1b0ad6286413293c65bd' id='588f1b0ad6286413293c65bd'>
<a href='#588f1b0ad6286413293c65bd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1485773578000' class='quanto-date posted-at response-posted-at' href='#588f1b0ad6286413293c65bd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott -</p>

<p>I&#39;ve started to play around with this new API.  I noticed this:</p>

<pre><code>import quantopian.algorithm as algo  
</code></pre>

<p>What is this?  Why do you use it?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='589c443733097c02c887b8bf' id='589c443733097c02c887b8bf'>
<a href='#589c443733097c02c887b8bf'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1486636087000' class='quanto-date posted-at response-posted-at' href='#589c443733097c02c887b8bf'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott,</p>

<p>The attached code fails, when I add the constraint:</p>

<pre><code>MAX_TURNOVER = 0.75

constrain_turnover = opt.MaxTurnover(MAX_TURNOVER)  
</code></pre>

<p>It fails part-way into the backtest with:</p>

<p><em>Something went wrong. Sorry for the inconvenience. Try using the built-in debugger to analyze your code. If you would like help, send us an email.<br>
SolverError: Solver &#39;ECOS&#39; failed. Try another solver.<br>
There was a runtime error on line 130.</em></p>

<p>Any idea why?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='589c84b16471b96acaf992b8' id='589c84b16471b96acaf992b8'>
<a href='#589c84b16471b96acaf992b8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5674b7bd1869e73f4a000334'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e411d64f7a123f5c2102614fafa48b58?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5674b7bd1869e73f4a000334'>Luke Izlar</a>
</div>
<a UTCms='1486652593000' class='quanto-date posted-at response-posted-at' href='#589c84b16471b96acaf992b8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Can anyone give an example of how you would use calculate_optimal_portfolio() as opposed to order_optimal_portfolio() in an algorithm?</p>

<p>I can&#39;t seem to figure out what it needs me to do to correctly pass it a current_portfolio as a pd.Series  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='589c8f4a86c5596f69900720' id='589c8f4a86c5596f69900720'>
<a href='#589c8f4a86c5596f69900720'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1486655306000' class='quanto-date posted-at response-posted-at' href='#589c8f4a86c5596f69900720'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>It&#39;d be nice to be able to do something like this:</p>

<pre><code>target_weights = order_optimal_portfolio(  
        objective=objective,  
        constraints=[  
            constrain_gross_leverage,  
            constrain_pos_size,  
            market_neutral,  
            sector_neutral,  
            constrain_turnover  
        ],  
        universe=todays_universe,  
        order = False,  
    )  
</code></pre>

<p>It wouldn&#39;t actually submit the orders, but instead just spit out the target weights that would be applied via <code>order_target_percent</code> as a <code>dict</code> or some Pandas thingy.</p>

<p>Also, will the API eventually make it to the open-source zipline or otherwise?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='589cbfde86c5594e889006a0' id='589cbfde86c5594e889006a0'>
<a href='#589cbfde86c5594e889006a0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1486667742000' class='quanto-date posted-at response-posted-at' href='#589cbfde86c5594e889006a0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Note that eventually, the optimization API may be open-sourced, per Scott&#39;s comments and the github issue:</p>

<p><a href="https://www.quantopian.com/posts/optimize-api-now-available-in-algorithms#5858091778638919640002ac">https://www.quantopian.com/posts/optimize-api-now-available-in-algorithms#5858091778638919640002ac</a><br>
<a href="https://github.com/cvxgrp/cvxpy/issues/313#issuecomment-268312493">https://github.com/cvxgrp/cvxpy/issues/313#issuecomment-268312493</a></p>

<p>It is snagged on a licensing issue.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='589cc18cfe398416c6a42e85' id='589cc18cfe398416c6a42e85'>
<a href='#589cc18cfe398416c6a42e85'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5622a26f2b9a17dcbb0006fb'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/d9746d1b6fe131e63f6965a92adec42b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5622a26f2b9a17dcbb0006fb'>Ann</a>
</div>
<a UTCms='1486668172000' class='quanto-date posted-at response-posted-at' href='#589cc18cfe398416c6a42e85'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>It looks like the CVXPY licensing issue was resolved yesterday. Yay! I&#39;m looking forward to seeing the code for this...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='589d56100bcd733c1964c212' id='589d56100bcd733c1964c212'>
<a href='#589d56100bcd733c1964c212'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/573af8c089bb64093f000893'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9bfa4d5fca3a14f516a215379b92bc55?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/573af8c089bb64093f000893'>Jun Chao Keung</a>
</div>
<a UTCms='1486706192000' class='quanto-date posted-at response-posted-at' href='#589d56100bcd733c1964c212'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>wonder do we a timeline on when will this be open sourced pls ?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='589d9efd84568f16ba23b079' id='589d9efd84568f16ba23b079'>
<a href='#589d9efd84568f16ba23b079'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1486724861000' class='quanto-date posted-at response-posted-at' href='#589d9efd84568f16ba23b079'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I got the turnover constraint to work with a 
<code>try-except</code>:</p>

<pre><code>    try:  
        order_optimal_portfolio(  
            objective=objective,  
            constraints=[  
                constrain_gross_leverage,  
                constrain_pos_size,  
                market_neutral,  
                sector_neutral,  
                constrain_turnover  
            ],  
            universe=todays_universe,  
        )  
    except:  
        return  
</code></pre>

<p>How can I unravel why this is necessary?  Do I have some constraints that can sometimes &quot;collide&quot; depending on the input set of alphas?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='589dbc2bfa2e514c1e0b98fd' id='589dbc2bfa2e514c1e0b98fd'>
<a href='#589dbc2bfa2e514c1e0b98fd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/571d1bab2616ef09ce0002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a69e9457dd2832a76875bcae334d5baf?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/571d1bab2616ef09ce0002b6'>Dan Whitnable</a>
</div>
<a UTCms='1486732331000' class='quanto-date posted-at response-posted-at' href='#589dbc2bfa2e514c1e0b98fd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Luke</p>

<p>Attached is an algorithm which uses the &#39;calculate_optimal_portfolio()&#39; method as opposed to &#39;order_optimal_portfolio() &#39;. I need to use that for better control of the actual ordering for live trading in Robinhood.</p>

<p>To get the required current actual portfolio weights I did this:</p>

<pre><code>    for security, position in context.portfolio.positions.items():  
        output_df.set_value(security, &#39;actual_weight&#39;, position.amount * position.last_sale_price / context.portfolio.portfolio_value)  
</code></pre>

<p>The actual weights end up as a column in a dataframe (indexed by the security). These weights are then passed to the &#39;calculate_optimal_portfolio&#39; method as below</p>

<pre><code>    context.output.adj_weight = opt.calculate_optimal_portfolio(objective, constraints, context.output.actual_weight)

</code></pre>

<p>Look towards the end of the algorithm in the function called &#39;adjust_weights&#39; for the actual optimization code.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='589dcc59fa2e5168620b9871' id='589dcc59fa2e5168620b9871'>
<a href='#589dcc59fa2e5168620b9871'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/571d1bab2616ef09ce0002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a69e9457dd2832a76875bcae334d5baf?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/571d1bab2616ef09ce0002b6'>Dan Whitnable</a>
</div>
<a UTCms='1486736473000' class='quanto-date posted-at response-posted-at' href='#589dcc59fa2e5168620b9871'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Grant. I have a similar (perhaps the same) problem with the &#39;MaxTurnover&#39; constraint. It generates an &#39;InfeasableConstraint&#39; error and crashes unless I wrap it in a &#39;try..except&#39; statement as you did (though I am using the &#39;calculate_optimal_portfolio&#39; method). It seems to not like the initial portfolio state of zero shares in any position. Maybe it considers going from nothing to anything a violation of the constraint?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='589dccdd67545d3f2d09c8e0' id='589dccdd67545d3f2d09c8e0'>
<a href='#589dccdd67545d3f2d09c8e0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1486736605000' class='quanto-date posted-at response-posted-at' href='#589dccdd67545d3f2d09c8e0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Dan -</p>

<p>Yeah...mysterious.  It does work, though, but apparently will cause CVXPY to barf under certain circumstances.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='589ee4e0f7af5c5bfdaaf35e' id='589ee4e0f7af5c5bfdaaf35e'>
<a href='#589ee4e0f7af5c5bfdaaf35e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1486808288000' class='quanto-date posted-at response-posted-at' href='#589ee4e0f7af5c5bfdaaf35e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s another example of using 
<code>calculate_optimal_portfolio</code>.  Seems to work fine, but it does require construction of the current portfolio weights:</p>

<pre><code>    port = context.stocks + list(set(context.portfolio.positions.keys()) - set(context.stocks))  
    w = np.zeros(len(port))  
    for i,stock in enumerate(port):  
        w[i] = context.portfolio.positions[stock].amount*data.current(stock,&#39;price&#39;)  
    denom = np.sum(np.absolute(w))  
    if denom &gt; 0:  
        w = w/denom  
    current_portfolio = pd.Series(w,index=port)  
</code></pre>

<p>Not so pretty, but it works.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a079fe21d68a000d277dae' id='58a079fe21d68a000d277dae'>
<a href='#58a079fe21d68a000d277dae'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1486911998000' class='quanto-date posted-at response-posted-at' href='#58a079fe21d68a000d277dae'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant, I&#39;ve tried your last version posted above. It is a strategy that would comply for what Q is seeking: low beta, low volatility, low drawdown. Since Q has said they might like to leverage something like that, I went for “MAX_GROSS_LEVERAGE = 4.0”. The program did not terminate above that.</p>

<p>With the modification, recorded max leverage goes up to about 1.5. </p>

<p>So, the question: what would force your program to reach a max leverage of 6?</p>

<p>It would give a view of what a 6 times leveraged low drawdown portfolio would look like over the 12-year test. </p>

<p>Based on a preceding version, I had the leverage go up to 4.5 but performance degraded, and this without counting interest charges.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a08acc207362000da33b21' id='58a08acc207362000da33b21'>
<a href='#58a08acc207362000da33b21'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1486916300000' class='quanto-date posted-at response-posted-at' href='#58a08acc207362000da33b21'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Guy -</p>

<p>Yeah, it does have the appearance of the kind of thing the Q fund team might be interested in--basically a low-return, SR &gt;= 1, low-risk strategy that can be leveraged to 6X (in my mind, not unlike a bank CD or money-market fund, but I guess there the cost of leverage is too high, relative to the return).  The optimization API has the effect of getting rid of the nasty drawdowns and volatility that would throw a monkey wrench into the whole idea.  The basic idea is that one can keep the leverage peddle to the metal, so long as the risk is managed.</p>

<p>It is weird that you were not able to crank up the leverage.  It should just end up being a multiplier: 
<code>order_target_percent(stock,leverage*weight[stock])</code>.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a08d4e4dc709000afd51a4' id='58a08d4e4dc709000afd51a4'>
<a href='#58a08d4e4dc709000afd51a4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/571d1bab2616ef09ce0002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a69e9457dd2832a76875bcae334d5baf?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/571d1bab2616ef09ce0002b6'>Dan Whitnable</a>
</div>
<a UTCms='1486916942000' class='quanto-date posted-at response-posted-at' href='#58a08d4e4dc709000afd51a4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The optimize method has sort of mind of it&#39;s own (at least from what I&#39;ve experienced). The results aren&#39;t always what would be initially expected. A good case in point is Guy&#39;s observation that, even when setting the “MAX_GROSS_LEVERAGE = 4.0” that the actual leverage never goes above 1.5. </p>

<p>The optimize algorithm is simply doing it&#39;s thing and determines that a solution to the objective (maximize the alpha factor) does not require the leverage to be above 1.5. The &#39;MaxGrossLeverage&#39; constraint only ensures that the leverage won&#39;t exceed that amount and not that it will equal that amount.</p>

<p>Anyway, it&#39;s illuminating that it might be &#39;optimal&#39; to only use 1.5 leverage (at least as far as the optimizer is concerned). A simplistic approach to getting an overall leverage of 3.0 is then to set the “MAX_GROSS_LEVERAGE = 1.5&quot;. Then go down to the &#39;order&#39; function and simply multiply all the weights by 2. This results in a net leverage of 3.0. (there are a few times it inches above 3.0 but that could easily be fixed with better order logic and probably doesn&#39;t impact the overall results much). Not pretty but it shows what a leveraged algorithm would do.  </p>

<pre><code> order_target_percent(stock,weight*2.0)

</code></pre>

<p>Attached is a backtest. Nice results, especially the way it sails through the 2008 downturn. Kudos to you Grant.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a0951509f982341068947c' id='58a0951509f982341068947c'>
<a href='#58a0951509f982341068947c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1486918933000' class='quanto-date posted-at response-posted-at' href='#58a0951509f982341068947c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>Nice results, especially the way it sails through the 2008 downturn</p>
</blockquote>

<p>There could be &quot;over-fitting&quot; here by a so-called quant.  If you try the code below, the 2008 downturn behavior is different.  One can kinda tune the &quot;Great Recession&quot; response by flipping the sign of 
<code>d</code> for extreme values of <code>x_tilde</code>.  I have no firm basis for this, although in my hobbyist quant mind, the pure mean-reversion factor becomes more of a combined mean-reversion/momentum factor with this change.  Presumably, one could write separate mean-reversion and momentum factors and then combine their alphas, and then run the combined alpha through the optimization API.</p>

<pre><code>def mean_rev(context,data,prices):  
    m = len(context.stocks)  
    d = np.ones(m)  
    x_tilde = np.mean(prices,axis=0)/prices[-1,:]  
    y_tilde = 1.0/x_tilde  
    d[x_tilde &lt; 1] = -1  
    # d[x_tilde &lt; 0.9] = 1  
    # d[x_tilde &gt; 1.1] = -1  
    x_tilde[x_tilde &lt; 1] = 0  
    y_tilde[x_tilde != 0] = 0  
    x_tilde = x_tilde + y_tilde

    return (d*x_tilde, np.sum(x_tilde)/m)  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a0a43821d68a000a278002' id='58a0a43821d68a000a278002'>
<a href='#58a0a43821d68a000a278002'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1486922808000' class='quanto-date posted-at response-posted-at' href='#58a0a43821d68a000a278002'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant, I use the version provided by Dan. Used “MAX_GROSS_LEVERAGE = 2.0”, and “weight*3.0”. By my calculations, even after having paid interest charges of 3% on 5/6 of A(t), the strategy would be left with a 15.86% CAGR for the 12.12 year test period.</p>

<p>Not bad. There is alpha in there, even at 6 times leverage.</p>

<p>Your mean_rev might be what protected you during the financial crisis. I would leave it there as a protection for similar future events. And study how it did its job to see if it was responsible for dampening price variations during that period.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a0b191207362000aa33cfb' id='58a0b191207362000aa33cfb'>
<a href='#58a0b191207362000aa33cfb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1486926225000' class='quanto-date posted-at response-posted-at' href='#58a0b191207362000aa33cfb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant, by making some slight changes to your basic design, you could increase overall performance by being more lenient on some of the parameters.</p>

<p>I went for the following:</p>

<p>Constraint Parameters<br>
MAX_GROSS_LEVERAGE = 2.0           #was 1.0<br>
MAX_SHORT_POSITION_SIZE = 0.03  #was 0.015<br>
MAX_LONG_POSITION_SIZE = 0.035  #was 0.015<br>
MAX_TURNOVER = 1.50                       #was 0.75</p>

<p>I wanted to be biased to the upside, therefore more weight. Also, possibly a higher concentration on best performers. And allowed more trading activity by easing the turnover restriction. </p>

<p>With these numbers, and the “weight*3.0” to get 6 times leverage, I obtained a 21.94% CAGR. And this after having paid the leverage charges which totaled about $6.2 million.</p>

<p>Just by changing initial assumptions, you can increase overall performance. A 21.94% CAGR is an excellent performance level.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a0b55b207362000aa33d33' id='58a0b55b207362000aa33d33'>
<a href='#58a0b55b207362000aa33d33'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1486927195000' class='quanto-date posted-at response-posted-at' href='#58a0b55b207362000aa33d33'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant, sorry, forgot to attach the backtest.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a0b7f31ae0d31e9c6385cf' id='58a0b7f31ae0d31e9c6385cf'>
<a href='#58a0b7f31ae0d31e9c6385cf'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1486927859000' class='quanto-date posted-at response-posted-at' href='#58a0b7f31ae0d31e9c6385cf'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Guy -</p>

<p>As far as this discussion thread goes, I&#39;d say the question is how to determine the optimization API settings?  Lots of bells-and-whistles, so perhaps some rules-of-thumb could be published?  For your typical long-short equity algo, what is the recommended configuration of the optimization API?  Maybe in comes down to running backtests through pyfolio, and then looking at the guidance on <a href="https://www.quantopian.com/allocation">https://www.quantopian.com/allocation</a> and making adjustments until it it conforming?  Even then, there&#39;s probably too big of a parameter space to just make adjustments by fiddling by-hand.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a0bdf94dc709000dfd54c5' id='58a0bdf94dc709000dfd54c5'>
<a href='#58a0bdf94dc709000dfd54c5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1486929401000' class='quanto-date posted-at response-posted-at' href='#58a0bdf94dc709000dfd54c5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant, even there, you want some preliminary indication that the task might be worth the effort. Your initial settings did flatten out the equity curve, even during the financial crisis. However, the price was high in the sense that it underperformed averages.</p>

<p>You want to know what are the limits of your trading strategies. A 100,000 Monte Carlo test on your trading script could take quite a while. When all you want to know are approximations since the future will be different anyway.</p>

<p>However, your program will continue to act as it did in the past. And not having an inkling of where the limits are could be disastrous since your program might not be able to handle it pass those limits.</p>

<p>Also, whatever optimization method you want to use, what you feed it will be paramount.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a0c04d09f9827d9b688dfb' id='58a0c04d09f9827d9b688dfb'>
<a href='#58a0c04d09f9827d9b688dfb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1486929997000' class='quanto-date posted-at response-posted-at' href='#58a0c04d09f9827d9b688dfb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant, the Pyfolio Bayesian tear sheet produced the following:</p>

<p><a href="http://alphapowertrading.com/quantopian/Optimize_API_dist.png">http://alphapowertrading.com/quantopian/Optimize_API_dist.png</a></p>

<p>Setting used: bt.create_returns_tear_sheet(live_start_date=&#39;2014-1-1&#39;)</p>

<p>What the above chart indicates is that going forward, the methodology is breaking down. Code modifications would be required to change that picture.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a0c12d09f9827d9b688e17' id='58a0c12d09f9827d9b688e17'>
<a href='#58a0c12d09f9827d9b688e17'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1486930221000' class='quanto-date posted-at response-posted-at' href='#58a0c12d09f9827d9b688e17'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>It is on my list to use the alphalens thingamabob to analyze the factor.  There&#39;s a bit of a learning curve, since all of the examples are pipeline-based, as far as I know.  The optimization won&#39;t do diddly if there is no &quot;alpha&quot; in the factor to begin with.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a0c24421d68a000a278219' id='58a0c24421d68a000a278219'>
<a href='#58a0c24421d68a000a278219'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1486930500000' class='quanto-date posted-at response-posted-at' href='#58a0c24421d68a000a278219'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant, yes. Note that the original design did not generate alpha. It was by changing assumptions and leveraging that the picture changed. And still, we can see portfolio metric deterioration.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a143580b9016732764a8b3' id='58a143580b9016732764a8b3'>
<a href='#58a143580b9016732764a8b3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1486963544000' class='quanto-date posted-at response-posted-at' href='#58a143580b9016732764a8b3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Couple of other things to keep in mind:</p>

<p>Consider spending the available $1M in cash, it is only utilized a little bit. Here&#39;s some info on the two most recent algos above. They take a long time to run so this applies just to Jan 2013 where the benchmark is around 39%, using the PvR tool:<br>
The DW version profited 1,409,033 on 3,723,288 activated/transacted for PvR of 37.8%.<br>
The GF version profited 10,122,169 on 37,877,149 activated/transacted for PvR of only 26.7%.</p>

<p>That last one is apparently shorting nearly 38 million. I&#39;m not sure how margin works at IB for example and I guess one has to have a margin account to do that kind of shorting.<br>
Slippage and commissions are turned off in both so brace for worse.</p>

<p>When looking at a backtest chart, a good way to think of it is that those returns might be possible, only, as long as practical real-world limitations are observed, and I&#39;ve seen times where reigning in margin wound up with real profits actually higher than previously mere apparent profits so hang in there.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a1d085be3d411e8e74ba1c' id='58a1d085be3d411e8e74ba1c'>
<a href='#58a1d085be3d411e8e74ba1c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1486999685000' class='quanto-date posted-at response-posted-at' href='#58a1d085be3d411e8e74ba1c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Blue, yes. There is a big difference when you consider with and without frictional costs. I pushed this trading strategy to new heights, not by optimizing the optimizer, but by changing its initial parameters. Changing its trading universe.</p>

<p>Without frictional costs, I obtained:</p>

<p><a href="http://alphapowertrading.com/quantopian/SPY_WVF_1M_with_out_costs.png">http://alphapowertrading.com/quantopian/SPY_WVF_1M_with_out_costs.png</a></p>

<p>That is a 28.69% CAGR over the 12.12 years. Including interest charges, that return would drop to 24.06%. Still quite interesting.</p>

<p>And with frictional costs, the picture changed considerably.</p>

<p><a href="http://alphapowertrading.com/quantopian/SPY_WVF_1M_with_costs.png">http://alphapowertrading.com/quantopian/SPY_WVF_1M_with_costs.png</a></p>

<p>Here we see the impact of slippage and commissions using Quantopian&#39;s defaults values. The CAGR dropped to 14.65%. And if we included interest charges. It would drop further to: 10.52%! Getting pretty close to the average secular trend. In a way showing there is no free lunch...</p>

<p>By the very nature of this trading strategy, I find it understandable since it is catching the fuzzy statistical drift. And by which, over the years, will tend to the secular trend when considering all expenses.</p>

<p>Note that the picture would be worse if not leveraged 6 times.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58a2400395710e000d44bda2' id='58a2400395710e000d44bda2'>
<a href='#58a2400395710e000d44bda2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1487028227000' class='quanto-date posted-at response-posted-at' href='#58a2400395710e000d44bda2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Is there a broker that willl let you use their ~$40M without putting up a couple mansions as collateral?<br>
Note the leverage was actually 8, not 6. The code was set to do 6, it had other ideas during the day, maybe the most common user mistake. <a href="http://quantopian.com/posts/max-intraday-leverage">Explanation</a>. </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58c18725a3dde83d10b635e5' id='58c18725a3dde83d10b635e5'>
<a href='#58c18725a3dde83d10b635e5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/527612eb2de84d52740000d5'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/873c5860f8b916285b474f56cbd6f135?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/527612eb2de84d52740000d5'>Deleted User</a>
</div>
<a UTCms='1489078053000' class='quanto-date posted-at response-posted-at' href='#58c18725a3dde83d10b635e5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>How does one provide a quadratic objective function to quantopian&#39;s optimize API?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58c91903eb10d239896945d6' id='58c91903eb10d239896945d6'>
<a href='#58c91903eb10d239896945d6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1489574147000' class='quanto-date posted-at response-posted-at' href='#58c91903eb10d239896945d6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott -</p>

<p>I&#39;d like to be able to call the optimization API and get the target weights out without automatically placing orders.  Is this feasible?  Something tidy like this would be handy:</p>

<pre><code>weights = run_optimization()  
</code></pre>

<p>This would allow computing a set of weights over an expanding trailing window, for example, so that they could then be smoothed, prior to placing orders.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58c9dc20a35c3f3d3b62a96a' id='58c9dc20a35c3f3d3b62a96a'>
<a href='#58c9dc20a35c3f3d3b62a96a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1489624096000' class='quanto-date posted-at response-posted-at' href='#58c9dc20a35c3f3d3b62a96a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Below is the code I sorted out, in response to my question immediately above (based on Dan Whitnable&#39;s code above):</p>

<pre><code>    actual_weight = pd.Series(index=context.stocks)  
    for security, position in context.portfolio.positions.items():  
        if context.portfolio.portfolio_value != 0:  
            actual_weight.set_value(security, position.amount * position.last_sale_price / context.portfolio.portfolio_value)  
        else:  
            actual_weight.set_value(security, 0)

    adj_weight = opt.calculate_optimal_portfolio(  
        objective=objective,  
        constraints=[  
            constrain_gross_leverage,  
            constrain_pos_size,  
            market_neutral,  
            sector_neutral  
        ],  
        current_portfolio=actual_weight  
    )  
    denom = np.sum(np.absolute(adj_weight.values))  
    if denom &gt; 0:  
        adj_weight = adj_weight/np.sum(np.absolute(adj_weight.values))  
    for stock in context.portfolio.positions.keys():  
        if stock not in context.stocks:  
            if data.can_trade(stock):  
                order_target_percent(stock,0)  
    for stock in context.stocks:  
            if data.can_trade(stock):  
                order_target_percent(stock, adj_weight[stock])  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58cbef4eaae9b74932a84db7' id='58cbef4eaae9b74932a84db7'>
<a href='#58cbef4eaae9b74932a84db7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/527612eb2de84d52740000d5'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/873c5860f8b916285b474f56cbd6f135?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/527612eb2de84d52740000d5'>Deleted User</a>
</div>
<a UTCms='1489760078000' class='quanto-date posted-at response-posted-at' href='#58cbef4eaae9b74932a84db7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Q,</p>

<p>Can someone help me answer these questions please. It is quite urgent for me.</p>

<ol>
<li><p>Is it possible to provide a quadratic function to the objective?</p></li>
<li><p>Can I create my own constraints?</p></li>
</ol>

<p>Many thanks<br>
Pravin  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58cc14f7cf2ebe035cdf86a6' id='58cc14f7cf2ebe035cdf86a6'>
<a href='#58cc14f7cf2ebe035cdf86a6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1489769719000' class='quanto-date posted-at response-posted-at' href='#58cc14f7cf2ebe035cdf86a6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi All,</p>

<p>Sorry for the radio silence on this thread.  I&#39;ve been pretty head down working on internal infrastructure projects recently.  A few quick replies to some of the recent questions:</p>

<blockquote>
<p>I&#39;d like to be able to call the optimization API and get the target weights out without automatically placing orders. Is this feasible? </p>
</blockquote>

<p>Agreed that this would be useful.  One catch is that, as of a recent update, the optimize API is accounting for unfilled open market orders when it calculates new targets.  This has been a longstanding feature request for the <code>order_target_*</code> family of order methods, but it&#39;s hard to change those without breaking backwards compatibility.  What this means is that if a hypothetical <code>calculate_optimal_portfolio</code> function simply returned the new targets, you&#39;d have to re-apply the same adjustment for open orders that <code>order_optimal_portfolio</code> is currently doing.  I&#39;m not sure off the top of my head how to solve that issue elegantly, but the challenge here is primarily one of design, not of implementation.  </p>

<blockquote>
<p>Is it possible to provide a quadratic function to the objective?<br>
Can I create my own constraints?</p>
</blockquote>

<p>We don&#39;t currently have support for custom objectives or constraints.  There&#39;s still a lot of churn happening in the implementation, and I don&#39;t want to commit to exposing implementation details (which would be necessary to allow these kinds of customizations) until there&#39;s some degree of confidence that those details are stable.  If you have suggestions for particular new objectives and constraints that can&#39;t currently be expressed with the built-ins (the most obvious omission right now is a volatility-minimizing objective), I&#39;d be curious to hear about them.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='58cc5d5077e4ca178c2954a9' id='58cc5d5077e4ca178c2954a9'>
<a href='#58cc5d5077e4ca178c2954a9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1489788240000' class='quanto-date posted-at response-posted-at' href='#58cc5d5077e4ca178c2954a9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Scott -</p>

<p>I think 
<code>calculate_optimal_portfolio</code> does the trick, giving the new optimal weights.  Presumably, it ignores any open orders.</p>

<p>At present, in my fumbling around, I&#39;m only placing, at most, one set of orders per day.  Since all open orders are cancelled at the end of the day, no  problemo.</p>

<p>The general use case here is to be able to smooth over either an expanding trailing window, or to store the weights in <code>context</code> and then smooth.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58cd17e277e4ca05b2295783' id='58cd17e277e4ca05b2295783'>
<a href='#58cd17e277e4ca05b2295783'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/527612eb2de84d52740000d5'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/873c5860f8b916285b474f56cbd6f135?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/527612eb2de84d52740000d5'>Deleted User</a>
</div>
<a UTCms='1489836002000' class='quanto-date posted-at response-posted-at' href='#58cd17e277e4ca05b2295783'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>We don&#39;t currently have support for custom objectives or constraints.</p>
</blockquote>

<p>As I understand, Quantopian will use optimize API for all their fund algorithms and internally to route orders to their trading desk. This practically eliminates all algorithms that do not &quot;fit&quot; into optimize API paradigm.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58cd1d8877e4ca05b22957cd' id='58cd1d8877e4ca05b22957cd'>
<a href='#58cd1d8877e4ca05b22957cd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1489837448000' class='quanto-date posted-at response-posted-at' href='#58cd1d8877e4ca05b22957cd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m not sure how to express it, but from a design standpoint, if the optimize API could be sort of an add-on/extension/cross-compatible software thingy with CVXPY, it would be nice.  As I understand, CVXPY is the underlying engine of the optimize API, so if one could mix-and-match the optimize API with CVXPY, it would be nice.  I guess that the optimize API will eventually be in github/zipline, and then folks could &quot;roll their own&quot; but maybe something could be done at the outset.  For example, custom objectives and constraints could be expressed in a CVXPY-like way (and then perhaps put through an interpreter thingy that would integrate them into the optimize API).  Sorry, I&#39;m not a software engineer; hopefully my point is coming across.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58ce862e9ab96d000ae8a617' id='58ce862e9ab96d000ae8a617'>
<a href='#58ce862e9ab96d000ae8a617'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1489929774000' class='quanto-date posted-at response-posted-at' href='#58ce862e9ab96d000ae8a617'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott -</p>

<p>Note that I&#39;m still seeing the crash if a turnover constraint is added, so a try-except must be used (see code I just posted on <a href="https://www.quantopian.com/posts/long-short-market-neutral-mean-reversion">https://www.quantopian.com/posts/long-short-market-neutral-mean-reversion</a> ).</p>

<p>Also, it would be nice to be able to include a hedging instrument (or basket of hedging instruments) in the optimization (e.g. SPY), as a means to keep beta close to zero.</p>

<p>[EDIT: Sorry for repeating myself--I see above that I&#39;d already mentioned including hedging instruments.  There was no response, so I&#39;m still wondering if it might be a useful addition.]</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58d10891db6b17000a37f184' id='58d10891db6b17000a37f184'>
<a href='#58d10891db6b17000a37f184'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/527612eb2de84d52740000d5'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/873c5860f8b916285b474f56cbd6f135?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/527612eb2de84d52740000d5'>Deleted User</a>
</div>
<a UTCms='1490094225000' class='quanto-date posted-at response-posted-at' href='#58d10891db6b17000a37f184'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott,</p>

<p>Here a few things I had like to see in Optimize API:</p>

<ol>
<li>Ability to minimize covariance of a portfolio.<br></li>
<li>Ability to neutralize (set = 0) systematic factors that I calculate (Instead of simply dollar neutral; I want to make portfolio beta neutral for some betas).</li>
</ol>

<p>Best regards,<br>
Pravin  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58d2347721bee12f7dc0c96c' id='58d2347721bee12f7dc0c96c'>
<a href='#58d2347721bee12f7dc0c96c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1490170999000' class='quanto-date posted-at response-posted-at' href='#58d2347721bee12f7dc0c96c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott -</p>

<p>I&#39;m still &quot;tire-kicking&quot; this API, and noticed the log output:</p>

<p><em>2005-01-12 09:45 WARN optimizer.py:204: InaccurateOptimization: Optimization completed with status OPTIMAL_INACCURATE.<br>
This usually means that the target for TargetPortfolioWeights is far away from satisfying all constraints.</em></p>

<p>Here&#39;s the block of code I&#39;m using:</p>

<pre><code>    try:  
        adj_weight = opt.calculate_optimal_portfolio(  
        objective=objective,  
        constraints=[  
            constrain_gross_leverage,  
            constrain_pos_size,  
            constrain_turnover,  
            market_neutral,  
            sector_neutral  
        ],  
        current_portfolio=actual_weight  
        )  
    except:  
        adj_weight = actual_weight  
</code></pre>

<p>It seems that there needs to be some way to get out a success/status flag from the optimizer (e.g. see <a href="https://docs.scipy.org/doc/scipy-0.18.1/reference/generated/scipy.optimize.OptimizeResult.html#scipy.optimize.OptimizeResult">https://docs.scipy.org/doc/scipy-0.18.1/reference/generated/scipy.optimize.OptimizeResult.html#scipy.optimize.OptimizeResult</a>).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58d56ee0da8772000d873ff0' id='58d56ee0da8772000d873ff0'>
<a href='#58d56ee0da8772000d873ff0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1490382560000' class='quanto-date posted-at response-posted-at' href='#58d56ee0da8772000d873ff0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>A Markowitz scheme does not look possible here given that volatility is not listed amongst the &quot;constrains&quot;.  I suspect it might be a useful inclusion although the resources required for the relevant matrices might be too high? There is an adaptation of the Critical Line Algo on Q but I gave up trying to decode the code!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58d5734f807c2a000d863f40' id='58d5734f807c2a000d863f40'>
<a href='#58d5734f807c2a000d863f40'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1490383695000' class='quanto-date posted-at response-posted-at' href='#58d5734f807c2a000d863f40'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Anthony -</p>

<p>Note that CVXPY is now whitelisted on Q.  It should make stuff like <a href="https://blog.quantopian.com/markowitz-portfolio-optimization-2/">https://blog.quantopian.com/markowitz-portfolio-optimization-2/</a> easier.  I&#39;ve used it a bit, and it is fairly user-friendly and <a href="http://www.cvxpy.org/en/latest/">well-documented</a>.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58d5781e5554360a9e12907f' id='58d5781e5554360a9e12907f'>
<a href='#58d5781e5554360a9e12907f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/525bc0ee7ace0dc6db000113'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/73ff156e6f6dad3b1b0e34c03bcf473a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/525bc0ee7ace0dc6db000113'>Anthony FJ Garner</a>
</div>
<a UTCms='1490384926000' class='quanto-date posted-at response-posted-at' href='#58d5781e5554360a9e12907f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ah  brilliant thanks. I must say leaving aside my bigoted distrust of all backtesting, I do admire the job these people have done.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58d6b65ada87721565874d37' id='58d6b65ada87721565874d37'>
<a href='#58d6b65ada87721565874d37'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/527612eb2de84d52740000d5'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/873c5860f8b916285b474f56cbd6f135?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/527612eb2de84d52740000d5'>Deleted User</a>
</div>
<a UTCms='1490466394000' class='quanto-date posted-at response-posted-at' href='#58d6b65ada87721565874d37'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The problem is that if you algorithm gets selected into the fund, you are supposed to use only optimize API and cannot use CVXOPT or CVXPY. This is very limiting in my opinion. I have all sorts of complex optimization routines that do not fit into the optimize API paradigm.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58d6ba6d7863d6653e245fd4' id='58d6ba6d7863d6653e245fd4'>
<a href='#58d6ba6d7863d6653e245fd4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1490467437000' class='quanto-date posted-at response-posted-at' href='#58d6ba6d7863d6653e245fd4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I think it is a matter of scope and use cases for Quantopian--how much engineering effort do they want to put into it, and to what end?  Once the code is released to github (presumably the path here), home-grown approaches that build off of it should be easier.</p>

<p>As far as it being a requirement for fund algos to use the optimize API, it would behoove Quantopian to clarify this point in a style guide or something.  It is implied, though, that they&#39;d like to see something like it for risk management at the algo level.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58e8cb74d2733547ce328d63' id='58e8cb74d2733547ce328d63'>
<a href='#58e8cb74d2733547ce328d63'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55e602a002dd2432b00001d2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/706508819421d25d2dfb273421dc6887?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55e602a002dd2432b00001d2'>Burrito Dan</a>
</div>
<a UTCms='1491651444000' class='quanto-date posted-at response-posted-at' href='#58e8cb74d2733547ce328d63'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Scott, I&#39;m just implementing my algo via the Optimizer. I&#39;m telling it what weights to use, via 
<code>opt.TargetPortfolioWeights(weights)</code>, as per Jeremy&#39;s post <a href="https://www.quantopian.com/posts/quantpedia-trading-strategy-series-reversals-during-earnings-announcements">here</a>. I infer from his code, and your &quot;tricky&quot; post above, you have to be careful when exiting positions. They must be in the <code>universe</code> and the <code>weights</code> passed to the optimizer, with a weight of zero. I assume if they are not, the call to <code>order_optimal_portfolio</code> just skips over anything it&#39;s not told about, and doesn&#39;t exit any positions. This is a bit of a faff. I wonder if better to make the default behaviour exit all positions not included in the optimized universe.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58e8ef702600fc5eab0beb37' id='58e8ef702600fc5eab0beb37'>
<a href='#58e8ef702600fc5eab0beb37'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1491660656000' class='quanto-date posted-at response-posted-at' href='#58e8ef702600fc5eab0beb37'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Burrito Dan -</p>

<p>Here&#39;s an example I cooked up.  I use:</p>

<pre><code>adj_weight = opt.calculate_optimal_portfolio(  
        objective=objective,  
        constraints=[  
            constrain_gross_leverage,  
            constrain_pos_size,  
            market_neutral,  
            sector_neutral  
        ],  
        current_portfolio=actual_weight  
    )  
</code></pre>

<p>You have to give it <code>current_portfolio</code> and then it runs the optimization, and returns the weights.  Then, when ordering, you simply exit any positions that are no longer in your current universe.</p>

<p>Personally, I think <code>order_optimal_portfolio</code> tries to do too much, since it does not report out the weights, and the ordering is all under the hood.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58f62233e7df5f001041c4aa' id='58f62233e7df5f001041c4aa'>
<a href='#58f62233e7df5f001041c4aa'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1492525619000' class='quanto-date posted-at response-posted-at' href='#58f62233e7df5f001041c4aa'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Dan any positions in your current universe are implicitly unioned into your current universe and given targets (or alpha values in the case of <code>MaximizeAlpha</code>) of 0.0.  If you call <code>order_optimal_portfolio</code> with a sequence of calls like:</p>

<pre><code>TargetPortfolioWeights({AAPL: 0.5, MSFT: 0.5})  
TargetPortfolioWeights({AAPL: 0.5, TSLA: 0.5})  
</code></pre>

<p>then on the first call you&#39;ll see buys for 50% of AAPL and 50% of MSFT, and on the second call you&#39;ll see a buy for 50% of TSLA and a sell of the MSFT position.</p>

<p>I&#39;ve attached a short backtest that demonstrates this behavior.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='58f6245495ce40000d00676a' id='58f6245495ce40000d00676a'>
<a href='#58f6245495ce40000d00676a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1492526164000' class='quanto-date posted-at response-posted-at' href='#58f6245495ce40000d00676a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Over time I&#39;ve become less convinced of the usefulness of the <code>universe</code> parameter to <code>order_optimal_portfolio</code>.  My initial reasoning for including it was that I wasn&#39;t sure we could always determine a correct optimization universe automatically, and <a href="https://www.python.org/dev/peps/pep-0020/#id3">in the face of ambiguity, refuse the temptation to guess</a>.</p>

<p>Having worked with the Optimize API a fair amount now, I&#39;m inclined to think that the &quot;correct&quot; universe is almost always given by:</p>

<pre><code>set(current_nonempty_positions).union(assets_referenced_by_objective)  
</code></pre>

<p>In light of that fact, my current thinking is that <code>universe</code> should either be optional or we should allow passing a special sentinel value (e.g. <code>quantopian.experimental.optimize.INFER_UNIVERSE</code>), which would produce the behavior noted above.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='58f6273d687a281643d09270' id='58f6273d687a281643d09270'>
<a href='#58f6273d687a281643d09270'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1492526909000' class='quanto-date posted-at response-posted-at' href='#58f6273d687a281643d09270'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Pravin</p>

<blockquote>
<p>Here a few things I had like to see in Optimize API:<br>
Ability to minimize covariance of a portfolio.</p>
</blockquote>

<p>Yup.  This is in the roadmap.  One interesting question is whether <code>MinimizeVariance</code> should be its own objective, or whether it makes more sense to incorporate a variance penalty into <code>MaximizeAlpha</code> (that starts to get challenging because you have to figure out how to make the units comparable between your measure of alpha and your measure of volatility).</p>

<blockquote>
<p>Ability to neutralize (set = 0) systematic factors that I calculate (Instead of simply dollar neutral; I want to make portfolio beta neutral for some betas).</p>
</blockquote>

<p>You can actually do this already using the <code>opt.WeightedExposure</code> constraint, which takes a DataFrame of risk factor weights (one column per factor, one row per asset) and Series&#39; of min/max net exposures to each factor.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='58f62fd582d6834db7075189' id='58f62fd582d6834db7075189'>
<a href='#58f62fd582d6834db7075189'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/527612eb2de84d52740000d5'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/873c5860f8b916285b474f56cbd6f135?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/527612eb2de84d52740000d5'>Deleted User</a>
</div>
<a UTCms='1492529109000' class='quanto-date posted-at response-posted-at' href='#58f62fd582d6834db7075189'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Scott,</p>

<p>Thanks for the feedback. I have another issue. My algorithm runs an optimization routine per sector and then trades each sector separately. How can I combine this in one optimization routine? Basically I want the maximizeAlpha to work independently per sector. That is, if it is trading 4 sectors and capital is 1 million, it will allocate 250K to each sector and maximizeAlpha per sector.</p>

<p>Best regards,<br>
Pravin  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58f6441dc5e85d001074a495' id='58f6441dc5e85d001074a495'>
<a href='#58f6441dc5e85d001074a495'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/514a23ed46a2329dd8000027'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f292ab7887c2e8698d013b40e1718e8b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/514a23ed46a2329dd8000027'>Suminda Dharmasena</a>
</div>
<a UTCms='1492534301000' class='quanto-date posted-at response-posted-at' href='#58f6441dc5e85d001074a495'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Is it possible to give an example how <code>opt.WeightedExposure</code> works?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58f657ec988b1c0010be6c67' id='58f657ec988b1c0010be6c67'>
<a href='#58f657ec988b1c0010be6c67'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1492539372000' class='quanto-date posted-at response-posted-at' href='#58f657ec988b1c0010be6c67'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Pravin</p>

<p>When you say you want to allocate 250K to each sector, is that gross or net exposure?  If it&#39;s net (which would presumably mean your optimization is long-only or short-only within each sector?), you could use the existing <code>NetPartitionExposure</code> constraint to constrain your exposure to individual sectors.  Assuming each asset only appears in a single sector once, maximizing alpha globally with a sector exposure constraint should be equivalent to maximizing alpha locally within each sector and then merging the results.  (This isn&#39;t necessarily true if you have other constraints in play, but in that case you actually probably want the global maximum.)</p>

<p>I don&#39;t think we have a good way to constrain gross exposure on a per-sector basis right now.  That&#39;s probably another good constraint to add.  Note that due to convexity considerations, we&#39;d probably only be able to support an upper bound on per-sector gross exposure (this is the same as the behavior of <code>MaxGrossLeverage</code> currently).  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='58f729b78697745240269563' id='58f729b78697745240269563'>
<a href='#58f729b78697745240269563'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1492593079000' class='quanto-date posted-at response-posted-at' href='#58f729b78697745240269563'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott -</p>

<p>A couple questions:</p>

<ol>
<li>What&#39;s the story behind 
<code>import quantopian.algorithm as algo</code>?  Is there any documentation you could point us to, describing what it is and how to use it?<br></li>
<li>Could you elaborate on how this optimization API effort fits with the Q fund?  Is the idea that you&#39;d encourage/require the use of <code>order_optimal_portfolio</code> with certain constraints?  Also, it seems that folks trading their own money may not want to use <code>order_optimal_portfolio</code> since there is no control over the ordering (e.g. presumably, you are submitting market orders, correct?).  Are you wanting <code>order_optimal_portfolio</code> to be universal, or more focused on the Q fund?<br></li>
</ol>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58fa025d00bfa300105b5be8' id='58fa025d00bfa300105b5be8'>
<a href='#58fa025d00bfa300105b5be8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1492779613000' class='quanto-date posted-at response-posted-at' href='#58fa025d00bfa300105b5be8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott -</p>

<p>Just following up--when you get the chance, I think it would help to layout the various use cases you are addressing here.  For example, if the intent is for 
<code>order_optimal_portfolio</code> to cover all use cases (e.g. backtesting, Q paper trading, IB, Robinhood, Q fund, etc.) then we need to discuss how users will configure the order type(s), manage orders, etc.  Are you planning to provide user &quot;hooks&quot; into the ordering functionality within <code>order_optimal_portfolio</code>?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58fbfab1cc2a510010435451' id='58fbfab1cc2a510010435451'>
<a href='#58fbfab1cc2a510010435451'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57bfb9d82094f9ee0d0000ff'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/aca70f32a4db6bd0c637623def0c8787?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57bfb9d82094f9ee0d0000ff'>JEF</a>
</div>
<a UTCms='1492908721000' class='quanto-date posted-at response-posted-at' href='#58fbfab1cc2a510010435451'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Could constraints be used to limit the number of securities traded? Factors tend to lose their predictive power when moving towards the center of the universe. What type of constraint could be used to limit to 100 positions long and 100 positions short in a universe of 600?  An example would be greatly appreciated.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='590647a81cb0bb000dedd5a1' id='590647a81cb0bb000dedd5a1'>
<a href='#590647a81cb0bb000dedd5a1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55e602a002dd2432b00001d2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/706508819421d25d2dfb273421dc6887?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55e602a002dd2432b00001d2'>Burrito Dan</a>
</div>
<a UTCms='1493583784000' class='quanto-date posted-at response-posted-at' href='#590647a81cb0bb000dedd5a1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Scott, I missed the MaxTurnover part of the Notebook for ages. Please can you add it to the quantopian.com/help  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59064efc51e425000d435ecd' id='59064efc51e425000d435ecd'>
<a href='#59064efc51e425000d435ecd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55e602a002dd2432b00001d2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/706508819421d25d2dfb273421dc6887?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55e602a002dd2432b00001d2'>Burrito Dan</a>
</div>
<a UTCms='1493585660000' class='quanto-date posted-at response-posted-at' href='#59064efc51e425000d435ecd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>One &quot;gotcha&quot; is that your existing positions are brought into the optimizer, and will use the default parameters for position concentration. </p>

<p>This applies the same default to new and existing positions:</p>

<pre><code>PositionConcentration.with_equal_bounds(min, max)  
</code></pre>

<p>This will apply <code>min/max_weights</code> if the existing position is listed, otherwise <code>default_min/max_weight</code> will be used.</p>

<pre><code>PositionConcentration(min_weights, max_weights, default_min_weight=0.0, default_max_weight=0.0)

</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='594443070589c10010f95d4f' id='594443070589c10010f95d4f'>
<a href='#594443070589c10010f95d4f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5929c5f4a76c22000d329d92'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5ec18483d35ccb497ca800f820998851?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5929c5f4a76c22000d329d92'>Leo M</a>
<span class='badge medal'></span>
</div>
<a UTCms='1497645831000' class='quanto-date posted-at response-posted-at' href='#594443070589c10010f95d4f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Can I set constraints at individual stock level. </p>

<p>If I want to set boundaries of stock position (not sector) to a range like [-0.1%,0.1%]  but  customized per stock that was ranked and passed to the optimizer, is there a way to use constraints to achieve that in some way while still doing all the other things that order_optimal_portfolio does?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5970c1ba8294334b653063c2' id='5970c1ba8294334b653063c2'>
<a href='#5970c1ba8294334b653063c2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/596a021a3cc3aa0242e8e9b8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/bd5786403fdd75f7bde4891585800475?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/596a021a3cc3aa0242e8e9b8'>Mark Taylor</a>
</div>
<a UTCms='1500561850000' class='quanto-date posted-at response-posted-at' href='#5970c1ba8294334b653063c2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>HI All, I am having a play with this algo at the moment and would like to implement a filter on the universe based on get_fundementals() which I have put in before_trading_start()  .. I am very new to this and I am not sure this has any effect .. anyone got any pointers / examples ?<br>
i.e.<br>
            fundamentals.asset_classification.growth_grade,<br>
            fundamentals.asset_classification.profitability_grade</p>

<p>Many thanks in advance  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59790ad65d38b20010c74beb' id='59790ad65d38b20010c74beb'>
<a href='#59790ad65d38b20010c74beb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57255c0c05b249ff21000333'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9c1c60cf23753eece072d3a903ecf7b7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57255c0c05b249ff21000333'>Honver Lam</a>
</div>
<a UTCms='1501104854000' class='quanto-date posted-at response-posted-at' href='#59790ad65d38b20010c74beb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m getting this error when using the optimize API with stop loss orders:</p>

<p>CannotOptimizeWithOpenNonMarketOrders: Can&#39;t run portfolio optimization while any non-market orders are open.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='597c57f4fdb49f000fb135df' id='597c57f4fdb49f000fb135df'>
<a href='#597c57f4fdb49f000fb135df'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971f08ba58ff600106c655a'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ad3d6cebaab04bb2ea0e042f83772945?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971f08ba58ff600106c655a'>Peter Marks</a>
</div>
<a UTCms='1501321204000' class='quanto-date posted-at response-posted-at' href='#597c57f4fdb49f000fb135df'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Scott, the notebook you shared is great and it is something I was looking for in this community. Keep up the good work!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5b9d6999b653e70047a09521' id='5b9d6999b653e70047a09521'>
<a href='#5b9d6999b653e70047a09521'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54a22490762c2f4bf400010e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9e6f8ec63e5a4160568962de291ab566?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54a22490762c2f4bf400010e'>Tom Yuz</a>
</div>
<a UTCms='1537042841000' class='quanto-date posted-at response-posted-at' href='#5b9d6999b653e70047a09521'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Is there a way to only rebalance shorts or only rebalance longs with order optimal portfolio?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c2fa02f7d6ed823ad490f9a' id='5c2fa02f7d6ed823ad490f9a'>
<a href='#5c2fa02f7d6ed823ad490f9a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb1b1e84ae2c1004a062d8e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3a64ba081bd92f018f87d0aa32cd448f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb1b1e84ae2c1004a062d8e'>Cc Mm</a>
</div>
<a UTCms='1546625071000' class='quanto-date posted-at response-posted-at' href='#5c2fa02f7d6ed823ad490f9a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>we can set max/min position size. Is there a way to set the maximum number of stocks in the optimizer?</p>

<p>example: maximum 600 stocks for long and short. position size varies up to 1%  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c2fa7f27d6ed872e9490ed5' id='5c2fa7f27d6ed872e9490ed5'>
<a href='#5c2fa7f27d6ed872e9490ed5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/571d1bab2616ef09ce0002b6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a69e9457dd2832a76875bcae334d5baf?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/571d1bab2616ef09ce0002b6'>Dan Whitnable</a>
</div>
<a UTCms='1546627058000' class='quanto-date posted-at response-posted-at' href='#5c2fa7f27d6ed872e9490ed5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Yes, the maximum number of securities can be set. It&#39;s not a constraint but rather simply the quantity of securities passed in the objective. Take the following example</p>

<pre><code>my_security_list = symbols([&#39;TRU&#39;, &#39;GKOS&#39;, &#39;ALRM&#39;, &#39;BLD&#39;,  &#39;CC&#39;, &#39;ENR&#39;, &#39;TDOC&#39;,])  
my_weights = [.1, .1, .2, .1, .1, .1, .1]  
my_securities_df = pd.DataFrame(index=my_security_list, data=my_weights, columns=[&#39;weight&#39;])  
algo.order_optimal_portfolio(objective=opt.TargetWeights(my_securities_df.weight), constraints=[])

</code></pre>

<p>The optimizer will only consider/order those seven securities passed in the &#39;TargetWeight&#39; objective. The same is also true when using the &#39;MaximizeAlpha&#39; objective. So, the maximum number of securities &#39;in the optimizer&#39; is simply the number of securities passed in the objective method. If one wants to limit the optimizer to a particular 600 securities, then generally, one would use the output of a pipeline to generate/select those 600 securities. Then simply pass that series, with associated weights or alphas, to the TargetWeight or MaximizeAlpha objective respectively.</p>

<p>In general any securities already held, but not included in the series, will be closed. There are ways around this behavior by using the <code>Frozen</code> or other constraints but the maximum securities is typically the size of the &#39;universe&#39; passed to the objective.</p>

<p>Hope that makes sense?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c303cdf6eeca300484150fb' id='5c303cdf6eeca300484150fb'>
<a href='#5c303cdf6eeca300484150fb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb1b1e84ae2c1004a062d8e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3a64ba081bd92f018f87d0aa32cd448f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb1b1e84ae2c1004a062d8e'>Cc Mm</a>
</div>
<a UTCms='1546665183000' class='quanto-date posted-at response-posted-at' href='#5c303cdf6eeca300484150fb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Dan, makes sense. </p>

<p>I found out that if I use TargetWeight and set turnover, it could not work. There are about 600 securities in TargetWeight but when I set turnover = 15% as one of the constraint, the holdings are about 2400 which I think is the QTradableStocksUS  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c304c5cebd6bd176e2029ee' id='5c304c5cebd6bd176e2029ee'>
<a href='#5c304c5cebd6bd176e2029ee'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ed38379b1e7efbfb0006f8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fe429093818ef2b5c8f29dc274a188b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ed38379b1e7efbfb0006f8'>Karl Mun</a>
</div>
<a UTCms='1546669148000' class='quanto-date posted-at response-posted-at' href='#5c304c5cebd6bd176e2029ee'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Perhaps try, CcMm this:</p>

<p>Before 
<code>
def initialize()  
</code>:</p>

<pre><code># Say maximum position is 600, each at maximum 2% weight:  
MaxStocks, MaxLS = 600, 0.02  
</code></pre>

<p>Inside <code>
def rebalance()  
</code> using Optimize API:</p>

<pre><code># Say your alpha is from your pipeline_data:  
my_alpha = pipeline_data.alphas.dropna()

# Say your objective is to let Optimize API determine the weights by your alpha signals:  
my_objective = opt.MaximizeAlpha(my_alpha)

# If so you may define a constraint to limit your positioning:  
MaxLongPositionSize = MaxShortPositionSize = min(MaxLS, 1.0 / len(my_alpha))

# Firstly initialise constraint as:  
my_constraint = []

# Now you may append the position constraint to my_constraint:  
my_constraint.append(  
    opt.PositionConcentration.with_equal_bounds(  
        min = -MaxShortPositionSize,  
        max = MaxLongPositionSize  
    ))

# Finally you may implement your objective and constraints by:  
order_optimal_portfolio(objective = my_objective, constraints = my_constraint)


</code></pre>

<p>You may find that if your <code>
len(my_alpha)  
</code> is less than 600, the position concentration may vary on or above the <code>
1.0 / len(my_alpha)  
</code> limit.</p>

<p>Hope this helps.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e9a4ffbdf6f0404dd1aa226' id='5e9a4ffbdf6f0404dd1aa226'>
<a href='#5e9a4ffbdf6f0404dd1aa226'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e977d2917b03726e9782a67'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7a40632c59a524ebfbc462ce4cc7cabf?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e977d2917b03726e9782a67'>Austin Spencer</a>
</div>
<a UTCms='1587171323000' class='quanto-date posted-at response-posted-at' href='#5e9a4ffbdf6f0404dd1aa226'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello, I am trying to run the API Optimization and am running into some troubles. It was working fine and backtesting fine just yesterday, however, today it keeps giving this error in the logs. 2011-01-10 07:40 WARN Empty universe in order_optimal_portfolio. No orders will be placed. Any reason this error would randomly show up? Any help is appreciated! Thanks!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e9b3b8bd42f020049c34fcf' id='5e9b3b8bd42f020049c34fcf'>
<a href='#5e9b3b8bd42f020049c34fcf'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1587231627000' class='quanto-date posted-at response-posted-at' href='#5e9b3b8bd42f020049c34fcf'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi, Q has turned off the optimization again for long time.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e9b41d1d42f023f1ec34924' id='5e9b41d1d42f023f1ec34924'>
<a href='#5e9b41d1d42f023f1ec34924'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb4fc8571ef9572db85c0af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a8d078cb83e513809bab0e31eabfa4fc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb4fc8571ef9572db85c0af'>Dan Whitnable</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1587233233000' class='quanto-date posted-at response-posted-at' href='#5e9b41d1d42f023f1ec34924'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The warning <code>Empty universe in order_optimal_portfolio</code> is simply stating the series passed to the objective for the <code>order_optimal_portfolio</code> method doesn&#39;t contain any values. Whether one uses the <code>TargetWeights</code> or <code>MaximizeAlpha</code> objective, it&#39;s implying the associated series has a length of zero tradable stocks. This isn&#39;t an error. The optimizer hasn&#39;t been &#39;turned off&#39;. Quantopian supports and has continued to support the optimizer package since it was introduced. This is just an informational message.</p>

<p>If one feels this isn&#39;t expected, the best way is to verify what&#39;s happening by using the debugger. Set a breakpoint at the line of code with the <code>order_optimal_portfolio</code> method.  Inspect the series which is being passed to the objective. If it doesn&#39;t look as expected, work upstream to find out what&#39;s causing the issue.</p>

<p>Perhaps attach a backtest of your algo if you would like help debugging. Again, this isn&#39;t an error just an informational message.  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5e9d356ef4da6b7b2feec537' id='5e9d356ef4da6b7b2feec537'>
<a href='#5e9d356ef4da6b7b2feec537'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1587361134000' class='quanto-date posted-at response-posted-at' href='#5e9d356ef4da6b7b2feec537'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Sorry I made a mistake. The backtesting optimization is turned off, right?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5e9da5a925ca03004d2fc166' id='5e9da5a925ca03004d2fc166'>
<a href='#5e9da5a925ca03004d2fc166'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb4fc8571ef9572db85c0af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a8d078cb83e513809bab0e31eabfa4fc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb4fc8571ef9572db85c0af'>Dan Whitnable</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1587389865000' class='quanto-date posted-at response-posted-at' href='#5e9da5a925ca03004d2fc166'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Thomas Chang All the <code>optimize</code> methods, objectives, and constraints are available to use in both notebooks and algorithms. It is <em>not</em> &#39;turned off&#39;. The documentation can be found here (<a href="https://www.quantopian.com/docs/api-reference/optimize-api-reference">https://www.quantopian.com/docs/api-reference/optimize-api-reference</a>). Is there some specific behavior you are experiencing which makes you feel this is &#39;turned off&#39;?  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5e9fd3c6fb8bc93d90b6c602' id='5e9fd3c6fb8bc93d90b6c602'>
<a href='#5e9fd3c6fb8bc93d90b6c602'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1587532742000' class='quanto-date posted-at response-posted-at' href='#5e9fd3c6fb8bc93d90b6c602'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Dan,</p>

<p>Please read this post:<br>
<a href="https://www.quantopian.com/posts/zipline-dot-tradingalgorithm-removed-from-research-and-backtesting" rel="nofollow">https://www.quantopian.com/posts/zipline-dot-tradingalgorithm-removed-from-research-and-backtesting</a></p>

<p>After the TradingAlgorithm is moved, one cannot do the optimazation by backtesting. Or is there other alternative?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ea04081bf3de3003e94c115' id='5ea04081bf3de3003e94c115'>
<a href='#5ea04081bf3de3003e94c115'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb4fc8571ef9572db85c0af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a8d078cb83e513809bab0e31eabfa4fc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb4fc8571ef9572db85c0af'>Dan Whitnable</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1587560577000' class='quanto-date posted-at response-posted-at' href='#5ea04081bf3de3003e94c115'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Thomas Chang</p>

<p>The post alluded to in the above reply announces that Zipline backtests are no longer supported in Research (ie Notebooks). However, backtests are, and always have been, supported in the IDE environment. To run a backtest simply develop and run your algo in the <a href="https://www.quantopian.com/algorithms">IDE</a> . </p>

<p>All the <code>optimize</code> features can be used in either the Notebook or IDE environments with the single exception of <code>order_optimal_portfolio</code> (which places orders and therefore is only applicable in the IDE). </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5ea05cc3876b3d0043df2394' id='5ea05cc3876b3d0043df2394'>
<a href='#5ea05cc3876b3d0043df2394'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1587567811000' class='quanto-date posted-at response-posted-at' href='#5ea05cc3876b3d0043df2394'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Sorry Dan,</p>

<p>Maybe I made confuse here. What I mean should be the &quot;automated backtesting&quot; where the Iteration is used as described here :(<a href="https://www.quantopian.com/posts/automated-backtests" rel="nofollow">https://www.quantopian.com/posts/automated-backtests</a>), not the &quot;backtest optimazation&quot;. <a href="https://www.quantopian.com/posts/automated-backtests" rel="nofollow">https://www.quantopian.com/posts/automated-backtests</a>.</p>

<p>Can one use the IDE to do the automated backtesting? Any example?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ea093665fec850044a37f00' id='5ea093665fec850044a37f00'>
<a href='#5ea093665fec850044a37f00'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb4fc8571ef9572db85c0af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a8d078cb83e513809bab0e31eabfa4fc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb4fc8571ef9572db85c0af'>Dan Whitnable</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1587581798000' class='quanto-date posted-at response-posted-at' href='#5ea093665fec850044a37f00'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>There currently isn&#39;t a way to automate the creation of backtests. Quantopian is working on an API to setup and run backtest from an external app, However, it&#39;s not finalized yet. </p>

<p>That is completely separate from the <code>optimize</code> tools being discussed in this post.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5ea111365fec850044a39b58' id='5ea111365fec850044a39b58'>
<a href='#5ea111365fec850044a39b58'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56406b03491ea6ba6400026e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/feb4cbf34749af2eb518ca1110c1a4e3?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56406b03491ea6ba6400026e'>Thomas Chang</a>
</div>
<a UTCms='1587614006000' class='quanto-date posted-at response-posted-at' href='#5ea111365fec850044a39b58'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks for the reply. I am waiting for the final of your API. :-)  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/optimize-api-now-available-in-algorithms'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/optimize-api-now-available-in-algorithms'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#3c5a5959585e5d5f577c4d495d5248534c555d52125f5351">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

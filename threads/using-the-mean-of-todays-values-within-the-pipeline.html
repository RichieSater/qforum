<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
Using the Mean of Todays Values within the Pipeline
</title>
<meta content='Hello everybody, I am calculating the number of bear and bull data. Within the pipeline, those values are calculated per Stock. However, I want that value for the overall universe of stocks - the mean() of them. But I can&#39;t find any way to compute that number to use it WITHIN the pipeline for further calculations. What I&#39;m searching for is more or less something like:  bear_mean = num_bear_now.groupby(timestamp).mean() Appreciating any help!!! Really hope, someone can help me' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="S7TXRheisqoxh8sb/lCkGeFTysP/IKCHQDSlXWQpcb430qELtVRgSYiakiqxvwxt2d3pqoXstZzCO343zmwTBQ==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=true;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/using-the-mean-of-todays-values-within-the-pipeline' property='og:url'>
<meta content='Using the Mean of Todays Values within the Pipeline' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/using-the-mean-of-todays-values-within-the-pipeline' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='Using the Mean of Todays Values within the Pipeline' property='og:title'>
<meta content='Hello everybody, I am calculating the number of bear and bull data. Within the pipeline, those values are calculated per Stock. However, I want that value for the overall universe of stocks - the mean() of them. But I can&#39;t find any way to compute that number to use it WITHIN the pipeline for further calculations. What I&#39;m searching for is more or less something like:  bear_mean = num_bear_now.groupby(timestamp).mean() Appreciating any help!!! Really hope, someone can help me' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/using-the-mean-of-todays-values-within-the-pipeline">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='5e83adf2cdfa4c0041898bdd'>
<div class='post-container' data-post-id='5e83adf2cdfa4c0041898bdd' id='5e83adf2cdfa4c0041898bdd'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>Using the Mean of Todays Values within the Pipeline</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e72a8bff23876004a908220'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2ecce932c9e1c7a86e18433eb71832ac?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e72a8bff23876004a908220'>Niklas Happerschoss</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1585688050000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=Using the Mean of Todays Values within the Pipeline&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fusing-the-mean-of-todays-values-within-the-pipeline%3Futm_source%3Dwebsite_share%26utm_campaign%3Dusing-the-mean-of-todays-values-within-the-pipeline%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fusing-the-mean-of-todays-values-within-the-pipeline%3Futm_source%3Dwebsite_share%26utm_campaign%3Dusing-the-mean-of-todays-values-within-the-pipeline%26utm_medium%3Dlinkedin&amp;title=Using+the+Mean+of+Todays+Values+within+the+Pipeline+%28Niklas+Happerschoss%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class='tags tag-row'>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Seeking Help' data-tag-id='55c50e7d8d4710ec6e000003' href='/posts/tag/Seeking-Help/newest'>Seeking Help</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Getting Started' data-tag-id='55c50e7d8d4710ec6e000004' href='/posts/tag/Getting-Started/newest'>Getting Started</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Tools and Tips' data-tag-id='55c50e7d8d4710ec6e000011' href='/posts/tag/Tools-and-Tips/newest'>Tools and Tips</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Research' data-tag-id='55c50e7d8d4710ec6e000018' href='/posts/tag/Research/newest'>Research</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Pipeline' data-tag-id='561525bcf252a59171000001' href='/posts/tag/Pipeline/newest'>Pipeline</a>
</div>
<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/using-the-mean-of-todays-values-within-the-pipeline?utm_source=website_share&amp;utm_campaign=using-the-mean-of-todays-values-within-the-pipeline&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Niklas Happerschoss" />
<div class='body-text'>
<div class='body-text-container post-body'><p>Hello everybody,</p>

<p>I am calculating the number of bear and bull data. Within the pipeline, those values are calculated per Stock. However, I want that value for the overall universe of stocks - the mean() of them. But I can&#39;t find any way to compute that number to use it WITHIN the pipeline for further calculations.</p>

<p>What I&#39;m searching for is more or less something like:  bear_mean = num_bear_now.groupby(timestamp).mean()</p>

<p>Appreciating any help!!! Really hope, someone can help me  </p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>22 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='5e84d1d96938e85cd219a25a' id='5e84d1d96938e85cd219a25a'>
<a href='#5e84d1d96938e85cd219a25a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb4fc8571ef9572db85c0af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a8d078cb83e513809bab0e31eabfa4fc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb4fc8571ef9572db85c0af'>Dan Whitnable</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1585762777000' class='quanto-date posted-at response-posted-at' href='#5e84d1d96938e85cd219a25a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>There are a couple of ways to get the average, or mean, value of a factor within pipeline. The straightforward approach is to write a small custom factor. Something like this</p>

<pre><code>#Custom factor for calculating mean of a factor  
class Factor_Mean(CustomFactor):  
    # Default inputs  
    window_length = 1

    def compute(self, today, assets, out, factor_data):  
        out[:] = np.nanmean(factor_data)

    bull_mean = Factor_Mean(inputs=[bull_scores_average], mask=universe &amp; bull_scores_average.isfinite())  
</code></pre>

<p>That will broadcast the mean value of the factor to all assets. Make certain to include a mask to limit which assets to include in the average. If the window length is set to something other than 1 then all the factor values will be &#39;flattened&#39; and the result will be the mean of all values over all the days in the window.</p>

<p>A second approach, sort of a hack, is to use the <code>demean</code> method. </p>

<blockquote>
<p>Demeaning data means subtracting the sample mean from each observation<br>
X[demeaned] = X - X[mean]  </p>

<p>Therefore, if one subtracts the demeaned value from each observation one is left with the mean<br>
X - X[demeaned] = X - (X - X[mean]) = X[mean]</p>
</blockquote>

<p>So, the following will do the same as our custom factor.</p>

<pre><code>    bull_mean = bull_scores_average - bull_scores_average.demean(mask=universe &amp; bull_scores_average.isfinite()) 

</code></pre>

<p>Both methods will broadcast the same value to all assets. One advantage of the <code>demean</code> method is the <code>groupby</code> parameter can be used to get the mean value for each group. This can also be done of course with a custom factor but requires a little bit of coding. Finally, it&#39;s generally not appropriate to average a number of averages. However, it may be appropriate here?</p>

<p>Attached is a notebook with the code.  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5e86426c9840e65eadc25b60' id='5e86426c9840e65eadc25b60'>
<a href='#5e86426c9840e65eadc25b60'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5e72a8bff23876004a908220'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2ecce932c9e1c7a86e18433eb71832ac?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5e72a8bff23876004a908220'>Niklas Happerschoss</a>
</div>
<a UTCms='1585857132000' class='quanto-date posted-at response-posted-at' href='#5e86426c9840e65eadc25b60'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thank you so much Dan!! you are a lifesaver. That was exactly what I needed.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5edb83459bb3750dc60773c6' id='5edb83459bb3750dc60773c6'>
<a href='#5edb83459bb3750dc60773c6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb5b36750a6132299e9c544'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f747e2e9e662b2b6e5affdb2da57b7ca?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb5b36750a6132299e9c544'>Ben</a>
</div>
<a UTCms='1591444293000' class='quanto-date posted-at response-posted-at' href='#5edb83459bb3750dc60773c6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Dan Whitnable</p>

<p>I&#39;ve been trying to use your solution to Niklas&#39;s problem, to find  the number of signals  each day, and ultimately  to use that value in some logic within pipeline.</p>

<p>Please see attached notebook, where I have stripped down the factor to the basics.</p>

<p>I have commented out rows  45 and 58, which when  left in cause the following error message:</p>

<pre><code>NonPipelineInputs: Unexpected input types in str. Inputs to Pipeline expressions must be Filters, Factors, Classifiers, or BoundColumns.  
Got the following type(s) instead: [&lt;class &#39;numpy.ndarray&#39;&gt;]  
</code></pre>

<p>Any advice, pointers appreciated.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5edb9f8413b26a0041e6cdfb' id='5edb9f8413b26a0041e6cdfb'>
<a href='#5edb9f8413b26a0041e6cdfb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb4fc8571ef9572db85c0af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a8d078cb83e513809bab0e31eabfa4fc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb4fc8571ef9572db85c0af'>Dan Whitnable</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1591451524000' class='quanto-date posted-at response-posted-at' href='#5edb9f8413b26a0041e6cdfb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>See attached notebook. Made a few changes. Also, there is now a built in method to sum factors <code>.sum()</code> so no need for the custom factor anymore. See the docs for a complete list of summary methods which can be used for factors (<a href="https://www.quantopian.com/docs/api-reference/pipeline-api-reference#methods-that-create-summary-statistics">https://www.quantopian.com/docs/api-reference/pipeline-api-reference#methods-that-create-summary-statistics</a>). You may find some of these methods helpful.</p>

<p>Best of luck.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5edba3289bb37516420773fe' id='5edba3289bb37516420773fe'>
<a href='#5edba3289bb37516420773fe'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb5b36750a6132299e9c544'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f747e2e9e662b2b6e5affdb2da57b7ca?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb5b36750a6132299e9c544'>Ben</a>
</div>
<a UTCms='1591452456000' class='quanto-date posted-at response-posted-at' href='#5edba3289bb37516420773fe'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Dan :-)</p>

<p>I mistyped and actually meant to &quot;count&quot; the signals, rather &quot;sum&quot; them. So I followed your  advice and looked at the list of methods (your link below) and replaced &quot;.sum&quot; with &quot;.notnull_count&quot;.</p>

<p><a href="https://www.quantopian.com/docs/api-reference/pipeline-api-reference#methods-that-create-summary-statistics" rel="nofollow">https://www.quantopian.com/docs/api-reference/pipeline-api-reference#methods-that-create-summary-statistics</a></p>

<p>Thanks again.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5edcd128d0039f004700aa6c' id='5edcd128d0039f004700aa6c'>
<a href='#5edcd128d0039f004700aa6c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb5b36750a6132299e9c544'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f747e2e9e662b2b6e5affdb2da57b7ca?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb5b36750a6132299e9c544'>Ben</a>
</div>
<a UTCms='1591529768000' class='quanto-date posted-at response-posted-at' href='#5edcd128d0039f004700aa6c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi @Dan Whitnable</p>

<p>Can I ask a folllow up queston pls?</p>

<p>In the custom factor I&#39;m trying to add some logic into the compute section. My intent is to filter the output of the custom factor using the count of the signals coming from the custom factor.</p>

<p>The custom factor produces buy and sell signals. I want to be able to choke the custom factor in certain instances - say when there are just buys and no sells.</p>

<p>I have tried this by developing two tests (one for buy signals and one for sell signals) within the compute section of the custom factor.</p>

<p>I then wanted to use the np.where statement to modify the output of the custom factor based on some logic.</p>

<p>However when I do this, i get an error message saying this:</p>

<p><strong>could not broadcast input array from shape (34,8464) into shape (8464)</strong></p>

<p>The new code I have added to the compute section of the custom factor in the above notebook is:</p>

<pre><code>        b1 = (low - lb) &lt; 0  
        b2 = (close - lb) &gt; 0  
        buy_signal = b1 &amp; b2

        s1 = (high - ub) &gt; 0  
        s2 = (close - ub) &lt; 0  
        sell_signal = s1 &amp; s2  
        frac_fac = (close[-1]-lb)/(ub-lb) 

        out.lb[:] = np.where( buy_signal, frac_fac, na)  
        out.ub[:] = np.where( sell_signal, frac_fac, na)  
        out.frac_fac[:] = frac_fac  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5edcdb5510f96c00406c1840' id='5edcdb5510f96c00406c1840'>
<a href='#5edcdb5510f96c00406c1840'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb5b36750a6132299e9c544'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f747e2e9e662b2b6e5affdb2da57b7ca?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb5b36750a6132299e9c544'>Ben</a>
</div>
<a UTCms='1591532373000' class='quanto-date posted-at response-posted-at' href='#5edcdb5510f96c00406c1840'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Tinkering some more, this does not throw an error:  </p>

<pre><code>        out.lb[:] = np.where(buy_signal[-1],frac_fac,None)  
        out.ub[:] = np.where(sell_signal[-1],frac_fac,None)  
        out.frac_fac[:] = frac_fac

</code></pre>

<p>I also need to rename the outputs as are no longer upper and lower &quot;bands&quot;, but now buy &amp; sell signals  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5edd377710f96c003f6c1c48' id='5edd377710f96c003f6c1c48'>
<a href='#5edd377710f96c003f6c1c48'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1591555959000' class='quanto-date posted-at response-posted-at' href='#5edd377710f96c003f6c1c48'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Ben, </p>

<p>I wonder why you use highest &#39;high&#39; in<a href="https://www.quantopian.com/posts/using-the-mean-of-todays-values-within-the-pipeline#5edb83459bb3750dc60773c6" rel="nofollow"> frac_fac (CustomFactor)</a> to calculate lb and lowest &#39;low&#39; to calculate ub?</p>

<pre><code>            lb = np.nanmax(high[:self.window_length], axis=0)  
            ub = np.nanmin(low[:self.window_length], axis=0)  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5edd39e8fde4393cc8855a04' id='5edd39e8fde4393cc8855a04'>
<a href='#5edd39e8fde4393cc8855a04'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb5b36750a6132299e9c544'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f747e2e9e662b2b6e5affdb2da57b7ca?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb5b36750a6132299e9c544'>Ben</a>
</div>
<a UTCms='1591556584000' class='quanto-date posted-at response-posted-at' href='#5edd39e8fde4393cc8855a04'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Vladimir</p>

<p>The lb and ub bands in this notebook are just placeholders for my  actual indicators. The output looks really similar to Bollinger Bands, and I use them n a similar way.</p>

<p>I&#39;m a noob to Python, and have returned to Quantopian after a false start 2 years ago - determined this time to get a working version of my algo/indicator - really appreciate all the support from the quantopian forums and only hope I can return the favour at some  point.</p>

<p>While I have you! I&#39;m just trying to undestand when to use &quot;close[-1]&quot; versus just &quot;close&quot;. Iunderstand &quot;close[-1]&quot; returns the most recent value in the boundcolumn. I&#39;m just wondering if in the following code:</p>

<pre><code>frac_fac = (close[-1]-lb)/(ub-lb)  
</code></pre>

<p>I should perhaps also be referring to lb as &quot;lb[-1]&quot; etc...?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5edd4286d0039f004600af1d' id='5edd4286d0039f004600af1d'>
<a href='#5edd4286d0039f004600af1d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1591558790000' class='quanto-date posted-at response-posted-at' href='#5edd4286d0039f004600af1d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Ben, </p>

<p>Your frac_fac(CustomFactor) very similar to %K(FastK Stochastic Oscillator) but with opposite lb and ub definition.</p>

<p>FYI<br>
Stochastic Oscillator was developed by George C. Lane in the late 1950s</p>

<p><em>%K = (Current Close - Lowest Low)/(Highest High - Lowest Low) * 100</em></p>

<p>Lowest Low = lowest low for the look-back period.<br>
Highest High = highest high for the look-back period.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5edd451cfde4393cc8855a63' id='5edd451cfde4393cc8855a63'>
<a href='#5edd451cfde4393cc8855a63'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb5b36750a6132299e9c544'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f747e2e9e662b2b6e5affdb2da57b7ca?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb5b36750a6132299e9c544'>Ben</a>
</div>
<a UTCms='1591559452000' class='quanto-date posted-at response-posted-at' href='#5edd451cfde4393cc8855a63'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Tks Vladimir - i will have a look at those, appreciate the info.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee4c4d81f9428004266177b' id='5ee4c4d81f9428004266177b'>
<a href='#5ee4c4d81f9428004266177b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb5b36750a6132299e9c544'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f747e2e9e662b2b6e5affdb2da57b7ca?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb5b36750a6132299e9c544'>Ben</a>
</div>
<a UTCms='1592050904000' class='quanto-date posted-at response-posted-at' href='#5ee4c4d81f9428004266177b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Dan Whitnable</p>

<p>Made some progress on this. My goal is to get the count of signals produced each day from a custom factor and then use that in some logic to decide whether or not to use the signals that day.</p>

<p>Please see below a version in which I have replaced my custom factor with a simple dummy custom factor.</p>

<p>The problem I am trying to understand this w/e is why the count of signals is always higher than my universe of stocks?</p>

<p>Is it possible that the code is not in fact counting the daily signals as I intend?</p>

<p>Any advice, insights greatly appreciated.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee52ac1a84f1147f6daecb5' id='5ee52ac1a84f1147f6daecb5'>
<a href='#5ee52ac1a84f1147f6daecb5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb4fc8571ef9572db85c0af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a8d078cb83e513809bab0e31eabfa4fc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb4fc8571ef9572db85c0af'>Dan Whitnable</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1592076993000' class='quanto-date posted-at response-posted-at' href='#5ee52ac1a84f1147f6daecb5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Your code is indeed correctly counting the number of signals each day. The buy and sell signals are being generated by the custom factor <code>frac_fac</code>. However, there isn&#39;t any mask value set so it will calculate signals for all assets in the Quantopian universe (~9000). It seems you want to just calculate signals for the universe you specified to be Q500US. If that&#39;s the case, then set a mask when creating the <code>frac_fac</code> factor. Like this</p>

<pre><code>    # Instantiate our frac_frac factor  
    indicators = frac_fac(window_length=w_length+s_step, mask=universe)

</code></pre>

<p>The results will now probably be more in line with what you expected.</p>

<p>Good luck.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5ee52f18bf88df6509c8a7f8' id='5ee52f18bf88df6509c8a7f8'>
<a href='#5ee52f18bf88df6509c8a7f8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb5b36750a6132299e9c544'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f747e2e9e662b2b6e5affdb2da57b7ca?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb5b36750a6132299e9c544'>Ben</a>
</div>
<a UTCms='1592078104000' class='quanto-date posted-at response-posted-at' href='#5ee52f18bf88df6509c8a7f8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Dan!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee607fa2609060043110033' id='5ee607fa2609060043110033'>
<a href='#5ee607fa2609060043110033'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb5b36750a6132299e9c544'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f747e2e9e662b2b6e5affdb2da57b7ca?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb5b36750a6132299e9c544'>Ben</a>
</div>
<a UTCms='1592133626000' class='quanto-date posted-at response-posted-at' href='#5ee607fa2609060043110033'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Dan Whitnable</p>

<p>Hi Dan -  I&#39;m now getting totals for signals each day thanks to your advice on addition of the mask.</p>

<p>One thing I don&#39;t fully understand is when it is necessary to use &quot;[-1]&quot; with a variable  (to signify referring to most recent value in the array).</p>

<p>In the following code snippet from the previously attached notebook, in some of the logic I do not use &quot;[-1]&quot; but in the logic immediately after it I do use &quot;[-1]&quot;. I do not understand why.</p>

<pre><code># @Dan - why do the following 6 lines of code not require &quot;[-1]&quot; after each term on the right hand side of each assignment statement?  
        b1 = (low &lt; lb)  
        b2 = (close &gt; lb)  
        buy_signal = b1 &amp; b2 

        s1 = (high &gt; ub)  
        s2 = (close &lt; ub)  
        sell_signal = s1 &amp; s2  


# @Dan - And if I do not include the &quot;[-1]&quot; with each of the terms on #the RHS of the following assignment statement, I get a run time error  
#   &quot;could not broadcast input array from shape (20,500) into shape (500)&quot;.  
# I understand that 500 is the unmasked universe of stocks, but what does &quot;20&quot; refer to?

        frac_fac = (close[-1]-lb[-1])/(ub[-1]-lb[-1])  
</code></pre>

<p>Thanks for all support.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee7e55431bfc805533e4adb' id='5ee7e55431bfc805533e4adb'>
<a href='#5ee7e55431bfc805533e4adb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb5b36750a6132299e9c544'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f747e2e9e662b2b6e5affdb2da57b7ca?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb5b36750a6132299e9c544'>Ben</a>
</div>
<a UTCms='1592255828000' class='quanto-date posted-at response-posted-at' href='#5ee7e55431bfc805533e4adb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@dan Whitnable</p>

<p>I&#39;ve been stuck on this for a week - thought I was closing in on it, but is slipping from my grasp - please can you give me a pointer Dan?</p>

<p>In line 26 of the run_pipeline cell of the attached notebook I have the line:</p>

<pre><code>    sigs_today = min([sells_count,buys_count])

</code></pre>

<p>The problem is it does not behave as intended. It just returns the &quot;buys_count&quot; figure. (it returns the last term in the list, rather  than the min).</p>

<p>Is it perhaps treating it as a string and sorting them alphabetically? If so - how can I avoid that, and get it return the element with the minimum value?</p>

<p>Thanks as always.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee92ca5a6c9270042800f18' id='5ee92ca5a6c9270042800f18'>
<a href='#5ee92ca5a6c9270042800f18'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb5b36750a6132299e9c544'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f747e2e9e662b2b6e5affdb2da57b7ca?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb5b36750a6132299e9c544'>Ben</a>
</div>
<a UTCms='1592339621000' class='quanto-date posted-at response-posted-at' href='#5ee92ca5a6c9270042800f18'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@dan whitnable</p>

<p>Hi Dan - Regarding the question above, would be good to know if it is in fact possible to achieve what I&#39;m trying to do? That is, to count the number of buy sigs and then count the number of sell sigs from a particular factor, and then determine the minimum value (either buy r sells) and use that as a pipeline output to make sure an equal number of buys and sells are generated each (and for days when that does not occur, to set all signals to null). </p>

<p>Tks in advance.</p>

<p>Ben  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ee9384da6c927003f800f6d' id='5ee9384da6c927003f800f6d'>
<a href='#5ee9384da6c927003f800f6d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb4fc8571ef9572db85c0af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a8d078cb83e513809bab0e31eabfa4fc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb4fc8571ef9572db85c0af'>Dan Whitnable</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1592342605000' class='quanto-date posted-at response-posted-at' href='#5ee9384da6c927003f800f6d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The thing to remember when defining a pipeline is one is working with factors and not the actual data. It&#39;s easy to forget because one can casually code <code>factor_sum = factor_1 + factor_2</code> and it works as expected. However, that is only because factors have code in their base class to &#39;understand&#39; addition (and a few other operators). The ONLY operators and functions which work with factors are the ones <a href="https://www.quantopian.com/docs/api-reference/pipeline-api-reference#factor-methods">explicitly defined</a>. Moreover, and this is unfortunate, if an operator or function is used which isn&#39;t defined for factors, an error is often not generated. Things just go on and provide results probably much different than intended. This is what&#39;s happening here.</p>

<p>The problem is indeed the following line. The <code>min</code> function is not defined for factors. </p>

<pre><code> sigs_today = min([sells_count, buys_count])

</code></pre>

<p>Up until recently, creating a factor which returned the min of two other factors, would have required a <code>CustomFactor</code>. Not hard but a little extra work. However, now there is a clever <code>if_else</code> method which can be used for this purpose. Check out the <a href="https://www.quantopian.com/docs/api-reference/pipeline-api-reference#zipline.pipeline.Filter.if_else">docs</a>. So, something like this will return a 1D factor which is the <code>min</code> of <code>sells_count</code> or <code>buys_count</code>.</p>

<pre><code>sells_less_than_buys = sells_count &lt; buys_count  
sigs_today = sells_less_than_buys.if_else(sells_count, buys_count)

</code></pre>

<p>How does this work? First, start with a filter. In this case <code>sells_less_than_buys</code>. Typically, filters have a value of either <code>True</code> or <code>False</code> for each asset. Some assets may be <code>True</code> while others <code>False</code>. In this case however, our filter is a 1D filter with the same value for every asset (either all <code>True</code> or all <code>False</code>). This is because the factors from which it is derived are 1D factors having the same value for each asset. The <code>if_else</code> method will return the first value (ie sells_count) when <code>sells_count &lt; buys_count</code> and will return <code>buys_count</code> when it&#39;s not. This effectively will return the minimum of the two counts.</p>

<p>Try that. It should work as intended.</p>

<p>Good luck.</p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5ee946653ae0550044cdd47c' id='5ee946653ae0550044cdd47c'>
<a href='#5ee946653ae0550044cdd47c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb5b36750a6132299e9c544'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f747e2e9e662b2b6e5affdb2da57b7ca?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb5b36750a6132299e9c544'>Ben</a>
</div>
<a UTCms='1592346213000' class='quanto-date posted-at response-posted-at' href='#5ee946653ae0550044cdd47c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Dan!  I think I get it, albeit tenuously! Tks again.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ef8799ed8d9b800149537da' id='5ef8799ed8d9b800149537da'>
<a href='#5ef8799ed8d9b800149537da'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb5b36750a6132299e9c544'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f747e2e9e662b2b6e5affdb2da57b7ca?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb5b36750a6132299e9c544'>Ben</a>
</div>
<a UTCms='1593342366000' class='quanto-date posted-at response-posted-at' href='#5ef8799ed8d9b800149537da'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi @Dan Whitnable</p>

<p>The method you described above is working great - thanks again.</p>

<p>This AM I&#39;ve been trying to modify it to see the effect of placing a floor higher than zero.</p>

<p>I&#39;ve tried adding the following after your code.</p>

<pre><code>    n=100 #the floor value  
    np.where(sigs_today&lt;n, 0 , sigs_today)

</code></pre>

<p>Although no error is thrown, the output does not change, making me think its exactly the same challenge as you described, and solved.</p>

<p>So I then attempted to use your technique  to achieve the desired effect, with the following:</p>

<pre><code>    n=100

    sigs_filter = sigs_today &lt; n  
    sigs_today = sigs_filter.if_else(0, sigs_filter)

</code></pre>

<p>This generates the following error message:</p>

<pre><code>TypeError: Filter.if_else() expected a value of type ComputableTerm for argument &#39;if_true&#39;, but got int instead.

</code></pre>

<p>Any advice appreciated!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5ef8b2c12f7ce20013d249c0' id='5ef8b2c12f7ce20013d249c0'>
<a href='#5ef8b2c12f7ce20013d249c0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb4fc8571ef9572db85c0af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a8d078cb83e513809bab0e31eabfa4fc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb4fc8571ef9572db85c0af'>Dan Whitnable</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1593356993000' class='quanto-date posted-at response-posted-at' href='#5ef8b2c12f7ce20013d249c0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Ben. The <code>if_else</code> method expects two factors as arguments. It doesn&#39;t expect an integer (in this case 0). That is what&#39;s causing the error <code>TypeError: Filter.if_else() expected a value of type ComputableTerm for argument &#39;if_true&#39;, but got int instead.</code>. The numpy <code>where</code> method you tried fails for the previous reason that factors are not actual data, or arrays, and therefore cannot be used as inputs to numpy functions.</p>

<p>One could use the <code>if_else</code> method again if the total stocks are less than a minimum number. A &#39;trick&#39; is that the <code>top</code> method will return zero assets if the N parameter is less than or equal to 0. Something like this</p>

<pre><code>    # get the minimum of either buys or sells  
    min_of_buys_sells_signals = (buys_count &lt; sells_count).if_else(buys_count, sells_count)

    # require a minimum number of buys and sells  
    # if our count is less than this minimum then set to a negative number  
    # setting to a negative number will return zero assets when using the `top` method  
    min_required_buys_and_sells = 60  
    negative_count = min_of_buys_sells_signals - min_required_buys_and_sells

    count_less_than_min_required = min_of_buys_sells_signals &lt; min_required_buys_and_sells  
    sigs_today = count_less_than_min_required.if_else(negative_count, min_of_buys_sells_signals)

    # will not return any assets if `sigs_today` is negative  
    buys = indicators.buy_sigs.top(sigs_today)  
    sells = indicators.sell_sigs.top(sigs_today)  
</code></pre>

<p>This should do what you want. A word of caution. Pipeline will cause an error in the notebook environment if no rows are returned for any dates. It&#39;s OK if it doesn&#39;t return anything for some dates, however nothing for all dates get&#39;s it confused. This can happen if the minimum value is set too high and there are never any buys or sells. (Setting the minimum value to 100 will cause this).</p>

<p>All that said, this could probably be done in a more clear fashion after the pipeline is run. One can then use standard python, numpy, and pandas. Pipeline is really limited to factor and filter methods, which as we are seeing, are a bit limited at times. In fact, I often use pipeline solely to fetch data with no logic. Completely separate getting the data from manipulating the data.  Then, once pipeline is run, the data can be manipulated, sliced, and diced as needed. The separation of data and code may be more intuitive to some. </p>

<p>There are really only two drawbacks to doing all the logic after pipeline is run. First, a pipeline definition can typically be copied and pasted from a notebook to an algo in the IDE and it will run the identically in both environments. However, because a pipeline returns a multi-indexed dataframe in a notebook and a single-indexed dataframe in an algo, the code for manipulating the datafames will be different. Having the same code for both makes for an efficient development workflow. Second, if the logic is encapsulated within a pipeline it can more easily be analyzed using Alphalens. Anyway, something to consider. It&#39;s personal preference.</p>

<p>Check out the attached notebook. It should be working as you expected and setting a &#39;floor&#39; for the number of buys and sells.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5ef8b5ccb3e4350011acb7c4' id='5ef8b5ccb3e4350011acb7c4'>
<a href='#5ef8b5ccb3e4350011acb7c4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb5b36750a6132299e9c544'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f747e2e9e662b2b6e5affdb2da57b7ca?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb5b36750a6132299e9c544'>Ben</a>
</div>
<a UTCms='1593357772000' class='quanto-date posted-at response-posted-at' href='#5ef8b5ccb3e4350011acb7c4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thank you!  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/using-the-mean-of-todays-values-within-the-pipeline'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/using-the-mean-of-todays-values-within-the-pipeline'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#f39596969791929098b38286929d879c839a929ddd909c9e">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
how to take trades according to the rolling zscore of a pairs trade?
</title>
<meta content='Hello, I am new around here and therefore decided to take a look at this lecture  https://www.quantopian.com/lectures/introduction-to-pairs-trading  more specifically the 30 day rolling zscore. However he never explains how to interpret the zscore in a trading manner, he says if the zscore is above the threshold(1) then you should short the spread, but what does that even mean in an actual shares trading context? Say you have the following spread between stock MRK.DE and AOX.DE, how would one...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="BxxCttfb8z7GKDCLXJ7tf1k8y4Sifzpep1eid4vSimt7ejT7dS0h3X81aboTcUULYbLo7dizL0UlWHkdIZfo0A==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/how-to-take-trades-according-to-the-rolling-zscore-of-a-pairs-trade' property='og:url'>
<meta content='how to take trades according to the rolling zscore of a pairs trade?' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/how-to-take-trades-according-to-the-rolling-zscore-of-a-pairs-trade' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='how to take trades according to the rolling zscore of a pairs trade?' property='og:title'>
<meta content='Hello, I am new around here and therefore decided to take a look at this lecture  https://www.quantopian.com/lectures/introduction-to-pairs-trading  more specifically the 30 day rolling zscore. However he never explains how to interpret the zscore in a trading manner, he says if the zscore is above the threshold(1) then you should short the spread, but what does that even mean in an actual shares trading context? Say you have the following spread between stock MRK.DE and AOX.DE, how would one...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/how-to-take-trades-according-to-the-rolling-zscore-of-a-pairs-trade">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='5f50af4cf8b31f000f859d1b'>
<div class='post-container' data-post-id='5f50af4cf8b31f000f859d1b' id='5f50af4cf8b31f000f859d1b'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>how to take trades according to the rolling zscore of a pairs trade?</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f4e64520a82d800104be9e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7090a0f636c82eb444c1cad97b5e71a4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f4e64520a82d800104be9e2'>Tomas Christensen</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1599123276000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=how to take trades according to the rolling zscore of a pairs trade?&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fhow-to-take-trades-according-to-the-rolling-zscore-of-a-pairs-trade%3Futm_source%3Dwebsite_share%26utm_campaign%3Dhow-to-take-trades-according-to-the-rolling-zscore-of-a-pairs-trade%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fhow-to-take-trades-according-to-the-rolling-zscore-of-a-pairs-trade%3Futm_source%3Dwebsite_share%26utm_campaign%3Dhow-to-take-trades-according-to-the-rolling-zscore-of-a-pairs-trade%26utm_medium%3Dlinkedin&amp;title=how+to+take+trades+according+to+the+rolling+zscore+of+a+pairs+trade%3F+%28Tomas+Christensen%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/how-to-take-trades-according-to-the-rolling-zscore-of-a-pairs-trade?utm_source=website_share&amp;utm_campaign=how-to-take-trades-according-to-the-rolling-zscore-of-a-pairs-trade&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Tomas Christensen" />
<div class='body-text'>
<div class='body-text-container post-body'><p>Hello,<br>
I am new around here and therefore decided to take a look at this lecture <a href="https://www.quantopian.com/lectures/introduction-to-pairs-trading" rel="nofollow">https://www.quantopian.com/lectures/introduction-to-pairs-trading</a> more specifically the 30 day rolling zscore. However he never explains how to interpret the zscore in a trading manner, he says if the zscore is above the threshold(1) then you should short the spread, but what does that even mean in an actual shares trading context?</p>

<p>Say you have the following spread between stock MRK.DE and AOX.DE, how would one actually trade it? Since we are below the threshold we should be long the spread however what does this entail? Long MRK, short AOX or long both or something completely different?<br>
Spread illustrated: <a href="https://ibb.co/djRWvHT" rel="nofollow">https://ibb.co/djRWvHT</a>  </p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>19 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='5f512cc2646fef00139eeba7' id='5f512cc2646fef00139eeba7'>
<a href='#5f512cc2646fef00139eeba7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb4fc8571ef9572db85c0af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a8d078cb83e513809bab0e31eabfa4fc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb4fc8571ef9572db85c0af'>Dan Whitnable</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1599155394000' class='quanto-date posted-at response-posted-at' href='#5f512cc2646fef00139eeba7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>There are two algorithms in <a href="https://www.quantopian.com/lectures/example-basic-pairs-trading-algorithm">Lecture 45</a> and <a href="https://www.quantopian.com/lectures/example-pairs-trading-algorithm">Lecture 46</a> which give examples of code to actually trade. </p>

<p>In pairs trading one always holds a long position in one stock and a short position in the other. One is trying to &#39;hedge&#39; the effects of the market&#39;s unavoidable ups and downs. So, if the market goes down, the assumption is both stocks would also go down. By holding both a long and a short position the net impact from this market change would hopefully be zero. </p>

<p>Which stock to long and which to short, at any given time, is determined by the sign of z-score of the current the spread. Assume there are two stocks X and Y. Also assume the spread is defined as the price of Y minus the price of X . If the z-score is positive, then it implies the spread is above the mean spread. This could be because the price of X is very low  or Y is very high (or maybe both). The assumption is the spread will revert to the mean so X should go up or Y should go down (or maybe both). So, with the above definition of the spread, if the z-score is positive, go long X and go short Y. If the z-score is negative, short X and long Y.</p>

<p>The z-score sign indicates the &#39;direction&#39; of each position, but how large a relative position of each to take? Should we take an equal position of each? We are expecting the market shorted stock to change an equal (and opposite) amount as the long stock. But, historically our two stocks X and Y may not change equally. If X goes up 1%, Y may only go up .5%. This expected price change, relative to X, is a stocks &#39;beta&#39; relative to X. A beta of 1 means it typically moves the same as X. Therefore, if we want to hedge a long and a short position, and expect them to equal out any price movements, the ratio of X to Y should be the beta of Y. Take a simple example. Assume Y has a beta of .5 relative to X. If X goes down 1% we would expect Y to go down .5 x 1% or .5%. If we were holding X long and Y short with equal positions, X would go down 1% and Y up .5% for a net loss of .5%. We want our net loss to be zero. Therefore, we need to have our position of X to be half the position of Y. The ratio of the position X/Y should the beta of Y relative to X (ie beta_Y times position_value_X = position_value_Y)</p>

<p>The calculation of beta, as well as the ratio of the positions and determining the direction based upon z-score, are coded in the two algos referenced above.</p>

<p>Hope that helps.</p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5f51382bd1c6cb000f904d17' id='5f51382bd1c6cb000f904d17'>
<a href='#5f51382bd1c6cb000f904d17'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f4e64520a82d800104be9e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7090a0f636c82eb444c1cad97b5e71a4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f4e64520a82d800104be9e2'>Tomas Christensen</a>
</div>
<a UTCms='1599158315000' class='quanto-date posted-at response-posted-at' href='#5f51382bd1c6cb000f904d17'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Dan Whitnable<br>
Take a look at this. At approximately 10:45 am (GMT+1, Copenhagen)  I calculated the Z-score for each of the below pairs:</p>

<p>Possible trade at MRK.DE AOX.DE. Stddev: 0.28. Current spread: [-2.21866881].<br>
Possible trade at NEM.DE SHA.DE. Stddev: 0.33. Current spread: [-2.23626499].<br>
Possible trade at HNR1.DE FPE.DE. Stddev: 0.38. Current spread: [2.27174249].<br>
Possible trade at MRK.DE NOEJ.DE. Stddev: 1.12. Current spread: [-1.98877657].<br>
Possible trade at MRK.DE AIR.DE. Stddev: 2.67. Current spread: [-2.14303357].<br>
Possible trade at SAP.DE KGX.DE. Stddev: 2.85. Current spread: [-2.49708246].</p>

<p>Now when I calculate the Z-score for the same stocks (Im using the moving average method described in the lecture) I get this at the end of the trading day today (note I have written the price change in % for from 10:45 am to market close next to each of the stocks in parentheses):</p>

<p>ATTENTION: Open trade at MRK.DE (-2,78%) AOX.DE (-1,77%). Stddev: 0.28. Current spread: [-1.25071216].<br>
ATTENTION: Open trade at NEM.DE (-2,3%) SHA.DE (0,63%). Stddev: 0.33. Current spread: [-1.41698111].<br>
ATTENTION: Open trade at HNR1.DE (-2,11%) FPE.DE (0,18%). Stddev: 0.38. Current spread: [2.08791043].<br>
ATTENTION: Open trade at MRK.DE (-2,78%) AIR.DE (-5,01%). Stddev: 2.65. Current spread: [-1.49187867].<br>
ATTENTION: Open trade at SAP.DE (-4,07%) KGX.DE (-4,03%). Stddev: 2.83. Current spread: [-1.62708333].</p>

<p>As you can see from the above now open trades at the end of the day and their respective price move from 10:45 am to 5:30 pm many of them move the same direction (negative) yet the score moves towards 0 on all of these trades (they are all lower than before). So my question stands, if my threshold is 1,96 and -1,96 for taking trades, which stock should I buy and which should I short, because looking at the above results its very unclear what makes the score move.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f524fe029adbe00150ee565' id='5f524fe029adbe00150ee565'>
<a href='#5f524fe029adbe00150ee565'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb4fc8571ef9572db85c0af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a8d078cb83e513809bab0e31eabfa4fc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb4fc8571ef9572db85c0af'>Dan Whitnable</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1599229920000' class='quanto-date posted-at response-posted-at' href='#5f524fe029adbe00150ee565'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The determination of which to long and which to short  is based upon the sign of the z-score and the definition one uses for the spread. I&#39;m not sure how you defined the spread but let&#39;s assume it is</p>

<blockquote>
<p>spread = Y - X<br>
If the z-score is positive, go long X and go short Y.<br>
If the z-score is negative, go long Y and go short X.</p>
</blockquote>

<p>So, using some real tickers from above</p>

<p>X = MRK.DE<br>
Y = AOX.DE<br>
spread = price of MRK.DE - price of AOX.DE = -2.21866881<br>
the current spread is negative so go long Y (AOX.DE) and go short X (MRK.DE)</p>

<p>This of course would be reversed if your definition of X and Y were reversed.</p>

<p>Let&#39;s look at what would have happened if you entered an equal position of long AOX.DE and short MRK.DE at 10:45:</p>

<blockquote>
<p>MRK.DE price down 2.78%, Since this is shorted it will be a gain of 2.78%<br>
AOX.DE price down 1.77%. Since this is long it will be a loss of 1.77%<br>
NET GAIN = 2.78 - 1.77 = 1.01%</p>
</blockquote>

<p>So yes, both lost but since one is holding both a long and short position the net is positive. Actually, the stats above demonstrate pairs trading surprisingly well. As stated, all the spreads move closer to zero. This is the fundamental hypothesis of pairs trading - that the spread reverts to the mean so therefore the z-scores moves closer to zero. In all five cases above, the spreads moved closer to zero by the end of the day. This of course doesn&#39;t always happen but interesting to see in this case. </p>

<p>Second, assume the spread definition is Y - X where X is the first stock of each pair and Y is the second in the list above.  If the spread is negative then short X and long Y (ie short MRK, NEM, HNR1, MRK, SAP  and long AOX, SHA, AIR, KGX). Looking at the price changes listed above from 10:45 to the end of day, and assuming an equal position size for each, one would have made money on all but one of those pairs trades (ie 2.78-1.77, 2.3+.63, 2.78-5.01, 4.07-4.03). Now consider the pair where the spread was positive (HNR1.DE FPE.DE). One would have gone long HNR1 and short FPE. Looking at the end of day gains (-2.11% and .18% respectively) the net loss would have been -2.11-.18. </p>

<p>Again, these long short positions would all be reversed if the spread calculation is reversed to be X - Y. I didn&#39;t know how it was actually calculated. Also, one would need to calculate the actual position sizes using the beta of Y relative to X which may change the net gain results. </p>

<p>Note that pairs trading isn&#39;t a crystal ball. It doesn&#39;t always result in winning trades (as seen above) but the premise is that, over the long term, the net results will be positive.</p>

<p>Hope this helps.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5f525de3682f3b00143e23b1' id='5f525de3682f3b00143e23b1'>
<a href='#5f525de3682f3b00143e23b1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f4e64520a82d800104be9e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7090a0f636c82eb444c1cad97b5e71a4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f4e64520a82d800104be9e2'>Tomas Christensen</a>
</div>
<a UTCms='1599233507000' class='quanto-date posted-at response-posted-at' href='#5f525de3682f3b00143e23b1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Dan, Im litterally copy pasting the spread calculation etc. from the lecture here: <a href="https://www.quantopian.com/lectures/introduction-to-pairs-trading" rel="nofollow">https://www.quantopian.com/lectures/introduction-to-pairs-trading</a></p>

<p>That means that the spread is calculated the following way:</p>

<pre><code>         Xl = np.array([StockAData, StockBData]).T

        lineStd = coint.fit_transform(Xl).std()  
        spread = coint.fit_transform(Xl)

        S1 = sm.add_constant(StockAData)  
        results = sm.OLS(StockBData, S1).fit()  
        S1 = S1[StockAApart]

        rolling_beta = ols.PandasRollingOLS(y=S1, x=StockBData, window=30)  
        spread = StockBData - rolling_beta.beta[&quot;feature1&quot;] * S1  
        spread.name = &#39;spread&#39;

            # Get the 1 day moving average of the price spread  
        spread_mavg1 = spread.rolling(1).mean()  
        spread_mavg1.name = &#39;spread sma(1) mavg&#39;

            # Get the 30 day moving average  
        spread_mavg30 = spread.rolling(30).mean()  
        spread_mavg30.name = &#39;spread sma(30) mavg&#39;

        std_30 = spread.rolling(30).std()  
        std_30.name = &#39;std 30&#39;

        series_spread = (spread_mavg1 - spread_mavg30)/std_30  
</code></pre>

<p>So I am again asking how to interpret the score regarding to what you should long or short, because if look at the the last spread (SAP and KGX) they both fell around the same but the zscore spread changed by 0,9!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f526b4b9cb4550018bd665e' id='5f526b4b9cb4550018bd665e'>
<a href='#5f526b4b9cb4550018bd665e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb4fc8571ef9572db85c0af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a8d078cb83e513809bab0e31eabfa4fc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb4fc8571ef9572db85c0af'>Dan Whitnable</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1599236939000' class='quanto-date posted-at response-posted-at' href='#5f526b4b9cb4550018bd665e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>It is a bit unfortunate that the code uses &#39;S1 and S2&#39; and &#39;A and B&#39; and then later in the algo &#39;X and Y&#39; to indicate which stock is which. However, they all refer to the &#39;first on and the second on&#39; so we just need to keep the order straight. I&#39;ll make the assumption that the order for SAP and KGX is this</p>

<pre><code>S1 = prices_df[&#39;SAP&#39;]  
S2 = prices_df[&#39;KGX&#39;]

</code></pre>

<p>I&#39;ll assume the calculations were done correctly so, since the z-score of the spread was negative, one should long KGX and short SAP. If one swapped the definitions of S1 and S2 then one would swap which to long and short (but presumably the sign of the of z-score spread would swap too so it would result in the same trades).</p>

<p>The reason why the spread decreased even though both prices dropped about the same is because of the definition of &#39;spread&#39; being used.</p>

<pre><code>spread = StockBData - rolling_beta.beta[&quot;feature1&quot;] * S1 

</code></pre>

<p>Notice that S1 is &#39;weighted&#39; by beta. If that beta is 1 then a similar price change in both S1 and S2 would result in no change to the spread. However, if beta is greater than 1 then the spread would <em>decrease</em> even though both prices fell by the same.</p>

<p>I left the hedge multiplier out of the spread examples above and assumed it to be 1 just for simplicity. But, more generally, it should be</p>

<pre><code>spread = Y - hedge * X  
# where hedge is the beta found by the ordinary least squares (OLS) relationship  
# Y = beta * X  + alpha

</code></pre>

<p>Including the hedge multiplier impacts how the spread changes relative to changes in X and Y.</p>

<p>Does that make sense?</p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5f526c3eac6b8e001082651e' id='5f526c3eac6b8e001082651e'>
<a href='#5f526c3eac6b8e001082651e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f4e64520a82d800104be9e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7090a0f636c82eb444c1cad97b5e71a4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f4e64520a82d800104be9e2'>Tomas Christensen</a>
</div>
<a UTCms='1599237182000' class='quanto-date posted-at response-posted-at' href='#5f526c3eac6b8e001082651e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I see, thanks for the clearification, I have but one question remaining now.</p>

<p>If the spread depends on the beta then how can it be considered a solid buy/sell signal? Yes the spread is meanreverting but even thought the selected stocks are cointegrated as a cointegration test shows, this doesn&#39;t equal that a meanreversion in the spread is equal to a profit in the long/short stocks of the spread. So would the &quot;correct&quot; way to calculate the spread be by setting the hedge (beta) to just 1 or keeping it as is?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f52793d682f3b00163e2440' id='5f52793d682f3b00163e2440'>
<a href='#5f52793d682f3b00163e2440'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5a55c90de7768c62ec102c8f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/444de7ebbbcd25c616085ac000902358?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5a55c90de7768c62ec102c8f'>BIBANI Iheb</a>
</div>
<a UTCms='1599240509000' class='quanto-date posted-at response-posted-at' href='#5f52793d682f3b00163e2440'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Toma Christensen , Actually , what you should understand is that &quot;beta&quot; is a coefficient that gives the relationship between the evolution of X and Y. It seems that you&#39;re always taking the case where &quot;beta = 1&quot; but It&#39;s not always the case.Actually , I would like to say rarely the case to not say never.This is the first thing. Second , We have no guarantee that &quot;beta&quot; will remains constant over time and I guess It has also effect in the cointegration of the pairs thus in the stationarity of the spread.This is why in the lecture , they said that it&#39;s not because the time series is stationary that it will remains stationary and they suggest us to make some tests of stationarity consistency....<br>
Anyway , &quot;beta&quot; is basically what rely X and Y and we use it as way to hedge our positions.This is why Pairs Trading is Market Neutral.</p>

<p>I&#39;m not sure that I have 100% answered to your question because It wasn&#39;t clear for me but I tried to answer what I&#39;ve understood  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f527b28682f3b00133e242f' id='5f527b28682f3b00133e242f'>
<a href='#5f527b28682f3b00133e242f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5a55c90de7768c62ec102c8f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/444de7ebbbcd25c616085ac000902358?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5a55c90de7768c62ec102c8f'>BIBANI Iheb</a>
</div>
<a UTCms='1599241000000' class='quanto-date posted-at response-posted-at' href='#5f527b28682f3b00133e242f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Actually , in the signal buy/sell there is no problem even if you have a problem with &quot;beta&quot;.</p>

<p>let&#39;s assume that :  <strong>spread = X - Y</strong></p>

<p>if spread positive : we short X and long Y<br>
if spread negative : we short Y and long X</p>

<p>Until here no problem with beta.</p>

<p>Now, I have 2 questions for you :</p>

<p>--&gt; Can X and Y evolving in the same direction ? OF COURSE , YES !!</p>

<p>--&gt;Does  X evolving with the same &quot;velocity&quot; as Y in the same direction ? OF COURSE , NOT !!</p>

<p>==&gt; The beta is a way to quantify the <strong><em>ratio of their velocities</em></strong> and this is very useful to hedge our position otherwise the <strong>Market Neutrality</strong> will not be guarantee !!</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f527d1107e61d001104adfa' id='5f527d1107e61d001104adfa'>
<a href='#5f527d1107e61d001104adfa'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f4e64520a82d800104be9e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7090a0f636c82eb444c1cad97b5e71a4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f4e64520a82d800104be9e2'>Tomas Christensen</a>
</div>
<a UTCms='1599241489000' class='quanto-date posted-at response-posted-at' href='#5f527d1107e61d001104adfa'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@BIBANI Iheb<br>
I guess what I am trying to get an answer on is 2 things:<br>
1. What should the formula for the spread be? Spread=X-Y or Spread=StockBData - rolling_beta.beta[&quot;feature1&quot;] * S1<br>
2. Depending on the spread what would be the &quot;correct&quot; way to trade it to achieve the desired market neutrality effect and hopefully some profit.</p>

<p>The reason for me making this entire post was just because of the confusion of how both assets can move in the same direction and the spread still moves towards 0, although this has now been answered it does leave a bit of a worry about wether or not the spread is actually tradeable (question 1).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f52808e07e61d001204adf6' id='5f52808e07e61d001204adf6'>
<a href='#5f52808e07e61d001204adf6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb4fc8571ef9572db85c0af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a8d078cb83e513809bab0e31eabfa4fc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb4fc8571ef9572db85c0af'>Dan Whitnable</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1599242382000' class='quanto-date posted-at response-posted-at' href='#5f52808e07e61d001204adf6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Beta (or something similar) needs to be accounted for somewhere. Somewhere in the calculations one needs to at least address the fact that stocks aren&#39;t priced similarly.  What if stock X is selling for $10 and stock Y $100? Assume they both go up and down identically perhaps 10% (to make the math easy). One should expect the spread to go up and down identically too. Let&#39;s see how that would work without beta</p>

<pre><code>spread_initial = 100 - 10 = 90  
spread_after_10_pct_gain = 110 - 11 = 99

</code></pre>

<p>Hmm. Not what we expected. If the stocks do go up and down identically then the beta of Y relative to X would be <code>Y = beta * X</code> which implies <code>beta = 10</code> (ie 100 = 10 * 10). Let&#39;s see what this added beta factor does. </p>

<pre><code>spread_initial = 100 - (beta * 10) = 100 - 100 = 0  
spread_after_10_pct_gain = 110 - (beta * 11) = 110 - 110 = 0

</code></pre>

<p>Ah, that&#39;s better. The spread now remains constant. One at least needs a factor to normalize the two prices so they can be compared. </p>

<p>Adding a beta additionally accounts for the reality that not all stocks move up and down with the market the same (their betas relative to the market are different). Remember we are trying to hedge against market swings. Let&#39;s take another example. This time the stocks X and Y are priced the same at $100. The difference is they do not move uniformly with the market. Stock X generally moves the same as the market. Its beta relative to the market is 1. However, stock Y is more volatile. It sees bigger swings and has a beta, relative to the market, of 1.1. Let&#39;s see what a 10% gain in the market does if we don&#39;t include beta in our spread calculation.</p>

<pre><code>spread_initial = 100 - 100 = 0  
spread_after_10_pct_mkt_gain = (100 *1.1*1.1)  - (100 * 1.1)  = 121 - 111 = 10

</code></pre>

<p>Again, that doesn&#39;t look right. Let&#39;s add our beta to the hedge calculation. Now assume the beta of Y relative to X is just our beta relative to the market or 1.1. Let&#39;s now see what our spread is.</p>

<pre><code>spread_initial = 100 - 100 = 0  
spread_after_10_pct_mkt_gain = (100 *1.1*1.1)  - (beta *(100 * 1.1) ) = 121 - (1.1 * 110) = 0

</code></pre>

<p>Much better. Including beta into our hedge calculation not only does the price &#39;scaling&#39; for us, but it also accounts for stocks which don&#39;t move equally with the market (ie their beta to the market values differ).</p>

<p>This was a long winded way of saying, yes one needs to include the beta of Y with respect to X in the hedge calculation. I should have really included that in my original example.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5f5281f2c875f90016c9df8a' id='5f5281f2c875f90016c9df8a'>
<a href='#5f5281f2c875f90016c9df8a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f4e64520a82d800104be9e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7090a0f636c82eb444c1cad97b5e71a4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f4e64520a82d800104be9e2'>Tomas Christensen</a>
</div>
<a UTCms='1599242738000' class='quanto-date posted-at response-posted-at' href='#5f5281f2c875f90016c9df8a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Dan I would say that even though that explanation was long it was well worth it! Thank you so much, this makes it far easier to understand. However you don&#39;t happen to remember a formula from the top of your head to calculate the optimal % allocation in stock a and stock b based on the beta? I don&#39;t want to be a nuisance but might aswell ask while I&#39;m at it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f5283e2682f3b000f3e2483' id='5f5283e2682f3b000f3e2483'>
<a href='#5f5283e2682f3b000f3e2483'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5a55c90de7768c62ec102c8f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/444de7ebbbcd25c616085ac000902358?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5a55c90de7768c62ec102c8f'>BIBANI Iheb</a>
</div>
<a UTCms='1599243234000' class='quanto-date posted-at response-posted-at' href='#5f5283e2682f3b000f3e2483'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Tomas </p>

<p>1- the correct way is this one : Spread=StockBData - rolling_beta.beta[&quot;feature1&quot;] * S1</p>

<p>2- what would be the &quot;correct&quot; way to trade ? Use OLS(Y,X).fit to find &quot;beta&quot;  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f52a749682f3b00103e2567' id='5f52a749682f3b00103e2567'>
<a href='#5f52a749682f3b00103e2567'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f4e64520a82d800104be9e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7090a0f636c82eb444c1cad97b5e71a4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f4e64520a82d800104be9e2'>Tomas Christensen</a>
</div>
<a UTCms='1599252297000' class='quanto-date posted-at response-posted-at' href='#5f52a749682f3b00103e2567'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Dan<br>
I&#39;ve now taken into account the hedge ratio, comparing yesterdays trades again it should now have looked like this instead:</p>

<p>ATTENTION: Open trade at MRK.DE AOX.DE. Stddev: 0.27. Current spread: [-2.46788803]. Sell 3.3x AOX.DE for every MRK.DE<br>
ATTENTION: Open trade at NEM.DE SHA.DE. Stddev: 0.32. Current spread: [-2.47328773]. Sell 2.96x SHA.DE for every NEM.DE<br>
ATTENTION: Open trade at HNR1.DE FPE.DE. Stddev: 0.39. Current spread: [2.41875875]. Buy 6.11x FPE.DE for every -HNR1.DE<br>
ATTENTION: Open trade at MRK.DE AIR.DE. Stddev: 2.61. Current spread: [-2.24220584]. Sell -0.41x AIR.DE for every MRK.DE<br>
ATTENTION: Open trade at SAP.DE KGX.DE. Stddev: 2.79. Current spread: [-2.58256542]. Sell -0.54x KGX.DE for every SAP.DE</p>

<p>Which when calculating the adjusted profits at the end of the day would result in:</p>

<p>Status                 MRK AOX NEM SHA HNR1 FPE    MRK AIR  SAP KGX<br>
Buy (% profit)  -2,78   -2,3          1,10                   -2,78         -4,07<br>
Sell (% profit) 5,84    -1,86         2,11                     2,05          2,18<br>
Total Profit            3,06    -4,16         3,21                    -0,73           -1,89</p>

<p>This does look a tad bit better than what would otherwise have occurred have one traded in fixed sizes. I&#39;d like to thank you for the clarification. Please do tell if this is incorrect though  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f52a83bdcad9400123062a5' id='5f52a83bdcad9400123062a5'>
<a href='#5f52a83bdcad9400123062a5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5a55c90de7768c62ec102c8f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/444de7ebbbcd25c616085ac000902358?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5a55c90de7768c62ec102c8f'>BIBANI Iheb</a>
</div>
<a UTCms='1599252539000' class='quanto-date posted-at response-posted-at' href='#5f52a83bdcad9400123062a5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello @Dan ,</p>

<p>Thanks for your explanation , it is more clear for me.</p>

<p>However , I don&#39;t understand here :</p>

<p><em>&quot;Beta (or something similar) needs to be accounted for somewhere. Somewhere in the calculations one needs to at least address the fact that stocks aren&#39;t priced similarly. What if stock X is selling for $10 and stock Y $100? Assume they both go up and down identically perhaps 10% (to make the math easy). One should expect the spread to go up and down identically too. Let&#39;s see how that would work without beta&quot;</em></p>

<p>what do you mean ? That stocks goes both up , then down and the overall percentage_change is 10% ? (I don&#39;t think ...because otherwise you&#39;ll say directly that the percentage_change evolved by +10% and in enough but you said both up , both down so there is a reason , can you explain me ?)</p>

<p>The other question we have two betas ?<br>
 - One to rely sensitivity between stocks and market<br>
 - Another one to rely stocks with the hedge ratio<br>
However , rolling beta is , I guess , a hedge ratio why in the lecture they didn&#39;t put it ? Or more interesting question , how to calculate it ..</p>

<p>Thanks  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f539044ac6b8e0019826c84' id='5f539044ac6b8e0019826c84'>
<a href='#5f539044ac6b8e0019826c84'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5cb4fc8571ef9572db85c0af'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/a8d078cb83e513809bab0e31eabfa4fc?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5cb4fc8571ef9572db85c0af'>Dan Whitnable</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1599311940000' class='quanto-date posted-at response-posted-at' href='#5f539044ac6b8e0019826c84'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@BIBANI Iheb is correct. I haven&#39;t explicitly stated how to find the beta of Y relative to X but use statsmodels <code>OLS</code> or some similar method. In calculating the z-scores one needs a series of past spreads to calculate the mean. The beta will vary with time, so one approach is to use a &#39;rolling&#39; calculation of beta to weight the X prices.</p>

<p>There was a question about how much to allocate to each stock X and Y?  One will find several approaches to this if doing an internet search. Often the approach is to have equal size positions so the strategy is &#39;market neutral&#39;. I don&#39;t exactly agree with that (for reasons demonstrated in the example below) but I do want to say there isn&#39;t a universal approach. That said, I would allocate with a ratio of -beta of Y relative to X. If one orders $1000 of Y then order -beta x $1000 of stock X. Of course one position will be long and the other short depending upon the sign of the spread. </p>

<p>An example of how this works. We are trying to protect from market movements so the size of the long and short positions should &#39;balance&#39; each other. Again assume we have stocks X and Y which are priced the same at $100. The difference is they do not move uniformly with the market. Assume stock X generally moves the same as the market. Its beta relative to the market is 1. However, stock Y is more volatile. It sees bigger swings and has a beta, relative to the market, of 1.1. Since X moves the same as the market, the beta of Y relative to X can be taken as the beta to the market. Let&#39;s see what happens to a portfolio with a 10% gain in the market. Assume X and Y just move with the market and there is no underlying price reversion.</p>

<pre><code># note we assume we are shorting X  
net_initial_position = pos_Y + pos_X  
net_initial_position = $1000 + (-beta * $1000) = $1000 + (-1.1 * $1000) = $1000 - $1100 = -$100

net_final_position_10_pct_mkt_gain = (pos_Y  * y_gain) + (pos_X * x_gain)  
net_final_position_10_pct_mkt_gain = ($1000 * (1+(.1*1.1))) + (-$1100 * (1+.1)  = $1110 - $1210 = -$100

</code></pre>

<p>Great. With a big market swing our market neutral strategy left our portfolio untouched with the same initial value of -$100. Now let&#39;s see what a 10% market loss does.</p>

<pre><code># again note we assume we are shorting X  
net_initial_position = pos_Y + pos_X  
net_initial_position = $1000 + (-beta * $1000) = $1000 + (-1.1 * $1000) = $1000 - $1100 = -$100

net_final_position_10_pct_mkt_loss = (pos_Y  * y_gain) + (pos_X * x_gain)  
net_final_position_10_pct_mkt_loss = ($1000 * (1-(.1*1.1))) + (-$1100 * (1-(.1))) = ($1000*.89) - ($1100 *.9) = $890 - $990 = -$100

</code></pre>

<p>While we probably weren&#39;t ecstatic that our market neutral strategy remained flat when the market went up 10%, we should be happy that when the market went down 10% we didn&#39;t loose anything.</p>

<p>So, the dollar amount to portion to each position, to remain market neutral, is </p>

<pre><code>X_position = -beta * Y_position. 

</code></pre>

<p>One way to think of this is, if the beta of Y relative to X is greater than 1, then Y is more volatile than X. Y will have larger price swings. Therefore, to compensate for the <em>larger</em> Y swings, one needs to hold a proportionately <em>larger</em> position of X. </p>

<p>Conversely, if beta is less than 1, then Y is less volatile than X. Y will have smaller price swings. To match the <em>smaller</em> Y swings, one needs to hold a proportionately <em>smaller</em> position of X.</p>

<p>This weighting can be seen implemented in the <a href="https://www.quantopian.com/lectures/example-pairs-trading-algorithm">Lecture 46 pairs trading algo</a>.</p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5f5541e3c875f9000fc9f1ed' id='5f5541e3c875f9000fc9f1ed'>
<a href='#5f5541e3c875f9000fc9f1ed'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f4e64520a82d800104be9e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7090a0f636c82eb444c1cad97b5e71a4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f4e64520a82d800104be9e2'>Tomas Christensen</a>
</div>
<a UTCms='1599422947000' class='quanto-date posted-at response-posted-at' href='#5f5541e3c875f9000fc9f1ed'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Dan<br>
I really have my doubts that the following rule applies. I will explain why:</p>

<pre><code>If spread is above threshold we sell stock A and buy stock B.  
If spread is below threshold we buy stock A and sell stock B.  
</code></pre>

<p>The reason i am doubting the above is because of the case that is the spread between MRK and NOEJ. I am using the following calculation for hedge and the previously mentioned calculation of the spread with beta.</p>

<pre><code>def hedge_ratio(Y, X, add_const=True):  
    if add_const:  
        X = sm.add_constant(X)  
        model = sm.OLS(Y, X).fit()  
        return round(model.params[1], 2)  
    model = sm.OLS(Y, X).fit()  
    return round(model.params.values, 2)  
</code></pre>

<p>Now going back to 3 days ago on 2020-09-03 at 10 am (GMT+2), we get the following trade signal:<br>
<code>
ATTENTION: Open trade at MRK.DE NOEJ.DE. Stddev: 1.14. Current spread: [-2.11988616].  Sell -0.91x NOEJ.DE for every buy of MRK.DE  
</code></p>

<p>As the spread is below the threshold (-1.96) we buy stock A (MRK) and short stock B (NOEJ). However just 8 trading hours later at 9 am 2020-09-04 (GMT+2) the spread has changed to:<br>
<code>
ATTENTION: Open trade at MRK.DE NOEJ.DE. Stddev: 1.13. Current spread: [0.08439562]  
</code>
This gives us a signal to close the trade since it has crossed the zero line. But why is this the case? The trade will have lost money even with the correct hedge (which is 0.91x NOEJ).<br>
In the period the trade is open the long trade in MRK ends in -2.3% and our short in NOEJ ends in -1.82%, since we were short and it rose (2%*hedge=1.82%).<br>
So in total the spread trade loses us -2.3%+-1.82%=-4.12%. Yet the zscore spread doesn&#39;t show this as it just goes towards 0 instead of widening. How can this be, are you sure that its not the otherway around (Short stock A and buy stock B if below threshold)?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f5570a4b3092b6c782c1048' id='5f5570a4b3092b6c782c1048'>
<a href='#5f5570a4b3092b6c782c1048'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5a55c90de7768c62ec102c8f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/444de7ebbbcd25c616085ac000902358?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5a55c90de7768c62ec102c8f'>BIBANI Iheb</a>
</div>
<a UTCms='1599434916000' class='quanto-date posted-at response-posted-at' href='#5f5570a4b3092b6c782c1048'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@DAN , </p>

<p>I&#39;ve found many pairs between sectors in my country and I would like to use PAIRS TRADING. However, we are not allowed to SHORT.</p>

<p>Can I long what should have been long , than following the pairs until convergence to 0 then I decide to exit my position ?</p>

<p>I know that I&#39;ll not be covered but can I anyway follow the signal (I guess yes....)</p>

<p>Another question , how can we &quot;optimize&quot; our thresholds choices ?</p>

<p>Thanks for your answer  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f5578c62a13e5000f9276c9' id='5f5578c62a13e5000f9276c9'>
<a href='#5f5578c62a13e5000f9276c9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5a55c90de7768c62ec102c8f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/444de7ebbbcd25c616085ac000902358?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5a55c90de7768c62ec102c8f'>BIBANI Iheb</a>
</div>
<a UTCms='1599436998000' class='quanto-date posted-at response-posted-at' href='#5f5578c62a13e5000f9276c9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@DAN , </p>

<p>I have another question : As a signal , the &quot;right&quot; time to sell/buy in my case is it the same between the spread and in the case where I&#39;ve adopted a mean reversion strategy. I know that PAIRS TRADING is based on that....but my question is stated about the signal to take positions , are they the same between PAIRS TRADING AND MEAN REVERSION ?</p>

<p>Thanks a lot  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5f57610807e61d001204dd65' id='5f57610807e61d001204dd65'>
<a href='#5f57610807e61d001204dd65'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5f4e64520a82d800104be9e2'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7090a0f636c82eb444c1cad97b5e71a4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5f4e64520a82d800104be9e2'>Tomas Christensen</a>
</div>
<a UTCms='1599561992000' class='quanto-date posted-at response-posted-at' href='#5f57610807e61d001204dd65'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>To add onto the results of the strategy here are some of the results from yesterday to today.</p>

<p>Entering the below trades at 11:30 GMT+2 2020-09-07</p>

<pre><code>Possible trade at NEM.DE IFX.DE. Stddev: 0.44. Current spread: [-2.34131085]. Sell -2.34x IFX.DE for every NEM.DE  
Possible trade at HEN3.DE SZG.DE. Stddev: 0.46. Current spread: [2.49297692]. Buy 1.39x SZG.DE for every -HEN3.DE  
Possible trade at FPE.DE OSR.DE. Stddev: 0.52. Current spread: [2.00577857]. Buy -0.78x OSR.DE for every -FPE.DE  
Possible trade at PUM.DE NOEJ.DE. Stddev: 1.09. Current spread: [2.05171766]. Buy 0.85x NOEJ.DE for every -PUM.DE  
Possible trade at BAS.DE VOW3.DE. Stddev: 1.86. Current spread: [2.13772562]. Buy 0.33x VOW3.DE for every -BAS.DE  
Possible trade at RHM.DE AIR.DE. Stddev: 3.03. Current spread: [1.99226657. Buy -0.33x AIR.DE for every -RHM.DE  
Possible trade at NEM.DE MUV2.DE. Stddev: 3.86. Current spread: [-2.26960135]. Sell -0.27x MUV2.DE for every NEM.DE  
Possible trade at MUV2.DE SRT.DE. Stddev: 7.79. Current spread: [-2.11892304]. Sell -0.38x SRT.DE for every MUV2.DE  
Possible trade at NEM.DE SRT.DE. Stddev: 8.35. Current spread: [-2.19639924]. Sell -0.13x SRT.DE for every NEM.DE  
Possible trade at SAP.DE SRT.DE. Stddev: 9.76. Current spread: [-2.01099398]. Sell -0.12x SRT.DE for every SAP.DE  
</code></pre>

<p>Looking today (2020-09-08 12 am GMT+2) we get the following spreads for the previously taken trades:</p>

<pre><code>ATTENTION: Open trade at NEM.DE IFX.DE. Stddev: 0.46. Current spread: [-1.28238652]. Buy 2.27x IFX.DE for every -NEM.DE  
ATTENTION: Open trade at HEN3.DE SZG.DE. Stddev: 0.46. Current spread: [0.784125]. Buy 1.31x SZG.DE for every -HEN3.DE  
ATTENTION: Open trade at FPE.DE OSR.DE. Stddev: 0.51. Current spread: [-0.90834821]. Buy -0.78x OSR.DE for every -FPE.DE  
ATTENTION: Open trade at PUM.DE NOEJ.DE. Stddev: 1.08. Current spread: [1.68687877]. Buy 0.86x NOEJ.DE for every -PUM.DE  
ATTENTION: Open trade at BAS.DE VOW3.DE. Stddev: 1.91. Current spread: [1.33216638]. Buy 0.32x VOW3.DE for every -BAS.DE  
ATTENTION: Open trade at RHM.DE AIR.DE. Stddev: 2.95. Current spread: [1.05365243]. Buy -0.35x AIR.DE for every -RHM.DE  
ATTENTION: Open trade at NEM.DE MUV2.DE. Stddev: 3.92. Current spread: [-1.05973375]. Buy 0.27x MUV2.DE for every -NEM.DE  
ATTENTION: Open trade at MUV2.DE SRT.DE. Stddev: 7.67. Current spread: [-1.06324422]. Buy 0.39x SRT.DE for every -MUV2.DE  
ATTENTION: Open trade at NEM.DE SRT.DE. Stddev: 7.86. Current spread: [-1.07167311]. Buy 0.14x SRT.DE for every -NEM.DE  
ATTENTION: Open trade at SAP.DE SRT.DE. Stddev: 9.8. Current spread: [-0.90789959]. Buy 0.11x SRT.DE for every -SAP.DE

</code></pre>

<p>Giving a total profit for each of these trades adjusted with their respective hedge:<br>
-2,95% for all pairs. Further details in this screenshot: <a href="https://ibb.co/jLkgPvv" rel="nofollow">https://ibb.co/jLkgPvv</a></p>

<p>Also how come some of the hedges are negative? What does that even mean? For any pair and direction of the pairs the hedges will sometimes be negative, how can you buy -3,92x  for every short of the other stock?<br>
Again, as I haven&#39;t gotten any confirmation on my original question, what is the correct long/short combination of the pairs when hedges are taken into account?  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/how-to-take-trades-according-to-the-rolling-zscore-of-a-pairs-trade'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/how-to-take-trades-according-to-the-rolling-zscore-of-a-pairs-trade'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#77111212131516141c37060216190318071e16195914181a">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

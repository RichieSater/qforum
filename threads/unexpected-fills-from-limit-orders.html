<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
Unexpected fills from limit orders
</title>
<meta content='Hi,In the attached code, I trade only using limit orders, but the fills I get don&#39;t seem to correspond. I would be grateful if someone could help me reconcile it. The code is extremely simple and minimal and the idea is: - at start of each day place a limit order to buy at a set price - if it is unfilled at the end of the day, cancel it.This is done using scheduler.Expected resultsOn Nov 1, 4, 5, 6 we should buy 100 TLT at 85.50, then nothing for a while, then again on the 27 and 29th.Yahoo...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="5UGCbYnNbEzidi+NfXInnj3WUpehK9OQ/dYsz+BpTEaZJ/QgKzu+r1trdrwynY/qBVhx/tvnxot/2felSiwu/Q==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/unexpected-fills-from-limit-orders' property='og:url'>
<meta content='Unexpected fills from limit orders' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/unexpected-fills-from-limit-orders' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='Unexpected fills from limit orders' property='og:title'>
<meta content='Hi,In the attached code, I trade only using limit orders, but the fills I get don&#39;t seem to correspond. I would be grateful if someone could help me reconcile it. The code is extremely simple and minimal and the idea is: - at start of each day place a limit order to buy at a set price - if it is unfilled at the end of the day, cancel it.This is done using scheduler.Expected resultsOn Nov 1, 4, 5, 6 we should buy 100 TLT at 85.50, then nothing for a while, then again on the 27 and 29th.Yahoo...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/unexpected-fills-from-limit-orders">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='54ccb229db7a0732880000eb'>
<div class='post-container' data-post-id='54ccb229db7a0732880000eb' id='54ccb229db7a0732880000eb'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>Unexpected fills from limit orders</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549d79c5f15df2a3f90002f0'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/434ab68fb11460978fce23b68a6b2a39?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549d79c5f15df2a3f90002f0'>Bill Lyons</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1422701097000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=Unexpected fills from limit orders&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Funexpected-fills-from-limit-orders%3Futm_source%3Dwebsite_share%26utm_campaign%3Dunexpected-fills-from-limit-orders%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Funexpected-fills-from-limit-orders%3Futm_source%3Dwebsite_share%26utm_campaign%3Dunexpected-fills-from-limit-orders%26utm_medium%3Dlinkedin&amp;title=Unexpected+fills+from+limit+orders+%28Bill+Lyons%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/unexpected-fills-from-limit-orders?utm_source=website_share&amp;utm_campaign=unexpected-fills-from-limit-orders&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Bill Lyons" />
<div class='body-text'>
<div class='body-text-container post-body'><p>Hi,<br>
In the attached code, I trade only using limit orders, but the fills I get don&#39;t seem to correspond. I would be grateful if someone could help me reconcile it. The code is extremely simple and minimal and the idea is:<br>
 - at start of each day place a limit order to buy at a set price<br>
 - if it is unfilled at the end of the day, cancel it.<br>
This is done using scheduler.</p>

<p><strong>Expected results</strong><br>
On Nov 1, 4, 5, 6 we should buy 100 TLT at 85.50, then nothing for a while, then again on the 27 and 29th.<br>
<a href="https://uk.finance.yahoo.com/q/hp?s=TLT&amp;b=30&amp;a=09&amp;c=2002&amp;e=30&amp;d=10&amp;f=2002&amp;g=d">Yahoo OHLC data</a></p>

<p><strong>Observed results</strong><br>
We trade on the right days, and usually for the right amount (100 shares).<br>
The trade prices are not my limit price, but tend to be 10 to 15 cents off either way.<br>
On Nov 1st we somehow buy 300 shares, up to 86.06.</p>

<p>Clearly there is something I&#39;ve misunderstood even in this simple test script. Can anyone see how these fills are resulting from a simple limit order?</p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>15 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='54cd9c7c4081eda6ca000098' id='54cd9c7c4081eda6ca000098'>
<a href='#54cd9c7c4081eda6ca000098'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/53d46cdb75f57a2832005a6b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/62b39881ee19f936224017339779d9d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/53d46cdb75f57a2832005a6b'>Market Tech</a>
</div>
<a UTCms='1422761087000' class='quanto-date posted-at response-posted-at' href='#54cd9c7c4081eda6ca000098'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Bill L. Yeah, I&#39;m not sure what&#39;s going on with these limit orders. They should get cancelled, yet don&#39;t. And they seem to stay in the market (because they eventually all fill...???)</p>

<p>Add some logging to your strat or try this one:</p>

<pre><code>def initialize(context):  
    context.stock = symbol(&#39;TLT&#39;)  
    set_benchmark(symbol(&#39;TLT&#39;))  
    schedule_function(func = StartOfDayEntry,  
                      date_rule = date_rules.every_day(),  
                      time_rule = time_rules.market_open(minutes=15))  
    schedule_function(func = UpdateState,  
                      date_rule = date_rules.every_day(),  
                      time_rule = time_rules.market_close(minutes=15))  
    schedule_function(func = EndOfDayCancel,  
                      date_rule = date_rules.every_day(),  
                      time_rule = time_rules.market_close(minutes=15))

def handle_data(context, data):  
    record(Close     = data[context.stock].close_price)  
    record(PnL       = context.portfolio.pnl)  
    record(Outlay    = context.portfolio.positions_value)  
    record(Leverage  = context.account.leverage)  
    record(CostBasis = context.portfolio.positions[context.stock].cost_basis)

# limit order to buy at specific level  
def StartOfDayEntry(context, data):  
    for stock in data:  
        order(stock, 100, style=LimitOrder(limit_price=85.5))  
        print(&quot;   Open order &gt;&gt;&gt;&quot;)

# cancel at EOD  
def EndOfDayCancel(context, data):  
    for stock in data:  
        print(&quot;  Open position {0:&gt;5} Net: {1:&lt;6.0f}&quot;.format(stock.symbol, data[stock].NetQuantity))  
        if (data[stock].OpenLimit):  
            cancel_order(data[stock].OpenLimit)  
            print(&quot;Limit cancelled {0:&gt;5} @ {1:&gt;7.2f}&quot;.format(stock.symbol, data[stock].OpenLimit.limit))

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  
def UpdateState(context, data):  
    for stock in data:  
        data[stock].NetQuantity   = context.portfolio.positions[stock].amount  
        data[stock].CostBasis     = context.portfolio.positions[stock].cost_basis  
        data[stock].HasOpenOrders = False  
        data[stock].OpenLimit     = None  
        data[stock].OpenStop      = None  
        if (get_open_orders(stock)):  
            data[stock].HasOpenOrders = True  
            for order in get_open_orders(stock):  
                if order.limit:  
                    data[stock].OpenLimit   = order  
                    data[stock].LimitLeaves = order.amount - order.filled  
                elif order.stop:  
                    data[stock].OpenStop    = order  
                    data[stock].StopLeaves  = order.amount - order.filled  
</code></pre>

<p>I get logs like this:  </p>

<p>2002-10-01     Open order &gt;&gt;&gt;<br>
  2002-10-01    Open position   TLT Net: 0<br>
  2002-10-01  Limit cancelled   TLT @   85.50<br>
  2002-10-02     Open order &gt;&gt;&gt;<br>
  2002-10-02    Open position   TLT Net: 0<br>
  2002-10-02  Limit cancelled   TLT @   85.50<br>
  2002-10-03     Open order &gt;&gt;&gt;<br>
  2002-10-03    Open position   TLT Net: 0<br>
  2002-10-03  Limit cancelled   TLT @   85.50<br>
  2002-10-04     Open order &gt;&gt;&gt;<br>
  2002-10-04    Open position   TLT Net: 0<br>
  2002-10-04  Limit cancelled   TLT @   85.50<br>
  2002-10-07     Open order &gt;&gt;&gt;<br>
  2002-10-07    Open position   TLT Net: 0<br>
  2002-10-07  Limit cancelled   TLT @   85.50<br>
  2002-10-08     Open order &gt;&gt;&gt;<br>
  2002-10-09     Open order &gt;&gt;&gt;<br>
  2002-10-09    Open position   TLT Net: 0<br>
  2002-10-09  Limit cancelled   TLT @   85.50<br>
  2002-10-10     Open order &gt;&gt;&gt;<br>
  2002-10-10    Open position   TLT Net: 0<br>
  2002-10-10  Limit cancelled   TLT @   85.50<br>
  2002-10-11     Open order &gt;&gt;&gt;<br>
  2002-10-14     Open order &gt;&gt;&gt;<br>
  2002-10-14    Open position   TLT Net: 0<br>
  2002-10-14  Limit cancelled   TLT @   85.50<br>
  2002-10-15     Open order &gt;&gt;&gt;<br>
  2002-10-15    Open position   TLT Net: 0<br>
  2002-10-15  Limit cancelled   TLT @   85.50<br>
  2002-10-16     Open order &gt;&gt;&gt;<br>
  2002-10-16    Open position   TLT Net: 0<br>
  2002-10-16  Limit cancelled   TLT @   85.50<br>
  2002-10-17     Open order &gt;&gt;&gt;<br>
  2002-10-17    Open position   TLT Net: 300<br>
  2002-10-18     Open order &gt;&gt;&gt;<br>
  2002-10-18    Open position   TLT Net: 400   </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54ce331bba5cb370b100021d' id='54ce331bba5cb370b100021d'>
<a href='#54ce331bba5cb370b100021d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549d79c5f15df2a3f90002f0'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/434ab68fb11460978fce23b68a6b2a39?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549d79c5f15df2a3f90002f0'>Bill Lyons</a>
</div>
<a UTCms='1422799646000' class='quanto-date posted-at response-posted-at' href='#54ce331bba5cb370b100021d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Market Tech,</p>

<p>Thanks for having a look. </p>

<p>I have replicated the issue using your much neater code, and I see many of the same strange fills. The log output agrees with what you have above (we never trade more than 100 shares), but the <strong>prices</strong> of the fills still seem wrong.</p>

<p>Running a full backtest with your code and parameters: From 2002-10-30 to 2002-11-30 with $1,000,000 initial capital (minute data).</p>

<p>If I look at the &quot;transactions&quot; tab I see:</p>

<blockquote>
<p>2002-11-01  buy 100 @ 86.03  (in 2 clips of 50 shares each)<br>
2002-11-04  buy 100 @ 85.45<br>
2001-11-05  buy 100 @ 85.76<br>
2001-11-06  buy 100 @ 85.49<br>
2001-11-27  buy  50 @ 85.55 and 50 @ 85.86<br>
2001-11-29  buy 100 @ 85.25</p>
</blockquote>

<p>Which is what I really don&#39;t understand. On days where we buy lower than 85.50, it makes sense (the market is below the limit when we place our order, and we get filled at the market level).<br>
But on the 1st, 5th and 27th, what is happening? How can I buy 20 or 30 cents above my limit?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54ce594f7e302229f6000274' id='54ce594f7e302229f6000274'>
<a href='#54ce594f7e302229f6000274'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/53d46cdb75f57a2832005a6b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/62b39881ee19f936224017339779d9d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/53d46cdb75f57a2832005a6b'>Market Tech</a>
</div>
<a UTCms='1422809425000' class='quanto-date posted-at response-posted-at' href='#54ce594f7e302229f6000274'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Bill L. No doubt this is part of the Q&#39;s market model. I mean, it definitely IS built into Quantopian&#39;s market model (what they call a slippage model). I&#39;d be more concerned with the missed cancels that the prices you get for limits. In the real market, if you are filled, you are filled at your limit or better. The fact that you&#39;re getting variations in fill price (above your limit) is Q&#39;s means of introducing volatility and volume restrictions risk.</p>

<p>I think a simple logging test with the enter limit / cancel limit, on the same day, needs to be done...</p>

<p>[Update]</p>

<p>It is absolutely Quantopian&#39;s market model at work here. How it interprets adequate volume; when it determines that the market is open for execution, what prices it should calculate for fills, all that goes into a market model affects these minutely back tests. Having built market models myself, I&#39;m not entirely sure their representation of the market is as accurate as it could be. But, what can you do? If you want to play in the Open game, then you have to use their market model. If you&#39;re here trying to build a system for your own use then you may want to build your own slippage model. (I&#39;m not sure how full featured a model could be given the surface of the environment quant&#39;s get exposed to.)</p>

<p>Evidence of slippage variations: change the minutes in the schedule_function from 1 to 60 to 180 and see the differences in order cancels and P&amp;L.</p>

<pre><code>def initialize(context):  
    context.stock = symbol(&#39;TLT&#39;)  
    set_benchmark(symbol(&#39;TLT&#39;))  
    schedule_function(func = StartOfDayEntry,  
                      date_rule = date_rules.every_day(),  
                      time_rule = time_rules.market_open(minutes=180))  
    schedule_function(func = EndOfDayCancel,  
                      date_rule = date_rules.every_day(),  
                      time_rule = time_rules.market_close(minutes=180))

def handle_data(context, data):  
    costBasis   = context.portfolio.positions[context.stock].cost_basis  
    costBasis   = costBasis if costBasis &gt; 0 else None  
    netQuantity = context.portfolio.positions[context.stock].amount  
    netQuantity = netQuantity if netQuantity &gt; 0 else None  
    record(CostBasis   = costBasis)  
    record(NetQuantity = netQuantity)

def StartOfDayEntry(context, data):  
    order(context.stock, 100, style=LimitOrder(limit_price=85.5))  
    print(&quot;   Limit order entry &gt;&gt;&gt;&quot;)

def EndOfDayCancel(context, data):  
    print(&quot;   Open position {0:&gt;5} Net: {1:&lt;6.0f}&quot;.  
          format(context.stock.symbol, context.portfolio.positions[context.stock].amount))  
    for order in get_open_orders(context.stock):  
        if order.limit:  
            cancel_order(order)  
            print(&quot;&lt;&lt; Limit cancelled {0:&gt;5} @ {1:&gt;7.2f}&quot;.format(context.stock.symbol, order.limit))  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54ce9b5a7e302229f60003b0' id='54ce9b5a7e302229f60003b0'>
<a href='#54ce9b5a7e302229f60003b0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549d79c5f15df2a3f90002f0'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/434ab68fb11460978fce23b68a6b2a39?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549d79c5f15df2a3f90002f0'>Bill Lyons</a>
</div>
<a UTCms='1422826332000' class='quanto-date posted-at response-posted-at' href='#54ce9b5a7e302229f60003b0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Market Tech, thank you again for looking at this with me. I was really unsure if this basic test was showing such odd results because I had misunderstood the framework, or there really was an error.</p>

<p>@ Quantopian staff, in term of using Q as backtesting platform, this really does seem to be outside of the realms of valid choices for a market model. If a trader places a limit order for 100 shares at 85.50, the only possible results are<br>
 1. completely filled at 85.50 or better<br>
 2. partially filled at 85.50 or better<br>
 3. zero fill</p>

<p>No matter what the assumptions are with regard to liquidity or volume restrictions, these are the only three possible outcomes (commissions aside). I don&#39;t see how any results of more complex trading algos can be judged if a simple test like this gives results that would be impossible in a trading environment, such as getting filled at 86.03 on a limit buy at 85.50.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54d0b220de0c5cb56400029c' id='54d0b220de0c5cb56400029c'>
<a href='#54d0b220de0c5cb56400029c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549d79c5f15df2a3f90002f0'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/434ab68fb11460978fce23b68a6b2a39?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549d79c5f15df2a3f90002f0'>Bill Lyons</a>
</div>
<a UTCms='1422963234000' class='quanto-date posted-at response-posted-at' href='#54d0b220de0c5cb56400029c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m sure everyone at Quantopian HQ is very busy with the results of the first round of the live trading Open, but I&#39;d be very interested to get some feedback on this issue. Apart from anything else it seems to invalidate historical backtesting results, so seems relevant to the Open as well!</p>

<p>Can Q reproduce these results? Do you agree that they are incorrect from a market simulation point of view, or is there an element at play here that we have missed?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54d0cb06de0c5ce762000381' id='54d0cb06de0c5ce762000381'>
<a href='#54d0cb06de0c5ce762000381'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51cbb24ab03fe0bc5500000e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/12b8399e99c8eab21b6bf2ac1d1da84a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51cbb24ab03fe0bc5500000e'>Seong Lee</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1422969608000' class='quanto-date posted-at response-posted-at' href='#54d0cb06de0c5ce762000381'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Bill,</p>

<p>Thanks for opening up this issue. It&#39;s quite a confusing topic and there have been a good number of questions asked on it. I think Market Tech summed it up well when he attributed to the difference in cost you&#39;re seeing your limit order versus the <strong>transactions</strong> tab in the full backtest (which adds on costs from the default slippage model).</p>

<p>I just quickly printed out &#39;context.portfolio.positions[context.stock]&#39; in order to check out what the logs would produce and this is what I got</p>

<pre><code>2002-11-01PRINTEvent({&#39;status&#39;: 0, &#39;limit_reached&#39;: True, &#39;created&#39;: Timestamp(&#39;2002-10-30 14:32:00+0000&#39;, tz=&#39;UTC&#39;), &#39;stop&#39;: None, &#39;reason&#39;: None, &#39;stop_reached&#39;: False, &#39;commission&#39;: 0.0, &#39;amount&#39;: 100, &#39;limit&#39;: 85.5, &#39;sid&#39;: Security(23921, symbol=&#39;TLT&#39;, security_name=&#39;ISHARES 20+ YEAR TREASURY BOND&#39;, exchange=&#39;NYSE ARCA EXCHANGE&#39;, start_date=datetime.datetime(2002, 7, 24, 0, 0, tzinfo=&lt;UTC&gt;), end_date=datetime.datetime(2015, 2, 3, 0, 0, tzinfo=&lt;UTC&gt;), first_traded=None), &#39;id&#39;: &#39;5f855a5f74954434bca6fdd187d00376&#39;, &#39;dt&#39;: Timestamp(&#39;2002-11-01 15:52:00+0000&#39;, tz=&#39;UTC&#39;), &#39;filled&#39;: 50})

2002-11-01PRINTPosition({&#39;amount&#39;: 50, &#39;last_sale_price&#39;: 85.47, &#39;cost_basis&#39;: 86.0041875, &#39;sid&#39;: Security(23921, symbol=&#39;TLT&#39;, security_name=&#39;ISHARES 20+ YEAR TREASURY BOND&#39;, exchange=&#39;NYSE ARCA EXCHANGE&#39;, start_date=datetime.datetime(2002, 7, 24, 0, 0, tzinfo=&lt;UTC&gt;), end_date=datetime.datetime(2015, 2, 3, 0, 0, tzinfo=&lt;UTC&gt;), first_traded=None)})  
</code></pre>

<p>You can see that the <strong>last_sale_price</strong> is 85.47 which is below your limit price, but on a <strong>cost_basis</strong> the total ended up being more than your limit. </p>

<p>I wonder if that can clear up the confusion a little?  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='54d0d135919ee963d6000353' id='54d0d135919ee963d6000353'>
<a href='#54d0d135919ee963d6000353'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549d79c5f15df2a3f90002f0'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/434ab68fb11460978fce23b68a6b2a39?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549d79c5f15df2a3f90002f0'>Bill Lyons</a>
</div>
<a UTCms='1422971191000' class='quanto-date posted-at response-posted-at' href='#54d0d135919ee963d6000353'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Seong,</p>

<p>Thanks for taking a look, I appreciate it. I am very impressed with he potential of Quantopian and hope to use it extensively, which is why I&#39;m concerned with simple sanity tests like this. Overall, I&#39;m amazed at how much the team has achieved so quickly.</p>

<p>If the explanation that Market Tech gave is correct, it seems to mean that the backtesting results are not correct, in the sense that they are significantly different from what would be observed in practice. If the difference in cost between my limit order versus the transactions tab in the full backtest is due to the default slippage model, then the slippage model has added 50 cents slippage to a limit order, which is incorrect. Even if it was a market order, it would be pretty extreme (for 50 or 100 shares, of an instrument which traded about 100,000 shares daily at that time). But I don&#39;t want to get sidetracked into the details of the slippage model.</p>

<p>The key issue, I think, is that for a limit order, there cannot be slippage on price. Your cost basis can only be the limit price. The choices on the simulation side are how much of your order gets filled: from none, to all. But there is no possibility of trading above your limit. Does that correspond to your understanding of trading using limit orders?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54d0d9c7e56d45599800037e' id='54d0d9c7e56d45599800037e'>
<a href='#54d0d9c7e56d45599800037e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51cbb24ab03fe0bc5500000e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/12b8399e99c8eab21b6bf2ac1d1da84a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51cbb24ab03fe0bc5500000e'>Seong Lee</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1422973386000' class='quanto-date posted-at response-posted-at' href='#54d0d9c7e56d45599800037e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Bill,</p>

<p>I see what you&#39;re saying. </p>

<p><code>The key issue, I think, is that for a limit order, there cannot be slippage on price. Your cost basis can only be the limit price.</code></p>

<p>I may be wrong on this, but I personally haven&#39;t encountered a situation where a limit order doesn&#39;t encounter commission costs. Thoughts on this?  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='54d0f196e56d458242000384' id='54d0f196e56d458242000384'>
<a href='#54d0f196e56d458242000384'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549d79c5f15df2a3f90002f0'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/434ab68fb11460978fce23b68a6b2a39?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549d79c5f15df2a3f90002f0'>Bill Lyons</a>
</div>
<a UTCms='1422979483000' class='quanto-date posted-at response-posted-at' href='#54d0f196e56d458242000384'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Seong, thanks for continuing to give this some attention, I think there is a relatively fundamental problem here, but I seem to be having some issues clearly communicating it.  </p>

<blockquote>
<p>I may be wrong on this, but I personally haven&#39;t encountered a situation where a limit order doesn&#39;t encounter commission costs.</p>
</blockquote>

<p>Although it is true, I&#39;m not sure that this is really relevant to the example we are trying to understand. </p>

<p>A limit order to buy 100 shares @ 85.50 receives a fill at 86.03. Are you implying that the 53 cent difference is due to the default 3 cent commissions?<br>
If it was somehow due to commissions (for example, the commission model giving results 20 times too large), all the fills in this simple test would be at (85.5 + commission), but instead we see fills at  86.03, 85.76, 85.55 and 85.86.<br>
So, with the clarification:  </p>

<blockquote>
<p>The key issue is that for a limit order, there cannot be slippage on price. Your cost basis can only be the limit price (<em>plus commission</em>)</p>
</blockquote>

<p>I don&#39;t think we are any closer to understanding why this backtest fails to give fills that are compatible with actual trading results. Is it possible to explain these prices?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54d10afade0c5cb564000392' id='54d10afade0c5cb564000392'>
<a href='#54d10afade0c5cb564000392'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51cbb24ab03fe0bc5500000e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/12b8399e99c8eab21b6bf2ac1d1da84a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51cbb24ab03fe0bc5500000e'>Seong Lee</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1422985980000' class='quanto-date posted-at response-posted-at' href='#54d10afade0c5cb564000392'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Bill,</p>

<p>I understand what you&#39;re saying, although I don&#39;t have a clear grasp on the problem either. To me, because the last_sale_price is under your limit price, it seems that commissions per share + trade has to account for the difference between <strong>last_sale_price</strong> and <strong>cost_basis</strong>. Still investigating a bit further  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='54d115de919ee9edf7000494' id='54d115de919ee9edf7000494'>
<a href='#54d115de919ee9edf7000494'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51cbb24ab03fe0bc5500000e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/12b8399e99c8eab21b6bf2ac1d1da84a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51cbb24ab03fe0bc5500000e'>Seong Lee</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1422988771000' class='quanto-date posted-at response-posted-at' href='#54d115de919ee9edf7000494'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Bill,</p>

<p>Here&#39;s a better explanation of what&#39;s going on. So there are two factors at work:</p>

<p>1) Commission costs are factored into the LIMIT order so if you were to set slippage and commissions to ZERO you would get limit orders that match your criteria.  </p>

<pre><code>    set_commission(commission.PerShare(cost=0, min_trade_cost=None))  
    set_slippage(slippage.FixedSlippage(spread=0))  
</code></pre>

<p>2) Also what&#39;s going on is that it&#39;s also a problem on our end that once you submit a limit order, we <strong>incorrectly</strong> go through the following steps:</p>

<ul>
<li>If the bar price triggers the order, the order goes into the execution engine.<br></li>
<li>The execution engine then applies the slippage model.<br></li>
<li>The order is filled using the slippage-adjusted price.</li>
</ul>

<p>We need to take the slippage model out of it for limit orders - that will be a better model.</p>

<p>We&#39;re also thinking about modifying the slippage model instead of removing it in these cases. What do you think about looking at the high and low prices of the bar, and then filling the order depending on availability? For instance, imagine you have a limit order to buy 100 shares if the price dips to 10.00. In a one-minute bar, the high is 10.05, the low is 9.95, and the volume is 100. That order shouldn&#39;t completely fill - it should only fill for the parts of the bar that are under 10. Do you think we should head in that direction?</p>

<p>Seong  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='54d11afb919ee9edf70004ae' id='54d11afb919ee9edf70004ae'>
<a href='#54d11afb919ee9edf70004ae'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/53d46cdb75f57a2832005a6b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/62b39881ee19f936224017339779d9d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/53d46cdb75f57a2832005a6b'>Market Tech</a>
</div>
<a UTCms='1422990080000' class='quanto-date posted-at response-posted-at' href='#54d11afb919ee9edf70004ae'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The sequence should be:</p>

<p>1) Apply price market model<br>
2) Apply fill quantity market model<br>
3) Apply commission model  </p>

<p>For #1 price is a function order type and bar range. There is no way to speculate where price spent most of the bar and where most of the volume for that bar was transacted.<br>
For #2 the % fill for the bar should be only volume based, again no way to know how much volume was executed above or below some limit or stoplimit price.</p>

<p>So one would determine the price to execute the order. Limit order prices are obvious. Market order prices are of course the close of the bar. Stop orders, however are trickier. Touching the stop price does not mean your order was necessarily transacted at that price. So, in this case only would you want to provide some reproducible variation in execution price. Whatever would be reasonable I suppose. What does the Q use now? (Perhaps x% of high/low range added to the stop -- if close &gt; open, else subtracted from the stop if close &lt; open) </p>

<p>Then determine the volume available to fill the order.  A null volume model may consume all the volume available for that bar. Not realistic but hey, it&#39;s the null model. A realistic fill quantity model would take some % as you currently allow.  </p>

<p>Add any commissions as specified by the model.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54d123cfada29efa87000458' id='54d123cfada29efa87000458'>
<a href='#54d123cfada29efa87000458'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549d79c5f15df2a3f90002f0'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/434ab68fb11460978fce23b68a6b2a39?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549d79c5f15df2a3f90002f0'>Bill Lyons</a>
</div>
<a UTCms='1422992337000' class='quanto-date posted-at response-posted-at' href='#54d123cfada29efa87000458'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Seong, </p>

<p>Thanks, that explanation makes sense. At least that applying slippage to limit orders can only make system results <em>worse</em> in a backtest, not better.  </p>

<blockquote>
<p>buy 100 shares if the price dips to 10.00. In a one-minute bar, the high is 10.05, the low is 9.95, and the volume is 100. That order shouldn&#39;t completely fill</p>
</blockquote>

<p>Agreed, some kind of heuristic for fill volume is needed. But the details will not affect the system results too much: if the market trades lower for a few bars, the limit order will get filled anyway, just a few bars later. The only difference will be if someone trades at the exact low or high of the life of the limit order, which is generally not the case (or a good basis for a system). </p>

<p>Filling a number of shares linearly proportional to where the limit was on the bar seems as good as anything. So, 50 shares would fill that minute in your example, and 100% of the volume traded would fill if your limit was fully above the minute bar. (But as an aside, if the limit price is above the market at the time the limit order is submitted, it will be marketable and the slippage rule will apply up to the limit price: if high/low is 10.05/9.95 and I submit a buy at limit 10.5 in small enough volume that I should be totally filled, the price still needs to be determined)</p>

<p>Edit: clarified the last parental comment  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54d3d28e51c6105743000319' id='54d3d28e51c6105743000319'>
<a href='#54d3d28e51c6105743000319'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/549d79c5f15df2a3f90002f0'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/434ab68fb11460978fce23b68a6b2a39?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/549d79c5f15df2a3f90002f0'>Bill Lyons</a>
</div>
<a UTCms='1423168147000' class='quanto-date posted-at response-posted-at' href='#54d3d28e51c6105743000319'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi,</p>

<p>So far this example has been useful in pointing out a possible improvement to the backtesting engine. If it is possible, I&#39;d like to continue looking at the same example, as I still think there may be additional steps needed to fully reconcile these fills.</p>

<p>First, we remove any effect of commissions and slippage, as you recommend with  </p>

<pre><code>set_commission(commission.PerShare(cost=0, min_trade_cost=None))  
    set_slippage(slippage.FixedSlippage(spread=0))  
</code></pre>

<p>Sticking with the same script and dates (trying to buy at limit 85.5 every day in November 2002)</p>

<p><strong>Expected results (with no slippage or commission)</strong><br>
On Nov 1, 5 and 27, we should buy 100 TLT at 85.50<br>
On Nov 4, 6, 29 we should get filled at market, below 85.50 when we place the limit order<br>
On the other days we get no fill</p>

<p><strong>Observed results</strong><br>
Nov 1   buy 100 @ 85.47<br>
Nov 5   buy 100 @ 85.39<br>
Nov 27 buy 100 @ 85.41</p>

<p>I suppose this is because these are the first <strong>last_sale_price</strong> which is less than the order&#39;s limit. But again, this is not the right level: the fills will still be at the limit exactly (in this case without commission). The way this is currently implemented unrealistically improves the trader&#39;s fills to the low of the bar they would have traded in. This has much less of an impact than the other point, but for algos which trade frequently it will nonetheless continually improve their backtested results.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='54d3d762e28dfffa23000002' id='54d3d762e28dfffa23000002'>
<a href='#54d3d762e28dfffa23000002'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/53d46cdb75f57a2832005a6b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/62b39881ee19f936224017339779d9d4?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/53d46cdb75f57a2832005a6b'>Market Tech</a>
</div>
<a UTCms='1423169382000' class='quanto-date posted-at response-posted-at' href='#54d3d762e28dfffa23000002'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Price market model<br>
• On a bar by bar basis<br>
• • For limit order<br>
• • • Bar range contains limit order price<br>
• • • • Fill @ limit price<br>
• • • Bar high &lt; limit price<br>
• • • • Fill @ bar high<br>
• • • Bar low &gt; limit price<br>
• • • • NO Fill  </p>

<p>If Price market model == Filled<br>
&nbsp;&nbsp;&nbsp;Apply Fill quantity market model  </p>

<p>If Fill quantity market model filled (size found to fill order)<br>
&nbsp;&nbsp;&nbsp;Apply Commission market model</p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/unexpected-fills-from-limit-orders'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/unexpected-fills-from-limit-orders'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#15737070717774767e556460747b617a657c747b3b767a78">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

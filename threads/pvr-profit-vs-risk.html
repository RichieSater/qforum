<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
PvR - Profit vs. Risk
</title>
<meta content='As software developers, while writing trading algorithms, it is beneficial to know whether our changes increase or decrease the output in a run. Consider an example: 1. Seeing 200% returns over two years, great. 2. Make a change. 3. Now seeing only 180% returns. 4  Throw away that change and think in another direction. 5. You actually made 5% more per trade. So what happened? How can that be? The problem is that your change seemed bad yet actually resulted in an increase in profit per dollar...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="+XGYBYeUPxHurSk9YdIEJm2JVkQy3t9k87qGXRtcRhKFF+5IJWLt8lewcAwuPaxSVQd1LUgSyn9xtV03sRkkqQ==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/pvr-profit-vs-risk' property='og:url'>
<meta content='PvR - Profit vs. Risk' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/pvr-profit-vs-risk' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='PvR - Profit vs. Risk' property='og:title'>
<meta content='As software developers, while writing trading algorithms, it is beneficial to know whether our changes increase or decrease the output in a run. Consider an example: 1. Seeing 200% returns over two years, great. 2. Make a change. 3. Now seeing only 180% returns. 4  Throw away that change and think in another direction. 5. You actually made 5% more per trade. So what happened? How can that be? The problem is that your change seemed bad yet actually resulted in an increase in profit per dollar...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/pvr-profit-vs-risk">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='568b0076db141b757c00026a'>
<div class='post-container' data-post-id='568b0076db141b757c00026a' id='568b0076db141b757c00026a'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>PvR - Profit vs. Risk</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<span class='posted-at'>edited </span>
<span UTCms='1495145138000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=PvR - Profit vs. Risk&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fpvr-profit-vs-risk%3Futm_source%3Dwebsite_share%26utm_campaign%3Dpvr%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fpvr-profit-vs-risk%3Futm_source%3Dwebsite_share%26utm_campaign%3Dpvr%26utm_medium%3Dlinkedin&amp;title=PvR+-+Profit+vs.+Risk+%28Blue+Seahawk%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class='tags tag-row'>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Tools and Tips' data-tag-id='55c50e7d8d4710ec6e000011' href='/posts/tag/Tools-and-Tips/newest'>Tools and Tips</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Value' data-tag-id='55d33f023f6ba10065000000' href='/posts/tag/Value/newest'>Value</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Statistics' data-tag-id='55d33f923f6ba1005d000001' href='/posts/tag/Statistics/newest'>Statistics</a>
</div>
<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/pvr-profit-vs-risk?utm_source=website_share&amp;utm_campaign=pvr&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Blue Seahawk" />
<div class='body-text'>
<div class='body-text-container post-body'><p>As software developers, while writing trading algorithms, it is beneficial to know whether our changes increase or decrease the output in a run.</p>

<p>Consider an example:<br>
1. Seeing 200% returns over two years, great.<br>
2. Make a change.<br>
3. Now seeing only 180% returns.<br>
4  Throw away that change and think in another direction.<br>
5. You actually made 5% more per trade.</p>

<p>So what happened? How can that be?</p>

<p>The problem is that your change seemed bad yet actually resulted in an increase in profit per dollar transacted for stocks (amount risked, or put into play).</p>

<p>To quote someone here recently, I don&#39;t want to be a party pooper. And yet, the fact of the matter is, you can&#39;t trust that returns chart.</p>

<p>The returns calculation employs a philosophy that all of your starting capital is at risk as soon as you open the account, and that&#39;s all that is ever at risk.<br>
It calculates returns based on starting capital regardless of how much you actually activated (even if you spent very little of it or went negative, into margin, borrowing from the broker). To be fair, that is apparently common in the industry. Meanwhile in developing code, this will help you see straight.</p>

<p>In the example, the new code made different trades based on the change and those trades were overall more profitable, it&#39;s just that the amount put to work on each stock was lower. You spent less. You made more for each dollar. That&#39;s the goal, right?</p>

<p><strong>PvR stands for Profit vs. Risk</strong>. It calculates returns based only on the amount put to work and as a result, is a reliable measure of code merit.</p>

<p>With PvR, while you are writing code, you no longer need to be concerned with trying to make sure you are spending all of the starting capital. You can worry about that later, closer to the time you&#39;re ready to go live, or whenever you decide to focus on it. The PvR metric lets you stay focused.</p>

<p>It also means you no longer need to be locked into a cage-match battle with margin, leverage. Doesn&#39;t matter, for now. PvR only cares about profit per dollar put to work. You can start out with $100K and spend just $10K or another time $10M, PvR will always give you a deterministic value you can rely on that measures your code merit.</p>

<p>By the same token, with no changes in the code, whether your starting capital field in the backtester is set at $10 or $10M, if you make the same trades, the chart will vary widely while PvR will be the same.  <strong>You can always trust it</strong>.</p>

<p><strong>Try it</strong>. Clone below, run the backtest, note the ending PvR, then change the starting capital value and run again. The main chart returns will be very different, however PvR will be the same.</p>

<p>There are three sets of PvR code in this post:<br>
1. Minimal amount of code for backtests<br>
2. Full code for backtests<br>
3. Research/Notebook code, experimental</p>

<p>Below is a minimal amount of code for recording PvR. <em>For best speed, replace c. with context. and remove c = context, then move the initialization to def initialize.</em></p>

<pre><code>def handle_data(context, data):  
    pvr(context, data)

def pvr(context, data):  
    &#39;&#39;&#39; Minimal custom chart of profit_vs_risk returns  
    &#39;&#39;&#39;  
    c = context  # Brevity, readability  
    if &#39;pvr&#39; not in c:  
        # For real money, you can modify this to total cash input minus any withdrawals  
        manual_cash = c.portfolio.starting_cash  
        c.pvr = {  
            &#39;chart_pvr&#39;      : 1,  
            &#39;chart_cash_low&#39; : 1,  
            &#39;chart_max_shrt&#39; : 1,  
            &#39;chart_max_risk&#39; : 1,  
            &#39;start&#39;          : manual_cash,  
            &#39;cash_low&#39;       : manual_cash,  
            &#39;max_shrt&#39;       : 0,  
            &#39;max_risk&#39;       : 0,  
        }  
    c.pvr[&#39;cash_low&#39;] = min(c.pvr[&#39;cash_low&#39;], c.portfolio.cash)  
    c.pvr[&#39;max_shrt&#39;] = max(c.pvr[&#39;max_shrt&#39;], abs(sum([z.amount * z.last_sale_price for s, z in c.portfolio.positions.items() if z.amount &lt; 0])))  
    c.pvr[&#39;max_risk&#39;] = max(0, c.pvr[&#39;max_risk&#39;], c.pvr[&#39;start&#39;] - c.pvr[&#39;cash_low&#39;], c.pvr[&#39;max_shrt&#39;])

    # Profit_vs_Risk returns based on max amount actually invested, risked, long or short  
    if c.pvr[&#39;max_risk&#39;] != 0: # Avoid zero-divide  
        if c.pvr[&#39;chart_pvr&#39;]:  record(PvR = 100 * (c.portfolio.portfolio_value - c.pvr[&#39;start&#39;]) / c.pvr[&#39;max_risk&#39;])  
    if c.pvr[&#39;chart_cash_low&#39;]: record(CashLow = c.pvr[&#39;cash_low&#39;])  
    if c.pvr[&#39;chart_max_shrt&#39;]: record(MxShrt  = c.pvr[&#39;max_shrt&#39;])  
    if c.pvr[&#39;chart_max_risk&#39;]: record(MxRisk  = c.pvr[&#39;max_risk&#39;])  
</code></pre>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>25 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='568b01eaadf9dd7794000250' id='568b01eaadf9dd7794000250'>
<a href='#568b01eaadf9dd7794000250'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1451950575000' class='quanto-date posted-at response-posted-at' href='#568b01eaadf9dd7794000250'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>This is the <strong>full PvR code</strong>. See the &#39;Source Code&#39; tab. Just pay attention to the Options section at the beginning.<br>
Once you are used to it, it&#39;s easy to add to any algo.</p>

<p>Edit: Better to use the full PvR code below (displayed in the large text block).</p>

<p><em>There&#39;s a section for initialize(), the main function, and the call to it, pvr(context, data). I&#39;ve been making that call from handle_data() rather than using schedule_function() because it is more universal and adaptable that way. See the one pasted below, later, for a simplified and improved version.</em>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='568b022be4bc25ecb8000270' id='568b022be4bc25ecb8000270'>
<a href='#568b022be4bc25ecb8000270'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1451950640000' class='quanto-date posted-at response-posted-at' href='#568b022be4bc25ecb8000270'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Development in progress to chart PvR in a Research/Notebook.<br>
Need help with this. Sometimes makes vast numbers.</p>

<pre><code>#backtest = get_backtest(&#39;5637da7c2fe6e438be119651&#39;) # Place these two in a different cell ...  
#import pyfolio as pf                                #   above below, no need to always rerun them  
qrets      = backtest.daily_performance.returns          # Quantopian returns  
start      = backtest.daily_performance.starting_cash[1] # Starting capital like 100000, probably a better way  
cash_spent = start - min(backtest.daily_performance.starting_cash) # Most spent so far, should not see the future  
max_cash   = max(0, start - cash_spent)                  # Cash spent, of start or over, a logic puzzle for the mind  
cash_dip   = abs( backtest.positions.min().amount )      # Lowest single short as a positive value, should be all shorts  
riskhi     = max(max_cash, cash_dip)                     # Should be highest of cash spent or shorting  
pvr        = (qrets * start) / riskhi                    # (portf - start) / riskhi  
pf.plot_rolling_returns(qrets, pvr)                      # Plot Q returns and PvR  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='568fd136c4720623d4000035' id='568fd136c4720623d4000035'>
<a href='#568fd136c4720623d4000035'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55ed0ebaf7eced2820000138'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/192fde5a5de866362a9e34c096cb8a9b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55ed0ebaf7eced2820000138'>Minh</a>
</div>
<a UTCms='1452265786000' class='quanto-date posted-at response-posted-at' href='#568fd136c4720623d4000035'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>If I&#39;m understanding this correctly, the PvR number is like the total return per dollars used? Thanks for sharing.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5696b8da71825dc62f000323' id='5696b8da71825dc62f000323'>
<a href='#5696b8da71825dc62f000323'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/562545816f0077be2a000054'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/65eed7bd690af7911cb4e82f70d3a8f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/562545816f0077be2a000054'>Shawn Emhe II</a>
</div>
<a UTCms='1452718303000' class='quanto-date posted-at response-posted-at' href='#5696b8da71825dc62f000323'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Are you intentionally converting shorts to int and leaving the longs measure as a float?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5697831ea73e9bf2b7000175' id='5697831ea73e9bf2b7000175'>
<a href='#5697831ea73e9bf2b7000175'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1452770084000' class='quanto-date posted-at response-posted-at' href='#5697831ea73e9bf2b7000175'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Minh: Yes.  @Shawn: Remnant from the trim from full to minimal, fixed above now, thanks for catching it.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='569784bda73e9bf2b7000180' id='569784bda73e9bf2b7000180'>
<a href='#569784bda73e9bf2b7000180'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1452770498000' class='quanto-date posted-at response-posted-at' href='#569784bda73e9bf2b7000180'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Updated Aug 16, 2017<br>
New full PvR code. Now all self-contained (no need for the section in initialize), produces a summary every six months or so (126 days, set to whatever you wish) and always at the end of the run, has a fix for shorting, added pvr/day and CAGR. Info to logging window when some highs are hit is on by default.</p>

<pre><code>def initialize(context):  
      for i in range(1, 391):  
        schedule_function(pvr, date_rules.every_day(), time_rules.market_open(minutes=i))

def pvr(context, data):  
    &#39;&#39;&#39; Custom chart and/or logging of profit_vs_risk returns and related information  
    &#39;&#39;&#39;  
    import time  
    from datetime import datetime  
    from pytz import timezone      # Python will only do once, makes this portable.  
                                   #   Move to top of algo for better efficiency.  
    c = context  # Brevity is the soul of wit -- Shakespeare [for readability]  
    if &#39;pvr&#39; not in c:

        # For real money, you can modify this to total cash input minus any withdrawals  
        manual_cash = c.portfolio.starting_cash  
        time_zone   = &#39;US/Pacific&#39;   # Optionally change to your own time zone for wall clock time

        c.pvr = {  
            &#39;options&#39;: {  
                # # # # # # # # # #  Options  # # # # # # # # # #  
                &#39;logging&#39;         : 0,    # Info to logging window with some new maximums  
                &#39;log_summary&#39;     : 126,  # Summary every x days. 252/yr

                &#39;record_pvr&#39;      : 1,    # Profit vs Risk returns (percentage)  
                &#39;record_pvrp&#39;     : 0,    # PvR (p)roportional neg cash vs portfolio value  
                &#39;record_cash&#39;     : 0,    # Cash available  
                &#39;record_max_lvrg&#39; : 1,    # Maximum leverage encountered  
                &#39;record_max_risk&#39; : 1,    # Highest risk overall  
                &#39;record_shorting&#39; : 0,    # Total value of any shorts  
                &#39;record_max_shrt&#39; : 1,    # Max value of shorting total  
                &#39;record_cash_low&#39; : 1,    # Any new lowest cash level  
                &#39;record_q_return&#39; : 0,    # Quantopian returns (percentage)  
                &#39;record_pnl&#39;      : 0,    # Profit-n-Loss  
                &#39;record_risk&#39;     : 0,    # Risked, max cash spent or shorts beyond longs+cash  
                &#39;record_leverage&#39; : 0,    # End of day leverage (context.account.leverage)  
                # All records are end-of-day or the last data sent to chart during any day.  
                # The way the chart operates, only the last value of the day will be seen.  
                # # # # # # # # #  End options  # # # # # # # # #  
            },  
            &#39;pvr&#39;        : 0,      # Profit vs Risk returns based on maximum spent  
            &#39;cagr&#39;       : 0,  
            &#39;max_lvrg&#39;   : 0,  
            &#39;max_shrt&#39;   : 0,  
            &#39;max_risk&#39;   : 0,  
            &#39;days&#39;       : 0.0,  
            &#39;date_prv&#39;   : &#39;&#39;,  
            &#39;date_end&#39;   : get_environment(&#39;end&#39;).date(),  
            &#39;cash_low&#39;   : manual_cash,  
            &#39;cash&#39;       : manual_cash,  
            &#39;start&#39;      : manual_cash,  
            &#39;tz&#39;         : time_zone,  
            &#39;begin&#39;      : time.time(),  # For run time  
            &#39;run_str&#39;    : &#39;{} to {}  ${}  {} {}&#39;.format(get_environment(&#39;start&#39;).date(), get_environment(&#39;end&#39;).date(), int(manual_cash), datetime.now(timezone(time_zone)).strftime(&quot;%Y-%m-%d %H:%M&quot;), time_zone)  
        }  
        if c.pvr[&#39;options&#39;][&#39;record_pvrp&#39;]: c.pvr[&#39;options&#39;][&#39;record_pvr&#39;] = 0 # if pvrp is active, straight pvr is off  
        if get_environment(&#39;arena&#39;) not in [&#39;backtest&#39;, &#39;live&#39;]: c.pvr[&#39;options&#39;][&#39;log_summary&#39;] = 1 # Every day when real money  
        log.info(c.pvr[&#39;run_str&#39;])  
    p = c.pvr ; o = c.pvr[&#39;options&#39;] ; pf = c.portfolio ; pnl = pf.portfolio_value - p[&#39;start&#39;]  
    def _pvr(c):  
        p[&#39;cagr&#39;] = ((pf.portfolio_value / p[&#39;start&#39;]) ** (1 / (p[&#39;days&#39;] / 252.))) - 1  
        ptype = &#39;PvR&#39; if o[&#39;record_pvr&#39;] else &#39;PvRp&#39;  
        log.info(&#39;{} {} %/day   cagr {}   Portfolio value {}   PnL {}&#39;.format(ptype, &#39;%.4f&#39; % (p[&#39;pvr&#39;] / p[&#39;days&#39;]), &#39;%.3f&#39; % p[&#39;cagr&#39;], &#39;%.0f&#39; % pf.portfolio_value, &#39;%.0f&#39; % pnl))  
        log.info(&#39;  Profited {} on {} activated/transacted for PvR of {}%&#39;.format(&#39;%.0f&#39; % pnl, &#39;%.0f&#39; % p[&#39;max_risk&#39;], &#39;%.1f&#39; % p[&#39;pvr&#39;]))  
        log.info(&#39;  QRet {} PvR {} CshLw {} MxLv {} MxRisk {} MxShrt {}&#39;.format(&#39;%.2f&#39; % (100 * pf.returns), &#39;%.2f&#39; % p[&#39;pvr&#39;], &#39;%.0f&#39; % p[&#39;cash_low&#39;], &#39;%.2f&#39; % p[&#39;max_lvrg&#39;], &#39;%.0f&#39; % p[&#39;max_risk&#39;], &#39;%.0f&#39; % p[&#39;max_shrt&#39;]))  
    def _minut():  
        dt = get_datetime().astimezone(timezone(p[&#39;tz&#39;]))  
        return str((dt.hour * 60) + dt.minute - 570).rjust(3)  # (-570 = 9:31a)  
    date = get_datetime().date()  
    if p[&#39;date_prv&#39;] != date:  
        p[&#39;date_prv&#39;] = date  
        p[&#39;days&#39;] += 1.0  
    do_summary = 0  
    if o[&#39;log_summary&#39;] and p[&#39;days&#39;] % o[&#39;log_summary&#39;] == 0 and _minut() == &#39;100&#39;:  
        do_summary = 1              # Log summary every x days  
    if do_summary or date == p[&#39;date_end&#39;]:  
        p[&#39;cash&#39;] = pf.cash  
    elif p[&#39;cash&#39;] == pf.cash and not o[&#39;logging&#39;]: return  # for speed

    shorts = sum([z.amount * z.last_sale_price for s, z in pf.positions.items() if z.amount &lt; 0])  
    new_key_hi = 0                  # To trigger logging if on.  
    cash       = pf.cash  
    cash_dip   = int(max(0, p[&#39;start&#39;] - cash))  
    risk       = int(max(cash_dip, -shorts))

    if o[&#39;record_pvrp&#39;] and cash &lt; 0:   # Let negative cash ding less when portfolio is up.  
        cash_dip = int(max(0, cash_dip * p[&#39;start&#39;] / pf.portfolio_value))  
        # Imagine: Start with 10, grows to 1000, goes negative to -10, should not be 200% risk.

    if int(cash) &lt; p[&#39;cash_low&#39;]:             # New cash low  
        new_key_hi = 1  
        p[&#39;cash_low&#39;] = int(cash)             # Lowest cash level hit  
        if o[&#39;record_cash_low&#39;]: record(CashLow = p[&#39;cash_low&#39;])

    if c.account.leverage &gt; p[&#39;max_lvrg&#39;]:  
        new_key_hi = 1  
        p[&#39;max_lvrg&#39;] = c.account.leverage    # Maximum intraday leverage  
        if o[&#39;record_max_lvrg&#39;]: record(MxLv    = p[&#39;max_lvrg&#39;])

    if shorts &lt; p[&#39;max_shrt&#39;]:  
        new_key_hi = 1  
        p[&#39;max_shrt&#39;] = shorts                # Maximum shorts value  
        if o[&#39;record_max_shrt&#39;]: record(MxShrt  = p[&#39;max_shrt&#39;])

    if risk &gt; p[&#39;max_risk&#39;]:  
        new_key_hi = 1  
        p[&#39;max_risk&#39;] = risk                  # Highest risk overall  
        if o[&#39;record_max_risk&#39;]:  record(MxRisk = p[&#39;max_risk&#39;])

    # Profit_vs_Risk returns based on max amount actually invested, long or short  
    if p[&#39;max_risk&#39;] != 0: # Avoid zero-divide  
        p[&#39;pvr&#39;] = 100 * pnl / p[&#39;max_risk&#39;]  
        ptype = &#39;PvRp&#39; if o[&#39;record_pvrp&#39;] else &#39;PvR&#39;  
        if o[&#39;record_pvr&#39;] or o[&#39;record_pvrp&#39;]: record(**{ptype: p[&#39;pvr&#39;]})

    if o[&#39;record_shorting&#39;]: record(Shorts = shorts)             # Shorts value as a positve  
    if o[&#39;record_leverage&#39;]: record(Lv     = c.account.leverage) # Leverage  
    if o[&#39;record_cash&#39;]    : record(Cash   = cash)               # Cash  
    if o[&#39;record_risk&#39;]    : record(Risk   = risk)  # Amount in play, maximum of shorts or cash used  
    if o[&#39;record_q_return&#39;]: record(QRet   = 100 * pf.returns)  
    if o[&#39;record_pnl&#39;]     : record(PnL    = pnl)                # Profit|Loss

    if o[&#39;logging&#39;] and new_key_hi:  
        log.info(&#39;{}{}{}{}{}{}{}{}{}{}{}{}&#39;.format(_minut(),  
            &#39; Lv &#39;     + &#39;%.1f&#39; % c.account.leverage,  
            &#39; MxLv &#39;   + &#39;%.2f&#39; % p[&#39;max_lvrg&#39;],  
            &#39; QRet &#39;   + &#39;%.1f&#39; % (100 * pf.returns),  
            &#39; PvR &#39;    + &#39;%.1f&#39; % p[&#39;pvr&#39;],  
            &#39; PnL &#39;    + &#39;%.0f&#39; % pnl,  
            &#39; Cash &#39;   + &#39;%.0f&#39; % cash,  
            &#39; CshLw &#39;  + &#39;%.0f&#39; % p[&#39;cash_low&#39;],  
            &#39; Shrt &#39;   + &#39;%.0f&#39; % shorts,  
            &#39; MxShrt &#39; + &#39;%.0f&#39; % p[&#39;max_shrt&#39;],  
            &#39; Risk &#39;   + &#39;%.0f&#39; % risk,  
            &#39; MxRisk &#39; + &#39;%.0f&#39; % p[&#39;max_risk&#39;]  
        ))  
    if do_summary: _pvr(c)  
    if get_datetime() == get_environment(&#39;end&#39;):   # Summary at end of run  
        _pvr(c) ; elapsed = (time.time() - p[&#39;begin&#39;]) / 60  # minutes  
        log.info( &#39;{}\nRuntime {} hr {} min&#39;.format(p[&#39;run_str&#39;], int(elapsed / 60), &#39;%.1f&#39; % (elapsed % 60)))  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='56b6a85100abaf131d000431' id='56b6a85100abaf131d000431'>
<a href='#56b6a85100abaf131d000431'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55ed0ebaf7eced2820000138'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/192fde5a5de866362a9e34c096cb8a9b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55ed0ebaf7eced2820000138'>Minh</a>
</div>
<a UTCms='1454811222000' class='quanto-date posted-at response-posted-at' href='#56b6a85100abaf131d000431'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Gary,</p>

<p>I learned to like to your risk assessment and made my own PvR. Mine is a little different as it considers leverage spikes as extra money put at risked. You can even change the leverage limit to greater than 1.0 to simulate a margin account. I am posting this for anyone else who may find this useful.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58917722ba7ba30b1bad4d46' id='58917722ba7ba30b1bad4d46'>
<a href='#58917722ba7ba30b1bad4d46'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5841af213c428400120004f8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/323c3a3502407038cb460446e9ce7264?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5841af213c428400120004f8'>Caleb Sandfort</a>
</div>
<a UTCms='1485928226000' class='quanto-date posted-at response-posted-at' href='#58917722ba7ba30b1bad4d46'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Blue great stuff...definitely going to incorporate it into my algos.  Is there a particular range that is a good PvR value? Or just the higher the better?</p>

<p>Also, does calling it every minute from handle data give you much more accurate (truer?) data than calling it once at the end of the day?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58954623fabe8c4de2ac9108' id='58954623fabe8c4de2ac9108'>
<a href='#58954623fabe8c4de2ac9108'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5674b7bd1869e73f4a000334'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e411d64f7a123f5c2102614fafa48b58?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5674b7bd1869e73f4a000334'>Luke Izlar</a>
</div>
<a UTCms='1486177827000' class='quanto-date posted-at response-posted-at' href='#58954623fabe8c4de2ac9108'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I tested CAGR. It works well as far as I can tell. I added some code to make an option of recording it, took me a little while figure out why it wasn&#39;t working until I changed the number of days between summaries to 1 for daily logging. I would move the calculation out of the summary code and maybe put a logging option in for it like the other PvR items.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='589b0acf44739d09dd8a6ea3' id='589b0acf44739d09dd8a6ea3'>
<a href='#589b0acf44739d09dd8a6ea3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ae5cbbbbbc731b780000b8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0eccafa1826a9cefa1476f2074ff3300?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ae5cbbbbbc731b780000b8'>Michele Vianello</a>
</div>
<a UTCms='1486555855000' class='quanto-date posted-at response-posted-at' href='#589b0acf44739d09dd8a6ea3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>PvR seems better then QReturn..</p>

<p>But instead to calculate the return based on the &quot;max/min value&quot; why do not consider the &quot;avg&quot;?? I try to explane better with my poor english:</p>

<p>Usually in my algo I use these 3 record line:</p>

<p>record(nav=context.portfolio.portfolio_value) # total money in pocket<br>
record(cash=context.portfolio.cash) # cash<br>
record(port=context.portfolio.positions_value) # portfolio value    </p>

<p>Then, visually, I compare the Qreturn with the money invested day by day (wich is rappresented by the area under the &quot;context.portfolio.positions_value&quot; line)<br>
Comparing similar  Qreturn, i prefer the one with little &quot;port&quot; and equivalent large &quot;cash&quot;; this means more money avaible for other algos/investment.</p>

<p>In others world, if in 1 year my 10%Return algo use 20% only of the money avaible in the pocket, this algo is 5 time better (not exactly, of course), for me, then another algo which return the same 10% but using 100% of my pocket.</p>

<p>fiuuu..very difficult in english  :))</p>

<p>Then, to conclude, because I&#39;m not a programmer, is there a way to calculate the area under pocket/cash/position records and then to have this numerically and not just visually?<br>
Thanks for the patience...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58b0dfe26004fd52393a141f' id='58b0dfe26004fd52393a141f'>
<a href='#58b0dfe26004fd52393a141f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1487986658000' class='quanto-date posted-at response-posted-at' href='#58b0dfe26004fd52393a141f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Just noticed the comments above. Yes the call does need to be in handle_data. Leverage and risk for example often hit peaks and fall back by end of day. Anyone&#39;s welcome to click my name to send me a direct message too (I&#39;m likely to see it right away). For now I&#39;d just recommend to work with it, modifying to implement your ideas. </p>

<p>The large text block above is being updated, last one was yesterday (noted at the top of that post). I think PvR is quite a bit better now than when it started.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58b0fac03815346947eaf669' id='58b0fac03815346947eaf669'>
<a href='#58b0fac03815346947eaf669'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1487993536000' class='quanto-date posted-at response-posted-at' href='#58b0fac03815346947eaf669'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I was <a href="https://www.quantopian.com/posts/volatility-strategies-what-are-they#58b059dedd654107be230cd2">asked</a> to provide some guidance about this tool, what values are good and things to watch out for etc.</p>

<p><strong>Adding PvR to existing code</strong>  Often, I clone new algorithms and add the PvR code above, first copying their backtest code into an editor, then commenting out any record() because the custom chart is limited to five items, also sometimes commenting out any log.info lines. Then find handle_data if it exists and replace just that def line with all of the code above. You get the idea. The call to pvr() can be anywhere in handle_data as long as it isn&#39;t after any return. so it might as well be the first line, doesn&#39;t hurt. Back to the backtester, ctrl-v to paste and ctrl-b to run it. Sometimes that whole trip might take just 15 seconds I think.</p>

<p><strong>What it means</strong>  Mainly, the first value like PvR 0.1230 %/day is a good gage of code merit, it neutralizes the differing amounts of calendar time in backtests (although I&#39;m starting to warm up to CAGR added recently even though I don&#39;t understand it yet). I pay a lot of attention to Cash Low (CshLw) because the closer it is to zero the more accurate the UI metrics are, like Sharpe. And also Returns of course.</p>

<p><strong>Some routes/suggestions/ideas for keeping track of info</strong></p>

<ul>
<li>At the end of the run, copy the last set of PvR info in from logging window along with run time (plus the line with start/stop dates, capital, and today&#39;s calendar date/time) to the top of the algo using three comment markers like this:</li>
</ul>

<pre><code>&#39;&#39;&#39;
2017-02-21 13:00 _pvr:209 INFO PvR 0.7512 %/day   cagr 0.5   Portfolio value 13315297   PnL 12315297  
2017-02-21 13:00 _pvr:210 INFO   Profited 12315297 on 1062492 activated/transacted for PvR of 1159.1%  
2017-02-21 13:00 _pvr:211 INFO   QRet 1231.53 PvR 1159.10 CshLw -62492 MxLv 1.01 RskHi 1062492 MxShrt 0  
2017-02-21 13:00 pvr:299 INFO 2011-01-04 to 2017-02-21  $1000000  2017-02-24 21:17 US/Eastern  
Runtime 0 hr 8.9 min  
&#39;&#39;&#39;
</code></pre>

<ul>
<li>If %/day looks high, copy its value to the backtest title. Later, when looking thru numerous backtests you can find those that did best using that.<br></li>
<li>Copy the originating URL from the forums to the top of the code.<br></li>
<li>If %/day is very high, copy the algo to an editor and save it locally to a folder designated solely for keeping those. Then you can sort them high to low. Mine range from .03 to .75 for other&#39;s code that I have saved. Then some of my own are above 2.0. I use PvR so I can see what&#39;s going on to wind up with better strategies. (Frankly, some that are best were discovered via mistakes I made and I&#39;m still scratching my head over some of them as to why they even work so well, their PvR is great so I have to accept that, I would still be lost without PvR, my Robinhood code is up over 100% in less than three months).<br></li>
<li>Also in the filename, you can copy metrics from the browser and run a macro on those, even including the paste and copy back to the clipboard (I use Notepad++), to wind up with a string like r1231.5 a0.42 b0.54 s1.35 d-33.7 for returns, alpha etc. So an entire filename might be:<br>
0.7512 r1231.5 a0.42 b0.54 s1.35 d-33.7.py<br>
That string can also go to the top of the backtest code and/or backtest title.<br></li>
<li>Above, that result of PvR 0.7512 %/day is from <a href="https://www.quantopian.com/posts/the-spy-who-loved-wvf-or-just-another-volatility-spy-strategy">SPY who loved WVF...</a>. Here are some others that were high among those I have saved and you can look these up (they are up to .34 %/day): &#39;worthy of Q fund?&#39;, &#39;etf market rotation strategy&#39;, &#39;How to Build a Pairs Trading Strategy on Quantopian&#39;, &#39;For Robinhood trading&#39;, &#39;minimum variance with constraint&#39;. I&#39;ve unfortunately lost track of some good code by others from not being disciplined enough to save them all locally.</li>
</ul>

<p>Those are some ideas with a little more overview on this tool. It&#39;s not just mine, make it your own. While maybe not perfect, I&#39;d be lost without PvR.</p>

<p>How about a toast. To your wealth!  :)  Use PvR to see clearly.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58b104ec6004fd6f503a14dc' id='58b104ec6004fd6f503a14dc'>
<a href='#58b104ec6004fd6f503a14dc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/584021399ec55c74bc000459'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5712961042cf9f1b2c6fc2acfa457340?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/584021399ec55c74bc000459'>Nelson TAI</a>
</div>
<a UTCms='1487996140000' class='quanto-date posted-at response-posted-at' href='#58b104ec6004fd6f503a14dc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Sorry,still confused for PvR values.</p>

<p>Could summarize clear simple  guidelines how to choose backtest strategy through PvR output, would be appreciated.!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58ecb5eace871d25fafc1edc' id='58ecb5eace871d25fafc1edc'>
<a href='#58ecb5eace871d25fafc1edc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/57a5e2d0bb26a6a19a0002a6'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6c7f590915b50e8f69af885a4509f3b5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/57a5e2d0bb26a6a19a0002a6'>Roberto M</a>
</div>
<a UTCms='1491908074000' class='quanto-date posted-at response-posted-at' href='#58ecb5eace871d25fafc1edc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Blue,</p>

<p>Do we need to adjust something when the algo does short only. It looks like the pvr code is not proving the right metrics. Can you please shed some light? </p>

<p>Here is the result:<br>
    2017-04-06 22:00 _pvr:120 INFO PvR 0.0000 %/day   cagr 0.5   Portfolio value 40797   PnL 30797<br>
    2017-04-06 22:00 _pvr:121 INFO   Profited 30797 on 0 activated/transacted for PvR of 0.0%<br>
    2017-04-06 22:00 _pvr:122 INFO   QRet 307.97 PvR 0.00 CshLw 10000 MxLv 1.41 RskHi 0 MxShrt -41912<br>
    2017-04-06 22:00 pvr:208 INFO 2014-01-02 to 2017-04-06  $10000  2017-04-11 06:20 US/Eastern</p>

<p>Thanks!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58ed125203bcc2001001f93f' id='58ed125203bcc2001001f93f'>
<a href='#58ed125203bcc2001001f93f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1491931730000' class='quanto-date posted-at response-posted-at' href='#58ed125203bcc2001001f93f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks for catching that bug. Since shorts are a negative value, this line should have had the minus sign:</p>

<pre><code>risk         = int(max(cash_dip, -shorts))  
</code></pre>

<p>The latest version had that fix, updated now in the message above with the full code (Jan 14), quite a few changes for speed.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='598753b5b64d4500103f76ce' id='598753b5b64d4500103f76ce'>
<a href='#598753b5b64d4500103f76ce'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/592f5aac4507f31507050c9c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/df02766a7d3d1d2642373280b47bb53a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/592f5aac4507f31507050c9c'>Damon Anderson</a>
</div>
<a UTCms='1502041013000' class='quanto-date posted-at response-posted-at' href='#598753b5b64d4500103f76ce'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>For the starting post, you wrote &quot;For best speed, replace c. with context. and remove c = context&quot; in regards to the minimal pvr code.<br>
Should I do the same for the full code from your post on 1/14/16?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='598791765ddd960010e74bdd' id='598791765ddd960010e74bdd'>
<a href='#598791765ddd960010e74bdd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1502056822000' class='quanto-date posted-at response-posted-at' href='#598791765ddd960010e74bdd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Yep. Meanwhile to find out for sure how much difference in speed, could use this: <a href="https://www.quantopian.com/posts/timing-code">https://www.quantopian.com/posts/timing-code</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='59923d90dd67d1000d48aa9d' id='59923d90dd67d1000d48aa9d'>
<a href='#59923d90dd67d1000d48aa9d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1502756240000' class='quanto-date posted-at response-posted-at' href='#59923d90dd67d1000d48aa9d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>This could use an upgrade regarding short risk.</p>

<p>Overview: The main benefit of this pvr tool may be freedom for making changes during development to neutralize both cash usage and changes in shorting (the other risk), so up or down returns from a change in pipeline factors or ordering or whatever can be compared with certainty even when risk is not the same.</p>

<p>Rationale: Calculates a profit per dollar on the maximum risk, as both cash dip (including into margin) and max short value. An investor wants to know output vs input. The input is termed &quot;risk&quot; here. An assumption is made that quants will write code to use 100% of the initial capital but the reality of software development is, that&#39;s a lot more easily said than done, it&#39;s impossible to maintain always, and the process of getting to that goal can be messy. For example, add limit orders and suddenly your perfect 1.0 leverage is down to .62 max and avg .41. This pvr metric means leverage changes like that are also not such an immediate worry.</p>

<p><strong>The upgrade needed</strong>: Uses short value at 100% of the shares value and could be punishing shorting too much, I understand that shorting can be done at 4x longs plus cash. A short margin call would only happen if the original short value falls below that. Both are changing of course. Shorting at 3x means wiggle-room. Higher long value allows for a greater short value dip and visa-versa. If someone who knows shorting well could be inclined to roll up their sleeves and write some code to handle shorting risk better, please do, I would send a limousine and helicopter at your disposal if I could. </p>

<p><em>If you want to tackle this, rather than online back and forth in rather tough task, ping me here, antispam, gmail and take the space out of this user, gary hawk, that&#39;s it.</em>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a54aa6cc96867546eda1696' id='5a54aa6cc96867546eda1696'>
<a href='#5a54aa6cc96867546eda1696'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ae5cbbbbbc731b780000b8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0eccafa1826a9cefa1476f2074ff3300?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ae5cbbbbbc731b780000b8'>Michele Vianello</a>
</div>
<a UTCms='1515498092000' class='quanto-date posted-at response-posted-at' href='#5a54aa6cc96867546eda1696'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I wonder if PvR is (simplifying) the Return/(abs(Max-Min) $ range invested) where Max-Min are the highest peaks (positive and negative) on the whole algo time period. Right?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a54c4edc968673054da18c9' id='5a54c4edc968673054da18c9'>
<a href='#5a54c4edc968673054da18c9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1515504877000' class='quanto-date posted-at response-posted-at' href='#5a54c4edc968673054da18c9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ideally from the investment standpoint, how much of my money is risked. The question: What constitutes risk? It&#39;s a discussion worth having. The Jan 14, 2016 version matters most. This line maybe could be improved.</p>

<pre><code>risk       = int(max(cash_dip, -shorts))  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a551797c23fea1d0890b7b9' id='5a551797c23fea1d0890b7b9'>
<a href='#5a551797c23fea1d0890b7b9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ae5cbbbbbc731b780000b8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0eccafa1826a9cefa1476f2074ff3300?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ae5cbbbbbc731b780000b8'>Michele Vianello</a>
</div>
<a UTCms='1515526039000' class='quanto-date posted-at response-posted-at' href='#5a551797c23fea1d0890b7b9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>In the beginning of this post you note the limit of the Qreturn:<br>
&quot;The returns calculation employs a philosophy that all of your starting capital is at risk as soon as you open the account..It calculates returns based on starting capital regardless of how much you actually activated...&quot;    I totally agree with you.</p>

<p>But I have a similar doubt about PvR, but I&#39;m not a programmer then please apologize if I&#39;m wrong..</p>

<p>Just imagine to run a 10 years algo (252 x 10 days) wich invest only 10% of the starting capital for 2519 days (with great return) and 200% for 1 day only (cause to a bug, not expected behaviour,  or some dirty data). The Pvr value will be orrible and you will discard the algo...doing a mistake..</p>

<p>I&#39;m wrong?</p>

<p>Thanks for your time and for your routine wich is very preciuos to me!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a55812de7768c7b0a102a02' id='5a55812de7768c7b0a102a02'>
<a href='#5a55812de7768c7b0a102a02'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1515553069000' class='quanto-date posted-at response-posted-at' href='#5a55812de7768c7b0a102a02'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Right, and I&#39;ve seen those scenarios too, although instead of discarding the algo I&#39;d say it could just make the margin problem visible in the custom chart to be able to address it. PvRp (proportional) above was for that type of thing, maybe take a look and you might find a way to modify and use it, but I discontinued using that myself. What I was focused on at the time was margin early on that could be like 200% of the portfolio and yet not much compared to the ending value with a lot of gain over time, to avoid a harsh penalty from early margin.</p>

<p>In the contest and fund with recent leverage limits near 1, the Quantopian returns and PvR are always closer to each other now versus the once-upon-a-time idea floated of maybe up to 6x leverage applied to fund algos, This profit per dollar risked value was a bit more of thing back then because by neutralizing margin it could for example make it clear that a 1.1x algo was actually better value even if a 6x <em>appeared</em> to be, providing the apples-to-apples comparison. (Then there&#39;s leverage from shorting of course, all a rather complex picture).</p>

<p><em>Toward the investor two most basic concerns: How much in, how much out.</em></p>

<p>On what constitutes risk, with margin and shorting the brokerage has certain requirements. For improvements I&#39;d have to invite those with experience in them including <em>maintenance</em> margin requirements. But just thinking out loud, is risk simply abs(short_value) + long_value, the leverage equation numerator? Maybe try this ...</p>

<pre><code>    shorts = sum([z.amount * z.last_sale_price for s, z in pf.positions.items() if z.amount &lt; 0])  
    longs  = sum([z.amount * z.last_sale_price for s, z in pf.positions.items() if z.amount &gt; 0])  
    risk   = abs(shorts) + longs       # from this current risk, max risk is then used, for profit per max risk  
</code></pre>

<p>If I could wave a magic wand I&#39;d apply this on the top ~50 of each past contest, in place of returns as the basis for metrics calculations, hence scoring, and different algos would rise to the top. Then see if it is a better or worse evaluator/predictor using out-of-sample. Would the winners using this have performed better? Surely a test worth considering.</p>

<p>Glad you find this useful. I feel lost without it. :/</p>

<p>Here&#39;s a version that separates out the charting, scheduled to end of day aiming for efficiency. And uses <code>abs(shorts) + longs</code>. Lv is set to 1.2.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a55db9f0f3d7a00165bf097' id='5a55db9f0f3d7a00165bf097'>
<a href='#5a55db9f0f3d7a00165bf097'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ae5cbbbbbc731b780000b8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0eccafa1826a9cefa1476f2074ff3300?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ae5cbbbbbc731b780000b8'>Michele Vianello</a>
</div>
<a UTCms='1515576223000' class='quanto-date posted-at response-posted-at' href='#5a55db9f0f3d7a00165bf097'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Blue!! Is Always very interesting to read your posts!</p>

<p>On my view are necessay different parameters to evaluate an algo but, some are MORE important then others:</p>

<p>Just imagine an algo wich invest all the starting capital just one day a month; and the Alpha extract is less then another algo wich is all days invested. All the backtest parameters in Q tell me that the second one is better the first one. But on my opinion is NOT.</p>

<p>again following the example of my previous post</p>

<p>Just imagine to sum  the 10% of starting capital spended each of the 2519 days + the 200% of 1 only day (of starting capital), and to divide that sum by 2520 (days we are invested): now we have a &quot;correct&quot; weight of the $ amount invested (in daily frame).  Now we can compare that value with the algo Return. Thats the way I usually do.</p>

<p>Honestly I do that calculation in a approximativy and intuitivly way, I&#39;m not a programmer, just &quot;lucky&quot; hobbist not &quot;yet&quot; able to modify your routine..  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5b61cb4a5442541a7c2a17d5' id='5b61cb4a5442541a7c2a17d5'>
<a href='#5b61cb4a5442541a7c2a17d5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/592daa96cc2622000d5c839c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8b2c58f39b90de3d2c245edf936a90f5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/592daa96cc2622000d5c839c'>Daniel Cascio (Blue Robin)</a>
</div>
<a UTCms='1533135690000' class='quanto-date posted-at response-posted-at' href='#5b61cb4a5442541a7c2a17d5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Blue,</p>

<p>Really appreciate all of your efforts with the sample coding. I tried to implement the short hand PVR code snipet you&#39;ve provided above. Can you please provide some color as to how I can interpret my results?</p>

<p>BackTest run: 6/30/2018 - 7/30/2018   $10,000,000 Initial Capital</p>

<p>As of 7.30.2018<br>
Lv = 1.03<br>
MxLV = 1.10<br>
PvRAvg = 15.66<br>
PvR = 27.52</p>

<p>Thank you.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5b62283b3061230049baa0a6' id='5b62283b3061230049baa0a6'>
<a href='#5b62283b3061230049baa0a6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1533159483000' class='quanto-date posted-at response-posted-at' href='#5b62283b3061230049baa0a6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Lv -- leverage at the end of each day in the custom chart (keep in mind that record is daily resolution)<br>
MxLv -- the maximum leverage ever seen in the backtest (keeps track by watching every minute all throughout).<br>
PvRAvg -- Average PvR throughout the run, intended to be used for comparing algorithms to each other. Added as an afterthought and I don&#39;t use that very often.<br>
PvR -- Profit vs Risk says: If the initial capital had been all invested <strong>without going over</strong>, the returns would be this value. So, if only half of the initial capital is invested, PvR will be two times the value seen in the chart for Returns. Inversely, if initial capital is $100 but $200 is put at risk (as margin and/or excess shorting), since it went beyond the original $100, PvR will be just half of the Returns value shown.</p>

<p>It&#39;s a way to keep track of actual profitability. If one were to start with $10 and buy a share of SPY every day, that would show fantastic returns but would be due to margin. PvR would show returns as if that margin had not happened (if starting capital matched the amount actually utilized). Makes cloning/evaluating algos a snap with no need to manually adjust for unused cash or margin or shorting spikes.</p>

<p>I like the percent per day value, see PvR 0.7512 %/day above from the end of the run. It could also be charted. No matter how long various backtests run, they can be saved locally copying that number for the first thing in file names and then sorting later to find algos run previously that did best. Can use an abbreviation for pvr percent per day like pd0.7512_and_the_rest_of_the_filename.py Some of mine from the past (except a more disciplined consistency in filenames would be recommendable):</p>

<pre><code>ppd0.5587.py  
ppd1.1018 p555 2 yr ver 3 liq work dump worst.py  
ppd1.6888 p851 ver 3 liq work etc.py  
ppd2.3997 the 44 million.py  
ppd3.0550.py  
</code></pre>

<p>Or drop the ppd and start the filenames with just the numbers. A filename can be constructed automatically for copy/paste from the end of the run with a little work. I use some code like that in a tool more extensive.<br>
<code>0.0688_p41_q19_b0.18_d6_2015-01-05_to_2017-05-22_10M.py</code><br>
p41 is PvR. Since it is higher than the Q returns q19, that indicates not all of this 10M context.portfolio.starting_cash was invested.<br>
Beta b0.18 and Drawdown d6 (percent)  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/pvr-profit-vs-risk'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/pvr-profit-vs-risk'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#2c4a4949484e4d4f476c5d594d4258435c454d42024f4341">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
Request for Feedback - Portfolio Optimization API
</title>
<meta content='Suppose you&#39;ve written an algorithm that&#39;s developed a signal (for example, a  Pipeline Factor ) that&#39;s predictive of forward returns over some time horizon. You might think that the hard is over, but you&#39;re still left with the daunting task of translating your signal into an algorithm that can turn a profit while also managing risk exposures. Traditionally in quantitative finance, the solution to the problem of maximizing returns while constraining risk has been to employ some form of ...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="xRMCcn+AGG6BBrIye08wwxqRRqw+F+o2FW/hW65HPNy5dXQ/3XbKjTgb6wM0oJi3Ih9lxUTb/y2XYDoxBAJeZw==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/request-for-feedback-portfolio-optimization-api' property='og:url'>
<meta content='Request for Feedback - Portfolio Optimization API' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/request-for-feedback-portfolio-optimization-api' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='Request for Feedback - Portfolio Optimization API' property='og:title'>
<meta content='Suppose you&#39;ve written an algorithm that&#39;s developed a signal (for example, a  Pipeline Factor ) that&#39;s predictive of forward returns over some time horizon. You might think that the hard is over, but you&#39;re still left with the daunting task of translating your signal into an algorithm that can turn a profit while also managing risk exposures. Traditionally in quantitative finance, the solution to the problem of maximizing returns while constraining risk has been to employ some form of ...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/request-for-feedback-portfolio-optimization-api">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='57fff3573499ad8574000098'>
<div class='post-container' data-post-id='57fff3573499ad8574000098' id='57fff3573499ad8574000098'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>Request for Feedback - Portfolio Optimization API</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<span class='posted-at'>edited </span>
<span UTCms='1476396949000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=Request for Feedback - Portfolio Optimization API&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Frequest-for-feedback-portfolio-optimization-api%3Futm_source%3Dwebsite_share%26utm_campaign%3Drequest-for-feedback-portfolio-optimization-api%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Frequest-for-feedback-portfolio-optimization-api%3Futm_source%3Dwebsite_share%26utm_campaign%3Drequest-for-feedback-portfolio-optimization-api%26utm_medium%3Dlinkedin&amp;title=Request+for+Feedback+-+Portfolio+Optimization+API+%28Scott+Sanderson%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class='tags tag-row'>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='API' data-tag-id='55c50e7d8d4710ec6e000001' href='/posts/tag/API/newest'>API</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Finance Theory' data-tag-id='55c50e7d8d4710ec6e000002' href='/posts/tag/Finance-Theory/newest'>Finance Theory</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Pairs Trading' data-tag-id='55c50e7d8d4710ec6e000009' href='/posts/tag/Pairs-Trading/newest'>Pairs Trading</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Research' data-tag-id='55c50e7d8d4710ec6e000018' href='/posts/tag/Research/newest'>Research</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Portfolio Optimization' data-tag-id='55d33f293f6ba10061000000' href='/posts/tag/Portfolio-Optimization/newest'>Portfolio Optimization</a>
</div>
<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/request-for-feedback-portfolio-optimization-api?utm_source=website_share&amp;utm_campaign=request-for-feedback-portfolio-optimization-api&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Scott Sanderson" />
<div class='body-text'>
<div class='body-text-container post-body'><p>Suppose you&#39;ve written an algorithm that&#39;s developed a signal (for example, a <a href="https://www.quantopian.com/tutorials/pipeline#lesson3">Pipeline Factor</a>) that&#39;s predictive of forward returns over some time horizon. You might think that the hard is over, but you&#39;re still left with the daunting task of translating your signal into an algorithm that can turn a profit while also managing risk exposures.</p>

<p>Traditionally in quantitative finance, the solution to the problem of maximizing returns while constraining risk has been to employ some form of <a href="https://en.wikipedia.org/wiki/Portfolio_optimization">Portfolio Optimization</a>, but performing sophisticated optimizations is challenging on today&#39;s Quantopian.</p>

<p>Python libraries like <a href="http://docs.scipy.org/doc/scipy/reference/optimize.html">scipy.optimize</a>, <a href="http://cvxopt.org/">CVXOPT</a>, and <a href="http://www.cvxpy.org/en/latest/">CVXPY</a> (all available on Quantopian today) provide generic tools for solving optimization problems. These libraries are powerful and flexible, but it takes significant expertise to convert the data structures available on Quantopian into the specific formats understood by these libraries. </p>

<p>Algorithm authors who want to perform even simple optimizations spend much of their time to figuring out how to encode conceptually simple ideas like &quot;constrain gross leverage&quot; into complicated matrices that are hard to interpret and hard to debug when something goes wrong.</p>

<p>The open source Python ecosystem already provides excellent implementations of the algorithms needed to implement a quality portfolio optimization library. What&#39;s missing is an interface that maps domain concepts from finance onto the low-level primitives exposed by existing libraries.</p>

<p>Today we&#39;re announcing <strong><code>quantopian.experimental.optimize</code></strong>, a suite of new tools designed to make portfolio optimization on Quantopian more accessible to algorithm authors. As the name suggests, all the functions and classes currently available are <strong>experimental</strong> and should be considered subject to change at any time.  We are releasing these APIs early in the development cycle so that we can gather feedback about how to make them as useful as possible to the community when the time comes for a stable release.</p>

<p>The <code>optimize</code> module has three major components in this release:</p>

<ul>
<li><code>calculate_optimal_portfolio</code>, a top-level entrypoint.<br></li>
<li><code>Objective</code> classes, representing functions to be minimized or maximized by the optimizer.<br></li>
<li><code>Constraint</code> classes, representing constraints to be enforced by the optimizer.</li>
</ul>

<p>To run a portfolio optimization, you call <code>calculate_optimal_portfolio</code> and provide three values: </p>

<ul>
<li>An <code>Objective</code> to optimize.<br></li>
<li>A list of <code>Constraints</code> to enforce.<br></li>
<li>A <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.html">pandas Series</a> containing weights for the current portfolio. The index of the current portfolio series defines the assets that are allowed in the target portfolio.</li>
</ul>

<p>The attached notebook provides a detailed walkthrough of the new API.  There&#39;s still a lot of work to do and many questions to answer before we move beyond experimental status.  With help from the Quantopian community, we hope to answer these questions in the coming weeks. I&#39;m excited about the opportunities that optimization creates for algorithm authors, and I look forward to hearing feedback and to seeing what the community builds with these tools.  <strong>The optimization API is only available in notebooks for this release.</strong>  Work is currently ongoing to make optimization available in the backtester.  See the <strong>Next Steps</strong> section at the bottom of this notebook for more details.</p>

<p>Happy Optimizing!  </p>
</div>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>19 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='58000e70377ff31d540002d3' id='58000e70377ff31d540002d3'>
<a href='#58000e70377ff31d540002d3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1476398710000' class='quanto-date posted-at response-posted-at' href='#58000e70377ff31d540002d3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Scott -</p>

<p>Just a brief note that one way to approach this is to minimize the difference between the old and new portfolio subject to constraints.  For example, your objective function would be the Euclidean distance squared between the old and new portfolio vectors, and the optimization would find the new portfolio, constrained by a minimum forecast profit.  It may not be quite the same to maximize the profit, subject to a maximum turnover.  If you can actually achieve the minimum forecast profit, then the turnover will be worth it, otherwise do nothing.  Having a hard limit on turnover might not make sense, but I&#39;m no expert, for sure.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='580047143499adb3b9000746' id='580047143499adb3b9000746'>
<a href='#580047143499adb3b9000746'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5732b95f7f8f62bcf40006a7'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/cb9d159b44f16e656766d61c2b62fcbe?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5732b95f7f8f62bcf40006a7'>Ryan Davis</a>
</div>
<a UTCms='1476413211000' class='quanto-date posted-at response-posted-at' href='#580047143499adb3b9000746'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Scott - great work on this module! It looks to be general enough to accommodate a large number of use cases. A few suggestions on how you would continue to move in forward:</p>

<p>1) Your example uses a an objective with only alpha / expected return. One could also include a covariance term and a transaction cost term. Ron Kahn&#39;s book (<a href="https://www.amazon.com/Active-Portfolio-Management-Quantitative-Controlling/dp/0070248826">https://www.amazon.com/Active-Portfolio-Management-Quantitative-Controlling/dp/0070248826</a>) includes some basic models on estimating transaction costs using volume and volatility, and there are other more involved models. Maybe the most important thing to keep in mind with the covariance is that the matrix is not ill-conditioned, which can happen with large numbers of assets, and estimation errors will propagate throughout the optimization.</p>

<p>2) Constrain exposures to factors in addition to sectors. While one may not want to have too much exposure to a given sector, one may also want to hedge out exposures to common risk factors (market, value, size, momentum, liquidity) so that the resulting portfolio is loading only on the &quot;alpha.&quot; </p>

<p>3) Does the optimization engine work on non-convex problems? CVXOPT and CVXPY are great for convex problems, and scipy.optimize.minimize can work on non-convex problems. Does the module recognize automatically if the problem is convex?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5800a2c83d78001714000483' id='5800a2c83d78001714000483'>
<a href='#5800a2c83d78001714000483'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1476436687000' class='quanto-date posted-at response-posted-at' href='#5800a2c83d78001714000483'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>It seems that 
<code>MaxGrossLeverage</code> should be an equality constraint, but you imply it is an inequality.  Don&#39;t we really want the gross leverage to be equal to 1.0, versus in the range -Inf to 1.0, inclusive?</p>

<p>Regarding <code>PositionConcentration</code> is this really a constraint in the optimization, or bounds?  I think there is a distinction between adding a set of inequality constraints, and limiting the search space (bounds).  Are you adding constraints, or limiting the search space?</p>

<p>Is the idea that this would be run within the 5 minutes  of <code>before_trading_start</code>?  Or within the 50 seconds of <code>handle_data</code> or a scheduled function?  Or something else?  One problem I see is that the optimization needs to be time-bound.  If a solution is not found within a time frame, then a flag needs to be returned so that the algo decide what to do.</p>

<blockquote>
<p>Python libraries like scipy.optimize, CVXOPT, and CVXPY (all available on Quantopian today) provide generic tools for solving optimization problems.</p>
</blockquote>

<p>I didn&#39;t realize that CVXPY is now available.  It has been in the queue for awhile now ( <a href="https://www.quantopian.com/posts/request-for-cvxpy-in-quantopian">https://www.quantopian.com/posts/request-for-cvxpy-in-quantopian</a> ).  Is it now working in research &amp; the backtester?</p>

<p>Also, there was an open issue with CVXOPT ( <a href="https://www.quantopian.com/posts/help-w-slash-cvxopt">https://www.quantopian.com/posts/help-w-slash-cvxopt</a> )?  Did it get addressed?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5800b24e027294cc68000666' id='5800b24e027294cc68000666'>
<a href='#5800b24e027294cc68000666'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1476440662000' class='quanto-date posted-at response-posted-at' href='#5800b24e027294cc68000666'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>You might elaborate on how the portfolio turnover constraint/minimization would account for changes in the universe?  I can see how things might work for a fixed set of stocks (an incremental rotation of the portfolio vector in its N-dimensional space), but if you are doing adds/drops, it is not so clear.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58010468027294cc68000bcf' id='58010468027294cc68000bcf'>
<a href='#58010468027294cc68000bcf'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1476461682000' class='quanto-date posted-at response-posted-at' href='#58010468027294cc68000bcf'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ryan - </p>

<blockquote>
<p>Your example uses an objective with only alpha / expected return. One could also include a covariance term and a transaction cost term. </p>
</blockquote>

<p>Yep, totally agree!  I tried to keep the examples/implementations simple for the first cut, but both of these additions are in the roadmap.  There are a couple ways I could see these playing out, API-wise:</p>

<ol>
<li><code>MaximizeAlpha</code> gains some new arguments (e.g. <code>covariance_matrix</code>, and <code>risk_aversion</code>), and uses them to build a more complex objective internally.  The major cost here is that <code>MaximizeAlpha</code>&#39;s signature ends up pretty bloated and will be harder to understand for newcomers.<br></li>
<li>We keep the existing simple <code>MaximizeAlpha</code> and add more complex objectives like <code>MaximizeRiskAdjustedAlphaMinusTransactionCost</code>.  The benefit here would be that only users who want the additional complexity are forced to deal with it.  The cost is that the more complex version&#39;s name is a mouthful, and it&#39;s still intimidating for users looking to move from a simpler model to a more complex one.<br></li>
<li>We add a new kind of expression, <code>Penalty</code>, to go along with <code>Constraint</code> and <code>Objective</code>.  This has the benefit of modularizing the independent components of the optimization function, but has the cost that it&#39;s less clear which penalties are appropriate for which objectives.  Minimizing expected covariance, for example, doesn&#39;t really make sense when using <code>TargetPortfolio</code> as an objective.</li>
</ol>

<blockquote>
<p>Constrain exposures to factors in addition to sectors.</p>
</blockquote>

<p>I think you can do that today with the <code>WeightedExposure</code> constraint, which takes an <code>assets x labels</code> DataFrame of weighting coefficients and min/max exposure vectors for each label.  I left <code>WeightedExposure</code> out of the examples because it&#39;s hard to motivate in a short paragraph, but I probably should have at least added a mention somewhere.</p>

<blockquote>
<p>Does the optimization engine work on non-convex problems?</p>
</blockquote>

<p>It only works on convex problems. <code>Constraints</code> and <code>Objectives</code> are essentially factories for <code>CVXPY</code> expressions that handle input validation and data alignment.  We&#39;re mostly deferring to CVXPY (and by extension, CVXOPT, ECOS, and other solvers) for the heavy lifting here.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='58010d0d377ff3b5100013fe' id='58010d0d377ff3b5100013fe'>
<a href='#58010d0d377ff3b5100013fe'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1476463891000' class='quanto-date posted-at response-posted-at' href='#58010d0d377ff3b5100013fe'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant - </p>

<blockquote>
<p>one way to approach this is to minimize the difference between the old and new portfolio subject to constraints.</p>
</blockquote>

<p>I think this is precisely the behavior of the <code>TargetPortfolio</code> objective I outline in the second notebook example.  Am I missing something?  Regarding your point of trying to do the optimization and failing if we can&#39;t achieve a target return, assuming we had something like a <code>MinimumReturn</code> constraint, you could do something like:</p>

<pre><code>objective = TargetPortfolio(...)  
constraints = [MinimumReturn(expected_returns, MINIMUM)]  
try:  
    calculate_optimal_weights(objective, constraints, current_portfolio)  
except opt.InfeasibleConstraints:  
    pass # Couldn&#39;t improve expected return enough to be worthwhile.  
</code></pre>

<p>In practice, I think people tend to handle this problem by applying a transaction cost penalty, or by simply ignoring the results of the optimization if they don&#39;t change your expected return enough to be worthwhile.</p>

<blockquote>
<p>It seems that MaxGrossLeverage should be an equality constraint, but you imply it is an inequality.  Don&#39;t we really want the gross leverage to be equal to 1.0, versus in the range -Inf to 1.0, inclusive?</p>
</blockquote>

<p>Gross leverage is the sum of the absolute values of your positions, so it&#39;s greater than or equal to 0 by definition.  <code>MaxGrossLeverage(1.0)</code> constrains gross leverage to be less than or equal to 1.0, inclusive, which means that the sum of the magnitudes of our longs and shorts has to be less than or equal to the liquidation value of our portfolio.  This prevents me, for example, from going long 10 million dollars in stock X and short 10 million dollars in stock Y unless I have a capital base of at least 20 million, but it doesn&#39;t by itself prevent me from having an empty portfolio.  Objectives like <code>MaximizeAlpha</code>, however, will naturally push position weights up until they run into constraints.  If you&#39;re using MaximizeAlpha with <code>MaxGrossLeverage</code>, you&#39;ll likely end up with a leverage equal to your max unless you have other constraints that prevent that from happening.</p>

<blockquote>
<p>I think there is a distinction between adding a set of inequality constraints, and limiting the search space (bounds).</p>
</blockquote>

<p>Supplying an inequality (or equality) constraint in this context is the same as limiting the search space in this context.  </p>

<p>One good way to build intuition for how this style of optimization is to take a geometric perspective on the problem.  The variable under optimization is a length-N vector of stock weights, so we can imagine our optimization problem as a search in N-dimensional space.  The objective defines a potential function on our space that we either want to minimize or maximize, and the constraints describe a region of space that we&#39;ll allow as valid solutions.  Mathematically, individual constraints are expressed as vector inequalities in N-space.  Geometrically, solutions to those inequalities describe regions of N-space, and applying multiple constraints corresponds to taking intersections of those regions.  Specifically, for the class of constraints supported here, the regions of space are required to be convex, which means they look like planes, paraboloids, ellipsoids, or similar nicely-behaved surfaces.  <a href="https://en.wikipedia.org/wiki/Convex_optimization">Constraining ourselves to convex regions</a> makes the problem of computing solutions considerably more tractable.</p>

<blockquote>
<p>Or within the 50 seconds of handle_data or a scheduled function?</p>
</blockquote>

<p>Likely within the 50 seconds.  So far I haven&#39;t run any realistic optimizations that have taken longer than 30 seconds or so on a reasonably-powerful laptop.</p>

<blockquote>
<p>I didn&#39;t realize that CVXPY is now available.  Is it now working in research &amp; the backtester?</p>
</blockquote>

<p>Yep.  It was whitelisted as part of this work.  I may make a separate announcement post at some point.</p>

<blockquote>
<p>Also, there was an open issue with CVXOPT</p>
</blockquote>

<p>Your CVXOPT example looks like it works now for me.  I&#39;m not sure when that was fixed.  My guess would be that it was fixed during the Q2 refactor.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5801fb028d38740a61000299' id='5801fb028d38740a61000299'>
<a href='#5801fb028d38740a61000299'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1476524807000' class='quanto-date posted-at response-posted-at' href='#5801fb028d38740a61000299'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Scott -</p>

<p>Yes, I see now that the 
<code>TargetPortfolio</code> objective is the Euclidean distance.  Doesn&#39;t it need to be the square of the Euclidean distance for the problem to be convex?</p>

<p>Section 4.2 of this paper discusses a relevant optimization problem:</p>

<p><a href="http://icml.cc/2012/papers/168.pdf">http://icml.cc/2012/papers/168.pdf</a></p>

<p>The forecast return is expressed as an inequality constraint.  If it is not met, then there is no update to the portfolio.  Rather than <code>try-except</code>,  you probably need a success-fail flag (such <code>res</code> in <a href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html">scipy.optimize.minimize</a>).</p>

<p>Regarding <code>MaxGrossLeverage(1.0)</code>, it seems like there might also be a use case of <code>GrossLeverage(1.0)</code> where my constraint is to be 100% in the market at all times.</p>

<p>How does this optimization suite handle changes in the portfolio vector, when comparing old to new?  For example, the <code>TargetPortfolio</code> objective (I think) requires that the two portfolio vectors be the same length and correspond to the same stocks.  Similar considerations apply when limiting turnover.  There needs to be a provision in the optimization to handle stock add/drop events, right?</p>

<p>I suggest supporting implementation both in <code>before_trading_start</code> and <code>handle_data</code> and scheduled functions.  If you look in the paper I reference above, Section 4.3, the author describes a technique for averaging over an expanding look-back window.  It amounts to running the optimization over each window to achieve a smoothing/averaging effect of the portfolio vector versus time.  So, your 30 seconds would be multiplied times ~ N/2, the number of look-back windows.   So, for N = 20, it&#39;ll take 5 minutes.  Of course, it&#39;d be nice to do this sort of thing with parallel processing, but we ain&#39;t there yet, I gather. </p>

<blockquote>
<p>So far I haven&#39;t run any realistic optimizations that have taken longer than 30 seconds or so on a reasonably-powerful laptop.</p>
</blockquote>

<p>How is your laptop performance relevant?  Aren&#39;t you doing this work on the Q research platform?</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='580207c0b7135d48510006f7' id='580207c0b7135d48510006f7'>
<a href='#580207c0b7135d48510006f7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1476528071000' class='quanto-date posted-at response-posted-at' href='#580207c0b7135d48510006f7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Scott -</p>

<p>Regarding when to run the optimization, if I follow your overall workflow concept, the time scale for the alphas would be daily/weekly/monthly/quarterly (both because pipeline only supports daily OHLCV bars for computing returns, and because fundamentals (and most other data sets?) are on relatively long time scales).  So, running the optimization within the trading day doesn&#39;t really make sense in my mind.  We aren&#39;t looking to do minute-by-minute, or even day-by-day trading, in most cases.  There is no advantage in doing optimizations during the trading day, particularly if they are time-bound to 50 seconds.  The same would apply to alpha combination (ML or whatever), which is another kind of optimization step, prior to your portfolio optimization.</p>

<p>For the Q fund, it would seem that you just need a set of buy/sell signals before the market open, and then you can sort out how to execute the combined signals over the trading day in an optimal way.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5806518980383b6538000223' id='5806518980383b6538000223'>
<a href='#5806518980383b6538000223'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1476809105000' class='quanto-date posted-at response-posted-at' href='#5806518980383b6538000223'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>Yes, I see now that the <code>TargetPortfolio</code> objective is the Euclidean distance. Doesn&#39;t it need to be the square of the Euclidean distance for the problem to be convex?</p>
</blockquote>

<p>The function &quot;Euclidean norm from a point X&quot; is convex without requiring any further transformation.  One way of thinking about this is to notice that inequality constraints against this function describe (hyper) spheres centered around X.  The <a href="http://www.cvxpy.org/en/latest/tutorial/functions/">CVXPY</a> docs provide an excellent taxonomy of functions commonly used in optimization and <a href="http://www.cvxpy.org/en/latest/tutorial/dcp/index.html#curvature">descriptions of what it means to be convex and concave</a></p>

<blockquote>
<p>How does this optimization suite handle changes in the portfolio vector, when comparing old to new? For example, the TargetPortfolio objective (I think) requires that the two portfolio vectors be the same length and correspond to the same stocks.</p>
</blockquote>

<p>The optimization uses the third argument (<code>current_portfolio</code>) to <code>calculate_target_weights</code> as its universe definition, expecting entries with weights of 0.0 for stocks not currently held but under consideration.  If a constraint/objective doesn&#39;t know about a stock in the portfolio vector, it generally does the most conservative thing possible w/r/t the unknown assets.  The exact behavior here depends on the particular constraint or objective.  <code>TargetPortfolio</code> and <code>MaximizeAlpha</code>, for example, assume that any stocks not provided should be given a target weight/expected return of 0.  <code>NetPartitionExposure</code> applies constraints forcing assets with unknown partition labels to have positions of size 0.<code>PositionConcentration</code> takes <code>default_min_weight</code> and <code>default_max_weight</code> arguments that are used when an unknown stock is encountered in the portfolio.</p>

<blockquote>
<p>Regarding when to run the optimization, if I follow your overall workflow concept, the time scale for the alphas would be daily/weekly/monthly/quarterly (both because pipeline only supports daily OHLCV bars for computing returns, and because fundamentals (and most other data sets?) are on relatively long time scales). So, running the optimization within the trading day doesn&#39;t really make sense in my mind. </p>
</blockquote>

<p>I think this is generally correct, though I could still imagine algorithms where a portion of your alpha or risk analysis depended on minute-scale pricing data.  In particular, I could imagine using minute-scale price data to build a covariance matrix, which is often an input term in more sophisticated optimizations.  Regardless, there will certainly be algorithms that only depend on daily-or-lower frequency data, and for those algorithms, optimizing in <code>before_trading_start</code> makes sense.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='580742fa4159c50c550003d4' id='580742fa4159c50c550003d4'>
<a href='#580742fa4159c50c550003d4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1476870914000' class='quanto-date posted-at response-posted-at' href='#580742fa4159c50c550003d4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Scott -</p>

<p>Regarding running the optimization within 
<code>before_trading_start</code>, one issue is that I don&#39;t think functions can be scheduled there, right?  This would be kind of inconvenient, since then one would either have to run the optimization every day, which may not be required, or kludge some sort of scheduling.  Other than not being able to submit orders and schedule functions, are there other limitations to <code>before_trading_start</code>?</p>

<blockquote>
<p>I could still imagine algorithms where a portion of your alpha or risk analysis depended on minute-scale pricing data</p>
</blockquote>

<p>Those data would be available via <code>history</code> in <code>before_trading_start</code>, correct?</p>

<p>A more general architectural question is how the output of the optimization will interface with the order/execution management system mentioned by Fawce on <a href="https://www.quantopian.com/posts/big-news-for-the-quantopian-community-managing-external-capital">https://www.quantopian.com/posts/big-news-for-the-quantopian-community-managing-external-capital</a> :</p>

<blockquote>
<p>The selected algorithms will connect to a prime broker through an order/execution management system (O/EMS) at Quantopian.</p>
</blockquote>

<p>I&#39;d think that unless an algo is justifiably relatively short-term intraday, it&#39;d be advantageous to have all of the allocations for the day ready before the market opens.  Otherwise, you&#39;ll have the orders hitting willy nilly throughout the day, and the O/EMS system won&#39;t be able to manage them as a whole on a daily basis (which would seem to be the relevant time scale).  It seems that you&#39;d want the orders to be queued and ready before the market opens, no?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='580cb7c98f66d22076000ce0' id='580cb7c98f66d22076000ce0'>
<a href='#580cb7c98f66d22076000ce0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1477228498000' class='quanto-date posted-at response-posted-at' href='#580cb7c98f66d22076000ce0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott -</p>

<p>One concept you might consider is that you are rotating the portfolio vector in its N-dimensional space.  For example, if N = 2, then I have r = (x,y), and if I require both long and short at equal weight, then I can have r = (1,-1)/sqrt(2) or r = (-1,1)/sqrt(2), so the only allowed angles of rotation are +/- pi.  When I make an allocation change, my portfolio vector sweeps out a semi-circle.  Analogously, for N &gt; 2, one could constrain the maximum angle step and the path.  For N = 3, one would rotate the vector along a great circle route, with each step no more than 
<code>delta_theta</code> radians (i.e. more than one trade may be required to complete the portfolio vector rotation).</p>

<p>For a large long-short portfolio, conceptually, I&#39;d think one would want certain characteristics of the portfolio vector path in the N-dimensional space.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58146b1c25b4817386000727' id='58146b1c25b4817386000727'>
<a href='#58146b1c25b4817386000727'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1477733153000' class='quanto-date posted-at response-posted-at' href='#58146b1c25b4817386000727'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott -</p>

<p>Is CVXPY now supported in the backtester?  Pravin is reporting he&#39;s getting an error (see <a href="https://www.quantopian.com/posts/anyone-successfully-used-cvxpy">https://www.quantopian.com/posts/anyone-successfully-used-cvxpy</a> ).  I&#39;d like to code an example algo and post it.</p>

<p>Thanks,</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5814890f9407cbeeae000863' id='5814890f9407cbeeae000863'>
<a href='#5814890f9407cbeeae000863'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1477740821000' class='quanto-date posted-at response-posted-at' href='#5814890f9407cbeeae000863'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Scott -</p>

<p>You may want to consider embedding some sort of expanding window/bootstrapping in the portfolio optimization toolkit.  Basically, to compute the new portfolio vector, you&#39;d run N optimizations, and average them (perhaps with weights).  The issue, as I understand it, is that a single optimization will tend to yield a portfolio vector that jerks around a lot.  The expanding window approach in the OLMAR paper may do the trick (which weights by the expected return for each window).  A potential modification would be to add a weight that favors shorter windows over longer ones.</p>

<p>Of course, users could do this jazz on their own, but it begs for parallelization, which you could prep for under the hood, if you include this approach in the toolkit.  Even if not done in parallel, you could probably do a better job of optimizing the code than users might.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='582eda6b52b6960012000896' id='582eda6b52b6960012000896'>
<a href='#582eda6b52b6960012000896'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1479465587000' class='quanto-date posted-at response-posted-at' href='#582eda6b52b6960012000896'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott -</p>

<p>A few more comments:</p>

<ol>
<li>If I understand correctly, the optimization would be based on a look-back of a single period.  Using the current portfolio weight vector, w(-1), a new portfolio weight vector, w(0), would be computed.  However, the optimization could incorporate a longer history of portfolio weight vectors, [w(-1), w(-2),...w(-N)].  So, in addition to getting the current portfolio state, w(-1), across the universe, you&#39;d have to store a portfolio history.  It seems like the history would be useful, for smoothing the trajectory of the portfolio.<br></li>
<li>If I&#39;m interpreting Thomas W.&#39;s <a href="https://www.quantopian.com/posts/machine-learning-on-quantopian-part-2-ml-as-a-factor#582d86441f6e8700120005a3">comments</a> correctly, the initial release of the workflow through the alpha combination step will be pipeline-based, using pipeline factors and daily bars.  Will the optimization be within pipeline, as well?  I&#39;m imagining that prior to the market open (e.g. in 
<code>before_trading_start</code>), the <a href="https://blog.quantopian.com/a-professional-quant-equity-workflow/">workflow</a> would run, with the exception of the <em>Execution</em> step.  So, before the market opens, the new portfolio weight vector, w(0), would be available.  Or do you see an advantage in running the optimization during the trading day?</li>
</ol>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5832f5928b5d4d0015000a47' id='5832f5928b5d4d0015000a47'>
<a href='#5832f5928b5d4d0015000a47'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f1edd0b03b228000d000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/81292895877c628963a3b56b408533e7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f1edd0b03b228000d000001'>Thomas Wiecki</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1479734681000' class='quanto-date posted-at response-posted-at' href='#5832f5928b5d4d0015000a47'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>When cloning and running the NB I get:  </p>

<pre><code>
---------------------------------------------------------------------------  
AttributeError                            Traceback (most recent call last)  
&lt;ipython-input-10-50a696070b13&gt; in &lt;module&gt;()  
----> 1 constrained_leverage_pf = optimal_portfolio_constrained_leverage_only()  
      2 draw_asset_barplot(constrained_leverage_pf, &#39;Optimal Portfolio (Constrained Leverage Only)&#39;);

&lt;ipython-input-9-b1d06a3b7b78&gt; in optimal_portfolio_constrained_leverage_only()  
      8     constraints = [opt.MaxGrossLeverage(1.0)]  
      9  
---> 10     return opt.calculate_optimal_portfolio(objective, constraints, empty_portfolio)

/build/src/qexec_repo/qexec/optimize/api.py in calculate_optimal_portfolio(objective, constraints, current_portfolio)
     68                                     constraints,  
     69                                     current_portfolio):  
---> 70         return optimizer.calculate_new_weights(  
     71             objective,  
     72             constraints,

AttributeError: &#39;str&#39; object has no attribute &#39;calculate_new_weights&#39;  
</code></pre>

<p>from this cell:<br>
<code>
constrained_leverage_pf = optimal_portfolio_constrained_leverage_only()  
draw_asset_barplot(constrained_leverage_pf, &#39;Optimal Portfolio (Constrained Leverage Only)&#39;);  
</code></p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='58331f5da0419f0015001217' id='58331f5da0419f0015001217'>
<a href='#58331f5da0419f0015001217'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4e322fa200fffd0001000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f59406ed486edc76c94544468c11344d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4e322fa200fffd0001000001'>Scott Sanderson</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1479745383000' class='quanto-date posted-at response-posted-at' href='#58331f5da0419f0015001217'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Thomas,</p>

<p>That error you&#39;re seeing is a bug in the most recent research env release.  Will fix shortly.</p>

<p>Grant, thanks for all the feedback.  I don&#39;t always have time to write up a detailed reply, but I do still read and think about the comments here.  I expect to be posting a new update on this API soon.  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='583ad4ae773925001200071c' id='583ad4ae773925001200071c'>
<a href='#583ad4ae773925001200071c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1480250549000' class='quanto-date posted-at response-posted-at' href='#583ad4ae773925001200071c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott -</p>

<p>Following up on one of my comments above, my understanding at this point is that although the <a href="https://blog.quantopian.com/a-professional-quant-equity-workflow/">workflow</a> is general with respect to its timescale (&quot;...the cycle time could be once a week, once a day, every 15 minutes, etc.&quot;), the initial release will be geared toward pipeline-based factors, with the alpha combination module also embedded within pipeline (i.e. not accessible within the trading day).  So, the question comes to mind if there would be any advantage in running the portfolio construction step within the trading day, or if it should immediately follow the alpha combination step (e.g. in 
<code>before_trading_start</code>)?  If you run the portfolio construction (optimization) before the open, then your estimate for the current portfolio will be stale; presumably, waiting ~30 minutes into the trading day would provide a much better estimate of the current portfolio (but might miss out on some return, if the timescale of the forecasting is daily).  However, doing the optimization within the trading day then opens up the question of when to do it, and how will it interact with the order/execution management system (as Fawce <a href="https://www.quantopian.com/posts/big-news-for-the-quantopian-community-managing-external-capital">mentions</a>, &quot;The selected algorithms will connect to a prime broker through an order/execution management system (O/EMS) at Quantopian&quot;)?</p>

<p>This opens up a more general discussion of how users wanting to write algos per the initial release of the workflow should think about order types and submission.  If I follow the game plan here (assuming the portfolio construction is run before the open), you&#39;ll probably just want a normalized portfolio vector prior to the open, and you&#39;ll take it from there (i.e. users won&#39;t actually define orders within their algos).  So, will there be a proxy for the O/EMS system that users can apply for backtesting and paper trading?  It seems like a standardized approach would be in order here, or you&#39;ll have all kinds of willy-nilly order types and intra-day ordering jazz that won&#39;t fit with the initial release of the workflow, that you&#39;ll have to unravel and interpret (without access to the logic of the strategy).  What is the plan?</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58cb0ae62e4af4000ac71f27' id='58cb0ae62e4af4000ac71f27'>
<a href='#58cb0ae62e4af4000ac71f27'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1489701606000' class='quanto-date posted-at response-posted-at' href='#58cb0ae62e4af4000ac71f27'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott,</p>

<p>I&#39;m trying:</p>

<p><code>objective = opt.TargetPortfolio(target_weights=actual_weight)</code></p>

<p>and getting an error:</p>

<p>AttributeError: &#39;module&#39; object has no attribute &#39;TargetPortfolio&#39;<br>
There was a runtime error on line 112.</p>

<p>Am I doing something wrong, or was there a change?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5a14f76587162a0ce373cfc1' id='5a14f76587162a0ce373cfc1'>
<a href='#5a14f76587162a0ce373cfc1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56971831c97feb89a1000615'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ea7dd67b1bea0b8ca77ddbb8c6a554b9?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56971831c97feb89a1000615'>John Smith</a>
</div>
<a UTCms='1511323493000' class='quanto-date posted-at response-posted-at' href='#5a14f76587162a0ce373cfc1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Scott, Great job on the optimize module. Do you have an open source implementation of the order_optimal_portfolio and the objective functions to understand what&#39;s going on behind the scenes?</p>

<p>Thanks  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/request-for-feedback-portfolio-optimization-api'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/request-for-feedback-portfolio-optimization-api'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#a2c4c7c7c6c0c3c1c9e2d3d7c3ccd6cdd2cbc3cc8cc1cdcf">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
Diversified portfolio, monthly rebalance for live trading
</title>
<meta content='This algorithm defines a long-only diversified portfolio and rebalances it at a user-specified frequency (currently set to 1ce per 28 days).   Portfolio constituents &amp; weights: (modify these by changing consituents in initialize() and changing weights in rebalance() method) VTI - 40 % - Vanguard Total Stock Market ETF  VEA - 30 % - Vanguard FTSE Developed Market ETF  VNQ - 15 % - Vanguard REIT ETF  DJP - 10 % - iPath Dow Jones UBS Commodity ETF  BND - 5  % - Vanguard total bond market ETF...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="UJXfep79sP2/k3VWJMSE8qe5aquuScqrAUfX6XeVUzws86k3PAtiHgaOLGdrKyyGnzdJwtSF37CDSAyD3dAxhw==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/diversified-portfolio-monthly-rebalance-for-live-trading' property='og:url'>
<meta content='Diversified portfolio, monthly rebalance for live trading' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/diversified-portfolio-monthly-rebalance-for-live-trading' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='Diversified portfolio, monthly rebalance for live trading' property='og:title'>
<meta content='This algorithm defines a long-only diversified portfolio and rebalances it at a user-specified frequency (currently set to 1ce per 28 days).   Portfolio constituents &amp; weights: (modify these by changing consituents in initialize() and changing weights in rebalance() method) VTI - 40 % - Vanguard Total Stock Market ETF  VEA - 30 % - Vanguard FTSE Developed Market ETF  VNQ - 15 % - Vanguard REIT ETF  DJP - 10 % - iPath Dow Jones UBS Commodity ETF  BND - 5  % - Vanguard total bond market ETF...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/diversified-portfolio-monthly-rebalance-for-live-trading">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='530a818646ef73d724000044'>
<div class='post-container' data-post-id='530a818646ef73d724000044' id='530a818646ef73d724000044'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>Diversified portfolio, monthly rebalance for live trading</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50f97faeaa4b3d78fd0000ee'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f18d32ae5bfc439c5b75bfa9f29e953a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50f97faeaa4b3d78fd0000ee'>Jessica Stauth</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1393197446000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=Diversified portfolio, monthly rebalance for live trading&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fdiversified-portfolio-monthly-rebalance-for-live-trading%3Futm_source%3Dwebsite_share%26utm_campaign%3Ddiversified-portfolio-monthly-rebalance-for-live-trading%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fdiversified-portfolio-monthly-rebalance-for-live-trading%3Futm_source%3Dwebsite_share%26utm_campaign%3Ddiversified-portfolio-monthly-rebalance-for-live-trading%26utm_medium%3Dlinkedin&amp;title=Diversified+portfolio%2C+monthly+rebalance+for+live+trading+%28Jessica+Stauth%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/diversified-portfolio-monthly-rebalance-for-live-trading?utm_source=website_share&amp;utm_campaign=diversified-portfolio-monthly-rebalance-for-live-trading&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Jessica Stauth" />
<div class='body-text'>
<div class='body-text-container post-body'><p>This algorithm defines a long-only diversified portfolio and rebalances it at a user-specified frequency (currently set to 1ce per 28 days).  </p>

<p>Portfolio constituents &amp; weights: (modify these by changing consituents in initialize() and changing weights in rebalance() method)</p>

<pre><code>VTI - 40 % - Vanguard Total Stock Market ETF  
VEA - 30 % - Vanguard FTSE Developed Market ETF  
VNQ - 15 % - Vanguard REIT ETF  
DJP - 10 % - iPath Dow Jones UBS Commodity ETF  
BND - 5  % - Vanguard total bond market ETF
</code></pre>

<p>Includes helper functions for live trading (e.g. check on open orders, cancel open orders EOD, isolated rebalance() method). Rebalance is triggered at 10am on the first deploy day and every 28 days after.  </p>
</div>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>25 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='530b359c46ef73d7240001e3' id='530b359c46ef73d7240001e3'>
<a href='#530b359c46ef73d7240001e3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393243549000' class='quanto-date posted-at response-posted-at' href='#530b359c46ef73d7240001e3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Jess,</p>

<p>An important consideration for live trading is that the algorithm gets re-launched every day (at market open, 9:30 am typically?).  Presumably, for the algo you shared above, this won&#39;t be a problem.  However, I can imagine that there could be some pitfalls.  Is there any way to emulate the daily re-launching in backtesting?</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='530b46ab46ef73d72400021b' id='530b46ab46ef73d72400021b'>
<a href='#530b46ab46ef73d72400021b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50f97faeaa4b3d78fd0000ee'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f18d32ae5bfc439c5b75bfa9f29e953a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50f97faeaa4b3d78fd0000ee'>Jessica Stauth</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1393247919000' class='quanto-date posted-at response-posted-at' href='#530b46ab46ef73d72400021b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant,</p>

<p>Actually I think the algo re-launch process is going to be transient, so while there are two important items in the list of <a href="https://www.quantopian.com/help#overview-livetrading">current limitations</a> that are related, I don&#39;t think there is good reason to go to too much effort building around this structure for the long term.</p>

<p>Basically you want your algorithm to be deterministic, if you get the same results when you click &#39;backtest&#39; and then click it again you are probably good. The two subtle cases that can violate determinism are (1) using a random seed variable in your algo, just don&#39;t do it. (2) relying on historical fetcher data that is overwritten  - make sure that your fetcher data source is fixed, with only updates via appending new data.</p>

<p>Algos (and their host servers) are launched each morning several hours before market open to make sure there is time to get things initialized and to catch any potential problems prior to open. A good rule of thumb is to make sure new fetcher data is updated by midnight to be on the safe side. </p>

<p>Best, Jess</p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='530b74e646ef7354a90002c7' id='530b74e646ef7354a90002c7'>
<a href='#530b74e646ef7354a90002c7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1393259751000' class='quanto-date posted-at response-posted-at' href='#530b74e646ef7354a90002c7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Is the &#39;context&#39; saved between restarts?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='530be9d194e337856b000048' id='530be9d194e337856b000048'>
<a href='#530be9d194e337856b000048'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1393289683000' class='quanto-date posted-at response-posted-at' href='#530be9d194e337856b000048'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Jess,</p>

<p>I also have Simon&#39;s question regarding &#39;context&#39; persistence between re-starts, and a more general one.  I gather that there is no way to permanently store data generated by the algorithm, for later access (e.g. from a hard drive).  Is this on the roadmap?</p>

<p>Also, I&#39;m not sure I understand how generating random numbers &quot;violates determinism&quot; and how it would affect execution of the algorithm.  Say one wanted to pick, randomly, a different stock to trade every day.  How could this be done?</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='530d3f1380db6d6f4b00031c' id='530d3f1380db6d6f4b00031c'>
<a href='#530d3f1380db6d6f4b00031c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51d21f832c036b64ab00015f'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/b4aa41adea653b9ac4d840e4570cd1f8?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51d21f832c036b64ab00015f'>Brian Vetere</a>
</div>
<a UTCms='1393377047000' class='quanto-date posted-at response-posted-at' href='#530d3f1380db6d6f4b00031c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I&#39;m looking for an opinion or thoughts on this.</p>

<p>Rebalancing, as is in done in this algo, can mean leaving a percentage of your cash idle.  In this particular example that isn&#39;t the case but if say one of the traded items was google at over $1000 per share and a 10% stake (30k account value) would leave hundreds of dollars not used. </p>

<p>This code can help a bit but I suspect that there is a better way.</p>

<pre><code>    targets = [40,30,15,10,5]  
    constraint = ({&#39;type&#39;:&#39;eq&#39;, &#39;fun&#39;: lambda targets: sum(targets)-100 })  
    optimized = scipy.optimize.minimize(excessCash,  
                                        targets,  
                                        (context.portfolio.cash+context.portfolio.positions_value,data),  
                                        constraints=constraint,  
                                        method=&#39;SLSQP&#39;)  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='531bc37ab363e28a640000a6' id='531bc37ab363e28a640000a6'>
<a href='#531bc37ab363e28a640000a6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530d253c6ce7f6278b0001fe'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/623e4f44f3310cad6e47ac3415c57a3d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530d253c6ce7f6278b0001fe'>Eric Laspe</a>
</div>
<a UTCms='1394328444000' class='quanto-date posted-at response-posted-at' href='#531bc37ab363e28a640000a6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I was playing with a rebalancing algorithm I cloned that does essentially this same thing, and I started to wonder about how exactly this can work without margin trades.  It seems like you&#39;d want to first determine which positions you&#39;re going to sell, and make those trades--ensuring they actually execute--before you buy the others.  Otherwise, you could hypothetically end up buying on margin for several days while your sell orders fail to execute, right?</p>

<pre><code>def rebalance(context,data,exchange_time):  
    #Rebalance the portfolio to the predetermined target weights:  
    #  
    #  40%   - US Stock Market  
    #  30%   - Foreign Stock Market  
    #  15%   - Real Estate  
    #  10%   - Natural Resources  
    #  5.0%  - Bonds  
    order_target_percent(context.USStockMkt,0.40)  
    order_target_percent(context.IntlStockMkt,0.30)  
    order_target_percent(context.RealEstate,0.15)  
    order_target_percent(context.NatResources,0.10)  
    order_target_percent(context.Bonds,0.05)

</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='531bf2cc77ed94a8ad00011b' id='531bf2cc77ed94a8ad00011b'>
<a href='#531bf2cc77ed94a8ad00011b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1394340557000' class='quanto-date posted-at response-posted-at' href='#531bf2cc77ed94a8ad00011b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Eric,</p>

<p>You may be right.  I&#39;ve been trying to get my head around generalized order management, and the series of order_target_percent lines just submit a bunch of market orders simultaneously (unless there is something more sophisticated under the hood).  Note that there is a 5% cash buffer, so for small changes, perhaps it&#39;ll be o.k.  But it is not clear what&#39;ll happen for larger changes, with thinly traded securities or if an order gets rejected/cancelled or partially filled.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='531bf87877ed94fbad000103' id='531bf87877ed94fbad000103'>
<a href='#531bf87877ed94fbad000103'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530d253c6ce7f6278b0001fe'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/623e4f44f3310cad6e47ac3415c57a3d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530d253c6ce7f6278b0001fe'>Eric Laspe</a>
</div>
<a UTCms='1394342009000' class='quanto-date posted-at response-posted-at' href='#531bf87877ed94fbad000103'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Grant,</p>

<p>I hadn&#39;t heard about the cash buffer.  It might help the situation, but I would rather not make the assumption that my orders will fit within that.  I don&#39;t like ambiguity in the behavior of my code, and I certainly wouldn&#39;t feel comfortable live trading without knowing exactly how my orders are going to be executed.  For that reason, I think I&#39;ll start manually placing the orders and monitoring their execution status myself.  By &quot;manually&quot; I mean using order() instead of order_target_percent().  ;)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='531c219f98eba00f3100015c' id='531c219f98eba00f3100015c'>
<a href='#531c219f98eba00f3100015c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1394352544000' class='quanto-date posted-at response-posted-at' href='#531c219f98eba00f3100015c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Grant,</p>

<p>The 5% cash buffer is mentioned here <a href="https://www.quantopian.com/posts/paper-trading-with-interactive-brokers-open-beta-launch">https://www.quantopian.com/posts/paper-trading-with-interactive-brokers-open-beta-launch</a> but isn&#39;t it just for that algo? (Where it seems to be 10%, anyway.)</p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='531c597dac2d34d81c0001f0' id='531c597dac2d34d81c0001f0'>
<a href='#531c597dac2d34d81c0001f0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1394366846000' class='quanto-date posted-at response-posted-at' href='#531c597dac2d34d81c0001f0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Peter (and sorry Eric),</p>

<p>Yes, for the algorithm above there is no cash buffer (my ability to do math drops exponentially after ~ 8 pm).  For the one posted on <a href="https://www.quantopian.com/posts/paper-trading-with-interactive-brokers-open-beta-launch">https://www.quantopian.com/posts/paper-trading-with-interactive-brokers-open-beta-launch</a>, it is 1%, right? </p>

<p>context.weights = 0.99/len(context.secs) or context.weights = 0.11<br>
9*0.11 = 0.99, which leaves 0.01 or 1% in cash</p>

<p>I&#39;ve attached a backtest as a check, which results in ~$10K in cash (out of $1M total).</p>

<p>Simon Thornington touches on the order management problem on <a href="https://www.quantopian.com/posts/grid-searching-for-profitable-cointegrating-portfolios">https://www.quantopian.com/posts/grid-searching-for-profitable-cointegrating-portfolios</a>:</p>

<blockquote>
<p>Well, stop orders on mean reversion systems are particularly tricky -- they&#39;re much more straight-forward on momentum-based systems.</p>

<p>For the time being, I am not going to target Quantopian, but try going it alone. I&#39;ll be keeping a close eye of course though! The challenges will be the same, structuring order placement to minimize transaction costs, handling partial and delayed fills correctly to avoid unhedged exposure, aggregating and disaggregating orders from multiple concurrent systems, per-system and portfolio level risk management and user overrides, etc etc. Lots to do!</p>
</blockquote>

<p>For the algorithm posted by Jess above, it may be a matter of defining a dependent series of orders (1-->2-->3...) so that capital flows versus time out of securities that have appreciated and into securities that have dropped in price, without triggering any borrowing.</p>

<p>Grant</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='531c701f98eba0844f0001bb' id='531c701f98eba0844f0001bb'>
<a href='#531c701f98eba0844f0001bb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50b24ec26d284c0200000088'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e238d8d7d6bb1f460ed27e0507045632?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50b24ec26d284c0200000088'>Peter Cawthron</a>
</div>
<a UTCms='1394372641000' class='quanto-date posted-at response-posted-at' href='#531c701f98eba0844f0001bb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hello Grant,</p>

<p>I think you&#39;re looking at the one from Dan and I&#39;m looking at the one from Jess!</p>

<p>P.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='531c978f77ed949841000227' id='531c978f77ed949841000227'>
<a href='#531c978f77ed949841000227'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1394382737000' class='quanto-date posted-at response-posted-at' href='#531c978f77ed949841000227'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Well...no matter...I think that Eric&#39;s point above applies.  --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='531c9a9d77ed94fbad000239' id='531c9a9d77ed94fbad000239'>
<a href='#531c9a9d77ed94fbad000239'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5033e9d73fb2eb0002000231'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/4a9a839742731aad6e110e1d3586e020?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5033e9d73fb2eb0002000231'>Simon Thornington</a>
</div>
<a UTCms='1394383518000' class='quanto-date posted-at response-posted-at' href='#531c9a9d77ed94fbad000239'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>If the market orders are big enough that they might take a while to execute then I suspect you are going to have bigger problems with slippage.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='531ca06677ed94fbad000242' id='531ca06677ed94fbad000242'>
<a href='#531ca06677ed94fbad000242'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1394385000000' class='quanto-date posted-at response-posted-at' href='#531ca06677ed94fbad000242'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>As I see it, the issue is this:</p>

<p>Initial state: 100% in A, 0% in B<br>
Change state to: 0% in A, 100% in B</p>

<pre><code>order_target_percent(context.A,0)  
order_target_percent(context.B,1)  
</code></pre>

<p>Should work, right?  But the proceeds from the sale of A are needed for the purchase of B, so if the sale of A does not go through, then what happens at IB?</p>

<p>There should be a way to code the algorithm so that it is more robust, right?  Basically, as the sell order for A is filled, a series of buy orders for B can be submitted, until the transaction is complete.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='531ca52277ed949841000254' id='531ca52277ed949841000254'>
<a href='#531ca52277ed949841000254'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/500da26d5152d20002000008'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7806a9f9b8bfcad2054cb313567f1b00?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/500da26d5152d20002000008'>Jonathan Kamens</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1394386211000' class='quanto-date posted-at response-posted-at' href='#531ca52277ed949841000254'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant,</p>

<p>If you are rebalancing your portfolio once a month, I&#39;m not sure the performance of your algo is going to be impacted in any significant way if you have to submit the order to sell A, wait a few minutes for it to clear, and then submit a followup order to purchase B. The gap in the time scale between one minute and one month is just too large for a few minutes to matter in an algorithm that does something monthly.</p>

<p>However, as noted previously, if you keep a cash buffer in your account, this is moot since the cash buffer will be used to purchase B even if the sell order for A goes through after the buy order for B.</p>

<p>Furthermore, if your account is large enough to be allowed to trade on margin, the buy order for B will go through even if you don&#39;t have a cash buffer.</p>

<p>It is also worth noting that unless you&#39;re trading a pretty illiquid stock, the odds are that if you place the sell and buy orders sequentially, they&#39;ll be processed sequentially, which means even with a 0% cash balance you can probably safely place both orders in the same minute. Worst-case scenario, the order for B get cancelled and you retry it a minute later.</p>

<p>I believe that among the 60-odd order types that IB offers are some that group multiple orders involving multiple securities into a single basket order that constrains how and when all the orders in the basket get filled. See, e.g., <a href="https://www.interactivebrokers.com/en/?f=%2Fen%2Ftrading%2Forders%2Fscale.php">Scale Orders</a>. We may consider adding support for such order types in the future if there is sufficient interest in them. However, we have to keep in mind that we will eventually be supporting multiple brokers, and I don&#39;t think we want our functionality to diverge greatly from broker to broker, so we may avoid supporting order types that are unique to specific brokers.  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='531ca9d3ac2d3482c2000243' id='531ca9d3ac2d3482c2000243'>
<a href='#531ca9d3ac2d3482c2000243'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50f97faeaa4b3d78fd0000ee'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f18d32ae5bfc439c5b75bfa9f29e953a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50f97faeaa4b3d78fd0000ee'>Jessica Stauth</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1394387413000' class='quanto-date posted-at response-posted-at' href='#531ca9d3ac2d3482c2000243'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Eric - as you point out my algo is not currently robust to trading illiquid stocks - it simply blindly calculates the order sizes need to reach the target allocation and places all those orders at once. Perhaps too simplistic for some use cases.</p>

<p>If you want to do something different then you can drop back to the basic order() type. Also keep in mind that our backtester is open-soure software (<a href="https://github.com/quantopian/zipline">https://github.com/quantopian/zipline</a>)</p>

<p>The order_target_percent method was contributed by a member of our open source community, Jeremian Lowin (see code below). If you come up with a way to extend this and make it more robust please share it back so we can pull in any improvements. I&#39;ve also thought that a nice addition would be to add a parameter to define a threshold for rebalance, so for example if you don&#39;t want to place trades for less than 100 shares, or 10 shares or whatever you could specify that. Haven&#39;t gotten to it yet though.</p>

<pre><code>def order_target_percent(self, sid, target, limit_price=None,  
                         stop_price=None):  
    &quot;&quot;&quot;  
    Place an order to adjust a position to a target percent of the  
    current portfolio value. If the position doesn&#39;t already exist, this is  
    equivalent to placing a new order. If the position does exist, this is  
    equivalent to placing an order for the difference between the target  
    percent and the current percent.

    Note that target must expressed as a decimal (0.50 means 50\%).  
    &quot;&quot;&quot;  
    if sid in self.portfolio.positions:  
        current_position = self.portfolio.positions[sid].amount  
        current_price = self.portfolio.positions[sid].last_sale_price  
        current_value = current_position * current_price  
    else:  
        current_value = 0  
    target_value = self.portfolio.portfolio_value * target

    req_value = target_value - current_value  
    return self.order_value(sid, req_value, limit_price, stop_price)
</code></pre>

<p>which then uses:</p>

<pre><code>def order_value(self, sid, value, limit_price=None, stop_price=None):  
    &quot;&quot;&quot;  
    Place an order by desired value rather than desired number of shares.  
    If the requested sid is found in the universe, the requested value is  
    divided by its price to imply the number of shares to transact.

    value &gt; 0 :: Buy/Cover  
    value &lt; 0 :: Sell/Short  
    Market order:    order(sid, value)  
    Limit order:     order(sid, value, limit_price)  
    Stop order:      order(sid, value, None, stop_price)  
    StopLimit order: order(sid, value, limit_price, stop_price)  
    &quot;&quot;&quot;  
    last_price = self.trading_client.current_data[sid].price  
    if np.allclose(last_price, 0):  
        zero_message = &quot;Price of 0 for {psid}; can&#39;t infer value&quot;.format(  
            psid=sid  
        )  
        self.logger.debug(zero_message)  
        # Don&#39;t place any order  
        return  
    else:  
        amount = value / last_price  
        return self.order(sid, amount, limit_price, stop_price)  
</code></pre>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='531cb63ab363e295f8000273' id='531cb63ab363e295f8000273'>
<a href='#531cb63ab363e295f8000273'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1394390589000' class='quanto-date posted-at response-posted-at' href='#531cb63ab363e295f8000273'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Jonathan (&amp; Jess),</p>

<p>This caught my interest, since I started working on an algorithm that seems to work pretty well for low dollar-volume stocks (via set_universe), and I&#39;d like to apply stop loss orders as the order is filled (assuming that the stocks are thinly traded).  And as the position is exited (again assuming thin trading), reduce the loss coverage accordingly.  Perhaps the lingo &quot;wind up&quot; and &quot;wind down&quot; applies here.  The problem Eric pointed out is analogous in that basically one has to write a Quantopian routine that will do the wind up and then update the allocation in a dynamic fashion, based on the IB state.</p>

<p>I agree that with liquid ETFs, a cash buffer, and the intent of the algorithm above, this may be no problemo.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5320bd5637b207192b000020' id='5320bd5637b207192b000020'>
<a href='#5320bd5637b207192b000020'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/530d253c6ce7f6278b0001fe'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/623e4f44f3310cad6e47ac3415c57a3d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/530d253c6ce7f6278b0001fe'>Eric Laspe</a>
</div>
<a UTCms='1394654551000' class='quanto-date posted-at response-posted-at' href='#5320bd5637b207192b000020'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Jessica,</p>

<p>Thanks for pointing out that zipline source code.  That will certainly help.  I would like to extend it in some ways, and the threshold feature you describe sounds great to me as well.  :)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='533c080cf4fb91965300028e' id='533c080cf4fb91965300028e'>
<a href='#533c080cf4fb91965300028e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b8c9e24fa3f2ed4600019d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7e213adb8ffcf106beb26ab515815eb0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b8c9e24fa3f2ed4600019d'>Aaron Goldenberg</a>
</div>
<a UTCms='1396443149000' class='quanto-date posted-at response-posted-at' href='#533c080cf4fb91965300028e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I noticed that this algo seems to rebalance each day at exactly the same time as the time that it was initially deployed even though there seems to be a much larger window for rebalancing. I am curious why this is. Can anyone explain?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='533c1597a060d4c65c0002bb' id='533c1597a060d4c65c0002bb'>
<a href='#533c1597a060d4c65c0002bb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50f97faeaa4b3d78fd0000ee'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f18d32ae5bfc439c5b75bfa9f29e953a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50f97faeaa4b3d78fd0000ee'>Jessica Stauth</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1396446617000' class='quanto-date posted-at response-posted-at' href='#533c1597a060d4c65c0002bb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Aaron, </p>

<p>The algo is set up to rebalance only once in a given day within the trading window defined, the window is left larger than a single minute to make the code robust to unforseen difficulty in completing a rebalance in live market conditions (possible market data delay, system goes down, I forget to have the algoirthm logged into my account at market open, what have you), but normally should indeed rebalance at the first minute of the trading window. Once the rebalance logic has been triggered the context variables storing the last and next rebalance date are updated and the algo will do nothing until it reaches the next time when the trading window AND rebalance date are both reached.</p>

<p>Hopefully that&#39;s clear - happy to step through the code in more detail if its not, or if I missed your Q entirely let me know.</p>

<p>Best regards,<br>
Jess  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='533c366fa00c7fa2630002c0' id='533c366fa00c7fa2630002c0'>
<a href='#533c366fa00c7fa2630002c0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b8c9e24fa3f2ed4600019d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7e213adb8ffcf106beb26ab515815eb0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b8c9e24fa3f2ed4600019d'>Aaron Goldenberg</a>
</div>
<a UTCms='1396455025000' class='quanto-date posted-at response-posted-at' href='#533c366fa00c7fa2630002c0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>That is what I thought. The window is 10am-3pm. I would expect the algo to rebalance sometime after 10am. I deployed this algo at 13:16 on Monday to take advantage of Quantopian&#39;s generous free-trading-for-life offer! I was surprised to see it rebalance at 13:17 on Tuesday. I am waiting to see if it repeats this behavior today. I was trying to step through the code to see if there is something I do not understand.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='533c4d269d73e6e24c000236' id='533c4d269d73e6e24c000236'>
<a href='#533c4d269d73e6e24c000236'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50f97faeaa4b3d78fd0000ee'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f18d32ae5bfc439c5b75bfa9f29e953a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50f97faeaa4b3d78fd0000ee'>Jessica Stauth</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1396460840000' class='quanto-date posted-at response-posted-at' href='#533c4d269d73e6e24c000236'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Aaron - sorry, yes you&#39;re right. As coded right now, if you deploy this algo in between 10am and 3pm the timestamp (date + time) is what&#39;s used to key subsequent rebalances. In backtest the algo is always initially deployed at market open, so I hadn&#39;t actually noticed this subtlety.</p>

<p>If you&#39;d like the algo to rebalance at 10am you can either a) relaunch the algo outside of the trading window (post 3pm through 10am following day) or b) modify the rebalance logic to key off of the date and not the timestamp (I&#39;ll try to get that second option coded up and post back here, but wanted to get you an answer that you&#39;re correct with what you&#39;ve observed in the short term). </p>

<p>Thanks for pointing this out! Best wishes,<br>
Jess  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='533c5195a060d4447a0002f3' id='533c5195a060d4447a0002f3'>
<a href='#533c5195a060d4447a0002f3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b8c9e24fa3f2ed4600019d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7e213adb8ffcf106beb26ab515815eb0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b8c9e24fa3f2ed4600019d'>Aaron Goldenberg</a>
</div>
<a UTCms='1396461975000' class='quanto-date posted-at response-posted-at' href='#533c5195a060d4447a0002f3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I was just trying to understand how the code worked. I think I understand now. I can fix it if I want to. Thanks! </p>

<p>exchange_time &gt; context.rebalance_date + datetime.timedelta(days=context.Rebalance_Days)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='533c53bf768193845f000003' id='533c53bf768193845f000003'>
<a href='#533c53bf768193845f000003'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50f97faeaa4b3d78fd0000ee'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f18d32ae5bfc439c5b75bfa9f29e953a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50f97faeaa4b3d78fd0000ee'>Jessica Stauth</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1396462529000' class='quanto-date posted-at response-posted-at' href='#533c53bf768193845f000003'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Yup, so this should do it, truncate the rebalance date to be just a date, not a datetime (on line 79/80 of original algo). Make sense?</p>

<p># Update the current and next rebalance dates<br>
           context.rebalance_date = exchange_time.date()  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='588fb163666f92000d0b15cb' id='588fb163666f92000d0b15cb'>
<a href='#588fb163666f92000d0b15cb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51872aa646f8c0f77600001a'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/1d5456ac1ba7cb3ad4d726d13e69f523?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51872aa646f8c0f77600001a'>Brett</a>
</div>
<a UTCms='1485812067000' class='quanto-date posted-at response-posted-at' href='#588fb163666f92000d0b15cb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Jessica,</p>

<p>In Quantopian, how are daily returns calculated from monthly rebalanced strategies?  Obviously weights between rebalancings are going to differ than the original because of differing performance between stocks. Just wanted to see how that was done! Or if there is also any reference in Zipline.</p>

<p>Thank you.  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/diversified-portfolio-monthly-rebalance-for-live-trading'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/diversified-portfolio-monthly-rebalance-for-live-trading'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#91f7f4f4f5f3f0f2fad1e0e4f0ffe5fee1f8f0ffbff2fefc">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

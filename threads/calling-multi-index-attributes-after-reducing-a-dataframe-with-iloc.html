<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
Calling Multi Index Attributes after reducing a Dataframe with Iloc
</title>
<meta content='Hi all,  Just a quick question i came up against starting to look through Quantopian and I was wondering where i was going wrong.  I am trying to return the top 500 companies by market cap, having excluded all non primary share companies.  Now , i am aware there might be a better way to do this involving a more advanced screen filter than what i&#39;ve used, however i&#39;d still like to know where the problem i&#39;m facing arises from.  In essence what i&#39;m doing is running a very simple pipeline,...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="kYo5L65pGvBK/ZRmdoqarQ4HG3hde+7lqsvL2bYfldbt7E9iDJ/IE/PgzVc5ZTLZNok4ESe3+/4oxBCzHFr3bQ==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/calling-multi-index-attributes-after-reducing-a-dataframe-with-iloc' property='og:url'>
<meta content='Calling Multi Index Attributes after reducing a Dataframe with Iloc' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/calling-multi-index-attributes-after-reducing-a-dataframe-with-iloc' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='Calling Multi Index Attributes after reducing a Dataframe with Iloc' property='og:title'>
<meta content='Hi all,  Just a quick question i came up against starting to look through Quantopian and I was wondering where i was going wrong.  I am trying to return the top 500 companies by market cap, having excluded all non primary share companies.  Now , i am aware there might be a better way to do this involving a more advanced screen filter than what i&#39;ve used, however i&#39;d still like to know where the problem i&#39;m facing arises from.  In essence what i&#39;m doing is running a very simple pipeline,...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/calling-multi-index-attributes-after-reducing-a-dataframe-with-iloc">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='5c33943235386e004b1e163e'>
<div class='post-container' data-post-id='5c33943235386e004b1e163e' id='5c33943235386e004b1e163e'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>Calling Multi Index Attributes after reducing a Dataframe with Iloc</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ae469531de5364737ba1fe4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0388219f19f21a38dfb354404821996b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ae469531de5364737ba1fe4'>Clockworkss</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1546884146000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=Calling Multi Index Attributes after reducing a Dataframe with Iloc&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fcalling-multi-index-attributes-after-reducing-a-dataframe-with-iloc%3Futm_source%3Dwebsite_share%26utm_campaign%3Dcalling-multi-index-attributes-after-reducing-a-dataframe-with-iloc%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fcalling-multi-index-attributes-after-reducing-a-dataframe-with-iloc%3Futm_source%3Dwebsite_share%26utm_campaign%3Dcalling-multi-index-attributes-after-reducing-a-dataframe-with-iloc%26utm_medium%3Dlinkedin&amp;title=Calling+Multi+Index+Attributes+after+reducing+a+Dataframe+with+Iloc+%28Clockworkss%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class='tags tag-row'>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Seeking Help' data-tag-id='55c50e7d8d4710ec6e000003' href='/posts/tag/Seeking-Help/newest'>Seeking Help</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Getting Started' data-tag-id='55c50e7d8d4710ec6e000004' href='/posts/tag/Getting-Started/newest'>Getting Started</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Research' data-tag-id='55c50e7d8d4710ec6e000018' href='/posts/tag/Research/newest'>Research</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Pipeline' data-tag-id='561525bcf252a59171000001' href='/posts/tag/Pipeline/newest'>Pipeline</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='numpy/pandas' data-tag-id='56d0b541f8f0e57992000002' href='/posts/tag/numpy_pandas/newest'>numpy/pandas</a>
</div>
<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/calling-multi-index-attributes-after-reducing-a-dataframe-with-iloc?utm_source=website_share&amp;utm_campaign=calling-multi-index-attributes-after-reducing-a-dataframe-with-iloc&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Clockworkss" />
<div class='body-text'>
<div class='body-text-container post-body'><p>Hi all, </p>

<p>Just a quick question i came up against starting to look through Quantopian and I was wondering where i was going wrong. </p>

<p>I am trying to return the top 500 companies by market cap, having excluded all non primary share companies. </p>

<p>Now , i am aware there might be a better way to do this involving a more advanced screen filter than what i&#39;ve used, however i&#39;d still like to know where the problem i&#39;m facing arises from. </p>

<p>In essence what i&#39;m doing is running a very simple pipeline, screening to include only primary shares.<br>
After that, i run a sort by on my market cap column and then Iloc[:500,:] to slice my dataframe to just the top 500 assets by Mcap. </p>

<p>The odd thing is that from there, when i try and run df.index.levels[1] (to get a list of the Sid which i use to create a name column in my frame) the index return is that of the original DataFrame, not the sliced new one. I&#39;ve tried creating a copy by as the dataframe is considered a function, but also to no avail </p>

<p>Optionally, here are my imports : </p>

<pre><code>import pandas as pd  
import numpy as np  
import datetime as dt  
import matplotlib.pyplot as plt  
#Pipeline is the screening engine  
from quantopian.pipeline import Pipeline

#Importing Datasets  
from quantopian.pipeline.data import USEquityPricing as P_us  
from quantopian.pipeline.domain import US_EQUITIES  
from quantopian.pipeline.filters import fundamentals as Q_FF

# PARAMETERS TO  
from quantopian.pipeline.domain import BE_EQUITIES  
# from quantopian.pipeline.data import EquityPricing as P_int  
from quantopian.pipeline.filters import QTradableStocksUS

#Import Quantopian Functions  
import quantopian.pipeline.factors as QT_factors

# Run pipeline is the Screen Iterator function  
from quantopian.research import run_pipeline

# Import Alphalens , Quantopian&#39;s Factor analysis &amp; plotting module  
import alphalens as al

</code></pre>

<pre><code>Final= (run_pipeline(  
    Pipeline(  
        columns={&quot;market_Cap&quot;:QT_factors.MarketCap(),  
                 &quot;return&quot;:QT_factors.DailyReturns()},  
        screen=Q_FF.IsPrimaryShare()  
        ),  
        start_date=&#39;2019-01-04&#39;,  
        end_date=&#39;2019-01-04&#39;)  
         ).sort_values(by=&#39;market_Cap&#39;,ascending=False).iloc[:500,:]  
</code></pre>

<p>From there if you run Index you get a len of 500 , which is correct, but try running index.levels and you get 4200+ </p>

<pre><code>len(Final.index)  
len(Final.index.levels[1])

#try a copy ,same problem 

df=Final.copy()  
len(df.index.levels[1])

</code></pre>

<p>Any idea if this is a bug or a mistake in how i am approaching this ? </p>

<p>Also if there is a version of pipeline&#39;s screen parameter that allows me to do this, i&#39;ve be very grateful to be guided to the doc, but as i have not looked much into it myself, i&#39;m asking for help on the above specific issue , anything further is a bonus ! </p>

<p>Many thanks, let me know if you need any further information to replicate. </p>

<p>Best,  </p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>10 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='5c34271f785f7f00475db248' id='5c34271f785f7f00475db248'>
<a href='#5c34271f785f7f00475db248'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b5367af91296a14e12b76bd'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0f1a8eac15a47d97473d28722fa824e0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b5367af91296a14e12b76bd'>Kyle M</a>
<span class='badge medal'></span>
</div>
<a UTCms='1546921759000' class='quanto-date posted-at response-posted-at' href='#5c34271f785f7f00475db248'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I believe it you&#39;re using iloc notation incorrectly, although I didn&#39;t actually test your code. iloc takes two arguments, the start index and the end index. I think what you&#39;re looking for is iloc[0, 499].</p>

<p>You can also accomplish what you&#39;re looking for using a filter like you thought! :)</p>

<p>I recommend something like the following:  </p>

<pre><code>market_cap = QT_factors.MarketCap()  
Final= (run_pipeline(  
    Pipeline(  
        columns={&quot;market_Cap&quot;:  market_cap,  
                 &quot;return&quot;:QT_factors.DailyReturns()},  
        screen=(Q_FF.IsPrimaryShare()  &amp; market_cap.top(500))  
        ),  
        start_date=&#39;2019-01-04&#39;,  
        end_date=&#39;2019-01-04&#39;)  
         )  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c3472941d03483a3b34eed3' id='5c3472941d03483a3b34eed3'>
<a href='#5c3472941d03483a3b34eed3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ae469531de5364737ba1fe4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0388219f19f21a38dfb354404821996b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ae469531de5364737ba1fe4'>Clockworkss</a>
</div>
<a UTCms='1546941076000' class='quanto-date posted-at response-posted-at' href='#5c3472941d03483a3b34eed3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Kyle, </p>

<p>Many thanks for the answer, i&#39;ve unfortunately tried both these avenues. Using your code, i get less than 500 companies, getting 354 instead. Reason is the filters are not applied in turn , the filter is saying &quot; i want only the primary shares from the top 500 security  ranked by MCap&quot;, instead of , I want the top 500  companies , only counting primary shares &quot; </p>

<p>I tried running something like (Q_FF.IsPrimaryShare()  &amp; market_cap.top) .top(500) but this work as the result of the filter is  a boolean . </p>

<p>In regard to iloc, my method of implementation i believe is not wrong, at least in terms of the functioning of the function. The iloc method can be used as: </p>

<p>iloc[start_row_n:end_row_n,start_col_n:end_col_n] with omitted start X defaulting to 0.<br>
As my Frame&#39;s size is 500 , the iloc is performing as it should, rather its the index method that is not. </p>

<p>hope this helps, thanks for taking the time to help !  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c34957b1d0348003e34f18d' id='5c34957b1d0348003e34f18d'>
<a href='#5c34957b1d0348003e34f18d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/54e159f70f3369eb9200019b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/2a53f34ae7e99886508adf2b4d76bff2?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/54e159f70f3369eb9200019b'>Vladimir</a>
<span class='badge medal'></span>
</div>
<a UTCms='1546950011000' class='quanto-date posted-at response-posted-at' href='#5c34957b1d0348003e34f18d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p><em>Top 500 companies by market_cap, only counting primary shares</em> in IDE:</p>

<pre><code>from quantopian.algorithm import attach_pipeline, pipeline_output  
from quantopian.pipeline import Pipeline, factors, filters  
from quantopian.pipeline.data import Fundamentals

def initialize(context):  
    schedule_function(trade, date_rules.every_day(), time_rules.market_open(minutes = 65))  
    ps = filters.fundamentals.IsPrimaryShare(mask = filters.QTradableStocksUS())  
    mc = Fundamentals.market_cap.latest  
    top_market_cap_primary = Fundamentals.market_cap.latest.top(500, mask = ps)  
    attach_pipeline(Pipeline(columns = {&#39;market_Cap&#39;: mc}, screen = top_market_cap_primary), &#39;pipe&#39;) 

def trade(context, data):  
    output = pipeline_output(&#39;pipe&#39;)  
    top_mc = pipeline_output(&#39;pipe&#39;).sort_values(by = &#39;market_Cap&#39;, ascending = False).iloc[:500,:]  
    print (len(output), len(top_mc))  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c34d6e5785f7f4b8c5db209' id='5c34d6e5785f7f4b8c5db209'>
<a href='#5c34d6e5785f7f4b8c5db209'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ae469531de5364737ba1fe4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0388219f19f21a38dfb354404821996b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ae469531de5364737ba1fe4'>Clockworkss</a>
</div>
<a UTCms='1546966757000' class='quanto-date posted-at response-posted-at' href='#5c34d6e5785f7f4b8c5db209'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Vlad, thanks for the above! </p>

<p>Being new to quantopian, i&#39;ve not worked in the backtest IDE yet, tried to run your script i don&#39;t see a console to execute. I can execute and see the result but not the dataframe as using the &quot;build algo&quot; button crashes from trying to import fundamentals for some reason. </p>

<p>Anyway, as the print above works, i tried printing the index length at level 1 ( the number of companies) , the dataframe has no level one, so the trade function seems to iterate over the level 0 (date) index of your frame, meaning i can&#39;t validate the theory above as it has no attribute .index.levels[1].<br>
You can verify by trying to print ( len(output.index.levels[1])) </p>

<p>However , you answer gave me the best practice, as i didn&#39;t know about the MASK parameter. indeed if i use it , i get the desired Dataframe. </p>

<p>I&#39;m happy to proceed as above but would still like to know. </p>

<p>Why is the attribute behavior different , this looks like a bug, can anyone explain ?<br>
i&#39;m attaching a proof of the difference in behavior below. </p>

<pre><code>Final= (run_pipeline(  
    Pipeline(  
        columns={&quot;market_Cap&quot;:QT_factors.MarketCap(),  
                 &quot;return&quot;:QT_factors.DailyReturns()},  
        screen=Q_FF.IsPrimaryShare()  
        ),  
        start_date=&#39;2019-01-04&#39;,  
        end_date=&#39;2019-01-04&#39;)  
         ).sort_values(by=&#39;market_Cap&#39;,ascending=False).iloc[:500,:]

market_cap2= QT_factors.MarketCap()  

Final2= (run_pipeline(  
    Pipeline(  
        columns={&quot;market_Cap&quot;:  market_cap2,  
                 &quot;return&quot;:QT_factors.DailyReturns()},  
        screen=market_cap2.top(500, mask=Q_FF.IsPrimaryShare())  
        ),  
        start_date=&#39;2019-01-04&#39;,  
        end_date=&#39;2019-01-04&#39;)  
         )  
len(Final2)  
Final2.sort_values(by=&#39;market_Cap&#39;,ascending=False).head()

Final.head()  
assert(Final.equals(Final2.sort_values(by=&#39;market_Cap&#39;,ascending=False)))  
assert(Final.index.levels[1].equals(Final2.index.levels[1]))  
print(len(Final.index.levels[1]),len(Final2.index.levels[1]))


</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c34da911d034814b634eeb8' id='5c34da911d034814b634eeb8'>
<a href='#5c34da911d034814b634eeb8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55eefc2af269c592d80008a9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8985b490c95e135c2bbcd7d1a0dce16b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55eefc2af269c592d80008a9'>Jamie McCorriston</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1546967697000' class='quanto-date posted-at response-posted-at' href='#5c34da911d034814b634eeb8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Clockworkss,</p>

<p>First off, welcome to Quantopian! It looks like you&#39;re off to a good start with your pipeline. Vladimir&#39;s suggestion to use masking is a good one. Masking allows you to achieve &quot;i want only the primary shares from the top 500 security ranked by MCap&quot; as you stated earlier. Attached is a notebook with a pipeline that takes the top 500 assets in the <code>QTradableUniverse</code> (a built-in filter) every day. I attached a plot at the end of the notebook to show that there are 500 securities per day. You can play around with the notebook and change the filter to <code>IsPrimaryShare</code> to see that the pipeline still outputs 500 assets per day.</p>

<p>Here are a couple of tips to help accelerate your learning curve on Q:<br>
1. If you haven&#39;t seen it yet, the <a href="https://www.quantopian.com/tutorials/getting-started">Getting Started Tutorial</a> will give you a quick walkthrough of the various tools available on Quantopian. This is a great place to get started learning the platform.<br>
2. Next, I&#39;d highly recommend going through the <a href="https://www.quantopian.com/tutorials/pipeline">Pipeline Tutorial</a>. <a href="https://www.quantopian.com/tutorials/pipeline#lesson7">Lesson 7</a> in particular covers masking in more detail. Given the questions you are asking, I think your time will be well spent if you go through the whole tutorial.<br>
3. When asking for help in the forums, attaching a notebook or backtest is the best way to share code. That way, others can simply click &quot;Clone&quot; to pick up where you left off and play around with things.</p>

<p>I hope this helps! Let me know if you have any further questions about the attached notebook.</p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5c34df771d03482d7234eeb1' id='5c34df771d03482d7234eeb1'>
<a href='#5c34df771d03482d7234eeb1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ae469531de5364737ba1fe4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0388219f19f21a38dfb354404821996b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ae469531de5364737ba1fe4'>Clockworkss</a>
</div>
<a UTCms='1546968951000' class='quanto-date posted-at response-posted-at' href='#5c34df771d03482d7234eeb1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>thanks for the resources, will definitely check it out! and I am able to achieve my desired pipeline from the help i received from vlad and yourself , I am now more trying to understanding the behavior so that I know what can and can&#39;t be done. </p>

<p>Would you have any idea why calling .index.levels[1] returns the original index when using .iloc as described above?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c34e374d22d2b0041b0f241' id='5c34e374d22d2b0041b0f241'>
<a href='#5c34e374d22d2b0041b0f241'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55eefc2af269c592d80008a9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8985b490c95e135c2bbcd7d1a0dce16b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55eefc2af269c592d80008a9'>Jamie McCorriston</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1546969972000' class='quanto-date posted-at response-posted-at' href='#5c34e374d22d2b0041b0f241'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The result of running a pipeline in research is a MultiIndex where level 0 is the date and level 1 is the asset. In the IDE, attached pipelines are run once per day, and the output (retrieved via the <code>pipeline_output</code> function each day) is just a regular Index (assets), since the date is implied to be the simulation date.</p>

<p>Does this help?  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5c35c61994e137004b7b2567' id='5c35c61994e137004b7b2567'>
<a href='#5c35c61994e137004b7b2567'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ae469531de5364737ba1fe4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0388219f19f21a38dfb354404821996b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ae469531de5364737ba1fe4'>Clockworkss</a>
</div>
<a UTCms='1547027993000' class='quanto-date posted-at response-posted-at' href='#5c35c61994e137004b7b2567'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hey all,</p>

<p>thanks for all the help and advice so far, apologies for not attaching a note book, please find it herein.<br>
Also it seems my question is not clear.  I understand how to achieve what i wanted, i have a functional notebook thanks to the mask filters suggested above.</p>

<p>My questions is:<br>
why does the assertion below return false when the data frames are the same as proven by the first assertion in the notebook ?   </p>

<pre><code>assert(Final.index.levels[1].equals(Final2.index.levels[1]))  
print(len(Final.index.levels[1]),len(Final2.index.levels[1]))  
</code></pre>

<p>Many thanks !  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c36152d94e137003f7b26de' id='5c36152d94e137003f7b26de'>
<a href='#5c36152d94e137003f7b26de'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/55eefc2af269c592d80008a9'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8985b490c95e135c2bbcd7d1a0dce16b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/55eefc2af269c592d80008a9'>Jamie McCorriston</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1547048237000' class='quanto-date posted-at response-posted-at' href='#5c36152d94e137003f7b26de'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Clockworkss,</p>

<p>Thanks for clarifying your question in the notebook - I now understand what you&#39;re asking. </p>

<p>&lt; strikethrough&gt; I&#39;m far from an expert on pandas/numpy, but it looks like what&#39;s happening is the index of the DataFrame doesn&#39;t change when you take a subset with <code>iloc</code>. Once upon a time, one of our engineers was explaining another problem related to MultiIndex DataFrames to me and they pointed out that the Index object is an iterable of unique values that actually map the larger objects (in this case, Equity objects) to integers. The integers are used under the hood to represent the data and reduce the size of the structure. The Index kind of serves as a map from the user-facing index to the integer representation. My guess is that it&#39;s not worth it for the index in <code>Final</code> to be re-mapped to a new set of integers because all of the index data (the integers) would have to be re-written to reflect the new map. At a high level, the contents of the two DataFrames are the same, but the Index label mapping to integers are different.</p>

<p>Again, this is a bit of a guess, but I&#39;ll call it an educated guess! I&#39;d be interested to hear from someone who knows more about the topic. &lt; /strikethrough&gt;</p>

<p><strong>EDIT - I asked one of our engineers who answered with this: &quot;The index is actually different, but the levels are not. A MultiIndex is represented as an array of unique values along each level (<code>levels</code>) and an array of coordinates into those arrays (<code>values</code> I think). When taking a subset of the index, it doesn&#39;t alter the levels at all, only the coordinates. This is why you should use <code>get_level_values</code> to actually materialize a level.&quot;</strong></p>

<p>I hope this helps!  </p>
</div>
<div class='collapsed disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='5c3722ccf21f07370970fa92' id='5c3722ccf21f07370970fa92'>
<a href='#5c3722ccf21f07370970fa92'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ae469531de5364737ba1fe4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/0388219f19f21a38dfb354404821996b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ae469531de5364737ba1fe4'>Clockworkss</a>
</div>
<a UTCms='1547117260000' class='quanto-date posted-at response-posted-at' href='#5c3722ccf21f07370970fa92'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Jamie, </p>

<p>thank you so much for the help and following up with your engineering team on this ! really helpful !<br>
looking through i can see that get_level_values does indeed work and indeed i can replicate this issue on a pandas only frame . i&#39;ll use the answer they provided and do a bit of reading to understand the specific but that&#39;s it from me ! </p>

<p>thanks to all who helped both with the best practice, and understand why the method i employed did not work ! </p>

<p>best,  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/calling-multi-index-attributes-after-reducing-a-dataframe-with-iloc'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/calling-multi-index-attributes-after-reducing-a-dataframe-with-iloc'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#65030000010704060e251410040b110a150c040b4b060a08">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

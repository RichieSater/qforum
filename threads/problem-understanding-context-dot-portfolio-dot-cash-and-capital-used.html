<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
problem understanding context.portfolio.cash and capital_used
</title>
<meta content='I have been watching the shared algorithms that are posted.  It is fun and interesting to see the ideas people come up with.However I&#39;m also starting to see a trend where the comment replies inevitably say something like &quot;the algorithm borrows wildly, many times beyond the starting cash&quot;.  These sort of comments are useful feedback but also distract from the main idea being shared.So I started to investigate the reason behind the massive over-spending by algorithms.The documentation lists two...' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="gWjBvrbQTpM6f8KkAud1WPwRp9XlzMZmKabYLt+VxDT9DrfzFCaccINim5VNCN0sxJ+EvJ8A032rqQNEddCmjw==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/problem-understanding-context-dot-portfolio-dot-cash-and-capital-used' property='og:url'>
<meta content='problem understanding context.portfolio.cash and capital_used' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/problem-understanding-context-dot-portfolio-dot-cash-and-capital-used' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='problem understanding context.portfolio.cash and capital_used' property='og:title'>
<meta content='I have been watching the shared algorithms that are posted.  It is fun and interesting to see the ideas people come up with.However I&#39;m also starting to see a trend where the comment replies inevitably say something like &quot;the algorithm borrows wildly, many times beyond the starting cash&quot;.  These sort of comments are useful feedback but also distract from the main idea being shared.So I started to investigate the reason behind the massive over-spending by algorithms.The documentation lists two...' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/problem-understanding-context-dot-portfolio-dot-cash-and-capital-used">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='51be1610f8e2f9809d00000d'>
<div class='post-container' data-post-id='51be1610f8e2f9809d00000d' id='51be1610f8e2f9809d00000d'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>problem understanding context.portfolio.cash and capital_used</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5129325375c044927f00003b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f0d31a4138a1940012b68dbb3e54074c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5129325375c044927f00003b'>Dennis C</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1371411984000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=problem understanding context.portfolio.cash and capital_used&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fproblem-understanding-context-dot-portfolio-dot-cash-and-capital-used%3Futm_source%3Dwebsite_share%26utm_campaign%3Dproblem-understanding-context-dot-portfolio-dot-cash-and-capital-used%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Fproblem-understanding-context-dot-portfolio-dot-cash-and-capital-used%3Futm_source%3Dwebsite_share%26utm_campaign%3Dproblem-understanding-context-dot-portfolio-dot-cash-and-capital-used%26utm_medium%3Dlinkedin&amp;title=problem+understanding+context.portfolio.cash+and+capital_used+%28Dennis+C%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/problem-understanding-context-dot-portfolio-dot-cash-and-capital-used?utm_source=website_share&amp;utm_campaign=problem-understanding-context-dot-portfolio-dot-cash-and-capital-used&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Dennis C" />
<div class='body-text'>
<div class='body-text-container post-body'><p>I have been watching the shared algorithms that are posted.  It is fun and interesting to see the ideas people come up with.</p>

<p>However I&#39;m also starting to see a trend where the comment replies inevitably say something like &quot;the algorithm borrows wildly, many times beyond the starting cash&quot;.  These sort of comments are useful feedback but also distract from the main idea being shared.</p>

<p>So I started to investigate the reason behind the massive over-spending by algorithms.</p>

<p>The documentation lists two <a href="https://www.quantopian.com/help#api-portfolio">properties of the portfolio object</a> that should help determine how much cash has been used versus how much is available for spending: context.portfolio.cash and context.portfolio.capital_used.</p>

<p>I have tried to understand how to use these variables but I simply cannot make them work for me.  They seem to only be useful in a strictly long portfolio.  Adding in short positions causes their usefulness to evaporate.</p>

<p>In the attached backtest I show a portfolio composed of equally balanced long and short positions.  Each day $10k is added to both the long and short side.  Each month the overall position is closed out and started all over.</p>

<p>I plotted context.portfolio.cash and capital_used and found that neither one changed meaningfully over the period of the backtest.  Even though the algorithm was investing <strong>$20k per day</strong> there was <strong>negligible change</strong>.</p>

<p>I now believe that the main culprit is context.portfolio.capital_used.  The formula for calculating the amount of capital used must be incorrect.  Once it is fixed then context.portfolio.cash should also start working (since it likely uses capital_used as an input).</p>

<p>I came to this conclusion by calculating my own version of context.portfolio.capital_used which you will see in the backtest as abs_cap_used.  If you look at the custom recorded variables graph the only useful information is from abs_cap_used and abs_cash.</p>

<p>If anyone has the patience and willingness to review the source code I would appreciate any feedback or corrections.</p>

<p>If the Quantopian team sees this please consider changing the formula for context.portfolio.capital_used (or adding a new property that reflects the modified calculation).</p>

<p>Thanks,<br>
Dennis</p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>11 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='51bedc9c36c4093426000097' id='51bedc9c36c4093426000097'>
<a href='#51bedc9c36c4093426000097'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1371462813000' class='quanto-date posted-at response-posted-at' href='#51bedc9c36c4093426000097'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Dennis,</p>

<p>I took a quick look at Zipline (<a href="https://github.com/quantopian/zipline/blob/master/zipline/finance/performance.py">https://github.com/quantopian/zipline/blob/master/zipline/finance/performance.py</a>) and found:</p>

<pre><code> def __core_dict(self):  
        rval = {  
            &#39;ending_value&#39;: self.ending_value,  
            # this field is renamed to capital_used for backward  
            # compatibility.  
            &#39;capital_used&#39;: self.period_cash_flow,  
            &#39;starting_value&#39;: self.starting_value,  
            &#39;starting_cash&#39;: self.starting_cash,  
            &#39;ending_cash&#39;: self.ending_cash,  
            &#39;portfolio_value&#39;: self.ending_cash + self.ending_value,  
            &#39;cumulative_capital_used&#39;: self.cumulative_capital_used,  
            &#39;max_capital_used&#39;: self.max_capital_used,  
            &#39;max_leverage&#39;: self.max_leverage,  
            &#39;pnl&#39;: self.pnl,  
            &#39;returns&#39;: self.returns,  
            &#39;period_open&#39;: self.period_open,  
            &#39;period_close&#39;: self.period_close  
        }  
</code></pre>

<p>Grant</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='51befd8336c409f78f00008f' id='51befd8336c409f78f00008f'>
<a href='#51befd8336c409f78f00008f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5129325375c044927f00003b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f0d31a4138a1940012b68dbb3e54074c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5129325375c044927f00003b'>Dennis C</a>
</div>
<a UTCms='1371471236000' class='quanto-date posted-at response-posted-at' href='#51befd8336c409f78f00008f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Grant.  I had tried to find &#39;capital_used&#39; with a Google search but it didn&#39;t locate this file.</p>

<p>I think the portfolio object is set in its own function.  I wasn&#39;t able to use the properties from core_dict in my algorithm (e.g. max_leverage).</p>

<pre><code>def as_portfolio(self):  
        &quot;&quot;&quot;  
        The purpose of this method is to provide a portfolio  
        object to algorithms running inside the same trading  
        client. The data needed is captured raw in a  
        PerformancePeriod, and in this method we rename some  
        fields for usability and remove extraneous fields.  
        &quot;&quot;&quot;  
        # Recycles containing objects&#39; Portfolio object  
        # which is used for returning values.  
        # as_portfolio is called in an inner loop,  
        # so repeated object creation becomes too expensive  
        portfolio = self._portfolio_store  
        # maintaining the old name for the portfolio field for  
        # backward compatibility  
        portfolio.capital_used = self.period_cash_flow  
        portfolio.starting_cash = self.starting_cash  
        portfolio.portfolio_value = self.ending_cash + self.ending_value  
        portfolio.pnl = self.pnl  
        portfolio.returns = self.returns  
        portfolio.cash = self.ending_cash  
        portfolio.start_date = self.period_open  
        portfolio.positions = self.get_positions()  
        portfolio.positions_value = self.ending_value  
        return portfolio  
</code></pre>

<p>The code also reveals the calculations for capital_used (period_cash_flow) and cash (ending_cash).</p>

<p>I found the code for context.portfolio.capital_used (aka period_cash_flow).  It is adjusted by subtracting the net sum of transaction dollars.  So that would cause short orders (negative dollars) to mask long orders.  And it&#39;s also why it is overall negative instead of positive in long positions.  This matches my hypothetical q_cap_used equation in my backtest.</p>

<pre><code>    self.period_cash_flow = 0.0               # initialized to zero  
    self.period_cash_flow += cash_payments    # dividends  
    # subtract transaction spot price x number of shares  
    self.period_cash_flow += -1 * txn.price * txn.amount  
</code></pre>

<p>I also found the code for context.portfolio.cash (aka ending_cash).  As expected it is calculated from period_cash_flow:</p>

<pre><code>    self.ending_cash = starting_cash   # initialized to starting_cash  
    # sum of starting_cash and &#39;capital_used&#39; (aka period_cash_flow)  
    self.ending_cash = self.starting_cash + self.period_cash_flow  
</code></pre>

<p>There doesn&#39;t seem to be a zipline calculation for <em>absolute</em> capital used and remaining cash.  So I guess I will just have to keep using my home-brew solution:</p>

<pre><code>    # calculate capital_used using absolute amount: abs(amount)*cost_basis  
    pos = context.portfolio.positions  
    abs_capital_used = sum(abs(pos[s].amount) * pos[s].cost_basis for s in pos)  
    record(abs_cap_used = abs_capital_used)  
    # calculate free cash: starting_cash + pnl - capital_used  
    port = context.portfolio  
    abs_cash = port.starting_cash + port.pnl - abs_capital_used  
    record(abs_cash = abs_cash)  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='51c298d56439bbda3e000006' id='51c298d56439bbda3e000006'>
<a href='#51c298d56439bbda3e000006'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51520d205be9098359000141'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6e7b5449bfdda052f871941dd42ca706?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51520d205be9098359000141'>Ryan Moore</a>
</div>
<a UTCms='1371707606000' class='quanto-date posted-at response-posted-at' href='#51c298d56439bbda3e000006'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Quantopian: Can you address this in zipline?</p>

<p>I&#39;ve been bitten by this on essentially every algorithm I have designed or considered, it should be something that I can set as a startup parameter and then not have to worry about. Something similar to the max_notional and min_notional that you recommend in your algorithms, but enforced by the backtester itself versus reinventing the wheel every. single. time.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='51c31e5b8a2b3fddcc000039' id='51c31e5b8a2b3fddcc000039'>
<a href='#51c31e5b8a2b3fddcc000039'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4fe8beb792a029000200000d'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/fe3ffe502559d05f16eb9fe41ab7e9a1?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4fe8beb792a029000200000d'>Dan Dunn</a>
<img class='quantopian-badge async-image' data-src='https://qf.quantopian.com/assets/logos/staff-q-red-stroke-095008cf53acafb1da63369cad14e3083d49d13eea83f592dd3dd0d5f0474fcc.svg'>
</div>
<a UTCms='1371741788000' class='quanto-date posted-at response-posted-at' href='#51c31e5b8a2b3fddcc000039'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Ryan, do you think Grant&#39;s homebrew solution is the right one?  Or is there a different, similar calculation?</p>

<p>Once we have the useful calculations identified, figuring out how to do limits can be next.  </p>
</div>
<div class='disclaimer-minimized-wrapper'>
<div class='title'>Disclaimer</div>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian. In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>
</div>
</div>

</div>
</div>

<div class='post-container response-container' data-post-id='51c38bd48a2b3ffe0e000089' id='51c38bd48a2b3ffe0e000089'>
<a href='#51c38bd48a2b3ffe0e000089'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1371769814000' class='quanto-date posted-at response-posted-at' href='#51c38bd48a2b3ffe0e000089'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Dan,</p>

<p>I think it was Dennis C who posted a &quot;homebrew solution,&quot; not me.</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='51c92090c029ddfdb3000018' id='51c92090c029ddfdb3000018'>
<a href='#51c92090c029ddfdb3000018'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51520d205be9098359000141'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/6e7b5449bfdda052f871941dd42ca706?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51520d205be9098359000141'>Ryan Moore</a>
</div>
<a UTCms='1372135569000' class='quanto-date posted-at response-posted-at' href='#51c92090c029ddfdb3000018'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>It looks correct, but the other part of the problem is that I don&#39;t know what it&#39;s supposed to look like. I&#39;m a n00b at all of this, I can understand the idea of notionals and limits, but I can&#39;t seem to make them work when it comes to application.</p>

<p>I&#39;ve done the equivalent of these calculations before, but the numbers never added up. If I update &quot;cash on hand&quot; like this, the values don&#39;t match the zipline cash-used values due to slippage / commission / other:  </p>

<pre><code>self.cash_on_hand = self.cash_on_hand - (data[stock].price * order_size)  
</code></pre>

<p>This is the idealized equation if I&#39;m pursuing a long-only strategy (it scares me to bet money I don&#39;t have), but it leaves out the other bits. I can&#39;t even get the numbers to balance between cash_on_hand and some summation of portfolio.* or a combination thereof. If I want to add shorting into the mix, it gets even worse. Multiplying by cost_basis seems like a good idea, but again, I don&#39;t know if that&#39;s correct.</p>

<p>My ideal situation would be:<br>
 - Set the initial cash-on-hand to a fixed value, defaulting to portfolio size.<br>
 - Make that number available in the init function so other vars can be set relative to it (i.e. short_limit = start_value * 0.5).<br>
 - Set the short limit to a fixed value, defaulting to zero.<br>
 - Have zipline process transactions as it does now, but tracking both long positions and shorts, separately.<br>
 - Reject transactions that would violate either limit (OVER_MAX_LONG, OVER_MAX_SHORT).</p>

<p>Without having these kinds of limits enforced in the engine, I don&#39;t see any point to specifying an initial investment amount. That only changes where you put the zero-mark, it doesn&#39;t change the behavior of the backtester in any way. With these limits in place, things like credit, dividends, commissions, slippage, etc. could all just affect the cash_on_hand value, and the engine would respond appropriately.</p>

<p>Want to short something? Check your credit (MAX_SHORT), and if you have &quot;cash&quot; put through the transaction.<br>
Get a big dividend? cash_on_hand++<br>
Long on 10 stocks and short on 6? The numbers still add up (and the limits still work!) because you&#39;re under MAX_LONG and over MAX_SHORT.</p>

<p>Making this happen I leave as an exercise to the reader - I certainly don&#39;t know how to do it, or I would&#39;ve gotten at least one of my algorithms to reconcile. =)  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='51c9d2c1c029dd6f0f0000c4' id='51c9d2c1c029dd6f0f0000c4'>
<a href='#51c9d2c1c029dd6f0f0000c4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5129325375c044927f00003b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f0d31a4138a1940012b68dbb3e54074c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5129325375c044927f00003b'>Dennis C</a>
</div>
<a UTCms='1372181186000' class='quanto-date posted-at response-posted-at' href='#51c9d2c1c029dd6f0f0000c4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Dan and Ryan.  My understanding is also limited as I&#39;m new to this as well.</p>

<p>I posted a rather <a href="https://www.quantopian.com/posts/spy-and-sh-z-score-indicator">detailed explanation</a> of how I believe margin works in another thread.  That is based on Reg-T Margin which is going to be the case 99% of the time.  See the <a href="http://www.interactivebrokers.com/en/index.php?f=margin&amp;p=stk">margin description</a> at IB.  </p>

<p>The other kind of margin is <a href="http://www.interactivebrokers.com/en/?f=margin&amp;p=pmar">Portfolio Margin</a> which has a minimum account requirement of $110k and very different rules (certain baskets of securities are considered risk balanced and available margin goes way up).</p>

<p>Note that IB has additional margin available for same-day positions (details vary depending whether it is long or short and stock price).  But the end-of-day requirement is always the same: 50% margin for Reg-T accounts.  So I just use 50% margin as a simple, easy to understand default.  (There are some exceptions: leveraged ETFs have less margin available).</p>

<p>One nice thing about having extra margin for same-day positions is that we don&#39;t have to worry as much about the order of buys and sells.  Meaning that your algorithm can issue a sell order and a buy order at the same time and not care if the buy order executes first (unless the orders are huge).   That is to say if you are aiming to maintain a 50% margin level it&#39;s okay if you accidentally rely on another 15% of margin before it is returned via the accompanying sell order.  This greatly simplifies the logic in portfolio rebalancing strategies for instance.</p>

<p>Because of all of this I think any backtester imposed limits should be configurable (just like we do with commission and slippage model).  But I think the default model should be an end-of-day 50% margin limit.</p>

<p>Even without enforced limits we need accurate variables for capital used and available cash.  From that we can calculate buying power and margin levels.</p>

<p>My home-brew calculation determines the capital_used variable first and then the available cash.  This is only accurate at the start of handle_data and assumes no open orders (which tie up available cash and reduce new buying power).  Typically I take that &#39;cash&#39; variable and add or subtract any buys and sells for orders sent by my logic.  That way I know how much unencumbered cash I have at any particular moment.  Since I recalculate available cash every event I don&#39;t worry too much about commission fees.</p>

<p>The bottom line is the existing portfolio variables &#39;capital_used&#39; and &#39;cash&#39; are not useful for Reg-T margin calculations.  And I seriously doubt they are even useful in a Portfolio Margin account.  Making the change in calculation suggested by my home-brew formula would not impact the use of these variables in a non-margin account (e.g. long only position).  And the change would make the variables suddenly useful for Reg-T long/short positions.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='51d3ee42b321b186e9000065' id='51d3ee42b321b186e9000065'>
<a href='#51d3ee42b321b186e9000065'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1372843587000' class='quanto-date posted-at response-posted-at' href='#51d3ee42b321b186e9000065'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Dennis,</p>

<p>What&#39;s the status of this effort?  It sounds like you are on the right track for capturing the regulations and the Interactive Brokers rules.</p>

<p>I agree that Quantopian should consider some default settings that would conform with limits on a typical account.  Perhaps some sort of warning could be provided (e.g. on the returns chart, highlight time periods over which the rules were violated).</p>

<p>Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='51d421738d886cb0550000c0' id='51d421738d886cb0550000c0'>
<a href='#51d421738d886cb0550000c0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5129325375c044927f00003b'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f0d31a4138a1940012b68dbb3e54074c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5129325375c044927f00003b'>Dennis C</a>
</div>
<a UTCms='1372856693000' class='quanto-date posted-at response-posted-at' href='#51d421738d886cb0550000c0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant, from Dan&#39;s comment above it seems like they are willing to listen.  But as users we have to identify our needs clearly.  I think I&#39;ve gone a long way in that direction.  However I&#39;m not an expert and I may have overlooked some things.</p>

<p>It would be useful if someone here with more of a financial / broker background could weigh in.  I&#39;m coming at things from the perspective of a programmer so while it may seem <em>logical</em> to me that doesn&#39;t make it necessarily so.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='53aa612bbd99aa8b3d000133' id='53aa612bbd99aa8b3d000133'>
<a href='#53aa612bbd99aa8b3d000133'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5344e56e6378fccd920000fc'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/54eadb338b4da8620056904dfc790508?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5344e56e6378fccd920000fc'>Miles Garnsey</a>
</div>
<a UTCms='1403674925000' class='quanto-date posted-at response-posted-at' href='#53aa612bbd99aa8b3d000133'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Has there been any update to this topic recently? I asked a <a href="https://www.quantopian.com/posts/live-trading-limiting-total-strategy-exposure">similar question</a> in relation to live trading, however I haven&#39;t been able to find a solution. My issue is that there doesn&#39;t appear to be a way to limit your starting_cash in live trading that I can see - this makes it a little tricky to run an algorithm if you don&#39;t want it to be your only one! </p>

<p>In addition, your capital_used parameter doesn&#39;t seem to increase as the algorithm accumulates profits, so I&#39;m doubtful that this issue has been fixed yet?</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='58703b25cba687000ae4fe92' id='58703b25cba687000ae4fe92'>
<a href='#58703b25cba687000ae4fe92'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/584da0c18ab6f572050000c4'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/48796fcbbbeb695ef822ea241b9c713c?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/584da0c18ab6f572050000c4'>Andy Visser</a>
</div>
<a UTCms='1483750181000' class='quanto-date posted-at response-posted-at' href='#58703b25cba687000ae4fe92'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Any updates on this? I&#39;m working on an algo that often trades somewhat illiquid equities and constantly having problems with a negative cash balance as open orders do not affect the available cash.</p>

<p>I&#39;ve figured you could write a function to tally up the cost of all orders but that brings forth another problem. I don&#39;t think there&#39;s a way to find the limit price on a given order, only the sid and amount of shares. You could keep a list of orders and their prices as you place them but that&#39;s very cumbersome.</p>

<p>Anyways; thought I&#39;d check in and see if this has been worked out yet, thanks!  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/problem-understanding-context-dot-portfolio-dot-cash-and-capital-used'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/problem-understanding-context-dot-portfolio-dot-cash-and-capital-used'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#b1d7d4d4d5d3d0d2daf1c0c4d0dfc5dec1d8d0df9fd2dedc">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>

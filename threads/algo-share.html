<!DOCTYPE html>
<html>
<head>
<link href='i1.wp.com' rel='dns-prefetch'>
<link href='i2.wp.com' rel='dns-prefetch'>
<link href='i3.wp.com' rel='dns-prefetch'>
<meta content='2HgX9mcLHaPOX6sfaaAkhWtblhEB9yUNw4l6l46e1k4' name='google-site-verification'>
<link rel="shortcut icon" type="image/x-icon" href="external/favicon-q-ac1a76f2c200e9026b5b1147519bb4fab6256910588b831e2411bc6c7c1218c3.png" />
<title>
algo share
</title>
<meta content='Here&#39;s an algo I&#39;ve been working on, mainly to develop a framework and to learn.  Comments, questions, improvements welcome. I did not conceive of most of the factors (and some of them may be duds).  Credit to the original authors.' name='description'>
<link rel="stylesheet" media="all" href="external/quanto-base-bundle-e8eb6050172aa0d24124d5c24bac90b2cccd88b5b9c7742026c0e9efab038c6e.css" />
<link rel="stylesheet" media="all" href="external/quanto-posts-bundle-aab01368d3f82d8dafc94ee9eabb82e77dc8c9fbbffa952fdcdc744dfa523cf3.css" />
<script src="external/quanto_global-057218867db29d5768131af5d6fb3476cef098e7d9e655108befb903c7ee985e.js"></script>
<script src="external/posts_bundle-3dfd82fa469c393d752e461d837aec9e4e364ae39f49198e34a6626f2180fdf7.js"></script>
<link href='external/logo-q-180x180-0f5a6a439c99203ed4aea6f656e7604c543d287be43d8b17c7591c1131f09a59.png' rel='apple-touch-icon'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="5m7BD4+76b6wFgQ0RQ5PRXfb07uqx4UlEBRRsAXbcY+aCLdCLU07XQkLXQUK4ecxT1Xw0tALkD6SG4rar54TNA==" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<script>
//<![CDATA[
window.quanto_data={};quanto_data.bounce_back_params={"show_modal":null,"feedback_text":null};quanto_data.namespace="public";quanto_data.talib_info={"ADOSC":["Chaikin A/D Oscillator (Volume Indicators)",["fastperiod","3"],["slowperiod","10"]],"ADX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"ADXR":["Average Directional Movement Index Rating (Momentum Indicators)",["timeperiod","14"]],"APO":["Absolute Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"AROON":["Aroon (Momentum Indicators)",["timeperiod","14"]],"AROONOSC":["Aroon Oscillator (Momentum Indicators)",["timeperiod","14"]],"ATR":["Average True Range (Volatility Indicators)",["timeperiod","14"]],"BBANDS":["Bollinger Bands (Overlap Studies)",["timeperiod","5"],["nbdevup","2"],["nbdevdn","2"],["matype","0"]],"BETA":["Beta (Statistic Functions)",["timeperiod","5"]],"CCI":["Commodity Channel Index (Momentum Indicators)",["timeperiod","14"]],"CMO":["Chande Momentum Oscillator (Momentum Indicators)",["timeperiod","14"]],"CORREL":["Pearson's Correlation Coefficient (r) (Statistic Functions)",["timeperiod","30"]],"DEMA":["Double Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"DX":["Average Directional Movement Index (Momentum Indicators)",["timeperiod","14"]],"EMA":["Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"KAMA":["Kaufman Adaptive Moving Average (Overlap Studies)",["timeperiod","30"]],"LINEARREG":["Linear Regression (Statistic Functions)",["timeperiod","14"]],"LINEARREG_ANGLE":["Linear Regression Angle (Statistic Functions)",["timeperiod","14"]],"LINEARREG_INTERCEPT":["Linear Regression Intercept (Statistic Functions)",["timeperiod","14"]],"LINEARREG_SLOPE":["Linear Regression Slope (Statistic Functions)",["timeperiod","14"]],"MA":["Moving average (Overlap Studies)",["timeperiod","30"],["matype","0"]],"MACD":["Moving Average Convergence/Divergence (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["signalperiod","9"]],"MACDEXT":["MACD with controllable MA type (Momentum Indicators)",["fastperiod","12"],["fastmatype","0"],["slowperiod","26"],["slowmatype","0"],["signalperiod","9"],["signalmatype","0"]],"MACDFIX":["Moving Average Convergence/Divergence Fix 12/26 (Momentum Indicators)",["signalperiod","9"]],"MAX":["Highest values over a specified period (Math Operators)",["timeperiod","30"]],"MAXINDEX":["Index of highest value over a specified period (Math Operators)",["timeperiod","30"]],"MFI":["Money Flow Index (Momentum Indicators)",["timeperiod","14"]],"MIDPOINT":["Midpoint over period (Overlap Studies)",["timeperiod","14"]],"MIDPRICE":["Midpoint Price over period (Overlap Studies)",["timeperiod","14"]],"MIN":["Lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MININDEX":["Index of lowest value over a specified period (Math Operators)",["timeperiod","30"]],"MINMAX":["Lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINMAXINDEX":["Indexes of lowest and highest values over a specified period (Math Operators)",["timeperiod","30"]],"MINUS_DI":["Minus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"MINUS_DM":["Minus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"MOM":["Momentum (Momentum Indicators)",["timeperiod","10"]],"NATR":["Normalized Average True Range (Volatility Indicators)",["timeperiod","14"]],"PLUS_DI":["Plus Directional Indicator (Momentum Indicators)",["timeperiod","14"]],"PLUS_DM":["Plus Directional Movement (Momentum Indicators)",["timeperiod","14"]],"PPO":["Percentage Price Oscillator (Momentum Indicators)",["fastperiod","12"],["slowperiod","26"],["matype","0"]],"ROC":["Rate of change: ((price/prevPrice)-1)*100 (Momentum Indicators)",["timeperiod","10"]],"ROCP":["Rate of change Percentage: (price-prevPrice)/prevPrice (Momentum Indicators)",["timeperiod","10"]],"ROCR":["Rate of change ratio: (price/prevPrice) (Momentum Indicators)",["timeperiod","10"]],"ROCR100":["Rate of change ratio 100 scale: (price/prevPrice)*100 (Momentum Indicators)",["timeperiod","10"]],"RSI":["Relative Strength Index (Momentum Indicators)",["timeperiod","14"]],"SMA":["Simple Moving Average (Overlap Studies)",["timeperiod","30"]],"STDDEV":["Standard Deviation (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"STOCH":["Stochastic (Momentum Indicators)",["fastk_period","5"],["slowk_period","3"],["slowk_matype","0"],["slowd_period","3"],["slowd_matype","0"]],"STOCHF":["Stochastic Fast (Momentum Indicators)",["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"STOCHRSI":["Stochastic Relative Strength Index (Momentum Indicators)",["timeperiod","14"],["fastk_period","5"],["fastd_period","3"],["fastd_matype","0"]],"T3":["Triple Exponential Moving Average (T3) (Overlap Studies)",["timeperiod","5"],["vfactor","0.7"]],"TEMA":["Triple Exponential Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIMA":["Triangular Moving Average (Overlap Studies)",["timeperiod","30"]],"TRIX":["1-day Rate-Of-Change (ROC) of a Triple Smooth EMA (Momentum Indicators)",["timeperiod","30"]],"TSF":["Time Series Forecast (Statistic Functions)",["timeperiod","14"]],"ULTOSC":["Ultimate Oscillator (Momentum Indicators)",["timeperiod1","7"],["timeperiod2","14"],["timeperiod3","28"]],"VAR":["Variance (Statistic Functions)",["timeperiod","5"],["nbdev","1"]],"WILLR":["Williams' %R (Momentum Indicators)",["timeperiod","14"]],"WMA":["Weighted Moving Average (Overlap Studies)",["timeperiod","30"]]};quanto_data.nb_preview_url="https://notebooks-preview.prd.pub.quantopian.com";quanto_data.delay_nb_preview_load=false;
//]]>
</script>
<meta content='https://www.quantopian.com/posts/algo-share' property='og:url'>
<meta content='algo share' property='og:title'>

<input type="hidden" name="env" id="quanto-env" value="production" />
<meta content='550580758292093' property='fb:app_id'>
<meta content='https://www.quantopian.com/posts/algo-share' property='og:url'>
<meta content='https://media.quantopian.com/public/og-image-default.png' property='og:image'>
<meta content='algo share' property='og:title'>
<meta content='Here&#39;s an algo I&#39;ve been working on, mainly to develop a framework and to learn.  Comments, questions, improvements welcome. I did not conceive of most of the factors (and some of them may be duds).  Credit to the original authors.' property='og:description'>
</head>
<script type='application/ld+json'>
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "https://www.quantopian.com",
    "logo": "https://media.quantopian.com/logos/logo-q-press-red.png"
  }
</script>
<body class='' ontouchstart=''>
<div id='fb-root'></div>
<div class='wrapper'>
<div class='alert-v2 error'>
<div class='message'>
Quantopian's community platform is shutting down. Please read <a href="/posts/quantopians-community-services-are-closing">this post</a> for more information and <a href='/account#account'>download your code</a>.
</div>
</div>
<div class='navbar navbar-default navbar-static-top' id='app-navbar'>
<div class='container-fluid'>
<div class='navbar-header'>
<button class='navbar-toggle collapsed' data-target='#app-navbar-collapse' data-toggle='collapse'>
<span class='icon hamburger-menu'></span>
</button>
<a class='navbar-brand' href='/home'>
<img class='logo-image async-image' data-src='external/logo-q-white-b141ea6018546e5a4ecc3d10d8440ec076fc4385764e948b322828cc70950a76.svg'>
</a>
</div>
<div class='collapse navbar-collapse' id='app-navbar-collapse'>
<ul class='nav navbar-nav navbar-right'>
<li class='dropdown quanto-dropdown-new'>
<li>
<a class='header' href='/docs'>
Documentation
</a>
</li>
<li class='dropdown quanto-dropdown-new'>
<a class='header' data-toggle='dropdown' href='#'>
Learn
</a>
<ul class='dropdown-menu'>
<li>
<a class='mixpanel-button' data-event='main nav getting started clicked' href='/tutorials/getting-started'>Getting Started</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav tutorials clicked' href='/tutorials'>Tutorials</a>
</li>
<li>
<a class='mixpanel-button' data-event='main nav lectures clicked' href='/lectures'>Lectures</a>
</li>
</ul>
</li>
<li>
<a class='header' href='/posts' id='forum-link'>
Forum
</a>
</li>
<li>
<a class="header" href="/signin?return_to=/posts/algo-share">Log In</a>
</li>
</li>

</ul>
</div>
</div>
</div>
<script>
  $(document).ready(function () {
    quanto.instances.fm = new quanto.FeedbackManager();
    quanto.instances.hm = new quanto.headerManager();
  })
</script>


<div class='content content-area new-style'>
<input type="hidden" name="page-id" id="page-id" value="postatomic" />
<script src="external/MathJax.js?config=TeX-AMS_HTML-full.js,Safe" async="async"></script>
<div class='container page-container post-atomic'>
<input id='parent-post-id-val' type='hidden' value='5be885bbd410996a96d4ced9'>
<div class='post-container' data-post-id='5be885bbd410996a96d4ced9' id='5be885bbd410996a96d4ced9'>
<div class='back-button back-to-community'>Back to Community</div>
<div class='post-title'>algo share</div>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<span class='posted-at'>posted </span>
<span UTCms='1541965243000' class='quanto-date posted-at'></span>
<div class='pull-right other-actions'>
<div class='dropup inline-block'>
<div class='dropdown share-control other-action-link'>
<div data-toggle='dropdown'>
<div class='share-image'></div>
Share
</div>
<ul class='dropdown-menu share-options-menu'>
<li>
<a class='share-row' href='https://twitter.com/intent/tweet?text=algo share&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Falgo-share%3Futm_source%3Dwebsite_share%26utm_campaign%3Dalgo-share%26utm_medium%3Dtwitter&amp;via=quantopian'>
<i class='icon icon-twitter'></i>
Share on Twitter
</a>
</li>
<li>
<div class='share-row facebook-button'>
<i class='icon icon-facebook'></i>
Share on Facebook
</div>
</li>
<li>
<div class='share-row linkedin-button' data-share-url='https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.quantopian.com%2Fposts%2Falgo-share%3Futm_source%3Dwebsite_share%26utm_campaign%3Dalgo-share%26utm_medium%3Dlinkedin&amp;title=algo+share+%28Grant+Kiehne%29&amp;source=Quantopian'>
<i class='icon icon-linkedin'></i>
Share on LinkedIn
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class='tags tag-row'>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='API' data-tag-id='55c50e7d8d4710ec6e000001' href='/posts/tag/API/newest'>API</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Seeking Help' data-tag-id='55c50e7d8d4710ec6e000003' href='/posts/tag/Seeking-Help/newest'>Seeking Help</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Contest' data-tag-id='55c50e7d8d4710ec6e000006' href='/posts/tag/Contest/newest'>Contest</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Tools and Tips' data-tag-id='55c50e7d8d4710ec6e000011' href='/posts/tag/Tools-and-Tips/newest'>Tools and Tips</a>
<a class='tag mixpanel-button' data-event='tag click' data-mixpanel='Hedge Fund' data-tag-id='55c50e7d8d4710ec6e000014' href='/posts/tag/Hedge-Fund/newest'>Hedge Fund</a>
</div>
<input type="hidden" name="social_fb_post_link" id="social_fb_post_link" value="https://www.quantopian.com/posts/algo-share?utm_source=website_share&amp;utm_campaign=algo-share&amp;utm_medium=facebook" />
<input type="hidden" name="social_post_image" id="social_post_image" value="external/logo-q-red-outline.png" />
<input type="hidden" name="social_post_author" id="social_post_author" value="Grant Kiehne" />
<div class='body-text'>
<div class='body-text-container post-body'><p>Here&#39;s an algo I&#39;ve been working on, mainly to develop a framework and to learn.  Comments, questions, improvements welcome.</p>

<p>I did not conceive of most of the factors (and some of them may be duds).  Credit to the original authors.  </p>
</div>
</div>
</div>

</div>

<div class='container page-container post-atomic'>
<div class='section-header reply-header'>
<div class='reply-title'>89 responses</div>
</div>
<div class='replies'>
<div class='post-container response-container' data-post-id='5be8a382f6a295004bae681b' id='5be8a382f6a295004bae681b'>
<a href='#5be8a382f6a295004bae681b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1541972866000' class='quanto-date posted-at response-posted-at' href='#5be8a382f6a295004bae681b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>What an impressive effort!  Looks nice during the crash too. What if any are your reservations?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5be8adfbf6a295004bae6868' id='5be8adfbf6a295004bae6868'>
<a href='#5be8adfbf6a295004bae6868'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50842732cb5e1a02000000d1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f86535a7fafab6b7d903fc1461362f0a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50842732cb5e1a02000000d1'>James Villa</a>
<span class='badge medal'></span>
</div>
<a UTCms='1541975547000' class='quanto-date posted-at response-posted-at' href='#5be8adfbf6a295004bae6868'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Nice one, Grant! Try decreasing your position size (increase the number of stocks traded) and see if your Sharpe increases and portfolio volatility decreases. If it does, then it is  good sign that the algo is able to adapt under a more diversified positioning. Best!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5be95df6505d18004294deba' id='5be95df6505d18004294deba'>
<a href='#5be95df6505d18004294deba'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1542020598000' class='quanto-date posted-at response-posted-at' href='#5be95df6505d18004294deba'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Zenothestoic &amp; James -</p>

<p>I&#39;m mainly interested in the overall architecture at this point, and isolating a handful of sensible &quot;control&quot; parameters that would apply to any algo, and then figuring out how to set them in a systematic way (without &quot;over-fitting&quot;).</p>

<p>One thing I think I uncovered is that Pipeline has a limit on the number of custom factors it will support.  This is why I have two pipelines for the factors--really ugly, so any insight in this area would be helpful.</p>

<p>For parameters, I have:</p>

<pre><code>#############################  
# algo settings

WIN_LIMIT = 0 # winsorize limit in factor preprocess function  
FACTOR_AVG_WINDOW = 3 # window length of SimpleMovingAverage applied to each factor

# Optimize API constraints  
MAX_POSITION_SIZE = 0.01 # set to 0.01 for ~100 positions  
BETA_EXPOSURE = 0  
USE_MaxTurnover = True # set to True to use Optimize API MaxTurnover constraint  
MIN_TURN = 0.15 # Optimize API MaxTurnover constraint (if optimize fails, incrementally higher constraints will be attempted)

#############################  
</code></pre>

<p>I&#39;m thinking I should probably just set a fixed Optimize API beta constraint of zero, and not be tempted to fiddle with it (e.g. make &quot;beta bets&quot; for contest entries).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5be9685f3a74c60049e1b0f6' id='5be9685f3a74c60049e1b0f6'>
<a href='#5be9685f3a74c60049e1b0f6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1542023263000' class='quanto-date posted-at response-posted-at' href='#5be9685f3a74c60049e1b0f6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I wonder whether Quantopian would say that, given the number of factors used, it is not possible to construct a fundamental argument as to why this works? And thus reject the algorithm for opacity?</p>

<p>I have no idea. Perhaps they could comment.</p>

<p>How many staff do they have now and what do they all do? Given the in house skills they have one is bound to wonder whether they are using mostly in house algos for their fund?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bea0d9d6cc29025fb4904bb' id='5bea0d9d6cc29025fb4904bb'>
<a href='#5bea0d9d6cc29025fb4904bb'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1542065565000' class='quanto-date posted-at response-posted-at' href='#5bea0d9d6cc29025fb4904bb'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Zenothestoic - </p>

<p>Regarding your concern about &quot;opacity&quot; the relevant requirement from <a href="https://www.quantopian.com/get-funded" rel="nofollow">https://www.quantopian.com/get-funded</a> is:</p>

<blockquote>
<p>Strategic Intent  </p>

<p>One of the most common ways to overfit is to just try a ton of<br>
variants until one works. We’re looking for algorithms which have a<br>
clear intent in the idea as opposed to algorithms which just happen to<br>
work with no explanation. We’d like you to be able to explain the<br>
original idea and intent of the strategy to us before we license it.</p>
</blockquote>

<p>In this case, I think the idea would be for each factor to have some sense behind it, along with each factor to have a decent level of stand-alone predictive power (e.g. analyzed with Alphalens).  The combination technique (sum of z-score normalized factors) is simple, and so I wouldn&#39;t think it would require any justification beyond describing it.</p>

<p>The large number of factors is more of an experiment in cobbling together factors.  I have seen, however, a benefit in smoothing out returns, and extending to a larger number of stocks with added factors, although I have not gone about this systematically.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bea14ca505d184bcf94dee7' id='5bea14ca505d184bcf94dee7'>
<a href='#5bea14ca505d184bcf94dee7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50842732cb5e1a02000000d1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f86535a7fafab6b7d903fc1461362f0a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50842732cb5e1a02000000d1'>James Villa</a>
<span class='badge medal'></span>
</div>
<a UTCms='1542067402000' class='quanto-date posted-at response-posted-at' href='#5bea14ca505d184bcf94dee7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Grant,</p>

<blockquote>
<p>One thing I think I uncovered is that Pipeline has a limit on the number of custom factors it will support. This is why I have two pipelines for the factors--really ugly, so any insight in this area would be helpful.</p>
</blockquote>

<p>To overcome this limitation and perhaps be able to run just one pipeline, one idea is to group factors with similar &quot;themes&quot; by say, adding or averaging them into one factor.  For example, I see a lot of growth factors, you can combine them into one.  Doing this will also make explaining strategic intent easier by saying for example that you have discovered that when you combine growth factors with value factors and momentum indicators, it creates a consistent, predictive  alpha. </p>

<p>One of the pitfalls of too many factors is more often than not, they&#39;re just noise cancelling each other out and those with the &quot;true&quot; predictive powers are the ones that churns out the signal.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bea1650f593540a3b9eb63f' id='5bea1650f593540a3b9eb63f'>
<a href='#5bea1650f593540a3b9eb63f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1542067792000' class='quanto-date posted-at response-posted-at' href='#5bea1650f593540a3b9eb63f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant,</p>

<p>I&#39;m very impressed as well, and grateful you&#39;re sharing your work! Quite generous of you I think.</p>

<p>I&#39;m curious to hear your view around &#39;model complexity&#39;. To me, the benefit of adding a few uncorrelated factors is pretty, clear - higher IR, higher risk-adjusted IC, lower volatility, etc, but I wonder if, at some point, there&#39;s any negative effects when the model gets overly complex (to me, it&#39;s very difficult to understand what the heck is going on if I add too many factors). </p>

<p>In essence, if we assume that ALL models are wrong, and at least slightly fitted on noise (or certain market regimes), then if we combine them into a &#39;mega-factor&#39; (e.g. as with the 101 Alpha project), then wouldn&#39;t the &#39;noise fitting&#39; increase as well in the combined model? I hope I&#39;m wrong here...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bea5822505d180bf494df9f' id='5bea5822505d180bf494df9f'>
<a href='#5bea5822505d180bf494df9f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5971e2308bc634000d022f24'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3fff8e67995978b6170deb9d9001a7b6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5971e2308bc634000d022f24'>Joakim Arvidsson (Cream Mongoose)</a>
<span class='badge medal'></span>
</div>
<a UTCms='1542084642000' class='quanto-date posted-at response-posted-at' href='#5bea5822505d180bf494df9f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Also, do you reckon that the trick to use factors that have different ideal holding periods (e.g. 1D for one factor, 3D for another, and 5D for yet another) in the same strategy, is to use the SMA for each factor with an ideal holding period longer than 1D (i.e. SMA5 for factors that are best held for 5D)? </p>

<p>Or am I thinking about this incorrectly?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bea700af5935434d59eb31a' id='5bea700af5935434d59eb31a'>
<a href='#5bea700af5935434d59eb31a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bd66af07d33f1003f2e7190'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9b48c7898c9fb40a67552322d433f6f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bd66af07d33f1003f2e7190'>Adam Wu</a>
</div>
<a UTCms='1542090762000' class='quanto-date posted-at response-posted-at' href='#5bea700af5935434d59eb31a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Interesting strategy, couple of thoughts:</p>

<ol>
<li>The large set of factors would help smooth returns as you found, but can also conceal the signal and introduce noise. For example, if we added a factor that simply chooses a random number between 1 and 100, that would &quot;smooth&quot; returns but does this by weakening the (possibly inaccurate) signals.<br></li>
<li>Some of these factors may be highly correlated, which introduces a problem of multicollinearity and inaccurate estimates for out-of-sample data. It would be interesting to see a heatmap of the correlations between these factors.<br></li>
<li>Some of these factors likely have competing signals. For example, there is both 2-yr growth and 8-yr growth ratios. Even if they generated alpha by themselves, they would have different prediction horizons (i.e. the 8-yr growth might do better with less frequent rebalancing). Instead of combining them into one strategy, I think having separate strategies with a common theme or finding some function of the two (such as 2-yr growth / 8-yr growth) would be more robust.<br></li>
<li>Assuming not all the factors are useful, a straight z-score combination might weaken the signal from the actual predictive ones. I&#39;ve fed most of the factors in your set into a machine learning classification for their accuracy in predicting long/short signals during the time period:<br>
<img src="https://image-proxy.quantopian.com/8b10660d9eeb07ec6099e7f63c15b9954e25b37a/68747470733a2f2f692e696d6775722e636f6d2f4b7852635144562e706e67" /><br>
A very strong signal from peg_ratio for example, may weaken the predictive signal from growthscore if using a simple combination.<br></li>
</ol>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bea88af495ae90041b5f56c' id='5bea88af495ae90041b5f56c'>
<a href='#5bea88af495ae90041b5f56c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1542097071000' class='quanto-date posted-at response-posted-at' href='#5bea88af495ae90041b5f56c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Does the machine learning algorithm produce anything better or different than the simple approach used in Alphalens? Is this PCA? I assume the linear regression of alphalens could just be redrafted to assess the contribution of each factor individually the same way it does at present with the factors it uses as guidelines to assess alpha?</p>

<p>Assuming 2007 and 2008 are truly &quot;out of sample&quot; as opposed to not just used in the above test, then out of sample looks pretty impressive when you run the algo through this period of turmoil.  What does 2018 look like? Perhaps Quantopian will be kind enough to tell us?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bea8c19495ae90041b5f58f' id='5bea8c19495ae90041b5f58f'>
<a href='#5bea8c19495ae90041b5f58f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1542097945000' class='quanto-date posted-at response-posted-at' href='#5bea8c19495ae90041b5f58f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Interesting to see &quot;growth&quot;, &quot;debt/equity&quot; and &quot;momentum&quot; scoring highest. Unsurprisingly.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bea9c6d2b69fc003f41afd7' id='5bea9c6d2b69fc003f41afd7'>
<a href='#5bea9c6d2b69fc003f41afd7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1542102125000' class='quanto-date posted-at response-posted-at' href='#5bea9c6d2b69fc003f41afd7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>All -</p>

<p>Thanks for the stimulating feedback.  I need to mull it over a bit before responding.</p>

<p>Overall, I&#39;m thinking that, along the lines of the <a href="https://arxiv.org/ftp/arxiv/papers/1601/1601.00991.pdf" rel="nofollow">101 Alphas</a> there should be some systematic way of dealing with the &quot;proliferation of alphas – albeit mostly faint and ephemeral.&quot;  I figure the probability of my discovering some miracle factor, and getting paid by Q for it is pretty slim; they are looking for full-up, fancy, multi-factor stand-alone algos.</p>

<p>@ James - Thanks for the idea of amalgamating similar factors to reduce the number of factors, as a work-around to the apparent Pipeline limitation (I&#39;d thought of this, but then it really mucks up the idea of having individual alpha factors described on <a href="https://blog.quantopian.com/a-professional-quant-equity-workflow/" rel="nofollow">https://blog.quantopian.com/a-professional-quant-equity-workflow/</a>) .  I&#39;ve pinged Q support for guidance, since there seems to be some undocumented limit to the number of custom factors supported by Pipeline.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bea9d1f4aada0003e52ee54' id='5bea9d1f4aada0003e52ee54'>
<a href='#5bea9d1f4aada0003e52ee54'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1542102303000' class='quanto-date posted-at response-posted-at' href='#5bea9d1f4aada0003e52ee54'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>I figure the probability of my discovering some miracle factor, and getting paid by Q for it is pretty slim; they are looking for full-up, fancy, multi-factor stand-alone algos.</p>
</blockquote>

<p>I think you are right.  Whatever the rights and wrongs of what you have done with this algo its performance seems excellent in good times and bad. &quot;Can it last&quot; is I suppose the main question which comes to mind? I hope so!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5beb3a20480c83004959f937' id='5beb3a20480c83004959f937'>
<a href='#5beb3a20480c83004959f937'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/58a629bc0ee39f0736043f98'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/00f9ef5a775629cae60a12144bb83ec5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/58a629bc0ee39f0736043f98'>Indigo Monkey</a>
<span class='badge medal'></span>
</div>
<a UTCms='1542142496000' class='quanto-date posted-at response-posted-at' href='#5beb3a20480c83004959f937'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>My suggestion would be to get rid of the highly correlated factors by either combining them into one factor or by picking the best performing factor of the highly correlated group.  Without testing your factors, I think ROA growth 8yr and ROA growth 2yr are highly correlated and probably ROIC growth is too. Also, when looking at Adam W&#39;s graph of feature importances the last three weakest features probably should get dropped. I doubt those features would hold up if you tested each of them in Alphalens.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5beb6f874aada0004452f46e' id='5beb6f874aada0004452f46e'>
<a href='#5beb6f874aada0004452f46e'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1542156167000' class='quanto-date posted-at response-posted-at' href='#5beb6f874aada0004452f46e'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>So is there a standard &quot;recipe&quot; for dealing with correlations?  As an example, say I have three factors, A, B, &amp; C.  If A &amp; B are perfectly correlated (essentially the same factor), and C is uncorrelated to both A and B, then it is simple: drop either A or B, and make the portfolio A &amp; C (or B &amp; C).  But how would one handle things in the non-ideal case of some degree of pairwise correlation, A-to-B , A-to-C, and B-to-C?  How should the portfolio be constructed?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5beb74424aada03f1752eea6' id='5beb74424aada03f1752eea6'>
<a href='#5beb74424aada03f1752eea6'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bd66af07d33f1003f2e7190'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9b48c7898c9fb40a67552322d433f6f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bd66af07d33f1003f2e7190'>Adam Wu</a>
</div>
<a UTCms='1542157378000' class='quanto-date posted-at response-posted-at' href='#5beb74424aada03f1752eea6'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I don&#39;t think there is a standard way of approaching this, but here are two ideas:</p>

<ol>
<li>Keep the factors that provide the most signal (measured by IC, alpha, and other metrics you deem important) with the minimal correlation to other factors, while dropping the rest.<br></li>
<li>Keep all factors, but use a different weighting strategy when combining the factors. A simple equal-weight combination would overweight the correlated factors, so doing a machine learning classification, PCA, factor analysis, decision trees, etc would be very useful.</li>
</ol>

<p>The second approach would likely have better predictability, since there is still some information even in highly correlated factors (assuming not perfectly correlated). However the first approach would probably be more robust with less risk of overfitting, thus doing better in different market conditions. It is ultimately up to your best judgment whether to keep correlated factors, though if you are backtesting over such a long horizon, market regimes will likely change and so robustness may be more important. If you were to backtest over shorter horizons (i.e. last 2 years such as for the contest), I think predictability may be better at the potential cost of long-term profitability.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5beb780e4aada03b3752eda0' id='5beb780e4aada03b3752eda0'>
<a href='#5beb780e4aada03b3752eda0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bd66af07d33f1003f2e7190'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9b48c7898c9fb40a67552322d433f6f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bd66af07d33f1003f2e7190'>Adam Wu</a>
</div>
<a UTCms='1542158350000' class='quanto-date posted-at response-posted-at' href='#5beb780e4aada03b3752eda0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Since your algo was trained until November 2017, we can treat the last year as out-of-sample data essentially. (A few factors had to be removed as they referenced the Factset data which is no longer updated apparently, but this shouldn&#39;t have too much of an impact given the large set of factors)</p>

<p>The algo still performs very well, though observe the out-of-sample 12-month sharpe ratio (1.5) has dropped from the in-sample 2017 Sharpe (2.3), along with annual returns slightly (7.6%) compared to in-sample (12.7%). The further out-of-sample it gets, the variability of expected returns would increase. Addressing the correlated factors could help significantly and make the algo perform even better.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5beb8c774aada043d452edec' id='5beb8c774aada043d452edec'>
<a href='#5beb8c774aada043d452edec'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bd66af07d33f1003f2e7190'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9b48c7898c9fb40a67552322d433f6f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bd66af07d33f1003f2e7190'>Adam Wu</a>
</div>
<a UTCms='1542163575000' class='quanto-date posted-at response-posted-at' href='#5beb8c774aada043d452edec'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s a modified version of the algo weighted by decision trees. The returns seem to be more robust than the base algo, for example the Sharpe is more stable and reverts around the mean rather than following a trend. It could be interesting to see the results of directly addressing the correlations of factors and dropping and/or combining them.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bebe6c3d28fa5004723c23b' id='5bebe6c3d28fa5004723c23b'>
<a href='#5bebe6c3d28fa5004723c23b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/52b0e0e0271a27fc88000049'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e5451406e743420c700eb2b054b2fc57?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/52b0e0e0271a27fc88000049'>Blue Seahawk</a>
</div>
<a UTCms='1542186691000' class='quanto-date posted-at response-posted-at' href='#5bebe6c3d28fa5004723c23b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The pre-preprocess: Is there a simple way to forward fill everything after <code>out</code> before computations are done on them? Example</p>

<pre><code>    def compute(self, today, assets, out, cost_of_revenue, sales):
</code></pre>

<p>I&#39;ve had some good results with <a href="https://www.quantopian.com/posts/forward-filling-nans-in-pipeline-custom-factors" rel="nofollow">nanfill</a> although in this case so much work I haven&#39;t tried it.<br>
<em>Maybe Q could offer a switch for forward-filled fundamentals replacing nan with the previous value.</em></p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bebed23310abc0040af78b2' id='5bebed23310abc0040af78b2'>
<a href='#5bebed23310abc0040af78b2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1542188323000' class='quanto-date posted-at response-posted-at' href='#5bebed23310abc0040af78b2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>The further out-of-sample it gets, the variability of expected returns would increase.</p>
</blockquote>

<p>How very paradoxical and typical of systematic financial market trading. A bunch of intelligent people go to extraordinary lengths to produce Alphalens, Zipline and Pyfolio.</p>

<p>The stated aim is to produce market neutral algos which fare well (smoothly) in up and down markets.</p>

<p>To that end various in/out of sample routines are suggested to make sure that will continue to be the case.  It is proposed that fundamental factors should be used as predictors. What more sensible sounding scheme than that? Over the long terms earnings growth and a strong balance sheet are all that counts. Without those a stock will eventually wither and die.</p>

<p>And yet it is still suggested that &quot;The further out-of-sample it gets, the variability of expected returns would increase.&quot;</p>

<p>Are there no constants in financial markets? Nothing we can count on? Are we eternally doomed to design complex systems to fail? It would seem so.  A system will have its time in the sun and must then be consigned to the dustbin.  That is not at all what was envisaged.  The whole idea of market neutral is that it should survive and prosper. Equal amounts of long and short.   Equal or at least limited exposure to any one sector and trading style. A carefully curated universe of stocks (well that at least has to change day by day).</p>

<p>Do we care? Should we care ?</p>

<p>Well we humans are such short term animals probably not.  As long as our algo lasts long enough for us to fill our pockets on fees we should be more than happy. </p>

<p>Should we care to ponder immortality in the context of trading and investment we might be forced to adopt a different and less fancy approach.  Who is to say that Morningstar sector definitions have much validity today let alone tomorrow? Remember how the staid telephone utility companies suddenly morphed into debt crippled monsters back in the early 2000s.  And the coded definitions of momentum, value or other styles. Do they hold? Are they universal?</p>

<p>Am I a deep cynic? A Jeremiah? If so, do I have reason to be or am I just inadequate at finding the golden key to systematic immortality?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bebf374d9a1771462d7693f' id='5bebf374d9a1771462d7693f'>
<a href='#5bebf374d9a1771462d7693f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1542189940000' class='quanto-date posted-at response-posted-at' href='#5bebf374d9a1771462d7693f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p><a href="https://zenothestoic.com/2018/11/14/seeking-the-eternal-in-systematic-investment/" rel="nofollow">Seeking the Eternal in Systematic Investment</a></p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bec18ee2b69fc0048359044' id='5bec18ee2b69fc0048359044'>
<a href='#5bec18ee2b69fc0048359044'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1542199534000' class='quanto-date posted-at response-posted-at' href='#5bec18ee2b69fc0048359044'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Zenothestoic  -</p>

<p>I was a bit surprised by the push by Q for users to do a deep dive into fundamentals.  I figured that all of the data are in the public domain (or at least readily accessible by the financial industry), and lagging indicators.  Also, the data are relatively low-frequency (quarterly/annual).  So one would really want something like a ~50 year back test horizon, versus &lt; 20 years (and without the longer time horizon, there could be a risk of over-fitting, due paucity of data).</p>

<p>The other question in my mind is how accurately fundamentals express the true state of a business.  Executives probably know better than hedge funds how fundamentals impact share price and do everything they can to present a pretty picture.  If there are risks that aren&#39;t required by law to be captured in the metrics, the risks are likely to be obscured (and whatever risks are obvious in the fundamentals have already been priced by the market).</p>

<p>Perhaps there are still scraps of inefficiency left in fundamentals, but it isn&#39;t intuitive.  At a high level, what is the &quot;strategic intent&quot; for using fundamentals in the first place?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bec367a79d2860048c245bd' id='5bec367a79d2860048c245bd'>
<a href='#5bec367a79d2860048c245bd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1542207098000' class='quanto-date posted-at response-posted-at' href='#5bec367a79d2860048c245bd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Even Bachelier in his 1900 thesis, stated that variance was proportional to the square-root of time. So, we should not be surprised if it does increase with time.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bec414ecdb13a003e4c7b0a' id='5bec414ecdb13a003e4c7b0a'>
<a href='#5bec414ecdb13a003e4c7b0a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1542209870000' class='quanto-date posted-at response-posted-at' href='#5bec414ecdb13a003e4c7b0a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant<br>
A mistake I have always made is not to give the customer what he wants.  The question here at Quantopian is can any of us provide them with the all weather miracle they and Stevie Wonder desire?</p>

<p>If so (and if you can put up with working at the pace of a constipated snail in the research environment)  then do it.</p>

<p>I have never learnt that lesson. I have never striven to give any customer what they seek. My mistake.  At the end of the day that is all that is necessary here. Whether I personally believe in the goodness and rightness of their approach should take a back seat to my desire to sell them an algorithm. </p>

<p>If Alphalens actually ran properly I might try for the first time in many years to do the sensible thing, shut up, and give them what they have asked for.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bec51a079d286004ec246a0' id='5bec51a079d286004ec246a0'>
<a href='#5bec51a079d286004ec246a0'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb5b36750a6132299e9c544'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f747e2e9e662b2b6e5affdb2da57b7ca?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb5b36750a6132299e9c544'>Ben</a>
</div>
<a UTCms='1542214048000' class='quanto-date posted-at response-posted-at' href='#5bec51a079d286004ec246a0'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@grant - Your algo share  has really thrown the cat amongst the pigeons. Thank you. I have been struggling to find a way to  manage a large number of custom factors (in my case multiple instances of same factor) . I&#39;ve now relocated my custom factor into your framework!</p>

<p>Being a complete novice, I&#39;m just repeating 30 copies of my custom factor (with the different parameters hard coded in each one) in place of your alpha factors.</p>

<p>I just wonder if either you or one of the other proper developers here might know a more graceful way of achieving this?</p>

<p>I attach a notebook with some code provided by @cal showing how to create multiple instances of same custom factor (the custom factor is just a dummy).</p>

<p>Thanks again.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bec984779d2860423c24736' id='5bec984779d2860423c24736'>
<a href='#5bec984779d2860423c24736'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1542232135000' class='quanto-date posted-at response-posted-at' href='#5bec984779d2860423c24736'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Adam W. -</p>

<p>Thanks for the example of weight by decision trees (<a href="https://www.quantopian.com/posts/algo-share#5beb8c774aada043d452edec" rel="nofollow">https://www.quantopian.com/posts/algo-share#5beb8c774aada043d452edec</a>).</p>

<p>Would you be willing to share the code?  Or at least provide an outline of how you do it?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bed50319db0ce2f3011cd80' id='5bed50319db0ce2f3011cd80'>
<a href='#5bed50319db0ce2f3011cd80'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1542279217000' class='quanto-date posted-at response-posted-at' href='#5bed50319db0ce2f3011cd80'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Joakim -</p>

<blockquote>
<p>Also, do you reckon that the trick to use factors that have different ideal holding periods (e.g. 1D for one factor, 3D for another, and 5D for yet another) in the same strategy, is to use the SMA for each factor with an ideal holding period longer than 1D (i.e. SMA5 for factors that are best held for 5D)?  </p>

<p>Or am I thinking about this incorrectly?</p>
</blockquote>

<p>I got the idea for using the SMA from Thomas W.&#39;s recent post (<a href="https://www.quantopian.com/posts/an-updated-method-to-analyze-alpha-factors" rel="nofollow">https://www.quantopian.com/posts/an-updated-method-to-analyze-alpha-factors</a>).  I think you are correct that each factor could have its own SMA window length (or more generally low-pass filter frequency cut-off).  There&#39;s also the possibility of smoothing the combined alpha, and the output of the Optimize API.</p>

<p>I think the idea of doing daily portfolio updates is the way to go, but I have concern that the Optimize API is adding unproductive noise.  It seems that one would want to smooth the final output of the Optimize API.  The problem is that the optimizer is outside of Pipeline, and so there is no access to the trailing window; one has be accumulated in <code>context</code>.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bedbac673270a0042b33551' id='5bedbac673270a0042b33551'>
<a href='#5bedbac673270a0042b33551'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ae9fc7db16b9339bf0d4997'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/96d136f0830e9bd9d16be17119689cc0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ae9fc7db16b9339bf0d4997'>Leo c</a>
<span class='badge medal'></span>
</div>
<a UTCms='1542306502000' class='quanto-date posted-at response-posted-at' href='#5bedbac673270a0042b33551'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Did you encounter out of memory? I did with my many fundamental factors  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5beea9bbb165c8038b5c0ba3' id='5beea9bbb165c8038b5c0ba3'>
<a href='#5beea9bbb165c8038b5c0ba3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1542367675000' class='quanto-date posted-at response-posted-at' href='#5beea9bbb165c8038b5c0ba3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Leo c - I have not hit memory limitations.</p>

<p>@ All - if anyone has insight into this error please let me know:</p>

<p><a href="https://www.quantopian.com/posts/pipeline-error-valueerror-too-many-inputs-limit-on-number-of-custom-factors" rel="nofollow">https://www.quantopian.com/posts/pipeline-error-valueerror-too-many-inputs-limit-on-number-of-custom-factors</a></p>

<p>Breaking up the code into separate Pipelines just to support a relatively large number of factors does not seem like it should be necessary.  Perhaps I have a mistake in my implementation?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5beec4dc501b46003cbc2512' id='5beec4dc501b46003cbc2512'>
<a href='#5beec4dc501b46003cbc2512'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1542374620000' class='quanto-date posted-at response-posted-at' href='#5beec4dc501b46003cbc2512'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Zenothestoic -</p>

<blockquote>
<p>How many staff do they have now and what do they all do? Given the in house skills they have one is bound to wonder whether they are using mostly in house algos for their fund?</p>
</blockquote>

<p>I&#39;m not sure it matters.  The Q contest is still running and paying out, and reportedly, algos are getting funded (see <a href="https://www.quantopian.com/posts/15-contest-entrants-invited-to-license-their-strategies-to-quantopian" rel="nofollow">https://www.quantopian.com/posts/15-contest-entrants-invited-to-license-their-strategies-to-quantopian</a>).  Eventually one might expect a saturation point, but we aren&#39;t there yet.</p>

<p>I think more importantly, there is a question of what is already in the fund, and how users can evaluate their algos so as not to be rejected due to a too strong correlation with existing fund algos.  There used to be a &quot;uniqueness&quot; requirement on <a href="https://www.quantopian.com/get-funded" rel="nofollow">https://www.quantopian.com/get-funded</a>, but it got dropped.  However, it is reasonable to assume that one is implied.</p>

<p>Recently there was guidance on the need for more fundamentals-based algos.  I&#39;m not sure if the request was for algos based solely on fundamentals, or if it was just a prod to dive into the Factset data, and combine new fundamental factors with existing technical and alternative ones.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bef3afcc43b81004ea93f4a' id='5bef3afcc43b81004ea93f4a'>
<a href='#5bef3afcc43b81004ea93f4a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ae9fc7db16b9339bf0d4997'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/96d136f0830e9bd9d16be17119689cc0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ae9fc7db16b9339bf0d4997'>Leo c</a>
<span class='badge medal'></span>
</div>
<a UTCms='1542404860000' class='quanto-date posted-at response-posted-at' href='#5bef3afcc43b81004ea93f4a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Adam</p>

<p>May I know how you do the features importance or correlation among the factors?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf1644cc4025c0043faca65' id='5bf1644cc4025c0043faca65'>
<a href='#5bf1644cc4025c0043faca65'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1542546508000' class='quanto-date posted-at response-posted-at' href='#5bf1644cc4025c0043faca65'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>One potential weighting scheme would be to compare on a daily basis each alpha vector to the remaining naively combined alpha factors with a similarity metric (e.g. <a href="https://en.wikipedia.org/wiki/Cosine_similarity" rel="nofollow">cosine similarity</a>).  Then the factors could be weighted by inverse similarity:</p>

<p>alpha_combined = alpha_1/abs(similarity_1) + alpha_2/abs(similarity_2) + ... + alpha_N/abs(similarity_N)</p>

<p>or</p>

<p>alpha_combined = alpha_1/similarity_1 + alpha_2/similarity_2 + ... + alpha_N/similarity_N</p>

<p>Computationally, this appears to be easy-peasy.  However, it just occurred to me and have no idea if it makes any sense whatsoever.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf46f4a3f88ef0048e55de9' id='5bf46f4a3f88ef0048e55de9'>
<a href='#5bf46f4a3f88ef0048e55de9'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ae9fc7db16b9339bf0d4997'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/96d136f0830e9bd9d16be17119689cc0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ae9fc7db16b9339bf0d4997'>Leo c</a>
<span class='badge medal'></span>
</div>
<a UTCms='1542745930000' class='quanto-date posted-at response-posted-at' href='#5bf46f4a3f88ef0048e55de9'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I see that it is equal factor weighting. May I know how to add weights to certain factors ie 30% ROA, 20% STA and 50% on the rest of the factors? </p>

<p>I am thinking at the &quot;re-balance&quot; function?</p>

<p>Thanks  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf473a33f88ef003fe55e16' id='5bf473a33f88ef003fe55e16'>
<a href='#5bf473a33f88ef003fe55e16'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/592daa96cc2622000d5c839c'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/8b2c58f39b90de3d2c245edf936a90f5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/592daa96cc2622000d5c839c'>Daniel Cascio (Blue Robin)</a>
</div>
<a UTCms='1542747043000' class='quanto-date posted-at response-posted-at' href='#5bf473a33f88ef003fe55e16'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Leo c , I believe you can assign specific weights to each factor as shown below within &quot;def make_factors()&quot;. For additional information, Grant had posted <a href="https://www.quantopian.com/posts/simple-alpha-factor-combination-techniques#5be02cc168484100407bc44f" rel="nofollow">this thread</a>.</p>

<pre><code>        return {  
            &#39;ROA&#39;:              (ROA,0.30),  
            &#39;STA&#39;:              (STA,0.20),  
        }  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf529a02d3eb221e6e2cdb4' id='5bf529a02d3eb221e6e2cdb4'>
<a href='#5bf529a02d3eb221e6e2cdb4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1542793632000' class='quanto-date posted-at response-posted-at' href='#5bf529a02d3eb221e6e2cdb4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>FYI, I morphed my basic architecture to do alpha combination in <code>before_trading_start</code> (see <a href="https://www.quantopian.com/posts/alpha-factor-combination-in-pipeline-how-to-fancify-it#5bf525d4ab895f004b7011ab" rel="nofollow">https://www.quantopian.com/posts/alpha-factor-combination-in-pipeline-how-to-fancify-it#5bf525d4ab895f004b7011ab</a>).  My sense is that this is the place to do it, versus within Pipeline (the main reason is that one gets a full 5 minutes per trading day to do computations, should there be a need to do some computational fanciness; the other reason is that one can use normal Python versus having to use the Q proprietary Pipeline API--learning the nuances of the latter has limited universal applicability, and support is limited to the Q platform and its users).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf57b5a3f88ef0a5ae55d75' id='5bf57b5a3f88ef0a5ae55d75'>
<a href='#5bf57b5a3f88ef0a5ae55d75'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bd66af07d33f1003f2e7190'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9b48c7898c9fb40a67552322d433f6f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bd66af07d33f1003f2e7190'>Adam Wu</a>
</div>
<a UTCms='1542814554000' class='quanto-date posted-at response-posted-at' href='#5bf57b5a3f88ef0a5ae55d75'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Leo</p>

<p>The simplest way is to just do something like this:</p>

<pre><code>def make_pipeline():

# Dictionary of factors  
factors = make_factors()

alpha = B1*factors[&#39;Factor1&#39;] + B2*factors[&#39;Factor2&#39;] + ... 

return Pipeline(columns={&#39;alpha&#39;:alpha}, **kwargs)  
</code></pre>

<p>where (Bn) are the weights. I agree with Grant&#39;s post and also do more complicated computations in before_trading_start, but for simple algos I&#39;ve found that doing the alpha combination within Pipeline and returning only the alpha column (instead of every factor) speeds up the backtest a bit.</p>

<p>Been fairly busy these days, will share some code on ML weighting when I get the chance.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf5d9be9939b800449fda5d' id='5bf5d9be9939b800449fda5d'>
<a href='#5bf5d9be9939b800449fda5d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ae9fc7db16b9339bf0d4997'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/96d136f0830e9bd9d16be17119689cc0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ae9fc7db16b9339bf0d4997'>Leo c</a>
<span class='badge medal'></span>
</div>
<a UTCms='1542838718000' class='quanto-date posted-at response-posted-at' href='#5bf5d9be9939b800449fda5d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant @Adam @Daniel Many thanks</p>

<p>Amended post. I have one question on my custom factor testing. I tried to implement in Grant code but I have an error. How to make it right?</p>

<pre><code>def make_factors(rng):  
    class LastTwoQuarters(CustomFactor):  
        # Get the last 2 reported values of the given asof_date + field.  
        outputs = [&#39;q2&#39;, &#39;q1&#39;]

        window_length = 130

        def compute(self, today, assets, out, asof_date, values):  
            for column_ix in range(asof_date.shape[1]):  
                _, unique_indices = np.unique(asof_date[:, column_ix], return_index=True)  
                quarterly_values = values[unique_indices, column_ix]  
                if len(quarterly_values) &lt; 2:  
                    quarterly_values = np.hstack([  
                            np.repeat([np.nan], 2 - len(quarterly_values)),  
                            quarterly_values,  
                        ])  
                    quarterly_values = quarterly_values[-2:]  
                    out[column_ix] = quarterly_values

    class LastThreeQuarters(CustomFactor):  
        # Get the last 3 reported values of the given asof_date + field.  
        outputs = [&#39;q3&#39;, &#39;q2&#39;, &#39;q1&#39;]

        window_length = 130 + 65

        def compute(self, today, assets, out, asof_date, values):  
            for column_ix in range(asof_date.shape[1]):  
                _, unique_indices = np.unique(asof_date[:, column_ix], return_index=True)  
                quarterly_values = values[unique_indices, column_ix]  
                if len(quarterly_values) &lt; 3:  
                    quarterly_values = np.hstack([  
                            np.repeat([np.nan], 3 - len(quarterly_values)),  
                            quarterly_values,  
                        ])  
                    quarterly_values = quarterly_values[-3:]  
                    out[column_ix] = quarterly_values

    FCFYLD = LastTwoQuarters(inputs = [Fundamentals.fcf_yield_asof_date, Fundamentals.fcf_yield], mask=universe)  
    LTDa = LastThreeQuarters(inputs = [Fundamentals.long_term_debt_asof_date, Fundamentals.long_term_debt], mask=universe)

    class TEST(CustomFactor):  
        FCF_YLD = FCFYLD.q1 + FCFYLD.q2  
        LTDaa = LTDa.q1 + LTDa.q2 + LTDa.q3  
        TEST_FACTOR = FCF_YLD/LTDaa  
        inputs = [TEST_FACTOR]  
        window_length = 252  
        window_safe = True  
        def compute(self, today, assets, out, TEST_FACTOR):  
            out[:] = preprocess(np.nan_to_num(TEST_FACTOR))  
    class TEST1(CustomFactor):  
        FCF_YLD = FCFYLD.q1 / FCFYLD.q2  
        LTDaa = LTDa.q1 / LTDa.q2 / LTDa.q3  
        TEST_FACTOR = FCF_YLD/LTDaa  
        inputs = [TEST_FACTOR]  
        window_length = 252  
        window_safe = True  
        def compute(self, today, assets, out, TEST_FACTOR):  
            out[:] = preprocess(np.nan_to_num(TEST_FACTOR)) 


    factors = [  
        TEST,  
        TEST1  
        ]  
    return factors[rng[0]:rng[1]]  
</code></pre>

<blockquote>
<blockquote>
<p>NonWindowSafeInput: Can&#39;t compute windowed expression TEST([NumExprFactor(...)], 252) with windowed input NumExprFactor(expr=&#39;(x_2 + x_0) / ((x_4 + x_1) + (x_3))&#39;, bindings={&#39;x_4&#39;: RecarrayField([LastThreeQuarters(...)], 0), &#39;x_2&#39;: RecarrayField([LastTwoQuarters(...)], 0), &#39;x_3&#39;: RecarrayField([LastThreeQuarters(...)], 0), &#39;x_0&#39;: RecarrayField([LastTwoQuarters(...)], 0), &#39;x_1&#39;: RecarrayField([LastThreeQuarters(...)], 0)}).  </p>
</blockquote>
</blockquote>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf5e4d2a6c5820041f563a3' id='5bf5e4d2a6c5820041f563a3'>
<a href='#5bf5e4d2a6c5820041f563a3'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1542841554000' class='quanto-date posted-at response-posted-at' href='#5bf5e4d2a6c5820041f563a3'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant, you simply use too many factors. You are going under the following equation taken from Lecture 32:</p>

<p>$$R_{a,t} = a_t + b_{a,F_1}F_1 + b_{a, F_2}F_2 + \dots + b_{a, F_K}F_K$$</p>

<p>and the factors of that equation are subject to a power law as the number of factors increases. Each factor you add contributes less and less to the overall result. To such an extent that your first 4 or 5 factors could represent some 90% of the data. Adding a sixth or seventh factor would generate just a marginal increase at best. It would be a small percentage compared to the 90% already covered. Imagine going for 10 or more factors. You do not want your trading system to depend on the fumes of the 11th factor.</p>

<p>See the following post for example.<br>
<a href="https://www.quantopian.com/posts/the-capital-asset-pricing-model-revisited#5bf5966d3f88ef0a5ae55e38" rel="nofollow">https://www.quantopian.com/posts/the-capital-asset-pricing-model-revisited#5bf5966d3f88ef0a5ae55e38</a></p>

<p>or refer to Wikipedia: <a href="https://en.wikipedia.org/wiki/Power_law" rel="nofollow">https://en.wikipedia.org/wiki/Power_law</a>  </p>

<p>My suggestion to improve on your strategy design would be to first reduce the number of factors. Even before that, I would question the relevance of the selected factors in the trading strategy you might want to use.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf5fb7f0b80360047e5498d' id='5bf5fb7f0b80360047e5498d'>
<a href='#5bf5fb7f0b80360047e5498d'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1542847359000' class='quanto-date posted-at response-posted-at' href='#5bf5fb7f0b80360047e5498d'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Guy -</p>

<p>So do you have a specific recommendation on how to reduce the number of factors?  Effectively, I think you are saying that the weights should not be equal (and that some of them should be zero).  What&#39;s the recipe?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf75ea9a5d58800470c48e7' id='5bf75ea9a5d58800470c48e7'>
<a href='#5bf75ea9a5d58800470c48e7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1542938281000' class='quanto-date posted-at response-posted-at' href='#5bf75ea9a5d58800470c48e7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant, as you know, I look for mathematical, statistical, and probabilistic solutions. I want an equal sign in my answers. And those are hard to come by in a trading environment.</p>

<p>Nonetheless, you have an old standby that could help: the payoff matrix.</p>

<p>$$F(t) = F_0 + \sum_i (H \cdot \Delta P) = F_0 + n \cdot u \cdot \overline{PT}$$</p>

<p>So, the numbers you need to impact are: n, u, and PT. Your trading strategy rebalances most of its stocks every day. Your program trades some 100 stocks some 84,921 times, with a starting trade unit of 100k, on which you make, on average, 0.10414%. That is $104.14 per trade. And since frictional costs are included, this is great.</p>

<p>Which recipe to use is not the main question. It is what can you do that can have an impact on those 3 numbers.  Can you increase the number of trades over the same time period? Can you raise your trading unit higher? Currently, it is growing at about a 3.04% rate. Can you do better? Also, can you increase your average profit per trade? Those are the numbers you have to take care of. </p>

<p>Your (round_trip=True) setting show that you have a 2:1 profit on your shorts, but with a 33% hit rate. Can you keep the edge and raise the hit rate? On your longs, you get a nice hit rate, but you lose more on your losses than you gain on your average win. The ratio is 0.89:1. You make money on your longs because the hit rate is providing the edge. A lower hit rate and you would lose money on your longs. I did not bother about the break-even point, but you estimate that yourself.</p>

<p>You traded at least 8.5B to make your 8.8M profit. There is nothing wrong with that. And really, that is not important.</p>

<p>You could raise profits 10 times just by switching the stats of your shorts (my numbers say 97M). Like getting the 0.58 win rate on the shorts and keeping the same average profit to loss figures. It would be sufficient to exceed market averages, and win the contest your eyes closed. Find ways to make it happen. You could increase your profits even further by giving your longs the same treatment.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf7e9f2a5d58800470c4bf8' id='5bf7e9f2a5d58800470c4bf8'>
<a href='#5bf7e9f2a5d58800470c4bf8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1542973938000' class='quanto-date posted-at response-posted-at' href='#5bf7e9f2a5d58800470c4bf8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Guy - You provided some good pointers.  --Grant  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf824924ed2b800463cbad5' id='5bf824924ed2b800463cbad5'>
<a href='#5bf824924ed2b800463cbad5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5707e024829bc5dae2000064'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/ff7931ca8733a8571ecea76999905df7?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5707e024829bc5dae2000064'>Georges Bilan</a>
</div>
<a UTCms='1542988946000' class='quanto-date posted-at response-posted-at' href='#5bf824924ed2b800463cbad5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant, thanks for sharing. I&#39;ve used lasso regularization to reduce the number of factors but I&#39;m not sure it&#39;s possible in the quantopian framework.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf89c51b990f8003d5d7a1c' id='5bf89c51b990f8003d5d7a1c'>
<a href='#5bf89c51b990f8003d5d7a1c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1543019601000' class='quanto-date posted-at response-posted-at' href='#5bf89c51b990f8003d5d7a1c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant, something else that could help you in your strategy would be to identify which of the factors you intend to use have value. That is easy to determine. It goes under the notion of all other things being equal. </p>

<p>For instance, I have said this often, I consider the stocktwits as having no value. Yet, it is part of your library arsenal. </p>

<p>If you decrease its importance by reweighing it to one hundredth the original test, it should reduce the strategy&#39;s payoff matrix. The same goes if you reweigh it to 100 times, you should see some improvement. If it results in no change to the payoff matrix, you have your answer.</p>

<p>That you do plus or minus a hundred times more or less than the initial value you will see no significant change in the payoff matrix. Confirming that the stocktwits added absolutely no value to your game. BTW, even if you did a million times less, you would still be with a no change scenario. In a way corroborating my argument on too many factors since the added ones beyond 5, 6 or 7 might have low marginal impact.</p>

<p>You could do this with any of the other factors you intend to use, reweigh them up or down one after another.</p>

<p>$$F(t) = F_0 (1 +  \xi_1 b_{a,F_1}F_1 + \xi_2 b_{a, F_2}F_2 + \dots + \xi_K b_{a, F_K}F_K)^t$$</p>

<p>If each of the factors can have an impact, it will show.  As you modify each of the \( \xi \) values in turn, you will see which factor might have some value. That is a lot of tests, but from it should come out which factors have any merit. From this, you could study the differential impact each factor can have. You could build more on those factors having a positive impact on the resulting payoff matrix since the others would have failed to raise the outcome.</p>

<p>Should you try to increase FCF 100-fold or reducing it by as much, in both cases, you will get a lower payoff matrix. You would make more if you reduced it than if you increased it. Yet, a factor like free cash flow should have a positive linear relationship to the well being of your payoff matrix. Either that or FCF is drowning in a sea of factors.</p>

<p>You might have to test every one of your factors in the same way in order to remove all that is either redundant or totally useless. It is up to you.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf9d012d55c3a004f10ba28' id='5bf9d012d55c3a004f10ba28'>
<a href='#5bf9d012d55c3a004f10ba28'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1543098386000' class='quanto-date posted-at response-posted-at' href='#5bf9d012d55c3a004f10ba28'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Guy -</p>

<p>In my mind, it is a question of how one should set the factor weights optimally (either as a &quot;set it and forget it&quot; approach or dynamically, computed with an online algo), given that there will be some turds in the bunch, deserving of zero weight, but other gems that justify non-zero weights.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bf9ec61e910b50040cfeb92' id='5bf9ec61e910b50040cfeb92'>
<a href='#5bf9ec61e910b50040cfeb92'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb5b36750a6132299e9c544'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f747e2e9e662b2b6e5affdb2da57b7ca?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb5b36750a6132299e9c544'>Ben</a>
</div>
<a UTCms='1543105633000' class='quanto-date posted-at response-posted-at' href='#5bf9ec61e910b50040cfeb92'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Is it possible to calculate a trailing Sharpe Ratio for each factor (say for the last X days). Then use a  Sharpe Ratio threshold of Y for including the factor in the latest alpha summation.</p>

<p>You could then optimise performance for X and Y and hopefully find a stable area where small changes in X and Y were not critical.</p>

<p>BTW - Thanks again! I used your framework to get my first contest entry accepted. I replaced all your factors with my own single factor.</p>

<p>I would very much like to use the above process in my own algo, but do not yet have the python ability.</p>

<p>Amber Swordfish</p>

<p>Update: I just  tested this approach excel , optimising the Sharpe Ratio for 20  versions of the same custom factor (each with different custom factor parameters). All 20 had positive Sharpe Ratios over a 27 year backtest on a single stock (SPY).</p>

<p>When  I used a trailing Sharpe Ratio on each custom factor to select which to include for the current day, I was surprised to find that the most successful strategy is to select factors  which have a poor trailing Sharpe ratio.  </p>

<p>On reflection, this makes sense as the Sharpe ratio for each custom factor will be mean reverting.</p>

<p>I can do all this in excel very easily - be great if somebody knows how to do in Python!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bfa9a3ce98f94004634fc41' id='5bfa9a3ce98f94004634fc41'>
<a href='#5bfa9a3ce98f94004634fc41'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1543150140000' class='quanto-date posted-at response-posted-at' href='#5bfa9a3ce98f94004634fc41'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Ben -</p>

<p>I think the concern with a Sharpe Ratio (SR) weighting on a relatively short trailing window would be overfitting and/or churn (SR is very volatile).  There&#39;s some discussion of this in Robert Carver&#39;s book, <em>Systematic Trading</em>; you need a very large trailing window of data to have any confidence that the SR is what you think it is.  Especially for factors based on fundamental data, the number of data points is pretty small, due to the quarterly/annual frequency of fundamental data.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bfac215e98f94004634fd05' id='5bfac215e98f94004634fd05'>
<a href='#5bfac215e98f94004634fd05'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1543160341000' class='quanto-date posted-at response-posted-at' href='#5bfac215e98f94004634fd05'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant, the presented equation would still prevail.</p>

<p>$$F(t) = F_0 (1 +  \xi_1 b_{a,F_1}F_1 + \xi_2 b_{a, F_2}F_2 + \dots + \xi_K b_{a, F_K}F_K)^t$$</p>

<p>You have \(K=40\) factors! You have no way to easily determine which are the turds and which are the gems, except by analyzing their contribution one at a time. And if you do that, one at a time that is, your results will not be conclusive. This has been demonstrated before and is what most have found over the years. </p>

<p>Your trading strategy is imposing 0.025 weights for each factor, thereby allowing each factor to represent 2.5% of total return which itself is less than 10%. </p>

<p>If one of the 40 weights changed by 10%, then its impact on the portfolio would be 0.0025. How will you be able to distinguish it from the whole with your current trading strategy? All it will do, considering all other things remaining equal, is to force a rebalancing of the entire portfolio with no fundamental reason as to why? All I see is churning on market noise where a single factor can force rebalancing, even on a 1% variation.</p>

<p>That you go dynamic or not, there are simply too many factors. You have thousands and thousands of tests to perform just to find the few that matter, and when you will have found them, you will be, to put it mildly, right up there, in over-fit territory. This would imply that your trading strategy will breakdown going forward. Totally counterproductive. And probably, a total waste of time. I did elaborate on this in my book.</p>

<p>Take at most 5 to 7 factors. There are 658,008 combinations should you take 5 factors at a time. And 18,643,560 different combinations should you go to 7 factors. Just in case you wondered. It would take some 4,000 years to do all the tests should you be up to it (considering the time it takes to do just one).</p>

<p>Already, Fama-French limited themselves, first to 3, then to 4 factors. They did not have better results going higher. At least, they did not show or commented much on that part of their research. </p>

<p>However, with your expertise, you can do better than they ever could with the added trading.  Plan for what you want to see, and then make it happen. You are playing a math game and it has long-term exponential properties.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bfcc25090a7df0045a8c596' id='5bfcc25090a7df0045a8c596'>
<a href='#5bfcc25090a7df0045a8c596'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bd66af07d33f1003f2e7190'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9b48c7898c9fb40a67552322d433f6f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bd66af07d33f1003f2e7190'>Adam Wu</a>
</div>
<a UTCms='1543291472000' class='quanto-date posted-at response-posted-at' href='#5bfcc25090a7df0045a8c596'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Though I&#39;ve mentioned this before, I agree with Guy&#39;s statement that there are too many factors however that doesn&#39;t necessarily mean dropping them to some arbitrary 5-7 number. It does mean it is necessary to find a better way to weight each factor though, for precisely the reason that Guy gave that the factors are essentially competing against each other with noise.</p>

<p>While individually stress-testing each factor is a good idea, it is not very practical even with only 5-7 factors. The concept of bias-variance trade-off is well-studied in data science, and so a potential solution to this is to use something such as k-fold Cross Validation (i.e. dividing the data into k subsets, where the first is reserved as a test set, and the remaining k-1 is used as training set. This process then repeats k times and the average Mean Squared Error across all folds is returned). I would suggest testing this with 5 or 10 folds initially, then incrementally adjusting. This becomes a much more practical method for testing the model while typically optimizing the bias-variance trade-off.</p>

<p>Also if the set of factors have a high degree of multi-collinearity (as is likely the case, since some of the factors are the same but with different timespans), the results from individually testing factors would not necessarily be reliable as this would impose the parametric assumption that all other factors are kept constant. Two or more highly correlated factors would violate this assumption, and make the results of such a test unreliable.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bfd2377d889e81e3e6a2110' id='5bfd2377d889e81e3e6a2110'>
<a href='#5bfd2377d889e81e3e6a2110'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1543316343000' class='quanto-date posted-at response-posted-at' href='#5bfd2377d889e81e3e6a2110'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks Adam -</p>

<p>For the technique you suggest, would trailing windows of each factor (alpha vector) be required?  Or would it be done on the point-in-time alpha vectors?  It seems like as a first-go, one just needs the point-in-time vectors.  One reason I&#39;m asking is that I want to do the alpha combination in <code>before_trading_start</code> and it is relatively easy to access the vectors there.  However, I don&#39;t yet have a framework for accessing trailing windows of vectors in <code>before_trading_start</code>.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bfd9cf9fee8cb004396abbc' id='5bfd9cf9fee8cb004396abbc'>
<a href='#5bfd9cf9fee8cb004396abbc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bd66af07d33f1003f2e7190'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9b48c7898c9fb40a67552322d433f6f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bd66af07d33f1003f2e7190'>Adam Wu</a>
</div>
<a UTCms='1543347449000' class='quanto-date posted-at response-posted-at' href='#5bfd9cf9fee8cb004396abbc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant</p>

<p>It&#39;s more of a tool for model validation, since we were discussing the possibility of overfitting and potential issue of too many factors. So it&#39;ll actually be something you do in Research, rather than deploy it into the actual algorithm.</p>

<p>If the model is misspecified, the mean MSE across the test sets would significantly exceed the expected value of (n-p-1)/(n+p+1), where n is your number of periods and p is the number of factors. In which case, we may drop factors one by one and see if the mean test MSE improves. Then take the factors that remain and put into your alpha combination framework. This would spare you from the 18,000,000+ combinations of individual stress-testing that Guy suggested, and narrow down the large list of factors to the most predictive ones.</p>

<p>Of course, the question remains as for the actual combination of the alphas. You could do an fundamental reasoning approach, or machine learning, or a multitude of others so I think this question is very open to individual judgment. Though based on the different timespans of the factors, I think a <a href="https://www.nomura.com/events/9th-annual-global-quantitative-investment-strategies-conference/resources/upload/11_00_Inigo_Fraser_Jenkins.pdf" rel="nofollow">non-linear combination</a>  could work well. </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bfe8516fee8cb004396b036' id='5bfe8516fee8cb004396b036'>
<a href='#5bfe8516fee8cb004396b036'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1543406870000' class='quanto-date posted-at response-posted-at' href='#5bfe8516fee8cb004396b036'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Regarding the possible number of factors, it could could be quite large.  Consider the degrees of freedom: thousands of stocks with OHLCV data and hundreds of fundamentals, tens of sectors, time of day/week/month/year, etc.  (e.g. assuming one were privy to sufficient details, there could be one factor per stock).  The idea that all of the degrees of freedom could be distilled into a handful of factors doesn&#39;t sound right.  The concept perhaps applies to an investment portfolio of mutual funds/ETFs, but given the number of degrees of freedom in the data, it is not clear that the same rule-of-thumb applies.</p>

<p>The other problem, I suspect, is that all factors don&#39;t work at all times--there is transience.  But if one ignores the transience, and just picks factors that appear to be all-season, then a lot is left on the table.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bfe85ff76a8ec1dd4270d40' id='5bfe85ff76a8ec1dd4270d40'>
<a href='#5bfe85ff76a8ec1dd4270d40'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56c4fb45989a47d1f5000159'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e509f31af551cfd30e319b03d4c92740?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56c4fb45989a47d1f5000159'>lifan guo</a>
</div>
<a UTCms='1543407103000' class='quanto-date posted-at response-posted-at' href='#5bfe85ff76a8ec1dd4270d40'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I tried machine learning algorithm to build a classifier of those alphas.... but it looks like linear combination is the best choice...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bfec0f9b631b20044e52de8' id='5bfec0f9b631b20044e52de8'>
<a href='#5bfec0f9b631b20044e52de8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1543422201000' class='quanto-date posted-at response-posted-at' href='#5bfec0f9b631b20044e52de8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Adam, Nomura quants acknowledged 314 factors in the document you referenced. Take their equation on page 17, \(r_{i,t} = a_0 + \beta_1 . V_{i,t} + \beta_2 . M_{i,t} + \gamma . \Im (V_{i,t} \cdot M_{i,t})\) where they considered only 2 factors at a time with their possible partial correlations. That would be 49,141 possible combinations. If they wanted to select the best 2, they would know which ones were best only after all those 49,141 tests. Just to point out that it would still be a lot of tests to be done.</p>

<p>Since the factors obey a power law, each factor that is added will increase the coefficient of determination and as a consequence increase the number of tests to be performed. <a href="https://www.quantopian.com/posts/the-capital-asset-pricing-model-revisited#5bf5966d3f88ef0a5ae55e38" rel="nofollow">See the following post</a> which elaborated on this point. </p>

<p>Should Nomura quants have tried to combine 7 factors using the same principles, in an exhaustive search, they would have had to try 55,825,075,869,992 combinations. Even if they considered using dynamic functions, they concluded to limit themselves to simple linear regressions on 2 factors without specifying how many tests were performed on how many different factors.</p>

<p>On the same basis as their equation, you could write: \(r_{j,t} = a_{0_{j,t}}  (1+ g_{j,t})^t \) where the average secular market trend g(t) might outperform the Nomura factors or account for much of it. Are the Nomura factors detecting a major part of the secular trend? Because on that one, you might have had it all just buying low-cost index funds. I was not impressed by that document. One should go for more in a long-term active trading strategy.</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bfef5499bad9559770740d7' id='5bfef5499bad9559770740d7'>
<a href='#5bfef5499bad9559770740d7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bd66af07d33f1003f2e7190'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9b48c7898c9fb40a67552322d433f6f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bd66af07d33f1003f2e7190'>Adam Wu</a>
</div>
<a UTCms='1543435593000' class='quanto-date posted-at response-posted-at' href='#5bfef5499bad9559770740d7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy</p>

<p>Great point. What I meant to say was that rather than individually weighing/test each factor (similar to a sensitivity analysis in traditional finance), there are other methodologies to test for model misspecification and/or overfitting that may be more practical in this case. My previous post mentioned k-fold cross validation as an alternative method, since the large amount of tests necessary and potential multi-collinearity in the factors are a concern. Repeating the cross validation test by removing factors would require at most 39 tests.</p>

<p>The Nomura document used a &quot;learning process&quot; (presumably the tree method introduced in the earlier slides) to determine optimal weights for each of their 23 factors. Since this process allows for 0 weights, it can also serve the function of removing the non-predictive factors - at least by sector. Thus the lengthy process of individually testing each factor with the trillions of combinations is bypassed.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bfef83c9bad95004a0741c2' id='5bfef83c9bad95004a0741c2'>
<a href='#5bfef83c9bad95004a0741c2'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bd66af07d33f1003f2e7190'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9b48c7898c9fb40a67552322d433f6f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bd66af07d33f1003f2e7190'>Adam Wu</a>
</div>
<a UTCms='1543436348000' class='quanto-date posted-at response-posted-at' href='#5bfef83c9bad95004a0741c2'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant</p>

<p>I completely agree. The idea that the entire cross-section of thousands of stock returns can be explained by a handful of factors seems very unlikely to me as well. Not to mention that even with the hundreds of possible factors already identified, we should also consider the countless possible linear and non-linear interactions between factors.</p>

<p>This brings up the topic of the performance of an all-season algorithm vs an algorithm that adapts its strategies to different market conditions. The Nomura model uses different factors and weights for each sector, and performs relatively well against their benchmark. Personally, I think rather than trying to create a general model that works across the entire cross-section (as is done by Sharpe, Fama-French, etc) which tends to have more profound academic results on market efficiency, it may be more profitable to try to create a model that works for a specific subset and to choose factors with this goal.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bffb86f6fe48d1689a9af4b' id='5bffb86f6fe48d1689a9af4b'>
<a href='#5bffb86f6fe48d1689a9af4b'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1543485551000' class='quanto-date posted-at response-posted-at' href='#5bffb86f6fe48d1689a9af4b'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ lifan -</p>

<blockquote>
<p>I tried machine learning algorithm to build a classifier of those alphas.... but it looks like linear combination is the best choice...</p>
</blockquote>

<p>That&#39;s interesting.  Not sure what it says.  One consideration is whether there is enough data, given the time scales of the factors (particularly the fundamental ones).  We are dealing with &lt; 10 years of data, when ~50-200 years would be preferred.  I have to wonder if the algo I posted above is grossly over-fit, given both the shortness of the backtest, and the fact that the 2010-present economic context is historically unique (immediately following a huge debt global crisis and governmental intervention).  So, a ML approach, given insufficient data, will more-than-likely produce inferior results (even though perhaps the ML approach would be superior given sufficient data).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bffc8ac4974c15428290984' id='5bffc8ac4974c15428290984'>
<a href='#5bffc8ac4974c15428290984'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56c4fb45989a47d1f5000159'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/e509f31af551cfd30e319b03d4c92740?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56c4fb45989a47d1f5000159'>lifan guo</a>
</div>
<a UTCms='1543489708000' class='quanto-date posted-at response-posted-at' href='#5bffc8ac4974c15428290984'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant, by the way, as for debtToTotalAssets  factor, it think it should  reverse, the less the better, is it correct?<br>
As for machine learning part, I figured out, the train datasets I use is too small, I updated the model too often...  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5bffcb6a8544e83e701283ad' id='5bffcb6a8544e83e701283ad'>
<a href='#5bffcb6a8544e83e701283ad'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1543490410000' class='quanto-date posted-at response-posted-at' href='#5bffcb6a8544e83e701283ad'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Here&#39;s an update.  As I mentioned in the original post, I&#39;m mostly concerned with the algo architecture.  Note that I output the individual daily alpha factors/vectors to <code>before_trading_start</code> and do the combination there (with some additional weighting, based on cosine similarity).  Also, note that I included the possibility of non-zero static weights in Pipeline (by returning tuples, <code>(factor, weight)</code>, with the weights presently all set to 1.</p>

<p>Eventually, I&#39;d like to output trailing windows of alpha vectors to <code>before_trading_start</code> so if anyone has done this, I&#39;d be interested.  One approach would be to assign each factor its own Pipeline, but my understanding is that this might really bog things down.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c0038508d0321004642eea7' id='5c0038508d0321004642eea7'>
<a href='#5c0038508d0321004642eea7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bb1b1e84ae2c1004a062d8e'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/3a64ba081bd92f018f87d0aa32cd448f?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bb1b1e84ae2c1004a062d8e'>Cc Mm</a>
</div>
<a UTCms='1543518288000' class='quanto-date posted-at response-posted-at' href='#5c0038508d0321004642eea7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Seem like new method is holding well wrt to your first post  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c003ed0aad0ad0045b23f46' id='5c003ed0aad0ad0045b23f46'>
<a href='#5c003ed0aad0ad0045b23f46'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bd66af07d33f1003f2e7190'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9b48c7898c9fb40a67552322d433f6f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bd66af07d33f1003f2e7190'>Adam Wu</a>
</div>
<a UTCms='1543519952000' class='quanto-date posted-at response-posted-at' href='#5c003ed0aad0ad0045b23f46'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant,</p>

<p>I believe initialize() is called once at the very beginning of the backtest/algorithm start, and perhaps you could schedule a recording function that runs at the end of trading period. Something like:</p>

<pre><code>def initialize(context):  
    # Empty list to store dictionary of alphas  
    context.trailing_alpha = []  
    schedule_function(alpha_record,  
                      date_rule=every_day(),  
                      time_rule=market_close() )

def before_trading_start(context,data):  
# Do your alpha combination here, stored as context.combined_alpha

def alpha_record(context,data):  
&quot;&quot;&quot; Combined alpha is appended to the list at end of each day &quot;&quot;&quot;
    context.trailing_alpha.append(context.combined_alpha)

def rebalance(context,data):  
# Let n be trailing window. If days &gt;= n, do something with context.trailing_alpha.

</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c010230aad0ad72f5b24267' id='5c010230aad0ad72f5b24267'>
<a href='#5c010230aad0ad72f5b24267'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1543569968000' class='quanto-date posted-at response-posted-at' href='#5c010230aad0ad72f5b24267'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Adam W -</p>

<p>Yes, recording (accumulating) the alpha factor data as the algo runs is a possibility, however then one has to deal with the dead or transient period until enough data are accumulated.  Also, I don&#39;t know if it&#39;ll do much good if the combined alpha is available in a trailing window.  I think one wants N trailing windows--one for each of the N individual factors.</p>

<p>@ lifan guo -</p>

<blockquote>
<p>by the way, as for debtToTotalAssets factor, it think it should reverse, the less the better, is it correct?</p>
</blockquote>

<p>Not sure.  You might try Alphalens to see what it does.  I don&#39;t have a business/finance background, but my hunch is that debt may have more of a sweet spot for a given business.  The other thing to consider is that all of the financials are public information, so the question really is to what extent has the market accurately incorporated debt relative to total assets into the price of a given company.  There may be a tendency for companies with high debt levels to have their stock prices beaten down to inaccurate levels, and so when the debt doesn&#39;t lead to disaster, the stock price rises.  For example, this article talks about Sears as having debt problems:</p>

<p><a href="https://www.investopedia.com/terms/t/totaldebttototalassets.asp" rel="nofollow">https://www.investopedia.com/terms/t/totaldebttototalassets.asp</a></p>

<p>So, as a hypothesis, maybe investors are avoiding Sears like the plague, when in actuality, it is more valuable than is reflected by the stock price.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c010370a8abde7078c98385' id='5c010370a8abde7078c98385'>
<a href='#5c010370a8abde7078c98385'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1543570288000' class='quanto-date posted-at response-posted-at' href='#5c010370a8abde7078c98385'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>For folks interested in dinking around with lots of factors:</p>

<p><a href="https://www.quantopian.com/posts/alpha-compiler" rel="nofollow">https://www.quantopian.com/posts/alpha-compiler</a><br>
<a href="http://alphacompiler.com/" rel="nofollow">http://alphacompiler.com/</a>  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c0194e649eefb0042b88fd7' id='5c0194e649eefb0042b88fd7'>
<a href='#5c0194e649eefb0042b88fd7'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bd66af07d33f1003f2e7190'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9b48c7898c9fb40a67552322d433f6f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bd66af07d33f1003f2e7190'>Adam Wu</a>
</div>
<a UTCms='1543607526000' class='quanto-date posted-at response-posted-at' href='#5c0194e649eefb0042b88fd7'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Oh I see. Just an idea, perhaps something like this? Haven&#39;t tested it.</p>

<pre><code>def make_factors():

    def alpha_combination():

        class Factor1(CustomFactor):  
            window_length = n1  
            def compute(self, today, assets, out, *inputs):  
                out[:] = # Do something  
        class Factor2(CustomFactor):  
            window_length = n2  
            def compute(self, today, assets, out, *inputs):  
                out[:] = # Do something

        return # Combine Factor1 and Factor2

    return {&#39;alpha_combination&#39;:alpha_combination}  
</code></pre>

<p>Then call make_factors within Pipeline to return alpha for each day based on N factors with (n1,n2,...) trailing windows.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c02788e94c19900360d2089' id='5c02788e94c19900360d2089'>
<a href='#5c02788e94c19900360d2089'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1543665806000' class='quanto-date posted-at response-posted-at' href='#5c02788e94c19900360d2089'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Adam W -</p>

<p>One limitation with Pipeline is that it will only output a Pandas DataFrame (indices are stocks and columns are data, e.g. alphas).  I&#39;ve been muddling my way through how to get data out  to do alpha combination outside of Pipeline (see <a href="https://blog.quantopian.com/a-professional-quant-equity-workflow/" rel="nofollow">https://blog.quantopian.com/a-professional-quant-equity-workflow/</a> for an overall flow).  I discuss some ideas on <a href="https://www.quantopian.com/posts/alpha-factor-combination-in-pipeline-how-to-fancify-it" rel="nofollow">https://www.quantopian.com/posts/alpha-factor-combination-in-pipeline-how-to-fancify-it</a>.</p>

<p>Within memory constraints, one has a full 5 minutes per trading day to do computations within <code>before_trading_start</code> (versus 10 minutes per <em>chunk</em> in Pipeline, which results in much less than 5 minutes per day of available compute time).</p>

<p>So, my thinking is that any dynamic alpha combination process should be done in <code>before_trading_start</code> by operating on the alpha factors (and any other data output by Pipeline for the combination step).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c04348e72b03c00427c36c5' id='5c04348e72b03c00427c36c5'>
<a href='#5c04348e72b03c00427c36c5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ae9fc7db16b9339bf0d4997'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/96d136f0830e9bd9d16be17119689cc0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ae9fc7db16b9339bf0d4997'>Leo c</a>
<span class='badge medal'></span>
</div>
<a UTCms='1543779470000' class='quanto-date posted-at response-posted-at' href='#5c04348e72b03c00427c36c5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Is it possible to compute X hours before the actual trading? let everything compute finish and store the chosen assets and their weights in the system. When the trading comes, then just upload to trade?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c044d8efecab700473f3ded' id='5c044d8efecab700473f3ded'>
<a href='#5c044d8efecab700473f3ded'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1543785870000' class='quanto-date posted-at response-posted-at' href='#5c044d8efecab700473f3ded'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Leo c -</p>

<blockquote>
<p>Is it possible to compute X hours before the actual trading? let everything compute finish and store the chosen assets and their weights in the system. When the trading comes, then just upload to trade? </p>
</blockquote>

<p>In a nutshell, yes.  When the algo starts, the weights should be based on t &lt;= 0, where the algo starts at t = 0.  It is possible, and is the typical approach.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c044dce72b03c004b7c3761' id='5c044dce72b03c004b7c3761'>
<a href='#5c044dce72b03c004b7c3761'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5ae9fc7db16b9339bf0d4997'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/96d136f0830e9bd9d16be17119689cc0?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5ae9fc7db16b9339bf0d4997'>Leo c</a>
<span class='badge medal'></span>
</div>
<a UTCms='1543785934000' class='quanto-date posted-at response-posted-at' href='#5c044dce72b03c004b7c3761'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Grant,</p>

<p>If so, we wont face any execution time out and memory overflow? The system can take its own sweet time to compute?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c0457fcf15cd90046c59276' id='5c0457fcf15cd90046c59276'>
<a href='#5c0457fcf15cd90046c59276'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1543788540000' class='quanto-date posted-at response-posted-at' href='#5c0457fcf15cd90046c59276'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Leo c -</p>

<p>The limits are 10 minutes for all Pipelines (chunked, not per day) and 5 minutes/day for <code>before_trading_start</code> (and 50 seconds for anything run during the day, during a trading minute).  However, I just encountered an unexpected mysterious <code>initialize</code> timeout of &lt; ~ 2 minutes, which seems to trump the Pipeline and <code>before_trading_start</code> timeouts for the use case I&#39;m trying.</p>

<p>Not sure about memory...there is a limit.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c0c30b8bacb0b00486618d4' id='5c0c30b8bacb0b00486618d4'>
<a href='#5c0c30b8bacb0b00486618d4'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5bd66af07d33f1003f2e7190'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/9b48c7898c9fb40a67552322d433f6f6?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5bd66af07d33f1003f2e7190'>Adam Wu</a>
</div>
<a UTCms='1544302776000' class='quanto-date posted-at response-posted-at' href='#5c0c30b8bacb0b00486618d4'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Grant</p>

<p>That&#39;s very interesting. I haven&#39;t experienced any time-outs on my algorithms as I&#39;ve been using static weights (trained in the Research API) but I can see how dynamic weights may require optimizing the architecture.</p>

<p>Could you elaborate more on what you mean by Pipeline <em>chunks</em>? All I could find in the documentation was the *chunksize argument which was for run_pipeline() on the Research API.</p>

<p>Edit: Q&#39;s FAQ mentions the module Queue is supported. Perhaps some sort of multi-threading may be useful for complex computations within the time window?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c0c500376b9ff004a76b924' id='5c0c500376b9ff004a76b924'>
<a href='#5c0c500376b9ff004a76b924'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1544310787000' class='quanto-date posted-at response-posted-at' href='#5c0c500376b9ff004a76b924'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Adam W -</p>

<p>There&#39;s some discussion about Pipeline and chunking here:</p>

<p><a href="https://www.quantopian.com/posts/pipeline-timeoutexception-any-hope-for-a-fix" rel="nofollow">https://www.quantopian.com/posts/pipeline-timeoutexception-any-hope-for-a-fix</a><br>
<a href="https://www.quantopian.com/posts/before-trading-start-timeout-fix" rel="nofollow">https://www.quantopian.com/posts/before-trading-start-timeout-fix</a></p>

<p>There&#39;s chunking in notebooks (where it can be controlled) and in the backtester (where I think it is fixed at 126 trading days).</p>

<p>In the backtester, there was a fairly recent change that provides 10 minutes for Pipeline to execute a chunk, and a separate 5 minutes for any computations in <code>before_trading_start</code>.  So, I&#39;ve been tinkering around with computing trailing windows of factors in Pipeline and then exporting the results to <code>before_trading_start</code> for the alpha combination step (see <a href="https://www.quantopian.com/posts/alpha-factor-combination-in-pipeline-how-to-fancify-it" rel="nofollow">https://www.quantopian.com/posts/alpha-factor-combination-in-pipeline-how-to-fancify-it</a>).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c308c517a6f70663deeb719' id='5c308c517a6f70663deeb719'>
<a href='#5c308c517a6f70663deeb719'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1546685521000' class='quanto-date posted-at response-posted-at' href='#5c308c517a6f70663deeb719'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant<br>
Initial standardization of alpha factors. I can see that you center each alpha factor and then add all the alpha factors together.   I am working on looking at the alpha factors in the research environment but thought to ask you a question: are the alpa factors (prepared in this form) sufficiently homogeneous to be able to add together in this way?</p>

<p>I can see that ranks can be added but I am not so sure about this wide spread of alpha results.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c30ab46ebd6bd176e202bd8' id='5c30ab46ebd6bd176e202bd8'>
<a href='#5c30ab46ebd6bd176e202bd8'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50842732cb5e1a02000000d1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f86535a7fafab6b7d903fc1461362f0a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50842732cb5e1a02000000d1'>James Villa</a>
<span class='badge medal'></span>
</div>
<a UTCms='1546693446000' class='quanto-date posted-at response-posted-at' href='#5c30ab46ebd6bd176e202bd8'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Zeno(Anthony) , Grant,</p>

<p>Been awhile. Standardization and normalization of data (factors) through rank and zscore are pre-processing data transformations that aligns the distribution to a Bayesian (Stochastic) framework (Gaussian distribution). This is a dominant assumption in financial modeling within the linear, classical statistics analytical framework.   At the center of the problem is some kind of weighing scheme of factors and / or combined factors. There are various techniques of weighing factors as Grant has been attempting of late through Spectral Clustering and also others using ML and other non linear methods. Other schemes involves weighing relative to some other threshold factor like risk parity, mean variance, Sharpe, etc.   So the challenge here is pre-processing raw input data in something that is meaningful to the weighing scheme / process, whatever you choose under whatever assumptions you have , to try and achieve an optimal alpha ( or objective function) without overfitting! This is where the bulk of the work is, finding the right combination that is sustainable and that takes a lot of trial and error.  </p>

<p>Happy NewYear!  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c30b78a0eb6c451b7fee7bd' id='5c30b78a0eb6c451b7fee7bd'>
<a href='#5c30b78a0eb6c451b7fee7bd'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/51318528831378d42a0001ad'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/af8a2fdb6b6e1c83933d4f7b647b235d?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/51318528831378d42a0001ad'>Guy Fleury</a>
</div>
<a UTCms='1546696586000' class='quanto-date posted-at response-posted-at' href='#5c30b78a0eb6c451b7fee7bd'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>James, well said.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c30b946ebd6bd61d4202ee5' id='5c30b946ebd6bd61d4202ee5'>
<a href='#5c30b946ebd6bd61d4202ee5'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1546697030000' class='quanto-date posted-at response-posted-at' href='#5c30b946ebd6bd61d4202ee5'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Zenothestoic and James -</p>

<p>I&#39;ve been kinda &quot;meh&quot; on Q of late and have taken a break.  That said, I&#39;m glad to comment if folks have questions on material I&#39;ve posted.</p>

<p>I think the question is, what is the justification for applying <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.scale.html" rel="nofollow">sklearn.preprocessing.scale</a> to each alpha vector and then summing as a means of alpha combination?  Frankly, I haven&#39;t given it much thought and have forged ahead with what seems to be common practice, based on various postings to the Q forum.  I&#39;ve played around with summing ranked alpha factors, but the results don&#39;t seem as good.</p>

<p>I&#39;d note that z-scored data can either conform or not to a Gaussian/normal distribution.  If the distribution is skewed or multimodal or whatever, z-scoring doesn&#39;t patch things up into a tidy normal distribution.  This suggests that perhaps the distribution of data of each alpha vector could be analyzed first, prior to normalization, to determine how to normalize it.</p>

<p>It is also worth noting that &quot;there is nothing new under the sun&quot; as evidenced by the variety of tools available here:</p>

<p><a href="https://scikit-learn.org/stable/modules/classes.html#module-sklearn.preprocessing" rel="nofollow">https://scikit-learn.org/stable/modules/classes.html#module-sklearn.preprocessing</a></p>

<p>There is a comparison of methods here:</p>

<p><a href="https://scikit-learn.org/stable/auto_examples/preprocessing/plot_all_scaling.html#sphx-glr-auto-examples-preprocessing-plot-all-scaling-py" rel="nofollow">https://scikit-learn.org/stable/auto_examples/preprocessing/plot_all_scaling.html#sphx-glr-auto-examples-preprocessing-plot-all-scaling-py</a></p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c30c50321fe3b559a990615' id='5c30c50321fe3b559a990615'>
<a href='#5c30c50321fe3b559a990615'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50842732cb5e1a02000000d1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f86535a7fafab6b7d903fc1461362f0a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50842732cb5e1a02000000d1'>James Villa</a>
<span class='badge medal'></span>
</div>
<a UTCms='1546700035000' class='quanto-date posted-at response-posted-at' href='#5c30c50321fe3b559a990615'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Guy, thanks!</p>

<p>@Grant,</p>

<blockquote>
<p>I&#39;d note that z-scored data can either conform or not to a Gaussian/normal distribution. If the distribution is skewed or multimodal or whatever, z-scoring doesn&#39;t patch things up into a tidy normal distribution. This suggests that perhaps the distribution of data of each alpha vector could be analyzed first, prior to normalization, to determine how to normalize it</p>
</blockquote>

<p>Yes, this is called trying to fit a &quot;square peg in a round hole&quot; , a common pitfall when the problem is postulated in a Stochastic Bayesian context. Your suggestion is a step in the right direction given data distribution of various factors have different spread/ranges/frequencies of occurences.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c30d607ebd6bd7255202c00' id='5c30d607ebd6bd7255202c00'>
<a href='#5c30d607ebd6bd7255202c00'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1546704391000' class='quanto-date posted-at response-posted-at' href='#5c30d607ebd6bd7255202c00'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>I am not sure then that we appear to be a single inch further forward. The whole of quantitative finance (or the vast majority of it) is based on the misconception that stock returns are normal. </p>

<p>Ranking makes much more intuitive sense to me, whether (or not) subsequent zscores of those ranks are appropriate. It seems a more factor neutral method of initially ranking alpha factors than an initial zeroing of alphas with (potentially) vast spreads around the mean in some factors and much narrower spreads in other factors. But perhaps Grant&#39;s subsequent processing ameliorates that.</p>

<p>It did occur to me that this is (potentially) why this method appears superior to the ranking method used elsewhere but I have done no proper investigation as yet. Perhaps this method gives hidden favor to more widely dispersed measures of alpha?</p>

<p>That aside, I feel &quot;dubious&quot; about the entire optimization process. Or rather about the vast list of constraints which actually leaves very, very little wriggle room for alpha at all. </p>

<p>In particular I am amused or perhaps amazed at the sheer size of the constraints list we are all using. </p>

<p>risk_model_loadings alone has what, 32 parameters?</p>

<p>Add to that constraints for:</p>

<p>MaxGrossExposure<br>
NetExposure<br>
DollarNeutral<br>
PositionConcentration</p>

<p>and you rather wonder what we are left with.</p>

<p>A Total Neutral Portfolio perhaps? Sometimes I wonder if it might be best to stay out of the market altogether and merely put the funds in the money markets since it seems that every element of risk is diversified away. </p>

<p>Or at least the attempt to hedge all risk is made.</p>

<p>Anyway the journey is an interesting one and like life it may be that the journey is the whole point and the inevitable end is actually not relevant.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c30d90cebd6bd0049203123' id='5c30d90cebd6bd0049203123'>
<a href='#5c30d90cebd6bd0049203123'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1546705164000' class='quanto-date posted-at response-posted-at' href='#5c30d90cebd6bd0049203123'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Grant</p>

<p>Like you I go &quot;meh&quot; on Quantopian sometimes. I do not think I am likely to be able to produce what Big Steve Cohen wants: a vast risk free return achieved by leveraging potentially non existent &quot;alpha&quot;.  What I do enjoy here is the quality of the research even if it leads to no good end. </p>

<p>As I have stated many times, I believe the consistent, successful  prediction of financial instrument returns over the long period is not an achievable goal. But its fun making the attempt. Even if its profoundly unprofitable. </p>

<p>The profitable aspect is in the fees.  However mediocre the investment performance, if you are good at marketing, you will win handsomely by managing other people&#39;s money.</p>

<p>Unless you are trading off the back of something which greatly increases the probability of correct prediction (inside information, the bid/offer spread, whatever) in the long term hedge fund clients will suffer. They will be paying absurdly high fees for very average performance. Or in some cases worse as with Jabre&#39;s recent collapse.</p>

<p>But as I have already said, for me the fun is the intellectual puzzle and grasping with new concepts.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c30db0cebd6bd7255202c3f' id='5c30db0cebd6bd7255202c3f'>
<a href='#5c30db0cebd6bd7255202c3f'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/50842732cb5e1a02000000d1'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/f86535a7fafab6b7d903fc1461362f0a?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/50842732cb5e1a02000000d1'>James Villa</a>
<span class='badge medal'></span>
</div>
<a UTCms='1546705676000' class='quanto-date posted-at response-posted-at' href='#5c30db0cebd6bd7255202c3f'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@Zeno,</p>

<blockquote>
<p>That aside, I feel &quot;dubious&quot; about the entire optimization process. Or rather about the vast list of constraints which actually leaves very, very little wriggle room for alpha at all.</p>
</blockquote>

<p>I believe this is by design and as intended given the specific trading / portfolio strategy Q is looking for, a low volatility, dollar/market/sector neutral, common risks mitigated (by their definition), long/short implemetation that is preferably highly diversified!  So yes given these constraints there is very little wiggle room for alpha but the niche is with this level of tradable funds that is considered to provide liquidity to the market, transaction and borrowing costs are very minimal and coupled with the power to leverage which can magnify returns while containing risks at manageable levels. This is very consisent to how Steve Cohen operates his hedge funds.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c30dd146eeca37a954151b1' id='5c30dd146eeca37a954151b1'>
<a href='#5c30dd146eeca37a954151b1'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1546706196000' class='quanto-date posted-at response-posted-at' href='#5c30dd146eeca37a954151b1'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>This suggests that perhaps the distribution of data of each alpha vector could be analyzed first, prior to normalization, to determine how to normalize it.</p>
</blockquote>

<p>Yes, quite. But assuming each or many alpha vectors have very different distributions is it possible to normalize each of them in different ways so as to make them comparable? Use a different method to normalize each to between -1 and 1 for instance?  Are there that many ways? Is this even possible?  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c30e2ff21fe3b0046990c50' id='5c30e2ff21fe3b0046990c50'>
<a href='#5c30e2ff21fe3b0046990c50'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1546707711000' class='quanto-date posted-at response-posted-at' href='#5c30e2ff21fe3b0046990c50'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>It did occur to me that this is (potentially) why this method appears superior to the ranking method used elsewhere but I have done no proper investigation as yet. Perhaps this method gives hidden favor to more widely dispersed measures of alpha?</p>
</blockquote>

<p>Just a hunch, but yes, I think something like this is going on.  Ranking wipes out any distribution in alpha values altogether and creates a new distribution (that is the same for every alpha factor).  For a large number of stocks, one ends up with uniform itsy-bitsy percentage-wise differences in ranked values, so distribution tails aren&#39;t really driving returns as they would for un-ranked alpha factors (where there is no limit on the extremes of the z-scores).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c30e6f00eb6c4003ffee9ee' id='5c30e6f00eb6c4003ffee9ee'>
<a href='#5c30e6f00eb6c4003ffee9ee'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1546708720000' class='quanto-date posted-at response-posted-at' href='#5c30e6f00eb6c4003ffee9ee'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>The idea of combining z-scoring and ranking doesn&#39;t really make sense, by the way (Q has done it in some of their examples, and it always seemed goofy).  If ranking is the chosen method, then for a common stock universe across all alpha factors, the ranks will already be normalized.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c30ed627a6f703648eeb853' id='5c30ed627a6f703648eeb853'>
<a href='#5c30ed627a6f703648eeb853'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/5b1f9ef65ad768004ad5f513'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/5435859afd955dddb6ccc1f0a31a482b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/5b1f9ef65ad768004ad5f513'>Zenothestoic</a>
</div>
<a UTCms='1546710370000' class='quanto-date posted-at response-posted-at' href='#5c30ed627a6f703648eeb853'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>If ranking is the chosen method, then for a common stock universe across all alpha factors, the ranks will already be normalized.</p>
</blockquote>

<p>Ah! Yes of course. Silly of me.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c312dc7c015cf004371484c' id='5c312dc7c015cf004371484c'>
<a href='#5c312dc7c015cf004371484c'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1546726855000' class='quanto-date posted-at response-posted-at' href='#5c312dc7c015cf004371484c'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><blockquote>
<p>As I have stated many times, I believe the consistent, successful prediction of financial instrument returns over the long period is not an achievable goal. But its fun making the attempt. Even if its profoundly unprofitable.</p>
</blockquote>

<p>Not so sure.  It&#39;s probably like any other business.  No one player will be successful forever, but there&#39;s a lot of money sloshing around, and at any given point in time, there will be opportunities.  Nobody&#39;s selling buggy whips anymore, but smart phones are still going strong (for now).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c35aa50b771b50043b85040' id='5c35aa50b771b50043b85040'>
<a href='#5c35aa50b771b50043b85040'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ed38379b1e7efbfb0006f8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fe429093818ef2b5c8f29dc274a188b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ed38379b1e7efbfb0006f8'>Karl Mun</a>
</div>
<a UTCms='1547020880000' class='quanto-date posted-at response-posted-at' href='#5c35aa50b771b50043b85040'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Btw Grant, in one of your custom factors:</p>

<pre><code>class Gross_Income_Margin(CustomFactor):  
    inputs = [Fundamentals.cost_of_revenue, Fundamentals.total_revenue]  
    window_length = 1  
    window_safe = True  
    def compute(self, today, assets, out, cost_of_revenue, sales):  
        gross_income_margin = sales[-1]/sales[-1] - cost_of_revenue[-1]/sales[-1]  
        out[:] = preprocess(-gross_income_margin)  
</code></pre>

<p>Is the definition of gross_income_margin the same as <a href="https://www.investopedia.com/terms/g/gross_profit_margin.asp" rel="nofollow">gross profit margin</a>?</p>

<p>Thanks</p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c35c320f418242f1006681a' id='5c35c320f418242f1006681a'>
<a href='#5c35c320f418242f1006681a'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1547027232000' class='quanto-date posted-at response-posted-at' href='#5c35c320f418242f1006681a'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Hi Karl -</p>

<blockquote>
<p>Is the definition of gross_income_margin the same as gross profit margin?</p>
</blockquote>

<p>It would seem so, but you might want to dig into the definitions of <code>sales</code> and <code>cost_of_revenue</code> just to make sure.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c35c3e3b771b50046b850dc' id='5c35c3e3b771b50046b850dc'>
<a href='#5c35c3e3b771b50046b850dc'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ed38379b1e7efbfb0006f8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fe429093818ef2b5c8f29dc274a188b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ed38379b1e7efbfb0006f8'>Karl Mun</a>
</div>
<a UTCms='1547027427000' class='quanto-date posted-at response-posted-at' href='#5c35c3e3b771b50046b850dc'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks, Grant - the equation seems to be at odds:</p>

<pre><code>gross_income_margin = sales[-1]/sales[-1] - cost_of_revenue[-1]/sales[-1]  
</code></pre>

<p>Edit: As that would be = <code>
1 - cost_of_revenue[-1]/sales[-1]  
</code>
Or should it be:</p>

<pre><code>gross_income_margin = (sales[-1] - cost_of_revenue[-1]) / sales[-1]  
</code></pre>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c35c7adf418240043066aef' id='5c35c7adf418240043066aef'>
<a href='#5c35c7adf418240043066aef'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1547028397000' class='quanto-date posted-at response-posted-at' href='#5c35c7adf418240043066aef'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>There was some whacky reason I coded things as I did.  I vaguely recall that it helped with managing NaNs/Infs.  If <code>sales = 0</code> but <code>cost_of_revenue &gt; 0</code> then <code>gross_income_margin</code> is NaN instead of Inf for the way I wrote the equation (since NaN - Inf = NaN, I believe).</p>

<p>This may be unnecessary, since I take care of both NaNs and Infs here:</p>

<pre><code>def preprocess(a):  
    a = a.astype(np.float64)  
    a[np.isinf(a)] = np.nan  
    a = np.nan_to_num(a - np.nanmean(a))  
    a = winsorize(a, limits=[WIN_LIMIT,WIN_LIMIT])  
    return preprocessing.scale(a)  
</code></pre>

<p>Now that I think about it, this approach may be mucked up.  Gotta run...I&#39;ll sleep on it and get back to you.  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c3876fa7781e70041049758' id='5c3876fa7781e70041049758'>
<a href='#5c3876fa7781e70041049758'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/4f005d1b5e32ee000b000001'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/03ce2b05f15809a7239dc5910a54abf5?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/4f005d1b5e32ee000b000001'>Grant Kiehne</a>
</div>
<a UTCms='1547204346000' class='quanto-date posted-at response-posted-at' href='#5c3876fa7781e70041049758'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>@ Karl -</p>

<p>Just let me know if you are stuck on anything.  I&#39;ve been more-or-less tuning out of Q for a variety of reasons, but have a commitment to support others (so long as it doesn&#39;t involve an extensive time commitment).  </p>
</div>
</div>
</div>

<div class='post-container response-container' data-post-id='5c388ca6d47abd003cc71608' id='5c388ca6d47abd003cc71608'>
<a href='#5c388ca6d47abd003cc71608'></a>
<div class='post-metadata'>
<div class='row'>
<div class='col-xs-14'>
<div class='inline-block'>
<div class='avatar-container'>
<a href='/users/56ed38379b1e7efbfb0006f8'><img class='avatar async-image' data-src='https://secure.gravatar.com/avatar/7fe429093818ef2b5c8f29dc274a188b?d=https%3A%2F%2Fs3.amazonaws.com%2Fquantopian-website-assets%2Fdefault-avatar.png' height='30' width='30'></a>
</div>
<a class='author-name' href='/users/56ed38379b1e7efbfb0006f8'>Karl Mun</a>
</div>
<a UTCms='1547209895000' class='quanto-date posted-at response-posted-at' href='#5c388ca6d47abd003cc71608'></a>
</div>
</div>
</div>

<div class='response-text'>
<div class='response-text-container post-body'><p>Thanks for getting back, Grant - ditto I was meaning to help if the gross_income_margin might be a dud - noting your earlier comment.</p>

<p>No worries :)  </p>
</div>
</div>
</div>

</div>
<div class='sign-in-please'>
Please <a href='/signin?return_to=/posts/algo-share'>sign in</a> or
<a href='/users/sign_up?redirect_to=/posts/algo-share'>join Quantopian</a> to
post a reply.
</div>
</div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: "550580758292093",
      status: false,
      cookie: true,
      xfbml: true
    });
  };
  
  (function(d, debug){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
    ref.parentNode.insertBefore(js, ref);
  }(document, /*debug*/ false));
  
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
    js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>
<script>
  $(document).ready(function () {
    quanto.instances.pm = new quanto.PostManager(false)
  });
</script>

<div class='login-footer'>
<div class='container'>
<div class='login-footer-text'>
Become an expert in quant finance through Quantopian's hands-on education.
</div>
<div class='login-footer-button'>
<button class='btn btn-v2 stroke join-modal-link mixpanel-button' data-event='anon join footer click posts' data-mixpanel='click'>
Join Now
</button>
</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='error-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'>Error</span>
</div>
<div class='modal-body body-content'>
<p>Sorry, something went wrong.  Try again or contact us by <a class='feedback-link'>sending feedback</a>.</p>
</div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' href='#'>Close</button>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='confirmation-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<div class='pull-right'>
<button class='btn btn-v2 border' data-dismiss='modal'>Cancel</button>
<button class='btn btn-v2 blue action-button' data-dismiss='modal'></button>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='message-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title modal-title'></span>
</div>
<div class='modal-body body-content'></div>
<div class='modal-footer'>
<button class='btn btn-v2 blue action-button' data-dismiss='modal' id='message-modal-close'>Close</button>
</div>

</div>
</div>
</div>

<div class='always-bootstrap3-modals'>
<div class='fade modal quanto-modal-v2' id='join-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header visible-small'>
<span class='title'>
Join Quantopian.  It's Free!
</span>
<div class='modal-x-out visible-xs'></div>
</div>
<div class='modal-body'>
<div class='flex-wrap'>
<div class='join-left-pane hidden-small'>
<div class='margin_30l'>
<div class='join-hero-text'>
Join Quantopian.  It's Free!
</div>
<div class='join-benefits'>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image code'></div>
</div>
<div class='join-text'>
Use our research platform, backtester, and dozens of clean data sets.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image learn'></div>
</div>
<div class='join-text'>
Learn with our hands-on education and community forums.
</div>
</div>
<div class='join-benefit'>
<div class='join-image-container'>
<div class='join-image win'></div>
</div>
<div class='join-text'>
Enter to win cash prizes in our contest.
</div>
</div>
</div>
<div class='hidden saved-reminder'>
Don't worry, all your work is already saved.
</div>
</div>
</div>
<div class='join-right-pane'>
<div class='hidden-small'>
<div class='button-pane'>
<a class="button btn-v2 user-form-btn" href="/signin">Already a Quantopian member?</a>
</div>
</div>
<div class='visible-small'>
<div class='already-member'>
<a href='/signin'>Already a Quantopian member?</a>
</div>
</div>
<form class="quanto-form-v2" id="new-user-modal-form" action="/users" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='error-message hidden'>
<div class='message'></div>
</div>
<div class='name-group'>
<div class='form-group inline-block'>
<label for="user_firstname">First Name</label>
<input class="form-control firstname" pattern=".*" required="required" autocomplete="off" autofocus="autofocus" type="text" name="user[firstname]" id="user_firstname" />
</div>
<div class='form-group inline-block'>
<label for="user_lastname">Last Name</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="text" name="user[lastname]" id="user_lastname" />
</div>
</div>
<div class='form-group'>
<label for="user_email">Email</label>
<input class="form-control" value="" pattern=".*" required="required" autocomplete="off" type="email" name="user[email]" id="user_email" />
</div>
<div class='form-group'>
<label for="user_password">Password</label>
<input autocomplete="off" class="form-control" pattern=".*" required="required" type="password" name="user[password]" id="user_password" />
</div>
<div class='checkbox eula'>
<input id='eula-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='eula-checkbox' id='checkbox-label'>I accept the <a href='/policies/terms' target='_blank'>Terms Of Use</a> and <a href='/policies/privacy' target='_blank'>Privacy Policy</a>.</label>
</div>
<div class='checkbox mailchimp-box'>
<input name="user[allow_marketing_emails]" type="hidden" value="0" /><input type="checkbox" value="1" name="user[allow_marketing_emails]" id="user_allow_marketing_emails" />
<div class='quanto-checkbox'></div>
<label for='user_allow_marketing_emails'>
Send me email updates with the latest news from the Quantopian community. We send these emails about once a month.
</label>
</div>
<div class='button-row'>
<button class='btn-v2 blue full' data-redirect-to='/tutorials/getting-started' id='sign-up-button' type='Submit'>Join Quantopian</button>
</div>
</form></div>
</div>
</div>

</div>
</div>
</div>

<div class='fade modal quanto-modal-v2' id='feedback-modal' role='dialog' tabindex='-1'>
<div class='modal-dialog' role='document'>
<div class='modal-content'>
<div class='modal-header'>
<span class='title'>Contact Support</span>
</div>
<div class='modal-body'>
<form class='anon-user controls quanto-form-v2' id='feedback-form'>
<div class='feedback-inputs'>
<div class='form-group'>
<input autofocus class='form-control' id='feedback-email-box' name='email' placeholder='Email Address' type='email'>
</div>
<div class='form-group'>
<input class='form-control' id='feedback-name-box' placeholder='Name' type='name'>
</div>
<div class='form-group'>
<textarea class='form-control' id='feedback-box' name='feedback' placeholder='What may we help you with?' rows='10'></textarea>
</div>
</div>
</form>
<form class='hidden quanto-form-v2 select-resource-area'>
<div class='select-step select-type-step'>
<div class='form-group'>
<select class='form-control select-resource-dropdown' title='Select the item you need help with'>
<option value='algorithm'>Algorithm</option>
<option value='backtest'>Backtest</option>
<option value='notebook'>Notebook</option>
</select>
</div>
</div>
<div class='select-step loading-area hidden'>
<div class='loading-text'>
Loading...
</div>
</div>
<div class='select-step empty-list-area hidden'>
<div class='back-button'>Go Back</div>
<div class='empty-text'>
No <span class='empty-list-resource-text'>algorithms</span> found
</div>
</div>
<div class='select-algo-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-algo-table select-item-table'>
<thead>
<tr>
<th>
Algorithm
<span class='sort-icon'></span>
</th>
<th>
Last Modified
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-backtest-area select-step hidden'>
<div class='back-button'>Go Back</div>
<table class='select-backtest-table select-item-table'>
<thead>
<tr>
<th>
Backtest
<span class='sort-icon'></span>
</th>
<th>
Started At
<span class='sort-icon'></span>
</th>
<th>
Overall Return
<span class='sort-icon'></span>
</th>
<th>
Status
<span class='sort-icon'></span>
</th>
</tr>
</thead>
</table>
</div>
<div class='select-notebook-area select-step hidden'>
<div class='back-button'>Go Back</div>
<div class='subtitle select-cell-step'>
Choose a cell to use as the preview for this notebook:
</div>
<div class='iframe-wrapper'>
<iframe class='notebook-list-iframe slow-fade' src=''></iframe>
</div>
<div class='progress-area slow-fade in'>
<div class='progress-container'>
<div class='progress-title'>
<div class='quanto-loader gray'></div>
</div>
</div>
</div>
<div class='maintenance-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, research is currently undergoing maintenance.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please check back shortly. If the maintenance period lasts longer than expected,
you can find updates on <a href='https://status.quantopian.com/'>status.quantopian.com</a>.
</div>
</div>

</div>
</div>
<div class='error-area'>
<div class='error-container'>
<div class='row'>
<div class='col-md-14 msg-title h1'>
Sorry, something went wrong on our end.
</div>
</div>
<div class='row'>
<div class='col-md-14 msg-subtitle'>
Please try again or contact <a class='open-feedback-link'>Quantopian support</a>.
</div>
</div>

</div>
</div>

</div>
<div class='selected-item-area select-step hidden'>
<div class='selected-item-group form-group'>
<div class='selected-item-control'>
<input class='disabled form-control selected-item-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change change-primary-item-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
<div class='selected-backtest-control'>
<input class='disabled form-control selected-backtest-box' type='text'>
<span class='secure-icon icon'></span>
<button class='btn change-backtest-button change-selection-button new-btn transparent' type='button'>
<span class='refresh-icon icon'></span>
</button>
</div>
</div>
<div class='checkbox-group form-group'>
<div class='checkbox give-permission'>
<input class='give-permission-checkbox' id='feedback-give-permission-checkbox' type='checkbox'>
<div class='quanto-checkbox'></div>
<label for='feedback-give-permission-checkbox'>
I permit Quantopian to view <span class='item-type-text'>this algorithm,
backtest or notebook and their imported datasets</span> for the purpose of providing support.
</label>
</div>
</div>
</div>
</form>

<div class='loading-step hidden'>
<div class='loading-text'>
Submitting your support ticket...
</div>
</div>
<div class='success-step invisible'>
<h2 class='title center'>
You've successfully submitted a support ticket.
</h2>
<p>
Our support team will be in touch soon.
</p>
<div class='confirmation-image'></div>
</div>
</div>
<div class='modal-footer'>
<button class='btn-v2 blue' id='send-feedback-button'>Send</button>
<div class='error-message hidden'>
Error submitting support request.
</div>
</div>

</div>
</div>
</div>

</div>
</div>
<div class='footer' id='quanto-footer-container'>
<div class='container'>
<div class='row header-row'>
<div class='col-sm-fourth span3'>
<img class='async-image logotype-image' data-src='https://qf.quantopian.com/assets/logos/logo-q-full-b23bda5ac757691b9259d396d0dfef91567165868b8c955a836649686e6d2248.svg'>
</div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'></div>
<div class='col-sm-fourth span3'>
<div class='feedback-email'>
Need help?
<a href="/cdn-cgi/l/email-protection#1b7d7e7e7f797a78705b6a6e7a756f746b727a7535787476">Contact support.</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-sm-fourth span3'>
<div class='header'>Company</div>
<div class='footer-row'>
<a href='/about'>About</a>
</div>
<div class='footer-row'>
<a href='/academia'>Academia</a>
</div>
<div class='footer-row'>
<a href='/jobs'>Careers</a>
</div>
<div class='footer-row'>
<a href='/posts'>Community</a>
</div>
<div class='footer-row'>
<a href='/events'>Events</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Learn &amp; Support</div>
<div class='footer-row'>
<a href='/faq'>FAQ</a>
</div>
<div class='footer-row'>
<a href='/tutorials/getting-started'>Getting Started</a>
</div>
<div class='footer-row'>
<a href='/docs'>Documentation</a>
</div>
<div class='footer-row'>
<a href='/tutorials'>Tutorials</a>
</div>
<div class='footer-row'>
<a href='/lectures'>Lectures</a>
</div>
<div class='footer-row'>
<a href='/opensource'>Open Source</a>
</div>
<div class='footer-row'>
<a href='https://status.quantopian.com/'>Site Status</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Notices</div>
<div class='footer-row'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='footer-row'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
<div class='footer-row'>
<a href='/security'>Security</a>
</div>
<div class='footer-row'>
<a href='/policies/code-of-conduct'>Code of Conduct</a>
</div>
</div>
<div class='col-sm-fourth span3'>
<div class='header'>Follow Us</div>
<div class='footer-row'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='footer-row'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='footer-row'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='footer-row'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
</div>
</div>
<div class='row'>
<div class='col-xs-14 span12'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>
</div>
</div>
<div class='mobile-footer'>
<div class='mobile-nav-category main-links'>
<div class='mobile-nav-row-footer'>
<a href='/about'>About Quantopian</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/jobs'>Careers</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/posts'>Community</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/events'>Events</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/docs'>Documentation</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/academia'>Academia</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/lectures'>Lectures</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://status.quantopian.com/'>Status</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.facebook.com/quantopian'>Facebook</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.twitter.com/quantopian'>Twitter</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.linkedin.com/company/quantopian'>LinkedIn</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='https://www.youtube.com/channel/UC606MUq45P3zFLa4VGKbxsg'>YouTube</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/terms'>Terms of Use</a>
</div>
<div class='mobile-nav-row-footer'>
<a href='/policies/privacy'>Privacy Policy</a>
</div>
</div>
<div class='mobile-nav-category'>
<div class='disclaimer'>
<p>
The material on this website is provided for informational purposes only and does not constitute an offer to sell, a solicitation to buy, or a recommendation or endorsement for any security or strategy, nor does it constitute an offer to provide investment advisory services by Quantopian.
</p>
<p>
In addition, the material offers no opinion with respect to the suitability of any security or specific investment. No information contained herein should be regarded as a suggestion to engage in or refrain from any investment-related course of action as none of Quantopian nor any of its affiliates is undertaking to provide investment advice, act as an adviser to any plan or entity subject to the Employee Retirement Income Security Act of 1974, as amended, individual retirement account or individual retirement annuity, or give advice in a fiduciary capacity with respect to the materials presented herein.  If you are an individual retirement or other investor, contact your financial advisor or other fiduciary unrelated to Quantopian about whether any given investment idea, strategy, product or service described herein may be appropriate for your circumstances.  All investments involve risk, including loss of principal.  Quantopian makes no guarantees as to the accuracy or completeness of the views expressed in the website. The views are subject to change, and may have become unreliable for various reasons, including changes in market conditions or economic circumstances.
</p>

</div>
</div>
</div>

</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-8519877-1", {
    cookieDomain: "quantopian.com"
  });
  ga('set', 'dimension1', 'session_5f9dc7425d387f00077e48e4');
  
  ga('send', 'pageview');
</script>

<input type="hidden" name="is_mac" id="is_mac" value="false" />
<input type="hidden" name="mp" id="mp" value="75873953cd404bcc1da88a55ff51e3b4" />
<script>
  (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("75873953cd404bcc1da88a55ff51e3b4");
</script>
<script>
  mixpanel.track("view page", {"page": window.location.pathname});
</script>
</html>
